/*! For license information please see mikaTV.bundle.js.LICENSE.txt */
!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.mikaTV_kuroMi=e():t.mikaTV_kuroMi=e()}(self,(()=>(()=>{"use strict";var t,e,n,r,i,o,a={9067:t=>{t.exports=function(t){var e=[];return e.toString=function(){return this.map((function(e){var n="",r=void 0!==e[5];return e[4]&&(n+="@supports (".concat(e[4],") {")),e[2]&&(n+="@media ".concat(e[2]," {")),r&&(n+="@layer".concat(e[5].length>0?" ".concat(e[5]):""," {")),n+=t(e),r&&(n+="}"),e[2]&&(n+="}"),e[4]&&(n+="}"),n})).join("")},e.i=function(t,n,r,i,o){"string"==typeof t&&(t=[[null,t,void 0]]);var a={};if(r)for(var s=0;s<this.length;s++){var u=this[s][0];null!=u&&(a[u]=!0)}for(var c=0;c<t.length;c++){var l=[].concat(t[c]);r&&a[l[0]]||(void 0!==o&&(void 0===l[5]||(l[1]="@layer".concat(l[5].length>0?" ".concat(l[5]):""," {").concat(l[1],"}")),l[5]=o),n&&(l[2]?(l[1]="@media ".concat(l[2]," {").concat(l[1],"}"),l[2]=n):l[2]=n),i&&(l[4]?(l[1]="@supports (".concat(l[4],") {").concat(l[1],"}"),l[4]=i):l[4]="".concat(i)),e.push(l))}},e}},5346:t=>{t.exports=function(t){return t[1]}},903:function(t,e,n){function r(t){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r(t)}function i(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,o(r.key),r)}}function o(t){var e=function(t,e){if("object"!=r(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var i=n.call(t,"string");if("object"!=r(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==r(e)?e:e+""}var a=this&&this.__createBinding||(Object.create?function(t,e,n,r){void 0===r&&(r=n);var i=Object.getOwnPropertyDescriptor(e,n);i&&!("get"in i?!e.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return e[n]}}),Object.defineProperty(t,r,i)}:function(t,e,n,r){void 0===r&&(r=n),t[r]=e[n]}),s=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),u=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)"default"!==n&&Object.prototype.hasOwnProperty.call(t,n)&&a(e,t,n);return s(e,t),e};Object.defineProperty(e,"__esModule",{value:!0}),e.Camera=void 0;var c=u(n(7186)),l=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)},(e=[{key:"getCamera",value:function(){return this._camera}},{key:"init",value:function(t){var e=t.clientHeight,n=t.clientWidth;this._camera=new c.PerspectiveCamera(90,n/e,.1,4e3),this._camera.position.set(-10,21.8,20)}}])&&i(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();e.Camera=l,e.default=new l},2089:(t,e)=>{e.U6=e.oh=void 0,e.oh="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACsAAAA0CAYAAAAT3cGOAAAACXBIWXMAAAsTAAALEwEAmpwYAAAFs0lEQVRogcWZ3WscVRiHn8lu+uGy2FDJnSCtFRSqBEEviqi0uehVyI164T+gV1IoQbShNqKCxtoLQVdKkMpaKbSlgqR9bULABKsxpFBIQcjHNoQ2Nmma3e1mZ3d2vJg5u2dmZ7Ob/Uh/cJjZ2TNnnvmd97znzIxx5MgRqklE3gCOAa8AYWAS+Kq7u/v3qic3UUY1WBH5GDgFGL6/bOAMcLy7uzvfGjyv2iocNwDj6tWrR4EBykFVnQ+AYRHZ2xo8r/ywhnusDae7j9fQxmFgUkReajJbmXRYwy0hoB3YaRjGqzW28wwwLiJvNxfPKwXrB90FPOHu16oI8LOIfCEioaZSutJhddDdQMSyrKUttmcAfcCvIrKnWZBKbXhd3UHJ1d2ZTGahznaPAn+LyAtNoXTVpm3DOLA73bIjmUzeaaDtZ4E/RaSnMcSSlLNtlMKgHQc8vLq62ggsQBS4JCKfiEhQ+tuS/GGgFyORSNQbBroMoB8HOtpIQ/oAU9uiAzdv3kw00rhPPcANEXmu3gYqzWAAjIyM3C8UCul6Gw/Q8zjAR+s5uQ1njleloO0DsLGx0Ux3AfbgpLYPtxrHylk/cFENpK/NFAI+A86LSKTWk3RnC3idtQHW19eb7ayut4AJEdlXS2W/s35glpeXWwkL8CLwl4gcrlZRh9VBi6EwOzvbijDway/OUvPYZpWCBpjH2dHR0TtoA66FCgODInJORHZVglUKjNu5ublMLpdbbjlqSe8Cf4jI0/4/KmUDBQy0JH1V08s4C/rX9INVnQVIp9PbEbd+dQLXReQddaAmZ9fW1rbbWaV24CcR6YIanV1aWnpcsOBMIB9BdWdtgFu3bj2OMND1JpQ7GxQG9rVr1+7atm1uL59HEShfdemTQhE4m80WTNNsdCHeiGagurPFQZZOpx9b3FqWdQ4wgmADgVOp1GOBtSzrxsWLF7+H8jComBFWVla2e5AVUqnUuVgs1huLxfKAEfZVqJhrE4lEoqura1so0+n01NjY2KenT5+eBDZwH7V0WAVW8BUbYGJiYqGnp2lP1YHK5XJ3p6env+3v7/8tn89n8D4TVnTW/4hjT01NrVuW9SAUCnU0G9K27WwikYifPHlyaHFxcYPgrGTXEgaeBU0kEmkq7Orq6ujQ0NA3w8PDd91rWUBeKxVhFbA/DGzASKfTiUgk0pRXm5lM5t+xsbGvBwcHp/CalAdygOluFTDVwsAzyB4+fJjo7OxsCNKyrLXbt2//cOLEiUvJZNLSrqUcNYEszsAy3eMFanDWk76Wl5fnDxw4UBekbdvWvXv3Lg0ODn43PT2d9F3HwnExp4FmKTlrwxadnZmZSRw6dGjLoKlU6p8LFy58GY/H53ztKzdVt2fdokKg6CoEv5Gp+NLj8uXLiXw+/6BWSNM0F8fHx/t6e3vfj8fjs5R39wbwCEi75RGl7s+7dYtmBYWBAi4LhWw2W1hYWDi/f//+9zaDLBQKmfn5+R8HBgbii4uLWV97yknV5SbewaS76XlQDfq01EbppXIUZ3m2C2fVbkSj0dDZs2c/7+joeD3oJldWViQWi50ZGRm5D2WjXDnqLzqkJ/R0hfbtC3wZEsJ9R+uCh92bMEzTtK9cuXL94MGD/0Wj0afC4fCTlmWtJ5PJyeHh4VN9fX2/zM3NpX2QKiY33JKhFJ8qNhVsRQU5a+B+rcFxNYrzjaHdvYnNpE/Z+uCp1uX6uRVVKWb1ScEzIquA6nFZS5eXxeVWYf1xprqoOJNtUl/PlyoVmdqxqnG5VVgFoC5uUvrOoL4/GAH1dDf9Xa7HZN2vojaDVS6ZlAaYrUHbvnqqbs2pqJmwurNq8rA0cPVbH+06pGfF1AhkNVgFnNf2Cy6I7rI/yeuQDXV5PbAKRu2buJ+d3DrKfb3UnIqaCasuqK/a9e9m+v9lK7RWqBqsAtIHU1Dq0rct0//nNloXLjtuNgAAAABJRU5ErkJggg==",e.U6="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACkAAAAsCAYAAAD4rZFFAAAACXBIWXMAAAsTAAALEwEAmpwYAAAHWklEQVRYhb2Yf2xT1xXHv/f5+TmxqbooUAuYQLO00VZqSjUVVdsk2MormrKJSaNdf40BYtoa1VLRoELiD5asQtbgjxWFQsVMlf7B6mabmCbEtttAUSuFKlhNO62Vm1UQkW1tBbZiiJPYfu/uD79jH18/Ow5BvdLVs9+7957PPfeec8+5YvPmzbjTRUoZBnAXgE4AN2zbvrmU8cSdgJRSrgHwYwCbATwIYLXWZBrAGIBLAIZt2/7wS4OUUj4C4CCAxwAYi+j6IYAEgJRt2+5CjW8LUkq5AsAggMcBiEUPUCvvA3jOtu33WjVazOwBQJw9e/a7AMYBPIGlAQLAQwDelVLuaym0TU0KAOLcuXM/NE3zDQAdS4TzK6+iolWlfzDb6CwAGGfOnHnUNM03AVjNGjqOMzU9PX3u+vXrH2Sz2c8Nwyh3d3ffvXz58nXhcPjbwWDwO2i+er8AcAvA3gaAFpoUBHjy5Mmvr1279h0hRLdfw0KhMDY6OvpyIpH4wHulvOp61QFQ6uvrW7Fly5Z4OBx+Bs0V9DPbtl9vB5IAA11dXdbp06ffMk3zEb2RUqqYyWQOx+PxP7E+BAkPUHmQDoASgNKRI0ce6OnpOS6E+KqP7JsA7rdte4pe+KmehJkArGPHjv20CeDc+fPn98Tj8b94bU0AAa/S76BXLQAhVJx7eO/evR+nUqkfua77bx/5dwH4LX+hQ1Y1CCDY3d3d2dXV9aLPQBgbG3spkUiMsVeuVvmYBEywHclkMp9KpZ5VSuV8hv+JlPK+VpA0YGhgYOD7pml+TR/hxo0bfztw4MDfwfabV4tepf9l1Jac5JkebMepU6dyk5OTB30gDQA/94MUbJAQgI5oNPoDvbdSqpRMJo8yuHkAcwBmtTrnfSt6sI4HW6eIvr6+f5RKpX/6gD4tpRR+kNXOADqWLVv2qN4zl8uNSCn/4wHMAigAmEHFfei14LWZbwZaKpWCV69efV2XAyAKYD2H5Fq0AIS2bt26JhAINLicycnJtzyhOtwMq7e0J8GWGCjJDyaTyXe893p5GKj5KpoZQVo9PT3rfDohnU6PeUJpKblgfloYbOJci1QCpJx0Oj1XLBY/tSzrG5q4dQRJWiTIIICg4zROzHXd6VQqdQW1JSTjUGiEpHEd1Fu8QL0XMQAEisXif30gozRbenK/FhgcHHx/dna2zo9ls9nXUDEIMgrSIoFwWG753LjmUFkB6gMARrlcnteVopQyCY7Pipywkc/n3f7+/l9eu3bt97lc7q8TExMv7tix4zDql5i7F79CwARbRL3FU19hmubdPv2LQONyUzUAiHQ6nd+1a9cr3uxpH7YLyEHBQE3UtonpyTJCodAavaPrup8BEKRJg1W+Z/RlIwNoF5CD0jhlfaIbN25cHgwGV+mdyuXyJ0DzY5EAeXBwu4AclI9XHWvbtm0N/hgAstnsewCEqQ3AQyt4YDTzpUL6yVHRaDQYi8WebGio1Kfbt2//BKjsCb+lEOw/ncf6OXxHSn9//1OWZTUsdaFQ+CP95pDkKgjQ8IHUHfLtFgEA+/bt64nFYs/pH5VSc5cuXXpNhyTDIECyOq7NO6HJqpHu37//gU2bNr0ihGhIR/L5/FAikfiMmPXlJidLVk57pw5QSrkewK8BrABwBsCgbduz7QIODQ09vnLlysNCiLDeqFwuTx0/fvwIl8cNx2FPnqrWnSRSyiiAtwGQ8/0WgOellL8B8IZt27f8AHt7e82dO3fakUjkoGmaD/vNQilVHh0dfWFkZCQPdpTyZMgPsEGY67q9hmHop8MaACcB/E5KOQrgMoAvABSUUlEA9wL4nhAi2mJsNTExcXBgYGAM9Sun/DI2PUgAmKOfn5+f6ezsbCYogsp9UDW7E2Lh+wOllJvJZF6Kx+PD8HF1C91g6CFcx6FDh0Ycx7m8oOQ2i+M4uYsXLz4fj8ffRL1PrkIGYrFYO4AhVG4tQlNTU2Ymk/nzhg0bDMuy1gsh/FajrZLL5UaOHj36q6GhoY9QMVqeclSjpFaXAwZqGV6nB2mhdmSWd+/efU9vb++OSCTyRLOLA70opYq5XO7ChQsX/nDixIl/oebiKNLn6YZaCDLAACPe0/Lg6870VatWiT179jy0evXqb0YikQeDweBKIcRXDMPocBxntlQq/W9mZubqlStXxoeHhy+Pj4/fZGOQBgtenYO23K1uMAKoLHMYwDIPMuS918/56lnM+vPIKsB+A/UHCAXDPCWpO9na2U9+aQFBKG8MDqhQH01RWyp6xE4pMAXTDadaM0g9BaBoqJo8tYBoNdlmKQUPphd19ceXZB41zblgETUDbTVZ/dKK0gieK/GE7rYgubGUUbH6aj7UBFSPHWk1eJ7TKiVuG5KWZx71mqhmlS1Afa/9tFp3/DUDWchweODB9xNpkWuTQDkk9eH7uszeUUrbMvxr17r5lR6BcjjuXlr1o6ffZcKSIEkgmEAKjnVXo9/08n1JT/69rbLYc5cLJ1igueH4PRdd/g9OAXrp/sjyFQAAAABJRU5ErkJggg=="},8198:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.default={"/extraUpload/stage/zhaixingling/zhai.pmx":{x:-32,y:140,z:336,color:"210303",intensity:2480,distance:500.76,angle:.840899633610868,penumbra:.902,decay:.45,focus:.189},"/extraUpload/stage/Stage001/Stage001.pmx":{x:-58,y:164,z:-302,color:"fef6f6",intensity:85,distance:1713.6,angle:.146607657167524,penumbra:.705,decay:.819,focus:.398},"/extraUpload/stage/stages/st2/st.pmx":{x:66,y:16,z:-402,color:"c7f1ff",intensity:330,distance:488.28,angle:.596902604182061,penumbra:.385,decay:.636,focus:.287},"/extraUpload/stage/waterpool/pool.pmx":{x:42,y:66,z:-130,color:"cc8624",intensity:1310,distance:196.56,angle:.197920337176157,penumbra:.926,decay:1.041,focus:1},"/extraUpload/stage/GhostRuleStage/stageMain.pmx":{x:288,y:-8,z:360,color:"041a0a",intensity:760,distance:723.24,angle:-.364424747816416,penumbra:.816,decay:.378,focus:.57},"/extraUpload/stage/stage04_CLkusajishi/stage04.pmx":{x:114,y:262,z:-180,color:"3f0808",intensity:145,distance:476.28,angle:-.980176907920016,penumbra:.053,decay:.414,focus:.312},"/extraUpload/stage/stageMiku/stage.pmx":{x:16,y:188,z:-230,color:"878787",intensity:515,distance:1002.96,angle:-.0502654824574367,penumbra:.607,decay:.414,focus:1},"/extraUpload/stage/blue-palace/1.pmx":{x:114,y:16,z:-106,color:"143d8f",intensity:3830,distance:1280.16,angle:1.03044239037745,penumbra:.742,decay:1.116,focus:.607},"/extraUpload/stage/HotspringHall/stage.pmx":{x:0,y:144,z:-130,color:"331700",intensity:1865,distance:816.48,angle:-1.13097335529233,penumbra:1,decay:.5,focus:.349},"/extraUpload/stage/lightstage/stage.pmx":{x:0,y:42,z:-230,color:"060538",intensity:700,distance:2147.04,angle:3.50601740140621,penumbra:1,decay:.5,focus:.914},default:{x:16,y:188,z:-230,color:"878787",intensity:515,distance:1002.96,angle:-.0502654824574367,penumbra:.607,decay:.414,focus:1}}},3547:function(t,e,n){function r(t){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r(t)}function i(t){return function(t){if(Array.isArray(t))return o(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return o(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?o(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function a(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,s(r.key),r)}}function s(t){var e=function(t,e){if("object"!=r(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var i=n.call(t,"string");if("object"!=r(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==r(e)?e:e+""}var u=this&&this.__createBinding||(Object.create?function(t,e,n,r){void 0===r&&(r=n);var i=Object.getOwnPropertyDescriptor(e,n);i&&!("get"in i?!e.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return e[n]}}),Object.defineProperty(t,r,i)}:function(t,e,n,r){void 0===r&&(r=n),t[r]=e[n]}),c=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),l=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)"default"!==n&&Object.prototype.hasOwnProperty.call(t,n)&&u(e,t,n);return c(e,t),e},f=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.Loader=e.helper=void 0;var h=l(n(7186)),p=n(532),d=n(9162),m=n(1180),y=f(n(903)),v=n(6397);e.helper={add:function(t,e){},update:function(t){}};var g="https://all.franxxdaryl.site/dist/threeMMD",b="https://all.franxxdaryl.site/dist/threeMMD",_=function t(e,n){var r=Array.from(new Set(Array.from(new Array(n)).map((function(t){return Math.round(Math.random()*(e.length-1))}))));return r.length===n?r:t(e,n)};function x(t){t.lengthComputable&&(t.loaded,t.total)}var w=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)},n=[{key:"refreshHelper",value:function(){e.helper.enable("animation",!1),e.helper.meshes.forEach((function(t){var n,r,i,o;null===(r=null===(n=null==t?void 0:t.geometry)||void 0===n?void 0:n.dispose)||void 0===r||r.call(n),null===(o=null===(i=null==t?void 0:t.skeleton)||void 0===i?void 0:i.dispose)||void 0===o||o.call(i),t&&e.helper.remove(t)})),e.helper.audio&&e.helper.remove(e.helper.audio),e.helper.camera&&e.helper.remove(e.helper.camera),e.helper={add:function(t,e){},update:function(t){}}}},{key:"clearAudio",value:function(){this.currentAudio=null}},{key:"afterEndLoop",value:function(){var t;null===(t=this.performanceEnd)||void 0===t||t.call(this)}},{key:"loadFBXModels",value:function(t){(new d.FBXLoader).load("/extraUpload/char/RabbitHoleMiku/FBX/RabbitHoleMiku_v1.0.fbx",(function(e){t.getScene().add(e)}),(function(t){console.log(t.loaded/t.total*100+"% loaded")}),(function(t){console.log(t)}))}},{key:"loadModels",value:function(t){var n,r,o,a,s,u,c,l,f,d,w,S,T,M=this,E=arguments.length>1&&void 0!==arguments[1]&&arguments[1],A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},O=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,P=[].concat(i(A.actionList||[]),i(v.actionList)),R=[].concat(i(v.characterList),i(A.characterList||[])),k=[].concat(i(A.pendingList||[]),i(v.pendingList));this.performanceEnd=O,e.helper=new m.MMDAnimationHelper;var C=new p.MMDLoader;window.location.href.includes("whatever")||(R=R.slice(0,6));var N=window.location.href.includes("mikaHaveRest")?Math.round(Math.random()*(R.length-1)):(new Date).getHours()>12?0:1,L=Math.round(Math.random()*(P.length-1));window._MMDneedReload&&(N=this.curRandomStudentIndex,L=this.curRandomActionIndex),this.curRandomActionIndex=L;var j="".concat(b+((null===(n=P[L])||void 0===n?void 0:n.music)||"/move/hitandrun.mp3")),I=R.slice(2),B=_(k,3),U=[],D=function(){var t=_(I,2);return t.find((function(t,e){return/momoi-maid|maid-midori/.test(I[t])}))?t=[I.findIndex((function(t){return/maid-midori/.test(t)})),I.findIndex((function(t){return/momoi-maid/.test(t)}))]:t.find((function(t,e){return/Midori.pmx|Momoi.pmx/.test(I[t])}))?t=[I.findIndex((function(t){return/Momoi.pmx/.test(t)})),I.findIndex((function(t){return/Midori.pmx/.test(t)}))]:t.find((function(t,e){return/Asuna_Bunny|Karin_Bunny/.test(I[t])}))?t=[I.findIndex((function(t){return/Karin_Bunny/.test(t)})),I.findIndex((function(t){return/Asuna_Bunny/.test(t)}))]:t.find((function(t,e){return/Asuna_JK|Karin_JK/.test(I[t])}))?t=[I.findIndex((function(t){return/Karin_JK/.test(t)})),I.findIndex((function(t){return/Asuna_JK/.test(t)}))]:t.find((function(t,e){return/yuka|noah/.test(I[t])}))?t=[I.findIndex((function(t){return/noah/.test(t)})),I.findIndex((function(t){return/yuka/.test(t)}))]:t.find((function(t,e){return/Yuka_Bunny|Noah_Bunny/.test(I[t])}))?t=[I.findIndex((function(t){return/Noah_Bunny/.test(t)})),I.findIndex((function(t){return/Yuka_Bunny/.test(t)}))]:t.find((function(t,e){return/BA_khr_001|hanako_uni/.test(I[t])}))&&(t=[I.findIndex((function(t){return/hanako_uni/.test(t)})),I.findIndex((function(t){return/BA_khr_002/.test(t)}))]),t};if(window._MMDneedReload)U=this.curPendingCharaArray;else{if(U=D(),/peko1.6|keru_bone|kokkoro/.test(R[N])){var F=["peko1.6","keru_bone","kokkoro"].filter((function(t){return!R[N].includes(t)}));U=[I.findIndex((function(t){return t.includes(F[0])})),I.findIndex((function(t){return t.includes(F[1])}))]}else U.find((function(t,e){return/peko1.6|keru_bone|kokkoro/.test(I[t])}))&&(U=[I.findIndex((function(t){return/keru_bone/.test(t)})),I.findIndex((function(t){return/kokkoro/.test(t)}))],N=R.findIndex((function(t){return t.includes("peko1.6")})));for(var z=["koharu","momoi","midori","hanako","miyako","mari","shiroko","hasumi","noah","asuna","iori","hifumi","karin","toki","/ako_","mayi","miku"];Array.from(new Set([R[N]].concat(i(U.map((function(t){return I[t]})))).map((function(t){var e=z.findIndex((function(e){return t.toLowerCase().includes(e)}));return e>-1?z[e]:t})))).length<3;)N=Math.round(Math.random()*(R.length-1)),U=D()}this.curPendingCharaArray=U,this.curRandomStudentIndex=N;var V=y.default.getCamera(),G=null;try{window._animateNeedPause=!0;var H=null===(o=null===(r=R[N].split("/").filter((function(t){return t.includes("pmx")})))||void 0===r?void 0:r[0])||void 0===o?void 0:o.replace(".pmx",""),W=null===(s=null===(a=I[U[0]].split("/").filter((function(t){return t.includes("pmx")})))||void 0===a?void 0:a[0])||void 0===s?void 0:s.replace(".pmx",""),q=null===(c=null===(u=I[U[1]].split("/").filter((function(t){return t.includes("pmx")})))||void 0===u?void 0:u[0])||void 0===c?void 0:c.replace(".pmx",""),X=null===(d=null===(f=null===(l=P[L])||void 0===l?void 0:l.music.split("/").filter((function(t){return/mp3|wav/.test(t)})))||void 0===f?void 0:f[0])||void 0===d?void 0:d.replace(".mp3","").replace(".wav","");document.getElementById("mikaScreen").setAttribute("class",""),document.getElementById("actionInfoModel")&&(document.getElementById("actionInfoModel").innerHTML=((null===(w=window._currentHotDance)||void 0===w?void 0:w.actor)||[H,W,q].join("，"))+"（详情信息整理中）"),document.getElementById("actionInfoMotion")&&(document.getElementById("actionInfoMotion").innerHTML=((null===(S=window._currentHotDance)||void 0===S?void 0:S.name)||X)+"（详情信息整理中）"),document.getElementById("actionInfoMusic")&&(document.getElementById("actionInfoMusic").innerHTML=((null===(T=window._currentHotDance)||void 0===T?void 0:T.name)||X)+"（详情信息整理中）"),document.getElementById("actionInfoStage")&&(document.getElementById("actionInfoStage").innerHTML="（详情信息整理中）")}catch(t){console.log(t)}if(window._currentHotDance.name){for(var Y=window._currentHotDance,J=function(n,r){return function(o){return new Promise((function(a,s){C.loadWithAnimation(n,r,(function(n){var r,s=n.mesh;s.castShadow=!0,s.receiveShadow=!0,Y.posList&&(r=n.mesh.position).set.apply(r,i(Y.posList[o])),e.helper.add(n.mesh,{animation:n.animation}),t.getScene().add(n.mesh),a(1),e.helper.enable("animation",!1),e.helper.objects.get(n.mesh).mixer.addEventListener("loop",(function(t){setTimeout((function(){e.helper.enable("animation",!1),e.helper.enable("cameraAnimation",!1),M.currentAudio.stop(),window._currentActionFinish=!0,0===o&&M.afterEndLoop()}),500)}))}))}))}},Z=[],K=Y.motion.music,Q=0;Q<(Y.model||[]).length;Q++){var $=0===Q?Y.motion.move:1===Q?Y.motion.moveLeft||Y.motion.move:Y.motion.moveRight||Y.motion.move;Z.push(J(Y.model[Q],$))}Promise.all([].concat(i(Z.map((function(t,e){return t(e)}))),[new Promise((function(t,e){var n=new h.AudioListener;V.add(n),(new h.AudioLoader).load(K,(function(e){G=new h.Audio(n).setBuffer(e),M.currentAudio=G,t(1)}),x,null)}))])).then((function(t){C.loadAnimation(Y.motion.camera,V,(function(t){window._animateNeedPause=!1,document.getElementById("mikaScreen").setAttribute("class","hide"),e.helper.enable("animation",!0),M.currentAudio.play(),window._currentAudio=M.currentAudio,G=null,C=null,e.helper.add(V,{animation:t})}))}))}else E?Promise.all([new Promise((function(n,r){var i,o;C.loadWithAnimation("".concat(g+R[(new Date).getHours()>12?0:1]),"".concat(E?g+(null===(i=k[B[1]])||void 0===i?void 0:i.move):b+(null===(o=P[L])||void 0===o?void 0:o.move))||"/move/hitandrun_mot.vmd",(function(r){var i=r.mesh;i.castShadow=!0,i.receiveShadow=!0;try{e.helper.add(r.mesh,{animation:r.animation}),e.helper.enable("animation",!1),setTimeout((function(){e.helper.enable("animation",!0)}),1e3)}catch(t){console.log(t)}t.getScene().add(r.mesh),n(1)}))}))]).then((function(t){var n,r;C.loadAnimation("".concat(g+(E?null===(n=k[B[0]])||void 0===n?void 0:n.camera:null===(r=P[L])||void 0===r?void 0:r.camera)||"/move/hitandrun_cam.vmd"),V,(function(t){window._animateNeedPause=!1,document.getElementById("mikaScreen").setAttribute("class","hide"),e.helper.add(V,{animation:t})}))})):Promise.all([new Promise((function(n,r){var i,o,a,s,u;C.loadWithAnimation("".concat((null===(i=P[L])||void 0===i?void 0:i.needRugular)?"https://all.franxxdaryl.site/dist/threeMMD/extraUpload/char/kokkoro_ver1.01/pmx/kokkoro_ver1.01.pmx":(null===(o=P[L])||void 0===o?void 0:o.needMikus)?"https://all.franxxdaryl.site/dist/threeMMD/extraUpload/char/SourMiku/White_bone.pmx":g+(R[N]||"/mod/mika_ver1.1.pmx")),Array.isArray(null===(a=P[L])||void 0===a?void 0:a.move)?null===(s=P[L])||void 0===s?void 0:s.move.map((function(t){return b+t})):"".concat(b+((null===(u=P[L])||void 0===u?void 0:u.move)||"/move/hitandrun_mot.vmd")),(function(r){var i,o=r.mesh;o.castShadow=!0,o.receiveShadow=!0,/everybody/.test(null===(i=P[L])||void 0===i?void 0:i.music)&&r.mesh.position.set(0,-2,0),e.helper.add(r.mesh,{animation:r.animation}),t.getScene().add(r.mesh),n(1),e.helper.enable("animation",!1),e.helper.objects.get(r.mesh).mixer.addEventListener("loop",(function(t){setTimeout((function(){e.helper.enable("animation",!1),e.helper.enable("cameraAnimation",!1),M.currentAudio.stop(),window._currentActionFinish=!0,M.afterEndLoop()}),500)}))}))})),new Promise((function(n,r){var i,o,a,s,u,c,l,f,h;(null===(i=P[L])||void 0===i?void 0:i.needRugular)||(null===(o=P[L])||void 0===o?void 0:o.needMikus)||/MKTO-Classic|Hyperactive|eden|ONEOFMIND/.test(null===(a=P[L])||void 0===a?void 0:a.music)?n(1):C.loadWithAnimation("".concat(g+(I[U[0]]||"/mod/mika_ver1.1.pmx")),Array.isArray((null===(s=P[L])||void 0===s?void 0:s.moveLeft)||(null===(u=P[L])||void 0===u?void 0:u.move))?((null===(c=P[L])||void 0===c?void 0:c.moveLeft)||(null===(l=P[L])||void 0===l?void 0:l.move)).map((function(t){return b+t})):"".concat(b+((null===(f=P[L])||void 0===f?void 0:f.moveLeft)||(null===(h=P[L])||void 0===h?void 0:h.move)||"/move/hitandrun_mot.vmd")),(function(r){var i,o,a,s,u,c,l,f,h,p=r.mesh;p.castShadow=!0,p.receiveShadow=!0,e.helper.add(r.mesh,{animation:r.animation}),/太陽系デスコ|GimmeMore|Magnet/.test(null===(i=P[L])||void 0===i?void 0:i.move)?(/太陽系デスコ/.test(null===(o=P[L])||void 0===o?void 0:o.move)&&r.mesh.position.set(0,0,-10),/GimmeMore/.test(null===(a=P[L])||void 0===a?void 0:a.move)&&r.mesh.position.set(1,1,-5),/Magnet/.test(null===(s=P[L])||void 0===s?void 0:s.move)&&r.mesh.position.set(0,0,0)):/BadApple/.test(null===(u=P[L])||void 0===u?void 0:u.music)?r.mesh.position.set(-3,0,0):/pockerface/.test(null===(c=P[L])||void 0===c?void 0:c.music)?r.mesh.position.set(0,0,-4):/everybody/.test(null===(l=P[L])||void 0===l?void 0:l.music)?r.mesh.position.set(0,1.5,2):/FREELYTOMORROW|Yuikonnu/.test(null===(f=P[L])||void 0===f?void 0:f.music)?r.mesh.position.set(0,0,0):r.mesh.position.set(/Hushh_AViVA|GLIDE/.test(null===(h=P[L])||void 0===h?void 0:h.move)?0:15,0,0),n(1),t.getScene().add(r.mesh),e.helper.enable("animation",!1),e.helper.objects.get(r.mesh).mixer.addEventListener("loop",(function(t){setTimeout((function(){e.helper.enable("animation",!1),e.helper.enable("cameraAnimation",!1),M.currentAudio.stop(),window._currentActionFinish=!0}),500)}))}))})),new Promise((function(n,r){var i,o,a,s,u,c,l,f,h;(null===(i=P[L])||void 0===i?void 0:i.needRugular)||(null===(o=P[L])||void 0===o?void 0:o.needMikus)||/太陽系デスコ|GimmeMore|MKTO-Classic|Magnet|Dontstopmeme|bonbon|GLIDE|Hyperactive|BadApple|eden|Yuikonnu|ONEOFMIND/.test(null===(a=P[L])||void 0===a?void 0:a.music)?n(1):C.loadWithAnimation("".concat(g+(I[U[1]]||"/mod/mika_ver1.1.pmx")),Array.isArray((null===(s=P[L])||void 0===s?void 0:s.moveRight)||(null===(u=P[L])||void 0===u?void 0:u.move))?((null===(c=P[L])||void 0===c?void 0:c.moveRight)||(null===(l=P[L])||void 0===l?void 0:l.move)).map((function(t){return b+t})):"".concat(b+((null===(f=P[L])||void 0===f?void 0:f.moveRight)||(null===(h=P[L])||void 0===h?void 0:h.move)||"/move/hitandrun_mot.vmd")),(function(r){var i,o,a,s,u=r.mesh;u.castShadow=!0,u.receiveShadow=!0,e.helper.add(r.mesh,{animation:r.animation}),r.mesh.position.set(/Hushh_AViVA/.test(null===(i=P[L])||void 0===i?void 0:i.move)?0:-15,0,0),/pockerface/.test(null===(o=P[L])||void 0===o?void 0:o.music)?r.mesh.position.set(2,0,2):/everybody/.test(null===(a=P[L])||void 0===a?void 0:a.music)?r.mesh.position.set(0,1.5,2):/FREELYTOMORROW/.test(null===(s=P[L])||void 0===s?void 0:s.music)&&r.mesh.position.set(0,0,0),t.getScene().add(r.mesh),e.helper.enable("animation",!1),e.helper.objects.get(r.mesh).mixer.addEventListener("loop",(function(t){setTimeout((function(){e.helper.enable("animation",!1),e.helper.enable("cameraAnimation",!1),M.currentAudio.stop(),window._currentActionFinish=!0}),500)})),n(1)}))})),new Promise((function(n,r){var i,o,a,s,u,c,l,f=["/extraUpload/char/EkulyMiku/EkulyMikuHatsune.pmx","/extraUpload/char/Sour_Breath_You/BreathYou.pmx","/extraUpload/char/SourMiku/Black.pmx","/extraUpload/char/SourMiku/White.pmx","/extraUpload/char/SourSpirng/springMiku.pmx","/extraUpload/char/MikuIf/miku.pmx","/extraUpload/char/mikuTDA/tda.pmx","/extraUpload/char/iniMiku/all.pmx","/extraUpload/char/rockmiku/all.pmx","/extraUpload/char/racingmiku/miku.pmx","/extraUpload/char/dot_supreme/miku.pmx","/extraUpload/char/dot_starvoice/miku.pmx","/extraUpload/char/dot_type20202/miku.pmx"],h=Math.round(Math.random()*(f.length-1));/pockerface/.test(null===(i=P[L])||void 0===i?void 0:i.music)?C.loadWithAnimation("".concat(g+(f[h]||"/mod/mika_ver1.1.pmx")),Array.isArray((null===(o=P[L])||void 0===o?void 0:o.moveSpecial)||(null===(a=P[L])||void 0===a?void 0:a.moveSpecial))?((null===(s=P[L])||void 0===s?void 0:s.moveSpecial)||(null===(u=P[L])||void 0===u?void 0:u.move)).map((function(t){return b+t})):"".concat(b+((null===(c=P[L])||void 0===c?void 0:c.moveSpecial)||(null===(l=P[L])||void 0===l?void 0:l.move)||"/move/hitandrun_mot.vmd")),(function(r){var i=r.mesh;i.castShadow=!0,i.receiveShadow=!0,e.helper.add(r.mesh,{animation:r.animation}),r.mesh.position.set(2,0,2),t.getScene().add(r.mesh),e.helper.enable("animation",!1),n(1)})):n(1)})),new Promise((function(t,e){var n=new h.AudioListener;V.add(n),(new h.AudioLoader).load(j,(function(e){G=new h.Audio(n).setBuffer(e),M.currentAudio=G,t(1)}),x,null)}))]).then((function(t){var n,r;C.loadAnimation("".concat(b+((E?null===(n=k[B[0]])||void 0===n?void 0:n.camera:null===(r=P[L])||void 0===r?void 0:r.camera)||"/move/hitandrun_cam.vmd")),V,(function(t){var n;window._animateNeedPause=!1,document.getElementById("mikaScreen").setAttribute("class","hide"),e.helper.enable("animation",!0),/wavefile_v2/.test(null===(n=P[L])||void 0===n?void 0:n.move)?setTimeout((function(){M.currentAudio.play(),window._currentAudio=M.currentAudio,G=null,C=null}),5300):(M.currentAudio.play(),window._currentAudio=M.currentAudio,G=null,C=null),e.helper.add(V,{animation:t})}))}))}}],n&&a(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,n}();e.Loader=w,e.default=new w},1250:function(t,e,n){function r(t){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r(t)}function i(){i=function(){return e};var t,e={},n=Object.prototype,o=n.hasOwnProperty,a=Object.defineProperty||function(t,e,n){t[e]=n.value},s="function"==typeof Symbol?Symbol:{},u=s.iterator||"@@iterator",c=s.asyncIterator||"@@asyncIterator",l=s.toStringTag||"@@toStringTag";function f(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{f({},"")}catch(t){f=function(t,e,n){return t[e]=n}}function h(t,e,n,r){var i=e&&e.prototype instanceof b?e:b,o=Object.create(i.prototype),s=new C(r||[]);return a(o,"_invoke",{value:O(t,n,s)}),o}function p(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}e.wrap=h;var d="suspendedStart",m="suspendedYield",y="executing",v="completed",g={};function b(){}function _(){}function x(){}var w={};f(w,u,(function(){return this}));var S=Object.getPrototypeOf,T=S&&S(S(N([])));T&&T!==n&&o.call(T,u)&&(w=T);var M=x.prototype=b.prototype=Object.create(w);function E(t){["next","throw","return"].forEach((function(e){f(t,e,(function(t){return this._invoke(e,t)}))}))}function A(t,e){function n(i,a,s,u){var c=p(t[i],t,a);if("throw"!==c.type){var l=c.arg,f=l.value;return f&&"object"==r(f)&&o.call(f,"__await")?e.resolve(f.__await).then((function(t){n("next",t,s,u)}),(function(t){n("throw",t,s,u)})):e.resolve(f).then((function(t){l.value=t,s(l)}),(function(t){return n("throw",t,s,u)}))}u(c.arg)}var i;a(this,"_invoke",{value:function(t,r){function o(){return new e((function(e,i){n(t,r,e,i)}))}return i=i?i.then(o,o):o()}})}function O(e,n,r){var i=d;return function(o,a){if(i===y)throw Error("Generator is already running");if(i===v){if("throw"===o)throw a;return{value:t,done:!0}}for(r.method=o,r.arg=a;;){var s=r.delegate;if(s){var u=P(s,r);if(u){if(u===g)continue;return u}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(i===d)throw i=v,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);i=y;var c=p(e,n,r);if("normal"===c.type){if(i=r.done?v:m,c.arg===g)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(i=v,r.method="throw",r.arg=c.arg)}}}function P(e,n){var r=n.method,i=e.iterator[r];if(i===t)return n.delegate=null,"throw"===r&&e.iterator.return&&(n.method="return",n.arg=t,P(e,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),g;var o=p(i,e.iterator,n.arg);if("throw"===o.type)return n.method="throw",n.arg=o.arg,n.delegate=null,g;var a=o.arg;return a?a.done?(n[e.resultName]=a.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,g):a:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,g)}function R(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function k(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function C(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(R,this),this.reset(!0)}function N(e){if(e||""===e){var n=e[u];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,a=function n(){for(;++i<e.length;)if(o.call(e,i))return n.value=e[i],n.done=!1,n;return n.value=t,n.done=!0,n};return a.next=a}}throw new TypeError(r(e)+" is not iterable")}return _.prototype=x,a(M,"constructor",{value:x,configurable:!0}),a(x,"constructor",{value:_,configurable:!0}),_.displayName=f(x,l,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===_||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,x):(t.__proto__=x,f(t,l,"GeneratorFunction")),t.prototype=Object.create(M),t},e.awrap=function(t){return{__await:t}},E(A.prototype),f(A.prototype,c,(function(){return this})),e.AsyncIterator=A,e.async=function(t,n,r,i,o){void 0===o&&(o=Promise);var a=new A(h(t,n,r,i),o);return e.isGeneratorFunction(n)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},E(M),f(M,l,"Generator"),f(M,u,(function(){return this})),f(M,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),n=[];for(var r in e)n.push(r);return n.reverse(),function t(){for(;n.length;){var r=n.pop();if(r in e)return t.value=r,t.done=!1,t}return t.done=!0,t}},e.values=N,C.prototype={constructor:C,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(k),!e)for(var n in this)"t"===n.charAt(0)&&o.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function r(r,i){return s.type="throw",s.arg=e,n.next=r,i&&(n.method="next",n.arg=t),!!i}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],s=a.completion;if("root"===a.tryLoc)return r("end");if(a.tryLoc<=this.prev){var u=o.call(a,"catchLoc"),c=o.call(a,"finallyLoc");if(u&&c){if(this.prev<a.catchLoc)return r(a.catchLoc,!0);if(this.prev<a.finallyLoc)return r(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return r(a.catchLoc,!0)}else{if(!c)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return r(a.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&o.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var i=r;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,g):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),g},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),k(n),g}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var i=r.arg;k(n)}return i}}throw Error("illegal catch attempt")},delegateYield:function(e,n,r){return this.delegate={iterator:N(e),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=t),g}},e}function o(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,a(r.key),r)}}function a(t){var e=function(t,e){if("object"!=r(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var i=n.call(t,"string");if("object"!=r(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==r(e)?e:e+""}var s=this&&this.__createBinding||(Object.create?function(t,e,n,r){void 0===r&&(r=n);var i=Object.getOwnPropertyDescriptor(e,n);i&&!("get"in i?!e.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return e[n]}}),Object.defineProperty(t,r,i)}:function(t,e,n,r){void 0===r&&(r=n),t[r]=e[n]}),u=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),c=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)"default"!==n&&Object.prototype.hasOwnProperty.call(t,n)&&s(e,t,n);return u(e,t),e},l=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(i,o){function a(t){try{u(r.next(t))}catch(t){o(t)}}function s(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}u((r=r.apply(t,e||[])).next())}))},f=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var h=c(n(7186)),p=f(n(903)),d=c(n(3547)),m=f(n(3559)),y=n(7770),v=n(829),g=n(8378),b=f(n(6425)),_=function(){return t=function t(e,n,r){var o=this,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),window._MMDneedReload=a;var s={};window._currentActionFinish=!1,this.performanceEnd=function(){return l(o,void 0,void 0,i().mark((function t(){return i().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.reloadAmmo();case 2:null==r||r();case 3:case"end":return t.stop()}}),t,this)})))},b.default.request({method:"GET",headers:{"Content-Type":"application/json;charset=utf-8"},url:"https://franxxdaryl.site/fileList.json?"+(new Date).getTime()}).then((function(t){s=t.data||{}})).catch((function(t){console.log(t)})).finally((function(){o.container=document.getElementById("mikaStage"),o.container&&(o.clock=new h.Clock,o.currentScene=new y.Scene(s.stageList||[]),o.currentScene.init(o.container),p.default.init(o.container),m.default.init(o.container),e&&o.pending(s),n&&o.reRender(s))}))},(e=[{key:"render",value:function(){d.default.loadModels(this.currentScene,!1,{},(function(){})),this.initControls(),this.initLight(),this.callRenderer()}},{key:"reloadAmmo",value:function(){return window.Ammo=null,new Promise((function(t,e){var n=document.createElement("script");n.src="ammo.js",document.body.appendChild(n),setTimeout((function(){var e;t("ok"),null===(e=null===window||void 0===window?void 0:window.Ammo)||void 0===e||e.call(window)}),300),document.body.removeChild(n)}))}},{key:"destroy",value:function(){var t,e,n=document.getElementById("mikaStage")||{innerHTML:""};null===(t=null===d.default||void 0===d.default?void 0:d.default.currentAudio)||void 0===t||t.stop(),null===d.default||void 0===d.default||d.default.clearAudio(),null!==n&&(n.innerHTML=""),this.currentScene.destroyScene(),this.container=null,this.currentScene=null,this.currentEffect=null,window.cancelAnimationFrame(this.frameId),m.default.destroy(),d.default.refreshHelper(),null===(e=document.getElementsByClassName("mikatootip")[0])||void 0===e||e.setAttribute("class","mikatootip hide")}},{key:"pause",value:function(){}},{key:"pending",value:function(t){var e=this;d.default.loadModels(this.currentScene,!0,t,(function(){})),this.initControls(),this.initLight(),this.currentEffect=new g.OutlineEffect(m.default.getRenderer()),setTimeout((function(){var t;null===(t=document.getElementsByClassName("mikatootip")[0])||void 0===t||t.setAttribute("class","mikatootip")}),5e3),function t(){e.frameId=requestAnimationFrame((function(){var n=e.clock.getDelta();window._animateNeedPause||(d.helper.update(n),e.currentEffect.setSize(window.innerWidth,window.innerHeight),e.currentEffect.render(e.currentScene.getScene(),p.default.getCamera())),t()}))}()}},{key:"initLight",value:function(){}},{key:"initControls",value:function(){var t=new v.OrbitControls(p.default.getCamera(),m.default.getRenderer().domElement);t.target=new h.Vector3(1.6,14,-4),this.controls=t}},{key:"reRender",value:function(t){d.default.loadModels(this.currentScene,!1,t,this.performanceEnd),this.initLight(),this.currentEffect=new g.OutlineEffect(m.default.getRenderer()),this.currentEffect.setSize(window.innerWidth,window.innerHeight),this.callRenderer()}},{key:"callRenderer",value:function(){var t=this;this.frameId=requestAnimationFrame((function(){if(!window._currentActionFinish){var e=t.clock.getDelta();d.helper.update(e),t.currentEffect.render(t.currentScene.getScene(),p.default.getCamera()),t.callRenderer()}}))}}])&&o(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();e.default=_},9231:function(t,e,n){function r(t){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r(t)}function i(){i=function(){return e};var t,e={},n=Object.prototype,o=n.hasOwnProperty,a=Object.defineProperty||function(t,e,n){t[e]=n.value},s="function"==typeof Symbol?Symbol:{},u=s.iterator||"@@iterator",c=s.asyncIterator||"@@asyncIterator",l=s.toStringTag||"@@toStringTag";function f(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{f({},"")}catch(t){f=function(t,e,n){return t[e]=n}}function h(t,e,n,r){var i=e&&e.prototype instanceof b?e:b,o=Object.create(i.prototype),s=new C(r||[]);return a(o,"_invoke",{value:O(t,n,s)}),o}function p(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}e.wrap=h;var d="suspendedStart",m="suspendedYield",y="executing",v="completed",g={};function b(){}function _(){}function x(){}var w={};f(w,u,(function(){return this}));var S=Object.getPrototypeOf,T=S&&S(S(N([])));T&&T!==n&&o.call(T,u)&&(w=T);var M=x.prototype=b.prototype=Object.create(w);function E(t){["next","throw","return"].forEach((function(e){f(t,e,(function(t){return this._invoke(e,t)}))}))}function A(t,e){function n(i,a,s,u){var c=p(t[i],t,a);if("throw"!==c.type){var l=c.arg,f=l.value;return f&&"object"==r(f)&&o.call(f,"__await")?e.resolve(f.__await).then((function(t){n("next",t,s,u)}),(function(t){n("throw",t,s,u)})):e.resolve(f).then((function(t){l.value=t,s(l)}),(function(t){return n("throw",t,s,u)}))}u(c.arg)}var i;a(this,"_invoke",{value:function(t,r){function o(){return new e((function(e,i){n(t,r,e,i)}))}return i=i?i.then(o,o):o()}})}function O(e,n,r){var i=d;return function(o,a){if(i===y)throw Error("Generator is already running");if(i===v){if("throw"===o)throw a;return{value:t,done:!0}}for(r.method=o,r.arg=a;;){var s=r.delegate;if(s){var u=P(s,r);if(u){if(u===g)continue;return u}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(i===d)throw i=v,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);i=y;var c=p(e,n,r);if("normal"===c.type){if(i=r.done?v:m,c.arg===g)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(i=v,r.method="throw",r.arg=c.arg)}}}function P(e,n){var r=n.method,i=e.iterator[r];if(i===t)return n.delegate=null,"throw"===r&&e.iterator.return&&(n.method="return",n.arg=t,P(e,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),g;var o=p(i,e.iterator,n.arg);if("throw"===o.type)return n.method="throw",n.arg=o.arg,n.delegate=null,g;var a=o.arg;return a?a.done?(n[e.resultName]=a.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,g):a:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,g)}function R(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function k(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function C(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(R,this),this.reset(!0)}function N(e){if(e||""===e){var n=e[u];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,a=function n(){for(;++i<e.length;)if(o.call(e,i))return n.value=e[i],n.done=!1,n;return n.value=t,n.done=!0,n};return a.next=a}}throw new TypeError(r(e)+" is not iterable")}return _.prototype=x,a(M,"constructor",{value:x,configurable:!0}),a(x,"constructor",{value:_,configurable:!0}),_.displayName=f(x,l,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===_||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,x):(t.__proto__=x,f(t,l,"GeneratorFunction")),t.prototype=Object.create(M),t},e.awrap=function(t){return{__await:t}},E(A.prototype),f(A.prototype,c,(function(){return this})),e.AsyncIterator=A,e.async=function(t,n,r,i,o){void 0===o&&(o=Promise);var a=new A(h(t,n,r,i),o);return e.isGeneratorFunction(n)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},E(M),f(M,l,"Generator"),f(M,u,(function(){return this})),f(M,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),n=[];for(var r in e)n.push(r);return n.reverse(),function t(){for(;n.length;){var r=n.pop();if(r in e)return t.value=r,t.done=!1,t}return t.done=!0,t}},e.values=N,C.prototype={constructor:C,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(k),!e)for(var n in this)"t"===n.charAt(0)&&o.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function r(r,i){return s.type="throw",s.arg=e,n.next=r,i&&(n.method="next",n.arg=t),!!i}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],s=a.completion;if("root"===a.tryLoc)return r("end");if(a.tryLoc<=this.prev){var u=o.call(a,"catchLoc"),c=o.call(a,"finallyLoc");if(u&&c){if(this.prev<a.catchLoc)return r(a.catchLoc,!0);if(this.prev<a.finallyLoc)return r(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return r(a.catchLoc,!0)}else{if(!c)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return r(a.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&o.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var i=r;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,g):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),g},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),k(n),g}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var i=r.arg;k(n)}return i}}throw Error("illegal catch attempt")},delegateYield:function(e,n,r){return this.delegate={iterator:N(e),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=t),g}},e}var o=this&&this.__createBinding||(Object.create?function(t,e,n,r){void 0===r&&(r=n);var i=Object.getOwnPropertyDescriptor(e,n);i&&!("get"in i?!e.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return e[n]}}),Object.defineProperty(t,r,i)}:function(t,e,n,r){void 0===r&&(r=n),t[r]=e[n]}),a=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),s=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)"default"!==n&&Object.prototype.hasOwnProperty.call(t,n)&&o(e,t,n);return a(e,t),e},u=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(i,o){function a(t){try{u(r.next(t))}catch(t){o(t)}}function s(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}u((r=r.apply(t,e||[])).next())}))},c=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.rainEffect=void 0;var l=s(n(7186)),f=c(n(6137)),h=c(n(6617)),p=n(337),d=s(n(985));e.rainEffect={rainInstance:null,effect:null,renderer:null,rainroot:null,init:function(){return u(void 0,void 0,void 0,i().mark((function t(){var n,r,o,a,s,u,c,m,y,v,g,b,_,x,w,S,T,M,E,A,O,P,R,k,C,N,L,j,I,B,U,D,F,z,V,G;return i().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return G=function(){var t=z.getDelta();v&&(v.rotation.y+=t),o.overrideMaterial=b,r.setRenderTarget(g),r.compute(P),o.overrideMaterial=null,r.setRenderTarget(null),r.render(o,m),e.rainEffect.renderer=r},t.next=3,f.default;case 3:n=t.sent,r=n.default?new n.default({antialias:!0}):new n({antialias:!0}),o=new l.Scene,(a=new l.DirectionalLight(16777215,.5)).castShadow=!0,a.position.set(3,17,17),a.castShadow=!0,a.shadow.camera.near=1,a.shadow.camera.far=50,a.shadow.camera.right=25,a.shadow.camera.left=-25,a.shadow.camera.top=25,a.shadow.camera.bottom=-25,a.shadow.mapSize.width=2048,a.shadow.mapSize.height=2048,a.shadow.bias=-.01,o.add(a),o.add(new l.AmbientLight(1118481)),s=window,u=s.innerWidth,c=s.innerHeight,(m=new l.PerspectiveCamera(90,u/c,.1,1e3)).position.set(-10.074560181298388,14.466112414201636,53.40889346998631),m.fov=60,m.lookAt(.2515703233662824,.09437871083420014,-.02421604359596542),y=5e3,v=null,(g=new l.RenderTarget(1024,1024)).texture.type=l.HalfFloatType,(b=new p.MeshBasicNodeMaterial).colorNode=p.positionWorld,_=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"vec3";return(0,p.storage)(new h.default(y,3),t,y)},x=_(),w=_(),S=_(),T=_(),M=(0,p.timerLocal)(),E=function(){return(0,p.uint)(16777215*Math.random())},A=(0,p.tslFn)((function(){var t=x.element(p.instanceIndex),e=w.element(p.instanceIndex),n=T.element(p.instanceIndex),r=p.instanceIndex.hash(),i=p.instanceIndex.add(E()).hash(),o=p.instanceIndex.add(E()).hash();t.x=r.mul(100).add(-50),t.y=i.mul(25),t.z=o.mul(100).add(-50),e.y=r.mul(-.04).add(-.2),n.x=1e3}))().compute(y),O=(0,p.tslFn)((function(){var t=function(t){return t.add(50).div(100)},e=x.element(p.instanceIndex),n=w.element(p.instanceIndex),r=S.element(p.instanceIndex),i=T.element(p.instanceIndex);e.addAssign(n),i.x=i.x.add((0,p.timerDelta)().mul(4));var o=(0,p.texture)(g.texture,t(e.xz)).y.add(.05);(0,p.If)(e.y.add(-.9).lessThan(o),(function(){e.y=25,r.xz=e.xz,r.y=o,i.x=1,e.x=p.instanceIndex.add(M).hash().mul(100).add(-50),e.z=p.instanceIndex.add(M.add(E())).hash().mul(100).add(-50)}));var a=(0,p.texture)(g.texture,t(r.xz)).y.add(.05);(0,p.If)(r.y.greaterThan(a),(function(){i.x=1e3}))})),P=O().compute(y),R=(0,p.tslFn)((function(){var t=x.toAttribute(),e=p.modelWorldMatrix.toVar();e[3][0]=t.x,e[3][1]=t.y,e[3][2]=t.z;var n=p.cameraViewMatrix.mul(e);return n[0][0]=1,n[0][1]=0,n[0][2]=0,n[2][0]=0,n[2][1]=0,n[2][2]=1,p.cameraProjectionMatrix.mul(n).mul(p.positionGeometry)})),(k=new p.MeshBasicNodeMaterial).colorNode=(0,p.uv)().distance((0,p.vec2)(.5,0)).oneMinus().mul(3).exp().mul(.1),k.vertexNode=R(),k.opacity=.2,k.side=l.DoubleSide,k.forceSinglePass=!0,k.depthWrite=!1,k.depthTest=!0,k.transparent=!0,(C=new l.Mesh(new l.PlaneGeometry(.1,2),k)).isInstancedMesh=!0,C.count=2500,o.add(C),N=T.element(p.instanceIndex).x,L=(0,p.tslFn)((function(){var t=(0,p.uv)().add((0,p.vec2)(-.5)).length().mul(7),e=N.sub(t);return e.min(1).sub(e.max(1).sub(1))})),(j=new p.MeshBasicNodeMaterial).colorNode=L(),j.positionNode=p.positionGeometry.add(S.toAttribute()),j.opacityNode=N.mul(.3).oneMinus().max(0).mul(.5),j.side=l.DoubleSide,j.forceSinglePass=!0,j.depthWrite=!1,j.depthTest=!0,j.transparent=!0,(I=new l.PlaneGeometry(2.5,2.5)).rotateX(-Math.PI/2),(B=new l.PlaneGeometry(1,2)).rotateY(-Math.PI/2),U=new l.PlaneGeometry(1,2),D=d.mergeGeometries([I,B,U]),(F=new l.Mesh(D,j)).isInstancedMesh=!0,F.count=2500,z=new l.Clock,r.setPixelRatio(window.devicePixelRatio),r.setSize(window.innerWidth,window.innerHeight),r.setAnimationLoop(G),(V=document.getElementById("rainroot")).appendChild(r.domElement),e.rainEffect.rainroot=V,r.compute(A);case 85:case"end":return t.stop()}}),t)})))},destroy:function(){e.rainEffect.renderer.clear(),e.rainEffect.renderer=null,document.getElementById("rainroot").innerHTML="",e.rainEffect.rainroot=null}}},3559:function(t,e,n){function r(t){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r(t)}function i(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,o(r.key),r)}}function o(t){var e=function(t,e){if("object"!=r(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var i=n.call(t,"string");if("object"!=r(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==r(e)?e:e+""}var a=this&&this.__createBinding||(Object.create?function(t,e,n,r){void 0===r&&(r=n);var i=Object.getOwnPropertyDescriptor(e,n);i&&!("get"in i?!e.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return e[n]}}),Object.defineProperty(t,r,i)}:function(t,e,n,r){void 0===r&&(r=n),t[r]=e[n]}),s=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),u=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)"default"!==n&&Object.prototype.hasOwnProperty.call(t,n)&&a(e,t,n);return s(e,t),e};Object.defineProperty(e,"__esModule",{value:!0}),e.Renderer=void 0;var c=u(n(7186)),l=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)},(e=[{key:"init",value:function(t){var e=t.clientHeight,n=t.clientWidth,r=new c.WebGLRenderer({antialias:!0,alpha:!0,powerPreference:"high-performance",preserveDrawingBuffer:!0,premultipliedAlpha:!1});r.setSize(n,e),r.setClearColor(new c.Color(0)),t.appendChild(r.domElement),r.shadowMap.enabled=!0,r.shadowMap.type=c.PCFSoftShadowMap,r.toneMappingExposure=.6,r.outputEncoding=c.sRGBEncoding,this._renderer=r,r=null}},{key:"destroy",value:function(){this._renderer.dispose(),this._renderer=null}},{key:"getRenderer",value:function(){return this._renderer}}])&&i(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();e.Renderer=l,e.default=new l},7770:function(t,e,n){function r(t){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r(t)}function i(t){return function(t){if(Array.isArray(t))return o(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return o(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?o(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function a(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,s(r.key),r)}}function s(t){var e=function(t,e){if("object"!=r(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var i=n.call(t,"string");if("object"!=r(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==r(e)?e:e+""}var u=this&&this.__createBinding||(Object.create?function(t,e,n,r){void 0===r&&(r=n);var i=Object.getOwnPropertyDescriptor(e,n);i&&!("get"in i?!e.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return e[n]}}),Object.defineProperty(t,r,i)}:function(t,e,n,r){void 0===r&&(r=n),t[r]=e[n]}),c=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),l=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)"default"!==n&&Object.prototype.hasOwnProperty.call(t,n)&&u(e,t,n);return c(e,t),e},f=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.Scene=void 0;var h=l(n(7186)),p=n(532),d=n(6397),m=f(n(3559)),y=n(4770),v=f(n(8198)),g=n(9231),b={},_=null,x=function(){return t=function t(){var e,n,r,o,a,s,u,c,l,f,x,w,S=this,T=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t);var M=[].concat(i(T||[]),i(d.stageList)),E=Math.round(Math.random()*(M.length-1));if(_){if(null===(n=window._currentHotDance)||void 0===n?void 0:n.stage){for(A=0;A<_.length;A++)b["mmd_".concat(A)]=null;for(_=null===(r=window._currentHotDance)||void 0===r?void 0:r.stage,A=0;A<_.length;A++)b["mmd_".concat(A)]=null}}else{_=(null===(e=window._currentHotDance)||void 0===e?void 0:e.stage)||M[E];for(var A=0;A<_.length;A++)b["mmd_".concat(A)]=null}this.scene=new h.Scene,this.scene.background=new h.Color("#AAAAAA");var O=new h.AmbientLight(11184810,4),P=new h.AmbientLight(16777215);this.scene.add(P),this.scene.add(O);var R=new h.DirectionalLight(16777215,.5);R.shadowMapHeight=500,R.shadowMapWidth=500,R.position.set(50,20,-3),R.castShadow=!0,R.shadow.camera.near=.01,R.shadow.camera.far=500,R.shadow.camera.right=30,R.shadow.camera.left=-30,R.shadow.camera.top=30,R.shadow.camera.bottom=-30,R.shadow.mapSize.width=500,R.shadow.mapSize.height=500,R.shadow.radius=4,R.shadow.bias=-6e-5,this.scene.add(R),setTimeout((function(){!function(){var t,e=.005,n=.7,r=2,i=180,o=(null===(t=m.default.getRenderer())||void 0===t||t.toneMappingExposure,new y.Sky);o.scale.setScalar(1e4),S.scene.add(o);var a=new h.Vector3,s=o.material.uniforms,u=h.MathUtils.degToRad(90-r),c=h.MathUtils.degToRad(i);(new Date).getHours()>18?(s.turbidity.value=0,s.rayleigh.value=.116,s.mieCoefficient.value=0,s.mieDirectionalG.value=0,u=h.MathUtils.degToRad(90),c=h.MathUtils.degToRad(-180)):(s.turbidity.value=10*Math.random(),s.rayleigh.value=2*Math.random(),s.mieCoefficient.value=e,s.mieDirectionalG.value=n),a.setFromSphericalCoords(1,u,c),s.sunPosition.value.copy(a)}()}),500);var k=new p.MMDLoader;for(A=0;A<_.length;A++)b["mmd_".concat(A)]&&this.scene.add(b["mmd_".concat(A)]),!b["mmd_".concat(A)]&&function(t){var e;k.load("https://all.franxxdaryl.site/dist/threeMMD"+(null===(e=_[A])||void 0===e?void 0:e[0]),(function(e){e.material.forEach((function(t){t.alphaToCoverage=!0})),e.position.set(0,-.5,0),S.scene.add(e),e.receiveShadow=!0,b["mmd_".concat(t)]=e,e=null}))}(A);g.rainEffect.rainroot&&g.rainEffect.destroy(),window._currentHotDance.name&&window._currentHotDance.needRain&&g.rainEffect.init(),!window._currentHotDance.name&&Math.round(1*Math.random())&&g.rainEffect.init();var C=new h.MeshPhongMaterial({color:8421504}),N=new h.PlaneGeometry(200,200),L=new h.Mesh(N,C);L.rotation.x=.5*-Math.PI;var j=null===(o=null==_?void 0:_[0])||void 0===o?void 0:o[0],I=v.default[j]||{};this.currentSpotLight=new h.SpotLight(I.color&&parseInt("0x".concat(I.color))||16777215,I.intensity||14),this.currentSpotLight.castShadow=!0,this.currentSpotLight.angle=null!==(a=I.angle)&&void 0!==a?a:.9,this.currentSpotLight.penumbra=null!==(s=I.penumbra)&&void 0!==s?s:1,this.currentSpotLight.decay=null!==(u=I.decay)&&void 0!==u?u:.5,this.currentSpotLight.distance=null!==(c=I.distance)&&void 0!==c?c:167,this.currentSpotLight.position.set(null!==(l=I.x)&&void 0!==l?l:0,null!==(f=I.y)&&void 0!==f?f:144,null!==(x=I.z)&&void 0!==x?x:4.5),this.currentSpotLight.shadow.focus=null!==(w=I.focus)&&void 0!==w?w:1,this.currentSpotLight.position.x,this.currentSpotLight.position.y,this.currentSpotLight.position.z,this.currentSpotLight.color.getHex(),this.currentSpotLight.intensity,this.currentSpotLight.distance,this.currentSpotLight.angle,this.currentSpotLight.penumbra,this.currentSpotLight.decay,this.currentSpotLight.shadow.focus,this.currentSpotLightHelper=new h.SpotLightHelper(this.currentSpotLight),L.receiveShadow=!0,L.position.set(0,-.05,0),v.default[j]&&this.scene.add(this.currentSpotLight),(new h.Layers).set(1),new h.MeshBasicMaterial({color:"black"}),k=null},(e=[{key:"destroyScene",value:function(){this.scene.children.forEach((function(t){var e,n,r,i;null===(n=null===(e=null==t?void 0:t.geometry)||void 0===e?void 0:e.dispose)||void 0===n||n.call(e),null===(i=null===(r=null==t?void 0:t.skeleton)||void 0===r?void 0:r.dispose)||void 0===i||i.call(r)})),this.scene=null,window.cancelAnimationFrame(this.stageLightFrame),window.clearInterval(this.stageLightTimeOut),this.stageScene=null,this.currentEffect=null,this.stageLightFrame=null,this.currentSpotLight=null,this.currentSpotLightHelper=null,this.stageLightTimeOut=null,g.rainEffect.rainroot&&g.rainEffect.destroy()}},{key:"getScene",value:function(){return this.scene}},{key:"getStageScene",value:function(){return this.stageScene}},{key:"init",value:function(t){}}])&&a(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();e.Scene=x},5713:(t,e,n)=>{n.r(e),n.d(e,{default:()=>y});var r=n(1486),i=n.n(r),o=(n(1418),n(1250)),a=n.n(o),s=(n(3303),n(2089)),u=n(6397),c=n(4127);function l(t){return l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},l(t)}function f(){f=function(){return e};var t,e={},n=Object.prototype,r=n.hasOwnProperty,i=Object.defineProperty||function(t,e,n){t[e]=n.value},o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",s=o.asyncIterator||"@@asyncIterator",u=o.toStringTag||"@@toStringTag";function c(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{c({},"")}catch(t){c=function(t,e,n){return t[e]=n}}function h(t,e,n,r){var o=e&&e.prototype instanceof b?e:b,a=Object.create(o.prototype),s=new C(r||[]);return i(a,"_invoke",{value:O(t,n,s)}),a}function p(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}e.wrap=h;var d="suspendedStart",m="suspendedYield",y="executing",v="completed",g={};function b(){}function _(){}function x(){}var w={};c(w,a,(function(){return this}));var S=Object.getPrototypeOf,T=S&&S(S(N([])));T&&T!==n&&r.call(T,a)&&(w=T);var M=x.prototype=b.prototype=Object.create(w);function E(t){["next","throw","return"].forEach((function(e){c(t,e,(function(t){return this._invoke(e,t)}))}))}function A(t,e){function n(i,o,a,s){var u=p(t[i],t,o);if("throw"!==u.type){var c=u.arg,f=c.value;return f&&"object"==l(f)&&r.call(f,"__await")?e.resolve(f.__await).then((function(t){n("next",t,a,s)}),(function(t){n("throw",t,a,s)})):e.resolve(f).then((function(t){c.value=t,a(c)}),(function(t){return n("throw",t,a,s)}))}s(u.arg)}var o;i(this,"_invoke",{value:function(t,r){function i(){return new e((function(e,i){n(t,r,e,i)}))}return o=o?o.then(i,i):i()}})}function O(e,n,r){var i=d;return function(o,a){if(i===y)throw Error("Generator is already running");if(i===v){if("throw"===o)throw a;return{value:t,done:!0}}for(r.method=o,r.arg=a;;){var s=r.delegate;if(s){var u=P(s,r);if(u){if(u===g)continue;return u}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(i===d)throw i=v,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);i=y;var c=p(e,n,r);if("normal"===c.type){if(i=r.done?v:m,c.arg===g)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(i=v,r.method="throw",r.arg=c.arg)}}}function P(e,n){var r=n.method,i=e.iterator[r];if(i===t)return n.delegate=null,"throw"===r&&e.iterator.return&&(n.method="return",n.arg=t,P(e,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),g;var o=p(i,e.iterator,n.arg);if("throw"===o.type)return n.method="throw",n.arg=o.arg,n.delegate=null,g;var a=o.arg;return a?a.done?(n[e.resultName]=a.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,g):a:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,g)}function R(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function k(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function C(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(R,this),this.reset(!0)}function N(e){if(e||""===e){var n=e[a];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,o=function n(){for(;++i<e.length;)if(r.call(e,i))return n.value=e[i],n.done=!1,n;return n.value=t,n.done=!0,n};return o.next=o}}throw new TypeError(l(e)+" is not iterable")}return _.prototype=x,i(M,"constructor",{value:x,configurable:!0}),i(x,"constructor",{value:_,configurable:!0}),_.displayName=c(x,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===_||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,x):(t.__proto__=x,c(t,u,"GeneratorFunction")),t.prototype=Object.create(M),t},e.awrap=function(t){return{__await:t}},E(A.prototype),c(A.prototype,s,(function(){return this})),e.AsyncIterator=A,e.async=function(t,n,r,i,o){void 0===o&&(o=Promise);var a=new A(h(t,n,r,i),o);return e.isGeneratorFunction(n)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},E(M),c(M,u,"Generator"),c(M,a,(function(){return this})),c(M,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),n=[];for(var r in e)n.push(r);return n.reverse(),function t(){for(;n.length;){var r=n.pop();if(r in e)return t.value=r,t.done=!1,t}return t.done=!0,t}},e.values=N,C.prototype={constructor:C,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(k),!e)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function i(r,i){return s.type="throw",s.arg=e,n.next=r,i&&(n.method="next",n.arg=t),!!i}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],s=a.completion;if("root"===a.tryLoc)return i("end");if(a.tryLoc<=this.prev){var u=r.call(a,"catchLoc"),c=r.call(a,"finallyLoc");if(u&&c){if(this.prev<a.catchLoc)return i(a.catchLoc,!0);if(this.prev<a.finallyLoc)return i(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return i(a.catchLoc,!0)}else{if(!c)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return i(a.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=t,a.arg=e,o?(this.method="next",this.next=o.finallyLoc,g):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),g},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),k(n),g}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var i=r.arg;k(n)}return i}}throw Error("illegal catch attempt")},delegateYield:function(e,n,r){return this.delegate={iterator:N(e),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=t),g}},e}function h(t,e,n,r,i,o,a){try{var s=t[o](a),u=s.value}catch(t){return void n(t)}s.done?e(u):Promise.resolve(u).then(r,i)}function p(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,i,o,a,s=[],u=!0,c=!1;try{if(o=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=o.call(n)).done)&&(s.push(r.value),s.length!==e);u=!0);}catch(t){c=!0,i=t}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw i}}return s}}(t,e)||function(t,e){if(t){if("string"==typeof t)return d(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?d(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function d(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function m(t){window.React3=i();var e=(0,r.useRef)(null),n=p((0,r.useState)(!1),2),o=n[0],l=n[1],d=p((0,r.useState)(!1),2),m=d[0],y=d[1],v=p((0,r.useState)(!1),2),g=v[0],b=v[1],_=p((0,r.useState)(!1),2),x=_[0],w=_[1],S=(0,r.useCallback)((function(){b(!1),w(!0)}),[]);(0,r.useEffect)((function(){if(setTimeout((function(){}),3e3),t.show){document.getElementById("mikaScreen").setAttribute("class","");try{var n=document.createElement("canvas").getContext("webgl"),r=n.getExtension("WEBGL_debug_renderer_info"),i={brand:n.getParameter(r.UNMASKED_VENDOR_WEBGL),type:n.getParameter(r.UNMASKED_RENDERER_WEBGL)};c.A.post("https://franxxdaryl.site:1919/mikadisplayinfo",i).then(function(){var t,e=(t=f().mark((function t(e){return f().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,c.A.request({method:"GET",headers:{"Content-Type":"application/json;charset=utf-8"},url:"https://franxxdaryl.site/displayInfo.json?"+(new Date).getTime()});case 3:t.next=8;break;case 5:t.prev=5,t.t0=t.catch(0),console.log(t.t0);case 8:case"end":return t.stop()}}),t,null,[[0,5]])})),function(){var e=this,n=arguments;return new Promise((function(r,i){var o=t.apply(e,n);function a(t){h(o,r,i,a,s,"next",t)}function s(t){h(o,r,i,a,s,"throw",t)}a(void 0)}))});return function(t){return e.apply(this,arguments)}}())}catch(t){console.log(t)}window._currentHotDance={},setTimeout((function(){e.current=new(a())(!0,!1,S)}),500),l(t.show)}}),[t.show]);var T=(0,r.useCallback)((function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];!0!==window._animateNeedPause&&(g||(document.getElementById("mikaScreen").setAttribute("class",""),e.current.destroy(),e.current=null,window._currentHotDance=t?window._currentHotDance:{},e.current=new(a())(!1,!0,S,t),w(!1)),b(!0))}),[e,g]),M=(0,r.useCallback)((function(){window._currentHotDance={},e.current.destroy(),e.current.reloadAmmo().then((function(t){}));var n=t.onClose;null==n||n(),e.current=null,b(!1),w(!1),y(!0),setTimeout((function(){l(!1),y(!1)}),500)}),[e,g]),E=u.recommandList;return i().createElement("div",{className:"mikaRoot ".concat(o?"inShow":"hide"," ").concat(m?"inHide":"")},i().createElement("div",{id:"mikaStage"}),i().createElement("div",{id:"rainroot"}),x&&i().createElement("div",{id:"breakScreen"},i().createElement("div",{className:"breakTitle"},"ミミ◦❧◦°˚°◦.¸¸◦°´❤*•.¸♥ 表演结束力。。。 ♥¸.•*❤´°◦¸¸.◦°˚°◦☙◦彡彡"),i().createElement("div",{className:"breakStep"},"♫♪♩·.¸¸.·♩♪♫ ❝𝚜𝚎𝚗𝚜𝚎𝚒❞还可以: ♫♪♩·.¸¸.·♩♪♫"),i().createElement("div",{className:"breakContent"},i().createElement("div",{className:"breakItem",onClick:function(){T(!0)}},"重播",i().createElement("img",{src:s.U6})),i().createElement("div",{className:"breakItem",onClick:function(){T(!1)}},"下一个",i().createElement("img",{src:s.oh}))),i().createElement("div",{className:"topList"},i().createElement("div",{className:"topTitle"},"▓▒░ 个人推荐 ░▒▓"),i().createElement("div",{className:"topContent"},E.map((function(t){return i().createElement("div",{key:t.name,onClick:function(e){var n;n=t,window._currentHotDance=n,T(!0)}},i().createElement("span",null,t.name," —— ",t.actor))}))))),i().createElement("div",{id:"mikaScreen",style:{"background-color":"rgb(44 42 42)",backgroundImage:"url('https://all.franxxdaryl.site/dist/snow.gif')"}},g?i().createElement(i().Fragment,null,i().createElement("span",{style:{"--i":"0"}},"再"),i().createElement("span",{style:{"--i":"1"}},"稍"),i().createElement("span",{style:{"--i":"2"}},"等"),i().createElement("span",{style:{"--i":"3"}},"下"),i().createElement("span",{style:{"--i":"4"}},"..."),i().createElement("span",{style:{"--i":"5"}},"大"),i().createElement("span",{style:{"--i":"6"}},"的"),i().createElement("span",{style:{"--i":"7"}},"要"),i().createElement("span",{style:{"--i":"8"}},"来"),i().createElement("span",{style:{"--i":"9"}},"力"),i().createElement("span",{style:{"--i":"10"}},"~⭐"),i().createElement("div",{className:"actionInfo"},i().createElement("div",{className:"actionTitle"},"٭⊹¤.•⨳•.*☆✬ 借物表 ✬☆*.•⨳•.¤⊹٭"),i().createElement("div",{className:"actionContent"},i().createElement("div",{className:"actionTopic"},"人物模型:")," ",i().createElement("div",{id:"actionInfoModel"})),i().createElement("div",{className:"actionContent"},i().createElement("div",{className:"actionTopic"},"动作配布:")," ",i().createElement("div",{id:"actionInfoMusic"})),i().createElement("div",{className:"actionContent"},i().createElement("div",{className:"actionTopic"},"音乐:")," ",i().createElement("div",{id:"actionInfoMotion"})),i().createElement("div",{className:"actionContent"},i().createElement("div",{className:"actionTopic"},"场景配布:")," ",i().createElement("div",{id:"actionInfoStage"})))):i().createElement(i().Fragment,null,i().createElement("span",{style:{"--i":"1"}},"节"),i().createElement("span",{style:{"--i":"2"}},"目"),i().createElement("span",{style:{"--i":"3"}},"准"),i().createElement("span",{style:{"--i":"4"}},"备"),i().createElement("span",{style:{"--i":"5"}},"中"),i().createElement("span",{style:{"--i":"6"}},"..."),i().createElement("span",{style:{"--i":"7"}},"马"),i().createElement("span",{style:{"--i":"8"}},"上"),i().createElement("span",{style:{"--i":"9"}},"回"),i().createElement("span",{style:{"--i":"10"}},"来"),i().createElement("span",{style:{"--i":"11"}},"~⭐"))),i().createElement("div",{id:"mikaStageShell"}),i().createElement("span",{id:"mikaLogo"},"ᗰIKᗩ Tᐯ",i().createElement("div",{className:"mikaSwiss"})),i().createElement("span",{id:"mikaButton",className:"".concat(g?"playing":"pending"),onClick:function(){T(!1)}},!g&&i().createElement("span",{className:"mikatootip hide"},"▓▒░ 点击这里观看随机𝗺𝗺𝗱编舞~ ░▒▓"),i().createElement("img",{src:"https://all.franxxdaryl.site/dist/play.png"})),i().createElement("img",{id:"mikaRing",onClick:M,src:"https://all.franxxdaryl.site/dist/ring.png"}))}window._initMikaTV_=function(t,e,n){window.React2=e,console.log(window.React2===window.React3);var r=e.createElement(m,{show:!0},"");n.render(r,t)};const y=m},6397:(t,e,n)=>{function r(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}n.r(e),n.d(e,{actionList:()=>o,characterList:()=>s,pendingList:()=>a,recommandList:()=>c,stageList:()=>u});var i,o=[{music:"/move/wavefile_short.mp3",move:"/move/wavefile_v2.vmd",camera:"/move/wavefile_camera.vmd"},{music:"/extraUpload/motion/idol/idol.wav",move:"/extraUpload/motion/idol/Motion.vmd",camera:"/extraUpload/motion/idol/Camera.vmd"},{music:"/move/celebrate.wav",move:"/move/celebrate-move.vmd",camera:"/move/celebrate-camera.vmd"},{music:"/move/batterup.wav",move:"/move/batterup_IK_all.vmd",camera:"/move/batterup_cam.vmd"},{music:"/move/New_dance.wav",move:"/move/New_dance_All.vmd",camera:"/move/New_dance_Cam.vmd"},{music:"/move/pubg.wav",move:"/move/pubg.vmd",camera:"/move/box-cam.vmd"},{music:"/move/wtf.wav",move:"/move/wtf-mot.vmd",camera:"/move/wtf-cam.vmd"},{music:"/move/produce101_dance.wav",move:"/move/produce101_dance.vmd",camera:"/move/box-cam.vmd"},{music:"/move/loli.wav",move:"/move/loli.vmd",camera:"/move/box-cam.vmd"},{music:"/move/quee_bgm.wav",move:"/move/quee_mid.vmd",moveLeft:"/move/quee_left.vmd",moveRight:"/move/quee_right.vmd",camera:"/move/quee_camera.vmd"},{music:"/move/谁逃得过强风大背头.wav",move:"/move/dabeitou/ver1.vmd",moveLeft:"/move/dabeitou/ver2.vmd",moveRight:"/move/dabeitou/ver2.vmd",camera:"/move/box-cam.vmd"},{music:"/move/meetoo.wav",move:"/move/meetoo_motion.vmd",camera:"/move/meetoo_cam.vmd"},{music:"/move/hitandrun.mp3",move:"/move/hitandrun_mot.vmd",camera:"/move/hitandrun_cam.vmd"},{needRugular:!0,music:"/move/弹指醉.wav",move:"/move/弹指醉.vmd",camera:"/move/弹指醉_cam.vmd"},{music:"/move/倾杯.mp3",move:"/move/qingbei-mov.vmd",camera:"/move/qingbei-cam.vmd"},{music:"/move/senorita.mp3",move:"/move/senorita-motion.vmd",camera:"/move/senorita-cam.vmd"},{music:"/move/病名为爱.wav",move:"/move/病名为爱-mov.vmd",camera:"/move/病名为爱-cam.vmd"},{music:"/move/还是你的笑容最可爱.wav",move:"/move/你的笑容动作.vmd",camera:"/move/punch-camera.vmd"},{music:"/move/huahuo.mp3",move:"/move/huahuo-mov.vmd",camera:"/move/huahuo-cam.vmd"},{music:"/move/月下舞姬.wav",move:"/move/月下舞姬.vmd",camera:"/move/wtf-cam.vmd"},{music:"/move/醉花阴.mp3",move:"/move/醉花阴-mov.vmd",camera:"/move/醉花阴-cam.vmd"},{music:"/move/omg.mp3",move:"/move/omg.vmd",camera:"/move/box-cam.vmd"},{music:"/move/nevergona.mp3",move:"/move/nevergona_mov.vmd",camera:"/move/nevergona_cam.vmd"},{music:"/move/goodtime.mp3",move:"/move/goodtime_mov.vmd",camera:"/move/goodtime_cam.vmd"},{music:"/move/甜肚舞.wav",move:"/move/甜肚舞-mov.vmd",camera:"/move/甜肚舞-cam.vmd"},{music:"/move/可爱摇.mp3",move:"/move/可爱摇.vmd",camera:"/move/box-cam.vmd"},{music:"/move/CH4NGE.wav",move:["/move/CH4NGE_motion1.vmd","/move/CH4NGE_lips1.vmd"],moveLeft:["/move/CH4NGE_motion2.vmd","/move/CH4NGE_lips2.vmd"],moveRight:["/move/CH4NGE_motion3.vmd","/move/CH4NGE_lips3.vmd"],camera:"/move/box-cam.vmd"},{music:"/move/Innocent.wav",move:"/move/Innocent-mov.vmd",camera:"/move/Innocent-cam.vmd"},{music:"/move/twinkle.wav",move:"/move/twinkle_mov.vmd",camera:"/move/twinkle_cam.vmd"},{music:"/move/lol.wav",move:["/move/lol-dance.vmd","/move/lol-face.vmd"],camera:"/move/lol-cam.vmd"},{music:"/move/wow.wav",move:"/move/wow.vmd",camera:"/move/box-cam.vmd"},{music:"/move/yellow.wav",move:"/move/yellow.vmd",camera:"/move/yellow-cam.vmd"},{music:"/move/Infinity.wav",move:"/move/Infinity-mov1.vmd",moveLeft:"/move/Infinity-mov2.vmd",moveRight:"/move/Infinity-mov3.vmd",camera:"/move/Infinity-cam.vmd"},{music:"/move/MitsuloveChan.wav",move:"/move/MitsuloveChan.vmd",camera:"/move/MitsuloveChan-cam.vmd"},{music:"/move/bonbon.wav",move:"/move/bonbon1.vmd",moveLeft:"/move/bonbon2.vmd",moveRight:"/move/bonbon3.vmd",camera:"/move/bonbon-cam.vmd"},{music:"/move/someone.wav",move:"/move/someone.vmd",camera:"/move/someone-cam.vmd"},{music:"/move/symphony.wav",move:"/move/symphony.vmd",camera:"/move/symphony-cam.vmd"},{music:"/move/toxic.wav",move:"/move/toxic.vmd",camera:"/move/toxic-cam.vmd"},{music:"/move/niconiconi.wav",move:"/move/niconico.vmd",camera:"/move/niconico-cam.vmd"},{music:"/move/dna/WAV.wav",move:"/move/dna/Motion.vmd",camera:"/move/dna/Camera.vmd"},{music:"/move/doubt/W.A.V.wav",move:"/move/doubt/M.O.T.I.O.N.vmd",camera:"/move/doubt/C.A.M.E.R.A.vmd"},{music:"/move/tellingme/tellme.wav",move:"/move/tellingme/motion.vmd",camera:"/move/tellingme/cameraout.vmd"},{music:"/move/flyaway.mp3",move:"/move/flyaway.vmd",camera:"/move/flyaway-cam.vmd"},{music:"/move/sotheysay/WAV.wav",move:"/move/sotheysay/Motion.vmd",camera:"/move/sotheysay/Camera.vmd"},{music:"/move/rabbithole/rabbithole.mp3",move:"/move/rabbithole/rabbit2-mov.vmd",camera:"/move/rabbithole/rabbit2-cam.vmd"},{music:"/move/darlingdance/darling2.mp3",move:"/move/darlingdance/motion.vmd",camera:"/move/darlingdance/cam.vmd"},{music:"/move/rabbithole2/rabbithole.mp3",move:"/move/rabbithole2/rabbit_mov.vmd",camera:"/move/rabbithole2/rabbit_camera.vmd"},{music:"/move/stayTonight.mp3",move:"/move/staytonight-dance.vmd",camera:"/move/staytonight-camera.vmd"},{music:"/move/jilejingtu2.mp3",move:"/move/jilejingtu.vmd",camera:"/move/jilejingtu_cam.vmd"},{music:"/extraUpload/motion/ぶれないアイでMotion/ぶれないアイで.wav",move:"/extraUpload/motion/ぶれないアイでMotion/Tdaぶれないアイで.vmd",camera:"/extraUpload/motion/ぶれないアイでMotion/TdaぶれないアイCAMERA.vmd"},{music:"/extraUpload/motion/PatchworkStaccato-ZKArti/PatchworkStaccato-Hyurno.wav",move:"/extraUpload/motion/PatchworkStaccato-ZKArti/Singer.vmd",camera:"/extraUpload/motion/PatchworkStaccato-ZKArti/Camera.vmd"},{music:"/extraUpload/motion/Havana/CamillaCabelloHavana.wav",move:["/extraUpload/motion/Havana/HavanaLips.vmd","/extraUpload/motion/Havana/HavanaMotion.vmd"],camera:"/extraUpload/motion/Havana/HavanaCamera.vmd"},{music:"/extraUpload/motion/Madness/MADNESS.wav",move:"/extraUpload/motion/Madness/Motion(Center).vmd",moveLeft:"/extraUpload/motion/Madness/Motion(Left).vmd",moveRight:"/extraUpload/motion/Madness/Motion(Right).vmd",camera:"/extraUpload/motion/Madness/Camera.vmd"},{music:"/extraUpload/motion/Lithium/Wav.wav",move:"/extraUpload/motion/Lithium/Motionowo.vmd",camera:"/extraUpload/motion/Lithium/Camera.vmd"},{music:"/extraUpload/motion/CryBaby/CryBaby.wav",move:["/extraUpload/motion/CryBaby/Singer.vmd","/extraUpload/motion/CryBaby/Facials.vmd"],camera:"/extraUpload/motion/CryBaby/Camera.vmd"},{music:"/extraUpload/motion/PityParty/PityParty.wav",move:["/extraUpload/motion/PityParty/Singer.vmd","/extraUpload/motion/CryBaby/Facials.vmd"],camera:"/extraUpload/motion/PityParty/Camera.vmd"},{music:"/extraUpload/motion/YoureIt/TagYoureIt.wav",move:["/extraUpload/motion/YoureIt/Singer_1.vmd","/extraUpload/motion/YoureIt/Facials.vmd"],moveLeft:"/extraUpload/motion/YoureIt/Singer_2.vmd",moveRight:"/extraUpload/motion/YoureIt/Singer_2.vmd",camera:"/extraUpload/motion/YoureIt/Camera_1.vmd"},{music:"/extraUpload/motion/PRODUCE48/PRODUCE48.wav",move:["/extraUpload/motion/PRODUCE48/motion.vmd","/extraUpload/motion/PRODUCE48/facial+lip.vmd"],camera:"/extraUpload/motion/PRODUCE48/box-cam.vmd"},{music:"/extraUpload/motion/TheZombieSong/zombiesong.wav",move:"/extraUpload/motion/TheZombieSong/Zambies.vmd",camera:"/extraUpload/motion/TheZombieSong/cam.vmd"},{music:"/extraUpload/motion/Paranoia-ZKArti/Paranoia.wav",move:"/extraUpload/motion/Paranoia-ZKArti/Singer.vmd",camera:"/extraUpload/motion/Paranoia-ZKArti/Camera.vmd"},{music:"/extraUpload/motion/TheZombieSongFull/TheZombieSong.wav",move:"/extraUpload/motion/TheZombieSongFull/Miku.vmd",moveLeft:"/extraUpload/motion/TheZombieSongFull/Rin.vmd",moveRight:"/extraUpload/motion/TheZombieSongFull/Rin.vmd",camera:"/extraUpload/motion/TheZombieSongFull/Camera.vmd"},{music:"/extraUpload/motion/ALLeyesonme/allayesonme.wav",move:["/extraUpload/motion/ALLeyesonme/Blankout.vmd","/extraUpload/motion/ALLeyesonme/Blank.vmd"],moveLeft:["/extraUpload/motion/ALLeyesonme/Blankout.vmd","/extraUpload/motion/ALLeyesonme/Blank.vmd"],moveRight:["/extraUpload/motion/ALLeyesonme/Blankout.vmd","/extraUpload/motion/ALLeyesonme/Blank.vmd"],camera:"/extraUpload/motion/ALLeyesonme/camara.vmd"},{music:"/extraUpload/motion/BeginAgain/Beginagain.wav",move:"/extraUpload/motion/BeginAgain/Motion.vmd",camera:"/extraUpload/motion/BeginAgain/camera.vmd"},{music:"/extraUpload/motion/cake/Cake.wav",move:"/extraUpload/motion/cake/SINGER.vmd",camera:"/extraUpload/motion/cake/CAMERA.vmd"},{music:"/extraUpload/motion/Hushh_AViVA/HUSHH.wav",move:"/extraUpload/motion/Hushh_AViVA/MainMotion.vmd",moveRight:"/extraUpload/motion/Hushh_AViVA/Ghost2.vmd",moveLeft:"/extraUpload/motion/Hushh_AViVA/Ghost1.vmd",camera:"/extraUpload/motion/Hushh_AViVA/Camera.vmd"},{music:"/extraUpload/motion/Sixfeetunder/Thissong.wav",move:"/extraUpload/motion/Sixfeetunder/Girlmotion.vmd",moveRight:"/extraUpload/motion/Sixfeetunder/Boymotion.vmd",moveLeft:"/extraUpload/motion/Sixfeetunder/Boymotion.vmd",camera:"/extraUpload/motion/Sixfeetunder/Camera.vmd"},{music:"/extraUpload/motion/HistoryMaker/WAV.wav",move:"/extraUpload/motion/HistoryMaker/Motion.vmd",camera:"/extraUpload/motion/HistoryMaker/Camera.vmd"},{music:"/extraUpload/motion/Lovemelovemeloveme/aishite.wav",move:"/extraUpload/motion/Lovemelovemeloveme/mov.vmd",camera:"/extraUpload/motion/Lovemelovemeloveme/cam.vmd"},{music:"/extraUpload/motion/Dontstopmeme/DONTSTOPmeme.wav",move:"/extraUpload/motion/Dontstopmeme/Motion1.vmd",moveLeft:"/extraUpload/motion/Dontstopmeme/Motion1.vmd",moveRight:"/extraUpload/motion/Dontstopmeme/Motion2.vmd",camera:"/extraUpload/motion/Dontstopmeme/Camera.vmd"},{music:"/extraUpload/motion/DONTMIND/DONTMIND.wav",move:"/extraUpload/motion/DONTMIND/MOTION.vmd",camera:"/extraUpload/motion/DONTMIND/CAMERA.vmd"},{music:"/extraUpload/motion/TWICE/TWICE.wav",move:["/extraUpload/motion/TWICE/motion.vmd","/extraUpload/motion/TWICE/Facial.vmd"],camera:"/extraUpload/motion/PRODUCE48/box-cam.vmd"},{music:"/extraUpload/motion/BBOOM/BBOOM.wav",move:"/extraUpload/motion/BBOOM/MOTION.vmd",camera:"/extraUpload/motion/BBOOM/CAMout.vmd"},{music:"/extraUpload/motion/Asphyxiate/wav.wav",move:"/extraUpload/motion/Asphyxiate/motion.vmd",camera:"/extraUpload/motion/Asphyxiate/camera.vmd"},{music:"/extraUpload/motion/just_do_it/dreams.wav",move:"/extraUpload/motion/just_do_it/mot.vmd",camera:"/extraUpload/motion/PRODUCE48/box-cam.vmd"},{music:"/extraUpload/motion/SAYONARA/SAYONARA.wav",move:["/extraUpload/motion/SAYONARA/MOTION.vmd","/extraUpload/motion/SAYONARA/focus.vmd"],camera:"/extraUpload/motion/SAYONARA/CAMERA.vmd"},{music:"/extraUpload/motion/Umbrella/Umbrell.wav",move:"/extraUpload/motion/Umbrella/miku.vmd",camera:"/extraUpload/motion/Umbrella/camera.vmd"},{music:"/extraUpload/motion/CountingSheep/CountingSheep.wav",move:"/extraUpload/motion/CountingSheep/Motion.vmd",camera:"/extraUpload/motion/CountingSheep/Camera.vmd"},{music:"/extraUpload/motion/SaveMe/SaveMe.wav",move:"/extraUpload/motion/SaveMe/Jimin.vmd",moveRight:"/extraUpload/motion/SaveMe/Jungkook.vmd",moveLeft:"/extraUpload/motion/SaveMe/RapMon.vmd",camera:"/extraUpload/motion/SaveMe/C.vmd"},{music:"/extraUpload/motion/triller/triller.mp3",move:"/extraUpload/motion/triller/MOTION/dance1.vmd",moveRight:"/extraUpload/motion/triller/MOTION/dance3.vmd",moveLeft:"/extraUpload/motion/triller/MOTION/dance2.vmd",camera:"/extraUpload/motion/triller/MOTION/camera.vmd"},{music:"/extraUpload/motion/太陽系デスコ/太陽系デスコ.wav",move:"/extraUpload/motion/太陽系デスコ/太陽系デスコRIGHT.vmd",moveRight:"/extraUpload/motion/太陽系デスコ/太陽系デスコLEFT.vmd",moveLeft:"/extraUpload/motion/太陽系デスコ/太陽系デスコLEFT.vmd",camera:"/extraUpload/motion/太陽系デスコ/camera.vmd"},{music:"/extraUpload/motion/AiNoUta/ainouta.mp3",move:"/extraUpload/motion/AiNoUta/mov.vmd",camera:"/extraUpload/motion/AiNoUta/cam.vmd"},{music:"/extraUpload/motion/changeme/changeme.wav",move:"/extraUpload/motion/changeme/mov.vmd",camera:"/extraUpload/motion/changeme/cam.vmd"},{music:"/extraUpload/motion/changeMeMeiko/changeme.mp3",move:"/extraUpload/motion/changeMeMeiko/motion.vmd",camera:"/extraUpload/motion/changeMeMeiko/cam.vmd"},{music:"/extraUpload/motion/Me!Me!Me!/mememe3.mp3",move:"/extraUpload/motion/Me!Me!Me!/mememe.vmd",camera:"/extraUpload/motion/Me!Me!Me!/camera.vmd"},{music:"/extraUpload/motion/FlipFlop/FlipFlop.wav",move:"/extraUpload/motion/FlipFlop/Motion.vmd",camera:"/extraUpload/motion/FlipFlop/cam.vmd"},{music:"/extraUpload/motion/GimmeMore/GimmeMore.wav",move:"/extraUpload/motion/GimmeMore/Motion.vmd",moveRight:"/extraUpload/motion/GimmeMore/Motion2.vmd",moveLeft:"/extraUpload/motion/GimmeMore/Motion2.vmd",camera:"/extraUpload/motion/GimmeMore/Camera.vmd"},{music:"/extraUpload/motion/GimmeGimme/gimme.mp3",move:"/extraUpload/motion/GimmeGimme/mov.vmd",camera:"/extraUpload/motion/FlipFlop/cam.vmd"},{music:"/extraUpload/motion/rabbitDance/rabbitDance.wav",move:"/extraUpload/motion/rabbitDance/Motion.vmd",camera:"/extraUpload/motion/rabbitDance/Camera.vmd"},{needMikus:!0,music:"/extraUpload/motion/lovenwantit/BGM.wav",move:"/extraUpload/motion/lovenwantit/motion.vmd",camera:"/extraUpload/motion/shinede/camera.vmd"},{needMikus:!0,music:"/extraUpload/motion/dreamscometrue/BGM.wav",move:"/extraUpload/motion/dreamscometrue/motion.vmd",camera:"/extraUpload/motion/shinede/camera.vmd"},{needMikus:!0,music:"/extraUpload/motion/kawaiinei/BGM.wav",move:"/extraUpload/motion/kawaiinei/motion.vmd",camera:"/extraUpload/motion/shinede/camera.vmd"},{needRugular:!0,music:"/extraUpload/motion/shinede/BGM.wav",move:"/extraUpload/motion/shinede/motionYYB.vmd",camera:"/extraUpload/motion/shinede/camera.vmd"}],a=[{music:"/move/wavefile_short.mp3",move:"/move/punch-move.vmd",camera:"/move/punch-camera.vmd"},{music:"/move/wavefile_short.mp3",move:"/move/yuzu.vmd",camera:"/move/box-cam.vmd"},{music:"/move/wavefile_short.mp3",move:"/move/zaku-move.vmd",camera:"/move/zaku-camera.vmd"},{music:"/move/wavefile_short.mp3",move:"/move/shy-move.vmd",camera:"/move/box-cam.vmd"},{music:"/move/wavefile_short.mp3",move:"/move/爱言叶II.vmd",camera:"/move/box-cam.vmd"},{music:"/move/wavefile_short.mp3",move:"/move/laysport.vmd",camera:"/move/box-cam.vmd"},{music:"/move/wavefile_short.mp3",move:"/move/box-move.vmd",camera:"/move/box-cam.vmd"},{music:"/move/wavefile_short.mp3",move:"/move/kaqitorite.vmd",camera:"/move/box-cam.vmd"},{music:"/move/wavefile_short.mp3",move:"/move/headshot.vmd",camera:"/move/box-cam.vmd"},{music:"/move/wavefile_short.mp3",move:"/move/butterfly.vmd",camera:"/move/box-cam.vmd"},{music:"/move/wavefile_short.mp3",move:"/move/pendingMt/NPCDance.vmd",camera:"/move/box-cam.vmd"},{music:"/move/wavefile_short.mp3",move:"/move/pendingMt/omg.vmd",camera:"/move/box-cam.vmd"},{music:"/move/wavefile_short.mp3",move:"/move/pendingMt/yaoyaole.vmd",camera:"/move/box-cam.vmd"},{music:"/move/wavefile_short.mp3",move:"/move/pendingMt/pipa.vmd",camera:"/move/box-cam.vmd"},{music:"/move/wavefile_short.mp3",move:"/move/pendingMt/qiuqiu.vmd",camera:"/move/box-cam.vmd"},{music:"/move/wavefile_short.mp3",move:"/move/longpunch.vmd",camera:"/move/box-cam.vmd"}].concat(function(t){if(Array.isArray(t))return r(t)}(i=Array.from(new Array(109)).map((function(t,e){return{music:"/move/wavefile_short.mp3",move:"/move/pengingdpack/".concat(e+1,".vmd"),camera:"/move/box-cam.vmd"}})))||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(i)||function(t,e){if(t){if("string"==typeof t)return r(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r(t,e):void 0}}(i)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),s=["/mod/mika_ver1.1.pmx","/mod/mika_light_ver1.1.pmx","/kisaki/kisaki.pmx","/aru/Aru_1.0/aru2.pmx","/arona/Arona_1.01.pmx","/kokona/kokona.pmx","/mari/mari.pmx"],u=[[["/stage/主体.pmx"],["/stage/家具.pmx"],["/stage/吊饰.pmx"],["/stage/外院.pmx"]],[["/stage2/场景.pmx"]],[["/stage3/神女劈观.pmx"]],[["/stage4/场景配布.pmx"]],[["/stage5/爱心.pmx"]],[["/stage6/kun.pmx"]],[["/stage7/main.pmx"],["/stage7/ball.pmx"]],[["/stage9/小黑屋.pmx"]],[["/stage10/stage2.pmx"]],[["/stage11/ver1.pmx"]],[["/stage12/手工课1.1.pmx"]],[["/extraUpload/stage/nightbridge/1.pmx"],["/extraUpload/stage/nightbridge/2.pmx"],["/extraUpload/stage/nightbridge/3.pmx"],["/extraUpload/stage/nightbridge/4.pmx"]],[["/extraUpload/stage/modelstage/1.pmx"]],[["/extraUpload/stage/cafe/1.pmx"]],[["/extraUpload/stage/whiteXblue/1.pmx"]],[["/extraUpload/stage/cubehouse/1.pmx"]],[["/extraUpload/stage/lovestair/1.pmx"],["/extraUpload/stage/lovestair/2.pmx"],["/extraUpload/stage/lovestair/3.pmx"]],[["/extraUpload/stage/yorahouse/1.pmx"],["/extraUpload/stage/yorahouse/2.pmx"]],[["/extraUpload/stage/starnorain/1.pmx"]],[["/extraUpload/stage/blackXgold/1.pmx"]],[["/extraUpload/stage/palacestage/1.pmx"]],[["/extraUpload/stage/blue-palace/1.pmx"],["/extraUpload/stage/blue-palace/2.pmx"]],[["/extraUpload/stage/underground/1.pmx"],["/extraUpload/stage/underground/2.pmx"]],[["/extraUpload/stage/snowpark/1.pmx"]],[["/extraUpload/stage/palace/1.pmx"]],[["/extraUpload/stage/whiteblack/1.pmx"]],[["/extraUpload/stage/redforest/1.pmx"]],[["/extraUpload/stage/library/1.pmx"],["/extraUpload/stage/library/2.pmx"]],[["/extraUpload/stage/bridge/1.pmx"],["/extraUpload/stage/bridge/2.pmx"],["/extraUpload/stage/bridge/3.pmx"],["/extraUpload/stage/bridge/4_2.pmx"]],[["/extraUpload/stage/whiteroom/1.pmx"],["/extraUpload/stage/bluesky/1.pmx"],["/extraUpload/stage/bluesky/2.pmx"]],[["/extraUpload/stage/gardon/yellow/1.pmx"],["/extraUpload/stage/bluesky/1.pmx"],["/extraUpload/stage/bluesky/2.pmx"]],[["/extraUpload/stage/gardon/white/1.pmx"],["/extraUpload/stage/gardon/white/2.pmx"],["/extraUpload/stage/gardon/white/3.pmx"],["/extraUpload/stage/bluesky/1.pmx"],["/extraUpload/stage/bluesky/2.pmx"]],[["/extraUpload/stage/gardon/red/1.pmx"],["/extraUpload/stage/bluesky/1.pmx"],["/extraUpload/stage/bluesky/2.pmx"]],[["/extraUpload/stage/gardon/purple/1.pmx"],["/extraUpload/stage/bluesky/1.pmx"],["/extraUpload/stage/bluesky/2.pmx"]],[["/extraUpload/stage/gardon/blue/1.pmx"],["/extraUpload/stage/bluesky/1.pmx"],["/extraUpload/stage/bluesky/2.pmx"]],[["/extraUpload/stage/seaflowwer/1.pmx"],["/extraUpload/stage/seaflowwer/2.pmx"],["/extraUpload/stage/seaflowwer/3.pmx"]],[["/extraUpload/stage/internalhotel/hotel2/1.pmx"]],[["/extraUpload/stage/redstage/red1.pmx"],["/extraUpload/stage/redstage/red2.pmx"]],[["/extraUpload/stage/nightflower/1.pmx"],["/extraUpload/stage/nightflower/2.pmx"],["/extraUpload/stage/nightflower/3.pmx"]]],c=[{name:"醉花阴",actor:"キサキ(Homyu 式)",model:["https://all.franxxdaryl.site/dist/threeMMD/kisaki/kisaki.pmx"],motion:{music:"https://all.franxxdaryl.site/dist/threeMMD/move/醉花阴.mp3",move:"https://all.franxxdaryl.site/dist/threeMMD/move/醉花阴-mov.vmd",camera:"https://all.franxxdaryl.site/dist/threeMMD/move/醉花阴-cam.vmd"},stage:[["/extraUpload/stage/HotspringHall/stage.pmx"]],needRain:!1},{name:"Classic",actor:"歌住サクラコ(ちくわエグゼ 式)",model:["https://all.franxxdaryl.site/dist/threeMMD/extraUpload/char/skakurako2/sakurako_noawake.pmx"],motion:{music:"https://all.franxxdaryl.site/dist/threeMMD/extraUpload/motion/classic/MKTO-Classic.mp3",move:["https://all.franxxdaryl.site/dist/threeMMD/extraUpload/motion/classic/13_facial_Classic.vmd","https://all.franxxdaryl.site/dist/threeMMD/extraUpload/motion/classic/12_eye_Classic.vmd","https://all.franxxdaryl.site/dist/threeMMD/extraUpload/motion/classic/11_motion_Classic.vmd"],camera:"https://all.franxxdaryl.site/dist/threeMMD/extraUpload/motion/classic/Camera.vmd"},stage:[["/extraUpload/stage/lightstage/stage.pmx"]]},{name:"极乐净土",actor:"Hatsune Miku(YYB 式)",model:["https://all.franxxdaryl.site/dist/threeMMD/extraUpload/char/YYBHatsuneMiku_10th/YYBMiku1.pmx"],motion:{music:"https://all.franxxdaryl.site/dist/threeMMD/move/jilejingtu2.mp3",move:"https://all.franxxdaryl.site/dist/threeMMD/move/jilejingtu.vmd",camera:"https://all.franxxdaryl.site/dist/threeMMD/move/jilejingtu_cam.vmd"},stage:[["/extraUpload/stage/nightflower/1.pmx"],["/extraUpload/stage/nightflower/2.pmx"],["/extraUpload/stage/nightflower/3.pmx"]],needRain:!0},{name:"アイドル",actor:"聖園ミカ(lovecelebi 式)",model:["https://all.franxxdaryl.site/dist/threeMMD/mod/mika_ver1.1.pmx"],motion:{music:"https://all.franxxdaryl.site/dist/threeMMD/extraUpload/motion/idol/idol.wav",move:"https://all.franxxdaryl.site/dist/threeMMD/extraUpload/motion/idol/Motion.vmd",camera:"https://all.franxxdaryl.site/dist/threeMMD/extraUpload/motion/idol/Camera.vmd"},stage:[["/extraUpload/stage/dream/dream1.pmx"]],needRain:!1},{name:"Bad Apple!!",actor:"湊あくあ【公式】，兎田ぺこら【公式】",model:["https://all.franxxdaryl.site/dist/threeMMD/extraUpload/char/akuya/akuya.pmx","https://all.franxxdaryl.site/dist/threeMMD/extraUpload/char/UsadaPekora/pekora/UsadaPekora.pmx"],motion:{music:"https://all.franxxdaryl.site/dist/threeMMD/extraUpload/motion/BADAPPLE/BadApple.wav",move:"https://all.franxxdaryl.site/dist/threeMMD/extraUpload/motion/BADAPPLE/WHITE.vmd",moveLeft:"https://all.franxxdaryl.site/dist/threeMMD/extraUpload/motion/BADAPPLE/BLACK.vmd",camera:"https://all.franxxdaryl.site/dist/threeMMD/extraUpload/motion/BADAPPLE/camera.vmd"},stage:[["/extraUpload/stage/whiteXblue/1.pmx"]],posList:null,needRain:!1},{name:"Every body",actor:"聖園ミカ(lovecelebi 式)，キサキ(Homyu 式)，アロナ(lovecelebi 式)",model:["https://all.franxxdaryl.site/dist/threeMMD/mod/mika_ver1.1.pmx","https://all.franxxdaryl.site/dist/threeMMD/kisaki/kisaki.pmx","https://all.franxxdaryl.site/dist/threeMMD/arona/Arona_1.01.pmx"],motion:{music:"https://all.franxxdaryl.site/dist/threeMMD/extraUpload/motion/Everybody/everybody.wav",move:"https://all.franxxdaryl.site/dist/threeMMD/extraUpload/motion/Everybody/middle.vmd",moveLeft:"https://all.franxxdaryl.site/dist/threeMMD/extraUpload/motion/Everybody/left.vmd",moveRight:"https://all.franxxdaryl.site/dist/threeMMD/extraUpload/motion/Everybody/right.vmd",camera:"https://all.franxxdaryl.site/dist/threeMMD/extraUpload/motion/Everybody/camera.vmd"},stage:[["/stage12/手工课1.1.pmx"]],posList:[[0,-2,0],[0,1.5,2],[0,1.5,2]],needRain:!1},{name:"兔子洞",actor:"rabbitmiku(树哥BigTree 式)",model:["https://all.franxxdaryl.site/dist/threeMMD/extraUpload/char/2dmiku/mikuRabbit233.pmx"],motion:{music:"https://all.franxxdaryl.site/dist/threeMMD/move/rabbithole2/rabbithole.mp3",move:"https://all.franxxdaryl.site/dist/threeMMD/move/rabbithole2/rabbit_mov.vmd",camera:"https://all.franxxdaryl.site/dist/threeMMD/move/rabbithole2/rabbit_camera.vmd"},stage:[["/stage9/black.pmx"]],posList:null,needRain:!1}]},1366:(t,e,n)=>{n.r(e),n.d(e,{default:()=>s});var r=n(5346),i=n.n(r),o=n(9067),a=n.n(o)()(i());a.push([t.id,"@import url(https://fonts.googleapis.com/css2?family=Poppins:wght@100;200;300;400;500;600;700;800;900&display=swap);"]),a.push([t.id,'@font-face{font-family:"Neon Glow";src:url(https://all.franxxdaryl.site/dist/NeonGlow-8VLz.ttf)}.mikaRoot.hide{display:none;transition:all .3s}#mikaStage{position:absolute;left:50%;top:50%;transform:translate(-50%, -50%);width:1200px;height:800px;background:radial-gradient(circle, #d6e0f9, #fbe2f0);box-shadow:-20px 0 0px -18px rgba(0,128,0,0),0 -3px 1px 0px rgba(30,27,27,.031372549),0 10px 4px -11px #aea8a8,0px 0 6px -1px rgba(255,255,0,0);z-index:3;border-radius:50%/10%;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:all .3s}#mikaStage canvas{position:absolute;z-index:3;width:90% !important;height:82% !important;border-radius:25px;background-color:rgba(0,0,0,.47);box-shadow:0px 0px 16px rgba(0,0,0,.6);border:1px solid rgba(16,2,2,0)}#mikaButton{position:absolute;z-index:4;left:50%;top:50%;transform:translate(555px, -50%);width:80px;cursor:pointer}#mikaButton img{width:100%;border-radius:50px;animation:just3;animation-duration:3s;animation-iteration-count:infinite;animation-timing-function:linear}@keyframes just3{0%{border:5px solid rgba(0,0,255,0);box-shadow:0 0 0 rgba(0,0,255,0),0 0 0 rgba(0,0,255,0) inset}50%{border:5px solid #d6e0f9;box-shadow:0 0 120px rgba(214,224,249,.7),0 0 45px rgba(214,224,249,.5) inset}100%{border:5px solid rgba(0,0,255,0);box-shadow:0 0 0 rgba(0,0,255,0),0 0 0 rgba(0,0,255,0) inset}}#mikaButton.pending:hover img{transform:rotate(0deg);border:5px solid rgba(255,255,255,0);animation:none}#mikaButton.playing img{animation:rotater;animation-duration:3s;animation-iteration-count:infinite;animation-timing-function:linear}#mikaRing{position:absolute;top:-219px;left:50%;text-align:center;width:auto;z-index:3;font-size:32px;font-family:"Poppins",sans-serif;width:220px;rotate:21deg;cursor:pointer;top:-32px;left:calc(50% + 465px);animation:ringShine 3s ease-in-out infinite !important}#mikaRing:hover{transition:all .3s;filter:grayscale(0.5)}@keyframes ringShine{0%{scale:.9}50%{scale:1}100%{scale:.9}}#mikaStageShell{position:absolute;left:50%;top:50%;transform:translate(-50%, -50%);width:1303px;height:664px;background:radial-gradient(circle, #d6e0f9, #fbe2f0);background-size:contain;background-repeat:repeat-x;box-shadow:0 4px 8px 0 rgba(0,0,0,.2),0 6px 20px 0 rgba(0,0,0,.19);border-radius:5%/50%;z-index:1;display:flex}#mikaLogo{position:absolute;top:50%;left:50%;text-align:center;width:1020px;transform:translate(-50%, 342px);z-index:3;font-size:32px;font-family:"Poppins",sans-serif;color:#e9f7ff;font-weight:600;text-shadow:0 0 20px rgba(255,168,204,.7098039216)}#mikaScreen{width:1080px;height:656px;position:absolute;left:50%;top:50%;z-index:3;transform:translate(-50%, -50%);transition:all .3s;border-radius:25px;cursor:pointer;display:flex;justify-content:center;align-items:center}#mikaScreen span{transition:all .5s;animation:animate 2s ease-in-out infinite;animation-delay:calc(.1s*var(--i));display:inline-block;font-size:48px;font-family:"Poppins",sans-serif;color:#fbe2f0}#mikaScreen.hide{display:none}.mikaRoot.inShow #mikaStage,.mikaRoot.inShow #mikaRing,.mikaRoot.inShow #mikaStageShell,.mikaRoot.inShow #mikaLogo,.mikaRoot.inShow #mikaScreen{-webkit-animation-duration:.5s;animation-duration:.5s;-webkit-animation-name:bounceInTV;animation-name:bounceInTV}.mikaRoot.inHide #mikaStage,.mikaRoot.inHide #mikaRing,.mikaRoot.inHide #mikaStageShell,.mikaRoot.inHide #mikaLogo,.mikaRoot.inHide #mikaScreen{-webkit-animation-duration:.5s;animation-duration:.5s;-webkit-animation-name:bounceOutTV;animation-name:bounceOutTV}.actionInfo{position:absolute;bottom:20px;right:0px;font-size:20px;color:#fff;display:flex;align-items:center;justify-content:flex-start;flex-direction:column;width:600px;-webkit-animation-duration:.5s;animation-duration:.5s;-webkit-animation-name:bounceInTV;animation-name:bounceInTV}.actionInfo div{width:100%;text-align:left;padding:5px 0px;display:flex;align-items:center}.actionInfo .actionContent{display:flex;justify-content:flex-start}.actionInfo .actionContent div{height:32px !important}.actionInfo .actionTitle{font-size:24px;font-weight:600;color:#fbe2f0;display:flex;justify-content:center}.actionInfo .actionTopic{display:inline-block;color:#fbe2f0;width:120px;line-height:32px !important}@keyframes shine{100%{left:125%}}@keyframes textanimate{0%{color:#fbe2f0;transform:translateY(0px);margin-left:0}25%{color:#fff;transform:translateY(-1em);margin-left:.2em;text-shadow:0 30px 5px #000}100%{color:rgba(255,255,255,.1);transform:translateY(0px);margin-left:0}}@keyframes rotater{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}@keyframes animate{0%,40%,100%{transform:translateY(0)}20%{transform:translateY(-50px)}}@keyframes bounceInTV{0%{opacity:0}100%{opacity:1}}@keyframes bounceOutTV{0%{opacity:1}100%{opacity:0}}@keyframes fadeOutBottomLeft{0%{opacity:1;-webkit-transform:translateZ(0);transform:translateZ(0)}to{opacity:0;-webkit-transform:translate3d(-100%, 100%, 0);transform:translate3d(-100%, 100%, 0)}}#rainroot canvas{display:block;width:1080px !important;height:656px !important;top:50%;position:absolute;left:50%;transform:translate(-50%, -50%);z-index:123}.mikaSwiss{position:absolute;width:20px;height:20px;left:50%;bottom:14px;background:rgba(255,255,255,0);background-image:url(https://all.franxxdaryl.site/dist/swiss.png);background-size:42px 42px;background-repeat:no-repeat;background-position-x:-1px;background-position-y:0px;transform:translateX(74px);filter:blur(0.7px)}.breakTitle{font-size:24px;color:#fff}#breakScreen{width:1080px;height:656px;position:absolute;left:50%;top:50%;z-index:144;transform:translate(-50%, -50%);transition:all .3s;border-radius:25px;cursor:pointer;position:absolute;background:rgba(86,83,83,.6784313725);display:flex;align-items:center;flex-direction:column;justify-content:center}.breakStep{font-size:22px;color:#fff;margin:20px 0}.breakContent{display:flex;justify-content:space-between;width:160px;color:#fff;margin-top:20px}.breakContent div{display:flex;flex-direction:column;align-items:flex-start;justify-content:center}.breakContent img{width:22px}.breakContent div:first-child img{padding-top:6px}.breakContent div:last-child img{padding-left:4px;transform:rotate(120deg)}.breakContent div:hover{transition:all .3s;transform:scale(1.2)}.breakContent .breakItem{height:60px}.mikatootip{opacity:1;position:absolute;z-index:231;background:#fbe2f0;padding:20px;border-radius:20px;font-size:18px;color:#fff;width:200px;right:108px;top:4px;animation:heartShine 2s ease-in-out infinite}.mikatootip img.arrow{position:absolute;right:-19px;top:18px;animation:none !important;width:30px !important;transform:none !important;border:0px solid rgba(255,255,255,0) !important;opacity:.28}.mikatootip:after{position:absolute;top:34px;right:-20px;content:"";width:0;height:0;border-right:10px solid #fbe2f0;border-bottom:10px solid rgba(0,0,0,0);border-left:10px solid rgba(0,0,0,0);border-top:10px solid rgba(0,0,0,0);transform:rotate(180deg)}.mikatootip.hide{transition:all .3s;opacity:0}@keyframes heartShine{0%{scale:.8}50%{scale:1;transform:translateX(14px)}100%{scale:.8}}.topList{position:absolute;display:flex;flex-direction:column;justify-content:flex-start;align-content:center;color:#fff;height:200px;background:#fbe2f0;border-radius:20px;padding:10px;width:600px;bottom:16px;left:50%;transform:translate(-50%, 8px)}.topList .topTitle{text-align:center;margin-bottom:10px;font-size:24px;font-weight:600;height:28px}.topList div{width:100%;position:relative}.topList span{transition:all .3s;text-align:left;position:absolute;width:100%;left:0px;top:0px;font-size:18px;white-space:nowrap;text-overflow:ellipsis;overflow:hidden}.topList span:hover{transition:all .3s;transform:scale(1.05)}.topList .topContent{display:flex;flex-direction:column;flex:1;overflow-y:auto;overflow-x:hidden;padding:0 10px;width:auto}.topList .topContent div{height:34px;display:flex;align-items:center;justify-content:center;margin:8px 0;padding:8px 0}.topList .topContent::-webkit-scrollbar{width:0;height:0}',""]);const s=a},3303:(t,e,n)=>{var r=n(5072),i=n.n(r),o=n(7825),a=n.n(o),s=n(7659),u=n.n(s),c=n(5056),l=n.n(c),f=n(540),h=n.n(f),p=n(1113),d=n.n(p),m=n(1366),y={};y.styleTagTransform=d(),y.setAttributes=l(),y.insert=u().bind(null,"head"),y.domAPI=a(),y.insertStyleElement=h();var v=i()(m.default,y);if(!m.default.locals||t.hot.invalidate){var g=!m.default.locals,b=g?m:m.default.locals;t.hot.accept(1366,(e=>{m=n(1366),function(t,e,n){if(!t&&e||t&&!e)return!1;var r;for(r in t)if((!n||"default"!==r)&&t[r]!==e[r])return!1;for(r in e)if(!(n&&"default"===r||t[r]))return!1;return!0}(b,g?m:m.default.locals,g)?(b=g?m:m.default.locals,v(m.default)):t.hot.invalidate()}))}t.hot.dispose((function(){v()})),m.default&&m.default.locals&&m.default.locals},5072:t=>{var e=[];function n(t){for(var n=-1,r=0;r<e.length;r++)if(e[r].identifier===t){n=r;break}return n}function r(t,r){for(var o={},a=[],s=0;s<t.length;s++){var u=t[s],c=r.base?u[0]+r.base:u[0],l=o[c]||0,f="".concat(c," ").concat(l);o[c]=l+1;var h=n(f),p={css:u[1],media:u[2],sourceMap:u[3],supports:u[4],layer:u[5]};if(-1!==h)e[h].references++,e[h].updater(p);else{var d=i(p,r);r.byIndex=s,e.splice(s,0,{identifier:f,updater:d,references:1})}a.push(f)}return a}function i(t,e){var n=e.domAPI(e);return n.update(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap&&e.supports===t.supports&&e.layer===t.layer)return;n.update(t=e)}else n.remove()}}t.exports=function(t,i){var o=r(t=t||[],i=i||{});return function(t){t=t||[];for(var a=0;a<o.length;a++){var s=n(o[a]);e[s].references--}for(var u=r(t,i),c=0;c<o.length;c++){var l=n(o[c]);0===e[l].references&&(e[l].updater(),e.splice(l,1))}o=u}}},7659:t=>{var e={};t.exports=function(t,n){var r=function(t){if(void 0===e[t]){var n=document.querySelector(t);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(t){n=null}e[t]=n}return e[t]}(t);if(!r)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");r.appendChild(n)}},540:t=>{t.exports=function(t){var e=document.createElement("style");return t.setAttributes(e,t.attributes),t.insert(e,t.options),e}},5056:(t,e,n)=>{t.exports=function(t){var e=n.nc;e&&t.setAttribute("nonce",e)}},7825:t=>{t.exports=function(t){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var e=t.insertStyleElement(t);return{update:function(n){!function(t,e,n){var r="";n.supports&&(r+="@supports (".concat(n.supports,") {")),n.media&&(r+="@media ".concat(n.media," {"));var i=void 0!==n.layer;i&&(r+="@layer".concat(n.layer.length>0?" ".concat(n.layer):""," {")),r+=n.css,i&&(r+="}"),n.media&&(r+="}"),n.supports&&(r+="}");var o=n.sourceMap;o&&"undefined"!=typeof btoa&&(r+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(o))))," */")),e.styleTagTransform(r,t,e.options)}(e,t,n)},remove:function(){!function(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t)}(e)}}}},1113:t=>{t.exports=function(t,e){if(e.styleSheet)e.styleSheet.cssText=t;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(t))}}},1486:t=>{t.exports=window.React},1418:t=>{t.exports=window.ReactDOM},6425:(t,e,n)=>{function r(t,e){return function(){return t.apply(e,arguments)}}const{toString:i}=Object.prototype,{getPrototypeOf:o}=Object,a=(s=Object.create(null),t=>{const e=i.call(t);return s[e]||(s[e]=e.slice(8,-1).toLowerCase())});var s;const u=t=>(t=t.toLowerCase(),e=>a(e)===t),c=t=>e=>typeof e===t,{isArray:l}=Array,f=c("undefined"),h=u("ArrayBuffer"),p=c("string"),d=c("function"),m=c("number"),y=t=>null!==t&&"object"==typeof t,v=t=>{if("object"!==a(t))return!1;const e=o(t);return!(null!==e&&e!==Object.prototype&&null!==Object.getPrototypeOf(e)||Symbol.toStringTag in t||Symbol.iterator in t)},g=u("Date"),b=u("File"),_=u("Blob"),x=u("FileList"),w=u("URLSearchParams");function S(t,e,{allOwnKeys:n=!1}={}){if(null==t)return;let r,i;if("object"!=typeof t&&(t=[t]),l(t))for(r=0,i=t.length;r<i;r++)e.call(null,t[r],r,t);else{const i=n?Object.getOwnPropertyNames(t):Object.keys(t),o=i.length;let a;for(r=0;r<o;r++)a=i[r],e.call(null,t[a],a,t)}}function T(t,e){e=e.toLowerCase();const n=Object.keys(t);let r,i=n.length;for(;i-- >0;)if(r=n[i],e===r.toLowerCase())return r;return null}const M="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:n.g,E=t=>!f(t)&&t!==M,A=(O="undefined"!=typeof Uint8Array&&o(Uint8Array),t=>O&&t instanceof O);var O;const P=u("HTMLFormElement"),R=(({hasOwnProperty:t})=>(e,n)=>t.call(e,n))(Object.prototype),k=u("RegExp"),C=(t,e)=>{const n=Object.getOwnPropertyDescriptors(t),r={};S(n,((n,i)=>{let o;!1!==(o=e(n,i,t))&&(r[i]=o||n)})),Object.defineProperties(t,r)},N="abcdefghijklmnopqrstuvwxyz",L="0123456789",j={DIGIT:L,ALPHA:N,ALPHA_DIGIT:N+N.toUpperCase()+L},I=u("AsyncFunction");var B={isArray:l,isArrayBuffer:h,isBuffer:function(t){return null!==t&&!f(t)&&null!==t.constructor&&!f(t.constructor)&&d(t.constructor.isBuffer)&&t.constructor.isBuffer(t)},isFormData:t=>{let e;return t&&("function"==typeof FormData&&t instanceof FormData||d(t.append)&&("formdata"===(e=a(t))||"object"===e&&d(t.toString)&&"[object FormData]"===t.toString()))},isArrayBufferView:function(t){let e;return e="undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(t):t&&t.buffer&&h(t.buffer),e},isString:p,isNumber:m,isBoolean:t=>!0===t||!1===t,isObject:y,isPlainObject:v,isUndefined:f,isDate:g,isFile:b,isBlob:_,isRegExp:k,isFunction:d,isStream:t=>y(t)&&d(t.pipe),isURLSearchParams:w,isTypedArray:A,isFileList:x,forEach:S,merge:function t(){const{caseless:e}=E(this)&&this||{},n={},r=(r,i)=>{const o=e&&T(n,i)||i;v(n[o])&&v(r)?n[o]=t(n[o],r):v(r)?n[o]=t({},r):l(r)?n[o]=r.slice():n[o]=r};for(let t=0,e=arguments.length;t<e;t++)arguments[t]&&S(arguments[t],r);return n},extend:(t,e,n,{allOwnKeys:i}={})=>(S(e,((e,i)=>{n&&d(e)?t[i]=r(e,n):t[i]=e}),{allOwnKeys:i}),t),trim:t=>t.trim?t.trim():t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:t=>(65279===t.charCodeAt(0)&&(t=t.slice(1)),t),inherits:(t,e,n,r)=>{t.prototype=Object.create(e.prototype,r),t.prototype.constructor=t,Object.defineProperty(t,"super",{value:e.prototype}),n&&Object.assign(t.prototype,n)},toFlatObject:(t,e,n,r)=>{let i,a,s;const u={};if(e=e||{},null==t)return e;do{for(i=Object.getOwnPropertyNames(t),a=i.length;a-- >0;)s=i[a],r&&!r(s,t,e)||u[s]||(e[s]=t[s],u[s]=!0);t=!1!==n&&o(t)}while(t&&(!n||n(t,e))&&t!==Object.prototype);return e},kindOf:a,kindOfTest:u,endsWith:(t,e,n)=>{t=String(t),(void 0===n||n>t.length)&&(n=t.length),n-=e.length;const r=t.indexOf(e,n);return-1!==r&&r===n},toArray:t=>{if(!t)return null;if(l(t))return t;let e=t.length;if(!m(e))return null;const n=new Array(e);for(;e-- >0;)n[e]=t[e];return n},forEachEntry:(t,e)=>{const n=(t&&t[Symbol.iterator]).call(t);let r;for(;(r=n.next())&&!r.done;){const n=r.value;e.call(t,n[0],n[1])}},matchAll:(t,e)=>{let n;const r=[];for(;null!==(n=t.exec(e));)r.push(n);return r},isHTMLForm:P,hasOwnProperty:R,hasOwnProp:R,reduceDescriptors:C,freezeMethods:t=>{C(t,((e,n)=>{if(d(t)&&-1!==["arguments","caller","callee"].indexOf(n))return!1;const r=t[n];d(r)&&(e.enumerable=!1,"writable"in e?e.writable=!1:e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+n+"'")}))}))},toObjectSet:(t,e)=>{const n={},r=t=>{t.forEach((t=>{n[t]=!0}))};return l(t)?r(t):r(String(t).split(e)),n},toCamelCase:t=>t.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,(function(t,e,n){return e.toUpperCase()+n})),noop:()=>{},toFiniteNumber:(t,e)=>(t=+t,Number.isFinite(t)?t:e),findKey:T,global:M,isContextDefined:E,ALPHABET:j,generateString:(t=16,e=j.ALPHA_DIGIT)=>{let n="";const{length:r}=e;for(;t--;)n+=e[Math.random()*r|0];return n},isSpecCompliantForm:function(t){return!!(t&&d(t.append)&&"FormData"===t[Symbol.toStringTag]&&t[Symbol.iterator])},toJSONObject:t=>{const e=new Array(10),n=(t,r)=>{if(y(t)){if(e.indexOf(t)>=0)return;if(!("toJSON"in t)){e[r]=t;const i=l(t)?[]:{};return S(t,((t,e)=>{const o=n(t,r+1);!f(o)&&(i[e]=o)})),e[r]=void 0,i}}return t};return n(t,0)},isAsyncFn:I,isThenable:t=>t&&(y(t)||d(t))&&d(t.then)&&d(t.catch)};function U(t,e,n,r,i){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=(new Error).stack,this.message=t,this.name="AxiosError",e&&(this.code=e),n&&(this.config=n),r&&(this.request=r),i&&(this.response=i)}B.inherits(U,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:B.toJSONObject(this.config),code:this.code,status:this.response&&this.response.status?this.response.status:null}}});const D=U.prototype,F={};function z(t){return B.isPlainObject(t)||B.isArray(t)}function V(t){return B.endsWith(t,"[]")?t.slice(0,-2):t}function G(t,e,n){return t?t.concat(e).map((function(t,e){return t=V(t),!n&&e?"["+t+"]":t})).join(n?".":""):e}["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach((t=>{F[t]={value:t}})),Object.defineProperties(U,F),Object.defineProperty(D,"isAxiosError",{value:!0}),U.from=(t,e,n,r,i,o)=>{const a=Object.create(D);return B.toFlatObject(t,a,(function(t){return t!==Error.prototype}),(t=>"isAxiosError"!==t)),U.call(a,t.message,e,n,r,i),a.cause=t,a.name=t.name,o&&Object.assign(a,o),a};const H=B.toFlatObject(B,{},null,(function(t){return/^is[A-Z]/.test(t)}));function W(t,e,n){if(!B.isObject(t))throw new TypeError("target must be an object");e=e||new FormData;const r=(n=B.toFlatObject(n,{metaTokens:!0,dots:!1,indexes:!1},!1,(function(t,e){return!B.isUndefined(e[t])}))).metaTokens,i=n.visitor||c,o=n.dots,a=n.indexes,s=(n.Blob||"undefined"!=typeof Blob&&Blob)&&B.isSpecCompliantForm(e);if(!B.isFunction(i))throw new TypeError("visitor must be a function");function u(t){if(null===t)return"";if(B.isDate(t))return t.toISOString();if(!s&&B.isBlob(t))throw new U("Blob is not supported. Use a Buffer instead.");return B.isArrayBuffer(t)||B.isTypedArray(t)?s&&"function"==typeof Blob?new Blob([t]):Buffer.from(t):t}function c(t,n,i){let s=t;if(t&&!i&&"object"==typeof t)if(B.endsWith(n,"{}"))n=r?n:n.slice(0,-2),t=JSON.stringify(t);else if(B.isArray(t)&&function(t){return B.isArray(t)&&!t.some(z)}(t)||(B.isFileList(t)||B.endsWith(n,"[]"))&&(s=B.toArray(t)))return n=V(n),s.forEach((function(t,r){!B.isUndefined(t)&&null!==t&&e.append(!0===a?G([n],r,o):null===a?n:n+"[]",u(t))})),!1;return!!z(t)||(e.append(G(i,n,o),u(t)),!1)}const l=[],f=Object.assign(H,{defaultVisitor:c,convertValue:u,isVisitable:z});if(!B.isObject(t))throw new TypeError("data must be an object");return function t(n,r){if(!B.isUndefined(n)){if(-1!==l.indexOf(n))throw Error("Circular reference detected in "+r.join("."));l.push(n),B.forEach(n,(function(n,o){!0===(!(B.isUndefined(n)||null===n)&&i.call(e,n,B.isString(o)?o.trim():o,r,f))&&t(n,r?r.concat(o):[o])})),l.pop()}}(t),e}function q(t){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(t).replace(/[!'()~]|%20|%00/g,(function(t){return e[t]}))}function X(t,e){this._pairs=[],t&&W(t,this,e)}const Y=X.prototype;function J(t){return encodeURIComponent(t).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function Z(t,e,n){if(!e)return t;const r=n&&n.encode||J,i=n&&n.serialize;let o;if(o=i?i(e,n):B.isURLSearchParams(e)?e.toString():new X(e,n).toString(r),o){const e=t.indexOf("#");-1!==e&&(t=t.slice(0,e)),t+=(-1===t.indexOf("?")?"?":"&")+o}return t}Y.append=function(t,e){this._pairs.push([t,e])},Y.toString=function(t){const e=t?function(e){return t.call(this,e,q)}:q;return this._pairs.map((function(t){return e(t[0])+"="+e(t[1])}),"").join("&")};var K=class{constructor(){this.handlers=[]}use(t,e,n){return this.handlers.push({fulfilled:t,rejected:e,synchronous:!!n&&n.synchronous,runWhen:n?n.runWhen:null}),this.handlers.length-1}eject(t){this.handlers[t]&&(this.handlers[t]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(t){B.forEach(this.handlers,(function(e){null!==e&&t(e)}))}},Q={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},$={isBrowser:!0,classes:{URLSearchParams:"undefined"!=typeof URLSearchParams?URLSearchParams:X,FormData:"undefined"!=typeof FormData?FormData:null,Blob:"undefined"!=typeof Blob?Blob:null},protocols:["http","https","file","blob","url","data"]};const tt="undefined"!=typeof window&&"undefined"!=typeof document,et=(nt="undefined"!=typeof navigator&&navigator.product,tt&&["ReactNative","NativeScript","NS"].indexOf(nt)<0);var nt;const rt="undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&"function"==typeof self.importScripts;var it={...Object.freeze({__proto__:null,hasBrowserEnv:tt,hasStandardBrowserWebWorkerEnv:rt,hasStandardBrowserEnv:et}),...$};function ot(t){function e(t,n,r,i){let o=t[i++];if("__proto__"===o)return!0;const a=Number.isFinite(+o),s=i>=t.length;return o=!o&&B.isArray(r)?r.length:o,s?(B.hasOwnProp(r,o)?r[o]=[r[o],n]:r[o]=n,!a):(r[o]&&B.isObject(r[o])||(r[o]=[]),e(t,n,r[o],i)&&B.isArray(r[o])&&(r[o]=function(t){const e={},n=Object.keys(t);let r;const i=n.length;let o;for(r=0;r<i;r++)o=n[r],e[o]=t[o];return e}(r[o])),!a)}if(B.isFormData(t)&&B.isFunction(t.entries)){const n={};return B.forEachEntry(t,((t,r)=>{e(function(t){return B.matchAll(/\w+|\[(\w*)]/g,t).map((t=>"[]"===t[0]?"":t[1]||t[0]))}(t),r,n,0)})),n}return null}const at={transitional:Q,adapter:["xhr","http"],transformRequest:[function(t,e){const n=e.getContentType()||"",r=n.indexOf("application/json")>-1,i=B.isObject(t);if(i&&B.isHTMLForm(t)&&(t=new FormData(t)),B.isFormData(t))return r?JSON.stringify(ot(t)):t;if(B.isArrayBuffer(t)||B.isBuffer(t)||B.isStream(t)||B.isFile(t)||B.isBlob(t))return t;if(B.isArrayBufferView(t))return t.buffer;if(B.isURLSearchParams(t))return e.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),t.toString();let o;if(i){if(n.indexOf("application/x-www-form-urlencoded")>-1)return function(t,e){return W(t,new it.classes.URLSearchParams,Object.assign({visitor:function(t,e,n,r){return it.isNode&&B.isBuffer(t)?(this.append(e,t.toString("base64")),!1):r.defaultVisitor.apply(this,arguments)}},e))}(t,this.formSerializer).toString();if((o=B.isFileList(t))||n.indexOf("multipart/form-data")>-1){const e=this.env&&this.env.FormData;return W(o?{"files[]":t}:t,e&&new e,this.formSerializer)}}return i||r?(e.setContentType("application/json",!1),function(t,e,n){if(B.isString(t))try{return(0,JSON.parse)(t),B.trim(t)}catch(t){if("SyntaxError"!==t.name)throw t}return(0,JSON.stringify)(t)}(t)):t}],transformResponse:[function(t){const e=this.transitional||at.transitional,n=e&&e.forcedJSONParsing,r="json"===this.responseType;if(t&&B.isString(t)&&(n&&!this.responseType||r)){const n=!(e&&e.silentJSONParsing)&&r;try{return JSON.parse(t)}catch(t){if(n){if("SyntaxError"===t.name)throw U.from(t,U.ERR_BAD_RESPONSE,this,null,this.response);throw t}}}return t}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:it.classes.FormData,Blob:it.classes.Blob},validateStatus:function(t){return t>=200&&t<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};B.forEach(["delete","get","head","post","put","patch"],(t=>{at.headers[t]={}}));var st=at;const ut=B.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),ct=Symbol("internals");function lt(t){return t&&String(t).trim().toLowerCase()}function ft(t){return!1===t||null==t?t:B.isArray(t)?t.map(ft):String(t)}function ht(t,e,n,r,i){return B.isFunction(r)?r.call(this,e,n):(i&&(e=n),B.isString(e)?B.isString(r)?-1!==e.indexOf(r):B.isRegExp(r)?r.test(e):void 0:void 0)}class pt{constructor(t){t&&this.set(t)}set(t,e,n){const r=this;function i(t,e,n){const i=lt(e);if(!i)throw new Error("header name must be a non-empty string");const o=B.findKey(r,i);(!o||void 0===r[o]||!0===n||void 0===n&&!1!==r[o])&&(r[o||e]=ft(t))}const o=(t,e)=>B.forEach(t,((t,n)=>i(t,n,e)));return B.isPlainObject(t)||t instanceof this.constructor?o(t,e):B.isString(t)&&(t=t.trim())&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(t.trim())?o((t=>{const e={};let n,r,i;return t&&t.split("\n").forEach((function(t){i=t.indexOf(":"),n=t.substring(0,i).trim().toLowerCase(),r=t.substring(i+1).trim(),!n||e[n]&&ut[n]||("set-cookie"===n?e[n]?e[n].push(r):e[n]=[r]:e[n]=e[n]?e[n]+", "+r:r)})),e})(t),e):null!=t&&i(e,t,n),this}get(t,e){if(t=lt(t)){const n=B.findKey(this,t);if(n){const t=this[n];if(!e)return t;if(!0===e)return function(t){const e=Object.create(null),n=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let r;for(;r=n.exec(t);)e[r[1]]=r[2];return e}(t);if(B.isFunction(e))return e.call(this,t,n);if(B.isRegExp(e))return e.exec(t);throw new TypeError("parser must be boolean|regexp|function")}}}has(t,e){if(t=lt(t)){const n=B.findKey(this,t);return!(!n||void 0===this[n]||e&&!ht(0,this[n],n,e))}return!1}delete(t,e){const n=this;let r=!1;function i(t){if(t=lt(t)){const i=B.findKey(n,t);!i||e&&!ht(0,n[i],i,e)||(delete n[i],r=!0)}}return B.isArray(t)?t.forEach(i):i(t),r}clear(t){const e=Object.keys(this);let n=e.length,r=!1;for(;n--;){const i=e[n];t&&!ht(0,this[i],i,t,!0)||(delete this[i],r=!0)}return r}normalize(t){const e=this,n={};return B.forEach(this,((r,i)=>{const o=B.findKey(n,i);if(o)return e[o]=ft(r),void delete e[i];const a=t?function(t){return t.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,((t,e,n)=>e.toUpperCase()+n))}(i):String(i).trim();a!==i&&delete e[i],e[a]=ft(r),n[a]=!0})),this}concat(...t){return this.constructor.concat(this,...t)}toJSON(t){const e=Object.create(null);return B.forEach(this,((n,r)=>{null!=n&&!1!==n&&(e[r]=t&&B.isArray(n)?n.join(", "):n)})),e}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map((([t,e])=>t+": "+e)).join("\n")}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(t){return t instanceof this?t:new this(t)}static concat(t,...e){const n=new this(t);return e.forEach((t=>n.set(t))),n}static accessor(t){const e=(this[ct]=this[ct]={accessors:{}}).accessors,n=this.prototype;function r(t){const r=lt(t);e[r]||(function(t,e){const n=B.toCamelCase(" "+e);["get","set","has"].forEach((r=>{Object.defineProperty(t,r+n,{value:function(t,n,i){return this[r].call(this,e,t,n,i)},configurable:!0})}))}(n,t),e[r]=!0)}return B.isArray(t)?t.forEach(r):r(t),this}}pt.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),B.reduceDescriptors(pt.prototype,(({value:t},e)=>{let n=e[0].toUpperCase()+e.slice(1);return{get:()=>t,set(t){this[n]=t}}})),B.freezeMethods(pt);var dt=pt;function mt(t,e){const n=this||st,r=e||n,i=dt.from(r.headers);let o=r.data;return B.forEach(t,(function(t){o=t.call(n,o,i.normalize(),e?e.status:void 0)})),i.normalize(),o}function yt(t){return!(!t||!t.__CANCEL__)}function vt(t,e,n){U.call(this,null==t?"canceled":t,U.ERR_CANCELED,e,n),this.name="CanceledError"}B.inherits(vt,U,{__CANCEL__:!0});var gt=it.hasStandardBrowserEnv?{write(t,e,n,r,i,o){const a=[t+"="+encodeURIComponent(e)];B.isNumber(n)&&a.push("expires="+new Date(n).toGMTString()),B.isString(r)&&a.push("path="+r),B.isString(i)&&a.push("domain="+i),!0===o&&a.push("secure"),document.cookie=a.join("; ")},read(t){const e=document.cookie.match(new RegExp("(^|;\\s*)("+t+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove(t){this.write(t,"",Date.now()-864e5)}}:{write(){},read:()=>null,remove(){}};function bt(t,e){return t&&!/^([a-z][a-z\d+\-.]*:)?\/\//i.test(e)?function(t,e){return e?t.replace(/\/?\/$/,"")+"/"+e.replace(/^\/+/,""):t}(t,e):e}var _t=it.hasStandardBrowserEnv?function(){const t=/(msie|trident)/i.test(navigator.userAgent),e=document.createElement("a");let n;function r(n){let r=n;return t&&(e.setAttribute("href",r),r=e.href),e.setAttribute("href",r),{href:e.href,protocol:e.protocol?e.protocol.replace(/:$/,""):"",host:e.host,search:e.search?e.search.replace(/^\?/,""):"",hash:e.hash?e.hash.replace(/^#/,""):"",hostname:e.hostname,port:e.port,pathname:"/"===e.pathname.charAt(0)?e.pathname:"/"+e.pathname}}return n=r(window.location.href),function(t){const e=B.isString(t)?r(t):t;return e.protocol===n.protocol&&e.host===n.host}}():function(){return!0};function xt(t,e){let n=0;const r=function(t,e){t=t||10;const n=new Array(t),r=new Array(t);let i,o=0,a=0;return e=void 0!==e?e:1e3,function(s){const u=Date.now(),c=r[a];i||(i=u),n[o]=s,r[o]=u;let l=a,f=0;for(;l!==o;)f+=n[l++],l%=t;if(o=(o+1)%t,o===a&&(a=(a+1)%t),u-i<e)return;const h=c&&u-c;return h?Math.round(1e3*f/h):void 0}}(50,250);return i=>{const o=i.loaded,a=i.lengthComputable?i.total:void 0,s=o-n,u=r(s);n=o;const c={loaded:o,total:a,progress:a?o/a:void 0,bytes:s,rate:u||void 0,estimated:u&&a&&o<=a?(a-o)/u:void 0,event:i};c[e?"download":"upload"]=!0,t(c)}}const wt={http:null,xhr:"undefined"!=typeof XMLHttpRequest&&function(t){return new Promise((function(e,n){let r=t.data;const i=dt.from(t.headers).normalize();let o,a,{responseType:s,withXSRFToken:u}=t;function c(){t.cancelToken&&t.cancelToken.unsubscribe(o),t.signal&&t.signal.removeEventListener("abort",o)}if(B.isFormData(r))if(it.hasStandardBrowserEnv||it.hasStandardBrowserWebWorkerEnv)i.setContentType(!1);else if(!1!==(a=i.getContentType())){const[t,...e]=a?a.split(";").map((t=>t.trim())).filter(Boolean):[];i.setContentType([t||"multipart/form-data",...e].join("; "))}let l=new XMLHttpRequest;if(t.auth){const e=t.auth.username||"",n=t.auth.password?unescape(encodeURIComponent(t.auth.password)):"";i.set("Authorization","Basic "+btoa(e+":"+n))}const f=bt(t.baseURL,t.url);function h(){if(!l)return;const r=dt.from("getAllResponseHeaders"in l&&l.getAllResponseHeaders());!function(t,e,n){const r=n.config.validateStatus;n.status&&r&&!r(n.status)?e(new U("Request failed with status code "+n.status,[U.ERR_BAD_REQUEST,U.ERR_BAD_RESPONSE][Math.floor(n.status/100)-4],n.config,n.request,n)):t(n)}((function(t){e(t),c()}),(function(t){n(t),c()}),{data:s&&"text"!==s&&"json"!==s?l.response:l.responseText,status:l.status,statusText:l.statusText,headers:r,config:t,request:l}),l=null}if(l.open(t.method.toUpperCase(),Z(f,t.params,t.paramsSerializer),!0),l.timeout=t.timeout,"onloadend"in l?l.onloadend=h:l.onreadystatechange=function(){l&&4===l.readyState&&(0!==l.status||l.responseURL&&0===l.responseURL.indexOf("file:"))&&setTimeout(h)},l.onabort=function(){l&&(n(new U("Request aborted",U.ECONNABORTED,t,l)),l=null)},l.onerror=function(){n(new U("Network Error",U.ERR_NETWORK,t,l)),l=null},l.ontimeout=function(){let e=t.timeout?"timeout of "+t.timeout+"ms exceeded":"timeout exceeded";const r=t.transitional||Q;t.timeoutErrorMessage&&(e=t.timeoutErrorMessage),n(new U(e,r.clarifyTimeoutError?U.ETIMEDOUT:U.ECONNABORTED,t,l)),l=null},it.hasStandardBrowserEnv&&(u&&B.isFunction(u)&&(u=u(t)),u||!1!==u&&_t(f))){const e=t.xsrfHeaderName&&t.xsrfCookieName&&gt.read(t.xsrfCookieName);e&&i.set(t.xsrfHeaderName,e)}void 0===r&&i.setContentType(null),"setRequestHeader"in l&&B.forEach(i.toJSON(),(function(t,e){l.setRequestHeader(e,t)})),B.isUndefined(t.withCredentials)||(l.withCredentials=!!t.withCredentials),s&&"json"!==s&&(l.responseType=t.responseType),"function"==typeof t.onDownloadProgress&&l.addEventListener("progress",xt(t.onDownloadProgress,!0)),"function"==typeof t.onUploadProgress&&l.upload&&l.upload.addEventListener("progress",xt(t.onUploadProgress)),(t.cancelToken||t.signal)&&(o=e=>{l&&(n(!e||e.type?new vt(null,t,l):e),l.abort(),l=null)},t.cancelToken&&t.cancelToken.subscribe(o),t.signal&&(t.signal.aborted?o():t.signal.addEventListener("abort",o)));const p=function(t){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(t);return e&&e[1]||""}(f);p&&-1===it.protocols.indexOf(p)?n(new U("Unsupported protocol "+p+":",U.ERR_BAD_REQUEST,t)):l.send(r||null)}))}};B.forEach(wt,((t,e)=>{if(t){try{Object.defineProperty(t,"name",{value:e})}catch(t){}Object.defineProperty(t,"adapterName",{value:e})}}));const St=t=>`- ${t}`,Tt=t=>B.isFunction(t)||null===t||!1===t;var Mt=t=>{t=B.isArray(t)?t:[t];const{length:e}=t;let n,r;const i={};for(let o=0;o<e;o++){let e;if(n=t[o],r=n,!Tt(n)&&(r=wt[(e=String(n)).toLowerCase()],void 0===r))throw new U(`Unknown adapter '${e}'`);if(r)break;i[e||"#"+o]=r}if(!r){const t=Object.entries(i).map((([t,e])=>`adapter ${t} `+(!1===e?"is not supported by the environment":"is not available in the build")));throw new U("There is no suitable adapter to dispatch the request "+(e?t.length>1?"since :\n"+t.map(St).join("\n"):" "+St(t[0]):"as no adapter specified"),"ERR_NOT_SUPPORT")}return r};function Et(t){if(t.cancelToken&&t.cancelToken.throwIfRequested(),t.signal&&t.signal.aborted)throw new vt(null,t)}function At(t){return Et(t),t.headers=dt.from(t.headers),t.data=mt.call(t,t.transformRequest),-1!==["post","put","patch"].indexOf(t.method)&&t.headers.setContentType("application/x-www-form-urlencoded",!1),Mt(t.adapter||st.adapter)(t).then((function(e){return Et(t),e.data=mt.call(t,t.transformResponse,e),e.headers=dt.from(e.headers),e}),(function(e){return yt(e)||(Et(t),e&&e.response&&(e.response.data=mt.call(t,t.transformResponse,e.response),e.response.headers=dt.from(e.response.headers))),Promise.reject(e)}))}const Ot=t=>t instanceof dt?{...t}:t;function Pt(t,e){e=e||{};const n={};function r(t,e,n){return B.isPlainObject(t)&&B.isPlainObject(e)?B.merge.call({caseless:n},t,e):B.isPlainObject(e)?B.merge({},e):B.isArray(e)?e.slice():e}function i(t,e,n){return B.isUndefined(e)?B.isUndefined(t)?void 0:r(void 0,t,n):r(t,e,n)}function o(t,e){if(!B.isUndefined(e))return r(void 0,e)}function a(t,e){return B.isUndefined(e)?B.isUndefined(t)?void 0:r(void 0,t):r(void 0,e)}function s(n,i,o){return o in e?r(n,i):o in t?r(void 0,n):void 0}const u={url:o,method:o,data:o,baseURL:a,transformRequest:a,transformResponse:a,paramsSerializer:a,timeout:a,timeoutMessage:a,withCredentials:a,withXSRFToken:a,adapter:a,responseType:a,xsrfCookieName:a,xsrfHeaderName:a,onUploadProgress:a,onDownloadProgress:a,decompress:a,maxContentLength:a,maxBodyLength:a,beforeRedirect:a,transport:a,httpAgent:a,httpsAgent:a,cancelToken:a,socketPath:a,responseEncoding:a,validateStatus:s,headers:(t,e)=>i(Ot(t),Ot(e),!0)};return B.forEach(Object.keys(Object.assign({},t,e)),(function(r){const o=u[r]||i,a=o(t[r],e[r],r);B.isUndefined(a)&&o!==s||(n[r]=a)})),n}const Rt={};["object","boolean","number","function","string","symbol"].forEach(((t,e)=>{Rt[t]=function(n){return typeof n===t||"a"+(e<1?"n ":" ")+t}}));const kt={};Rt.transitional=function(t,e,n){function r(t,e){return"[Axios v1.6.8] Transitional option '"+t+"'"+e+(n?". "+n:"")}return(n,i,o)=>{if(!1===t)throw new U(r(i," has been removed"+(e?" in "+e:"")),U.ERR_DEPRECATED);return e&&!kt[i]&&(kt[i]=!0,console.warn(r(i," has been deprecated since v"+e+" and will be removed in the near future"))),!t||t(n,i,o)}};var Ct={assertOptions:function(t,e,n){if("object"!=typeof t)throw new U("options must be an object",U.ERR_BAD_OPTION_VALUE);const r=Object.keys(t);let i=r.length;for(;i-- >0;){const o=r[i],a=e[o];if(a){const e=t[o],n=void 0===e||a(e,o,t);if(!0!==n)throw new U("option "+o+" must be "+n,U.ERR_BAD_OPTION_VALUE)}else if(!0!==n)throw new U("Unknown option "+o,U.ERR_BAD_OPTION)}},validators:Rt};const Nt=Ct.validators;class Lt{constructor(t){this.defaults=t,this.interceptors={request:new K,response:new K}}async request(t,e){try{return await this._request(t,e)}catch(t){if(t instanceof Error){let e;Error.captureStackTrace?Error.captureStackTrace(e={}):e=new Error;const n=e.stack?e.stack.replace(/^.+\n/,""):"";t.stack?n&&!String(t.stack).endsWith(n.replace(/^.+\n.+\n/,""))&&(t.stack+="\n"+n):t.stack=n}throw t}}_request(t,e){"string"==typeof t?(e=e||{}).url=t:e=t||{},e=Pt(this.defaults,e);const{transitional:n,paramsSerializer:r,headers:i}=e;void 0!==n&&Ct.assertOptions(n,{silentJSONParsing:Nt.transitional(Nt.boolean),forcedJSONParsing:Nt.transitional(Nt.boolean),clarifyTimeoutError:Nt.transitional(Nt.boolean)},!1),null!=r&&(B.isFunction(r)?e.paramsSerializer={serialize:r}:Ct.assertOptions(r,{encode:Nt.function,serialize:Nt.function},!0)),e.method=(e.method||this.defaults.method||"get").toLowerCase();let o=i&&B.merge(i.common,i[e.method]);i&&B.forEach(["delete","get","head","post","put","patch","common"],(t=>{delete i[t]})),e.headers=dt.concat(o,i);const a=[];let s=!0;this.interceptors.request.forEach((function(t){"function"==typeof t.runWhen&&!1===t.runWhen(e)||(s=s&&t.synchronous,a.unshift(t.fulfilled,t.rejected))}));const u=[];let c;this.interceptors.response.forEach((function(t){u.push(t.fulfilled,t.rejected)}));let l,f=0;if(!s){const t=[At.bind(this),void 0];for(t.unshift.apply(t,a),t.push.apply(t,u),l=t.length,c=Promise.resolve(e);f<l;)c=c.then(t[f++],t[f++]);return c}l=a.length;let h=e;for(f=0;f<l;){const t=a[f++],e=a[f++];try{h=t(h)}catch(t){e.call(this,t);break}}try{c=At.call(this,h)}catch(t){return Promise.reject(t)}for(f=0,l=u.length;f<l;)c=c.then(u[f++],u[f++]);return c}getUri(t){return Z(bt((t=Pt(this.defaults,t)).baseURL,t.url),t.params,t.paramsSerializer)}}B.forEach(["delete","get","head","options"],(function(t){Lt.prototype[t]=function(e,n){return this.request(Pt(n||{},{method:t,url:e,data:(n||{}).data}))}})),B.forEach(["post","put","patch"],(function(t){function e(e){return function(n,r,i){return this.request(Pt(i||{},{method:t,headers:e?{"Content-Type":"multipart/form-data"}:{},url:n,data:r}))}}Lt.prototype[t]=e(),Lt.prototype[t+"Form"]=e(!0)}));var jt=Lt;class It{constructor(t){if("function"!=typeof t)throw new TypeError("executor must be a function.");let e;this.promise=new Promise((function(t){e=t}));const n=this;this.promise.then((t=>{if(!n._listeners)return;let e=n._listeners.length;for(;e-- >0;)n._listeners[e](t);n._listeners=null})),this.promise.then=t=>{let e;const r=new Promise((t=>{n.subscribe(t),e=t})).then(t);return r.cancel=function(){n.unsubscribe(e)},r},t((function(t,r,i){n.reason||(n.reason=new vt(t,r,i),e(n.reason))}))}throwIfRequested(){if(this.reason)throw this.reason}subscribe(t){this.reason?t(this.reason):this._listeners?this._listeners.push(t):this._listeners=[t]}unsubscribe(t){if(!this._listeners)return;const e=this._listeners.indexOf(t);-1!==e&&this._listeners.splice(e,1)}static source(){let t;return{token:new It((function(e){t=e})),cancel:t}}}var Bt=It;const Ut={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(Ut).forEach((([t,e])=>{Ut[e]=t}));var Dt=Ut;const Ft=function t(e){const n=new jt(e),i=r(jt.prototype.request,n);return B.extend(i,jt.prototype,n,{allOwnKeys:!0}),B.extend(i,n,null,{allOwnKeys:!0}),i.create=function(n){return t(Pt(e,n))},i}(st);Ft.Axios=jt,Ft.CanceledError=vt,Ft.CancelToken=Bt,Ft.isCancel=yt,Ft.VERSION="1.6.8",Ft.toFormData=W,Ft.AxiosError=U,Ft.Cancel=Ft.CanceledError,Ft.all=function(t){return Promise.all(t)},Ft.spread=function(t){return function(e){return t.apply(null,e)}},Ft.isAxiosError=function(t){return B.isObject(t)&&!0===t.isAxiosError},Ft.mergeConfig=Pt,Ft.AxiosHeaders=dt,Ft.formToJSON=t=>ot(B.isHTMLForm(t)?new FormData(t):t),Ft.getAdapter=Mt,Ft.HttpStatusCode=Dt,Ft.default=Ft,t.exports=Ft},7186:(t,e)=>{const n="163",r=1,i=2,o=3,a=0,s=1,u=2,c=100,l=101,f=102,h=200,p=201,d=202,m=203,y=204,v=205,g=206,b=207,_=208,x=209,w=210,S=211,T=212,M=213,E=214,A=0,O=1,P=2,R=0,k=1,C=2,N=3,L=4,j=5,I=6,B=7,U="attached",D="detached",F=300,z=301,V=302,G=303,H=304,W=306,q=1e3,X=1001,Y=1002,J=1003,Z=1004,K=1005,Q=1006,$=1007,tt=1008,et=1009,nt=1012,rt=1013,it=1014,ot=1015,at=1016,st=1017,ut=1018,ct=1020,lt=1023,ft=1026,ht=1027,pt=1028,dt=1029,mt=1031,yt=1033,vt=33776,gt=33777,bt=33778,_t=33779,xt=35840,wt=35841,St=35842,Tt=35843,Mt=36196,Et=37492,At=37496,Ot=37808,Pt=37809,Rt=37810,kt=37811,Ct=37812,Nt=37813,Lt=37814,jt=37815,It=37816,Bt=37817,Ut=37818,Dt=37819,Ft=37820,zt=37821,Vt=36492,Gt=36494,Ht=36495,Wt=36284,qt=36285,Xt=36286,Yt=2300,Jt=2301,Zt=2302,Kt=2400,Qt=2401,$t=2402,te=2501,ee="",ne="srgb",re="srgb-linear",ie="display-p3",oe="display-p3-linear",ae="linear",se="srgb",ue="rec709",ce="p3",le=7680,fe=512,he=513,pe=514,de=515,me=516,ye=517,ve=518,ge=519,be=35044,_e="300 es",xe=2e3,we=2001;class Se{addEventListener(t,e){void 0===this._listeners&&(this._listeners={});const n=this._listeners;void 0===n[t]&&(n[t]=[]),-1===n[t].indexOf(e)&&n[t].push(e)}hasEventListener(t,e){if(void 0===this._listeners)return!1;const n=this._listeners;return void 0!==n[t]&&-1!==n[t].indexOf(e)}removeEventListener(t,e){if(void 0===this._listeners)return;const n=this._listeners[t];if(void 0!==n){const t=n.indexOf(e);-1!==t&&n.splice(t,1)}}dispatchEvent(t){if(void 0===this._listeners)return;const e=this._listeners[t.type];if(void 0!==e){t.target=this;const n=e.slice(0);for(let e=0,r=n.length;e<r;e++)n[e].call(this,t);t.target=null}}}const Te=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let Me=1234567;const Ee=Math.PI/180,Ae=180/Math.PI;function Oe(){const t=4294967295*Math.random()|0,e=4294967295*Math.random()|0,n=4294967295*Math.random()|0,r=4294967295*Math.random()|0;return(Te[255&t]+Te[t>>8&255]+Te[t>>16&255]+Te[t>>24&255]+"-"+Te[255&e]+Te[e>>8&255]+"-"+Te[e>>16&15|64]+Te[e>>24&255]+"-"+Te[63&n|128]+Te[n>>8&255]+"-"+Te[n>>16&255]+Te[n>>24&255]+Te[255&r]+Te[r>>8&255]+Te[r>>16&255]+Te[r>>24&255]).toLowerCase()}function Pe(t,e,n){return Math.max(e,Math.min(n,t))}function Re(t,e){return(t%e+e)%e}function ke(t,e,n){return(1-n)*t+n*e}function Ce(t,e){switch(e.constructor){case Float32Array:return t;case Uint32Array:return t/4294967295;case Uint16Array:return t/65535;case Uint8Array:return t/255;case Int32Array:return Math.max(t/2147483647,-1);case Int16Array:return Math.max(t/32767,-1);case Int8Array:return Math.max(t/127,-1);default:throw new Error("Invalid component type.")}}function Ne(t,e){switch(e.constructor){case Float32Array:return t;case Uint32Array:return Math.round(4294967295*t);case Uint16Array:return Math.round(65535*t);case Uint8Array:return Math.round(255*t);case Int32Array:return Math.round(2147483647*t);case Int16Array:return Math.round(32767*t);case Int8Array:return Math.round(127*t);default:throw new Error("Invalid component type.")}}const Le={DEG2RAD:Ee,RAD2DEG:Ae,generateUUID:Oe,clamp:Pe,euclideanModulo:Re,mapLinear:function(t,e,n,r,i){return r+(t-e)*(i-r)/(n-e)},inverseLerp:function(t,e,n){return t!==e?(n-t)/(e-t):0},lerp:ke,damp:function(t,e,n,r){return ke(t,e,1-Math.exp(-n*r))},pingpong:function(t,e=1){return e-Math.abs(Re(t,2*e)-e)},smoothstep:function(t,e,n){return t<=e?0:t>=n?1:(t=(t-e)/(n-e))*t*(3-2*t)},smootherstep:function(t,e,n){return t<=e?0:t>=n?1:(t=(t-e)/(n-e))*t*t*(t*(6*t-15)+10)},randInt:function(t,e){return t+Math.floor(Math.random()*(e-t+1))},randFloat:function(t,e){return t+Math.random()*(e-t)},randFloatSpread:function(t){return t*(.5-Math.random())},seededRandom:function(t){void 0!==t&&(Me=t);let e=Me+=1831565813;return e=Math.imul(e^e>>>15,1|e),e^=e+Math.imul(e^e>>>7,61|e),((e^e>>>14)>>>0)/4294967296},degToRad:function(t){return t*Ee},radToDeg:function(t){return t*Ae},isPowerOfTwo:function(t){return!(t&t-1)&&0!==t},ceilPowerOfTwo:function(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))},floorPowerOfTwo:function(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))},setQuaternionFromProperEuler:function(t,e,n,r,i){const o=Math.cos,a=Math.sin,s=o(n/2),u=a(n/2),c=o((e+r)/2),l=a((e+r)/2),f=o((e-r)/2),h=a((e-r)/2),p=o((r-e)/2),d=a((r-e)/2);switch(i){case"XYX":t.set(s*l,u*f,u*h,s*c);break;case"YZY":t.set(u*h,s*l,u*f,s*c);break;case"ZXZ":t.set(u*f,u*h,s*l,s*c);break;case"XZX":t.set(s*l,u*d,u*p,s*c);break;case"YXY":t.set(u*p,s*l,u*d,s*c);break;case"ZYZ":t.set(u*d,u*p,s*l,s*c);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+i)}},normalize:Ne,denormalize:Ce};class je{constructor(t=0,e=0){je.prototype.isVector2=!0,this.x=t,this.y=e}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,e){return this.x=t,this.y=e,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t){return this.x+=t.x,this.y+=t.y,this}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){const e=this.x,n=this.y,r=t.elements;return this.x=r[0]*e+r[3]*n+r[6],this.y=r[1]*e+r[4]*n+r[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this}clampLength(t,e){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(0===e)return Math.PI/2;const n=this.dot(t)/e;return Math.acos(Pe(n,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,n=this.y-t.y;return e*e+n*n}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this}lerpVectors(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this}rotateAround(t,e){const n=Math.cos(e),r=Math.sin(e),i=this.x-t.x,o=this.y-t.y;return this.x=i*n-o*r+t.x,this.y=i*r+o*n+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class Ie{constructor(t,e,n,r,i,o,a,s,u){Ie.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],void 0!==t&&this.set(t,e,n,r,i,o,a,s,u)}set(t,e,n,r,i,o,a,s,u){const c=this.elements;return c[0]=t,c[1]=r,c[2]=a,c[3]=e,c[4]=i,c[5]=s,c[6]=n,c[7]=o,c[8]=u,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(t){const e=this.elements,n=t.elements;return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],this}extractBasis(t,e,n){return t.setFromMatrix3Column(this,0),e.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(t){const e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const n=t.elements,r=e.elements,i=this.elements,o=n[0],a=n[3],s=n[6],u=n[1],c=n[4],l=n[7],f=n[2],h=n[5],p=n[8],d=r[0],m=r[3],y=r[6],v=r[1],g=r[4],b=r[7],_=r[2],x=r[5],w=r[8];return i[0]=o*d+a*v+s*_,i[3]=o*m+a*g+s*x,i[6]=o*y+a*b+s*w,i[1]=u*d+c*v+l*_,i[4]=u*m+c*g+l*x,i[7]=u*y+c*b+l*w,i[2]=f*d+h*v+p*_,i[5]=f*m+h*g+p*x,i[8]=f*y+h*b+p*w,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this}determinant(){const t=this.elements,e=t[0],n=t[1],r=t[2],i=t[3],o=t[4],a=t[5],s=t[6],u=t[7],c=t[8];return e*o*c-e*a*u-n*i*c+n*a*s+r*i*u-r*o*s}invert(){const t=this.elements,e=t[0],n=t[1],r=t[2],i=t[3],o=t[4],a=t[5],s=t[6],u=t[7],c=t[8],l=c*o-a*u,f=a*s-c*i,h=u*i-o*s,p=e*l+n*f+r*h;if(0===p)return this.set(0,0,0,0,0,0,0,0,0);const d=1/p;return t[0]=l*d,t[1]=(r*u-c*n)*d,t[2]=(a*n-r*o)*d,t[3]=f*d,t[4]=(c*e-r*s)*d,t[5]=(r*i-a*e)*d,t[6]=h*d,t[7]=(n*s-u*e)*d,t[8]=(o*e-n*i)*d,this}transpose(){let t;const e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this}getNormalMatrix(t){return this.setFromMatrix4(t).invert().transpose()}transposeIntoArray(t){const e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this}setUvTransform(t,e,n,r,i,o,a){const s=Math.cos(i),u=Math.sin(i);return this.set(n*s,n*u,-n*(s*o+u*a)+o+t,-r*u,r*s,-r*(-u*o+s*a)+a+e,0,0,1),this}scale(t,e){return this.premultiply(Be.makeScale(t,e)),this}rotate(t){return this.premultiply(Be.makeRotation(-t)),this}translate(t,e){return this.premultiply(Be.makeTranslation(t,e)),this}makeTranslation(t,e){return t.isVector2?this.set(1,0,t.x,0,1,t.y,0,0,1):this.set(1,0,t,0,1,e,0,0,1),this}makeRotation(t){const e=Math.cos(t),n=Math.sin(t);return this.set(e,-n,0,n,e,0,0,0,1),this}makeScale(t,e){return this.set(t,0,0,0,e,0,0,0,1),this}equals(t){const e=this.elements,n=t.elements;for(let t=0;t<9;t++)if(e[t]!==n[t])return!1;return!0}fromArray(t,e=0){for(let n=0;n<9;n++)this.elements[n]=t[n+e];return this}toArray(t=[],e=0){const n=this.elements;return t[e]=n[0],t[e+1]=n[1],t[e+2]=n[2],t[e+3]=n[3],t[e+4]=n[4],t[e+5]=n[5],t[e+6]=n[6],t[e+7]=n[7],t[e+8]=n[8],t}clone(){return(new this.constructor).fromArray(this.elements)}}const Be=new Ie;function Ue(t){for(let e=t.length-1;e>=0;--e)if(t[e]>=65535)return!0;return!1}const De={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function Fe(t,e){return new De[t](e)}function ze(t){return document.createElementNS("http://www.w3.org/1999/xhtml",t)}function Ve(){const t=ze("canvas");return t.style.display="block",t}const Ge={};function He(t){t in Ge||(Ge[t]=!0,console.warn(t))}const We=(new Ie).set(.8224621,.177538,0,.0331941,.9668058,0,.0170827,.0723974,.9105199),qe=(new Ie).set(1.2249401,-.2249404,0,-.0420569,1.0420571,0,-.0196376,-.0786361,1.0982735),Xe={[re]:{transfer:ae,primaries:ue,toReference:t=>t,fromReference:t=>t},[ne]:{transfer:se,primaries:ue,toReference:t=>t.convertSRGBToLinear(),fromReference:t=>t.convertLinearToSRGB()},[oe]:{transfer:ae,primaries:ce,toReference:t=>t.applyMatrix3(qe),fromReference:t=>t.applyMatrix3(We)},[ie]:{transfer:se,primaries:ce,toReference:t=>t.convertSRGBToLinear().applyMatrix3(qe),fromReference:t=>t.applyMatrix3(We).convertLinearToSRGB()}},Ye=new Set([re,oe]),Je={enabled:!0,_workingColorSpace:re,get workingColorSpace(){return this._workingColorSpace},set workingColorSpace(t){if(!Ye.has(t))throw new Error(`Unsupported working color space, "${t}".`);this._workingColorSpace=t},convert:function(t,e,n){if(!1===this.enabled||e===n||!e||!n)return t;const r=Xe[e].toReference;return(0,Xe[n].fromReference)(r(t))},fromWorkingColorSpace:function(t,e){return this.convert(t,this._workingColorSpace,e)},toWorkingColorSpace:function(t,e){return this.convert(t,e,this._workingColorSpace)},getPrimaries:function(t){return Xe[t].primaries},getTransfer:function(t){return t===ee?ae:Xe[t].transfer}};function Ze(t){return t<.04045?.0773993808*t:Math.pow(.9478672986*t+.0521327014,2.4)}function Ke(t){return t<.0031308?12.92*t:1.055*Math.pow(t,.41666)-.055}let Qe;class $e{static getDataURL(t){if(/^data:/i.test(t.src))return t.src;if("undefined"==typeof HTMLCanvasElement)return t.src;let e;if(t instanceof HTMLCanvasElement)e=t;else{void 0===Qe&&(Qe=ze("canvas")),Qe.width=t.width,Qe.height=t.height;const n=Qe.getContext("2d");t instanceof ImageData?n.putImageData(t,0,0):n.drawImage(t,0,0,t.width,t.height),e=Qe}return e.width>2048||e.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",t),e.toDataURL("image/jpeg",.6)):e.toDataURL("image/png")}static sRGBToLinear(t){if("undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap){const e=ze("canvas");e.width=t.width,e.height=t.height;const n=e.getContext("2d");n.drawImage(t,0,0,t.width,t.height);const r=n.getImageData(0,0,t.width,t.height),i=r.data;for(let t=0;t<i.length;t++)i[t]=255*Ze(i[t]/255);return n.putImageData(r,0,0),e}if(t.data){const e=t.data.slice(0);for(let t=0;t<e.length;t++)e instanceof Uint8Array||e instanceof Uint8ClampedArray?e[t]=Math.floor(255*Ze(e[t]/255)):e[t]=Ze(e[t]);return{data:e,width:t.width,height:t.height}}return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),t}}let tn=0;class en{constructor(t=null){this.isSource=!0,Object.defineProperty(this,"id",{value:tn++}),this.uuid=Oe(),this.data=t,this.dataReady=!0,this.version=0}set needsUpdate(t){!0===t&&this.version++}toJSON(t){const e=void 0===t||"string"==typeof t;if(!e&&void 0!==t.images[this.uuid])return t.images[this.uuid];const n={uuid:this.uuid,url:""},r=this.data;if(null!==r){let t;if(Array.isArray(r)){t=[];for(let e=0,n=r.length;e<n;e++)r[e].isDataTexture?t.push(nn(r[e].image)):t.push(nn(r[e]))}else t=nn(r);n.url=t}return e||(t.images[this.uuid]=n),n}}function nn(t){return"undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap?$e.getDataURL(t):t.data?{data:Array.from(t.data),width:t.width,height:t.height,type:t.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let rn=0;class on extends Se{constructor(t=on.DEFAULT_IMAGE,e=on.DEFAULT_MAPPING,n=1001,r=1001,i=1006,o=1008,a=1023,s=1009,u=on.DEFAULT_ANISOTROPY,c=""){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:rn++}),this.uuid=Oe(),this.name="",this.source=new en(t),this.mipmaps=[],this.mapping=e,this.channel=0,this.wrapS=n,this.wrapT=r,this.magFilter=i,this.minFilter=o,this.anisotropy=u,this.format=a,this.internalFormat=null,this.type=s,this.offset=new je(0,0),this.repeat=new je(1,1),this.center=new je(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Ie,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=c,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.pmremVersion=0}get image(){return this.source.data}set image(t=null){this.source.data=t}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return(new this.constructor).copy(this)}copy(t){return this.name=t.name,this.source=t.source,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.channel=t.channel,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.internalFormat=t.internalFormat,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.colorSpace=t.colorSpace,this.userData=JSON.parse(JSON.stringify(t.userData)),this.needsUpdate=!0,this}toJSON(t){const e=void 0===t||"string"==typeof t;if(!e&&void 0!==t.textures[this.uuid])return t.textures[this.uuid];const n={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(t).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(n.userData=this.userData),e||(t.textures[this.uuid]=n),n}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(t){if(this.mapping!==F)return t;if(t.applyMatrix3(this.matrix),t.x<0||t.x>1)switch(this.wrapS){case q:t.x=t.x-Math.floor(t.x);break;case X:t.x=t.x<0?0:1;break;case Y:1===Math.abs(Math.floor(t.x)%2)?t.x=Math.ceil(t.x)-t.x:t.x=t.x-Math.floor(t.x)}if(t.y<0||t.y>1)switch(this.wrapT){case q:t.y=t.y-Math.floor(t.y);break;case X:t.y=t.y<0?0:1;break;case Y:1===Math.abs(Math.floor(t.y)%2)?t.y=Math.ceil(t.y)-t.y:t.y=t.y-Math.floor(t.y)}return this.flipY&&(t.y=1-t.y),t}set needsUpdate(t){!0===t&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(t){!0===t&&this.pmremVersion++}}on.DEFAULT_IMAGE=null,on.DEFAULT_MAPPING=F,on.DEFAULT_ANISOTROPY=1;class an{constructor(t=0,e=0,n=0,r=1){an.prototype.isVector4=!0,this.x=t,this.y=e,this.z=n,this.w=r}get width(){return this.z}set width(t){this.z=t}get height(){return this.w}set height(t){this.w=t}set(t,e,n,r){return this.x=t,this.y=e,this.z=n,this.w=r,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this.w=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setW(t){return this.w=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;case 3:this.w=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=void 0!==t.w?t.w:1,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.w=t.w+e.w,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this.w+=t.w*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}applyMatrix4(t){const e=this.x,n=this.y,r=this.z,i=this.w,o=t.elements;return this.x=o[0]*e+o[4]*n+o[8]*r+o[12]*i,this.y=o[1]*e+o[5]*n+o[9]*r+o[13]*i,this.z=o[2]*e+o[6]*n+o[10]*r+o[14]*i,this.w=o[3]*e+o[7]*n+o[11]*r+o[15]*i,this}divideScalar(t){return this.multiplyScalar(1/t)}setAxisAngleFromQuaternion(t){this.w=2*Math.acos(t.w);const e=Math.sqrt(1-t.w*t.w);return e<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/e,this.y=t.y/e,this.z=t.z/e),this}setAxisAngleFromRotationMatrix(t){let e,n,r,i;const o=.01,a=.1,s=t.elements,u=s[0],c=s[4],l=s[8],f=s[1],h=s[5],p=s[9],d=s[2],m=s[6],y=s[10];if(Math.abs(c-f)<o&&Math.abs(l-d)<o&&Math.abs(p-m)<o){if(Math.abs(c+f)<a&&Math.abs(l+d)<a&&Math.abs(p+m)<a&&Math.abs(u+h+y-3)<a)return this.set(1,0,0,0),this;e=Math.PI;const t=(u+1)/2,s=(h+1)/2,v=(y+1)/2,g=(c+f)/4,b=(l+d)/4,_=(p+m)/4;return t>s&&t>v?t<o?(n=0,r=.707106781,i=.707106781):(n=Math.sqrt(t),r=g/n,i=b/n):s>v?s<o?(n=.707106781,r=0,i=.707106781):(r=Math.sqrt(s),n=g/r,i=_/r):v<o?(n=.707106781,r=.707106781,i=0):(i=Math.sqrt(v),n=b/i,r=_/i),this.set(n,r,i,e),this}let v=Math.sqrt((m-p)*(m-p)+(l-d)*(l-d)+(f-c)*(f-c));return Math.abs(v)<.001&&(v=1),this.x=(m-p)/v,this.y=(l-d)/v,this.z=(f-c)/v,this.w=Math.acos((u+h+y-1)/2),this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this.w=Math.max(t.w,Math.min(e.w,this.w)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this.w=Math.max(t,Math.min(e,this.w)),this}clampLength(t,e){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this}lerpVectors(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this.z=t.z+(e.z-t.z)*n,this.w=t.w+(e.w-t.w)*n,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this.w=t.getW(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class sn extends Se{constructor(t=1,e=1,n={}){super(),this.isRenderTarget=!0,this.width=t,this.height=e,this.depth=1,this.scissor=new an(0,0,t,e),this.scissorTest=!1,this.viewport=new an(0,0,t,e);const r={width:t,height:e,depth:1};n=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:Q,depthBuffer:!0,stencilBuffer:!1,depthTexture:null,samples:0,count:1},n);const i=new on(r,n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.colorSpace);i.flipY=!1,i.generateMipmaps=n.generateMipmaps,i.internalFormat=n.internalFormat,this.textures=[];const o=n.count;for(let t=0;t<o;t++)this.textures[t]=i.clone(),this.textures[t].isRenderTargetTexture=!0;this.depthBuffer=n.depthBuffer,this.stencilBuffer=n.stencilBuffer,this.depthTexture=n.depthTexture,this.samples=n.samples}get texture(){return this.textures[0]}set texture(t){this.textures[0]=t}setSize(t,e,n=1){if(this.width!==t||this.height!==e||this.depth!==n){this.width=t,this.height=e,this.depth=n;for(let r=0,i=this.textures.length;r<i;r++)this.textures[r].image.width=t,this.textures[r].image.height=e,this.textures[r].image.depth=n;this.dispose()}this.viewport.set(0,0,t,e),this.scissor.set(0,0,t,e)}clone(){return(new this.constructor).copy(this)}copy(t){this.width=t.width,this.height=t.height,this.depth=t.depth,this.scissor.copy(t.scissor),this.scissorTest=t.scissorTest,this.viewport.copy(t.viewport),this.textures.length=0;for(let e=0,n=t.textures.length;e<n;e++)this.textures[e]=t.textures[e].clone(),this.textures[e].isRenderTargetTexture=!0;const e=Object.assign({},t.texture.image);return this.texture.source=new en(e),this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,null!==t.depthTexture&&(this.depthTexture=t.depthTexture.clone()),this.samples=t.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class un extends sn{constructor(t=1,e=1,n={}){super(t,e,n),this.isWebGLRenderTarget=!0}}class cn extends on{constructor(t=null,e=1,n=1,r=1){super(null),this.isDataArrayTexture=!0,this.image={data:t,width:e,height:n,depth:r},this.magFilter=J,this.minFilter=J,this.wrapR=X,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class ln extends on{constructor(t=null,e=1,n=1,r=1){super(null),this.isData3DTexture=!0,this.image={data:t,width:e,height:n,depth:r},this.magFilter=J,this.minFilter=J,this.wrapR=X,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class fn{constructor(t=0,e=0,n=0,r=1){this.isQuaternion=!0,this._x=t,this._y=e,this._z=n,this._w=r}static slerpFlat(t,e,n,r,i,o,a){let s=n[r+0],u=n[r+1],c=n[r+2],l=n[r+3];const f=i[o+0],h=i[o+1],p=i[o+2],d=i[o+3];if(0===a)return t[e+0]=s,t[e+1]=u,t[e+2]=c,void(t[e+3]=l);if(1===a)return t[e+0]=f,t[e+1]=h,t[e+2]=p,void(t[e+3]=d);if(l!==d||s!==f||u!==h||c!==p){let t=1-a;const e=s*f+u*h+c*p+l*d,n=e>=0?1:-1,r=1-e*e;if(r>Number.EPSILON){const i=Math.sqrt(r),o=Math.atan2(i,e*n);t=Math.sin(t*o)/i,a=Math.sin(a*o)/i}const i=a*n;if(s=s*t+f*i,u=u*t+h*i,c=c*t+p*i,l=l*t+d*i,t===1-a){const t=1/Math.sqrt(s*s+u*u+c*c+l*l);s*=t,u*=t,c*=t,l*=t}}t[e]=s,t[e+1]=u,t[e+2]=c,t[e+3]=l}static multiplyQuaternionsFlat(t,e,n,r,i,o){const a=n[r],s=n[r+1],u=n[r+2],c=n[r+3],l=i[o],f=i[o+1],h=i[o+2],p=i[o+3];return t[e]=a*p+c*l+s*h-u*f,t[e+1]=s*p+c*f+u*l-a*h,t[e+2]=u*p+c*h+a*f-s*l,t[e+3]=c*p-a*l-s*f-u*h,t}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get w(){return this._w}set w(t){this._w=t,this._onChangeCallback()}set(t,e,n,r){return this._x=t,this._y=e,this._z=n,this._w=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this}setFromEuler(t,e=!0){const n=t._x,r=t._y,i=t._z,o=t._order,a=Math.cos,s=Math.sin,u=a(n/2),c=a(r/2),l=a(i/2),f=s(n/2),h=s(r/2),p=s(i/2);switch(o){case"XYZ":this._x=f*c*l+u*h*p,this._y=u*h*l-f*c*p,this._z=u*c*p+f*h*l,this._w=u*c*l-f*h*p;break;case"YXZ":this._x=f*c*l+u*h*p,this._y=u*h*l-f*c*p,this._z=u*c*p-f*h*l,this._w=u*c*l+f*h*p;break;case"ZXY":this._x=f*c*l-u*h*p,this._y=u*h*l+f*c*p,this._z=u*c*p+f*h*l,this._w=u*c*l-f*h*p;break;case"ZYX":this._x=f*c*l-u*h*p,this._y=u*h*l+f*c*p,this._z=u*c*p-f*h*l,this._w=u*c*l+f*h*p;break;case"YZX":this._x=f*c*l+u*h*p,this._y=u*h*l+f*c*p,this._z=u*c*p-f*h*l,this._w=u*c*l-f*h*p;break;case"XZY":this._x=f*c*l-u*h*p,this._y=u*h*l-f*c*p,this._z=u*c*p+f*h*l,this._w=u*c*l+f*h*p;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+o)}return!0===e&&this._onChangeCallback(),this}setFromAxisAngle(t,e){const n=e/2,r=Math.sin(n);return this._x=t.x*r,this._y=t.y*r,this._z=t.z*r,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(t){const e=t.elements,n=e[0],r=e[4],i=e[8],o=e[1],a=e[5],s=e[9],u=e[2],c=e[6],l=e[10],f=n+a+l;if(f>0){const t=.5/Math.sqrt(f+1);this._w=.25/t,this._x=(c-s)*t,this._y=(i-u)*t,this._z=(o-r)*t}else if(n>a&&n>l){const t=2*Math.sqrt(1+n-a-l);this._w=(c-s)/t,this._x=.25*t,this._y=(r+o)/t,this._z=(i+u)/t}else if(a>l){const t=2*Math.sqrt(1+a-n-l);this._w=(i-u)/t,this._x=(r+o)/t,this._y=.25*t,this._z=(s+c)/t}else{const t=2*Math.sqrt(1+l-n-a);this._w=(o-r)/t,this._x=(i+u)/t,this._y=(s+c)/t,this._z=.25*t}return this._onChangeCallback(),this}setFromUnitVectors(t,e){let n=t.dot(e)+1;return n<Number.EPSILON?(n=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=n):(this._x=0,this._y=-t.z,this._z=t.y,this._w=n)):(this._x=t.y*e.z-t.z*e.y,this._y=t.z*e.x-t.x*e.z,this._z=t.x*e.y-t.y*e.x,this._w=n),this.normalize()}angleTo(t){return 2*Math.acos(Math.abs(Pe(this.dot(t),-1,1)))}rotateTowards(t,e){const n=this.angleTo(t);if(0===n)return this;const r=Math.min(1,e/n);return this.slerp(t,r),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let t=this.length();return 0===t?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this}multiply(t){return this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,e){const n=t._x,r=t._y,i=t._z,o=t._w,a=e._x,s=e._y,u=e._z,c=e._w;return this._x=n*c+o*a+r*u-i*s,this._y=r*c+o*s+i*a-n*u,this._z=i*c+o*u+n*s-r*a,this._w=o*c-n*a-r*s-i*u,this._onChangeCallback(),this}slerp(t,e){if(0===e)return this;if(1===e)return this.copy(t);const n=this._x,r=this._y,i=this._z,o=this._w;let a=o*t._w+n*t._x+r*t._y+i*t._z;if(a<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,a=-a):this.copy(t),a>=1)return this._w=o,this._x=n,this._y=r,this._z=i,this;const s=1-a*a;if(s<=Number.EPSILON){const t=1-e;return this._w=t*o+e*this._w,this._x=t*n+e*this._x,this._y=t*r+e*this._y,this._z=t*i+e*this._z,this.normalize(),this}const u=Math.sqrt(s),c=Math.atan2(u,a),l=Math.sin((1-e)*c)/u,f=Math.sin(e*c)/u;return this._w=o*l+this._w*f,this._x=n*l+this._x*f,this._y=r*l+this._y*f,this._z=i*l+this._z*f,this._onChangeCallback(),this}slerpQuaternions(t,e,n){return this.copy(t).slerp(e,n)}random(){const t=2*Math.PI*Math.random(),e=2*Math.PI*Math.random(),n=Math.random(),r=Math.sqrt(1-n),i=Math.sqrt(n);return this.set(r*Math.sin(t),r*Math.cos(t),i*Math.sin(e),i*Math.cos(e))}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w}fromArray(t,e=0){return this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t}fromBufferAttribute(t,e){return this._x=t.getX(e),this._y=t.getY(e),this._z=t.getZ(e),this._w=t.getW(e),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class hn{constructor(t=0,e=0,n=0){hn.prototype.isVector3=!0,this.x=t,this.y=e,this.z=n}set(t,e,n){return void 0===n&&(n=this.z),this.x=t,this.y=e,this.z=n,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}multiplyVectors(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this}applyEuler(t){return this.applyQuaternion(dn.setFromEuler(t))}applyAxisAngle(t,e){return this.applyQuaternion(dn.setFromAxisAngle(t,e))}applyMatrix3(t){const e=this.x,n=this.y,r=this.z,i=t.elements;return this.x=i[0]*e+i[3]*n+i[6]*r,this.y=i[1]*e+i[4]*n+i[7]*r,this.z=i[2]*e+i[5]*n+i[8]*r,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){const e=this.x,n=this.y,r=this.z,i=t.elements,o=1/(i[3]*e+i[7]*n+i[11]*r+i[15]);return this.x=(i[0]*e+i[4]*n+i[8]*r+i[12])*o,this.y=(i[1]*e+i[5]*n+i[9]*r+i[13])*o,this.z=(i[2]*e+i[6]*n+i[10]*r+i[14])*o,this}applyQuaternion(t){const e=this.x,n=this.y,r=this.z,i=t.x,o=t.y,a=t.z,s=t.w,u=2*(o*r-a*n),c=2*(a*e-i*r),l=2*(i*n-o*e);return this.x=e+s*u+o*l-a*c,this.y=n+s*c+a*u-i*l,this.z=r+s*l+i*c-o*u,this}project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}transformDirection(t){const e=this.x,n=this.y,r=this.z,i=t.elements;return this.x=i[0]*e+i[4]*n+i[8]*r,this.y=i[1]*e+i[5]*n+i[9]*r,this.z=i[2]*e+i[6]*n+i[10]*r,this.normalize()}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this}clampLength(t,e){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this}lerpVectors(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this.z=t.z+(e.z-t.z)*n,this}cross(t){return this.crossVectors(this,t)}crossVectors(t,e){const n=t.x,r=t.y,i=t.z,o=e.x,a=e.y,s=e.z;return this.x=r*s-i*a,this.y=i*o-n*s,this.z=n*a-r*o,this}projectOnVector(t){const e=t.lengthSq();if(0===e)return this.set(0,0,0);const n=t.dot(this)/e;return this.copy(t).multiplyScalar(n)}projectOnPlane(t){return pn.copy(this).projectOnVector(t),this.sub(pn)}reflect(t){return this.sub(pn.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(0===e)return Math.PI/2;const n=this.dot(t)/e;return Math.acos(Pe(n,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,n=this.y-t.y,r=this.z-t.z;return e*e+n*n+r*r}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,e,n){const r=Math.sin(e)*t;return this.x=r*Math.sin(n),this.y=Math.cos(e)*t,this.z=r*Math.cos(n),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,e,n){return this.x=t*Math.sin(e),this.y=n,this.z=t*Math.cos(e),this}setFromMatrixPosition(t){const e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this}setFromMatrixScale(t){const e=this.setFromMatrixColumn(t,0).length(),n=this.setFromMatrixColumn(t,1).length(),r=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=n,this.z=r,this}setFromMatrixColumn(t,e){return this.fromArray(t.elements,4*e)}setFromMatrix3Column(t,e){return this.fromArray(t.elements,3*e)}setFromEuler(t){return this.x=t._x,this.y=t._y,this.z=t._z,this}setFromColor(t){return this.x=t.r,this.y=t.g,this.z=t.b,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const t=Math.random()*Math.PI*2,e=2*Math.random()-1,n=Math.sqrt(1-e*e);return this.x=n*Math.cos(t),this.y=e,this.z=n*Math.sin(t),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const pn=new hn,dn=new fn;class mn{constructor(t=new hn(1/0,1/0,1/0),e=new hn(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=t,this.max=e}set(t,e){return this.min.copy(t),this.max.copy(e),this}setFromArray(t){this.makeEmpty();for(let e=0,n=t.length;e<n;e+=3)this.expandByPoint(vn.fromArray(t,e));return this}setFromBufferAttribute(t){this.makeEmpty();for(let e=0,n=t.count;e<n;e++)this.expandByPoint(vn.fromBufferAttribute(t,e));return this}setFromPoints(t){this.makeEmpty();for(let e=0,n=t.length;e<n;e++)this.expandByPoint(t[e]);return this}setFromCenterAndSize(t,e){const n=vn.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(n),this.max.copy(t).add(n),this}setFromObject(t,e=!1){return this.makeEmpty(),this.expandByObject(t,e)}clone(){return(new this.constructor).copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(t){return this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}expandByObject(t,e=!1){t.updateWorldMatrix(!1,!1);const n=t.geometry;if(void 0!==n){const r=n.getAttribute("position");if(!0===e&&void 0!==r&&!0!==t.isInstancedMesh)for(let e=0,n=r.count;e<n;e++)!0===t.isMesh?t.getVertexPosition(e,vn):vn.fromBufferAttribute(r,e),vn.applyMatrix4(t.matrixWorld),this.expandByPoint(vn);else void 0!==t.boundingBox?(null===t.boundingBox&&t.computeBoundingBox(),gn.copy(t.boundingBox)):(null===n.boundingBox&&n.computeBoundingBox(),gn.copy(n.boundingBox)),gn.applyMatrix4(t.matrixWorld),this.union(gn)}const r=t.children;for(let t=0,n=r.length;t<n;t++)this.expandByObject(r[t],e);return this}containsPoint(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y||t.z<this.min.z||t.z>this.max.z)}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z}getParameter(t,e){return e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z)}intersectsSphere(t){return this.clampPoint(t.center,vn),vn.distanceToSquared(t.center)<=t.radius*t.radius}intersectsPlane(t){let e,n;return t.normal.x>0?(e=t.normal.x*this.min.x,n=t.normal.x*this.max.x):(e=t.normal.x*this.max.x,n=t.normal.x*this.min.x),t.normal.y>0?(e+=t.normal.y*this.min.y,n+=t.normal.y*this.max.y):(e+=t.normal.y*this.max.y,n+=t.normal.y*this.min.y),t.normal.z>0?(e+=t.normal.z*this.min.z,n+=t.normal.z*this.max.z):(e+=t.normal.z*this.max.z,n+=t.normal.z*this.min.z),e<=-t.constant&&n>=-t.constant}intersectsTriangle(t){if(this.isEmpty())return!1;this.getCenter(Mn),En.subVectors(this.max,Mn),bn.subVectors(t.a,Mn),_n.subVectors(t.b,Mn),xn.subVectors(t.c,Mn),wn.subVectors(_n,bn),Sn.subVectors(xn,_n),Tn.subVectors(bn,xn);let e=[0,-wn.z,wn.y,0,-Sn.z,Sn.y,0,-Tn.z,Tn.y,wn.z,0,-wn.x,Sn.z,0,-Sn.x,Tn.z,0,-Tn.x,-wn.y,wn.x,0,-Sn.y,Sn.x,0,-Tn.y,Tn.x,0];return!!Pn(e,bn,_n,xn,En)&&(e=[1,0,0,0,1,0,0,0,1],!!Pn(e,bn,_n,xn,En)&&(An.crossVectors(wn,Sn),e=[An.x,An.y,An.z],Pn(e,bn,_n,xn,En)))}clampPoint(t,e){return e.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return this.clampPoint(t,vn).distanceTo(t)}getBoundingSphere(t){return this.isEmpty()?t.makeEmpty():(this.getCenter(t.center),t.radius=.5*this.getSize(vn).length()),t}intersect(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}applyMatrix4(t){return this.isEmpty()||(yn[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),yn[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),yn[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),yn[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),yn[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),yn[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),yn[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),yn[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(yn)),this}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}const yn=[new hn,new hn,new hn,new hn,new hn,new hn,new hn,new hn],vn=new hn,gn=new mn,bn=new hn,_n=new hn,xn=new hn,wn=new hn,Sn=new hn,Tn=new hn,Mn=new hn,En=new hn,An=new hn,On=new hn;function Pn(t,e,n,r,i){for(let o=0,a=t.length-3;o<=a;o+=3){On.fromArray(t,o);const a=i.x*Math.abs(On.x)+i.y*Math.abs(On.y)+i.z*Math.abs(On.z),s=e.dot(On),u=n.dot(On),c=r.dot(On);if(Math.max(-Math.max(s,u,c),Math.min(s,u,c))>a)return!1}return!0}const Rn=new mn,kn=new hn,Cn=new hn;class Nn{constructor(t=new hn,e=-1){this.isSphere=!0,this.center=t,this.radius=e}set(t,e){return this.center.copy(t),this.radius=e,this}setFromPoints(t,e){const n=this.center;void 0!==e?n.copy(e):Rn.setFromPoints(t).getCenter(n);let r=0;for(let e=0,i=t.length;e<i;e++)r=Math.max(r,n.distanceToSquared(t[e]));return this.radius=Math.sqrt(r),this}copy(t){return this.center.copy(t.center),this.radius=t.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(t){return t.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(t){return t.distanceTo(this.center)-this.radius}intersectsSphere(t){const e=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=e*e}intersectsBox(t){return t.intersectsSphere(this)}intersectsPlane(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius}clampPoint(t,e){const n=this.center.distanceToSquared(t);return e.copy(t),n>this.radius*this.radius&&(e.sub(this.center).normalize(),e.multiplyScalar(this.radius).add(this.center)),e}getBoundingBox(t){return this.isEmpty()?(t.makeEmpty(),t):(t.set(this.center,this.center),t.expandByScalar(this.radius),t)}applyMatrix4(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this}translate(t){return this.center.add(t),this}expandByPoint(t){if(this.isEmpty())return this.center.copy(t),this.radius=0,this;kn.subVectors(t,this.center);const e=kn.lengthSq();if(e>this.radius*this.radius){const t=Math.sqrt(e),n=.5*(t-this.radius);this.center.addScaledVector(kn,n/t),this.radius+=n}return this}union(t){return t.isEmpty()?this:this.isEmpty()?(this.copy(t),this):(!0===this.center.equals(t.center)?this.radius=Math.max(this.radius,t.radius):(Cn.subVectors(t.center,this.center).setLength(t.radius),this.expandByPoint(kn.copy(t.center).add(Cn)),this.expandByPoint(kn.copy(t.center).sub(Cn))),this)}equals(t){return t.center.equals(this.center)&&t.radius===this.radius}clone(){return(new this.constructor).copy(this)}}const Ln=new hn,jn=new hn,In=new hn,Bn=new hn,Un=new hn,Dn=new hn,Fn=new hn;class zn{constructor(t=new hn,e=new hn(0,0,-1)){this.origin=t,this.direction=e}set(t,e){return this.origin.copy(t),this.direction.copy(e),this}copy(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this}at(t,e){return e.copy(this.origin).addScaledVector(this.direction,t)}lookAt(t){return this.direction.copy(t).sub(this.origin).normalize(),this}recast(t){return this.origin.copy(this.at(t,Ln)),this}closestPointToPoint(t,e){e.subVectors(t,this.origin);const n=e.dot(this.direction);return n<0?e.copy(this.origin):e.copy(this.origin).addScaledVector(this.direction,n)}distanceToPoint(t){return Math.sqrt(this.distanceSqToPoint(t))}distanceSqToPoint(t){const e=Ln.subVectors(t,this.origin).dot(this.direction);return e<0?this.origin.distanceToSquared(t):(Ln.copy(this.origin).addScaledVector(this.direction,e),Ln.distanceToSquared(t))}distanceSqToSegment(t,e,n,r){jn.copy(t).add(e).multiplyScalar(.5),In.copy(e).sub(t).normalize(),Bn.copy(this.origin).sub(jn);const i=.5*t.distanceTo(e),o=-this.direction.dot(In),a=Bn.dot(this.direction),s=-Bn.dot(In),u=Bn.lengthSq(),c=Math.abs(1-o*o);let l,f,h,p;if(c>0)if(l=o*s-a,f=o*a-s,p=i*c,l>=0)if(f>=-p)if(f<=p){const t=1/c;l*=t,f*=t,h=l*(l+o*f+2*a)+f*(o*l+f+2*s)+u}else f=i,l=Math.max(0,-(o*f+a)),h=-l*l+f*(f+2*s)+u;else f=-i,l=Math.max(0,-(o*f+a)),h=-l*l+f*(f+2*s)+u;else f<=-p?(l=Math.max(0,-(-o*i+a)),f=l>0?-i:Math.min(Math.max(-i,-s),i),h=-l*l+f*(f+2*s)+u):f<=p?(l=0,f=Math.min(Math.max(-i,-s),i),h=f*(f+2*s)+u):(l=Math.max(0,-(o*i+a)),f=l>0?i:Math.min(Math.max(-i,-s),i),h=-l*l+f*(f+2*s)+u);else f=o>0?-i:i,l=Math.max(0,-(o*f+a)),h=-l*l+f*(f+2*s)+u;return n&&n.copy(this.origin).addScaledVector(this.direction,l),r&&r.copy(jn).addScaledVector(In,f),h}intersectSphere(t,e){Ln.subVectors(t.center,this.origin);const n=Ln.dot(this.direction),r=Ln.dot(Ln)-n*n,i=t.radius*t.radius;if(r>i)return null;const o=Math.sqrt(i-r),a=n-o,s=n+o;return s<0?null:a<0?this.at(s,e):this.at(a,e)}intersectsSphere(t){return this.distanceSqToPoint(t.center)<=t.radius*t.radius}distanceToPlane(t){const e=t.normal.dot(this.direction);if(0===e)return 0===t.distanceToPoint(this.origin)?0:null;const n=-(this.origin.dot(t.normal)+t.constant)/e;return n>=0?n:null}intersectPlane(t,e){const n=this.distanceToPlane(t);return null===n?null:this.at(n,e)}intersectsPlane(t){const e=t.distanceToPoint(this.origin);return 0===e||t.normal.dot(this.direction)*e<0}intersectBox(t,e){let n,r,i,o,a,s;const u=1/this.direction.x,c=1/this.direction.y,l=1/this.direction.z,f=this.origin;return u>=0?(n=(t.min.x-f.x)*u,r=(t.max.x-f.x)*u):(n=(t.max.x-f.x)*u,r=(t.min.x-f.x)*u),c>=0?(i=(t.min.y-f.y)*c,o=(t.max.y-f.y)*c):(i=(t.max.y-f.y)*c,o=(t.min.y-f.y)*c),n>o||i>r?null:((i>n||isNaN(n))&&(n=i),(o<r||isNaN(r))&&(r=o),l>=0?(a=(t.min.z-f.z)*l,s=(t.max.z-f.z)*l):(a=(t.max.z-f.z)*l,s=(t.min.z-f.z)*l),n>s||a>r?null:((a>n||n!=n)&&(n=a),(s<r||r!=r)&&(r=s),r<0?null:this.at(n>=0?n:r,e)))}intersectsBox(t){return null!==this.intersectBox(t,Ln)}intersectTriangle(t,e,n,r,i){Un.subVectors(e,t),Dn.subVectors(n,t),Fn.crossVectors(Un,Dn);let o,a=this.direction.dot(Fn);if(a>0){if(r)return null;o=1}else{if(!(a<0))return null;o=-1,a=-a}Bn.subVectors(this.origin,t);const s=o*this.direction.dot(Dn.crossVectors(Bn,Dn));if(s<0)return null;const u=o*this.direction.dot(Un.cross(Bn));if(u<0)return null;if(s+u>a)return null;const c=-o*Bn.dot(Fn);return c<0?null:this.at(c/a,i)}applyMatrix4(t){return this.origin.applyMatrix4(t),this.direction.transformDirection(t),this}equals(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}clone(){return(new this.constructor).copy(this)}}class Vn{constructor(t,e,n,r,i,o,a,s,u,c,l,f,h,p,d,m){Vn.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],void 0!==t&&this.set(t,e,n,r,i,o,a,s,u,c,l,f,h,p,d,m)}set(t,e,n,r,i,o,a,s,u,c,l,f,h,p,d,m){const y=this.elements;return y[0]=t,y[4]=e,y[8]=n,y[12]=r,y[1]=i,y[5]=o,y[9]=a,y[13]=s,y[2]=u,y[6]=c,y[10]=l,y[14]=f,y[3]=h,y[7]=p,y[11]=d,y[15]=m,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new Vn).fromArray(this.elements)}copy(t){const e=this.elements,n=t.elements;return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],e[9]=n[9],e[10]=n[10],e[11]=n[11],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15],this}copyPosition(t){const e=this.elements,n=t.elements;return e[12]=n[12],e[13]=n[13],e[14]=n[14],this}setFromMatrix3(t){const e=t.elements;return this.set(e[0],e[3],e[6],0,e[1],e[4],e[7],0,e[2],e[5],e[8],0,0,0,0,1),this}extractBasis(t,e,n){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(t,e,n){return this.set(t.x,e.x,n.x,0,t.y,e.y,n.y,0,t.z,e.z,n.z,0,0,0,0,1),this}extractRotation(t){const e=this.elements,n=t.elements,r=1/Gn.setFromMatrixColumn(t,0).length(),i=1/Gn.setFromMatrixColumn(t,1).length(),o=1/Gn.setFromMatrixColumn(t,2).length();return e[0]=n[0]*r,e[1]=n[1]*r,e[2]=n[2]*r,e[3]=0,e[4]=n[4]*i,e[5]=n[5]*i,e[6]=n[6]*i,e[7]=0,e[8]=n[8]*o,e[9]=n[9]*o,e[10]=n[10]*o,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromEuler(t){const e=this.elements,n=t.x,r=t.y,i=t.z,o=Math.cos(n),a=Math.sin(n),s=Math.cos(r),u=Math.sin(r),c=Math.cos(i),l=Math.sin(i);if("XYZ"===t.order){const t=o*c,n=o*l,r=a*c,i=a*l;e[0]=s*c,e[4]=-s*l,e[8]=u,e[1]=n+r*u,e[5]=t-i*u,e[9]=-a*s,e[2]=i-t*u,e[6]=r+n*u,e[10]=o*s}else if("YXZ"===t.order){const t=s*c,n=s*l,r=u*c,i=u*l;e[0]=t+i*a,e[4]=r*a-n,e[8]=o*u,e[1]=o*l,e[5]=o*c,e[9]=-a,e[2]=n*a-r,e[6]=i+t*a,e[10]=o*s}else if("ZXY"===t.order){const t=s*c,n=s*l,r=u*c,i=u*l;e[0]=t-i*a,e[4]=-o*l,e[8]=r+n*a,e[1]=n+r*a,e[5]=o*c,e[9]=i-t*a,e[2]=-o*u,e[6]=a,e[10]=o*s}else if("ZYX"===t.order){const t=o*c,n=o*l,r=a*c,i=a*l;e[0]=s*c,e[4]=r*u-n,e[8]=t*u+i,e[1]=s*l,e[5]=i*u+t,e[9]=n*u-r,e[2]=-u,e[6]=a*s,e[10]=o*s}else if("YZX"===t.order){const t=o*s,n=o*u,r=a*s,i=a*u;e[0]=s*c,e[4]=i-t*l,e[8]=r*l+n,e[1]=l,e[5]=o*c,e[9]=-a*c,e[2]=-u*c,e[6]=n*l+r,e[10]=t-i*l}else if("XZY"===t.order){const t=o*s,n=o*u,r=a*s,i=a*u;e[0]=s*c,e[4]=-l,e[8]=u*c,e[1]=t*l+i,e[5]=o*c,e[9]=n*l-r,e[2]=r*l-n,e[6]=a*c,e[10]=i*l+t}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromQuaternion(t){return this.compose(Wn,t,qn)}lookAt(t,e,n){const r=this.elements;return Jn.subVectors(t,e),0===Jn.lengthSq()&&(Jn.z=1),Jn.normalize(),Xn.crossVectors(n,Jn),0===Xn.lengthSq()&&(1===Math.abs(n.z)?Jn.x+=1e-4:Jn.z+=1e-4,Jn.normalize(),Xn.crossVectors(n,Jn)),Xn.normalize(),Yn.crossVectors(Jn,Xn),r[0]=Xn.x,r[4]=Yn.x,r[8]=Jn.x,r[1]=Xn.y,r[5]=Yn.y,r[9]=Jn.y,r[2]=Xn.z,r[6]=Yn.z,r[10]=Jn.z,this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const n=t.elements,r=e.elements,i=this.elements,o=n[0],a=n[4],s=n[8],u=n[12],c=n[1],l=n[5],f=n[9],h=n[13],p=n[2],d=n[6],m=n[10],y=n[14],v=n[3],g=n[7],b=n[11],_=n[15],x=r[0],w=r[4],S=r[8],T=r[12],M=r[1],E=r[5],A=r[9],O=r[13],P=r[2],R=r[6],k=r[10],C=r[14],N=r[3],L=r[7],j=r[11],I=r[15];return i[0]=o*x+a*M+s*P+u*N,i[4]=o*w+a*E+s*R+u*L,i[8]=o*S+a*A+s*k+u*j,i[12]=o*T+a*O+s*C+u*I,i[1]=c*x+l*M+f*P+h*N,i[5]=c*w+l*E+f*R+h*L,i[9]=c*S+l*A+f*k+h*j,i[13]=c*T+l*O+f*C+h*I,i[2]=p*x+d*M+m*P+y*N,i[6]=p*w+d*E+m*R+y*L,i[10]=p*S+d*A+m*k+y*j,i[14]=p*T+d*O+m*C+y*I,i[3]=v*x+g*M+b*P+_*N,i[7]=v*w+g*E+b*R+_*L,i[11]=v*S+g*A+b*k+_*j,i[15]=v*T+g*O+b*C+_*I,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this}determinant(){const t=this.elements,e=t[0],n=t[4],r=t[8],i=t[12],o=t[1],a=t[5],s=t[9],u=t[13],c=t[2],l=t[6],f=t[10],h=t[14];return t[3]*(+i*s*l-r*u*l-i*a*f+n*u*f+r*a*h-n*s*h)+t[7]*(+e*s*h-e*u*f+i*o*f-r*o*h+r*u*c-i*s*c)+t[11]*(+e*u*l-e*a*h-i*o*l+n*o*h+i*a*c-n*u*c)+t[15]*(-r*a*c-e*s*l+e*a*f+r*o*l-n*o*f+n*s*c)}transpose(){const t=this.elements;let e;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this}setPosition(t,e,n){const r=this.elements;return t.isVector3?(r[12]=t.x,r[13]=t.y,r[14]=t.z):(r[12]=t,r[13]=e,r[14]=n),this}invert(){const t=this.elements,e=t[0],n=t[1],r=t[2],i=t[3],o=t[4],a=t[5],s=t[6],u=t[7],c=t[8],l=t[9],f=t[10],h=t[11],p=t[12],d=t[13],m=t[14],y=t[15],v=l*m*u-d*f*u+d*s*h-a*m*h-l*s*y+a*f*y,g=p*f*u-c*m*u-p*s*h+o*m*h+c*s*y-o*f*y,b=c*d*u-p*l*u+p*a*h-o*d*h-c*a*y+o*l*y,_=p*l*s-c*d*s-p*a*f+o*d*f+c*a*m-o*l*m,x=e*v+n*g+r*b+i*_;if(0===x)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const w=1/x;return t[0]=v*w,t[1]=(d*f*i-l*m*i-d*r*h+n*m*h+l*r*y-n*f*y)*w,t[2]=(a*m*i-d*s*i+d*r*u-n*m*u-a*r*y+n*s*y)*w,t[3]=(l*s*i-a*f*i-l*r*u+n*f*u+a*r*h-n*s*h)*w,t[4]=g*w,t[5]=(c*m*i-p*f*i+p*r*h-e*m*h-c*r*y+e*f*y)*w,t[6]=(p*s*i-o*m*i-p*r*u+e*m*u+o*r*y-e*s*y)*w,t[7]=(o*f*i-c*s*i+c*r*u-e*f*u-o*r*h+e*s*h)*w,t[8]=b*w,t[9]=(p*l*i-c*d*i-p*n*h+e*d*h+c*n*y-e*l*y)*w,t[10]=(o*d*i-p*a*i+p*n*u-e*d*u-o*n*y+e*a*y)*w,t[11]=(c*a*i-o*l*i-c*n*u+e*l*u+o*n*h-e*a*h)*w,t[12]=_*w,t[13]=(c*d*r-p*l*r+p*n*f-e*d*f-c*n*m+e*l*m)*w,t[14]=(p*a*r-o*d*r-p*n*s+e*d*s+o*n*m-e*a*m)*w,t[15]=(o*l*r-c*a*r+c*n*s-e*l*s-o*n*f+e*a*f)*w,this}scale(t){const e=this.elements,n=t.x,r=t.y,i=t.z;return e[0]*=n,e[4]*=r,e[8]*=i,e[1]*=n,e[5]*=r,e[9]*=i,e[2]*=n,e[6]*=r,e[10]*=i,e[3]*=n,e[7]*=r,e[11]*=i,this}getMaxScaleOnAxis(){const t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],n=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],r=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,n,r))}makeTranslation(t,e,n){return t.isVector3?this.set(1,0,0,t.x,0,1,0,t.y,0,0,1,t.z,0,0,0,1):this.set(1,0,0,t,0,1,0,e,0,0,1,n,0,0,0,1),this}makeRotationX(t){const e=Math.cos(t),n=Math.sin(t);return this.set(1,0,0,0,0,e,-n,0,0,n,e,0,0,0,0,1),this}makeRotationY(t){const e=Math.cos(t),n=Math.sin(t);return this.set(e,0,n,0,0,1,0,0,-n,0,e,0,0,0,0,1),this}makeRotationZ(t){const e=Math.cos(t),n=Math.sin(t);return this.set(e,-n,0,0,n,e,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(t,e){const n=Math.cos(e),r=Math.sin(e),i=1-n,o=t.x,a=t.y,s=t.z,u=i*o,c=i*a;return this.set(u*o+n,u*a-r*s,u*s+r*a,0,u*a+r*s,c*a+n,c*s-r*o,0,u*s-r*a,c*s+r*o,i*s*s+n,0,0,0,0,1),this}makeScale(t,e,n){return this.set(t,0,0,0,0,e,0,0,0,0,n,0,0,0,0,1),this}makeShear(t,e,n,r,i,o){return this.set(1,n,i,0,t,1,o,0,e,r,1,0,0,0,0,1),this}compose(t,e,n){const r=this.elements,i=e._x,o=e._y,a=e._z,s=e._w,u=i+i,c=o+o,l=a+a,f=i*u,h=i*c,p=i*l,d=o*c,m=o*l,y=a*l,v=s*u,g=s*c,b=s*l,_=n.x,x=n.y,w=n.z;return r[0]=(1-(d+y))*_,r[1]=(h+b)*_,r[2]=(p-g)*_,r[3]=0,r[4]=(h-b)*x,r[5]=(1-(f+y))*x,r[6]=(m+v)*x,r[7]=0,r[8]=(p+g)*w,r[9]=(m-v)*w,r[10]=(1-(f+d))*w,r[11]=0,r[12]=t.x,r[13]=t.y,r[14]=t.z,r[15]=1,this}decompose(t,e,n){const r=this.elements;let i=Gn.set(r[0],r[1],r[2]).length();const o=Gn.set(r[4],r[5],r[6]).length(),a=Gn.set(r[8],r[9],r[10]).length();this.determinant()<0&&(i=-i),t.x=r[12],t.y=r[13],t.z=r[14],Hn.copy(this);const s=1/i,u=1/o,c=1/a;return Hn.elements[0]*=s,Hn.elements[1]*=s,Hn.elements[2]*=s,Hn.elements[4]*=u,Hn.elements[5]*=u,Hn.elements[6]*=u,Hn.elements[8]*=c,Hn.elements[9]*=c,Hn.elements[10]*=c,e.setFromRotationMatrix(Hn),n.x=i,n.y=o,n.z=a,this}makePerspective(t,e,n,r,i,o,a=2e3){const s=this.elements,u=2*i/(e-t),c=2*i/(n-r),l=(e+t)/(e-t),f=(n+r)/(n-r);let h,p;if(a===xe)h=-(o+i)/(o-i),p=-2*o*i/(o-i);else{if(a!==we)throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+a);h=-o/(o-i),p=-o*i/(o-i)}return s[0]=u,s[4]=0,s[8]=l,s[12]=0,s[1]=0,s[5]=c,s[9]=f,s[13]=0,s[2]=0,s[6]=0,s[10]=h,s[14]=p,s[3]=0,s[7]=0,s[11]=-1,s[15]=0,this}makeOrthographic(t,e,n,r,i,o,a=2e3){const s=this.elements,u=1/(e-t),c=1/(n-r),l=1/(o-i),f=(e+t)*u,h=(n+r)*c;let p,d;if(a===xe)p=(o+i)*l,d=-2*l;else{if(a!==we)throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+a);p=i*l,d=-1*l}return s[0]=2*u,s[4]=0,s[8]=0,s[12]=-f,s[1]=0,s[5]=2*c,s[9]=0,s[13]=-h,s[2]=0,s[6]=0,s[10]=d,s[14]=-p,s[3]=0,s[7]=0,s[11]=0,s[15]=1,this}equals(t){const e=this.elements,n=t.elements;for(let t=0;t<16;t++)if(e[t]!==n[t])return!1;return!0}fromArray(t,e=0){for(let n=0;n<16;n++)this.elements[n]=t[n+e];return this}toArray(t=[],e=0){const n=this.elements;return t[e]=n[0],t[e+1]=n[1],t[e+2]=n[2],t[e+3]=n[3],t[e+4]=n[4],t[e+5]=n[5],t[e+6]=n[6],t[e+7]=n[7],t[e+8]=n[8],t[e+9]=n[9],t[e+10]=n[10],t[e+11]=n[11],t[e+12]=n[12],t[e+13]=n[13],t[e+14]=n[14],t[e+15]=n[15],t}}const Gn=new hn,Hn=new Vn,Wn=new hn(0,0,0),qn=new hn(1,1,1),Xn=new hn,Yn=new hn,Jn=new hn,Zn=new Vn,Kn=new fn;class Qn{constructor(t=0,e=0,n=0,r=Qn.DEFAULT_ORDER){this.isEuler=!0,this._x=t,this._y=e,this._z=n,this._order=r}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get order(){return this._order}set order(t){this._order=t,this._onChangeCallback()}set(t,e,n,r=this._order){return this._x=t,this._y=e,this._z=n,this._order=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this}setFromRotationMatrix(t,e=this._order,n=!0){const r=t.elements,i=r[0],o=r[4],a=r[8],s=r[1],u=r[5],c=r[9],l=r[2],f=r[6],h=r[10];switch(e){case"XYZ":this._y=Math.asin(Pe(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-c,h),this._z=Math.atan2(-o,i)):(this._x=Math.atan2(f,u),this._z=0);break;case"YXZ":this._x=Math.asin(-Pe(c,-1,1)),Math.abs(c)<.9999999?(this._y=Math.atan2(a,h),this._z=Math.atan2(s,u)):(this._y=Math.atan2(-l,i),this._z=0);break;case"ZXY":this._x=Math.asin(Pe(f,-1,1)),Math.abs(f)<.9999999?(this._y=Math.atan2(-l,h),this._z=Math.atan2(-o,u)):(this._y=0,this._z=Math.atan2(s,i));break;case"ZYX":this._y=Math.asin(-Pe(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(f,h),this._z=Math.atan2(s,i)):(this._x=0,this._z=Math.atan2(-o,u));break;case"YZX":this._z=Math.asin(Pe(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(-c,u),this._y=Math.atan2(-l,i)):(this._x=0,this._y=Math.atan2(a,h));break;case"XZY":this._z=Math.asin(-Pe(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(f,u),this._y=Math.atan2(a,i)):(this._x=Math.atan2(-c,h),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+e)}return this._order=e,!0===n&&this._onChangeCallback(),this}setFromQuaternion(t,e,n){return Zn.makeRotationFromQuaternion(t),this.setFromRotationMatrix(Zn,e,n)}setFromVector3(t,e=this._order){return this.set(t.x,t.y,t.z,e)}reorder(t){return Kn.setFromEuler(this),this.setFromQuaternion(Kn,t)}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order}fromArray(t){return this._x=t[0],this._y=t[1],this._z=t[2],void 0!==t[3]&&(this._order=t[3]),this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}Qn.DEFAULT_ORDER="XYZ";class $n{constructor(){this.mask=1}set(t){this.mask=1<<t>>>0}enable(t){this.mask|=1<<t}enableAll(){this.mask=-1}toggle(t){this.mask^=1<<t}disable(t){this.mask&=~(1<<t)}disableAll(){this.mask=0}test(t){return!!(this.mask&t.mask)}isEnabled(t){return!!(this.mask&1<<t)}}let tr=0;const er=new hn,nr=new fn,rr=new Vn,ir=new hn,or=new hn,ar=new hn,sr=new fn,ur=new hn(1,0,0),cr=new hn(0,1,0),lr=new hn(0,0,1),fr={type:"added"},hr={type:"removed"},pr={type:"childadded",child:null},dr={type:"childremoved",child:null};class mr extends Se{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:tr++}),this.uuid=Oe(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=mr.DEFAULT_UP.clone();const t=new hn,e=new Qn,n=new fn,r=new hn(1,1,1);e._onChange((function(){n.setFromEuler(e,!1)})),n._onChange((function(){e.setFromQuaternion(n,void 0,!1)})),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:e},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:r},modelViewMatrix:{value:new Vn},normalMatrix:{value:new Ie}}),this.matrix=new Vn,this.matrixWorld=new Vn,this.matrixAutoUpdate=mr.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=mr.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new $n,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(t){return this.quaternion.premultiply(t),this}setRotationFromAxisAngle(t,e){this.quaternion.setFromAxisAngle(t,e)}setRotationFromEuler(t){this.quaternion.setFromEuler(t,!0)}setRotationFromMatrix(t){this.quaternion.setFromRotationMatrix(t)}setRotationFromQuaternion(t){this.quaternion.copy(t)}rotateOnAxis(t,e){return nr.setFromAxisAngle(t,e),this.quaternion.multiply(nr),this}rotateOnWorldAxis(t,e){return nr.setFromAxisAngle(t,e),this.quaternion.premultiply(nr),this}rotateX(t){return this.rotateOnAxis(ur,t)}rotateY(t){return this.rotateOnAxis(cr,t)}rotateZ(t){return this.rotateOnAxis(lr,t)}translateOnAxis(t,e){return er.copy(t).applyQuaternion(this.quaternion),this.position.add(er.multiplyScalar(e)),this}translateX(t){return this.translateOnAxis(ur,t)}translateY(t){return this.translateOnAxis(cr,t)}translateZ(t){return this.translateOnAxis(lr,t)}localToWorld(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(this.matrixWorld)}worldToLocal(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(rr.copy(this.matrixWorld).invert())}lookAt(t,e,n){t.isVector3?ir.copy(t):ir.set(t,e,n);const r=this.parent;this.updateWorldMatrix(!0,!1),or.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?rr.lookAt(or,ir,this.up):rr.lookAt(ir,or,this.up),this.quaternion.setFromRotationMatrix(rr),r&&(rr.extractRotation(r.matrixWorld),nr.setFromRotationMatrix(rr),this.quaternion.premultiply(nr.invert()))}add(t){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return t===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(t.removeFromParent(),t.parent=this,this.children.push(t),t.dispatchEvent(fr),pr.child=t,this.dispatchEvent(pr),pr.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this)}remove(t){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.remove(arguments[t]);return this}const e=this.children.indexOf(t);return-1!==e&&(t.parent=null,this.children.splice(e,1),t.dispatchEvent(hr),dr.child=t,this.dispatchEvent(dr),dr.child=null),this}removeFromParent(){const t=this.parent;return null!==t&&t.remove(this),this}clear(){return this.remove(...this.children)}attach(t){return this.updateWorldMatrix(!0,!1),rr.copy(this.matrixWorld).invert(),null!==t.parent&&(t.parent.updateWorldMatrix(!0,!1),rr.multiply(t.parent.matrixWorld)),t.applyMatrix4(rr),t.removeFromParent(),t.parent=this,this.children.push(t),t.updateWorldMatrix(!1,!0),t.dispatchEvent(fr),pr.child=t,this.dispatchEvent(pr),pr.child=null,this}getObjectById(t){return this.getObjectByProperty("id",t)}getObjectByName(t){return this.getObjectByProperty("name",t)}getObjectByProperty(t,e){if(this[t]===e)return this;for(let n=0,r=this.children.length;n<r;n++){const r=this.children[n].getObjectByProperty(t,e);if(void 0!==r)return r}}getObjectsByProperty(t,e,n=[]){this[t]===e&&n.push(this);const r=this.children;for(let i=0,o=r.length;i<o;i++)r[i].getObjectsByProperty(t,e,n);return n}getWorldPosition(t){return this.updateWorldMatrix(!0,!1),t.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(or,t,ar),t}getWorldScale(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(or,sr,t),t}getWorldDirection(t){this.updateWorldMatrix(!0,!1);const e=this.matrixWorld.elements;return t.set(e[8],e[9],e[10]).normalize()}raycast(){}traverse(t){t(this);const e=this.children;for(let n=0,r=e.length;n<r;n++)e[n].traverse(t)}traverseVisible(t){if(!1===this.visible)return;t(this);const e=this.children;for(let n=0,r=e.length;n<r;n++)e[n].traverseVisible(t)}traverseAncestors(t){const e=this.parent;null!==e&&(t(e),e.traverseAncestors(t))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);const e=this.children;for(let n=0,r=e.length;n<r;n++){const r=e[n];!0!==r.matrixWorldAutoUpdate&&!0!==t||r.updateMatrixWorld(t)}}updateWorldMatrix(t,e){const n=this.parent;if(!0===t&&null!==n&&!0===n.matrixWorldAutoUpdate&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===e){const t=this.children;for(let e=0,n=t.length;e<n;e++){const n=t[e];!0===n.matrixWorldAutoUpdate&&n.updateWorldMatrix(!1,!0)}}}toJSON(t){const e=void 0===t||"string"==typeof t,n={};e&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},n.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const r={};function i(e,n){return void 0===e[n.uuid]&&(e[n.uuid]=n.toJSON(t)),n.uuid}if(r.uuid=this.uuid,r.type=this.type,""!==this.name&&(r.name=this.name),!0===this.castShadow&&(r.castShadow=!0),!0===this.receiveShadow&&(r.receiveShadow=!0),!1===this.visible&&(r.visible=!1),!1===this.frustumCulled&&(r.frustumCulled=!1),0!==this.renderOrder&&(r.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(r.userData=this.userData),r.layers=this.layers.mask,r.matrix=this.matrix.toArray(),r.up=this.up.toArray(),!1===this.matrixAutoUpdate&&(r.matrixAutoUpdate=!1),this.isInstancedMesh&&(r.type="InstancedMesh",r.count=this.count,r.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(r.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(r.type="BatchedMesh",r.perObjectFrustumCulled=this.perObjectFrustumCulled,r.sortObjects=this.sortObjects,r.drawRanges=this._drawRanges,r.reservedRanges=this._reservedRanges,r.visibility=this._visibility,r.active=this._active,r.bounds=this._bounds.map((t=>({boxInitialized:t.boxInitialized,boxMin:t.box.min.toArray(),boxMax:t.box.max.toArray(),sphereInitialized:t.sphereInitialized,sphereRadius:t.sphere.radius,sphereCenter:t.sphere.center.toArray()}))),r.maxGeometryCount=this._maxGeometryCount,r.maxVertexCount=this._maxVertexCount,r.maxIndexCount=this._maxIndexCount,r.geometryInitialized=this._geometryInitialized,r.geometryCount=this._geometryCount,r.matricesTexture=this._matricesTexture.toJSON(t),null!==this.boundingSphere&&(r.boundingSphere={center:r.boundingSphere.center.toArray(),radius:r.boundingSphere.radius}),null!==this.boundingBox&&(r.boundingBox={min:r.boundingBox.min.toArray(),max:r.boundingBox.max.toArray()})),this.isScene)this.background&&(this.background.isColor?r.background=this.background.toJSON():this.background.isTexture&&(r.background=this.background.toJSON(t).uuid)),this.environment&&this.environment.isTexture&&!0!==this.environment.isRenderTargetTexture&&(r.environment=this.environment.toJSON(t).uuid);else if(this.isMesh||this.isLine||this.isPoints){r.geometry=i(t.geometries,this.geometry);const e=this.geometry.parameters;if(void 0!==e&&void 0!==e.shapes){const n=e.shapes;if(Array.isArray(n))for(let e=0,r=n.length;e<r;e++){const r=n[e];i(t.shapes,r)}else i(t.shapes,n)}}if(this.isSkinnedMesh&&(r.bindMode=this.bindMode,r.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(i(t.skeletons,this.skeleton),r.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){const e=[];for(let n=0,r=this.material.length;n<r;n++)e.push(i(t.materials,this.material[n]));r.material=e}else r.material=i(t.materials,this.material);if(this.children.length>0){r.children=[];for(let e=0;e<this.children.length;e++)r.children.push(this.children[e].toJSON(t).object)}if(this.animations.length>0){r.animations=[];for(let e=0;e<this.animations.length;e++){const n=this.animations[e];r.animations.push(i(t.animations,n))}}if(e){const e=o(t.geometries),r=o(t.materials),i=o(t.textures),a=o(t.images),s=o(t.shapes),u=o(t.skeletons),c=o(t.animations),l=o(t.nodes);e.length>0&&(n.geometries=e),r.length>0&&(n.materials=r),i.length>0&&(n.textures=i),a.length>0&&(n.images=a),s.length>0&&(n.shapes=s),u.length>0&&(n.skeletons=u),c.length>0&&(n.animations=c),l.length>0&&(n.nodes=l)}return n.object=r,n;function o(t){const e=[];for(const n in t){const r=t[n];delete r.metadata,e.push(r)}return e}}clone(t){return(new this.constructor).copy(this,t)}copy(t,e=!0){if(this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.rotation.order=t.rotation.order,this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldAutoUpdate=t.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.animations=t.animations.slice(),this.userData=JSON.parse(JSON.stringify(t.userData)),!0===e)for(let e=0;e<t.children.length;e++){const n=t.children[e];this.add(n.clone())}return this}}mr.DEFAULT_UP=new hn(0,1,0),mr.DEFAULT_MATRIX_AUTO_UPDATE=!0,mr.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const yr=new hn,vr=new hn,gr=new hn,br=new hn,_r=new hn,xr=new hn,wr=new hn,Sr=new hn,Tr=new hn,Mr=new hn;class Er{constructor(t=new hn,e=new hn,n=new hn){this.a=t,this.b=e,this.c=n}static getNormal(t,e,n,r){r.subVectors(n,e),yr.subVectors(t,e),r.cross(yr);const i=r.lengthSq();return i>0?r.multiplyScalar(1/Math.sqrt(i)):r.set(0,0,0)}static getBarycoord(t,e,n,r,i){yr.subVectors(r,e),vr.subVectors(n,e),gr.subVectors(t,e);const o=yr.dot(yr),a=yr.dot(vr),s=yr.dot(gr),u=vr.dot(vr),c=vr.dot(gr),l=o*u-a*a;if(0===l)return i.set(0,0,0),null;const f=1/l,h=(u*s-a*c)*f,p=(o*c-a*s)*f;return i.set(1-h-p,p,h)}static containsPoint(t,e,n,r){return null!==this.getBarycoord(t,e,n,r,br)&&br.x>=0&&br.y>=0&&br.x+br.y<=1}static getInterpolation(t,e,n,r,i,o,a,s){return null===this.getBarycoord(t,e,n,r,br)?(s.x=0,s.y=0,"z"in s&&(s.z=0),"w"in s&&(s.w=0),null):(s.setScalar(0),s.addScaledVector(i,br.x),s.addScaledVector(o,br.y),s.addScaledVector(a,br.z),s)}static isFrontFacing(t,e,n,r){return yr.subVectors(n,e),vr.subVectors(t,e),yr.cross(vr).dot(r)<0}set(t,e,n){return this.a.copy(t),this.b.copy(e),this.c.copy(n),this}setFromPointsAndIndices(t,e,n,r){return this.a.copy(t[e]),this.b.copy(t[n]),this.c.copy(t[r]),this}setFromAttributeAndIndices(t,e,n,r){return this.a.fromBufferAttribute(t,e),this.b.fromBufferAttribute(t,n),this.c.fromBufferAttribute(t,r),this}clone(){return(new this.constructor).copy(this)}copy(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this}getArea(){return yr.subVectors(this.c,this.b),vr.subVectors(this.a,this.b),.5*yr.cross(vr).length()}getMidpoint(t){return t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(t){return Er.getNormal(this.a,this.b,this.c,t)}getPlane(t){return t.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(t,e){return Er.getBarycoord(t,this.a,this.b,this.c,e)}getInterpolation(t,e,n,r,i){return Er.getInterpolation(t,this.a,this.b,this.c,e,n,r,i)}containsPoint(t){return Er.containsPoint(t,this.a,this.b,this.c)}isFrontFacing(t){return Er.isFrontFacing(this.a,this.b,this.c,t)}intersectsBox(t){return t.intersectsTriangle(this)}closestPointToPoint(t,e){const n=this.a,r=this.b,i=this.c;let o,a;_r.subVectors(r,n),xr.subVectors(i,n),Sr.subVectors(t,n);const s=_r.dot(Sr),u=xr.dot(Sr);if(s<=0&&u<=0)return e.copy(n);Tr.subVectors(t,r);const c=_r.dot(Tr),l=xr.dot(Tr);if(c>=0&&l<=c)return e.copy(r);const f=s*l-c*u;if(f<=0&&s>=0&&c<=0)return o=s/(s-c),e.copy(n).addScaledVector(_r,o);Mr.subVectors(t,i);const h=_r.dot(Mr),p=xr.dot(Mr);if(p>=0&&h<=p)return e.copy(i);const d=h*u-s*p;if(d<=0&&u>=0&&p<=0)return a=u/(u-p),e.copy(n).addScaledVector(xr,a);const m=c*p-h*l;if(m<=0&&l-c>=0&&h-p>=0)return wr.subVectors(i,r),a=(l-c)/(l-c+(h-p)),e.copy(r).addScaledVector(wr,a);const y=1/(m+d+f);return o=d*y,a=f*y,e.copy(n).addScaledVector(_r,o).addScaledVector(xr,a)}equals(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)}}const Ar={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Or={h:0,s:0,l:0},Pr={h:0,s:0,l:0};function Rr(t,e,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?t+6*(e-t)*n:n<.5?e:n<2/3?t+6*(e-t)*(2/3-n):t}class kr{constructor(t,e,n){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(t,e,n)}set(t,e,n){if(void 0===e&&void 0===n){const e=t;e&&e.isColor?this.copy(e):"number"==typeof e?this.setHex(e):"string"==typeof e&&this.setStyle(e)}else this.setRGB(t,e,n);return this}setScalar(t){return this.r=t,this.g=t,this.b=t,this}setHex(t,e=ne){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(255&t)/255,Je.toWorkingColorSpace(this,e),this}setRGB(t,e,n,r=Je.workingColorSpace){return this.r=t,this.g=e,this.b=n,Je.toWorkingColorSpace(this,r),this}setHSL(t,e,n,r=Je.workingColorSpace){if(t=Re(t,1),e=Pe(e,0,1),n=Pe(n,0,1),0===e)this.r=this.g=this.b=n;else{const r=n<=.5?n*(1+e):n+e-n*e,i=2*n-r;this.r=Rr(i,r,t+1/3),this.g=Rr(i,r,t),this.b=Rr(i,r,t-1/3)}return Je.toWorkingColorSpace(this,r),this}setStyle(t,e=ne){function n(e){void 0!==e&&parseFloat(e)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}let r;if(r=/^(\w+)\(([^\)]*)\)/.exec(t)){let i;const o=r[1],a=r[2];switch(o){case"rgb":case"rgba":if(i=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return n(i[4]),this.setRGB(Math.min(255,parseInt(i[1],10))/255,Math.min(255,parseInt(i[2],10))/255,Math.min(255,parseInt(i[3],10))/255,e);if(i=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return n(i[4]),this.setRGB(Math.min(100,parseInt(i[1],10))/100,Math.min(100,parseInt(i[2],10))/100,Math.min(100,parseInt(i[3],10))/100,e);break;case"hsl":case"hsla":if(i=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return n(i[4]),this.setHSL(parseFloat(i[1])/360,parseFloat(i[2])/100,parseFloat(i[3])/100,e);break;default:console.warn("THREE.Color: Unknown color model "+t)}}else if(r=/^\#([A-Fa-f\d]+)$/.exec(t)){const n=r[1],i=n.length;if(3===i)return this.setRGB(parseInt(n.charAt(0),16)/15,parseInt(n.charAt(1),16)/15,parseInt(n.charAt(2),16)/15,e);if(6===i)return this.setHex(parseInt(n,16),e);console.warn("THREE.Color: Invalid hex color "+t)}else if(t&&t.length>0)return this.setColorName(t,e);return this}setColorName(t,e=ne){const n=Ar[t.toLowerCase()];return void 0!==n?this.setHex(n,e):console.warn("THREE.Color: Unknown color "+t),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,this}copySRGBToLinear(t){return this.r=Ze(t.r),this.g=Ze(t.g),this.b=Ze(t.b),this}copyLinearToSRGB(t){return this.r=Ke(t.r),this.g=Ke(t.g),this.b=Ke(t.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(t=ne){return Je.fromWorkingColorSpace(Cr.copy(this),t),65536*Math.round(Pe(255*Cr.r,0,255))+256*Math.round(Pe(255*Cr.g,0,255))+Math.round(Pe(255*Cr.b,0,255))}getHexString(t=ne){return("000000"+this.getHex(t).toString(16)).slice(-6)}getHSL(t,e=Je.workingColorSpace){Je.fromWorkingColorSpace(Cr.copy(this),e);const n=Cr.r,r=Cr.g,i=Cr.b,o=Math.max(n,r,i),a=Math.min(n,r,i);let s,u;const c=(a+o)/2;if(a===o)s=0,u=0;else{const t=o-a;switch(u=c<=.5?t/(o+a):t/(2-o-a),o){case n:s=(r-i)/t+(r<i?6:0);break;case r:s=(i-n)/t+2;break;case i:s=(n-r)/t+4}s/=6}return t.h=s,t.s=u,t.l=c,t}getRGB(t,e=Je.workingColorSpace){return Je.fromWorkingColorSpace(Cr.copy(this),e),t.r=Cr.r,t.g=Cr.g,t.b=Cr.b,t}getStyle(t=ne){Je.fromWorkingColorSpace(Cr.copy(this),t);const e=Cr.r,n=Cr.g,r=Cr.b;return t!==ne?`color(${t} ${e.toFixed(3)} ${n.toFixed(3)} ${r.toFixed(3)})`:`rgb(${Math.round(255*e)},${Math.round(255*n)},${Math.round(255*r)})`}offsetHSL(t,e,n){return this.getHSL(Or),this.setHSL(Or.h+t,Or.s+e,Or.l+n)}add(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this}addColors(t,e){return this.r=t.r+e.r,this.g=t.g+e.g,this.b=t.b+e.b,this}addScalar(t){return this.r+=t,this.g+=t,this.b+=t,this}sub(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this}multiply(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this}multiplyScalar(t){return this.r*=t,this.g*=t,this.b*=t,this}lerp(t,e){return this.r+=(t.r-this.r)*e,this.g+=(t.g-this.g)*e,this.b+=(t.b-this.b)*e,this}lerpColors(t,e,n){return this.r=t.r+(e.r-t.r)*n,this.g=t.g+(e.g-t.g)*n,this.b=t.b+(e.b-t.b)*n,this}lerpHSL(t,e){this.getHSL(Or),t.getHSL(Pr);const n=ke(Or.h,Pr.h,e),r=ke(Or.s,Pr.s,e),i=ke(Or.l,Pr.l,e);return this.setHSL(n,r,i),this}setFromVector3(t){return this.r=t.x,this.g=t.y,this.b=t.z,this}applyMatrix3(t){const e=this.r,n=this.g,r=this.b,i=t.elements;return this.r=i[0]*e+i[3]*n+i[6]*r,this.g=i[1]*e+i[4]*n+i[7]*r,this.b=i[2]*e+i[5]*n+i[8]*r,this}equals(t){return t.r===this.r&&t.g===this.g&&t.b===this.b}fromArray(t,e=0){return this.r=t[e],this.g=t[e+1],this.b=t[e+2],this}toArray(t=[],e=0){return t[e]=this.r,t[e+1]=this.g,t[e+2]=this.b,t}fromBufferAttribute(t,e){return this.r=t.getX(e),this.g=t.getY(e),this.b=t.getZ(e),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const Cr=new kr;kr.NAMES=Ar;let Nr=0;class Lr extends Se{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:Nr++}),this.uuid=Oe(),this.name="",this.type="Material",this.blending=1,this.side=0,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=y,this.blendDst=v,this.blendEquation=c,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new kr(0,0,0),this.blendAlpha=0,this.depthFunc=3,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=519,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=le,this.stencilZFail=le,this.stencilZPass=le,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(t){this._alphaTest>0!=t>0&&this.version++,this._alphaTest=t}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(t){if(void 0!==t)for(const e in t){const n=t[e];if(void 0===n){console.warn(`THREE.Material: parameter '${e}' has value of undefined.`);continue}const r=this[e];void 0!==r?r&&r.isColor?r.set(n):r&&r.isVector3&&n&&n.isVector3?r.copy(n):this[e]=n:console.warn(`THREE.Material: '${e}' is not a property of THREE.${this.type}.`)}}toJSON(t){const e=void 0===t||"string"==typeof t;e&&(t={textures:{},images:{}});const n={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};function r(t){const e=[];for(const n in t){const r=t[n];delete r.metadata,e.push(r)}return e}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),void 0!==this.roughness&&(n.roughness=this.roughness),void 0!==this.metalness&&(n.metalness=this.metalness),void 0!==this.sheen&&(n.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(n.sheenColor=this.sheenColor.getHex()),void 0!==this.sheenRoughness&&(n.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),void 0!==this.emissiveIntensity&&1!==this.emissiveIntensity&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),void 0!==this.specularIntensity&&(n.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(n.specularColor=this.specularColor.getHex()),void 0!==this.shininess&&(n.shininess=this.shininess),void 0!==this.clearcoat&&(n.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(t).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(t).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(t).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),void 0!==this.iridescence&&(n.iridescence=this.iridescence),void 0!==this.iridescenceIOR&&(n.iridescenceIOR=this.iridescenceIOR),void 0!==this.iridescenceThicknessRange&&(n.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(n.iridescenceMap=this.iridescenceMap.toJSON(t).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(n.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(t).uuid),void 0!==this.anisotropy&&(n.anisotropy=this.anisotropy),void 0!==this.anisotropyRotation&&(n.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(n.anisotropyMap=this.anisotropyMap.toJSON(t).uuid),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(t).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(t).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(t).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(t).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(t).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(t).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(t).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(t).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(t).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(t).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(t).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(t).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(n.specularIntensityMap=this.specularIntensityMap.toJSON(t).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(n.specularColorMap=this.specularColorMap.toJSON(t).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(t).uuid,void 0!==this.combine&&(n.combine=this.combine)),void 0!==this.envMapRotation&&(n.envMapRotation=this.envMapRotation.toArray()),void 0!==this.envMapIntensity&&(n.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(n.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(n.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(t).uuid),void 0!==this.transmission&&(n.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(n.transmissionMap=this.transmissionMap.toJSON(t).uuid),void 0!==this.thickness&&(n.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(n.thicknessMap=this.thicknessMap.toJSON(t).uuid),void 0!==this.attenuationDistance&&this.attenuationDistance!==1/0&&(n.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationColor&&(n.attenuationColor=this.attenuationColor.getHex()),void 0!==this.size&&(n.size=this.size),null!==this.shadowSide&&(n.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(n.sizeAttenuation=this.sizeAttenuation),1!==this.blending&&(n.blending=this.blending),0!==this.side&&(n.side=this.side),!0===this.vertexColors&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),!0===this.transparent&&(n.transparent=!0),this.blendSrc!==y&&(n.blendSrc=this.blendSrc),this.blendDst!==v&&(n.blendDst=this.blendDst),this.blendEquation!==c&&(n.blendEquation=this.blendEquation),null!==this.blendSrcAlpha&&(n.blendSrcAlpha=this.blendSrcAlpha),null!==this.blendDstAlpha&&(n.blendDstAlpha=this.blendDstAlpha),null!==this.blendEquationAlpha&&(n.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(n.blendColor=this.blendColor.getHex()),0!==this.blendAlpha&&(n.blendAlpha=this.blendAlpha),3!==this.depthFunc&&(n.depthFunc=this.depthFunc),!1===this.depthTest&&(n.depthTest=this.depthTest),!1===this.depthWrite&&(n.depthWrite=this.depthWrite),!1===this.colorWrite&&(n.colorWrite=this.colorWrite),255!==this.stencilWriteMask&&(n.stencilWriteMask=this.stencilWriteMask),519!==this.stencilFunc&&(n.stencilFunc=this.stencilFunc),0!==this.stencilRef&&(n.stencilRef=this.stencilRef),255!==this.stencilFuncMask&&(n.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==le&&(n.stencilFail=this.stencilFail),this.stencilZFail!==le&&(n.stencilZFail=this.stencilZFail),this.stencilZPass!==le&&(n.stencilZPass=this.stencilZPass),!0===this.stencilWrite&&(n.stencilWrite=this.stencilWrite),void 0!==this.rotation&&0!==this.rotation&&(n.rotation=this.rotation),!0===this.polygonOffset&&(n.polygonOffset=!0),0!==this.polygonOffsetFactor&&(n.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(n.polygonOffsetUnits=this.polygonOffsetUnits),void 0!==this.linewidth&&1!==this.linewidth&&(n.linewidth=this.linewidth),void 0!==this.dashSize&&(n.dashSize=this.dashSize),void 0!==this.gapSize&&(n.gapSize=this.gapSize),void 0!==this.scale&&(n.scale=this.scale),!0===this.dithering&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),!0===this.alphaHash&&(n.alphaHash=!0),!0===this.alphaToCoverage&&(n.alphaToCoverage=!0),!0===this.premultipliedAlpha&&(n.premultipliedAlpha=!0),!0===this.forceSinglePass&&(n.forceSinglePass=!0),!0===this.wireframe&&(n.wireframe=!0),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(n.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(n.wireframeLinejoin=this.wireframeLinejoin),!0===this.flatShading&&(n.flatShading=!0),!1===this.visible&&(n.visible=!1),!1===this.toneMapped&&(n.toneMapped=!1),!1===this.fog&&(n.fog=!1),Object.keys(this.userData).length>0&&(n.userData=this.userData),e){const e=r(t.textures),i=r(t.images);e.length>0&&(n.textures=e),i.length>0&&(n.images=i)}return n}clone(){return(new this.constructor).copy(this)}copy(t){this.name=t.name,this.blending=t.blending,this.side=t.side,this.vertexColors=t.vertexColors,this.opacity=t.opacity,this.transparent=t.transparent,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendEquation=t.blendEquation,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.blendEquationAlpha=t.blendEquationAlpha,this.blendColor.copy(t.blendColor),this.blendAlpha=t.blendAlpha,this.depthFunc=t.depthFunc,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.stencilWriteMask=t.stencilWriteMask,this.stencilFunc=t.stencilFunc,this.stencilRef=t.stencilRef,this.stencilFuncMask=t.stencilFuncMask,this.stencilFail=t.stencilFail,this.stencilZFail=t.stencilZFail,this.stencilZPass=t.stencilZPass,this.stencilWrite=t.stencilWrite;const e=t.clippingPlanes;let n=null;if(null!==e){const t=e.length;n=new Array(t);for(let r=0;r!==t;++r)n[r]=e[r].clone()}return this.clippingPlanes=n,this.clipIntersection=t.clipIntersection,this.clipShadows=t.clipShadows,this.shadowSide=t.shadowSide,this.colorWrite=t.colorWrite,this.precision=t.precision,this.polygonOffset=t.polygonOffset,this.polygonOffsetFactor=t.polygonOffsetFactor,this.polygonOffsetUnits=t.polygonOffsetUnits,this.dithering=t.dithering,this.alphaTest=t.alphaTest,this.alphaHash=t.alphaHash,this.alphaToCoverage=t.alphaToCoverage,this.premultipliedAlpha=t.premultipliedAlpha,this.forceSinglePass=t.forceSinglePass,this.visible=t.visible,this.toneMapped=t.toneMapped,this.userData=JSON.parse(JSON.stringify(t.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(t){!0===t&&this.version++}}class jr extends Lr{constructor(t){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new kr(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Qn,this.combine=A,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapRotation.copy(t.envMapRotation),this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.fog=t.fog,this}}const Ir=Br();function Br(){const t=new ArrayBuffer(4),e=new Float32Array(t),n=new Uint32Array(t),r=new Uint32Array(512),i=new Uint32Array(512);for(let t=0;t<256;++t){const e=t-127;e<-27?(r[t]=0,r[256|t]=32768,i[t]=24,i[256|t]=24):e<-14?(r[t]=1024>>-e-14,r[256|t]=1024>>-e-14|32768,i[t]=-e-1,i[256|t]=-e-1):e<=15?(r[t]=e+15<<10,r[256|t]=e+15<<10|32768,i[t]=13,i[256|t]=13):e<128?(r[t]=31744,r[256|t]=64512,i[t]=24,i[256|t]=24):(r[t]=31744,r[256|t]=64512,i[t]=13,i[256|t]=13)}const o=new Uint32Array(2048),a=new Uint32Array(64),s=new Uint32Array(64);for(let t=1;t<1024;++t){let e=t<<13,n=0;for(;!(8388608&e);)e<<=1,n-=8388608;e&=-8388609,n+=947912704,o[t]=e|n}for(let t=1024;t<2048;++t)o[t]=939524096+(t-1024<<13);for(let t=1;t<31;++t)a[t]=t<<23;a[31]=1199570944,a[32]=2147483648;for(let t=33;t<63;++t)a[t]=2147483648+(t-32<<23);a[63]=3347054592;for(let t=1;t<64;++t)32!==t&&(s[t]=1024);return{floatView:e,uint32View:n,baseTable:r,shiftTable:i,mantissaTable:o,exponentTable:a,offsetTable:s}}function Ur(t){Math.abs(t)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),t=Pe(t,-65504,65504),Ir.floatView[0]=t;const e=Ir.uint32View[0],n=e>>23&511;return Ir.baseTable[n]+((8388607&e)>>Ir.shiftTable[n])}function Dr(t){const e=t>>10;return Ir.uint32View[0]=Ir.mantissaTable[Ir.offsetTable[e]+(1023&t)]+Ir.exponentTable[e],Ir.floatView[0]}const Fr={toHalfFloat:Ur,fromHalfFloat:Dr},zr=new hn,Vr=new je;class Gr{constructor(t,e,n=!1){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=t,this.itemSize=e,this.count=void 0!==t?t.length/e:0,this.normalized=n,this.usage=be,this._updateRange={offset:0,count:-1},this.updateRanges=[],this.gpuType=ot,this.version=0}onUploadCallback(){}set needsUpdate(t){!0===t&&this.version++}get updateRange(){return He("THREE.BufferAttribute: updateRange() is deprecated and will be removed in r169. Use addUpdateRange() instead."),this._updateRange}setUsage(t){return this.usage=t,this}addUpdateRange(t,e){this.updateRanges.push({start:t,count:e})}clearUpdateRanges(){this.updateRanges.length=0}copy(t){return this.name=t.name,this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.usage=t.usage,this.gpuType=t.gpuType,this}copyAt(t,e,n){t*=this.itemSize,n*=e.itemSize;for(let r=0,i=this.itemSize;r<i;r++)this.array[t+r]=e.array[n+r];return this}copyArray(t){return this.array.set(t),this}applyMatrix3(t){if(2===this.itemSize)for(let e=0,n=this.count;e<n;e++)Vr.fromBufferAttribute(this,e),Vr.applyMatrix3(t),this.setXY(e,Vr.x,Vr.y);else if(3===this.itemSize)for(let e=0,n=this.count;e<n;e++)zr.fromBufferAttribute(this,e),zr.applyMatrix3(t),this.setXYZ(e,zr.x,zr.y,zr.z);return this}applyMatrix4(t){for(let e=0,n=this.count;e<n;e++)zr.fromBufferAttribute(this,e),zr.applyMatrix4(t),this.setXYZ(e,zr.x,zr.y,zr.z);return this}applyNormalMatrix(t){for(let e=0,n=this.count;e<n;e++)zr.fromBufferAttribute(this,e),zr.applyNormalMatrix(t),this.setXYZ(e,zr.x,zr.y,zr.z);return this}transformDirection(t){for(let e=0,n=this.count;e<n;e++)zr.fromBufferAttribute(this,e),zr.transformDirection(t),this.setXYZ(e,zr.x,zr.y,zr.z);return this}set(t,e=0){return this.array.set(t,e),this}getComponent(t,e){let n=this.array[t*this.itemSize+e];return this.normalized&&(n=Ce(n,this.array)),n}setComponent(t,e,n){return this.normalized&&(n=Ne(n,this.array)),this.array[t*this.itemSize+e]=n,this}getX(t){let e=this.array[t*this.itemSize];return this.normalized&&(e=Ce(e,this.array)),e}setX(t,e){return this.normalized&&(e=Ne(e,this.array)),this.array[t*this.itemSize]=e,this}getY(t){let e=this.array[t*this.itemSize+1];return this.normalized&&(e=Ce(e,this.array)),e}setY(t,e){return this.normalized&&(e=Ne(e,this.array)),this.array[t*this.itemSize+1]=e,this}getZ(t){let e=this.array[t*this.itemSize+2];return this.normalized&&(e=Ce(e,this.array)),e}setZ(t,e){return this.normalized&&(e=Ne(e,this.array)),this.array[t*this.itemSize+2]=e,this}getW(t){let e=this.array[t*this.itemSize+3];return this.normalized&&(e=Ce(e,this.array)),e}setW(t,e){return this.normalized&&(e=Ne(e,this.array)),this.array[t*this.itemSize+3]=e,this}setXY(t,e,n){return t*=this.itemSize,this.normalized&&(e=Ne(e,this.array),n=Ne(n,this.array)),this.array[t+0]=e,this.array[t+1]=n,this}setXYZ(t,e,n,r){return t*=this.itemSize,this.normalized&&(e=Ne(e,this.array),n=Ne(n,this.array),r=Ne(r,this.array)),this.array[t+0]=e,this.array[t+1]=n,this.array[t+2]=r,this}setXYZW(t,e,n,r,i){return t*=this.itemSize,this.normalized&&(e=Ne(e,this.array),n=Ne(n,this.array),r=Ne(r,this.array),i=Ne(i,this.array)),this.array[t+0]=e,this.array[t+1]=n,this.array[t+2]=r,this.array[t+3]=i,this}onUpload(t){return this.onUploadCallback=t,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const t={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return""!==this.name&&(t.name=this.name),this.usage!==be&&(t.usage=this.usage),t}}class Hr extends Gr{constructor(t,e,n){super(new Uint16Array(t),e,n)}}class Wr extends Gr{constructor(t,e,n){super(new Uint32Array(t),e,n)}}class qr extends Gr{constructor(t,e,n){super(new Float32Array(t),e,n)}}let Xr=0;const Yr=new Vn,Jr=new mr,Zr=new hn,Kr=new mn,Qr=new mn,$r=new hn;class ti extends Se{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:Xr++}),this.uuid=Oe(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(t){return Array.isArray(t)?this.index=new(Ue(t)?Wr:Hr)(t,1):this.index=t,this}getAttribute(t){return this.attributes[t]}setAttribute(t,e){return this.attributes[t]=e,this}deleteAttribute(t){return delete this.attributes[t],this}hasAttribute(t){return void 0!==this.attributes[t]}addGroup(t,e,n=0){this.groups.push({start:t,count:e,materialIndex:n})}clearGroups(){this.groups=[]}setDrawRange(t,e){this.drawRange.start=t,this.drawRange.count=e}applyMatrix4(t){const e=this.attributes.position;void 0!==e&&(e.applyMatrix4(t),e.needsUpdate=!0);const n=this.attributes.normal;if(void 0!==n){const e=(new Ie).getNormalMatrix(t);n.applyNormalMatrix(e),n.needsUpdate=!0}const r=this.attributes.tangent;return void 0!==r&&(r.transformDirection(t),r.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}applyQuaternion(t){return Yr.makeRotationFromQuaternion(t),this.applyMatrix4(Yr),this}rotateX(t){return Yr.makeRotationX(t),this.applyMatrix4(Yr),this}rotateY(t){return Yr.makeRotationY(t),this.applyMatrix4(Yr),this}rotateZ(t){return Yr.makeRotationZ(t),this.applyMatrix4(Yr),this}translate(t,e,n){return Yr.makeTranslation(t,e,n),this.applyMatrix4(Yr),this}scale(t,e,n){return Yr.makeScale(t,e,n),this.applyMatrix4(Yr),this}lookAt(t){return Jr.lookAt(t),Jr.updateMatrix(),this.applyMatrix4(Jr.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Zr).negate(),this.translate(Zr.x,Zr.y,Zr.z),this}setFromPoints(t){const e=[];for(let n=0,r=t.length;n<r;n++){const r=t[n];e.push(r.x,r.y,r.z||0)}return this.setAttribute("position",new qr(e,3)),this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new mn);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute)return console.error("THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),void this.boundingBox.set(new hn(-1/0,-1/0,-1/0),new hn(1/0,1/0,1/0));if(void 0!==t){if(this.boundingBox.setFromBufferAttribute(t),e)for(let t=0,n=e.length;t<n;t++){const n=e[t];Kr.setFromBufferAttribute(n),this.morphTargetsRelative?($r.addVectors(this.boundingBox.min,Kr.min),this.boundingBox.expandByPoint($r),$r.addVectors(this.boundingBox.max,Kr.max),this.boundingBox.expandByPoint($r)):(this.boundingBox.expandByPoint(Kr.min),this.boundingBox.expandByPoint(Kr.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new Nn);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute)return console.error("THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),void this.boundingSphere.set(new hn,1/0);if(t){const n=this.boundingSphere.center;if(Kr.setFromBufferAttribute(t),e)for(let t=0,n=e.length;t<n;t++){const n=e[t];Qr.setFromBufferAttribute(n),this.morphTargetsRelative?($r.addVectors(Kr.min,Qr.min),Kr.expandByPoint($r),$r.addVectors(Kr.max,Qr.max),Kr.expandByPoint($r)):(Kr.expandByPoint(Qr.min),Kr.expandByPoint(Qr.max))}Kr.getCenter(n);let r=0;for(let e=0,i=t.count;e<i;e++)$r.fromBufferAttribute(t,e),r=Math.max(r,n.distanceToSquared($r));if(e)for(let i=0,o=e.length;i<o;i++){const o=e[i],a=this.morphTargetsRelative;for(let e=0,i=o.count;e<i;e++)$r.fromBufferAttribute(o,e),a&&(Zr.fromBufferAttribute(t,e),$r.add(Zr)),r=Math.max(r,n.distanceToSquared($r))}this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const t=this.index,e=this.attributes;if(null===t||void 0===e.position||void 0===e.normal||void 0===e.uv)return void console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");const n=e.position,r=e.normal,i=e.uv;!1===this.hasAttribute("tangent")&&this.setAttribute("tangent",new Gr(new Float32Array(4*n.count),4));const o=this.getAttribute("tangent"),a=[],s=[];for(let t=0;t<n.count;t++)a[t]=new hn,s[t]=new hn;const u=new hn,c=new hn,l=new hn,f=new je,h=new je,p=new je,d=new hn,m=new hn;function y(t,e,r){u.fromBufferAttribute(n,t),c.fromBufferAttribute(n,e),l.fromBufferAttribute(n,r),f.fromBufferAttribute(i,t),h.fromBufferAttribute(i,e),p.fromBufferAttribute(i,r),c.sub(u),l.sub(u),h.sub(f),p.sub(f);const o=1/(h.x*p.y-p.x*h.y);isFinite(o)&&(d.copy(c).multiplyScalar(p.y).addScaledVector(l,-h.y).multiplyScalar(o),m.copy(l).multiplyScalar(h.x).addScaledVector(c,-p.x).multiplyScalar(o),a[t].add(d),a[e].add(d),a[r].add(d),s[t].add(m),s[e].add(m),s[r].add(m))}let v=this.groups;0===v.length&&(v=[{start:0,count:t.count}]);for(let e=0,n=v.length;e<n;++e){const n=v[e],r=n.start;for(let e=r,i=r+n.count;e<i;e+=3)y(t.getX(e+0),t.getX(e+1),t.getX(e+2))}const g=new hn,b=new hn,_=new hn,x=new hn;function w(t){_.fromBufferAttribute(r,t),x.copy(_);const e=a[t];g.copy(e),g.sub(_.multiplyScalar(_.dot(e))).normalize(),b.crossVectors(x,e);const n=b.dot(s[t])<0?-1:1;o.setXYZW(t,g.x,g.y,g.z,n)}for(let e=0,n=v.length;e<n;++e){const n=v[e],r=n.start;for(let e=r,i=r+n.count;e<i;e+=3)w(t.getX(e+0)),w(t.getX(e+1)),w(t.getX(e+2))}}computeVertexNormals(){const t=this.index,e=this.getAttribute("position");if(void 0!==e){let n=this.getAttribute("normal");if(void 0===n)n=new Gr(new Float32Array(3*e.count),3),this.setAttribute("normal",n);else for(let t=0,e=n.count;t<e;t++)n.setXYZ(t,0,0,0);const r=new hn,i=new hn,o=new hn,a=new hn,s=new hn,u=new hn,c=new hn,l=new hn;if(t)for(let f=0,h=t.count;f<h;f+=3){const h=t.getX(f+0),p=t.getX(f+1),d=t.getX(f+2);r.fromBufferAttribute(e,h),i.fromBufferAttribute(e,p),o.fromBufferAttribute(e,d),c.subVectors(o,i),l.subVectors(r,i),c.cross(l),a.fromBufferAttribute(n,h),s.fromBufferAttribute(n,p),u.fromBufferAttribute(n,d),a.add(c),s.add(c),u.add(c),n.setXYZ(h,a.x,a.y,a.z),n.setXYZ(p,s.x,s.y,s.z),n.setXYZ(d,u.x,u.y,u.z)}else for(let t=0,a=e.count;t<a;t+=3)r.fromBufferAttribute(e,t+0),i.fromBufferAttribute(e,t+1),o.fromBufferAttribute(e,t+2),c.subVectors(o,i),l.subVectors(r,i),c.cross(l),n.setXYZ(t+0,c.x,c.y,c.z),n.setXYZ(t+1,c.x,c.y,c.z),n.setXYZ(t+2,c.x,c.y,c.z);this.normalizeNormals(),n.needsUpdate=!0}}normalizeNormals(){const t=this.attributes.normal;for(let e=0,n=t.count;e<n;e++)$r.fromBufferAttribute(t,e),$r.normalize(),t.setXYZ(e,$r.x,$r.y,$r.z)}toNonIndexed(){function t(t,e){const n=t.array,r=t.itemSize,i=t.normalized,o=new n.constructor(e.length*r);let a=0,s=0;for(let i=0,u=e.length;i<u;i++){a=t.isInterleavedBufferAttribute?e[i]*t.data.stride+t.offset:e[i]*r;for(let t=0;t<r;t++)o[s++]=n[a++]}return new Gr(o,r,i)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const e=new ti,n=this.index.array,r=this.attributes;for(const i in r){const o=t(r[i],n);e.setAttribute(i,o)}const i=this.morphAttributes;for(const r in i){const o=[],a=i[r];for(let e=0,r=a.length;e<r;e++){const r=t(a[e],n);o.push(r)}e.morphAttributes[r]=o}e.morphTargetsRelative=this.morphTargetsRelative;const o=this.groups;for(let t=0,n=o.length;t<n;t++){const n=o[t];e.addGroup(n.start,n.count,n.materialIndex)}return e}toJSON(){const t={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,""!==this.name&&(t.name=this.name),Object.keys(this.userData).length>0&&(t.userData=this.userData),void 0!==this.parameters){const e=this.parameters;for(const n in e)void 0!==e[n]&&(t[n]=e[n]);return t}t.data={attributes:{}};const e=this.index;null!==e&&(t.data.index={type:e.array.constructor.name,array:Array.prototype.slice.call(e.array)});const n=this.attributes;for(const e in n){const r=n[e];t.data.attributes[e]=r.toJSON(t.data)}const r={};let i=!1;for(const e in this.morphAttributes){const n=this.morphAttributes[e],o=[];for(let e=0,r=n.length;e<r;e++){const r=n[e];o.push(r.toJSON(t.data))}o.length>0&&(r[e]=o,i=!0)}i&&(t.data.morphAttributes=r,t.data.morphTargetsRelative=this.morphTargetsRelative);const o=this.groups;o.length>0&&(t.data.groups=JSON.parse(JSON.stringify(o)));const a=this.boundingSphere;return null!==a&&(t.data.boundingSphere={center:a.center.toArray(),radius:a.radius}),t}clone(){return(new this.constructor).copy(this)}copy(t){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const e={};this.name=t.name;const n=t.index;null!==n&&this.setIndex(n.clone(e));const r=t.attributes;for(const t in r){const n=r[t];this.setAttribute(t,n.clone(e))}const i=t.morphAttributes;for(const t in i){const n=[],r=i[t];for(let t=0,i=r.length;t<i;t++)n.push(r[t].clone(e));this.morphAttributes[t]=n}this.morphTargetsRelative=t.morphTargetsRelative;const o=t.groups;for(let t=0,e=o.length;t<e;t++){const e=o[t];this.addGroup(e.start,e.count,e.materialIndex)}const a=t.boundingBox;null!==a&&(this.boundingBox=a.clone());const s=t.boundingSphere;return null!==s&&(this.boundingSphere=s.clone()),this.drawRange.start=t.drawRange.start,this.drawRange.count=t.drawRange.count,this.userData=t.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const ei=new Vn,ni=new zn,ri=new Nn,ii=new hn,oi=new hn,ai=new hn,si=new hn,ui=new hn,ci=new hn,li=new je,fi=new je,hi=new je,pi=new hn,di=new hn,mi=new hn,yi=new hn,vi=new hn;class gi extends mr{constructor(t=new ti,e=new jr){super(),this.isMesh=!0,this.type="Mesh",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t,e){return super.copy(t,e),void 0!==t.morphTargetInfluences&&(this.morphTargetInfluences=t.morphTargetInfluences.slice()),void 0!==t.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},t.morphTargetDictionary)),this.material=Array.isArray(t.material)?t.material.slice():t.material,this.geometry=t.geometry,this}updateMorphTargets(){const t=this.geometry.morphAttributes,e=Object.keys(t);if(e.length>0){const n=t[e[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let t=0,e=n.length;t<e;t++){const e=n[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[e]=t}}}}getVertexPosition(t,e){const n=this.geometry,r=n.attributes.position,i=n.morphAttributes.position,o=n.morphTargetsRelative;e.fromBufferAttribute(r,t);const a=this.morphTargetInfluences;if(i&&a){ci.set(0,0,0);for(let n=0,r=i.length;n<r;n++){const r=a[n],s=i[n];0!==r&&(ui.fromBufferAttribute(s,t),o?ci.addScaledVector(ui,r):ci.addScaledVector(ui.sub(e),r))}e.add(ci)}return e}raycast(t,e){const n=this.geometry,r=this.material,i=this.matrixWorld;if(void 0!==r){if(null===n.boundingSphere&&n.computeBoundingSphere(),ri.copy(n.boundingSphere),ri.applyMatrix4(i),ni.copy(t.ray).recast(t.near),!1===ri.containsPoint(ni.origin)){if(null===ni.intersectSphere(ri,ii))return;if(ni.origin.distanceToSquared(ii)>(t.far-t.near)**2)return}ei.copy(i).invert(),ni.copy(t.ray).applyMatrix4(ei),null!==n.boundingBox&&!1===ni.intersectsBox(n.boundingBox)||this._computeIntersections(t,e,ni)}}_computeIntersections(t,e,n){let r;const i=this.geometry,o=this.material,a=i.index,s=i.attributes.position,u=i.attributes.uv,c=i.attributes.uv1,l=i.attributes.normal,f=i.groups,h=i.drawRange;if(null!==a)if(Array.isArray(o))for(let i=0,s=f.length;i<s;i++){const s=f[i],p=o[s.materialIndex];for(let i=Math.max(s.start,h.start),o=Math.min(a.count,Math.min(s.start+s.count,h.start+h.count));i<o;i+=3)r=bi(this,p,t,n,u,c,l,a.getX(i),a.getX(i+1),a.getX(i+2)),r&&(r.faceIndex=Math.floor(i/3),r.face.materialIndex=s.materialIndex,e.push(r))}else for(let i=Math.max(0,h.start),s=Math.min(a.count,h.start+h.count);i<s;i+=3)r=bi(this,o,t,n,u,c,l,a.getX(i),a.getX(i+1),a.getX(i+2)),r&&(r.faceIndex=Math.floor(i/3),e.push(r));else if(void 0!==s)if(Array.isArray(o))for(let i=0,a=f.length;i<a;i++){const a=f[i],p=o[a.materialIndex];for(let i=Math.max(a.start,h.start),o=Math.min(s.count,Math.min(a.start+a.count,h.start+h.count));i<o;i+=3)r=bi(this,p,t,n,u,c,l,i,i+1,i+2),r&&(r.faceIndex=Math.floor(i/3),r.face.materialIndex=a.materialIndex,e.push(r))}else for(let i=Math.max(0,h.start),a=Math.min(s.count,h.start+h.count);i<a;i+=3)r=bi(this,o,t,n,u,c,l,i,i+1,i+2),r&&(r.faceIndex=Math.floor(i/3),e.push(r))}}function bi(t,e,n,r,i,o,a,s,u,c){t.getVertexPosition(s,oi),t.getVertexPosition(u,ai),t.getVertexPosition(c,si);const l=function(t,e,n,r,i,o,a,s){let u;if(u=1===e.side?r.intersectTriangle(a,o,i,!0,s):r.intersectTriangle(i,o,a,0===e.side,s),null===u)return null;vi.copy(s),vi.applyMatrix4(t.matrixWorld);const c=n.ray.origin.distanceTo(vi);return c<n.near||c>n.far?null:{distance:c,point:vi.clone(),object:t}}(t,e,n,r,oi,ai,si,yi);if(l){i&&(li.fromBufferAttribute(i,s),fi.fromBufferAttribute(i,u),hi.fromBufferAttribute(i,c),l.uv=Er.getInterpolation(yi,oi,ai,si,li,fi,hi,new je)),o&&(li.fromBufferAttribute(o,s),fi.fromBufferAttribute(o,u),hi.fromBufferAttribute(o,c),l.uv1=Er.getInterpolation(yi,oi,ai,si,li,fi,hi,new je)),a&&(pi.fromBufferAttribute(a,s),di.fromBufferAttribute(a,u),mi.fromBufferAttribute(a,c),l.normal=Er.getInterpolation(yi,oi,ai,si,pi,di,mi,new hn),l.normal.dot(r.direction)>0&&l.normal.multiplyScalar(-1));const t={a:s,b:u,c,normal:new hn,materialIndex:0};Er.getNormal(oi,ai,si,t.normal),l.face=t}return l}class _i extends ti{constructor(t=1,e=1,n=1,r=1,i=1,o=1){super(),this.type="BoxGeometry",this.parameters={width:t,height:e,depth:n,widthSegments:r,heightSegments:i,depthSegments:o};const a=this;r=Math.floor(r),i=Math.floor(i),o=Math.floor(o);const s=[],u=[],c=[],l=[];let f=0,h=0;function p(t,e,n,r,i,o,p,d,m,y,v){const g=o/m,b=p/y,_=o/2,x=p/2,w=d/2,S=m+1,T=y+1;let M=0,E=0;const A=new hn;for(let o=0;o<T;o++){const a=o*b-x;for(let s=0;s<S;s++){const f=s*g-_;A[t]=f*r,A[e]=a*i,A[n]=w,u.push(A.x,A.y,A.z),A[t]=0,A[e]=0,A[n]=d>0?1:-1,c.push(A.x,A.y,A.z),l.push(s/m),l.push(1-o/y),M+=1}}for(let t=0;t<y;t++)for(let e=0;e<m;e++){const n=f+e+S*t,r=f+e+S*(t+1),i=f+(e+1)+S*(t+1),o=f+(e+1)+S*t;s.push(n,r,o),s.push(r,i,o),E+=6}a.addGroup(h,E,v),h+=E,f+=M}p("z","y","x",-1,-1,n,e,t,o,i,0),p("z","y","x",1,-1,n,e,-t,o,i,1),p("x","z","y",1,1,t,n,e,r,o,2),p("x","z","y",1,-1,t,n,-e,r,o,3),p("x","y","z",1,-1,t,e,n,r,i,4),p("x","y","z",-1,-1,t,e,-n,r,i,5),this.setIndex(s),this.setAttribute("position",new qr(u,3)),this.setAttribute("normal",new qr(c,3)),this.setAttribute("uv",new qr(l,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new _i(t.width,t.height,t.depth,t.widthSegments,t.heightSegments,t.depthSegments)}}function xi(t){const e={};for(const n in t){e[n]={};for(const r in t[n]){const i=t[n][r];i&&(i.isColor||i.isMatrix3||i.isMatrix4||i.isVector2||i.isVector3||i.isVector4||i.isTexture||i.isQuaternion)?i.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),e[n][r]=null):e[n][r]=i.clone():Array.isArray(i)?e[n][r]=i.slice():e[n][r]=i}}return e}function wi(t){const e={};for(let n=0;n<t.length;n++){const r=xi(t[n]);for(const t in r)e[t]=r[t]}return e}function Si(t){const e=t.getRenderTarget();return null===e?t.outputColorSpace:!0===e.isXRRenderTarget?e.texture.colorSpace:Je.workingColorSpace}const Ti={clone:xi,merge:wi};class Mi extends Lr{constructor(t){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={clipCullDistance:!1,multiDraw:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==t&&this.setValues(t)}copy(t){return super.copy(t),this.fragmentShader=t.fragmentShader,this.vertexShader=t.vertexShader,this.uniforms=xi(t.uniforms),this.uniformsGroups=function(t){const e=[];for(let n=0;n<t.length;n++)e.push(t[n].clone());return e}(t.uniformsGroups),this.defines=Object.assign({},t.defines),this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.fog=t.fog,this.lights=t.lights,this.clipping=t.clipping,this.extensions=Object.assign({},t.extensions),this.glslVersion=t.glslVersion,this}toJSON(t){const e=super.toJSON(t);e.glslVersion=this.glslVersion,e.uniforms={};for(const n in this.uniforms){const r=this.uniforms[n].value;r&&r.isTexture?e.uniforms[n]={type:"t",value:r.toJSON(t).uuid}:r&&r.isColor?e.uniforms[n]={type:"c",value:r.getHex()}:r&&r.isVector2?e.uniforms[n]={type:"v2",value:r.toArray()}:r&&r.isVector3?e.uniforms[n]={type:"v3",value:r.toArray()}:r&&r.isVector4?e.uniforms[n]={type:"v4",value:r.toArray()}:r&&r.isMatrix3?e.uniforms[n]={type:"m3",value:r.toArray()}:r&&r.isMatrix4?e.uniforms[n]={type:"m4",value:r.toArray()}:e.uniforms[n]={value:r}}Object.keys(this.defines).length>0&&(e.defines=this.defines),e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader,e.lights=this.lights,e.clipping=this.clipping;const n={};for(const t in this.extensions)!0===this.extensions[t]&&(n[t]=!0);return Object.keys(n).length>0&&(e.extensions=n),e}}class Ei extends mr{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new Vn,this.projectionMatrix=new Vn,this.projectionMatrixInverse=new Vn,this.coordinateSystem=xe}copy(t,e){return super.copy(t,e),this.matrixWorldInverse.copy(t.matrixWorldInverse),this.projectionMatrix.copy(t.projectionMatrix),this.projectionMatrixInverse.copy(t.projectionMatrixInverse),this.coordinateSystem=t.coordinateSystem,this}getWorldDirection(t){return super.getWorldDirection(t).negate()}updateMatrixWorld(t){super.updateMatrixWorld(t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(t,e){super.updateWorldMatrix(t,e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return(new this.constructor).copy(this)}}const Ai=new hn,Oi=new je,Pi=new je;class Ri extends Ei{constructor(t=50,e=1,n=.1,r=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=t,this.zoom=1,this.near=n,this.far=r,this.focus=10,this.aspect=e,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.fov=t.fov,this.zoom=t.zoom,this.near=t.near,this.far=t.far,this.focus=t.focus,this.aspect=t.aspect,this.view=null===t.view?null:Object.assign({},t.view),this.filmGauge=t.filmGauge,this.filmOffset=t.filmOffset,this}setFocalLength(t){const e=.5*this.getFilmHeight()/t;this.fov=2*Ae*Math.atan(e),this.updateProjectionMatrix()}getFocalLength(){const t=Math.tan(.5*Ee*this.fov);return.5*this.getFilmHeight()/t}getEffectiveFOV(){return 2*Ae*Math.atan(Math.tan(.5*Ee*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(t,e,n){Ai.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),e.set(Ai.x,Ai.y).multiplyScalar(-t/Ai.z),Ai.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),n.set(Ai.x,Ai.y).multiplyScalar(-t/Ai.z)}getViewSize(t,e){return this.getViewBounds(t,Oi,Pi),e.subVectors(Pi,Oi)}setViewOffset(t,e,n,r,i,o){this.aspect=t/e,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=n,this.view.offsetY=r,this.view.width=i,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=this.near;let e=t*Math.tan(.5*Ee*this.fov)/this.zoom,n=2*e,r=this.aspect*n,i=-.5*r;const o=this.view;if(null!==this.view&&this.view.enabled){const t=o.fullWidth,a=o.fullHeight;i+=o.offsetX*r/t,e-=o.offsetY*n/a,r*=o.width/t,n*=o.height/a}const a=this.filmOffset;0!==a&&(i+=t*a/this.getFilmWidth()),this.projectionMatrix.makePerspective(i,i+r,e,e-n,t,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const e=super.toJSON(t);return e.object.fov=this.fov,e.object.zoom=this.zoom,e.object.near=this.near,e.object.far=this.far,e.object.focus=this.focus,e.object.aspect=this.aspect,null!==this.view&&(e.object.view=Object.assign({},this.view)),e.object.filmGauge=this.filmGauge,e.object.filmOffset=this.filmOffset,e}}const ki=-90;class Ci extends mr{constructor(t,e,n){super(),this.type="CubeCamera",this.renderTarget=n,this.coordinateSystem=null,this.activeMipmapLevel=0;const r=new Ri(ki,1,t,e);r.layers=this.layers,this.add(r);const i=new Ri(ki,1,t,e);i.layers=this.layers,this.add(i);const o=new Ri(ki,1,t,e);o.layers=this.layers,this.add(o);const a=new Ri(ki,1,t,e);a.layers=this.layers,this.add(a);const s=new Ri(ki,1,t,e);s.layers=this.layers,this.add(s);const u=new Ri(ki,1,t,e);u.layers=this.layers,this.add(u)}updateCoordinateSystem(){const t=this.coordinateSystem,e=this.children.concat(),[n,r,i,o,a,s]=e;for(const t of e)this.remove(t);if(t===xe)n.up.set(0,1,0),n.lookAt(1,0,0),r.up.set(0,1,0),r.lookAt(-1,0,0),i.up.set(0,0,-1),i.lookAt(0,1,0),o.up.set(0,0,1),o.lookAt(0,-1,0),a.up.set(0,1,0),a.lookAt(0,0,1),s.up.set(0,1,0),s.lookAt(0,0,-1);else{if(t!==we)throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+t);n.up.set(0,-1,0),n.lookAt(-1,0,0),r.up.set(0,-1,0),r.lookAt(1,0,0),i.up.set(0,0,1),i.lookAt(0,1,0),o.up.set(0,0,-1),o.lookAt(0,-1,0),a.up.set(0,-1,0),a.lookAt(0,0,1),s.up.set(0,-1,0),s.lookAt(0,0,-1)}for(const t of e)this.add(t),t.updateMatrixWorld()}update(t,e){null===this.parent&&this.updateMatrixWorld();const{renderTarget:n,activeMipmapLevel:r}=this;this.coordinateSystem!==t.coordinateSystem&&(this.coordinateSystem=t.coordinateSystem,this.updateCoordinateSystem());const[i,o,a,s,u,c]=this.children,l=t.getRenderTarget(),f=t.getActiveCubeFace(),h=t.getActiveMipmapLevel(),p=t.xr.enabled;t.xr.enabled=!1;const d=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,t.setRenderTarget(n,0,r),t.render(e,i),t.setRenderTarget(n,1,r),t.render(e,o),t.setRenderTarget(n,2,r),t.render(e,a),t.setRenderTarget(n,3,r),t.render(e,s),t.setRenderTarget(n,4,r),t.render(e,u),n.texture.generateMipmaps=d,t.setRenderTarget(n,5,r),t.render(e,c),t.setRenderTarget(l,f,h),t.xr.enabled=p,n.texture.needsPMREMUpdate=!0}}class Ni extends on{constructor(t,e,n,r,i,o,a,s,u,c){super(t=void 0!==t?t:[],e=void 0!==e?e:z,n,r,i,o,a,s,u,c),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(t){this.image=t}}class Li extends un{constructor(t=1,e={}){super(t,t,e),this.isWebGLCubeRenderTarget=!0;const n={width:t,height:t,depth:1},r=[n,n,n,n,n,n];this.texture=new Ni(r,e.mapping,e.wrapS,e.wrapT,e.magFilter,e.minFilter,e.format,e.type,e.anisotropy,e.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=void 0!==e.generateMipmaps&&e.generateMipmaps,this.texture.minFilter=void 0!==e.minFilter?e.minFilter:Q}fromEquirectangularTexture(t,e){this.texture.type=e.type,this.texture.colorSpace=e.colorSpace,this.texture.generateMipmaps=e.generateMipmaps,this.texture.minFilter=e.minFilter,this.texture.magFilter=e.magFilter;const n={tEquirect:{value:null}},r="\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t}\n\t\t\t",i="\n\n\t\t\t\tuniform sampler2D tEquirect;\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\t#include <common>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t\t}\n\t\t\t",o=new _i(5,5,5),a=new Mi({name:"CubemapFromEquirect",uniforms:xi(n),vertexShader:r,fragmentShader:i,side:1,blending:0});a.uniforms.tEquirect.value=e;const s=new gi(o,a),u=e.minFilter;return e.minFilter===tt&&(e.minFilter=Q),new Ci(1,10,this).update(t,s),e.minFilter=u,s.geometry.dispose(),s.material.dispose(),this}clear(t,e,n,r){const i=t.getRenderTarget();for(let i=0;i<6;i++)t.setRenderTarget(this,i),t.clear(e,n,r);t.setRenderTarget(i)}}const ji=new hn,Ii=new hn,Bi=new Ie;class Ui{constructor(t=new hn(1,0,0),e=0){this.isPlane=!0,this.normal=t,this.constant=e}set(t,e){return this.normal.copy(t),this.constant=e,this}setComponents(t,e,n,r){return this.normal.set(t,e,n),this.constant=r,this}setFromNormalAndCoplanarPoint(t,e){return this.normal.copy(t),this.constant=-e.dot(this.normal),this}setFromCoplanarPoints(t,e,n){const r=ji.subVectors(n,e).cross(Ii.subVectors(t,e)).normalize();return this.setFromNormalAndCoplanarPoint(r,t),this}copy(t){return this.normal.copy(t.normal),this.constant=t.constant,this}normalize(){const t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(t){return this.normal.dot(t)+this.constant}distanceToSphere(t){return this.distanceToPoint(t.center)-t.radius}projectPoint(t,e){return e.copy(t).addScaledVector(this.normal,-this.distanceToPoint(t))}intersectLine(t,e){const n=t.delta(ji),r=this.normal.dot(n);if(0===r)return 0===this.distanceToPoint(t.start)?e.copy(t.start):null;const i=-(t.start.dot(this.normal)+this.constant)/r;return i<0||i>1?null:e.copy(t.start).addScaledVector(n,i)}intersectsLine(t){const e=this.distanceToPoint(t.start),n=this.distanceToPoint(t.end);return e<0&&n>0||n<0&&e>0}intersectsBox(t){return t.intersectsPlane(this)}intersectsSphere(t){return t.intersectsPlane(this)}coplanarPoint(t){return t.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(t,e){const n=e||Bi.getNormalMatrix(t),r=this.coplanarPoint(ji).applyMatrix4(t),i=this.normal.applyMatrix3(n).normalize();return this.constant=-r.dot(i),this}translate(t){return this.constant-=t.dot(this.normal),this}equals(t){return t.normal.equals(this.normal)&&t.constant===this.constant}clone(){return(new this.constructor).copy(this)}}const Di=new Nn,Fi=new hn;class zi{constructor(t=new Ui,e=new Ui,n=new Ui,r=new Ui,i=new Ui,o=new Ui){this.planes=[t,e,n,r,i,o]}set(t,e,n,r,i,o){const a=this.planes;return a[0].copy(t),a[1].copy(e),a[2].copy(n),a[3].copy(r),a[4].copy(i),a[5].copy(o),this}copy(t){const e=this.planes;for(let n=0;n<6;n++)e[n].copy(t.planes[n]);return this}setFromProjectionMatrix(t,e=2e3){const n=this.planes,r=t.elements,i=r[0],o=r[1],a=r[2],s=r[3],u=r[4],c=r[5],l=r[6],f=r[7],h=r[8],p=r[9],d=r[10],m=r[11],y=r[12],v=r[13],g=r[14],b=r[15];if(n[0].setComponents(s-i,f-u,m-h,b-y).normalize(),n[1].setComponents(s+i,f+u,m+h,b+y).normalize(),n[2].setComponents(s+o,f+c,m+p,b+v).normalize(),n[3].setComponents(s-o,f-c,m-p,b-v).normalize(),n[4].setComponents(s-a,f-l,m-d,b-g).normalize(),e===xe)n[5].setComponents(s+a,f+l,m+d,b+g).normalize();else{if(e!==we)throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+e);n[5].setComponents(a,l,d,g).normalize()}return this}intersectsObject(t){if(void 0!==t.boundingSphere)null===t.boundingSphere&&t.computeBoundingSphere(),Di.copy(t.boundingSphere).applyMatrix4(t.matrixWorld);else{const e=t.geometry;null===e.boundingSphere&&e.computeBoundingSphere(),Di.copy(e.boundingSphere).applyMatrix4(t.matrixWorld)}return this.intersectsSphere(Di)}intersectsSprite(t){return Di.center.set(0,0,0),Di.radius=.7071067811865476,Di.applyMatrix4(t.matrixWorld),this.intersectsSphere(Di)}intersectsSphere(t){const e=this.planes,n=t.center,r=-t.radius;for(let t=0;t<6;t++)if(e[t].distanceToPoint(n)<r)return!1;return!0}intersectsBox(t){const e=this.planes;for(let n=0;n<6;n++){const r=e[n];if(Fi.x=r.normal.x>0?t.max.x:t.min.x,Fi.y=r.normal.y>0?t.max.y:t.min.y,Fi.z=r.normal.z>0?t.max.z:t.min.z,r.distanceToPoint(Fi)<0)return!1}return!0}containsPoint(t){const e=this.planes;for(let n=0;n<6;n++)if(e[n].distanceToPoint(t)<0)return!1;return!0}clone(){return(new this.constructor).copy(this)}}function Vi(){let t=null,e=!1,n=null,r=null;function i(e,o){n(e,o),r=t.requestAnimationFrame(i)}return{start:function(){!0!==e&&null!==n&&(r=t.requestAnimationFrame(i),e=!0)},stop:function(){t.cancelAnimationFrame(r),e=!1},setAnimationLoop:function(t){n=t},setContext:function(e){t=e}}}function Gi(t){const e=new WeakMap;return{get:function(t){return t.isInterleavedBufferAttribute&&(t=t.data),e.get(t)},remove:function(n){n.isInterleavedBufferAttribute&&(n=n.data);const r=e.get(n);r&&(t.deleteBuffer(r.buffer),e.delete(n))},update:function(n,r){if(n.isGLBufferAttribute){const t=e.get(n);return void((!t||t.version<n.version)&&e.set(n,{buffer:n.buffer,type:n.type,bytesPerElement:n.elementSize,version:n.version}))}n.isInterleavedBufferAttribute&&(n=n.data);const i=e.get(n);if(void 0===i)e.set(n,function(e,n){const r=e.array,i=e.usage,o=r.byteLength,a=t.createBuffer();let s;if(t.bindBuffer(n,a),t.bufferData(n,r,i),e.onUploadCallback(),r instanceof Float32Array)s=t.FLOAT;else if(r instanceof Uint16Array)s=e.isFloat16BufferAttribute?t.HALF_FLOAT:t.UNSIGNED_SHORT;else if(r instanceof Int16Array)s=t.SHORT;else if(r instanceof Uint32Array)s=t.UNSIGNED_INT;else if(r instanceof Int32Array)s=t.INT;else if(r instanceof Int8Array)s=t.BYTE;else if(r instanceof Uint8Array)s=t.UNSIGNED_BYTE;else{if(!(r instanceof Uint8ClampedArray))throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+r);s=t.UNSIGNED_BYTE}return{buffer:a,type:s,bytesPerElement:r.BYTES_PER_ELEMENT,version:e.version,size:o}}(n,r));else if(i.version<n.version){if(i.size!==n.array.byteLength)throw new Error("THREE.WebGLAttributes: The size of the buffer attribute's array buffer does not match the original size. Resizing buffer attributes is not supported.");!function(e,n,r){const i=n.array,o=n._updateRange,a=n.updateRanges;if(t.bindBuffer(r,e),-1===o.count&&0===a.length&&t.bufferSubData(r,0,i),0!==a.length){for(let e=0,n=a.length;e<n;e++){const n=a[e];t.bufferSubData(r,n.start*i.BYTES_PER_ELEMENT,i,n.start,n.count)}n.clearUpdateRanges()}-1!==o.count&&(t.bufferSubData(r,o.offset*i.BYTES_PER_ELEMENT,i,o.offset,o.count),o.count=-1),n.onUploadCallback()}(i.buffer,n,r),i.version=n.version}}}}class Hi extends ti{constructor(t=1,e=1,n=1,r=1){super(),this.type="PlaneGeometry",this.parameters={width:t,height:e,widthSegments:n,heightSegments:r};const i=t/2,o=e/2,a=Math.floor(n),s=Math.floor(r),u=a+1,c=s+1,l=t/a,f=e/s,h=[],p=[],d=[],m=[];for(let t=0;t<c;t++){const e=t*f-o;for(let n=0;n<u;n++){const r=n*l-i;p.push(r,-e,0),d.push(0,0,1),m.push(n/a),m.push(1-t/s)}}for(let t=0;t<s;t++)for(let e=0;e<a;e++){const n=e+u*t,r=e+u*(t+1),i=e+1+u*(t+1),o=e+1+u*t;h.push(n,r,o),h.push(r,i,o)}this.setIndex(h),this.setAttribute("position",new qr(p,3)),this.setAttribute("normal",new qr(d,3)),this.setAttribute("uv",new qr(m,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new Hi(t.width,t.height,t.widthSegments,t.heightSegments)}}const Wi={alphahash_fragment:"#ifdef USE_ALPHAHASH\n\tif ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;\n#endif",alphahash_pars_fragment:"#ifdef USE_ALPHAHASH\n\tconst float ALPHA_HASH_SCALE = 0.05;\n\tfloat hash2D( vec2 value ) {\n\t\treturn fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );\n\t}\n\tfloat hash3D( vec3 value ) {\n\t\treturn hash2D( vec2( hash2D( value.xy ), value.z ) );\n\t}\n\tfloat getAlphaHashThreshold( vec3 position ) {\n\t\tfloat maxDeriv = max(\n\t\t\tlength( dFdx( position.xyz ) ),\n\t\t\tlength( dFdy( position.xyz ) )\n\t\t);\n\t\tfloat pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );\n\t\tvec2 pixScales = vec2(\n\t\t\texp2( floor( log2( pixScale ) ) ),\n\t\t\texp2( ceil( log2( pixScale ) ) )\n\t\t);\n\t\tvec2 alpha = vec2(\n\t\t\thash3D( floor( pixScales.x * position.xyz ) ),\n\t\t\thash3D( floor( pixScales.y * position.xyz ) )\n\t\t);\n\t\tfloat lerpFactor = fract( log2( pixScale ) );\n\t\tfloat x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;\n\t\tfloat a = min( lerpFactor, 1.0 - lerpFactor );\n\t\tvec3 cases = vec3(\n\t\t\tx * x / ( 2.0 * a * ( 1.0 - a ) ),\n\t\t\t( x - 0.5 * a ) / ( 1.0 - a ),\n\t\t\t1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )\n\t\t);\n\t\tfloat threshold = ( x < ( 1.0 - a ) )\n\t\t\t? ( ( x < a ) ? cases.x : cases.y )\n\t\t\t: cases.z;\n\t\treturn clamp( threshold , 1.0e-6, 1.0 );\n\t}\n#endif",alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef USE_ALPHATEST\n\t#ifdef ALPHA_TO_COVERAGE\n\tdiffuseColor.a = smoothstep( alphaTest, alphaTest + fwidth( diffuseColor.a ), diffuseColor.a );\n\tif ( diffuseColor.a == 0.0 ) discard;\n\t#else\n\tif ( diffuseColor.a < alphaTest ) discard;\n\t#endif\n#endif",alphatest_pars_fragment:"#ifdef USE_ALPHATEST\n\tuniform float alphaTest;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_CLEARCOAT ) \n\t\tclearcoatSpecularIndirect *= ambientOcclusion;\n\t#endif\n\t#if defined( USE_SHEEN ) \n\t\tsheenSpecularIndirect *= ambientOcclusion;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometryNormal, geometryViewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",batching_pars_vertex:"#ifdef USE_BATCHING\n\tattribute float batchId;\n\tuniform highp sampler2D batchingTexture;\n\tmat4 getBatchingMatrix( const in float i ) {\n\t\tint size = textureSize( batchingTexture, 0 ).x;\n\t\tint j = int( i ) * 4;\n\t\tint x = j % size;\n\t\tint y = j / size;\n\t\tvec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );\n\t\tvec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );\n\t\tvec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );\n\t\tvec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );\n\t\treturn mat4( v1, v2, v3, v4 );\n\t}\n#endif",batching_vertex:"#ifdef USE_BATCHING\n\tmat4 batchingMatrix = getBatchingMatrix( batchId );\n#endif",begin_vertex:"vec3 transformed = vec3( position );\n#ifdef USE_ALPHAHASH\n\tvPosition = vec3( position );\n#endif",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"float G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, 1.0, dotVH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n} // validated",iridescence_fragment:"#ifdef USE_IRIDESCENCE\n\tconst mat3 XYZ_TO_REC709 = mat3(\n\t\t 3.2404542, -0.9692660,  0.0556434,\n\t\t-1.5371385,  1.8760108, -0.2040259,\n\t\t-0.4985314,  0.0415560,  1.0572252\n\t);\n\tvec3 Fresnel0ToIor( vec3 fresnel0 ) {\n\t\tvec3 sqrtF0 = sqrt( fresnel0 );\n\t\treturn ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );\n\t}\n\tvec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );\n\t}\n\tfloat IorToFresnel0( float transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));\n\t}\n\tvec3 evalSensitivity( float OPD, vec3 shift ) {\n\t\tfloat phase = 2.0 * PI * OPD * 1.0e-9;\n\t\tvec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );\n\t\tvec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );\n\t\tvec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );\n\t\tvec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );\n\t\txyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );\n\t\txyz /= 1.0685e-7;\n\t\tvec3 rgb = XYZ_TO_REC709 * xyz;\n\t\treturn rgb;\n\t}\n\tvec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {\n\t\tvec3 I;\n\t\tfloat iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );\n\t\tfloat sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );\n\t\tfloat cosTheta2Sq = 1.0 - sinTheta2Sq;\n\t\tif ( cosTheta2Sq < 0.0 ) {\n\t\t\treturn vec3( 1.0 );\n\t\t}\n\t\tfloat cosTheta2 = sqrt( cosTheta2Sq );\n\t\tfloat R0 = IorToFresnel0( iridescenceIOR, outsideIOR );\n\t\tfloat R12 = F_Schlick( R0, 1.0, cosTheta1 );\n\t\tfloat T121 = 1.0 - R12;\n\t\tfloat phi12 = 0.0;\n\t\tif ( iridescenceIOR < outsideIOR ) phi12 = PI;\n\t\tfloat phi21 = PI - phi12;\n\t\tvec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );\t\tvec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );\n\t\tvec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );\n\t\tvec3 phi23 = vec3( 0.0 );\n\t\tif ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;\n\t\tif ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;\n\t\tif ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;\n\t\tfloat OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;\n\t\tvec3 phi = vec3( phi21 ) + phi23;\n\t\tvec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );\n\t\tvec3 r123 = sqrt( R123 );\n\t\tvec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );\n\t\tvec3 C0 = R12 + Rs;\n\t\tI = C0;\n\t\tvec3 Cm = Rs - T121;\n\t\tfor ( int m = 1; m <= 2; ++ m ) {\n\t\t\tCm *= r123;\n\t\t\tvec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );\n\t\t\tI += Cm * Sm;\n\t\t}\n\t\treturn max( I, vec3( 0.0 ) );\n\t}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vBumpMapUv );\n\t\tvec2 dSTdy = dFdy( vBumpMapUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n\t\tvec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );\n\t\tvec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 ) * faceDirection;\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#ifdef ALPHA_TO_COVERAGE\n\t\tfloat distanceToPlane, distanceGradient;\n\t\tfloat clipOpacity = 1.0;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tdistanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;\n\t\t\tdistanceGradient = fwidth( distanceToPlane ) / 2.0;\n\t\t\tclipOpacity *= smoothstep( - distanceGradient, distanceGradient, distanceToPlane );\n\t\t\tif ( clipOpacity == 0.0 ) discard;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\t\tfloat unionClipOpacity = 1.0;\n\t\t\t#pragma unroll_loop_start\n\t\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\t\tplane = clippingPlanes[ i ];\n\t\t\t\tdistanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;\n\t\t\t\tdistanceGradient = fwidth( distanceToPlane ) / 2.0;\n\t\t\t\tunionClipOpacity *= 1.0 - smoothstep( - distanceGradient, distanceGradient, distanceToPlane );\n\t\t\t}\n\t\t\t#pragma unroll_loop_end\n\t\t\tclipOpacity *= 1.0 - unionClipOpacity;\n\t\t#endif\n\t\tdiffuseColor.a *= clipOpacity;\n\t\tif ( diffuseColor.a == 0.0 ) discard;\n\t#else\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\t\tbool clipped = true;\n\t\t\t#pragma unroll_loop_start\n\t\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\t\tplane = clippingPlanes[ i ];\n\t\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t\t}\n\t\t\t#pragma unroll_loop_end\n\t\t\tif ( clipped ) discard;\n\t\t#endif\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#if defined( USE_COLOR_ALPHA )\n\tdiffuseColor *= vColor;\n#elif defined( USE_COLOR )\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR )\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvColor = vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nvec3 pow2( const in vec3 x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract( sin( sn ) * c );\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\n#ifdef USE_ALPHAHASH\n\tvarying vec3 vPosition;\n#endif\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat luminance( const in vec3 rgb ) {\n\tconst vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );\n\treturn dot( weights, rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}\nvec3 BRDF_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nfloat F_Schlick( const in float f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n} // validated",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\thighp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tuv.x += filterInt * 3.0 * cubeUV_minTileSize;\n\t\tuv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );\n\t\tuv.x *= CUBEUV_TEXEL_WIDTH;\n\t\tuv.y *= CUBEUV_TEXEL_HEIGHT;\n\t\t#ifdef texture2DGradEXT\n\t\t\treturn texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;\n\t\t#else\n\t\t\treturn texture2D( envMap, uv ).rgb;\n\t\t#endif\n\t}\n\t#define cubeUV_r0 1.0\n\t#define cubeUV_m0 - 2.0\n\t#define cubeUV_r1 0.8\n\t#define cubeUV_m1 - 1.0\n\t#define cubeUV_r4 0.4\n\t#define cubeUV_m4 2.0\n\t#define cubeUV_r5 0.305\n\t#define cubeUV_m5 3.0\n\t#define cubeUV_r6 0.21\n\t#define cubeUV_m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= cubeUV_r1 ) {\n\t\t\tmip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;\n\t\t} else if ( roughness >= cubeUV_r4 ) {\n\t\t\tmip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;\n\t\t} else if ( roughness >= cubeUV_r5 ) {\n\t\t\tmip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;\n\t\t} else if ( roughness >= cubeUV_r6 ) {\n\t\t\tmip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = objectTangent;\n#endif\n#ifdef USE_BATCHING\n\tmat3 bm = mat3( batchingMatrix );\n\ttransformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );\n\ttransformedNormal = bm * transformedNormal;\n\t#ifdef USE_TANGENT\n\t\ttransformedTangent = bm * transformedTangent;\n\t#endif\n#endif\n#ifdef USE_INSTANCING\n\tmat3 im = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );\n\ttransformedNormal = im * transformedNormal;\n\t#ifdef USE_TANGENT\n\t\ttransformedTangent = im * transformedTangent;\n\t#endif\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\ttransformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",colorspace_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",colorspace_pars_fragment:"\nconst mat3 LINEAR_SRGB_TO_LINEAR_DISPLAY_P3 = mat3(\n\tvec3( 0.8224621, 0.177538, 0.0 ),\n\tvec3( 0.0331941, 0.9668058, 0.0 ),\n\tvec3( 0.0170827, 0.0723974, 0.9105199 )\n);\nconst mat3 LINEAR_DISPLAY_P3_TO_LINEAR_SRGB = mat3(\n\tvec3( 1.2249401, - 0.2249404, 0.0 ),\n\tvec3( - 0.0420569, 1.0420571, 0.0 ),\n\tvec3( - 0.0196376, - 0.0786361, 1.0982735 )\n);\nvec4 LinearSRGBToLinearDisplayP3( in vec4 value ) {\n\treturn vec4( value.rgb * LINEAR_SRGB_TO_LINEAR_DISPLAY_P3, value.a );\n}\nvec4 LinearDisplayP3ToLinearSRGB( in vec4 value ) {\n\treturn vec4( value.rgb * LINEAR_DISPLAY_P3_TO_LINEAR_SRGB, value.a );\n}\nvec4 LinearTransferOETF( in vec4 value ) {\n\treturn value;\n}\nvec4 sRGBTransferOETF( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn sRGBTransferOETF( value );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, envMapRotation * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\tuniform mat3 envMapRotation;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#ifdef USE_ENVMAP\n\tvec3 getIBLIrradiance( const in vec3 normal ) {\n\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, envMapRotation * worldNormal, 1.0 );\n\t\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\tvec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {\n\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\tvec3 reflectVec = reflect( - viewDir, normal );\n\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, envMapRotation * reflectVec, roughness );\n\t\t\treturn envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\t#ifdef USE_ANISOTROPY\n\t\tvec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {\n\t\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\t\tvec3 bentNormal = cross( bitangent, viewDir );\n\t\t\t\tbentNormal = normalize( cross( bentNormal, bitangent ) );\n\t\t\t\tbentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );\n\t\t\t\treturn getIBLRadiance( viewDir, bentNormal, roughness );\n\t\t\t#else\n\t\t\t\treturn vec3( 0.0 );\n\t\t\t#endif\n\t\t}\n\t#endif\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tvFogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float vFogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, vFogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float vFogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn vec3( texture2D( gradientMap, coord ).r );\n\t#else\n\t\tvec2 fw = fwidth( coord ) * 0.5;\n\t\treturn mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );\n\t#endif\n}",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\treflectedLight.indirectDiffuse += lightMapIrradiance;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_fragment:"LambertMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularStrength = specularStrength;",lights_lambert_pars_fragment:"varying vec3 vViewPosition;\nstruct LambertMaterial {\n\tvec3 diffuseColor;\n\tfloat specularStrength;\n};\nvoid RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Lambert\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Lambert",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\n#if defined( USE_LIGHT_PROBES )\n\tuniform vec3 lightProbe[ 9 ];\n#endif\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {\n\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\treturn irradiance;\n}\nfloat getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\t#if defined ( LEGACY_LIGHTS )\n\t\tif ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\t\treturn pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t\t}\n\t\treturn 1.0;\n\t#else\n\t\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\t\tif ( cutoffDistance > 0.0 ) {\n\t\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t\t}\n\t\treturn distanceFalloff;\n\t#endif\n}\nfloat getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {\n\treturn smoothstep( coneCosine, penumbraCosine, angleCosine );\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {\n\t\tlight.color = directionalLight.color;\n\t\tlight.direction = directionalLight.direction;\n\t\tlight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {\n\t\tvec3 lVector = pointLight.position - geometryPosition;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tlight.color = pointLight.color;\n\t\tlight.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );\n\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {\n\t\tvec3 lVector = spotLight.position - geometryPosition;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat angleCos = dot( light.direction, spotLight.direction );\n\t\tfloat spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\tif ( spotAttenuation > 0.0 ) {\n\t\t\tfloat lightDistance = length( lVector );\n\t\t\tlight.color = spotLight.color * spotAttenuation;\n\t\t\tlight.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t\t} else {\n\t\t\tlight.color = vec3( 0.0 );\n\t\t\tlight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {\n\t\tfloat dotNL = dot( normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;\nmaterial.roughness = min( material.roughness, 1.0 );\n#ifdef IOR\n\tmaterial.ior = ior;\n\t#ifdef USE_SPECULAR\n\t\tfloat specularIntensityFactor = specularIntensity;\n\t\tvec3 specularColorFactor = specularColor;\n\t\t#ifdef USE_SPECULAR_COLORMAP\n\t\t\tspecularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;\n\t\t#endif\n\t\t#ifdef USE_SPECULAR_INTENSITYMAP\n\t\t\tspecularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;\n\t\t#endif\n\t\tmaterial.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );\n\t#else\n\t\tfloat specularIntensityFactor = 1.0;\n\t\tvec3 specularColorFactor = vec3( 1.0 );\n\t\tmaterial.specularF90 = 1.0;\n\t#endif\n\tmaterial.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.specularF90 = 1.0;\n#endif\n#ifdef USE_CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\tmaterial.clearcoatF0 = vec3( 0.04 );\n\tmaterial.clearcoatF90 = 1.0;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_IRIDESCENCE\n\tmaterial.iridescence = iridescence;\n\tmaterial.iridescenceIOR = iridescenceIOR;\n\t#ifdef USE_IRIDESCENCEMAP\n\t\tmaterial.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;\n\t#endif\n\t#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\t\tmaterial.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;\n\t#else\n\t\tmaterial.iridescenceThickness = iridescenceThicknessMaximum;\n\t#endif\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheenColor;\n\t#ifdef USE_SHEEN_COLORMAP\n\t\tmaterial.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;\n\t#endif\n\tmaterial.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );\n\t#ifdef USE_SHEEN_ROUGHNESSMAP\n\t\tmaterial.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;\n\t#endif\n#endif\n#ifdef USE_ANISOTROPY\n\t#ifdef USE_ANISOTROPYMAP\n\t\tmat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );\n\t\tvec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;\n\t\tvec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;\n\t#else\n\t\tvec2 anisotropyV = anisotropyVector;\n\t#endif\n\tmaterial.anisotropy = length( anisotropyV );\n\tif( material.anisotropy == 0.0 ) {\n\t\tanisotropyV = vec2( 1.0, 0.0 );\n\t} else {\n\t\tanisotropyV /= material.anisotropy;\n\t\tmaterial.anisotropy = saturate( material.anisotropy );\n\t}\n\tmaterial.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );\n\tmaterial.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;\n\tmaterial.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat roughness;\n\tvec3 specularColor;\n\tfloat specularF90;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat clearcoat;\n\t\tfloat clearcoatRoughness;\n\t\tvec3 clearcoatF0;\n\t\tfloat clearcoatF90;\n\t#endif\n\t#ifdef USE_IRIDESCENCE\n\t\tfloat iridescence;\n\t\tfloat iridescenceIOR;\n\t\tfloat iridescenceThickness;\n\t\tvec3 iridescenceFresnel;\n\t\tvec3 iridescenceF0;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tvec3 sheenColor;\n\t\tfloat sheenRoughness;\n\t#endif\n\t#ifdef IOR\n\t\tfloat ior;\n\t#endif\n\t#ifdef USE_TRANSMISSION\n\t\tfloat transmission;\n\t\tfloat transmissionAlpha;\n\t\tfloat thickness;\n\t\tfloat attenuationDistance;\n\t\tvec3 attenuationColor;\n\t#endif\n\t#ifdef USE_ANISOTROPY\n\t\tfloat anisotropy;\n\t\tfloat alphaT;\n\t\tvec3 anisotropyT;\n\t\tvec3 anisotropyB;\n\t#endif\n};\nvec3 clearcoatSpecularDirect = vec3( 0.0 );\nvec3 clearcoatSpecularIndirect = vec3( 0.0 );\nvec3 sheenSpecularDirect = vec3( 0.0 );\nvec3 sheenSpecularIndirect = vec3(0.0 );\nvec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {\n    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );\n    float x2 = x * x;\n    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );\n    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );\n}\nfloat V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\n#ifdef USE_ANISOTROPY\n\tfloat V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {\n\t\tfloat gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );\n\t\tfloat gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );\n\t\tfloat v = 0.5 / ( gv + gl );\n\t\treturn saturate(v);\n\t}\n\tfloat D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {\n\t\tfloat a2 = alphaT * alphaB;\n\t\thighp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );\n\t\thighp float v2 = dot( v, v );\n\t\tfloat w2 = a2 / v2;\n\t\treturn RECIPROCAL_PI * a2 * pow2 ( w2 );\n\t}\n#endif\n#ifdef USE_CLEARCOAT\n\tvec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {\n\t\tvec3 f0 = material.clearcoatF0;\n\t\tfloat f90 = material.clearcoatF90;\n\t\tfloat roughness = material.clearcoatRoughness;\n\t\tfloat alpha = pow2( roughness );\n\t\tvec3 halfDir = normalize( lightDir + viewDir );\n\t\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\t\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\t\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\t\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\t\tvec3 F = F_Schlick( f0, f90, dotVH );\n\t\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\t\tfloat D = D_GGX( alpha, dotNH );\n\t\treturn F * ( V * D );\n\t}\n#endif\nvec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {\n\tvec3 f0 = material.specularColor;\n\tfloat f90 = material.specularF90;\n\tfloat roughness = material.roughness;\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( f0, f90, dotVH );\n\t#ifdef USE_IRIDESCENCE\n\t\tF = mix( F, material.iridescenceFresnel, material.iridescence );\n\t#endif\n\t#ifdef USE_ANISOTROPY\n\t\tfloat dotTL = dot( material.anisotropyT, lightDir );\n\t\tfloat dotTV = dot( material.anisotropyT, viewDir );\n\t\tfloat dotTH = dot( material.anisotropyT, halfDir );\n\t\tfloat dotBL = dot( material.anisotropyB, lightDir );\n\t\tfloat dotBV = dot( material.anisotropyB, viewDir );\n\t\tfloat dotBH = dot( material.anisotropyB, halfDir );\n\t\tfloat V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );\n\t\tfloat D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );\n\t#else\n\t\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\t\tfloat D = D_GGX( alpha, dotNH );\n\t#endif\n\treturn F * ( V * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie( float roughness, float dotNH ) {\n\tfloat alpha = pow2( roughness );\n\tfloat invAlpha = 1.0 / alpha;\n\tfloat cos2h = dotNH * dotNH;\n\tfloat sin2h = max( 1.0 - cos2h, 0.0078125 );\n\treturn ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );\n}\nfloat V_Neubelt( float dotNV, float dotNL ) {\n\treturn saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );\n}\nvec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat D = D_Charlie( sheenRoughness, dotNH );\n\tfloat V = V_Neubelt( dotNV, dotNL );\n\treturn sheenColor * ( D * V );\n}\n#endif\nfloat IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat r2 = roughness * roughness;\n\tfloat a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;\n\tfloat b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;\n\tfloat DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );\n\treturn saturate( DG * RECIPROCAL_PI );\n}\nvec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;\n\treturn fab;\n}\nvec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\treturn specularColor * fab.x + specularF90 * fab.y;\n}\n#ifdef USE_IRIDESCENCE\nvoid computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#else\nvoid computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#endif\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\t#ifdef USE_IRIDESCENCE\n\t\tvec3 Fr = mix( specularColor, iridescenceF0, iridescence );\n\t#else\n\t\tvec3 Fr = specularColor;\n\t#endif\n\tvec3 FssEss = Fr * fab.x + specularF90 * fab.y;\n\tfloat Ess = fab.x + fab.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometryNormal;\n\t\tvec3 viewDir = geometryViewDir;\n\t\tvec3 position = geometryPosition;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.roughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = dotNLcc * directLight.color;\n\t\tclearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );\n\t#endif\n\treflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );\n\t#endif\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\t#ifdef USE_IRIDESCENCE\n\t\tcomputeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );\n\t#else\n\t\tcomputeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );\n\t#endif\n\tvec3 totalScattering = singleScattering + multiScattering;\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );\n\treflectedLight.indirectSpecular += radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nvec3 geometryPosition = - vViewPosition;\nvec3 geometryNormal = normal;\nvec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\nvec3 geometryClearcoatNormal = vec3( 0.0 );\n#ifdef USE_CLEARCOAT\n\tgeometryClearcoatNormal = clearcoatNormal;\n#endif\n#ifdef USE_IRIDESCENCE\n\tfloat dotNVi = saturate( dot( normal, geometryViewDir ) );\n\tif ( material.iridescenceThickness == 0.0 ) {\n\t\tmaterial.iridescence = 0.0;\n\t} else {\n\t\tmaterial.iridescence = saturate( material.iridescence );\n\t}\n\tif ( material.iridescence > 0.0 ) {\n\t\tmaterial.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );\n\t\tmaterial.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );\n\t}\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointLightInfo( pointLight, geometryPosition, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\tvec4 spotColor;\n\tvec3 spotLightCoord;\n\tbool inSpotLightMap;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotLightInfo( spotLight, geometryPosition, directLight );\n\t\t#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX\n\t\t#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS\n\t\t#else\n\t\t#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#endif\n\t\t#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )\n\t\t\tspotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;\n\t\t\tinSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );\n\t\t\tspotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );\n\t\t\tdirectLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;\n\t\t#endif\n\t\t#undef SPOT_LIGHT_MAP_INDEX\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalLightInfo( directionalLight, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\t#if defined( USE_LIGHT_PROBES )\n\t\tirradiance += getLightProbeIrradiance( lightProbe, geometryNormal );\n\t#endif\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\t\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getIBLIrradiance( geometryNormal );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\t#ifdef USE_ANISOTROPY\n\t\tradiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );\n\t#else\n\t\tradiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF )\n\tgl_FragDepth = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\tvFragDepth = 1.0 + gl_Position.w;\n\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 sampledDiffuseColor = texture2D( map, vMapUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\tsampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );\n\t\n\t#endif\n\tdiffuseColor *= sampledDiffuseColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\t#if defined( USE_POINTS_UV )\n\t\tvec2 uv = vUv;\n\t#else\n\t\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n\t#endif\n#endif\n#ifdef USE_MAP\n\tdiffuseColor *= texture2D( map, uv );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_POINTS_UV )\n\tvarying vec2 vUv;\n#else\n\t#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\t\tuniform mat3 uvTransform;\n\t#endif\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphinstance_vertex:"#ifdef USE_INSTANCING_MORPH\n\tfloat morphTargetInfluences[MORPHTARGETS_COUNT];\n\tfloat morphTargetBaseInfluence = texelFetch( morphTexture, ivec2( 0, gl_InstanceID ), 0 ).r;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\tmorphTargetInfluences[i] =  texelFetch( morphTexture, ivec2( i + 1, gl_InstanceID ), 0 ).r;\n\t}\n#endif",morphcolor_vertex:"#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )\n\tvColor *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t#if defined( USE_COLOR_ALPHA )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];\n\t\t#elif defined( USE_COLOR )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];\n\t\t#endif\n\t}\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\t\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\t\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\t\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n\t#endif\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\t#ifndef USE_INSTANCING_MORPH\n\t\tuniform float morphTargetBaseInfluence;\n\t#endif\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\t#ifndef USE_INSTANCING_MORPH\n\t\t\tuniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\t\t#endif\n\t\tuniform sampler2DArray morphTargetsTexture;\n\t\tuniform ivec2 morphTargetsTextureSize;\n\t\tvec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {\n\t\t\tint texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;\n\t\t\tint y = texelIndex / morphTargetsTextureSize.x;\n\t\t\tint x = texelIndex - y * morphTargetsTextureSize.x;\n\t\t\tivec3 morphUV = ivec3( x, y, morphTargetIndex );\n\t\t\treturn texelFetch( morphTargetsTexture, morphUV, 0 );\n\t\t}\n\t#else\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\tuniform float morphTargetInfluences[ 8 ];\n\t\t#else\n\t\t\tuniform float morphTargetInfluences[ 4 ];\n\t\t#endif\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\t\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\t\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\t\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\t\t\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\t\t\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\t\t\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t\t#endif\n\t#endif\n#endif",normal_fragment_begin:"float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n\tvec3 fdx = dFdx( vViewPosition );\n\tvec3 fdy = dFdy( vViewPosition );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal *= faceDirection;\n\t#endif\n#endif\n#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )\n\t#ifdef USE_TANGENT\n\t\tmat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );\n\t#else\n\t\tmat3 tbn = getTangentFrame( - vViewPosition, normal,\n\t\t#if defined( USE_NORMALMAP )\n\t\t\tvNormalMapUv\n\t\t#elif defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tvClearcoatNormalMapUv\n\t\t#else\n\t\t\tvUv\n\t\t#endif\n\t\t);\n\t#endif\n\t#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )\n\t\ttbn[0] *= faceDirection;\n\t\ttbn[1] *= faceDirection;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\t#ifdef USE_TANGENT\n\t\tmat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );\n\t#else\n\t\tmat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );\n\t#endif\n\t#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )\n\t\ttbn2[0] *= faceDirection;\n\t\ttbn2[1] *= faceDirection;\n\t#endif\n#endif\nvec3 nonPerturbedNormal = normal;",normal_fragment_maps:"#ifdef USE_NORMALMAP_OBJECTSPACE\n\tnormal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( USE_NORMALMAP_TANGENTSPACE )\n\tvec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\tnormal = normalize( tbn * mapN );\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif",normal_pars_fragment:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_pars_vertex:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_vertex:"#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef USE_NORMALMAP_OBJECTSPACE\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )\n\tmat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {\n\t\tvec3 q0 = dFdx( eye_pos.xyz );\n\t\tvec3 q1 = dFdy( eye_pos.xyz );\n\t\tvec2 st0 = dFdx( uv.st );\n\t\tvec2 st1 = dFdy( uv.st );\n\t\tvec3 N = surf_norm;\n\t\tvec3 q1perp = cross( q1, N );\n\t\tvec3 q0perp = cross( N, q0 );\n\t\tvec3 T = q1perp * st0.x + q0perp * st1.x;\n\t\tvec3 B = q1perp * st0.y + q0perp * st1.y;\n\t\tfloat det = max( dot( T, T ), dot( B, B ) );\n\t\tfloat scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );\n\t\treturn mat3( T * scale, B * scale, N );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal = nonPerturbedNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\tclearcoatNormal = normalize( tbn2 * clearcoatMapN );\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif",iridescence_pars_fragment:"#ifdef USE_IRIDESCENCEMAP\n\tuniform sampler2D iridescenceMap;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform sampler2D iridescenceThicknessMap;\n#endif",opaque_fragment:"#ifdef OPAQUE\ndiffuseColor.a = 1.0;\n#endif\n#ifdef USE_TRANSMISSION\ndiffuseColor.a *= material.transmissionAlpha;\n#endif\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec2 packDepthToRG( in highp float v ) {\n\treturn packDepthToRGBA( v ).yx;\n}\nfloat unpackRGToDepth( const in highp vec2 v ) {\n\treturn unpackRGBAToDepth( vec4( v.xy, 0.0, 0.0 ) );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {\n\treturn depth * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * depth - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_BATCHING\n\tmvPosition = batchingMatrix * mvPosition;\n#endif\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#if NUM_SPOT_LIGHT_COORDS > 0\n\tvarying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#if NUM_SPOT_LIGHT_MAPS > 0\n\tuniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;\n\t\tbool frustumTest = inFrustum && shadowCoord.z <= 1.0;\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tfloat shadow = 1.0;\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\t\n\t\tfloat lightToPositionLength = length( lightToPosition );\n\t\tif ( lightToPositionLength - shadowCameraFar <= 0.0 && lightToPositionLength - shadowCameraNear >= 0.0 ) {\n\t\t\tfloat dp = ( lightToPositionLength - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\t\tdp += shadowBias;\n\t\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\t\tshadow = (\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t\t) * ( 1.0 / 9.0 );\n\t\t\t#else\n\t\t\t\tshadow = texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n#endif",shadowmap_pars_vertex:"#if NUM_SPOT_LIGHT_COORDS > 0\n\tuniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];\n\tvarying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )\n\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\tvec4 shadowWorldPosition;\n#endif\n#if defined( USE_SHADOWMAP )\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if NUM_SPOT_LIGHT_COORDS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition;\n\t\t#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t\tshadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;\n\t\t#endif\n\t\tvSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\tuniform highp sampler2D boneTexture;\n\tmat4 getBoneMatrix( const in float i ) {\n\t\tint size = textureSize( boneTexture, 0 ).x;\n\t\tint j = int( i ) * 4;\n\t\tint x = j % size;\n\t\tint y = j / size;\n\t\tvec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );\n\t\tvec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );\n\t\tvec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );\n\t\tvec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );\n\t\treturn mat4( v1, v2, v3, v4 );\n\t}\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn saturate( toneMappingExposure * color );\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nconst mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(\n\tvec3( 1.6605, - 0.1246, - 0.0182 ),\n\tvec3( - 0.5876, 1.1329, - 0.1006 ),\n\tvec3( - 0.0728, - 0.0083, 1.1187 )\n);\nconst mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(\n\tvec3( 0.6274, 0.0691, 0.0164 ),\n\tvec3( 0.3293, 0.9195, 0.0880 ),\n\tvec3( 0.0433, 0.0113, 0.8956 )\n);\nvec3 agxDefaultContrastApprox( vec3 x ) {\n\tvec3 x2 = x * x;\n\tvec3 x4 = x2 * x2;\n\treturn + 15.5 * x4 * x2\n\t\t- 40.14 * x4 * x\n\t\t+ 31.96 * x4\n\t\t- 6.868 * x2 * x\n\t\t+ 0.4298 * x2\n\t\t+ 0.1191 * x\n\t\t- 0.00232;\n}\nvec3 AgXToneMapping( vec3 color ) {\n\tconst mat3 AgXInsetMatrix = mat3(\n\t\tvec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),\n\t\tvec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),\n\t\tvec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )\n\t);\n\tconst mat3 AgXOutsetMatrix = mat3(\n\t\tvec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),\n\t\tvec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),\n\t\tvec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )\n\t);\n\tconst float AgxMinEv = - 12.47393;\tconst float AgxMaxEv = 4.026069;\n\tcolor *= toneMappingExposure;\n\tcolor = LINEAR_SRGB_TO_LINEAR_REC2020 * color;\n\tcolor = AgXInsetMatrix * color;\n\tcolor = max( color, 1e-10 );\tcolor = log2( color );\n\tcolor = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );\n\tcolor = clamp( color, 0.0, 1.0 );\n\tcolor = agxDefaultContrastApprox( color );\n\tcolor = AgXOutsetMatrix * color;\n\tcolor = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );\n\tcolor = LINEAR_REC2020_TO_LINEAR_SRGB * color;\n\tcolor = clamp( color, 0.0, 1.0 );\n\treturn color;\n}\nvec3 NeutralToneMapping( vec3 color ) {\n\tfloat startCompression = 0.8 - 0.04;\n\tfloat desaturation = 0.15;\n\tcolor *= toneMappingExposure;\n\tfloat x = min(color.r, min(color.g, color.b));\n\tfloat offset = x < 0.08 ? x - 6.25 * x * x : 0.04;\n\tcolor -= offset;\n\tfloat peak = max(color.r, max(color.g, color.b));\n\tif (peak < startCompression) return color;\n\tfloat d = 1. - startCompression;\n\tfloat newPeak = 1. - d * d / (peak + d - startCompression);\n\tcolor *= newPeak / peak;\n\tfloat g = 1. - 1. / (desaturation * (peak - newPeak) + 1.);\n\treturn mix(color, newPeak * vec3(1, 1, 1), g);\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmission_fragment:"#ifdef USE_TRANSMISSION\n\tmaterial.transmission = transmission;\n\tmaterial.transmissionAlpha = 1.0;\n\tmaterial.thickness = thickness;\n\tmaterial.attenuationDistance = attenuationDistance;\n\tmaterial.attenuationColor = attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tmaterial.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tmaterial.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;\n\t#endif\n\tvec3 pos = vWorldPosition;\n\tvec3 v = normalize( cameraPosition - pos );\n\tvec3 n = inverseTransformDirection( normal, viewMatrix );\n\tvec4 transmitted = getIBLVolumeRefraction(\n\t\tn, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,\n\t\tpos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness,\n\t\tmaterial.attenuationColor, material.attenuationDistance );\n\tmaterial.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );\n\ttotalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );\n#endif",transmission_pars_fragment:"#ifdef USE_TRANSMISSION\n\tuniform float transmission;\n\tuniform float thickness;\n\tuniform float attenuationDistance;\n\tuniform vec3 attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tuniform sampler2D transmissionMap;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tuniform sampler2D thicknessMap;\n\t#endif\n\tuniform vec2 transmissionSamplerSize;\n\tuniform sampler2D transmissionSamplerMap;\n\tuniform mat4 modelMatrix;\n\tuniform mat4 projectionMatrix;\n\tvarying vec3 vWorldPosition;\n\tfloat w0( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );\n\t}\n\tfloat w1( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );\n\t}\n\tfloat w2( float a ){\n\t\treturn ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );\n\t}\n\tfloat w3( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a * a * a );\n\t}\n\tfloat g0( float a ) {\n\t\treturn w0( a ) + w1( a );\n\t}\n\tfloat g1( float a ) {\n\t\treturn w2( a ) + w3( a );\n\t}\n\tfloat h0( float a ) {\n\t\treturn - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );\n\t}\n\tfloat h1( float a ) {\n\t\treturn 1.0 + w3( a ) / ( w2( a ) + w3( a ) );\n\t}\n\tvec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {\n\t\tuv = uv * texelSize.zw + 0.5;\n\t\tvec2 iuv = floor( uv );\n\t\tvec2 fuv = fract( uv );\n\t\tfloat g0x = g0( fuv.x );\n\t\tfloat g1x = g1( fuv.x );\n\t\tfloat h0x = h0( fuv.x );\n\t\tfloat h1x = h1( fuv.x );\n\t\tfloat h0y = h0( fuv.y );\n\t\tfloat h1y = h1( fuv.y );\n\t\tvec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n\t\treturn g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +\n\t\t\tg1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );\n\t}\n\tvec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {\n\t\tvec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );\n\t\tvec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );\n\t\tvec2 fLodSizeInv = 1.0 / fLodSize;\n\t\tvec2 cLodSizeInv = 1.0 / cLodSize;\n\t\tvec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );\n\t\tvec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );\n\t\treturn mix( fSample, cSample, fract( lod ) );\n\t}\n\tvec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {\n\t\tvec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );\n\t\tvec3 modelScale;\n\t\tmodelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n\t\tmodelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n\t\tmodelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n\t\treturn normalize( refractionVector ) * thickness * modelScale;\n\t}\n\tfloat applyIorToRoughness( const in float roughness, const in float ior ) {\n\t\treturn roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n\t}\n\tvec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {\n\t\tfloat lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n\t\treturn textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );\n\t}\n\tvec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tif ( isinf( attenuationDistance ) ) {\n\t\t\treturn vec3( 1.0 );\n\t\t} else {\n\t\t\tvec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;\n\t\t\tvec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );\t\t\treturn transmittance;\n\t\t}\n\t}\n\tvec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,\n\t\tconst in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,\n\t\tconst in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,\n\t\tconst in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\trefractionCoords += 1.0;\n\t\trefractionCoords /= 2.0;\n\t\tvec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );\n\t\tvec3 transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );\n\t\tvec3 attenuatedColor = transmittance * transmittedLight.rgb;\n\t\tvec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );\n\t\tfloat transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;\n\t\treturn vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );\n\t}\n#endif",uv_pars_fragment:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvarying vec2 vUv;\n#endif\n#ifdef USE_MAP\n\tvarying vec2 vMapUv;\n#endif\n#ifdef USE_ALPHAMAP\n\tvarying vec2 vAlphaMapUv;\n#endif\n#ifdef USE_LIGHTMAP\n\tvarying vec2 vLightMapUv;\n#endif\n#ifdef USE_AOMAP\n\tvarying vec2 vAoMapUv;\n#endif\n#ifdef USE_BUMPMAP\n\tvarying vec2 vBumpMapUv;\n#endif\n#ifdef USE_NORMALMAP\n\tvarying vec2 vNormalMapUv;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tvarying vec2 vEmissiveMapUv;\n#endif\n#ifdef USE_METALNESSMAP\n\tvarying vec2 vMetalnessMapUv;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tvarying vec2 vRoughnessMapUv;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tvarying vec2 vAnisotropyMapUv;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tvarying vec2 vClearcoatMapUv;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tvarying vec2 vClearcoatNormalMapUv;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tvarying vec2 vClearcoatRoughnessMapUv;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tvarying vec2 vIridescenceMapUv;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tvarying vec2 vIridescenceThicknessMapUv;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tvarying vec2 vSheenColorMapUv;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tvarying vec2 vSheenRoughnessMapUv;\n#endif\n#ifdef USE_SPECULARMAP\n\tvarying vec2 vSpecularMapUv;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tvarying vec2 vSpecularColorMapUv;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tvarying vec2 vSpecularIntensityMapUv;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tuniform mat3 transmissionMapTransform;\n\tvarying vec2 vTransmissionMapUv;\n#endif\n#ifdef USE_THICKNESSMAP\n\tuniform mat3 thicknessMapTransform;\n\tvarying vec2 vThicknessMapUv;\n#endif",uv_pars_vertex:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvarying vec2 vUv;\n#endif\n#ifdef USE_MAP\n\tuniform mat3 mapTransform;\n\tvarying vec2 vMapUv;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform mat3 alphaMapTransform;\n\tvarying vec2 vAlphaMapUv;\n#endif\n#ifdef USE_LIGHTMAP\n\tuniform mat3 lightMapTransform;\n\tvarying vec2 vLightMapUv;\n#endif\n#ifdef USE_AOMAP\n\tuniform mat3 aoMapTransform;\n\tvarying vec2 vAoMapUv;\n#endif\n#ifdef USE_BUMPMAP\n\tuniform mat3 bumpMapTransform;\n\tvarying vec2 vBumpMapUv;\n#endif\n#ifdef USE_NORMALMAP\n\tuniform mat3 normalMapTransform;\n\tvarying vec2 vNormalMapUv;\n#endif\n#ifdef USE_DISPLACEMENTMAP\n\tuniform mat3 displacementMapTransform;\n\tvarying vec2 vDisplacementMapUv;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tuniform mat3 emissiveMapTransform;\n\tvarying vec2 vEmissiveMapUv;\n#endif\n#ifdef USE_METALNESSMAP\n\tuniform mat3 metalnessMapTransform;\n\tvarying vec2 vMetalnessMapUv;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tuniform mat3 roughnessMapTransform;\n\tvarying vec2 vRoughnessMapUv;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tuniform mat3 anisotropyMapTransform;\n\tvarying vec2 vAnisotropyMapUv;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tuniform mat3 clearcoatMapTransform;\n\tvarying vec2 vClearcoatMapUv;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform mat3 clearcoatNormalMapTransform;\n\tvarying vec2 vClearcoatNormalMapUv;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform mat3 clearcoatRoughnessMapTransform;\n\tvarying vec2 vClearcoatRoughnessMapUv;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tuniform mat3 sheenColorMapTransform;\n\tvarying vec2 vSheenColorMapUv;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tuniform mat3 sheenRoughnessMapTransform;\n\tvarying vec2 vSheenRoughnessMapUv;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tuniform mat3 iridescenceMapTransform;\n\tvarying vec2 vIridescenceMapUv;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform mat3 iridescenceThicknessMapTransform;\n\tvarying vec2 vIridescenceThicknessMapUv;\n#endif\n#ifdef USE_SPECULARMAP\n\tuniform mat3 specularMapTransform;\n\tvarying vec2 vSpecularMapUv;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tuniform mat3 specularColorMapTransform;\n\tvarying vec2 vSpecularColorMapUv;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tuniform mat3 specularIntensityMapTransform;\n\tvarying vec2 vSpecularIntensityMapUv;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tuniform mat3 transmissionMapTransform;\n\tvarying vec2 vTransmissionMapUv;\n#endif\n#ifdef USE_THICKNESSMAP\n\tuniform mat3 thicknessMapTransform;\n\tvarying vec2 vThicknessMapUv;\n#endif",uv_vertex:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvUv = vec3( uv, 1 ).xy;\n#endif\n#ifdef USE_MAP\n\tvMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ALPHAMAP\n\tvAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_LIGHTMAP\n\tvLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_AOMAP\n\tvAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_BUMPMAP\n\tvBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_NORMALMAP\n\tvNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_DISPLACEMENTMAP\n\tvDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tvEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_METALNESSMAP\n\tvMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tvRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tvAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tvClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tvClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tvClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tvIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tvIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tvSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tvSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULARMAP\n\tvSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tvSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tvSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tvTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_THICKNESSMAP\n\tvThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_BATCHING\n\t\tworldPosition = batchingMatrix * worldPosition;\n\t#endif\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",background_frag:"uniform sampler2D t2D;\nuniform float backgroundIntensity;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\ttexColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );\n\t#endif\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",backgroundCube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",backgroundCube_frag:"#ifdef ENVMAP_TYPE_CUBE\n\tuniform samplerCube envMap;\n#elif defined( ENVMAP_TYPE_CUBE_UV )\n\tuniform sampler2D envMap;\n#endif\nuniform float flipEnvMap;\nuniform float backgroundBlurriness;\nuniform float backgroundIntensity;\nuniform mat3 backgroundRotation;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 texColor = textureCube( envMap, backgroundRotation * vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 texColor = textureCubeUV( envMap, backgroundRotation * vWorldDirection, backgroundBlurriness );\n\t#else\n\t\tvec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t#endif\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",cube_frag:"uniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\nvarying vec3 vWorldDirection;\nvoid main() {\n\tvec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );\n\tgl_FragColor = texColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",depth_vert:"#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <batching_vertex>\n\t#include <skinbase_vertex>\n\t#include <morphinstance_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <clipping_planes_fragment>\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#endif\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <batching_vertex>\n\t#include <skinbase_vertex>\n\t#include <morphinstance_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <clipping_planes_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",meshbasic_vert:"#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinbase_vertex>\n\t\t#include <skinnormal_vertex>\n\t\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\t\treflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"#define LAMBERT\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_lambert_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_lambert_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t#else\n\t\tvec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshnormal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvarying vec3 vViewPosition;\n#endif\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",meshnormal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvarying vec3 vViewPosition;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( 0.0, 0.0, 0.0, opacity );\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), diffuseColor.a );\n\t#ifdef OPAQUE\n\t\tgl_FragColor.a = 1.0;\n\t#endif\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifdef USE_TRANSMISSION\n\tvarying vec3 vWorldPosition;\n#endif\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n\tvWorldPosition = worldPosition.xyz;\n#endif\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define IOR\n\t#define USE_SPECULAR\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef IOR\n\tuniform float ior;\n#endif\n#ifdef USE_SPECULAR\n\tuniform float specularIntensity;\n\tuniform vec3 specularColor;\n\t#ifdef USE_SPECULAR_COLORMAP\n\t\tuniform sampler2D specularColorMap;\n\t#endif\n\t#ifdef USE_SPECULAR_INTENSITYMAP\n\t\tuniform sampler2D specularIntensityMap;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_IRIDESCENCE\n\tuniform float iridescence;\n\tuniform float iridescenceIOR;\n\tuniform float iridescenceThicknessMinimum;\n\tuniform float iridescenceThicknessMaximum;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheenColor;\n\tuniform float sheenRoughness;\n\t#ifdef USE_SHEEN_COLORMAP\n\t\tuniform sampler2D sheenColorMap;\n\t#endif\n\t#ifdef USE_SHEEN_ROUGHNESSMAP\n\t\tuniform sampler2D sheenRoughnessMap;\n\t#endif\n#endif\n#ifdef USE_ANISOTROPY\n\tuniform vec2 anisotropyVector;\n\t#ifdef USE_ANISOTROPYMAP\n\t\tuniform sampler2D anisotropyMap;\n\t#endif\n#endif\nvarying vec3 vViewPosition;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <iridescence_fragment>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <transmission_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <iridescence_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n\tvec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n\t#include <transmission_fragment>\n\tvec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n\t#ifdef USE_SHEEN\n\t\tfloat sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );\n\t\toutgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );\n\t\tvec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );\n\t\toutgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;\n\t#endif\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n#ifdef USE_POINTS_UV\n\tvarying vec2 vUv;\n\tuniform mat3 uvTransform;\n#endif\nvoid main() {\n\t#ifdef USE_POINTS_UV\n\t\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\t#endif\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",shadow_vert:"#include <common>\n#include <batching_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <logdepthbuf_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\t#include <logdepthbuf_fragment>\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n}"},qi={common:{diffuse:{value:new kr(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new Ie},alphaMap:{value:null},alphaMapTransform:{value:new Ie},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new Ie}},envmap:{envMap:{value:null},envMapRotation:{value:new Ie},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new Ie}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new Ie}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new Ie},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new Ie},normalScale:{value:new je(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new Ie},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new Ie}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new Ie}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new Ie}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new kr(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new kr(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new Ie},alphaTest:{value:0},uvTransform:{value:new Ie}},sprite:{diffuse:{value:new kr(16777215)},opacity:{value:1},center:{value:new je(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new Ie},alphaMap:{value:null},alphaMapTransform:{value:new Ie},alphaTest:{value:0}}},Xi={basic:{uniforms:wi([qi.common,qi.specularmap,qi.envmap,qi.aomap,qi.lightmap,qi.fog]),vertexShader:Wi.meshbasic_vert,fragmentShader:Wi.meshbasic_frag},lambert:{uniforms:wi([qi.common,qi.specularmap,qi.envmap,qi.aomap,qi.lightmap,qi.emissivemap,qi.bumpmap,qi.normalmap,qi.displacementmap,qi.fog,qi.lights,{emissive:{value:new kr(0)}}]),vertexShader:Wi.meshlambert_vert,fragmentShader:Wi.meshlambert_frag},phong:{uniforms:wi([qi.common,qi.specularmap,qi.envmap,qi.aomap,qi.lightmap,qi.emissivemap,qi.bumpmap,qi.normalmap,qi.displacementmap,qi.fog,qi.lights,{emissive:{value:new kr(0)},specular:{value:new kr(1118481)},shininess:{value:30}}]),vertexShader:Wi.meshphong_vert,fragmentShader:Wi.meshphong_frag},standard:{uniforms:wi([qi.common,qi.envmap,qi.aomap,qi.lightmap,qi.emissivemap,qi.bumpmap,qi.normalmap,qi.displacementmap,qi.roughnessmap,qi.metalnessmap,qi.fog,qi.lights,{emissive:{value:new kr(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Wi.meshphysical_vert,fragmentShader:Wi.meshphysical_frag},toon:{uniforms:wi([qi.common,qi.aomap,qi.lightmap,qi.emissivemap,qi.bumpmap,qi.normalmap,qi.displacementmap,qi.gradientmap,qi.fog,qi.lights,{emissive:{value:new kr(0)}}]),vertexShader:Wi.meshtoon_vert,fragmentShader:Wi.meshtoon_frag},matcap:{uniforms:wi([qi.common,qi.bumpmap,qi.normalmap,qi.displacementmap,qi.fog,{matcap:{value:null}}]),vertexShader:Wi.meshmatcap_vert,fragmentShader:Wi.meshmatcap_frag},points:{uniforms:wi([qi.points,qi.fog]),vertexShader:Wi.points_vert,fragmentShader:Wi.points_frag},dashed:{uniforms:wi([qi.common,qi.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Wi.linedashed_vert,fragmentShader:Wi.linedashed_frag},depth:{uniforms:wi([qi.common,qi.displacementmap]),vertexShader:Wi.depth_vert,fragmentShader:Wi.depth_frag},normal:{uniforms:wi([qi.common,qi.bumpmap,qi.normalmap,qi.displacementmap,{opacity:{value:1}}]),vertexShader:Wi.meshnormal_vert,fragmentShader:Wi.meshnormal_frag},sprite:{uniforms:wi([qi.sprite,qi.fog]),vertexShader:Wi.sprite_vert,fragmentShader:Wi.sprite_frag},background:{uniforms:{uvTransform:{value:new Ie},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:Wi.background_vert,fragmentShader:Wi.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1},backgroundRotation:{value:new Ie}},vertexShader:Wi.backgroundCube_vert,fragmentShader:Wi.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:Wi.cube_vert,fragmentShader:Wi.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Wi.equirect_vert,fragmentShader:Wi.equirect_frag},distanceRGBA:{uniforms:wi([qi.common,qi.displacementmap,{referencePosition:{value:new hn},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Wi.distanceRGBA_vert,fragmentShader:Wi.distanceRGBA_frag},shadow:{uniforms:wi([qi.lights,qi.fog,{color:{value:new kr(0)},opacity:{value:1}}]),vertexShader:Wi.shadow_vert,fragmentShader:Wi.shadow_frag}};Xi.physical={uniforms:wi([Xi.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new Ie},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new Ie},clearcoatNormalScale:{value:new je(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new Ie},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new Ie},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new Ie},sheen:{value:0},sheenColor:{value:new kr(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new Ie},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new Ie},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new Ie},transmissionSamplerSize:{value:new je},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new Ie},attenuationDistance:{value:0},attenuationColor:{value:new kr(0)},specularColor:{value:new kr(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new Ie},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new Ie},anisotropyVector:{value:new je},anisotropyMap:{value:null},anisotropyMapTransform:{value:new Ie}}]),vertexShader:Wi.meshphysical_vert,fragmentShader:Wi.meshphysical_frag};const Yi={r:0,b:0,g:0},Ji=new Qn,Zi=new Vn;function Ki(t,e,n,r,i,o,a){const s=new kr(0);let u,c,l=!0===o?0:1,f=null,h=0,p=null;function d(e,n){e.getRGB(Yi,Si(t)),r.buffers.color.setClear(Yi.r,Yi.g,Yi.b,n,a)}return{getClearColor:function(){return s},setClearColor:function(t,e=1){s.set(t),l=e,d(s,l)},getClearAlpha:function(){return l},setClearAlpha:function(t){l=t,d(s,l)},render:function(o,m){let y=!1,v=!0===m.isScene?m.background:null;v&&v.isTexture&&(v=(m.backgroundBlurriness>0?n:e).get(v)),null===v?d(s,l):v&&v.isColor&&(d(v,1),y=!0);const g=t.xr.getEnvironmentBlendMode();"additive"===g?r.buffers.color.setClear(0,0,0,1,a):"alpha-blend"===g&&r.buffers.color.setClear(0,0,0,0,a),(t.autoClear||y)&&t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil),v&&(v.isCubeTexture||v.mapping===W)?(void 0===c&&(c=new gi(new _i(1,1,1),new Mi({name:"BackgroundCubeMaterial",uniforms:xi(Xi.backgroundCube.uniforms),vertexShader:Xi.backgroundCube.vertexShader,fragmentShader:Xi.backgroundCube.fragmentShader,side:1,depthTest:!1,depthWrite:!1,fog:!1})),c.geometry.deleteAttribute("normal"),c.geometry.deleteAttribute("uv"),c.onBeforeRender=function(t,e,n){this.matrixWorld.copyPosition(n.matrixWorld)},Object.defineProperty(c.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),i.update(c)),Ji.copy(m.backgroundRotation),Ji.x*=-1,Ji.y*=-1,Ji.z*=-1,v.isCubeTexture&&!1===v.isRenderTargetTexture&&(Ji.y*=-1,Ji.z*=-1),c.material.uniforms.envMap.value=v,c.material.uniforms.flipEnvMap.value=v.isCubeTexture&&!1===v.isRenderTargetTexture?-1:1,c.material.uniforms.backgroundBlurriness.value=m.backgroundBlurriness,c.material.uniforms.backgroundIntensity.value=m.backgroundIntensity,c.material.uniforms.backgroundRotation.value.setFromMatrix4(Zi.makeRotationFromEuler(Ji)),c.material.toneMapped=Je.getTransfer(v.colorSpace)!==se,f===v&&h===v.version&&p===t.toneMapping||(c.material.needsUpdate=!0,f=v,h=v.version,p=t.toneMapping),c.layers.enableAll(),o.unshift(c,c.geometry,c.material,0,0,null)):v&&v.isTexture&&(void 0===u&&(u=new gi(new Hi(2,2),new Mi({name:"BackgroundMaterial",uniforms:xi(Xi.background.uniforms),vertexShader:Xi.background.vertexShader,fragmentShader:Xi.background.fragmentShader,side:0,depthTest:!1,depthWrite:!1,fog:!1})),u.geometry.deleteAttribute("normal"),Object.defineProperty(u.material,"map",{get:function(){return this.uniforms.t2D.value}}),i.update(u)),u.material.uniforms.t2D.value=v,u.material.uniforms.backgroundIntensity.value=m.backgroundIntensity,u.material.toneMapped=Je.getTransfer(v.colorSpace)!==se,!0===v.matrixAutoUpdate&&v.updateMatrix(),u.material.uniforms.uvTransform.value.copy(v.matrix),f===v&&h===v.version&&p===t.toneMapping||(u.material.needsUpdate=!0,f=v,h=v.version,p=t.toneMapping),u.layers.enableAll(),o.unshift(u,u.geometry,u.material,0,0,null))}}}function Qi(t,e){const n=t.getParameter(t.MAX_VERTEX_ATTRIBS),r={},i=c(null);let o=i,a=!1;function s(e){return t.bindVertexArray(e)}function u(e){return t.deleteVertexArray(e)}function c(t){const e=[],r=[],i=[];for(let t=0;t<n;t++)e[t]=0,r[t]=0,i[t]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:e,enabledAttributes:r,attributeDivisors:i,object:t,attributes:{},index:null}}function l(){const t=o.newAttributes;for(let e=0,n=t.length;e<n;e++)t[e]=0}function f(t){h(t,0)}function h(e,n){const r=o.newAttributes,i=o.enabledAttributes,a=o.attributeDivisors;r[e]=1,0===i[e]&&(t.enableVertexAttribArray(e),i[e]=1),a[e]!==n&&(t.vertexAttribDivisor(e,n),a[e]=n)}function p(){const e=o.newAttributes,n=o.enabledAttributes;for(let r=0,i=n.length;r<i;r++)n[r]!==e[r]&&(t.disableVertexAttribArray(r),n[r]=0)}function d(e,n,r,i,o,a,s){!0===s?t.vertexAttribIPointer(e,n,r,o,a):t.vertexAttribPointer(e,n,r,i,o,a)}function m(){y(),a=!0,o!==i&&(o=i,s(o.object))}function y(){i.geometry=null,i.program=null,i.wireframe=!1}return{setup:function(n,i,u,m,y){let v=!1;const g=function(e,n,i){const o=!0===i.wireframe;let a=r[e.id];void 0===a&&(a={},r[e.id]=a);let s=a[n.id];void 0===s&&(s={},a[n.id]=s);let u=s[o];return void 0===u&&(u=c(t.createVertexArray()),s[o]=u),u}(m,u,i);o!==g&&(o=g,s(o.object)),v=function(t,e,n,r){const i=o.attributes,a=e.attributes;let s=0;const u=n.getAttributes();for(const e in u)if(u[e].location>=0){const n=i[e];let r=a[e];if(void 0===r&&("instanceMatrix"===e&&t.instanceMatrix&&(r=t.instanceMatrix),"instanceColor"===e&&t.instanceColor&&(r=t.instanceColor)),void 0===n)return!0;if(n.attribute!==r)return!0;if(r&&n.data!==r.data)return!0;s++}return o.attributesNum!==s||o.index!==r}(n,m,u,y),v&&function(t,e,n,r){const i={},a=e.attributes;let s=0;const u=n.getAttributes();for(const e in u)if(u[e].location>=0){let n=a[e];void 0===n&&("instanceMatrix"===e&&t.instanceMatrix&&(n=t.instanceMatrix),"instanceColor"===e&&t.instanceColor&&(n=t.instanceColor));const r={};r.attribute=n,n&&n.data&&(r.data=n.data),i[e]=r,s++}o.attributes=i,o.attributesNum=s,o.index=r}(n,m,u,y),null!==y&&e.update(y,t.ELEMENT_ARRAY_BUFFER),(v||a)&&(a=!1,function(n,r,i,o){l();const a=o.attributes,s=i.getAttributes(),u=r.defaultAttributeValues;for(const r in s){const i=s[r];if(i.location>=0){let s=a[r];if(void 0===s&&("instanceMatrix"===r&&n.instanceMatrix&&(s=n.instanceMatrix),"instanceColor"===r&&n.instanceColor&&(s=n.instanceColor)),void 0!==s){const r=s.normalized,a=s.itemSize,u=e.get(s);if(void 0===u)continue;const c=u.buffer,l=u.type,p=u.bytesPerElement,m=l===t.INT||l===t.UNSIGNED_INT||s.gpuType===rt;if(s.isInterleavedBufferAttribute){const e=s.data,u=e.stride,y=s.offset;if(e.isInstancedInterleavedBuffer){for(let t=0;t<i.locationSize;t++)h(i.location+t,e.meshPerAttribute);!0!==n.isInstancedMesh&&void 0===o._maxInstanceCount&&(o._maxInstanceCount=e.meshPerAttribute*e.count)}else for(let t=0;t<i.locationSize;t++)f(i.location+t);t.bindBuffer(t.ARRAY_BUFFER,c);for(let t=0;t<i.locationSize;t++)d(i.location+t,a/i.locationSize,l,r,u*p,(y+a/i.locationSize*t)*p,m)}else{if(s.isInstancedBufferAttribute){for(let t=0;t<i.locationSize;t++)h(i.location+t,s.meshPerAttribute);!0!==n.isInstancedMesh&&void 0===o._maxInstanceCount&&(o._maxInstanceCount=s.meshPerAttribute*s.count)}else for(let t=0;t<i.locationSize;t++)f(i.location+t);t.bindBuffer(t.ARRAY_BUFFER,c);for(let t=0;t<i.locationSize;t++)d(i.location+t,a/i.locationSize,l,r,a*p,a/i.locationSize*t*p,m)}}else if(void 0!==u){const e=u[r];if(void 0!==e)switch(e.length){case 2:t.vertexAttrib2fv(i.location,e);break;case 3:t.vertexAttrib3fv(i.location,e);break;case 4:t.vertexAttrib4fv(i.location,e);break;default:t.vertexAttrib1fv(i.location,e)}}}}p()}(n,i,u,m),null!==y&&t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,e.get(y).buffer))},reset:m,resetDefaultState:y,dispose:function(){m();for(const t in r){const e=r[t];for(const t in e){const n=e[t];for(const t in n)u(n[t].object),delete n[t];delete e[t]}delete r[t]}},releaseStatesOfGeometry:function(t){if(void 0===r[t.id])return;const e=r[t.id];for(const t in e){const n=e[t];for(const t in n)u(n[t].object),delete n[t];delete e[t]}delete r[t.id]},releaseStatesOfProgram:function(t){for(const e in r){const n=r[e];if(void 0===n[t.id])continue;const i=n[t.id];for(const t in i)u(i[t].object),delete i[t];delete n[t.id]}},initAttributes:l,enableAttribute:f,disableUnusedAttributes:p}}function $i(t,e,n){let r;this.setMode=function(t){r=t},this.render=function(e,i){t.drawArrays(r,e,i),n.update(i,r,1)},this.renderInstances=function(e,i,o){0!==o&&(t.drawArraysInstanced(r,e,i,o),n.update(i,r,o))},this.renderMultiDraw=function(t,i,o){if(0===o)return;const a=e.get("WEBGL_multi_draw");if(null===a)for(let e=0;e<o;e++)this.render(t[e],i[e]);else{a.multiDrawArraysWEBGL(r,t,0,i,0,o);let e=0;for(let t=0;t<o;t++)e+=i[t];n.update(e,r,1)}}}function to(t,e,n){let r;function i(e){if("highp"===e){if(t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.HIGH_FLOAT).precision>0&&t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.HIGH_FLOAT).precision>0)return"highp";e="mediump"}return"mediump"===e&&t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.MEDIUM_FLOAT).precision>0&&t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}let o=void 0!==n.precision?n.precision:"highp";const a=i(o);a!==o&&(console.warn("THREE.WebGLRenderer:",o,"not supported, using",a,"instead."),o=a);const s=!0===n.logarithmicDepthBuffer,u=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),c=t.getParameter(t.MAX_VERTEX_TEXTURE_IMAGE_UNITS);return{isWebGL2:!0,getMaxAnisotropy:function(){if(void 0!==r)return r;if(!0===e.has("EXT_texture_filter_anisotropic")){const n=e.get("EXT_texture_filter_anisotropic");r=t.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else r=0;return r},getMaxPrecision:i,precision:o,logarithmicDepthBuffer:s,maxTextures:u,maxVertexTextures:c,maxTextureSize:t.getParameter(t.MAX_TEXTURE_SIZE),maxCubemapSize:t.getParameter(t.MAX_CUBE_MAP_TEXTURE_SIZE),maxAttributes:t.getParameter(t.MAX_VERTEX_ATTRIBS),maxVertexUniforms:t.getParameter(t.MAX_VERTEX_UNIFORM_VECTORS),maxVaryings:t.getParameter(t.MAX_VARYING_VECTORS),maxFragmentUniforms:t.getParameter(t.MAX_FRAGMENT_UNIFORM_VECTORS),vertexTextures:c>0,maxSamples:t.getParameter(t.MAX_SAMPLES)}}function eo(t){const e=this;let n=null,r=0,i=!1,o=!1;const a=new Ui,s=new Ie,u={value:null,needsUpdate:!1};function c(t,n,r,i){const o=null!==t?t.length:0;let c=null;if(0!==o){if(c=u.value,!0!==i||null===c){const e=r+4*o,i=n.matrixWorldInverse;s.getNormalMatrix(i),(null===c||c.length<e)&&(c=new Float32Array(e));for(let e=0,n=r;e!==o;++e,n+=4)a.copy(t[e]).applyMatrix4(i,s),a.normal.toArray(c,n),c[n+3]=a.constant}u.value=c,u.needsUpdate=!0}return e.numPlanes=o,e.numIntersection=0,c}this.uniform=u,this.numPlanes=0,this.numIntersection=0,this.init=function(t,e){const n=0!==t.length||e||0!==r||i;return i=e,r=t.length,n},this.beginShadows=function(){o=!0,c(null)},this.endShadows=function(){o=!1},this.setGlobalState=function(t,e){n=c(t,e,0)},this.setState=function(a,s,l){const f=a.clippingPlanes,h=a.clipIntersection,p=a.clipShadows,d=t.get(a);if(!i||null===f||0===f.length||o&&!p)o?c(null):(u.value!==n&&(u.value=n,u.needsUpdate=r>0),e.numPlanes=r,e.numIntersection=0);else{const t=o?0:r,e=4*t;let i=d.clippingState||null;u.value=i,i=c(f,s,e,l);for(let t=0;t!==e;++t)i[t]=n[t];d.clippingState=i,this.numIntersection=h?this.numPlanes:0,this.numPlanes+=t}}}function no(t){let e=new WeakMap;function n(t,e){return e===G?t.mapping=z:e===H&&(t.mapping=V),t}function r(t){const n=t.target;n.removeEventListener("dispose",r);const i=e.get(n);void 0!==i&&(e.delete(n),i.dispose())}return{get:function(i){if(i&&i.isTexture){const o=i.mapping;if(o===G||o===H){if(e.has(i))return n(e.get(i).texture,i.mapping);{const o=i.image;if(o&&o.height>0){const a=new Li(o.height);return a.fromEquirectangularTexture(t,i),e.set(i,a),i.addEventListener("dispose",r),n(a.texture,i.mapping)}return null}}}return i},dispose:function(){e=new WeakMap}}}class ro extends Ei{constructor(t=-1,e=1,n=1,r=-1,i=.1,o=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=t,this.right=e,this.top=n,this.bottom=r,this.near=i,this.far=o,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.left=t.left,this.right=t.right,this.top=t.top,this.bottom=t.bottom,this.near=t.near,this.far=t.far,this.zoom=t.zoom,this.view=null===t.view?null:Object.assign({},t.view),this}setViewOffset(t,e,n,r,i,o){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=n,this.view.offsetY=r,this.view.width=i,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=(this.right-this.left)/(2*this.zoom),e=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,r=(this.top+this.bottom)/2;let i=n-t,o=n+t,a=r+e,s=r-e;if(null!==this.view&&this.view.enabled){const t=(this.right-this.left)/this.view.fullWidth/this.zoom,e=(this.top-this.bottom)/this.view.fullHeight/this.zoom;i+=t*this.view.offsetX,o=i+t*this.view.width,a-=e*this.view.offsetY,s=a-e*this.view.height}this.projectionMatrix.makeOrthographic(i,o,a,s,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const e=super.toJSON(t);return e.object.zoom=this.zoom,e.object.left=this.left,e.object.right=this.right,e.object.top=this.top,e.object.bottom=this.bottom,e.object.near=this.near,e.object.far=this.far,null!==this.view&&(e.object.view=Object.assign({},this.view)),e}}const io=[.125,.215,.35,.446,.526,.582],oo=new ro,ao=new kr;let so=null,uo=0,co=0,lo=!1;const fo=(1+Math.sqrt(5))/2,ho=1/fo,po=[new hn(1,1,1),new hn(-1,1,1),new hn(1,1,-1),new hn(-1,1,-1),new hn(0,fo,ho),new hn(0,fo,-ho),new hn(ho,0,fo),new hn(-ho,0,fo),new hn(fo,ho,0),new hn(-fo,ho,0)];class mo{constructor(t){this._renderer=t,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(t,e=0,n=.1,r=100){so=this._renderer.getRenderTarget(),uo=this._renderer.getActiveCubeFace(),co=this._renderer.getActiveMipmapLevel(),lo=this._renderer.xr.enabled,this._renderer.xr.enabled=!1,this._setSize(256);const i=this._allocateTargets();return i.depthBuffer=!0,this._sceneToCubeUV(t,n,r,i),e>0&&this._blur(i,0,0,e),this._applyPMREM(i),this._cleanup(i),i}fromEquirectangular(t,e=null){return this._fromTexture(t,e)}fromCubemap(t,e=null){return this._fromTexture(t,e)}compileCubemapShader(){null===this._cubemapMaterial&&(this._cubemapMaterial=bo(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){null===this._equirectMaterial&&(this._equirectMaterial=go(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),null!==this._cubemapMaterial&&this._cubemapMaterial.dispose(),null!==this._equirectMaterial&&this._equirectMaterial.dispose()}_setSize(t){this._lodMax=Math.floor(Math.log2(t)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){null!==this._blurMaterial&&this._blurMaterial.dispose(),null!==this._pingPongRenderTarget&&this._pingPongRenderTarget.dispose();for(let t=0;t<this._lodPlanes.length;t++)this._lodPlanes[t].dispose()}_cleanup(t){this._renderer.setRenderTarget(so,uo,co),this._renderer.xr.enabled=lo,t.scissorTest=!1,vo(t,0,0,t.width,t.height)}_fromTexture(t,e){t.mapping===z||t.mapping===V?this._setSize(0===t.image.length?16:t.image[0].width||t.image[0].image.width):this._setSize(t.image.width/4),so=this._renderer.getRenderTarget(),uo=this._renderer.getActiveCubeFace(),co=this._renderer.getActiveMipmapLevel(),lo=this._renderer.xr.enabled,this._renderer.xr.enabled=!1;const n=e||this._allocateTargets();return this._textureToCubeUV(t,n),this._applyPMREM(n),this._cleanup(n),n}_allocateTargets(){const t=3*Math.max(this._cubeSize,112),e=4*this._cubeSize,n={magFilter:Q,minFilter:Q,generateMipmaps:!1,type:at,format:lt,colorSpace:re,depthBuffer:!1},r=yo(t,e,n);if(null===this._pingPongRenderTarget||this._pingPongRenderTarget.width!==t||this._pingPongRenderTarget.height!==e){null!==this._pingPongRenderTarget&&this._dispose(),this._pingPongRenderTarget=yo(t,e,n);const{_lodMax:r}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=function(t){const e=[],n=[],r=[];let i=t;const o=t-4+1+io.length;for(let a=0;a<o;a++){const o=Math.pow(2,i);n.push(o);let s=1/o;a>t-4?s=io[a-t+4-1]:0===a&&(s=0),r.push(s);const u=1/(o-2),c=-u,l=1+u,f=[c,c,l,c,l,l,c,c,l,l,c,l],h=6,p=6,d=3,m=2,y=1,v=new Float32Array(d*p*h),g=new Float32Array(m*p*h),b=new Float32Array(y*p*h);for(let t=0;t<h;t++){const e=t%3*2/3-1,n=t>2?0:-1,r=[e,n,0,e+2/3,n,0,e+2/3,n+1,0,e,n,0,e+2/3,n+1,0,e,n+1,0];v.set(r,d*p*t),g.set(f,m*p*t);const i=[t,t,t,t,t,t];b.set(i,y*p*t)}const _=new ti;_.setAttribute("position",new Gr(v,d)),_.setAttribute("uv",new Gr(g,m)),_.setAttribute("faceIndex",new Gr(b,y)),e.push(_),i>4&&i--}return{lodPlanes:e,sizeLods:n,sigmas:r}}(r)),this._blurMaterial=function(t,e,n){const r=new Float32Array(20),i=new hn(0,1,0);return new Mi({name:"SphericalGaussianBlur",defines:{n:20,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/n,CUBEUV_MAX_MIP:`${t}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:r},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:i}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform int samples;\n\t\t\tuniform float weights[ n ];\n\t\t\tuniform bool latitudinal;\n\t\t\tuniform float dTheta;\n\t\t\tuniform float mipInt;\n\t\t\tuniform vec3 poleAxis;\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\tvec3 getSample( float theta, vec3 axis ) {\n\n\t\t\t\tfloat cosTheta = cos( theta );\n\t\t\t\t// Rodrigues' axis-angle rotation\n\t\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross( axis, vOutputDirection ) * sin( theta )\n\t\t\t\t\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n\n\t\t\t\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n\n\t\t\t\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n\t\t\t\t\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n\n\t\t\t\t}\n\n\t\t\t\taxis = normalize( axis );\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n\n\t\t\t\tfor ( int i = 1; i < n; i++ ) {\n\n\t\t\t\t\tif ( i >= samples ) {\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat theta = dTheta * float( i );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n\n\t\t\t\t}\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}(r,t,e)}return r}_compileMaterial(t){const e=new gi(this._lodPlanes[0],t);this._renderer.compile(e,oo)}_sceneToCubeUV(t,e,n,r){const i=new Ri(90,1,e,n),o=[1,-1,1,1,1,1],a=[1,1,1,-1,-1,-1],s=this._renderer,u=s.autoClear,c=s.toneMapping;s.getClearColor(ao),s.toneMapping=R,s.autoClear=!1;const l=new jr({name:"PMREM.Background",side:1,depthWrite:!1,depthTest:!1}),f=new gi(new _i,l);let h=!1;const p=t.background;p?p.isColor&&(l.color.copy(p),t.background=null,h=!0):(l.color.copy(ao),h=!0);for(let e=0;e<6;e++){const n=e%3;0===n?(i.up.set(0,o[e],0),i.lookAt(a[e],0,0)):1===n?(i.up.set(0,0,o[e]),i.lookAt(0,a[e],0)):(i.up.set(0,o[e],0),i.lookAt(0,0,a[e]));const u=this._cubeSize;vo(r,n*u,e>2?u:0,u,u),s.setRenderTarget(r),h&&s.render(f,i),s.render(t,i)}f.geometry.dispose(),f.material.dispose(),s.toneMapping=c,s.autoClear=u,t.background=p}_textureToCubeUV(t,e){const n=this._renderer,r=t.mapping===z||t.mapping===V;r?(null===this._cubemapMaterial&&(this._cubemapMaterial=bo()),this._cubemapMaterial.uniforms.flipEnvMap.value=!1===t.isRenderTargetTexture?-1:1):null===this._equirectMaterial&&(this._equirectMaterial=go());const i=r?this._cubemapMaterial:this._equirectMaterial,o=new gi(this._lodPlanes[0],i);i.uniforms.envMap.value=t;const a=this._cubeSize;vo(e,0,0,3*a,2*a),n.setRenderTarget(e),n.render(o,oo)}_applyPMREM(t){const e=this._renderer,n=e.autoClear;e.autoClear=!1;for(let e=1;e<this._lodPlanes.length;e++){const n=Math.sqrt(this._sigmas[e]*this._sigmas[e]-this._sigmas[e-1]*this._sigmas[e-1]),r=po[(e-1)%po.length];this._blur(t,e-1,e,n,r)}e.autoClear=n}_blur(t,e,n,r,i){const o=this._pingPongRenderTarget;this._halfBlur(t,o,e,n,r,"latitudinal",i),this._halfBlur(o,t,n,n,r,"longitudinal",i)}_halfBlur(t,e,n,r,i,o,a){const s=this._renderer,u=this._blurMaterial;"latitudinal"!==o&&"longitudinal"!==o&&console.error("blur direction must be either latitudinal or longitudinal!");const c=new gi(this._lodPlanes[r],u),l=u.uniforms,f=this._sizeLods[n]-1,h=isFinite(i)?Math.PI/(2*f):2*Math.PI/39,p=i/h,d=isFinite(i)?1+Math.floor(3*p):20;d>20&&console.warn(`sigmaRadians, ${i}, is too large and will clip, as it requested ${d} samples when the maximum is set to 20`);const m=[];let y=0;for(let t=0;t<20;++t){const e=t/p,n=Math.exp(-e*e/2);m.push(n),0===t?y+=n:t<d&&(y+=2*n)}for(let t=0;t<m.length;t++)m[t]=m[t]/y;l.envMap.value=t.texture,l.samples.value=d,l.weights.value=m,l.latitudinal.value="latitudinal"===o,a&&(l.poleAxis.value=a);const{_lodMax:v}=this;l.dTheta.value=h,l.mipInt.value=v-n;const g=this._sizeLods[r];vo(e,3*g*(r>v-4?r-v+4:0),4*(this._cubeSize-g),3*g,2*g),s.setRenderTarget(e),s.render(c,oo)}}function yo(t,e,n){const r=new un(t,e,n);return r.texture.mapping=W,r.texture.name="PMREM.cubeUv",r.scissorTest=!0,r}function vo(t,e,n,r,i){t.viewport.set(e,n,r,i),t.scissor.set(e,n,r,i)}function go(){return new Mi({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 outputDirection = normalize( vOutputDirection );\n\t\t\t\tvec2 uv = equirectUv( outputDirection );\n\n\t\t\t\tgl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}function bo(){return new Mi({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tuniform float flipEnvMap;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform samplerCube envMap;\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}function _o(t){let e=new WeakMap,n=null;function r(t){const n=t.target;n.removeEventListener("dispose",r);const i=e.get(n);void 0!==i&&(e.delete(n),i.dispose())}return{get:function(i){if(i&&i.isTexture){const o=i.mapping,a=o===G||o===H,s=o===z||o===V;if(a||s){let o=e.get(i);const u=void 0!==o?o.texture.pmremVersion:0;if(i.isRenderTargetTexture&&i.pmremVersion!==u)return null===n&&(n=new mo(t)),o=a?n.fromEquirectangular(i,o):n.fromCubemap(i,o),o.texture.pmremVersion=i.pmremVersion,e.set(i,o),o.texture;if(void 0!==o)return o.texture;{const u=i.image;return a&&u&&u.height>0||s&&u&&function(t){let e=0;for(let n=0;n<6;n++)void 0!==t[n]&&e++;return 6===e}(u)?(null===n&&(n=new mo(t)),o=a?n.fromEquirectangular(i):n.fromCubemap(i),o.texture.pmremVersion=i.pmremVersion,e.set(i,o),i.addEventListener("dispose",r),o.texture):null}}}return i},dispose:function(){e=new WeakMap,null!==n&&(n.dispose(),n=null)}}}function xo(t){const e={};function n(n){if(void 0!==e[n])return e[n];let r;switch(n){case"WEBGL_depth_texture":r=t.getExtension("WEBGL_depth_texture")||t.getExtension("MOZ_WEBGL_depth_texture")||t.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":r=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":r=t.getExtension("WEBGL_compressed_texture_s3tc")||t.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":r=t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:r=t.getExtension(n)}return e[n]=r,r}return{has:function(t){return null!==n(t)},init:function(){n("EXT_color_buffer_float"),n("WEBGL_clip_cull_distance"),n("OES_texture_float_linear"),n("EXT_color_buffer_half_float"),n("WEBGL_multisampled_render_to_texture"),n("WEBGL_render_shared_exponent")},get:function(t){const e=n(t);return null===e&&console.warn("THREE.WebGLRenderer: "+t+" extension not supported."),e}}}function wo(t,e,n,r){const i={},o=new WeakMap;function a(t){const s=t.target;null!==s.index&&e.remove(s.index);for(const t in s.attributes)e.remove(s.attributes[t]);for(const t in s.morphAttributes){const n=s.morphAttributes[t];for(let t=0,r=n.length;t<r;t++)e.remove(n[t])}s.removeEventListener("dispose",a),delete i[s.id];const u=o.get(s);u&&(e.remove(u),o.delete(s)),r.releaseStatesOfGeometry(s),!0===s.isInstancedBufferGeometry&&delete s._maxInstanceCount,n.memory.geometries--}function s(t){const n=[],r=t.index,i=t.attributes.position;let a=0;if(null!==r){const t=r.array;a=r.version;for(let e=0,r=t.length;e<r;e+=3){const r=t[e+0],i=t[e+1],o=t[e+2];n.push(r,i,i,o,o,r)}}else{if(void 0===i)return;{const t=i.array;a=i.version;for(let e=0,r=t.length/3-1;e<r;e+=3){const t=e+0,r=e+1,i=e+2;n.push(t,r,r,i,i,t)}}}const s=new(Ue(n)?Wr:Hr)(n,1);s.version=a;const u=o.get(t);u&&e.remove(u),o.set(t,s)}return{get:function(t,e){return!0===i[e.id]||(e.addEventListener("dispose",a),i[e.id]=!0,n.memory.geometries++),e},update:function(n){const r=n.attributes;for(const n in r)e.update(r[n],t.ARRAY_BUFFER);const i=n.morphAttributes;for(const n in i){const r=i[n];for(let n=0,i=r.length;n<i;n++)e.update(r[n],t.ARRAY_BUFFER)}},getWireframeAttribute:function(t){const e=o.get(t);if(e){const n=t.index;null!==n&&e.version<n.version&&s(t)}else s(t);return o.get(t)}}}function So(t,e,n){let r,i,o;this.setMode=function(t){r=t},this.setIndex=function(t){i=t.type,o=t.bytesPerElement},this.render=function(e,a){t.drawElements(r,a,i,e*o),n.update(a,r,1)},this.renderInstances=function(e,a,s){0!==s&&(t.drawElementsInstanced(r,a,i,e*o,s),n.update(a,r,s))},this.renderMultiDraw=function(t,a,s){if(0===s)return;const u=e.get("WEBGL_multi_draw");if(null===u)for(let e=0;e<s;e++)this.render(t[e]/o,a[e]);else{u.multiDrawElementsWEBGL(r,a,0,i,t,0,s);let e=0;for(let t=0;t<s;t++)e+=a[t];n.update(e,r,1)}}}function To(t){const e={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:e,programs:null,autoReset:!0,reset:function(){e.calls=0,e.triangles=0,e.points=0,e.lines=0},update:function(n,r,i){switch(e.calls++,r){case t.TRIANGLES:e.triangles+=i*(n/3);break;case t.LINES:e.lines+=i*(n/2);break;case t.LINE_STRIP:e.lines+=i*(n-1);break;case t.LINE_LOOP:e.lines+=i*n;break;case t.POINTS:e.points+=i*n;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",r)}}}}function Mo(t,e,n){const r=new WeakMap,i=new an;return{update:function(o,a,s){const u=o.morphTargetInfluences,c=a.morphAttributes.position||a.morphAttributes.normal||a.morphAttributes.color,l=void 0!==c?c.length:0;let f=r.get(a);if(void 0===f||f.count!==l){void 0!==f&&f.texture.dispose();const h=void 0!==a.morphAttributes.position,p=void 0!==a.morphAttributes.normal,d=void 0!==a.morphAttributes.color,m=a.morphAttributes.position||[],y=a.morphAttributes.normal||[],v=a.morphAttributes.color||[];let g=0;!0===h&&(g=1),!0===p&&(g=2),!0===d&&(g=3);let b=a.attributes.position.count*g,_=1;b>e.maxTextureSize&&(_=Math.ceil(b/e.maxTextureSize),b=e.maxTextureSize);const x=new Float32Array(b*_*4*l),w=new cn(x,b,_,l);w.type=ot,w.needsUpdate=!0;const S=4*g;for(let M=0;M<l;M++){const E=m[M],A=y[M],O=v[M],P=b*_*4*M;for(let R=0;R<E.count;R++){const k=R*S;!0===h&&(i.fromBufferAttribute(E,R),x[P+k+0]=i.x,x[P+k+1]=i.y,x[P+k+2]=i.z,x[P+k+3]=0),!0===p&&(i.fromBufferAttribute(A,R),x[P+k+4]=i.x,x[P+k+5]=i.y,x[P+k+6]=i.z,x[P+k+7]=0),!0===d&&(i.fromBufferAttribute(O,R),x[P+k+8]=i.x,x[P+k+9]=i.y,x[P+k+10]=i.z,x[P+k+11]=4===O.itemSize?i.w:1)}}function T(){w.dispose(),r.delete(a),a.removeEventListener("dispose",T)}f={count:l,texture:w,size:new je(b,_)},r.set(a,f),a.addEventListener("dispose",T)}if(!0===o.isInstancedMesh&&null!==o.morphTexture)s.getUniforms().setValue(t,"morphTexture",o.morphTexture,n);else{let C=0;for(let L=0;L<u.length;L++)C+=u[L];const N=a.morphTargetsRelative?1:1-C;s.getUniforms().setValue(t,"morphTargetBaseInfluence",N),s.getUniforms().setValue(t,"morphTargetInfluences",u)}s.getUniforms().setValue(t,"morphTargetsTexture",f.texture,n),s.getUniforms().setValue(t,"morphTargetsTextureSize",f.size)}}}function Eo(t,e,n,r){let i=new WeakMap;function o(t){const e=t.target;e.removeEventListener("dispose",o),n.remove(e.instanceMatrix),null!==e.instanceColor&&n.remove(e.instanceColor)}return{update:function(a){const s=r.render.frame,u=a.geometry,c=e.get(a,u);if(i.get(c)!==s&&(e.update(c),i.set(c,s)),a.isInstancedMesh&&(!1===a.hasEventListener("dispose",o)&&a.addEventListener("dispose",o),i.get(a)!==s&&(n.update(a.instanceMatrix,t.ARRAY_BUFFER),null!==a.instanceColor&&n.update(a.instanceColor,t.ARRAY_BUFFER),i.set(a,s))),a.isSkinnedMesh){const t=a.skeleton;i.get(t)!==s&&(t.update(),i.set(t,s))}return c},dispose:function(){i=new WeakMap}}}class Ao extends on{constructor(t,e,n,r,i,o,a,s,u,c){if((c=void 0!==c?c:ft)!==ft&&c!==ht)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===n&&c===ft&&(n=it),void 0===n&&c===ht&&(n=ct),super(null,r,i,o,a,s,c,n,u),this.isDepthTexture=!0,this.image={width:t,height:e},this.magFilter=void 0!==a?a:J,this.minFilter=void 0!==s?s:J,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(t){return super.copy(t),this.compareFunction=t.compareFunction,this}toJSON(t){const e=super.toJSON(t);return null!==this.compareFunction&&(e.compareFunction=this.compareFunction),e}}const Oo=new on,Po=new Ao(1,1);Po.compareFunction=515;const Ro=new cn,ko=new ln,Co=new Ni,No=[],Lo=[],jo=new Float32Array(16),Io=new Float32Array(9),Bo=new Float32Array(4);function Uo(t,e,n){const r=t[0];if(r<=0||r>0)return t;const i=e*n;let o=No[i];if(void 0===o&&(o=new Float32Array(i),No[i]=o),0!==e){r.toArray(o,0);for(let r=1,i=0;r!==e;++r)i+=n,t[r].toArray(o,i)}return o}function Do(t,e){if(t.length!==e.length)return!1;for(let n=0,r=t.length;n<r;n++)if(t[n]!==e[n])return!1;return!0}function Fo(t,e){for(let n=0,r=e.length;n<r;n++)t[n]=e[n]}function zo(t,e){let n=Lo[e];void 0===n&&(n=new Int32Array(e),Lo[e]=n);for(let r=0;r!==e;++r)n[r]=t.allocateTextureUnit();return n}function Vo(t,e){const n=this.cache;n[0]!==e&&(t.uniform1f(this.addr,e),n[0]=e)}function Go(t,e){const n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y||(t.uniform2f(this.addr,e.x,e.y),n[0]=e.x,n[1]=e.y);else{if(Do(n,e))return;t.uniform2fv(this.addr,e),Fo(n,e)}}function Ho(t,e){const n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y&&n[2]===e.z||(t.uniform3f(this.addr,e.x,e.y,e.z),n[0]=e.x,n[1]=e.y,n[2]=e.z);else if(void 0!==e.r)n[0]===e.r&&n[1]===e.g&&n[2]===e.b||(t.uniform3f(this.addr,e.r,e.g,e.b),n[0]=e.r,n[1]=e.g,n[2]=e.b);else{if(Do(n,e))return;t.uniform3fv(this.addr,e),Fo(n,e)}}function Wo(t,e){const n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y&&n[2]===e.z&&n[3]===e.w||(t.uniform4f(this.addr,e.x,e.y,e.z,e.w),n[0]=e.x,n[1]=e.y,n[2]=e.z,n[3]=e.w);else{if(Do(n,e))return;t.uniform4fv(this.addr,e),Fo(n,e)}}function qo(t,e){const n=this.cache,r=e.elements;if(void 0===r){if(Do(n,e))return;t.uniformMatrix2fv(this.addr,!1,e),Fo(n,e)}else{if(Do(n,r))return;Bo.set(r),t.uniformMatrix2fv(this.addr,!1,Bo),Fo(n,r)}}function Xo(t,e){const n=this.cache,r=e.elements;if(void 0===r){if(Do(n,e))return;t.uniformMatrix3fv(this.addr,!1,e),Fo(n,e)}else{if(Do(n,r))return;Io.set(r),t.uniformMatrix3fv(this.addr,!1,Io),Fo(n,r)}}function Yo(t,e){const n=this.cache,r=e.elements;if(void 0===r){if(Do(n,e))return;t.uniformMatrix4fv(this.addr,!1,e),Fo(n,e)}else{if(Do(n,r))return;jo.set(r),t.uniformMatrix4fv(this.addr,!1,jo),Fo(n,r)}}function Jo(t,e){const n=this.cache;n[0]!==e&&(t.uniform1i(this.addr,e),n[0]=e)}function Zo(t,e){const n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y||(t.uniform2i(this.addr,e.x,e.y),n[0]=e.x,n[1]=e.y);else{if(Do(n,e))return;t.uniform2iv(this.addr,e),Fo(n,e)}}function Ko(t,e){const n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y&&n[2]===e.z||(t.uniform3i(this.addr,e.x,e.y,e.z),n[0]=e.x,n[1]=e.y,n[2]=e.z);else{if(Do(n,e))return;t.uniform3iv(this.addr,e),Fo(n,e)}}function Qo(t,e){const n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y&&n[2]===e.z&&n[3]===e.w||(t.uniform4i(this.addr,e.x,e.y,e.z,e.w),n[0]=e.x,n[1]=e.y,n[2]=e.z,n[3]=e.w);else{if(Do(n,e))return;t.uniform4iv(this.addr,e),Fo(n,e)}}function $o(t,e){const n=this.cache;n[0]!==e&&(t.uniform1ui(this.addr,e),n[0]=e)}function ta(t,e){const n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y||(t.uniform2ui(this.addr,e.x,e.y),n[0]=e.x,n[1]=e.y);else{if(Do(n,e))return;t.uniform2uiv(this.addr,e),Fo(n,e)}}function ea(t,e){const n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y&&n[2]===e.z||(t.uniform3ui(this.addr,e.x,e.y,e.z),n[0]=e.x,n[1]=e.y,n[2]=e.z);else{if(Do(n,e))return;t.uniform3uiv(this.addr,e),Fo(n,e)}}function na(t,e){const n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y&&n[2]===e.z&&n[3]===e.w||(t.uniform4ui(this.addr,e.x,e.y,e.z,e.w),n[0]=e.x,n[1]=e.y,n[2]=e.z,n[3]=e.w);else{if(Do(n,e))return;t.uniform4uiv(this.addr,e),Fo(n,e)}}function ra(t,e,n){const r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(t.uniform1i(this.addr,i),r[0]=i);const o=this.type===t.SAMPLER_2D_SHADOW?Po:Oo;n.setTexture2D(e||o,i)}function ia(t,e,n){const r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(t.uniform1i(this.addr,i),r[0]=i),n.setTexture3D(e||ko,i)}function oa(t,e,n){const r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(t.uniform1i(this.addr,i),r[0]=i),n.setTextureCube(e||Co,i)}function aa(t,e,n){const r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(t.uniform1i(this.addr,i),r[0]=i),n.setTexture2DArray(e||Ro,i)}function sa(t,e){t.uniform1fv(this.addr,e)}function ua(t,e){const n=Uo(e,this.size,2);t.uniform2fv(this.addr,n)}function ca(t,e){const n=Uo(e,this.size,3);t.uniform3fv(this.addr,n)}function la(t,e){const n=Uo(e,this.size,4);t.uniform4fv(this.addr,n)}function fa(t,e){const n=Uo(e,this.size,4);t.uniformMatrix2fv(this.addr,!1,n)}function ha(t,e){const n=Uo(e,this.size,9);t.uniformMatrix3fv(this.addr,!1,n)}function pa(t,e){const n=Uo(e,this.size,16);t.uniformMatrix4fv(this.addr,!1,n)}function da(t,e){t.uniform1iv(this.addr,e)}function ma(t,e){t.uniform2iv(this.addr,e)}function ya(t,e){t.uniform3iv(this.addr,e)}function va(t,e){t.uniform4iv(this.addr,e)}function ga(t,e){t.uniform1uiv(this.addr,e)}function ba(t,e){t.uniform2uiv(this.addr,e)}function _a(t,e){t.uniform3uiv(this.addr,e)}function xa(t,e){t.uniform4uiv(this.addr,e)}function wa(t,e,n){const r=this.cache,i=e.length,o=zo(n,i);Do(r,o)||(t.uniform1iv(this.addr,o),Fo(r,o));for(let t=0;t!==i;++t)n.setTexture2D(e[t]||Oo,o[t])}function Sa(t,e,n){const r=this.cache,i=e.length,o=zo(n,i);Do(r,o)||(t.uniform1iv(this.addr,o),Fo(r,o));for(let t=0;t!==i;++t)n.setTexture3D(e[t]||ko,o[t])}function Ta(t,e,n){const r=this.cache,i=e.length,o=zo(n,i);Do(r,o)||(t.uniform1iv(this.addr,o),Fo(r,o));for(let t=0;t!==i;++t)n.setTextureCube(e[t]||Co,o[t])}function Ma(t,e,n){const r=this.cache,i=e.length,o=zo(n,i);Do(r,o)||(t.uniform1iv(this.addr,o),Fo(r,o));for(let t=0;t!==i;++t)n.setTexture2DArray(e[t]||Ro,o[t])}class Ea{constructor(t,e,n){this.id=t,this.addr=n,this.cache=[],this.type=e.type,this.setValue=function(t){switch(t){case 5126:return Vo;case 35664:return Go;case 35665:return Ho;case 35666:return Wo;case 35674:return qo;case 35675:return Xo;case 35676:return Yo;case 5124:case 35670:return Jo;case 35667:case 35671:return Zo;case 35668:case 35672:return Ko;case 35669:case 35673:return Qo;case 5125:return $o;case 36294:return ta;case 36295:return ea;case 36296:return na;case 35678:case 36198:case 36298:case 36306:case 35682:return ra;case 35679:case 36299:case 36307:return ia;case 35680:case 36300:case 36308:case 36293:return oa;case 36289:case 36303:case 36311:case 36292:return aa}}(e.type)}}class Aa{constructor(t,e,n){this.id=t,this.addr=n,this.cache=[],this.type=e.type,this.size=e.size,this.setValue=function(t){switch(t){case 5126:return sa;case 35664:return ua;case 35665:return ca;case 35666:return la;case 35674:return fa;case 35675:return ha;case 35676:return pa;case 5124:case 35670:return da;case 35667:case 35671:return ma;case 35668:case 35672:return ya;case 35669:case 35673:return va;case 5125:return ga;case 36294:return ba;case 36295:return _a;case 36296:return xa;case 35678:case 36198:case 36298:case 36306:case 35682:return wa;case 35679:case 36299:case 36307:return Sa;case 35680:case 36300:case 36308:case 36293:return Ta;case 36289:case 36303:case 36311:case 36292:return Ma}}(e.type)}}class Oa{constructor(t){this.id=t,this.seq=[],this.map={}}setValue(t,e,n){const r=this.seq;for(let i=0,o=r.length;i!==o;++i){const o=r[i];o.setValue(t,e[o.id],n)}}}const Pa=/(\w+)(\])?(\[|\.)?/g;function Ra(t,e){t.seq.push(e),t.map[e.id]=e}function ka(t,e,n){const r=t.name,i=r.length;for(Pa.lastIndex=0;;){const o=Pa.exec(r),a=Pa.lastIndex;let s=o[1];const u="]"===o[2],c=o[3];if(u&&(s|=0),void 0===c||"["===c&&a+2===i){Ra(n,void 0===c?new Ea(s,t,e):new Aa(s,t,e));break}{let t=n.map[s];void 0===t&&(t=new Oa(s),Ra(n,t)),n=t}}}class Ca{constructor(t,e){this.seq=[],this.map={};const n=t.getProgramParameter(e,t.ACTIVE_UNIFORMS);for(let r=0;r<n;++r){const n=t.getActiveUniform(e,r);ka(n,t.getUniformLocation(e,n.name),this)}}setValue(t,e,n,r){const i=this.map[e];void 0!==i&&i.setValue(t,n,r)}setOptional(t,e,n){const r=e[n];void 0!==r&&this.setValue(t,n,r)}static upload(t,e,n,r){for(let i=0,o=e.length;i!==o;++i){const o=e[i],a=n[o.id];!1!==a.needsUpdate&&o.setValue(t,a.value,r)}}static seqWithValue(t,e){const n=[];for(let r=0,i=t.length;r!==i;++r){const i=t[r];i.id in e&&n.push(i)}return n}}function Na(t,e,n){const r=t.createShader(e);return t.shaderSource(r,n),t.compileShader(r),r}const La=37297;let ja=0;function Ia(t,e,n){const r=t.getShaderParameter(e,t.COMPILE_STATUS),i=t.getShaderInfoLog(e).trim();if(r&&""===i)return"";const o=/ERROR: 0:(\d+)/.exec(i);if(o){const r=parseInt(o[1]);return n.toUpperCase()+"\n\n"+i+"\n\n"+function(t,e){const n=t.split("\n"),r=[],i=Math.max(e-6,0),o=Math.min(e+6,n.length);for(let t=i;t<o;t++){const i=t+1;r.push(`${i===e?">":" "} ${i}: ${n[t]}`)}return r.join("\n")}(t.getShaderSource(e),r)}return i}function Ba(t,e){const n=function(t){const e=Je.getPrimaries(Je.workingColorSpace),n=Je.getPrimaries(t);let r;switch(e===n?r="":e===ce&&n===ue?r="LinearDisplayP3ToLinearSRGB":e===ue&&n===ce&&(r="LinearSRGBToLinearDisplayP3"),t){case re:case oe:return[r,"LinearTransferOETF"];case ne:case ie:return[r,"sRGBTransferOETF"];default:return console.warn("THREE.WebGLProgram: Unsupported color space:",t),[r,"LinearTransferOETF"]}}(e);return`vec4 ${t}( vec4 value ) { return ${n[0]}( ${n[1]}( value ) ); }`}function Ua(t,e){let n;switch(e){case k:n="Linear";break;case C:n="Reinhard";break;case N:n="OptimizedCineon";break;case L:n="ACESFilmic";break;case I:n="AgX";break;case B:n="Neutral";break;case j:n="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),n="Linear"}return"vec3 "+t+"( vec3 color ) { return "+n+"ToneMapping( color ); }"}function Da(t){return""!==t}function Fa(t,e){const n=e.numSpotLightShadows+e.numSpotLightMaps-e.numSpotLightShadowsWithMaps;return t.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,e.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,n).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,e.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function za(t,e){return t.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const Va=/^[ \t]*#include +<([\w\d./]+)>/gm;function Ga(t){return t.replace(Va,Wa)}const Ha=new Map([["encodings_fragment","colorspace_fragment"],["encodings_pars_fragment","colorspace_pars_fragment"],["output_fragment","opaque_fragment"]]);function Wa(t,e){let n=Wi[e];if(void 0===n){const t=Ha.get(e);if(void 0===t)throw new Error("Can not resolve #include <"+e+">");n=Wi[t],console.warn('THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',e,t)}return Ga(n)}const qa=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function Xa(t){return t.replace(qa,Ya)}function Ya(t,e,n,r){let i="";for(let t=parseInt(e);t<parseInt(n);t++)i+=r.replace(/\[\s*i\s*\]/g,"[ "+t+" ]").replace(/UNROLLED_LOOP_INDEX/g,t);return i}function Ja(t){let e=`precision ${t.precision} float;\n\tprecision ${t.precision} int;\n\tprecision ${t.precision} sampler2D;\n\tprecision ${t.precision} samplerCube;\n\tprecision ${t.precision} sampler3D;\n\tprecision ${t.precision} sampler2DArray;\n\tprecision ${t.precision} sampler2DShadow;\n\tprecision ${t.precision} samplerCubeShadow;\n\tprecision ${t.precision} sampler2DArrayShadow;\n\tprecision ${t.precision} isampler2D;\n\tprecision ${t.precision} isampler3D;\n\tprecision ${t.precision} isamplerCube;\n\tprecision ${t.precision} isampler2DArray;\n\tprecision ${t.precision} usampler2D;\n\tprecision ${t.precision} usampler3D;\n\tprecision ${t.precision} usamplerCube;\n\tprecision ${t.precision} usampler2DArray;\n\t`;return"highp"===t.precision?e+="\n#define HIGH_PRECISION":"mediump"===t.precision?e+="\n#define MEDIUM_PRECISION":"lowp"===t.precision&&(e+="\n#define LOW_PRECISION"),e}function Za(t,e,n,a){const s=t.getContext(),u=n.defines;let c=n.vertexShader,l=n.fragmentShader;const f=function(t){let e="SHADOWMAP_TYPE_BASIC";return t.shadowMapType===r?e="SHADOWMAP_TYPE_PCF":t.shadowMapType===i?e="SHADOWMAP_TYPE_PCF_SOFT":t.shadowMapType===o&&(e="SHADOWMAP_TYPE_VSM"),e}(n),h=function(t){let e="ENVMAP_TYPE_CUBE";if(t.envMap)switch(t.envMapMode){case z:case V:e="ENVMAP_TYPE_CUBE";break;case W:e="ENVMAP_TYPE_CUBE_UV"}return e}(n),p=function(t){let e="ENVMAP_MODE_REFLECTION";return t.envMap&&t.envMapMode===V&&(e="ENVMAP_MODE_REFRACTION"),e}(n),d=function(t){let e="ENVMAP_BLENDING_NONE";if(t.envMap)switch(t.combine){case A:e="ENVMAP_BLENDING_MULTIPLY";break;case O:e="ENVMAP_BLENDING_MIX";break;case P:e="ENVMAP_BLENDING_ADD"}return e}(n),m=function(t){const e=t.envMapCubeUVHeight;if(null===e)return null;const n=Math.log2(e)-2,r=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,n),112)),texelHeight:r,maxMip:n}}(n),y=function(t){return[t.extensionClipCullDistance?"#extension GL_ANGLE_clip_cull_distance : require":"",t.extensionMultiDraw?"#extension GL_ANGLE_multi_draw : require":""].filter(Da).join("\n")}(n),v=function(t){const e=[];for(const n in t){const r=t[n];!1!==r&&e.push("#define "+n+" "+r)}return e.join("\n")}(u),g=s.createProgram();let b,_,x=n.glslVersion?"#version "+n.glslVersion+"\n":"";n.isRawShaderMaterial?(b=["#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,v].filter(Da).join("\n"),b.length>0&&(b+="\n"),_=["#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,v].filter(Da).join("\n"),_.length>0&&(_+="\n")):(b=[Ja(n),"#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,v,n.extensionClipCullDistance?"#define USE_CLIP_DISTANCE":"",n.batching?"#define USE_BATCHING":"",n.instancing?"#define USE_INSTANCING":"",n.instancingColor?"#define USE_INSTANCING_COLOR":"",n.instancingMorph?"#define USE_INSTANCING_MORPH":"",n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+p:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",n.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",n.displacementMap?"#define USE_DISPLACEMENTMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.anisotropy?"#define USE_ANISOTROPY":"",n.anisotropyMap?"#define USE_ANISOTROPYMAP":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",n.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",n.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.alphaHash?"#define USE_ALPHAHASH":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",n.mapUv?"#define MAP_UV "+n.mapUv:"",n.alphaMapUv?"#define ALPHAMAP_UV "+n.alphaMapUv:"",n.lightMapUv?"#define LIGHTMAP_UV "+n.lightMapUv:"",n.aoMapUv?"#define AOMAP_UV "+n.aoMapUv:"",n.emissiveMapUv?"#define EMISSIVEMAP_UV "+n.emissiveMapUv:"",n.bumpMapUv?"#define BUMPMAP_UV "+n.bumpMapUv:"",n.normalMapUv?"#define NORMALMAP_UV "+n.normalMapUv:"",n.displacementMapUv?"#define DISPLACEMENTMAP_UV "+n.displacementMapUv:"",n.metalnessMapUv?"#define METALNESSMAP_UV "+n.metalnessMapUv:"",n.roughnessMapUv?"#define ROUGHNESSMAP_UV "+n.roughnessMapUv:"",n.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+n.anisotropyMapUv:"",n.clearcoatMapUv?"#define CLEARCOATMAP_UV "+n.clearcoatMapUv:"",n.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+n.clearcoatNormalMapUv:"",n.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+n.clearcoatRoughnessMapUv:"",n.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+n.iridescenceMapUv:"",n.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+n.iridescenceThicknessMapUv:"",n.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+n.sheenColorMapUv:"",n.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+n.sheenRoughnessMapUv:"",n.specularMapUv?"#define SPECULARMAP_UV "+n.specularMapUv:"",n.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+n.specularColorMapUv:"",n.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+n.specularIntensityMapUv:"",n.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+n.transmissionMapUv:"",n.thicknessMapUv?"#define THICKNESSMAP_UV "+n.thicknessMapUv:"",n.vertexTangents&&!1===n.flatShading?"#define USE_TANGENT":"",n.vertexColors?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUv1s?"#define USE_UV1":"",n.vertexUv2s?"#define USE_UV2":"",n.vertexUv3s?"#define USE_UV3":"",n.pointsUvs?"#define USE_POINTS_UV":"",n.flatShading?"#define FLAT_SHADED":"",n.skinning?"#define USE_SKINNING":"",n.morphTargets?"#define USE_MORPHTARGETS":"",n.morphNormals&&!1===n.flatShading?"#define USE_MORPHNORMALS":"",n.morphColors?"#define USE_MORPHCOLORS":"",n.morphTargetsCount>0?"#define MORPHTARGETS_TEXTURE":"",n.morphTargetsCount>0?"#define MORPHTARGETS_TEXTURE_STRIDE "+n.morphTextureStride:"",n.morphTargetsCount>0?"#define MORPHTARGETS_COUNT "+n.morphTargetsCount:"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+f:"",n.sizeAttenuation?"#define USE_SIZEATTENUATION":"",n.numLightProbes>0?"#define USE_LIGHT_PROBES":"",n.useLegacyLights?"#define LEGACY_LIGHTS":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","#ifdef USE_INSTANCING_MORPH","\tuniform sampler2D morphTexture;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","\tattribute vec2 uv1;","#endif","#ifdef USE_UV2","\tattribute vec2 uv2;","#endif","#ifdef USE_UV3","\tattribute vec2 uv3;","#endif","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","\tattribute vec4 color;","#elif defined( USE_COLOR )","\tattribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(Da).join("\n"),_=[Ja(n),"#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,v,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.alphaToCoverage?"#define ALPHA_TO_COVERAGE":"",n.map?"#define USE_MAP":"",n.matcap?"#define USE_MATCAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+h:"",n.envMap?"#define "+p:"",n.envMap?"#define "+d:"",m?"#define CUBEUV_TEXEL_WIDTH "+m.texelWidth:"",m?"#define CUBEUV_TEXEL_HEIGHT "+m.texelHeight:"",m?"#define CUBEUV_MAX_MIP "+m.maxMip+".0":"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",n.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.anisotropy?"#define USE_ANISOTROPY":"",n.anisotropyMap?"#define USE_ANISOTROPYMAP":"",n.clearcoat?"#define USE_CLEARCOAT":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.iridescence?"#define USE_IRIDESCENCE":"",n.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",n.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",n.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.alphaTest?"#define USE_ALPHATEST":"",n.alphaHash?"#define USE_ALPHAHASH":"",n.sheen?"#define USE_SHEEN":"",n.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.vertexTangents&&!1===n.flatShading?"#define USE_TANGENT":"",n.vertexColors||n.instancingColor?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUv1s?"#define USE_UV1":"",n.vertexUv2s?"#define USE_UV2":"",n.vertexUv3s?"#define USE_UV3":"",n.pointsUvs?"#define USE_POINTS_UV":"",n.gradientMap?"#define USE_GRADIENTMAP":"",n.flatShading?"#define FLAT_SHADED":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+f:"",n.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",n.numLightProbes>0?"#define USE_LIGHT_PROBES":"",n.useLegacyLights?"#define LEGACY_LIGHTS":"",n.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",n.toneMapping!==R?"#define TONE_MAPPING":"",n.toneMapping!==R?Wi.tonemapping_pars_fragment:"",n.toneMapping!==R?Ua("toneMapping",n.toneMapping):"",n.dithering?"#define DITHERING":"",n.opaque?"#define OPAQUE":"",Wi.colorspace_pars_fragment,Ba("linearToOutputTexel",n.outputColorSpace),n.useDepthPacking?"#define DEPTH_PACKING "+n.depthPacking:"","\n"].filter(Da).join("\n")),c=Ga(c),c=Fa(c,n),c=za(c,n),l=Ga(l),l=Fa(l,n),l=za(l,n),c=Xa(c),l=Xa(l),!0!==n.isRawShaderMaterial&&(x="#version 300 es\n",b=[y,"#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+b,_=["#define varying in",n.glslVersion===_e?"":"layout(location = 0) out highp vec4 pc_fragColor;",n.glslVersion===_e?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+_);const w=x+b+c,S=x+_+l,T=Na(s,s.VERTEX_SHADER,w),M=Na(s,s.FRAGMENT_SHADER,S);function E(e){if(t.debug.checkShaderErrors){const n=s.getProgramInfoLog(g).trim(),r=s.getShaderInfoLog(T).trim(),i=s.getShaderInfoLog(M).trim();let o=!0,a=!0;if(!1===s.getProgramParameter(g,s.LINK_STATUS))if(o=!1,"function"==typeof t.debug.onShaderError)t.debug.onShaderError(s,g,T,M);else{const t=Ia(s,T,"vertex"),r=Ia(s,M,"fragment");console.error("THREE.WebGLProgram: Shader Error "+s.getError()+" - VALIDATE_STATUS "+s.getProgramParameter(g,s.VALIDATE_STATUS)+"\n\nMaterial Name: "+e.name+"\nMaterial Type: "+e.type+"\n\nProgram Info Log: "+n+"\n"+t+"\n"+r)}else""!==n?console.warn("THREE.WebGLProgram: Program Info Log:",n):""!==r&&""!==i||(a=!1);a&&(e.diagnostics={runnable:o,programLog:n,vertexShader:{log:r,prefix:b},fragmentShader:{log:i,prefix:_}})}s.deleteShader(T),s.deleteShader(M),k=new Ca(s,g),C=function(t,e){const n={},r=t.getProgramParameter(e,t.ACTIVE_ATTRIBUTES);for(let i=0;i<r;i++){const r=t.getActiveAttrib(e,i),o=r.name;let a=1;r.type===t.FLOAT_MAT2&&(a=2),r.type===t.FLOAT_MAT3&&(a=3),r.type===t.FLOAT_MAT4&&(a=4),n[o]={type:r.type,location:t.getAttribLocation(e,o),locationSize:a}}return n}(s,g)}let k,C;s.attachShader(g,T),s.attachShader(g,M),void 0!==n.index0AttributeName?s.bindAttribLocation(g,0,n.index0AttributeName):!0===n.morphTargets&&s.bindAttribLocation(g,0,"position"),s.linkProgram(g),this.getUniforms=function(){return void 0===k&&E(this),k},this.getAttributes=function(){return void 0===C&&E(this),C};let N=!1===n.rendererExtensionParallelShaderCompile;return this.isReady=function(){return!1===N&&(N=s.getProgramParameter(g,La)),N},this.destroy=function(){a.releaseStatesOfProgram(this),s.deleteProgram(g),this.program=void 0},this.type=n.shaderType,this.name=n.shaderName,this.id=ja++,this.cacheKey=e,this.usedTimes=1,this.program=g,this.vertexShader=T,this.fragmentShader=M,this}let Ka=0;class Qa{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(t){const e=t.vertexShader,n=t.fragmentShader,r=this._getShaderStage(e),i=this._getShaderStage(n),o=this._getShaderCacheForMaterial(t);return!1===o.has(r)&&(o.add(r),r.usedTimes++),!1===o.has(i)&&(o.add(i),i.usedTimes++),this}remove(t){const e=this.materialCache.get(t);for(const t of e)t.usedTimes--,0===t.usedTimes&&this.shaderCache.delete(t.code);return this.materialCache.delete(t),this}getVertexShaderID(t){return this._getShaderStage(t.vertexShader).id}getFragmentShaderID(t){return this._getShaderStage(t.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(t){const e=this.materialCache;let n=e.get(t);return void 0===n&&(n=new Set,e.set(t,n)),n}_getShaderStage(t){const e=this.shaderCache;let n=e.get(t);return void 0===n&&(n=new $a(t),e.set(t,n)),n}}class $a{constructor(t){this.id=Ka++,this.code=t,this.usedTimes=0}}function ts(t,e,n,r,i,o,a){const s=new $n,u=new Qa,c=new Set,l=[],f=i.logarithmicDepthBuffer,h=i.vertexTextures;let p=i.precision;const d={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function m(t){return c.add(t),0===t?"uv":`uv${t}`}return{getParameters:function(o,s,l,y,v){const g=y.fog,b=v.geometry,_=o.isMeshStandardMaterial?y.environment:null,x=(o.isMeshStandardMaterial?n:e).get(o.envMap||_),w=x&&x.mapping===W?x.image.height:null,S=d[o.type];null!==o.precision&&(p=i.getMaxPrecision(o.precision),p!==o.precision&&console.warn("THREE.WebGLProgram.getParameters:",o.precision,"not supported, using",p,"instead."));const T=b.morphAttributes.position||b.morphAttributes.normal||b.morphAttributes.color,M=void 0!==T?T.length:0;let E,A,O,P,k=0;if(void 0!==b.morphAttributes.position&&(k=1),void 0!==b.morphAttributes.normal&&(k=2),void 0!==b.morphAttributes.color&&(k=3),S){const t=Xi[S];E=t.vertexShader,A=t.fragmentShader}else E=o.vertexShader,A=o.fragmentShader,u.update(o),O=u.getVertexShaderID(o),P=u.getFragmentShaderID(o);const C=t.getRenderTarget(),N=!0===v.isInstancedMesh,L=!0===v.isBatchedMesh,j=!!o.map,I=!!o.matcap,B=!!x,U=!!o.aoMap,D=!!o.lightMap,F=!!o.bumpMap,z=!!o.normalMap,V=!!o.displacementMap,G=!!o.emissiveMap,H=!!o.metalnessMap,q=!!o.roughnessMap,X=o.anisotropy>0,Y=o.clearcoat>0,J=o.iridescence>0,Z=o.sheen>0,K=o.transmission>0,Q=X&&!!o.anisotropyMap,$=Y&&!!o.clearcoatMap,tt=Y&&!!o.clearcoatNormalMap,et=Y&&!!o.clearcoatRoughnessMap,nt=J&&!!o.iridescenceMap,rt=J&&!!o.iridescenceThicknessMap,it=Z&&!!o.sheenColorMap,ot=Z&&!!o.sheenRoughnessMap,at=!!o.specularMap,st=!!o.specularColorMap,ut=!!o.specularIntensityMap,ct=K&&!!o.transmissionMap,lt=K&&!!o.thicknessMap,ft=!!o.gradientMap,ht=!!o.alphaMap,pt=o.alphaTest>0,dt=!!o.alphaHash,mt=!!o.extensions;let yt=R;o.toneMapped&&(null!==C&&!0!==C.isXRRenderTarget||(yt=t.toneMapping));const vt={shaderID:S,shaderType:o.type,shaderName:o.name,vertexShader:E,fragmentShader:A,defines:o.defines,customVertexShaderID:O,customFragmentShaderID:P,isRawShaderMaterial:!0===o.isRawShaderMaterial,glslVersion:o.glslVersion,precision:p,batching:L,instancing:N,instancingColor:N&&null!==v.instanceColor,instancingMorph:N&&null!==v.morphTexture,supportsVertexTextures:h,outputColorSpace:null===C?t.outputColorSpace:!0===C.isXRRenderTarget?C.texture.colorSpace:re,alphaToCoverage:!!o.alphaToCoverage,map:j,matcap:I,envMap:B,envMapMode:B&&x.mapping,envMapCubeUVHeight:w,aoMap:U,lightMap:D,bumpMap:F,normalMap:z,displacementMap:h&&V,emissiveMap:G,normalMapObjectSpace:z&&1===o.normalMapType,normalMapTangentSpace:z&&0===o.normalMapType,metalnessMap:H,roughnessMap:q,anisotropy:X,anisotropyMap:Q,clearcoat:Y,clearcoatMap:$,clearcoatNormalMap:tt,clearcoatRoughnessMap:et,iridescence:J,iridescenceMap:nt,iridescenceThicknessMap:rt,sheen:Z,sheenColorMap:it,sheenRoughnessMap:ot,specularMap:at,specularColorMap:st,specularIntensityMap:ut,transmission:K,transmissionMap:ct,thicknessMap:lt,gradientMap:ft,opaque:!1===o.transparent&&1===o.blending&&!1===o.alphaToCoverage,alphaMap:ht,alphaTest:pt,alphaHash:dt,combine:o.combine,mapUv:j&&m(o.map.channel),aoMapUv:U&&m(o.aoMap.channel),lightMapUv:D&&m(o.lightMap.channel),bumpMapUv:F&&m(o.bumpMap.channel),normalMapUv:z&&m(o.normalMap.channel),displacementMapUv:V&&m(o.displacementMap.channel),emissiveMapUv:G&&m(o.emissiveMap.channel),metalnessMapUv:H&&m(o.metalnessMap.channel),roughnessMapUv:q&&m(o.roughnessMap.channel),anisotropyMapUv:Q&&m(o.anisotropyMap.channel),clearcoatMapUv:$&&m(o.clearcoatMap.channel),clearcoatNormalMapUv:tt&&m(o.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:et&&m(o.clearcoatRoughnessMap.channel),iridescenceMapUv:nt&&m(o.iridescenceMap.channel),iridescenceThicknessMapUv:rt&&m(o.iridescenceThicknessMap.channel),sheenColorMapUv:it&&m(o.sheenColorMap.channel),sheenRoughnessMapUv:ot&&m(o.sheenRoughnessMap.channel),specularMapUv:at&&m(o.specularMap.channel),specularColorMapUv:st&&m(o.specularColorMap.channel),specularIntensityMapUv:ut&&m(o.specularIntensityMap.channel),transmissionMapUv:ct&&m(o.transmissionMap.channel),thicknessMapUv:lt&&m(o.thicknessMap.channel),alphaMapUv:ht&&m(o.alphaMap.channel),vertexTangents:!!b.attributes.tangent&&(z||X),vertexColors:o.vertexColors,vertexAlphas:!0===o.vertexColors&&!!b.attributes.color&&4===b.attributes.color.itemSize,pointsUvs:!0===v.isPoints&&!!b.attributes.uv&&(j||ht),fog:!!g,useFog:!0===o.fog,fogExp2:!!g&&g.isFogExp2,flatShading:!0===o.flatShading,sizeAttenuation:!0===o.sizeAttenuation,logarithmicDepthBuffer:f,skinning:!0===v.isSkinnedMesh,morphTargets:void 0!==b.morphAttributes.position,morphNormals:void 0!==b.morphAttributes.normal,morphColors:void 0!==b.morphAttributes.color,morphTargetsCount:M,morphTextureStride:k,numDirLights:s.directional.length,numPointLights:s.point.length,numSpotLights:s.spot.length,numSpotLightMaps:s.spotLightMap.length,numRectAreaLights:s.rectArea.length,numHemiLights:s.hemi.length,numDirLightShadows:s.directionalShadowMap.length,numPointLightShadows:s.pointShadowMap.length,numSpotLightShadows:s.spotShadowMap.length,numSpotLightShadowsWithMaps:s.numSpotLightShadowsWithMaps,numLightProbes:s.numLightProbes,numClippingPlanes:a.numPlanes,numClipIntersection:a.numIntersection,dithering:o.dithering,shadowMapEnabled:t.shadowMap.enabled&&l.length>0,shadowMapType:t.shadowMap.type,toneMapping:yt,useLegacyLights:t._useLegacyLights,decodeVideoTexture:j&&!0===o.map.isVideoTexture&&Je.getTransfer(o.map.colorSpace)===se,premultipliedAlpha:o.premultipliedAlpha,doubleSided:2===o.side,flipSided:1===o.side,useDepthPacking:o.depthPacking>=0,depthPacking:o.depthPacking||0,index0AttributeName:o.index0AttributeName,extensionClipCullDistance:mt&&!0===o.extensions.clipCullDistance&&r.has("WEBGL_clip_cull_distance"),extensionMultiDraw:mt&&!0===o.extensions.multiDraw&&r.has("WEBGL_multi_draw"),rendererExtensionParallelShaderCompile:r.has("KHR_parallel_shader_compile"),customProgramCacheKey:o.customProgramCacheKey()};return vt.vertexUv1s=c.has(1),vt.vertexUv2s=c.has(2),vt.vertexUv3s=c.has(3),c.clear(),vt},getProgramCacheKey:function(e){const n=[];if(e.shaderID?n.push(e.shaderID):(n.push(e.customVertexShaderID),n.push(e.customFragmentShaderID)),void 0!==e.defines)for(const t in e.defines)n.push(t),n.push(e.defines[t]);return!1===e.isRawShaderMaterial&&(function(t,e){t.push(e.precision),t.push(e.outputColorSpace),t.push(e.envMapMode),t.push(e.envMapCubeUVHeight),t.push(e.mapUv),t.push(e.alphaMapUv),t.push(e.lightMapUv),t.push(e.aoMapUv),t.push(e.bumpMapUv),t.push(e.normalMapUv),t.push(e.displacementMapUv),t.push(e.emissiveMapUv),t.push(e.metalnessMapUv),t.push(e.roughnessMapUv),t.push(e.anisotropyMapUv),t.push(e.clearcoatMapUv),t.push(e.clearcoatNormalMapUv),t.push(e.clearcoatRoughnessMapUv),t.push(e.iridescenceMapUv),t.push(e.iridescenceThicknessMapUv),t.push(e.sheenColorMapUv),t.push(e.sheenRoughnessMapUv),t.push(e.specularMapUv),t.push(e.specularColorMapUv),t.push(e.specularIntensityMapUv),t.push(e.transmissionMapUv),t.push(e.thicknessMapUv),t.push(e.combine),t.push(e.fogExp2),t.push(e.sizeAttenuation),t.push(e.morphTargetsCount),t.push(e.morphAttributeCount),t.push(e.numDirLights),t.push(e.numPointLights),t.push(e.numSpotLights),t.push(e.numSpotLightMaps),t.push(e.numHemiLights),t.push(e.numRectAreaLights),t.push(e.numDirLightShadows),t.push(e.numPointLightShadows),t.push(e.numSpotLightShadows),t.push(e.numSpotLightShadowsWithMaps),t.push(e.numLightProbes),t.push(e.shadowMapType),t.push(e.toneMapping),t.push(e.numClippingPlanes),t.push(e.numClipIntersection),t.push(e.depthPacking)}(n,e),function(t,e){s.disableAll(),e.supportsVertexTextures&&s.enable(0),e.instancing&&s.enable(1),e.instancingColor&&s.enable(2),e.instancingMorph&&s.enable(3),e.matcap&&s.enable(4),e.envMap&&s.enable(5),e.normalMapObjectSpace&&s.enable(6),e.normalMapTangentSpace&&s.enable(7),e.clearcoat&&s.enable(8),e.iridescence&&s.enable(9),e.alphaTest&&s.enable(10),e.vertexColors&&s.enable(11),e.vertexAlphas&&s.enable(12),e.vertexUv1s&&s.enable(13),e.vertexUv2s&&s.enable(14),e.vertexUv3s&&s.enable(15),e.vertexTangents&&s.enable(16),e.anisotropy&&s.enable(17),e.alphaHash&&s.enable(18),e.batching&&s.enable(19),t.push(s.mask),s.disableAll(),e.fog&&s.enable(0),e.useFog&&s.enable(1),e.flatShading&&s.enable(2),e.logarithmicDepthBuffer&&s.enable(3),e.skinning&&s.enable(4),e.morphTargets&&s.enable(5),e.morphNormals&&s.enable(6),e.morphColors&&s.enable(7),e.premultipliedAlpha&&s.enable(8),e.shadowMapEnabled&&s.enable(9),e.useLegacyLights&&s.enable(10),e.doubleSided&&s.enable(11),e.flipSided&&s.enable(12),e.useDepthPacking&&s.enable(13),e.dithering&&s.enable(14),e.transmission&&s.enable(15),e.sheen&&s.enable(16),e.opaque&&s.enable(17),e.pointsUvs&&s.enable(18),e.decodeVideoTexture&&s.enable(19),e.alphaToCoverage&&s.enable(20),t.push(s.mask)}(n,e),n.push(t.outputColorSpace)),n.push(e.customProgramCacheKey),n.join()},getUniforms:function(t){const e=d[t.type];let n;if(e){const t=Xi[e];n=Ti.clone(t.uniforms)}else n=t.uniforms;return n},acquireProgram:function(e,n){let r;for(let t=0,e=l.length;t<e;t++){const e=l[t];if(e.cacheKey===n){r=e,++r.usedTimes;break}}return void 0===r&&(r=new Za(t,n,e,o),l.push(r)),r},releaseProgram:function(t){if(0==--t.usedTimes){const e=l.indexOf(t);l[e]=l[l.length-1],l.pop(),t.destroy()}},releaseShaderCache:function(t){u.remove(t)},programs:l,dispose:function(){u.dispose()}}}function es(){let t=new WeakMap;return{get:function(e){let n=t.get(e);return void 0===n&&(n={},t.set(e,n)),n},remove:function(e){t.delete(e)},update:function(e,n,r){t.get(e)[n]=r},dispose:function(){t=new WeakMap}}}function ns(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.material.id!==e.material.id?t.material.id-e.material.id:t.z!==e.z?t.z-e.z:t.id-e.id}function rs(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.z!==e.z?e.z-t.z:t.id-e.id}function is(){const t=[];let e=0;const n=[],r=[],i=[];function o(n,r,i,o,a,s){let u=t[e];return void 0===u?(u={id:n.id,object:n,geometry:r,material:i,groupOrder:o,renderOrder:n.renderOrder,z:a,group:s},t[e]=u):(u.id=n.id,u.object=n,u.geometry=r,u.material=i,u.groupOrder=o,u.renderOrder=n.renderOrder,u.z=a,u.group=s),e++,u}return{opaque:n,transmissive:r,transparent:i,init:function(){e=0,n.length=0,r.length=0,i.length=0},push:function(t,e,a,s,u,c){const l=o(t,e,a,s,u,c);a.transmission>0?r.push(l):!0===a.transparent?i.push(l):n.push(l)},unshift:function(t,e,a,s,u,c){const l=o(t,e,a,s,u,c);a.transmission>0?r.unshift(l):!0===a.transparent?i.unshift(l):n.unshift(l)},finish:function(){for(let n=e,r=t.length;n<r;n++){const e=t[n];if(null===e.id)break;e.id=null,e.object=null,e.geometry=null,e.material=null,e.group=null}},sort:function(t,e){n.length>1&&n.sort(t||ns),r.length>1&&r.sort(e||rs),i.length>1&&i.sort(e||rs)}}}function os(){let t=new WeakMap;return{get:function(e,n){const r=t.get(e);let i;return void 0===r?(i=new is,t.set(e,[i])):n>=r.length?(i=new is,r.push(i)):i=r[n],i},dispose:function(){t=new WeakMap}}}function as(){const t={};return{get:function(e){if(void 0!==t[e.id])return t[e.id];let n;switch(e.type){case"DirectionalLight":n={direction:new hn,color:new kr};break;case"SpotLight":n={position:new hn,direction:new hn,color:new kr,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":n={position:new hn,color:new kr,distance:0,decay:0};break;case"HemisphereLight":n={direction:new hn,skyColor:new kr,groundColor:new kr};break;case"RectAreaLight":n={color:new kr,position:new hn,halfWidth:new hn,halfHeight:new hn}}return t[e.id]=n,n}}}let ss=0;function us(t,e){return(e.castShadow?2:0)-(t.castShadow?2:0)+(e.map?1:0)-(t.map?1:0)}function cs(t){const e=new as,n=function(){const t={};return{get:function(e){if(void 0!==t[e.id])return t[e.id];let n;switch(e.type){case"DirectionalLight":case"SpotLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new je};break;case"PointLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new je,shadowCameraNear:1,shadowCameraFar:1e3}}return t[e.id]=n,n}}}(),r={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let t=0;t<9;t++)r.probe.push(new hn);const i=new hn,o=new Vn,a=new Vn;return{setup:function(i,o){let a=0,s=0,u=0;for(let t=0;t<9;t++)r.probe[t].set(0,0,0);let c=0,l=0,f=0,h=0,p=0,d=0,m=0,y=0,v=0,g=0,b=0;i.sort(us);const _=!0===o?Math.PI:1;for(let t=0,o=i.length;t<o;t++){const o=i[t],x=o.color,w=o.intensity,S=o.distance,T=o.shadow&&o.shadow.map?o.shadow.map.texture:null;if(o.isAmbientLight)a+=x.r*w*_,s+=x.g*w*_,u+=x.b*w*_;else if(o.isLightProbe){for(let t=0;t<9;t++)r.probe[t].addScaledVector(o.sh.coefficients[t],w);b++}else if(o.isDirectionalLight){const t=e.get(o);if(t.color.copy(o.color).multiplyScalar(o.intensity*_),o.castShadow){const t=o.shadow,e=n.get(o);e.shadowBias=t.bias,e.shadowNormalBias=t.normalBias,e.shadowRadius=t.radius,e.shadowMapSize=t.mapSize,r.directionalShadow[c]=e,r.directionalShadowMap[c]=T,r.directionalShadowMatrix[c]=o.shadow.matrix,d++}r.directional[c]=t,c++}else if(o.isSpotLight){const t=e.get(o);t.position.setFromMatrixPosition(o.matrixWorld),t.color.copy(x).multiplyScalar(w*_),t.distance=S,t.coneCos=Math.cos(o.angle),t.penumbraCos=Math.cos(o.angle*(1-o.penumbra)),t.decay=o.decay,r.spot[f]=t;const i=o.shadow;if(o.map&&(r.spotLightMap[v]=o.map,v++,i.updateMatrices(o),o.castShadow&&g++),r.spotLightMatrix[f]=i.matrix,o.castShadow){const t=n.get(o);t.shadowBias=i.bias,t.shadowNormalBias=i.normalBias,t.shadowRadius=i.radius,t.shadowMapSize=i.mapSize,r.spotShadow[f]=t,r.spotShadowMap[f]=T,y++}f++}else if(o.isRectAreaLight){const t=e.get(o);t.color.copy(x).multiplyScalar(w),t.halfWidth.set(.5*o.width,0,0),t.halfHeight.set(0,.5*o.height,0),r.rectArea[h]=t,h++}else if(o.isPointLight){const t=e.get(o);if(t.color.copy(o.color).multiplyScalar(o.intensity*_),t.distance=o.distance,t.decay=o.decay,o.castShadow){const t=o.shadow,e=n.get(o);e.shadowBias=t.bias,e.shadowNormalBias=t.normalBias,e.shadowRadius=t.radius,e.shadowMapSize=t.mapSize,e.shadowCameraNear=t.camera.near,e.shadowCameraFar=t.camera.far,r.pointShadow[l]=e,r.pointShadowMap[l]=T,r.pointShadowMatrix[l]=o.shadow.matrix,m++}r.point[l]=t,l++}else if(o.isHemisphereLight){const t=e.get(o);t.skyColor.copy(o.color).multiplyScalar(w*_),t.groundColor.copy(o.groundColor).multiplyScalar(w*_),r.hemi[p]=t,p++}}h>0&&(!0===t.has("OES_texture_float_linear")?(r.rectAreaLTC1=qi.LTC_FLOAT_1,r.rectAreaLTC2=qi.LTC_FLOAT_2):(r.rectAreaLTC1=qi.LTC_HALF_1,r.rectAreaLTC2=qi.LTC_HALF_2)),r.ambient[0]=a,r.ambient[1]=s,r.ambient[2]=u;const x=r.hash;x.directionalLength===c&&x.pointLength===l&&x.spotLength===f&&x.rectAreaLength===h&&x.hemiLength===p&&x.numDirectionalShadows===d&&x.numPointShadows===m&&x.numSpotShadows===y&&x.numSpotMaps===v&&x.numLightProbes===b||(r.directional.length=c,r.spot.length=f,r.rectArea.length=h,r.point.length=l,r.hemi.length=p,r.directionalShadow.length=d,r.directionalShadowMap.length=d,r.pointShadow.length=m,r.pointShadowMap.length=m,r.spotShadow.length=y,r.spotShadowMap.length=y,r.directionalShadowMatrix.length=d,r.pointShadowMatrix.length=m,r.spotLightMatrix.length=y+v-g,r.spotLightMap.length=v,r.numSpotLightShadowsWithMaps=g,r.numLightProbes=b,x.directionalLength=c,x.pointLength=l,x.spotLength=f,x.rectAreaLength=h,x.hemiLength=p,x.numDirectionalShadows=d,x.numPointShadows=m,x.numSpotShadows=y,x.numSpotMaps=v,x.numLightProbes=b,r.version=ss++)},setupView:function(t,e){let n=0,s=0,u=0,c=0,l=0;const f=e.matrixWorldInverse;for(let e=0,h=t.length;e<h;e++){const h=t[e];if(h.isDirectionalLight){const t=r.directional[n];t.direction.setFromMatrixPosition(h.matrixWorld),i.setFromMatrixPosition(h.target.matrixWorld),t.direction.sub(i),t.direction.transformDirection(f),n++}else if(h.isSpotLight){const t=r.spot[u];t.position.setFromMatrixPosition(h.matrixWorld),t.position.applyMatrix4(f),t.direction.setFromMatrixPosition(h.matrixWorld),i.setFromMatrixPosition(h.target.matrixWorld),t.direction.sub(i),t.direction.transformDirection(f),u++}else if(h.isRectAreaLight){const t=r.rectArea[c];t.position.setFromMatrixPosition(h.matrixWorld),t.position.applyMatrix4(f),a.identity(),o.copy(h.matrixWorld),o.premultiply(f),a.extractRotation(o),t.halfWidth.set(.5*h.width,0,0),t.halfHeight.set(0,.5*h.height,0),t.halfWidth.applyMatrix4(a),t.halfHeight.applyMatrix4(a),c++}else if(h.isPointLight){const t=r.point[s];t.position.setFromMatrixPosition(h.matrixWorld),t.position.applyMatrix4(f),s++}else if(h.isHemisphereLight){const t=r.hemi[l];t.direction.setFromMatrixPosition(h.matrixWorld),t.direction.transformDirection(f),l++}}},state:r}}function ls(t){const e=new cs(t),n=[],r=[];return{init:function(){n.length=0,r.length=0},state:{lightsArray:n,shadowsArray:r,lights:e,transmissionRenderTarget:null},setupLights:function(t){e.setup(n,t)},setupLightsView:function(t){e.setupView(n,t)},pushLight:function(t){n.push(t)},pushShadow:function(t){r.push(t)}}}function fs(t){let e=new WeakMap;return{get:function(n,r=0){const i=e.get(n);let o;return void 0===i?(o=new ls(t),e.set(n,[o])):r>=i.length?(o=new ls(t),i.push(o)):o=i[r],o},dispose:function(){e=new WeakMap}}}class hs extends Lr{constructor(t){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=3200,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(t)}copy(t){return super.copy(t),this.depthPacking=t.depthPacking,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this}}class ps extends Lr{constructor(t){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(t)}copy(t){return super.copy(t),this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this}}function ds(t,e,n){let i=new zi;const c=new je,l=new je,f=new an,h=new hs({depthPacking:3201}),p=new ps,d={},m=n.maxTextureSize,y={[a]:1,[s]:0,[u]:2},v=new Mi({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new je},radius:{value:4}},vertexShader:"void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n\tconst float samples = float( VSM_SAMPLES );\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );\n\tfloat uvStart = samples <= 1.0 ? 0.0 : - 1.0;\n\tfor ( float i = 0.0; i < samples; i ++ ) {\n\t\tfloat uvOffset = uvStart + i * uvStride;\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean / samples;\n\tsquared_mean = squared_mean / samples;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}"}),g=v.clone();g.defines.HORIZONTAL_PASS=1;const b=new ti;b.setAttribute("position",new Gr(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const _=new gi(b,v),x=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=r;let w=this.type;function S(n,r){const i=e.update(_);v.defines.VSM_SAMPLES!==n.blurSamples&&(v.defines.VSM_SAMPLES=n.blurSamples,g.defines.VSM_SAMPLES=n.blurSamples,v.needsUpdate=!0,g.needsUpdate=!0),null===n.mapPass&&(n.mapPass=new un(c.x,c.y)),v.uniforms.shadow_pass.value=n.map.texture,v.uniforms.resolution.value=n.mapSize,v.uniforms.radius.value=n.radius,t.setRenderTarget(n.mapPass),t.clear(),t.renderBufferDirect(r,null,i,v,_,null),g.uniforms.shadow_pass.value=n.mapPass.texture,g.uniforms.resolution.value=n.mapSize,g.uniforms.radius.value=n.radius,t.setRenderTarget(n.map),t.clear(),t.renderBufferDirect(r,null,i,g,_,null)}function T(e,n,r,i){let a=null;const s=!0===r.isPointLight?e.customDistanceMaterial:e.customDepthMaterial;if(void 0!==s)a=s;else if(a=!0===r.isPointLight?p:h,t.localClippingEnabled&&!0===n.clipShadows&&Array.isArray(n.clippingPlanes)&&0!==n.clippingPlanes.length||n.displacementMap&&0!==n.displacementScale||n.alphaMap&&n.alphaTest>0||n.map&&n.alphaTest>0){const t=a.uuid,e=n.uuid;let r=d[t];void 0===r&&(r={},d[t]=r);let i=r[e];void 0===i&&(i=a.clone(),r[e]=i,n.addEventListener("dispose",E)),a=i}return a.visible=n.visible,a.wireframe=n.wireframe,a.side=i===o?null!==n.shadowSide?n.shadowSide:n.side:null!==n.shadowSide?n.shadowSide:y[n.side],a.alphaMap=n.alphaMap,a.alphaTest=n.alphaTest,a.map=n.map,a.clipShadows=n.clipShadows,a.clippingPlanes=n.clippingPlanes,a.clipIntersection=n.clipIntersection,a.displacementMap=n.displacementMap,a.displacementScale=n.displacementScale,a.displacementBias=n.displacementBias,a.wireframeLinewidth=n.wireframeLinewidth,a.linewidth=n.linewidth,!0===r.isPointLight&&!0===a.isMeshDistanceMaterial&&(t.properties.get(a).light=r),a}function M(n,r,a,s,u){if(!1===n.visible)return;if(n.layers.test(r.layers)&&(n.isMesh||n.isLine||n.isPoints)&&(n.castShadow||n.receiveShadow&&u===o)&&(!n.frustumCulled||i.intersectsObject(n))){n.modelViewMatrix.multiplyMatrices(a.matrixWorldInverse,n.matrixWorld);const i=e.update(n),o=n.material;if(Array.isArray(o)){const e=i.groups;for(let c=0,l=e.length;c<l;c++){const l=e[c],f=o[l.materialIndex];if(f&&f.visible){const e=T(n,f,s,u);n.onBeforeShadow(t,n,r,a,i,e,l),t.renderBufferDirect(a,null,i,e,n,l),n.onAfterShadow(t,n,r,a,i,e,l)}}}else if(o.visible){const e=T(n,o,s,u);n.onBeforeShadow(t,n,r,a,i,e,null),t.renderBufferDirect(a,null,i,e,n,null),n.onAfterShadow(t,n,r,a,i,e,null)}}const c=n.children;for(let t=0,e=c.length;t<e;t++)M(c[t],r,a,s,u)}function E(t){t.target.removeEventListener("dispose",E);for(const e in d){const n=d[e],r=t.target.uuid;r in n&&(n[r].dispose(),delete n[r])}}this.render=function(e,n,r){if(!1===x.enabled)return;if(!1===x.autoUpdate&&!1===x.needsUpdate)return;if(0===e.length)return;const a=t.getRenderTarget(),s=t.getActiveCubeFace(),u=t.getActiveMipmapLevel(),h=t.state;h.setBlending(0),h.buffers.color.setClear(1,1,1,1),h.buffers.depth.setTest(!0),h.setScissorTest(!1);const p=w!==o&&this.type===o,d=w===o&&this.type!==o;for(let a=0,s=e.length;a<s;a++){const s=e[a],u=s.shadow;if(void 0===u){console.warn("THREE.WebGLShadowMap:",s,"has no shadow.");continue}if(!1===u.autoUpdate&&!1===u.needsUpdate)continue;c.copy(u.mapSize);const y=u.getFrameExtents();if(c.multiply(y),l.copy(u.mapSize),(c.x>m||c.y>m)&&(c.x>m&&(l.x=Math.floor(m/y.x),c.x=l.x*y.x,u.mapSize.x=l.x),c.y>m&&(l.y=Math.floor(m/y.y),c.y=l.y*y.y,u.mapSize.y=l.y)),null===u.map||!0===p||!0===d){const t=this.type!==o?{minFilter:J,magFilter:J}:{};null!==u.map&&u.map.dispose(),u.map=new un(c.x,c.y,t),u.map.texture.name=s.name+".shadowMap",u.camera.updateProjectionMatrix()}t.setRenderTarget(u.map),t.clear();const v=u.getViewportCount();for(let t=0;t<v;t++){const e=u.getViewport(t);f.set(l.x*e.x,l.y*e.y,l.x*e.z,l.y*e.w),h.viewport(f),u.updateMatrices(s,t),i=u.getFrustum(),M(n,r,u.camera,s,this.type)}!0!==u.isPointLightShadow&&this.type===o&&S(u,r),u.needsUpdate=!1}w=this.type,x.needsUpdate=!1,t.setRenderTarget(a,s,u)}}function ms(t){const e=new function(){let e=!1;const n=new an;let r=null;const i=new an(0,0,0,0);return{setMask:function(n){r===n||e||(t.colorMask(n,n,n,n),r=n)},setLocked:function(t){e=t},setClear:function(e,r,o,a,s){!0===s&&(e*=a,r*=a,o*=a),n.set(e,r,o,a),!1===i.equals(n)&&(t.clearColor(e,r,o,a),i.copy(n))},reset:function(){e=!1,r=null,i.set(-1,0,0,0)}}},n=new function(){let e=!1,n=null,r=null,i=null;return{setTest:function(e){e?rt(t.DEPTH_TEST):it(t.DEPTH_TEST)},setMask:function(r){n===r||e||(t.depthMask(r),n=r)},setFunc:function(e){if(r!==e){switch(e){case 0:t.depthFunc(t.NEVER);break;case 1:t.depthFunc(t.ALWAYS);break;case 2:t.depthFunc(t.LESS);break;case 3:default:t.depthFunc(t.LEQUAL);break;case 4:t.depthFunc(t.EQUAL);break;case 5:t.depthFunc(t.GEQUAL);break;case 6:t.depthFunc(t.GREATER);break;case 7:t.depthFunc(t.NOTEQUAL)}r=e}},setLocked:function(t){e=t},setClear:function(e){i!==e&&(t.clearDepth(e),i=e)},reset:function(){e=!1,n=null,r=null,i=null}}},r=new function(){let e=!1,n=null,r=null,i=null,o=null,a=null,s=null,u=null,c=null;return{setTest:function(n){e||(n?rt(t.STENCIL_TEST):it(t.STENCIL_TEST))},setMask:function(r){n===r||e||(t.stencilMask(r),n=r)},setFunc:function(e,n,a){r===e&&i===n&&o===a||(t.stencilFunc(e,n,a),r=e,i=n,o=a)},setOp:function(e,n,r){a===e&&s===n&&u===r||(t.stencilOp(e,n,r),a=e,s=n,u=r)},setLocked:function(t){e=t},setClear:function(e){c!==e&&(t.clearStencil(e),c=e)},reset:function(){e=!1,n=null,r=null,i=null,o=null,a=null,s=null,u=null,c=null}}},i=new WeakMap,o=new WeakMap;let a={},s={},u=new WeakMap,A=[],O=null,P=!1,R=null,k=null,C=null,N=null,L=null,j=null,I=null,B=new kr(0,0,0),U=0,D=!1,F=null,z=null,V=null,G=null,H=null;const W=t.getParameter(t.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let q=!1,X=0;const Y=t.getParameter(t.VERSION);-1!==Y.indexOf("WebGL")?(X=parseFloat(/^WebGL (\d)/.exec(Y)[1]),q=X>=1):-1!==Y.indexOf("OpenGL ES")&&(X=parseFloat(/^OpenGL ES (\d)/.exec(Y)[1]),q=X>=2);let J=null,Z={};const K=t.getParameter(t.SCISSOR_BOX),Q=t.getParameter(t.VIEWPORT),$=(new an).fromArray(K),tt=(new an).fromArray(Q);function et(e,n,r,i){const o=new Uint8Array(4),a=t.createTexture();t.bindTexture(e,a),t.texParameteri(e,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(e,t.TEXTURE_MAG_FILTER,t.NEAREST);for(let a=0;a<r;a++)e===t.TEXTURE_3D||e===t.TEXTURE_2D_ARRAY?t.texImage3D(n,0,t.RGBA,1,1,i,0,t.RGBA,t.UNSIGNED_BYTE,o):t.texImage2D(n+a,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,o);return a}const nt={};function rt(e){!0!==a[e]&&(t.enable(e),a[e]=!0)}function it(e){!1!==a[e]&&(t.disable(e),a[e]=!1)}nt[t.TEXTURE_2D]=et(t.TEXTURE_2D,t.TEXTURE_2D,1),nt[t.TEXTURE_CUBE_MAP]=et(t.TEXTURE_CUBE_MAP,t.TEXTURE_CUBE_MAP_POSITIVE_X,6),nt[t.TEXTURE_2D_ARRAY]=et(t.TEXTURE_2D_ARRAY,t.TEXTURE_2D_ARRAY,1,1),nt[t.TEXTURE_3D]=et(t.TEXTURE_3D,t.TEXTURE_3D,1,1),e.setClear(0,0,0,1),n.setClear(1),r.setClear(0),rt(t.DEPTH_TEST),n.setFunc(3),ut(!1),ct(1),rt(t.CULL_FACE),st(0);const ot={[c]:t.FUNC_ADD,[l]:t.FUNC_SUBTRACT,[f]:t.FUNC_REVERSE_SUBTRACT};ot[103]=t.MIN,ot[104]=t.MAX;const at={[h]:t.ZERO,[p]:t.ONE,[d]:t.SRC_COLOR,[y]:t.SRC_ALPHA,[w]:t.SRC_ALPHA_SATURATE,[_]:t.DST_COLOR,[g]:t.DST_ALPHA,[m]:t.ONE_MINUS_SRC_COLOR,[v]:t.ONE_MINUS_SRC_ALPHA,[x]:t.ONE_MINUS_DST_COLOR,[b]:t.ONE_MINUS_DST_ALPHA,[S]:t.CONSTANT_COLOR,[T]:t.ONE_MINUS_CONSTANT_COLOR,[M]:t.CONSTANT_ALPHA,[E]:t.ONE_MINUS_CONSTANT_ALPHA};function st(e,n,r,i,o,a,s,u,l,f){if(0!==e){if(!1===P&&(rt(t.BLEND),P=!0),5===e)o=o||n,a=a||r,s=s||i,n===k&&o===L||(t.blendEquationSeparate(ot[n],ot[o]),k=n,L=o),r===C&&i===N&&a===j&&s===I||(t.blendFuncSeparate(at[r],at[i],at[a],at[s]),C=r,N=i,j=a,I=s),!1!==u.equals(B)&&l===U||(t.blendColor(u.r,u.g,u.b,l),B.copy(u),U=l),R=e,D=!1;else if(e!==R||f!==D){if(k===c&&L===c||(t.blendEquation(t.FUNC_ADD),k=c,L=c),f)switch(e){case 1:t.blendFuncSeparate(t.ONE,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA);break;case 2:t.blendFunc(t.ONE,t.ONE);break;case 3:t.blendFuncSeparate(t.ZERO,t.ONE_MINUS_SRC_COLOR,t.ZERO,t.ONE);break;case 4:t.blendFuncSeparate(t.ZERO,t.SRC_COLOR,t.ZERO,t.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",e)}else switch(e){case 1:t.blendFuncSeparate(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA);break;case 2:t.blendFunc(t.SRC_ALPHA,t.ONE);break;case 3:t.blendFuncSeparate(t.ZERO,t.ONE_MINUS_SRC_COLOR,t.ZERO,t.ONE);break;case 4:t.blendFunc(t.ZERO,t.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",e)}C=null,N=null,j=null,I=null,B.set(0,0,0),U=0,R=e,D=f}}else!0===P&&(it(t.BLEND),P=!1)}function ut(e){F!==e&&(e?t.frontFace(t.CW):t.frontFace(t.CCW),F=e)}function ct(e){0!==e?(rt(t.CULL_FACE),e!==z&&(1===e?t.cullFace(t.BACK):2===e?t.cullFace(t.FRONT):t.cullFace(t.FRONT_AND_BACK))):it(t.CULL_FACE),z=e}function lt(e,n,r){e?(rt(t.POLYGON_OFFSET_FILL),G===n&&H===r||(t.polygonOffset(n,r),G=n,H=r)):it(t.POLYGON_OFFSET_FILL)}return{buffers:{color:e,depth:n,stencil:r},enable:rt,disable:it,bindFramebuffer:function(e,n){return s[e]!==n&&(t.bindFramebuffer(e,n),s[e]=n,e===t.DRAW_FRAMEBUFFER&&(s[t.FRAMEBUFFER]=n),e===t.FRAMEBUFFER&&(s[t.DRAW_FRAMEBUFFER]=n),!0)},drawBuffers:function(e,n){let r=A,i=!1;if(e){r=u.get(n),void 0===r&&(r=[],u.set(n,r));const o=e.textures;if(r.length!==o.length||r[0]!==t.COLOR_ATTACHMENT0){for(let e=0,n=o.length;e<n;e++)r[e]=t.COLOR_ATTACHMENT0+e;r.length=o.length,i=!0}}else r[0]!==t.BACK&&(r[0]=t.BACK,i=!0);i&&t.drawBuffers(r)},useProgram:function(e){return O!==e&&(t.useProgram(e),O=e,!0)},setBlending:st,setMaterial:function(i,o){2===i.side?it(t.CULL_FACE):rt(t.CULL_FACE);let a=1===i.side;o&&(a=!a),ut(a),1===i.blending&&!1===i.transparent?st(0):st(i.blending,i.blendEquation,i.blendSrc,i.blendDst,i.blendEquationAlpha,i.blendSrcAlpha,i.blendDstAlpha,i.blendColor,i.blendAlpha,i.premultipliedAlpha),n.setFunc(i.depthFunc),n.setTest(i.depthTest),n.setMask(i.depthWrite),e.setMask(i.colorWrite);const s=i.stencilWrite;r.setTest(s),s&&(r.setMask(i.stencilWriteMask),r.setFunc(i.stencilFunc,i.stencilRef,i.stencilFuncMask),r.setOp(i.stencilFail,i.stencilZFail,i.stencilZPass)),lt(i.polygonOffset,i.polygonOffsetFactor,i.polygonOffsetUnits),!0===i.alphaToCoverage?rt(t.SAMPLE_ALPHA_TO_COVERAGE):it(t.SAMPLE_ALPHA_TO_COVERAGE)},setFlipSided:ut,setCullFace:ct,setLineWidth:function(e){e!==V&&(q&&t.lineWidth(e),V=e)},setPolygonOffset:lt,setScissorTest:function(e){e?rt(t.SCISSOR_TEST):it(t.SCISSOR_TEST)},activeTexture:function(e){void 0===e&&(e=t.TEXTURE0+W-1),J!==e&&(t.activeTexture(e),J=e)},bindTexture:function(e,n,r){void 0===r&&(r=null===J?t.TEXTURE0+W-1:J);let i=Z[r];void 0===i&&(i={type:void 0,texture:void 0},Z[r]=i),i.type===e&&i.texture===n||(J!==r&&(t.activeTexture(r),J=r),t.bindTexture(e,n||nt[e]),i.type=e,i.texture=n)},unbindTexture:function(){const e=Z[J];void 0!==e&&void 0!==e.type&&(t.bindTexture(e.type,null),e.type=void 0,e.texture=void 0)},compressedTexImage2D:function(){try{t.compressedTexImage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},compressedTexImage3D:function(){try{t.compressedTexImage3D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texImage2D:function(){try{t.texImage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texImage3D:function(){try{t.texImage3D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},updateUBOMapping:function(e,n){let r=o.get(n);void 0===r&&(r=new WeakMap,o.set(n,r));let i=r.get(e);void 0===i&&(i=t.getUniformBlockIndex(n,e.name),r.set(e,i))},uniformBlockBinding:function(e,n){const r=o.get(n).get(e);i.get(n)!==r&&(t.uniformBlockBinding(n,r,e.__bindingPointIndex),i.set(n,r))},texStorage2D:function(){try{t.texStorage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texStorage3D:function(){try{t.texStorage3D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texSubImage2D:function(){try{t.texSubImage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texSubImage3D:function(){try{t.texSubImage3D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},compressedTexSubImage2D:function(){try{t.compressedTexSubImage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},compressedTexSubImage3D:function(){try{t.compressedTexSubImage3D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},scissor:function(e){!1===$.equals(e)&&(t.scissor(e.x,e.y,e.z,e.w),$.copy(e))},viewport:function(e){!1===tt.equals(e)&&(t.viewport(e.x,e.y,e.z,e.w),tt.copy(e))},reset:function(){t.disable(t.BLEND),t.disable(t.CULL_FACE),t.disable(t.DEPTH_TEST),t.disable(t.POLYGON_OFFSET_FILL),t.disable(t.SCISSOR_TEST),t.disable(t.STENCIL_TEST),t.disable(t.SAMPLE_ALPHA_TO_COVERAGE),t.blendEquation(t.FUNC_ADD),t.blendFunc(t.ONE,t.ZERO),t.blendFuncSeparate(t.ONE,t.ZERO,t.ONE,t.ZERO),t.blendColor(0,0,0,0),t.colorMask(!0,!0,!0,!0),t.clearColor(0,0,0,0),t.depthMask(!0),t.depthFunc(t.LESS),t.clearDepth(1),t.stencilMask(4294967295),t.stencilFunc(t.ALWAYS,0,4294967295),t.stencilOp(t.KEEP,t.KEEP,t.KEEP),t.clearStencil(0),t.cullFace(t.BACK),t.frontFace(t.CCW),t.polygonOffset(0,0),t.activeTexture(t.TEXTURE0),t.bindFramebuffer(t.FRAMEBUFFER,null),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,null),t.bindFramebuffer(t.READ_FRAMEBUFFER,null),t.useProgram(null),t.lineWidth(1),t.scissor(0,0,t.canvas.width,t.canvas.height),t.viewport(0,0,t.canvas.width,t.canvas.height),a={},J=null,Z={},s={},u=new WeakMap,A=[],O=null,P=!1,R=null,k=null,C=null,N=null,L=null,j=null,I=null,B=new kr(0,0,0),U=0,D=!1,F=null,z=null,V=null,G=null,H=null,$.set(0,0,t.canvas.width,t.canvas.height),tt.set(0,0,t.canvas.width,t.canvas.height),e.reset(),n.reset(),r.reset()}}}function ys(t,e,n,r,i,o,a){const s=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,u="undefined"!=typeof navigator&&/OculusBrowser/g.test(navigator.userAgent),c=new je,l=new WeakMap;let f;const h=new WeakMap;let p=!1;try{p="undefined"!=typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(t){}function d(t,e){return p?new OffscreenCanvas(t,e):ze("canvas")}function m(t,e,n){let r=1;const i=B(t);if((i.width>n||i.height>n)&&(r=n/Math.max(i.width,i.height)),r<1){if("undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap||"undefined"!=typeof VideoFrame&&t instanceof VideoFrame){const n=Math.floor(r*i.width),o=Math.floor(r*i.height);void 0===f&&(f=d(n,o));const a=e?d(n,o):f;return a.width=n,a.height=o,a.getContext("2d").drawImage(t,0,0,n,o),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+i.width+"x"+i.height+") to ("+n+"x"+o+")."),a}return"data"in t&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+i.width+"x"+i.height+")."),t}return t}function y(t){return t.generateMipmaps&&t.minFilter!==J&&t.minFilter!==Q}function v(e){t.generateMipmap(e)}function g(n,r,i,o,a=!1){if(null!==n){if(void 0!==t[n])return t[n];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+n+"'")}let s=r;if(r===t.RED&&(i===t.FLOAT&&(s=t.R32F),i===t.HALF_FLOAT&&(s=t.R16F),i===t.UNSIGNED_BYTE&&(s=t.R8)),r===t.RED_INTEGER&&(i===t.UNSIGNED_BYTE&&(s=t.R8UI),i===t.UNSIGNED_SHORT&&(s=t.R16UI),i===t.UNSIGNED_INT&&(s=t.R32UI),i===t.BYTE&&(s=t.R8I),i===t.SHORT&&(s=t.R16I),i===t.INT&&(s=t.R32I)),r===t.RG&&(i===t.FLOAT&&(s=t.RG32F),i===t.HALF_FLOAT&&(s=t.RG16F),i===t.UNSIGNED_BYTE&&(s=t.RG8)),r===t.RG_INTEGER&&(i===t.UNSIGNED_BYTE&&(s=t.RG8UI),i===t.UNSIGNED_SHORT&&(s=t.RG16UI),i===t.UNSIGNED_INT&&(s=t.RG32UI),i===t.BYTE&&(s=t.RG8I),i===t.SHORT&&(s=t.RG16I),i===t.INT&&(s=t.RG32I)),r===t.RGB&&i===t.UNSIGNED_INT_5_9_9_9_REV&&(s=t.RGB9_E5),r===t.RGBA){const e=a?ae:Je.getTransfer(o);i===t.FLOAT&&(s=t.RGBA32F),i===t.HALF_FLOAT&&(s=t.RGBA16F),i===t.UNSIGNED_BYTE&&(s=e===se?t.SRGB8_ALPHA8:t.RGBA8),i===t.UNSIGNED_SHORT_4_4_4_4&&(s=t.RGBA4),i===t.UNSIGNED_SHORT_5_5_5_1&&(s=t.RGB5_A1)}return s!==t.R16F&&s!==t.R32F&&s!==t.RG16F&&s!==t.RG32F&&s!==t.RGBA16F&&s!==t.RGBA32F||e.get("EXT_color_buffer_float"),s}function b(t,e){return!0===y(t)||t.isFramebufferTexture&&t.minFilter!==J&&t.minFilter!==Q?Math.log2(Math.max(e.width,e.height))+1:void 0!==t.mipmaps&&t.mipmaps.length>0?t.mipmaps.length:t.isCompressedTexture&&Array.isArray(t.image)?e.mipmaps.length:1}function _(t){const e=t.target;e.removeEventListener("dispose",_),function(t){const e=r.get(t);if(void 0===e.__webglInit)return;const n=t.source,i=h.get(n);if(i){const r=i[e.__cacheKey];r.usedTimes--,0===r.usedTimes&&w(t),0===Object.keys(i).length&&h.delete(n)}r.remove(t)}(e),e.isVideoTexture&&l.delete(e)}function x(e){const n=e.target;n.removeEventListener("dispose",x),function(e){const n=r.get(e);if(e.depthTexture&&e.depthTexture.dispose(),e.isWebGLCubeRenderTarget)for(let e=0;e<6;e++){if(Array.isArray(n.__webglFramebuffer[e]))for(let r=0;r<n.__webglFramebuffer[e].length;r++)t.deleteFramebuffer(n.__webglFramebuffer[e][r]);else t.deleteFramebuffer(n.__webglFramebuffer[e]);n.__webglDepthbuffer&&t.deleteRenderbuffer(n.__webglDepthbuffer[e])}else{if(Array.isArray(n.__webglFramebuffer))for(let e=0;e<n.__webglFramebuffer.length;e++)t.deleteFramebuffer(n.__webglFramebuffer[e]);else t.deleteFramebuffer(n.__webglFramebuffer);if(n.__webglDepthbuffer&&t.deleteRenderbuffer(n.__webglDepthbuffer),n.__webglMultisampledFramebuffer&&t.deleteFramebuffer(n.__webglMultisampledFramebuffer),n.__webglColorRenderbuffer)for(let e=0;e<n.__webglColorRenderbuffer.length;e++)n.__webglColorRenderbuffer[e]&&t.deleteRenderbuffer(n.__webglColorRenderbuffer[e]);n.__webglDepthRenderbuffer&&t.deleteRenderbuffer(n.__webglDepthRenderbuffer)}const i=e.textures;for(let e=0,n=i.length;e<n;e++){const n=r.get(i[e]);n.__webglTexture&&(t.deleteTexture(n.__webglTexture),a.memory.textures--),r.remove(i[e])}r.remove(e)}(n)}function w(e){const n=r.get(e);t.deleteTexture(n.__webglTexture);const i=e.source;delete h.get(i)[n.__cacheKey],a.memory.textures--}let S=0;function T(e,i){const o=r.get(e);if(e.isVideoTexture&&function(t){const e=a.render.frame;l.get(t)!==e&&(l.set(t,e),t.update())}(e),!1===e.isRenderTargetTexture&&e.version>0&&o.__version!==e.version){const t=e.image;if(null===t)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else{if(!1!==t.complete)return void R(o,e,i);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}n.bindTexture(t.TEXTURE_2D,o.__webglTexture,t.TEXTURE0+i)}const M={[q]:t.REPEAT,[X]:t.CLAMP_TO_EDGE,[Y]:t.MIRRORED_REPEAT},E={[J]:t.NEAREST,[Z]:t.NEAREST_MIPMAP_NEAREST,[K]:t.NEAREST_MIPMAP_LINEAR,[Q]:t.LINEAR,[$]:t.LINEAR_MIPMAP_NEAREST,[tt]:t.LINEAR_MIPMAP_LINEAR},A={[fe]:t.NEVER,[ge]:t.ALWAYS,[he]:t.LESS,[de]:t.LEQUAL,[pe]:t.EQUAL,[ve]:t.GEQUAL,[me]:t.GREATER,[ye]:t.NOTEQUAL};function O(n,o){if(o.type!==ot||!1!==e.has("OES_texture_float_linear")||o.magFilter!==Q&&o.magFilter!==$&&o.magFilter!==K&&o.magFilter!==tt&&o.minFilter!==Q&&o.minFilter!==$&&o.minFilter!==K&&o.minFilter!==tt||console.warn("THREE.WebGLRenderer: Unable to use linear filtering with floating point textures. OES_texture_float_linear not supported on this device."),t.texParameteri(n,t.TEXTURE_WRAP_S,M[o.wrapS]),t.texParameteri(n,t.TEXTURE_WRAP_T,M[o.wrapT]),n!==t.TEXTURE_3D&&n!==t.TEXTURE_2D_ARRAY||t.texParameteri(n,t.TEXTURE_WRAP_R,M[o.wrapR]),t.texParameteri(n,t.TEXTURE_MAG_FILTER,E[o.magFilter]),t.texParameteri(n,t.TEXTURE_MIN_FILTER,E[o.minFilter]),o.compareFunction&&(t.texParameteri(n,t.TEXTURE_COMPARE_MODE,t.COMPARE_REF_TO_TEXTURE),t.texParameteri(n,t.TEXTURE_COMPARE_FUNC,A[o.compareFunction])),!0===e.has("EXT_texture_filter_anisotropic")){if(o.magFilter===J)return;if(o.minFilter!==K&&o.minFilter!==tt)return;if(o.type===ot&&!1===e.has("OES_texture_float_linear"))return;if(o.anisotropy>1||r.get(o).__currentAnisotropy){const a=e.get("EXT_texture_filter_anisotropic");t.texParameterf(n,a.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(o.anisotropy,i.getMaxAnisotropy())),r.get(o).__currentAnisotropy=o.anisotropy}}}function P(e,n){let r=!1;void 0===e.__webglInit&&(e.__webglInit=!0,n.addEventListener("dispose",_));const i=n.source;let o=h.get(i);void 0===o&&(o={},h.set(i,o));const s=function(t){const e=[];return e.push(t.wrapS),e.push(t.wrapT),e.push(t.wrapR||0),e.push(t.magFilter),e.push(t.minFilter),e.push(t.anisotropy),e.push(t.internalFormat),e.push(t.format),e.push(t.type),e.push(t.generateMipmaps),e.push(t.premultiplyAlpha),e.push(t.flipY),e.push(t.unpackAlignment),e.push(t.colorSpace),e.join()}(n);if(s!==e.__cacheKey){void 0===o[s]&&(o[s]={texture:t.createTexture(),usedTimes:0},a.memory.textures++,r=!0),o[s].usedTimes++;const i=o[e.__cacheKey];void 0!==i&&(o[e.__cacheKey].usedTimes--,0===i.usedTimes&&w(n)),e.__cacheKey=s,e.__webglTexture=o[s].texture}return r}function R(e,a,s){let u=t.TEXTURE_2D;(a.isDataArrayTexture||a.isCompressedArrayTexture)&&(u=t.TEXTURE_2D_ARRAY),a.isData3DTexture&&(u=t.TEXTURE_3D);const c=P(e,a),l=a.source;n.bindTexture(u,e.__webglTexture,t.TEXTURE0+s);const f=r.get(l);if(l.version!==f.__version||!0===c){n.activeTexture(t.TEXTURE0+s);const e=Je.getPrimaries(Je.workingColorSpace),r=a.colorSpace===ee?null:Je.getPrimaries(a.colorSpace),h=a.colorSpace===ee||e===r?t.NONE:t.BROWSER_DEFAULT_WEBGL;t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,a.flipY),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,a.premultiplyAlpha),t.pixelStorei(t.UNPACK_ALIGNMENT,a.unpackAlignment),t.pixelStorei(t.UNPACK_COLORSPACE_CONVERSION_WEBGL,h);let p=m(a.image,!1,i.maxTextureSize);p=I(a,p);const d=o.convert(a.format,a.colorSpace),_=o.convert(a.type);let x,w=g(a.internalFormat,d,_,a.colorSpace,a.isVideoTexture);O(u,a);const S=a.mipmaps,T=!0!==a.isVideoTexture&&w!==Mt,M=void 0===f.__version||!0===c,E=l.dataReady,A=b(a,p);if(a.isDepthTexture)w=t.DEPTH_COMPONENT16,a.type===ot?w=t.DEPTH_COMPONENT32F:a.type===it?w=t.DEPTH_COMPONENT24:a.type===ct&&(w=t.DEPTH24_STENCIL8),M&&(T?n.texStorage2D(t.TEXTURE_2D,1,w,p.width,p.height):n.texImage2D(t.TEXTURE_2D,0,w,p.width,p.height,0,d,_,null));else if(a.isDataTexture)if(S.length>0){T&&M&&n.texStorage2D(t.TEXTURE_2D,A,w,S[0].width,S[0].height);for(let e=0,r=S.length;e<r;e++)x=S[e],T?E&&n.texSubImage2D(t.TEXTURE_2D,e,0,0,x.width,x.height,d,_,x.data):n.texImage2D(t.TEXTURE_2D,e,w,x.width,x.height,0,d,_,x.data);a.generateMipmaps=!1}else T?(M&&n.texStorage2D(t.TEXTURE_2D,A,w,p.width,p.height),E&&n.texSubImage2D(t.TEXTURE_2D,0,0,0,p.width,p.height,d,_,p.data)):n.texImage2D(t.TEXTURE_2D,0,w,p.width,p.height,0,d,_,p.data);else if(a.isCompressedTexture)if(a.isCompressedArrayTexture){T&&M&&n.texStorage3D(t.TEXTURE_2D_ARRAY,A,w,S[0].width,S[0].height,p.depth);for(let e=0,r=S.length;e<r;e++)x=S[e],a.format!==lt?null!==d?T?E&&n.compressedTexSubImage3D(t.TEXTURE_2D_ARRAY,e,0,0,0,x.width,x.height,p.depth,d,x.data,0,0):n.compressedTexImage3D(t.TEXTURE_2D_ARRAY,e,w,x.width,x.height,p.depth,0,x.data,0,0):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):T?E&&n.texSubImage3D(t.TEXTURE_2D_ARRAY,e,0,0,0,x.width,x.height,p.depth,d,_,x.data):n.texImage3D(t.TEXTURE_2D_ARRAY,e,w,x.width,x.height,p.depth,0,d,_,x.data)}else{T&&M&&n.texStorage2D(t.TEXTURE_2D,A,w,S[0].width,S[0].height);for(let e=0,r=S.length;e<r;e++)x=S[e],a.format!==lt?null!==d?T?E&&n.compressedTexSubImage2D(t.TEXTURE_2D,e,0,0,x.width,x.height,d,x.data):n.compressedTexImage2D(t.TEXTURE_2D,e,w,x.width,x.height,0,x.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):T?E&&n.texSubImage2D(t.TEXTURE_2D,e,0,0,x.width,x.height,d,_,x.data):n.texImage2D(t.TEXTURE_2D,e,w,x.width,x.height,0,d,_,x.data)}else if(a.isDataArrayTexture)T?(M&&n.texStorage3D(t.TEXTURE_2D_ARRAY,A,w,p.width,p.height,p.depth),E&&n.texSubImage3D(t.TEXTURE_2D_ARRAY,0,0,0,0,p.width,p.height,p.depth,d,_,p.data)):n.texImage3D(t.TEXTURE_2D_ARRAY,0,w,p.width,p.height,p.depth,0,d,_,p.data);else if(a.isData3DTexture)T?(M&&n.texStorage3D(t.TEXTURE_3D,A,w,p.width,p.height,p.depth),E&&n.texSubImage3D(t.TEXTURE_3D,0,0,0,0,p.width,p.height,p.depth,d,_,p.data)):n.texImage3D(t.TEXTURE_3D,0,w,p.width,p.height,p.depth,0,d,_,p.data);else if(a.isFramebufferTexture){if(M)if(T)n.texStorage2D(t.TEXTURE_2D,A,w,p.width,p.height);else{let e=p.width,r=p.height;for(let i=0;i<A;i++)n.texImage2D(t.TEXTURE_2D,i,w,e,r,0,d,_,null),e>>=1,r>>=1}}else if(S.length>0){if(T&&M){const e=B(S[0]);n.texStorage2D(t.TEXTURE_2D,A,w,e.width,e.height)}for(let e=0,r=S.length;e<r;e++)x=S[e],T?E&&n.texSubImage2D(t.TEXTURE_2D,e,0,0,d,_,x):n.texImage2D(t.TEXTURE_2D,e,w,d,_,x);a.generateMipmaps=!1}else if(T){if(M){const e=B(p);n.texStorage2D(t.TEXTURE_2D,A,w,e.width,e.height)}E&&n.texSubImage2D(t.TEXTURE_2D,0,0,0,d,_,p)}else n.texImage2D(t.TEXTURE_2D,0,w,d,_,p);y(a)&&v(u),f.__version=l.version,a.onUpdate&&a.onUpdate(a)}e.__version=a.version}function k(e,i,a,u,c,l){const f=o.convert(a.format,a.colorSpace),h=o.convert(a.type),p=g(a.internalFormat,f,h,a.colorSpace);if(!r.get(i).__hasExternalTextures){const e=Math.max(1,i.width>>l),r=Math.max(1,i.height>>l);c===t.TEXTURE_3D||c===t.TEXTURE_2D_ARRAY?n.texImage3D(c,l,p,e,r,i.depth,0,f,h,null):n.texImage2D(c,l,p,e,r,0,f,h,null)}n.bindFramebuffer(t.FRAMEBUFFER,e),j(i)?s.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,u,c,r.get(a).__webglTexture,0,L(i)):(c===t.TEXTURE_2D||c>=t.TEXTURE_CUBE_MAP_POSITIVE_X&&c<=t.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&t.framebufferTexture2D(t.FRAMEBUFFER,u,c,r.get(a).__webglTexture,l),n.bindFramebuffer(t.FRAMEBUFFER,null)}function C(e,n,r){if(t.bindRenderbuffer(t.RENDERBUFFER,e),n.depthBuffer&&!n.stencilBuffer){let i=t.DEPTH_COMPONENT24;if(r||j(n)){const e=n.depthTexture;e&&e.isDepthTexture&&(e.type===ot?i=t.DEPTH_COMPONENT32F:e.type===it&&(i=t.DEPTH_COMPONENT24));const r=L(n);j(n)?s.renderbufferStorageMultisampleEXT(t.RENDERBUFFER,r,i,n.width,n.height):t.renderbufferStorageMultisample(t.RENDERBUFFER,r,i,n.width,n.height)}else t.renderbufferStorage(t.RENDERBUFFER,i,n.width,n.height);t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,e)}else if(n.depthBuffer&&n.stencilBuffer){const i=L(n);r&&!1===j(n)?t.renderbufferStorageMultisample(t.RENDERBUFFER,i,t.DEPTH24_STENCIL8,n.width,n.height):j(n)?s.renderbufferStorageMultisampleEXT(t.RENDERBUFFER,i,t.DEPTH24_STENCIL8,n.width,n.height):t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_STENCIL,n.width,n.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.RENDERBUFFER,e)}else{const e=n.textures;for(let i=0;i<e.length;i++){const a=e[i],u=o.convert(a.format,a.colorSpace),c=o.convert(a.type),l=g(a.internalFormat,u,c,a.colorSpace),f=L(n);r&&!1===j(n)?t.renderbufferStorageMultisample(t.RENDERBUFFER,f,l,n.width,n.height):j(n)?s.renderbufferStorageMultisampleEXT(t.RENDERBUFFER,f,l,n.width,n.height):t.renderbufferStorage(t.RENDERBUFFER,l,n.width,n.height)}}t.bindRenderbuffer(t.RENDERBUFFER,null)}function N(e){const i=r.get(e),o=!0===e.isWebGLCubeRenderTarget;if(e.depthTexture&&!i.__autoAllocateDepthBuffer){if(o)throw new Error("target.depthTexture not supported in Cube render targets");!function(e,i){if(i&&i.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(n.bindFramebuffer(t.FRAMEBUFFER,e),!i.depthTexture||!i.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");r.get(i.depthTexture).__webglTexture&&i.depthTexture.image.width===i.width&&i.depthTexture.image.height===i.height||(i.depthTexture.image.width=i.width,i.depthTexture.image.height=i.height,i.depthTexture.needsUpdate=!0),T(i.depthTexture,0);const o=r.get(i.depthTexture).__webglTexture,a=L(i);if(i.depthTexture.format===ft)j(i)?s.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.TEXTURE_2D,o,0,a):t.framebufferTexture2D(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.TEXTURE_2D,o,0);else{if(i.depthTexture.format!==ht)throw new Error("Unknown depthTexture format");j(i)?s.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.TEXTURE_2D,o,0,a):t.framebufferTexture2D(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.TEXTURE_2D,o,0)}}(i.__webglFramebuffer,e)}else if(o){i.__webglDepthbuffer=[];for(let r=0;r<6;r++)n.bindFramebuffer(t.FRAMEBUFFER,i.__webglFramebuffer[r]),i.__webglDepthbuffer[r]=t.createRenderbuffer(),C(i.__webglDepthbuffer[r],e,!1)}else n.bindFramebuffer(t.FRAMEBUFFER,i.__webglFramebuffer),i.__webglDepthbuffer=t.createRenderbuffer(),C(i.__webglDepthbuffer,e,!1);n.bindFramebuffer(t.FRAMEBUFFER,null)}function L(t){return Math.min(i.maxSamples,t.samples)}function j(t){const n=r.get(t);return t.samples>0&&!0===e.has("WEBGL_multisampled_render_to_texture")&&!1!==n.__useRenderToTexture}function I(t,e){const n=t.colorSpace,r=t.format,i=t.type;return!0===t.isCompressedTexture||!0===t.isVideoTexture||n!==re&&n!==ee&&(Je.getTransfer(n)===se?r===lt&&i===et||console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",n)),e}function B(t){return"undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement?(c.width=t.naturalWidth||t.width,c.height=t.naturalHeight||t.height):"undefined"!=typeof VideoFrame&&t instanceof VideoFrame?(c.width=t.displayWidth,c.height=t.displayHeight):(c.width=t.width,c.height=t.height),c}this.allocateTextureUnit=function(){const t=S;return t>=i.maxTextures&&console.warn("THREE.WebGLTextures: Trying to use "+t+" texture units while this GPU supports only "+i.maxTextures),S+=1,t},this.resetTextureUnits=function(){S=0},this.setTexture2D=T,this.setTexture2DArray=function(e,i){const o=r.get(e);e.version>0&&o.__version!==e.version?R(o,e,i):n.bindTexture(t.TEXTURE_2D_ARRAY,o.__webglTexture,t.TEXTURE0+i)},this.setTexture3D=function(e,i){const o=r.get(e);e.version>0&&o.__version!==e.version?R(o,e,i):n.bindTexture(t.TEXTURE_3D,o.__webglTexture,t.TEXTURE0+i)},this.setTextureCube=function(e,a){const s=r.get(e);e.version>0&&s.__version!==e.version?function(e,a,s){if(6!==a.image.length)return;const u=P(e,a),c=a.source;n.bindTexture(t.TEXTURE_CUBE_MAP,e.__webglTexture,t.TEXTURE0+s);const l=r.get(c);if(c.version!==l.__version||!0===u){n.activeTexture(t.TEXTURE0+s);const e=Je.getPrimaries(Je.workingColorSpace),r=a.colorSpace===ee?null:Je.getPrimaries(a.colorSpace),f=a.colorSpace===ee||e===r?t.NONE:t.BROWSER_DEFAULT_WEBGL;t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,a.flipY),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,a.premultiplyAlpha),t.pixelStorei(t.UNPACK_ALIGNMENT,a.unpackAlignment),t.pixelStorei(t.UNPACK_COLORSPACE_CONVERSION_WEBGL,f);const h=a.isCompressedTexture||a.image[0].isCompressedTexture,p=a.image[0]&&a.image[0].isDataTexture,d=[];for(let t=0;t<6;t++)d[t]=h||p?p?a.image[t].image:a.image[t]:m(a.image[t],!0,i.maxCubemapSize),d[t]=I(a,d[t]);const _=d[0],x=o.convert(a.format,a.colorSpace),w=o.convert(a.type),S=g(a.internalFormat,x,w,a.colorSpace),T=!0!==a.isVideoTexture,M=void 0===l.__version||!0===u,E=c.dataReady;let A,P=b(a,_);if(O(t.TEXTURE_CUBE_MAP,a),h){T&&M&&n.texStorage2D(t.TEXTURE_CUBE_MAP,P,S,_.width,_.height);for(let e=0;e<6;e++){A=d[e].mipmaps;for(let r=0;r<A.length;r++){const i=A[r];a.format!==lt?null!==x?T?E&&n.compressedTexSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,r,0,0,i.width,i.height,x,i.data):n.compressedTexImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,r,S,i.width,i.height,0,i.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):T?E&&n.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,r,0,0,i.width,i.height,x,w,i.data):n.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,r,S,i.width,i.height,0,x,w,i.data)}}}else{if(A=a.mipmaps,T&&M){A.length>0&&P++;const e=B(d[0]);n.texStorage2D(t.TEXTURE_CUBE_MAP,P,S,e.width,e.height)}for(let e=0;e<6;e++)if(p){T?E&&n.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,0,0,0,d[e].width,d[e].height,x,w,d[e].data):n.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,0,S,d[e].width,d[e].height,0,x,w,d[e].data);for(let r=0;r<A.length;r++){const i=A[r].image[e].image;T?E&&n.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,r+1,0,0,i.width,i.height,x,w,i.data):n.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,r+1,S,i.width,i.height,0,x,w,i.data)}}else{T?E&&n.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,0,0,0,x,w,d[e]):n.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,0,S,x,w,d[e]);for(let r=0;r<A.length;r++){const i=A[r];T?E&&n.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,r+1,0,0,x,w,i.image[e]):n.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,r+1,S,x,w,i.image[e])}}}y(a)&&v(t.TEXTURE_CUBE_MAP),l.__version=c.version,a.onUpdate&&a.onUpdate(a)}e.__version=a.version}(s,e,a):n.bindTexture(t.TEXTURE_CUBE_MAP,s.__webglTexture,t.TEXTURE0+a)},this.rebindTextures=function(e,n,i){const o=r.get(e);void 0!==n&&k(o.__webglFramebuffer,e,e.texture,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,0),void 0!==i&&N(e)},this.setupRenderTarget=function(e){const i=e.texture,s=r.get(e),u=r.get(i);e.addEventListener("dispose",x);const c=e.textures,l=!0===e.isWebGLCubeRenderTarget,f=c.length>1;if(f||(void 0===u.__webglTexture&&(u.__webglTexture=t.createTexture()),u.__version=i.version,a.memory.textures++),l){s.__webglFramebuffer=[];for(let e=0;e<6;e++)if(i.mipmaps&&i.mipmaps.length>0){s.__webglFramebuffer[e]=[];for(let n=0;n<i.mipmaps.length;n++)s.__webglFramebuffer[e][n]=t.createFramebuffer()}else s.__webglFramebuffer[e]=t.createFramebuffer()}else{if(i.mipmaps&&i.mipmaps.length>0){s.__webglFramebuffer=[];for(let e=0;e<i.mipmaps.length;e++)s.__webglFramebuffer[e]=t.createFramebuffer()}else s.__webglFramebuffer=t.createFramebuffer();if(f)for(let e=0,n=c.length;e<n;e++){const n=r.get(c[e]);void 0===n.__webglTexture&&(n.__webglTexture=t.createTexture(),a.memory.textures++)}if(e.samples>0&&!1===j(e)){s.__webglMultisampledFramebuffer=t.createFramebuffer(),s.__webglColorRenderbuffer=[],n.bindFramebuffer(t.FRAMEBUFFER,s.__webglMultisampledFramebuffer);for(let n=0;n<c.length;n++){const r=c[n];s.__webglColorRenderbuffer[n]=t.createRenderbuffer(),t.bindRenderbuffer(t.RENDERBUFFER,s.__webglColorRenderbuffer[n]);const i=o.convert(r.format,r.colorSpace),a=o.convert(r.type),u=g(r.internalFormat,i,a,r.colorSpace,!0===e.isXRRenderTarget),l=L(e);t.renderbufferStorageMultisample(t.RENDERBUFFER,l,u,e.width,e.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0+n,t.RENDERBUFFER,s.__webglColorRenderbuffer[n])}t.bindRenderbuffer(t.RENDERBUFFER,null),e.depthBuffer&&(s.__webglDepthRenderbuffer=t.createRenderbuffer(),C(s.__webglDepthRenderbuffer,e,!0)),n.bindFramebuffer(t.FRAMEBUFFER,null)}}if(l){n.bindTexture(t.TEXTURE_CUBE_MAP,u.__webglTexture),O(t.TEXTURE_CUBE_MAP,i);for(let n=0;n<6;n++)if(i.mipmaps&&i.mipmaps.length>0)for(let r=0;r<i.mipmaps.length;r++)k(s.__webglFramebuffer[n][r],e,i,t.COLOR_ATTACHMENT0,t.TEXTURE_CUBE_MAP_POSITIVE_X+n,r);else k(s.__webglFramebuffer[n],e,i,t.COLOR_ATTACHMENT0,t.TEXTURE_CUBE_MAP_POSITIVE_X+n,0);y(i)&&v(t.TEXTURE_CUBE_MAP),n.unbindTexture()}else if(f){for(let i=0,o=c.length;i<o;i++){const o=c[i],a=r.get(o);n.bindTexture(t.TEXTURE_2D,a.__webglTexture),O(t.TEXTURE_2D,o),k(s.__webglFramebuffer,e,o,t.COLOR_ATTACHMENT0+i,t.TEXTURE_2D,0),y(o)&&v(t.TEXTURE_2D)}n.unbindTexture()}else{let r=t.TEXTURE_2D;if((e.isWebGL3DRenderTarget||e.isWebGLArrayRenderTarget)&&(r=e.isWebGL3DRenderTarget?t.TEXTURE_3D:t.TEXTURE_2D_ARRAY),n.bindTexture(r,u.__webglTexture),O(r,i),i.mipmaps&&i.mipmaps.length>0)for(let n=0;n<i.mipmaps.length;n++)k(s.__webglFramebuffer[n],e,i,t.COLOR_ATTACHMENT0,r,n);else k(s.__webglFramebuffer,e,i,t.COLOR_ATTACHMENT0,r,0);y(i)&&v(r),n.unbindTexture()}e.depthBuffer&&N(e)},this.updateRenderTargetMipmap=function(e){const i=e.textures;for(let o=0,a=i.length;o<a;o++){const a=i[o];if(y(a)){const i=e.isWebGLCubeRenderTarget?t.TEXTURE_CUBE_MAP:t.TEXTURE_2D,o=r.get(a).__webglTexture;n.bindTexture(i,o),v(i),n.unbindTexture()}}},this.updateMultisampleRenderTarget=function(e){if(e.samples>0&&!1===j(e)){const i=e.textures,o=e.width,a=e.height;let s=t.COLOR_BUFFER_BIT;const c=[],l=e.stencilBuffer?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT,f=r.get(e),h=i.length>1;if(h)for(let e=0;e<i.length;e++)n.bindFramebuffer(t.FRAMEBUFFER,f.__webglMultisampledFramebuffer),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0+e,t.RENDERBUFFER,null),n.bindFramebuffer(t.FRAMEBUFFER,f.__webglFramebuffer),t.framebufferTexture2D(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0+e,t.TEXTURE_2D,null,0);n.bindFramebuffer(t.READ_FRAMEBUFFER,f.__webglMultisampledFramebuffer),n.bindFramebuffer(t.DRAW_FRAMEBUFFER,f.__webglFramebuffer);for(let n=0;n<i.length;n++){c.push(t.COLOR_ATTACHMENT0+n),e.depthBuffer&&c.push(l);const p=void 0!==f.__ignoreDepthValues&&f.__ignoreDepthValues;if(!1===p&&(e.depthBuffer&&(s|=t.DEPTH_BUFFER_BIT),e.stencilBuffer&&!0!==f.__isTransmissionRenderTarget&&(s|=t.STENCIL_BUFFER_BIT)),h&&t.framebufferRenderbuffer(t.READ_FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.RENDERBUFFER,f.__webglColorRenderbuffer[n]),!0===p&&(t.invalidateFramebuffer(t.READ_FRAMEBUFFER,[l]),t.invalidateFramebuffer(t.DRAW_FRAMEBUFFER,[l])),h){const e=r.get(i[n]).__webglTexture;t.framebufferTexture2D(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,e,0)}t.blitFramebuffer(0,0,o,a,0,0,o,a,s,t.NEAREST),u&&t.invalidateFramebuffer(t.READ_FRAMEBUFFER,c)}if(n.bindFramebuffer(t.READ_FRAMEBUFFER,null),n.bindFramebuffer(t.DRAW_FRAMEBUFFER,null),h)for(let e=0;e<i.length;e++){n.bindFramebuffer(t.FRAMEBUFFER,f.__webglMultisampledFramebuffer),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0+e,t.RENDERBUFFER,f.__webglColorRenderbuffer[e]);const o=r.get(i[e]).__webglTexture;n.bindFramebuffer(t.FRAMEBUFFER,f.__webglFramebuffer),t.framebufferTexture2D(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0+e,t.TEXTURE_2D,o,0)}n.bindFramebuffer(t.DRAW_FRAMEBUFFER,f.__webglMultisampledFramebuffer)}},this.setupDepthRenderbuffer=N,this.setupFrameBufferTexture=k,this.useMultisampledRTT=j}function vs(t,e){return{convert:function(n,r=""){let i;const o=Je.getTransfer(r);if(n===et)return t.UNSIGNED_BYTE;if(n===st)return t.UNSIGNED_SHORT_4_4_4_4;if(n===ut)return t.UNSIGNED_SHORT_5_5_5_1;if(35902===n)return t.UNSIGNED_INT_5_9_9_9_REV;if(1010===n)return t.BYTE;if(1011===n)return t.SHORT;if(n===nt)return t.UNSIGNED_SHORT;if(n===rt)return t.INT;if(n===it)return t.UNSIGNED_INT;if(n===ot)return t.FLOAT;if(n===at)return t.HALF_FLOAT;if(1021===n)return t.ALPHA;if(1022===n)return t.RGB;if(n===lt)return t.RGBA;if(1024===n)return t.LUMINANCE;if(1025===n)return t.LUMINANCE_ALPHA;if(n===ft)return t.DEPTH_COMPONENT;if(n===ht)return t.DEPTH_STENCIL;if(n===pt)return t.RED;if(n===dt)return t.RED_INTEGER;if(1030===n)return t.RG;if(n===mt)return t.RG_INTEGER;if(n===yt)return t.RGBA_INTEGER;if(n===vt||n===gt||n===bt||n===_t)if(o===se){if(i=e.get("WEBGL_compressed_texture_s3tc_srgb"),null===i)return null;if(n===vt)return i.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(n===gt)return i.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(n===bt)return i.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(n===_t)return i.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(i=e.get("WEBGL_compressed_texture_s3tc"),null===i)return null;if(n===vt)return i.COMPRESSED_RGB_S3TC_DXT1_EXT;if(n===gt)return i.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(n===bt)return i.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(n===_t)return i.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(n===xt||n===wt||n===St||n===Tt){if(i=e.get("WEBGL_compressed_texture_pvrtc"),null===i)return null;if(n===xt)return i.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(n===wt)return i.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(n===St)return i.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(n===Tt)return i.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(n===Mt)return i=e.get("WEBGL_compressed_texture_etc1"),null!==i?i.COMPRESSED_RGB_ETC1_WEBGL:null;if(n===Et||n===At){if(i=e.get("WEBGL_compressed_texture_etc"),null===i)return null;if(n===Et)return o===se?i.COMPRESSED_SRGB8_ETC2:i.COMPRESSED_RGB8_ETC2;if(n===At)return o===se?i.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:i.COMPRESSED_RGBA8_ETC2_EAC}if(n===Ot||n===Pt||n===Rt||n===kt||n===Ct||n===Nt||n===Lt||n===jt||n===It||n===Bt||n===Ut||n===Dt||n===Ft||n===zt){if(i=e.get("WEBGL_compressed_texture_astc"),null===i)return null;if(n===Ot)return o===se?i.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:i.COMPRESSED_RGBA_ASTC_4x4_KHR;if(n===Pt)return o===se?i.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:i.COMPRESSED_RGBA_ASTC_5x4_KHR;if(n===Rt)return o===se?i.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:i.COMPRESSED_RGBA_ASTC_5x5_KHR;if(n===kt)return o===se?i.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:i.COMPRESSED_RGBA_ASTC_6x5_KHR;if(n===Ct)return o===se?i.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:i.COMPRESSED_RGBA_ASTC_6x6_KHR;if(n===Nt)return o===se?i.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:i.COMPRESSED_RGBA_ASTC_8x5_KHR;if(n===Lt)return o===se?i.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:i.COMPRESSED_RGBA_ASTC_8x6_KHR;if(n===jt)return o===se?i.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:i.COMPRESSED_RGBA_ASTC_8x8_KHR;if(n===It)return o===se?i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:i.COMPRESSED_RGBA_ASTC_10x5_KHR;if(n===Bt)return o===se?i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:i.COMPRESSED_RGBA_ASTC_10x6_KHR;if(n===Ut)return o===se?i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:i.COMPRESSED_RGBA_ASTC_10x8_KHR;if(n===Dt)return o===se?i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:i.COMPRESSED_RGBA_ASTC_10x10_KHR;if(n===Ft)return o===se?i.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:i.COMPRESSED_RGBA_ASTC_12x10_KHR;if(n===zt)return o===se?i.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:i.COMPRESSED_RGBA_ASTC_12x12_KHR}if(n===Vt||n===Gt||n===Ht){if(i=e.get("EXT_texture_compression_bptc"),null===i)return null;if(n===Vt)return o===se?i.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:i.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(n===Gt)return i.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(n===Ht)return i.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}if(36283===n||n===Wt||n===qt||n===Xt){if(i=e.get("EXT_texture_compression_rgtc"),null===i)return null;if(n===Vt)return i.COMPRESSED_RED_RGTC1_EXT;if(n===Wt)return i.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(n===qt)return i.COMPRESSED_RED_GREEN_RGTC2_EXT;if(n===Xt)return i.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}return n===ct?t.UNSIGNED_INT_24_8:void 0!==t[n]?t[n]:null}}}class gs extends Ri{constructor(t=[]){super(),this.isArrayCamera=!0,this.cameras=t}}class bs extends mr{constructor(){super(),this.isGroup=!0,this.type="Group"}}const _s={type:"move"};class xs{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return null===this._hand&&(this._hand=new bs,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return null===this._targetRay&&(this._targetRay=new bs,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new hn,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new hn),this._targetRay}getGripSpace(){return null===this._grip&&(this._grip=new bs,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new hn,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new hn),this._grip}dispatchEvent(t){return null!==this._targetRay&&this._targetRay.dispatchEvent(t),null!==this._grip&&this._grip.dispatchEvent(t),null!==this._hand&&this._hand.dispatchEvent(t),this}connect(t){if(t&&t.hand){const e=this._hand;if(e)for(const n of t.hand.values())this._getHandJoint(e,n)}return this.dispatchEvent({type:"connected",data:t}),this}disconnect(t){return this.dispatchEvent({type:"disconnected",data:t}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this}update(t,e,n){let r=null,i=null,o=null;const a=this._targetRay,s=this._grip,u=this._hand;if(t&&"visible-blurred"!==e.session.visibilityState){if(u&&t.hand){o=!0;for(const r of t.hand.values()){const t=e.getJointPose(r,n),i=this._getHandJoint(u,r);null!==t&&(i.matrix.fromArray(t.transform.matrix),i.matrix.decompose(i.position,i.rotation,i.scale),i.matrixWorldNeedsUpdate=!0,i.jointRadius=t.radius),i.visible=null!==t}const r=u.joints["index-finger-tip"],i=u.joints["thumb-tip"],a=r.position.distanceTo(i.position),s=.02,c=.005;u.inputState.pinching&&a>s+c?(u.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:t.handedness,target:this})):!u.inputState.pinching&&a<=s-c&&(u.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:t.handedness,target:this}))}else null!==s&&t.gripSpace&&(i=e.getPose(t.gripSpace,n),null!==i&&(s.matrix.fromArray(i.transform.matrix),s.matrix.decompose(s.position,s.rotation,s.scale),s.matrixWorldNeedsUpdate=!0,i.linearVelocity?(s.hasLinearVelocity=!0,s.linearVelocity.copy(i.linearVelocity)):s.hasLinearVelocity=!1,i.angularVelocity?(s.hasAngularVelocity=!0,s.angularVelocity.copy(i.angularVelocity)):s.hasAngularVelocity=!1));null!==a&&(r=e.getPose(t.targetRaySpace,n),null===r&&null!==i&&(r=i),null!==r&&(a.matrix.fromArray(r.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),a.matrixWorldNeedsUpdate=!0,r.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(r.linearVelocity)):a.hasLinearVelocity=!1,r.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(r.angularVelocity)):a.hasAngularVelocity=!1,this.dispatchEvent(_s)))}return null!==a&&(a.visible=null!==r),null!==s&&(s.visible=null!==i),null!==u&&(u.visible=null!==o),this}_getHandJoint(t,e){if(void 0===t.joints[e.jointName]){const n=new bs;n.matrixAutoUpdate=!1,n.visible=!1,t.joints[e.jointName]=n,t.add(n)}return t.joints[e.jointName]}}class ws{constructor(){this.texture=null,this.mesh=null,this.depthNear=0,this.depthFar=0}init(t,e,n){if(null===this.texture){const r=new on;t.properties.get(r).__webglTexture=e.texture,e.depthNear==n.depthNear&&e.depthFar==n.depthFar||(this.depthNear=e.depthNear,this.depthFar=e.depthFar),this.texture=r}}render(t,e){if(null!==this.texture){if(null===this.mesh){const t=e.cameras[0].viewport,n=new Mi({vertexShader:"\nvoid main() {\n\n\tgl_Position = vec4( position, 1.0 );\n\n}",fragmentShader:"\nuniform sampler2DArray depthColor;\nuniform float depthWidth;\nuniform float depthHeight;\n\nvoid main() {\n\n\tvec2 coord = vec2( gl_FragCoord.x / depthWidth, gl_FragCoord.y / depthHeight );\n\n\tif ( coord.x >= 1.0 ) {\n\n\t\tgl_FragDepth = texture( depthColor, vec3( coord.x - 1.0, coord.y, 1 ) ).r;\n\n\t} else {\n\n\t\tgl_FragDepth = texture( depthColor, vec3( coord.x, coord.y, 0 ) ).r;\n\n\t}\n\n}",uniforms:{depthColor:{value:this.texture},depthWidth:{value:t.z},depthHeight:{value:t.w}}});this.mesh=new gi(new Hi(20,20),n)}t.render(this.mesh,e)}}reset(){this.texture=null,this.mesh=null}}class Ss extends Se{constructor(t,e){super();const n=this;let r=null,i=1,o=null,a="local-floor",s=1,u=null,c=null,l=null,f=null,h=null,p=null;const d=new ws,m=e.getContextAttributes();let y=null,v=null;const g=[],b=[],_=new je;let x=null;const w=new Ri;w.layers.enable(1),w.viewport=new an;const S=new Ri;S.layers.enable(2),S.viewport=new an;const T=[w,S],M=new gs;M.layers.enable(1),M.layers.enable(2);let E=null,A=null;function O(t){const e=b.indexOf(t.inputSource);if(-1===e)return;const n=g[e];void 0!==n&&(n.update(t.inputSource,t.frame,u||o),n.dispatchEvent({type:t.type,data:t.inputSource}))}function P(){r.removeEventListener("select",O),r.removeEventListener("selectstart",O),r.removeEventListener("selectend",O),r.removeEventListener("squeeze",O),r.removeEventListener("squeezestart",O),r.removeEventListener("squeezeend",O),r.removeEventListener("end",P),r.removeEventListener("inputsourceschange",R);for(let t=0;t<g.length;t++){const e=b[t];null!==e&&(b[t]=null,g[t].disconnect(e))}E=null,A=null,d.reset(),t.setRenderTarget(y),h=null,f=null,l=null,r=null,v=null,j.stop(),n.isPresenting=!1,t.setPixelRatio(x),t.setSize(_.width,_.height,!1),n.dispatchEvent({type:"sessionend"})}function R(t){for(let e=0;e<t.removed.length;e++){const n=t.removed[e],r=b.indexOf(n);r>=0&&(b[r]=null,g[r].disconnect(n))}for(let e=0;e<t.added.length;e++){const n=t.added[e];let r=b.indexOf(n);if(-1===r){for(let t=0;t<g.length;t++){if(t>=b.length){b.push(n),r=t;break}if(null===b[t]){b[t]=n,r=t;break}}if(-1===r)break}const i=g[r];i&&i.connect(n)}}this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(t){let e=g[t];return void 0===e&&(e=new xs,g[t]=e),e.getTargetRaySpace()},this.getControllerGrip=function(t){let e=g[t];return void 0===e&&(e=new xs,g[t]=e),e.getGripSpace()},this.getHand=function(t){let e=g[t];return void 0===e&&(e=new xs,g[t]=e),e.getHandSpace()},this.setFramebufferScaleFactor=function(t){i=t,!0===n.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(t){a=t,!0===n.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return u||o},this.setReferenceSpace=function(t){u=t},this.getBaseLayer=function(){return null!==f?f:h},this.getBinding=function(){return l},this.getFrame=function(){return p},this.getSession=function(){return r},this.setSession=async function(c){if(r=c,null!==r){if(y=t.getRenderTarget(),r.addEventListener("select",O),r.addEventListener("selectstart",O),r.addEventListener("selectend",O),r.addEventListener("squeeze",O),r.addEventListener("squeezestart",O),r.addEventListener("squeezeend",O),r.addEventListener("end",P),r.addEventListener("inputsourceschange",R),!0!==m.xrCompatible&&await e.makeXRCompatible(),x=t.getPixelRatio(),t.getSize(_),void 0===r.renderState.layers){const n={antialias:m.antialias,alpha:!0,depth:m.depth,stencil:m.stencil,framebufferScaleFactor:i};h=new XRWebGLLayer(r,e,n),r.updateRenderState({baseLayer:h}),t.setPixelRatio(1),t.setSize(h.framebufferWidth,h.framebufferHeight,!1),v=new un(h.framebufferWidth,h.framebufferHeight,{format:lt,type:et,colorSpace:t.outputColorSpace,stencilBuffer:m.stencil})}else{let n=null,o=null,a=null;m.depth&&(a=m.stencil?e.DEPTH24_STENCIL8:e.DEPTH_COMPONENT24,n=m.stencil?ht:ft,o=m.stencil?ct:it);const s={colorFormat:e.RGBA8,depthFormat:a,scaleFactor:i};l=new XRWebGLBinding(r,e),f=l.createProjectionLayer(s),r.updateRenderState({layers:[f]}),t.setPixelRatio(1),t.setSize(f.textureWidth,f.textureHeight,!1),v=new un(f.textureWidth,f.textureHeight,{format:lt,type:et,depthTexture:new Ao(f.textureWidth,f.textureHeight,o,void 0,void 0,void 0,void 0,void 0,void 0,n),stencilBuffer:m.stencil,colorSpace:t.outputColorSpace,samples:m.antialias?4:0}),t.properties.get(v).__ignoreDepthValues=f.ignoreDepthValues}v.isXRRenderTarget=!0,this.setFoveation(s),u=null,o=await r.requestReferenceSpace(a),j.setContext(r),j.start(),n.isPresenting=!0,n.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(null!==r)return r.environmentBlendMode};const k=new hn,C=new hn;function N(t,e){null===e?t.matrixWorld.copy(t.matrix):t.matrixWorld.multiplyMatrices(e.matrixWorld,t.matrix),t.matrixWorldInverse.copy(t.matrixWorld).invert()}this.updateCamera=function(t){if(null===r)return;null!==d.texture&&(t.near=d.depthNear,t.far=d.depthFar),M.near=S.near=w.near=t.near,M.far=S.far=w.far=t.far,E===M.near&&A===M.far||(r.updateRenderState({depthNear:M.near,depthFar:M.far}),E=M.near,A=M.far,w.near=E,w.far=A,S.near=E,S.far=A,w.updateProjectionMatrix(),S.updateProjectionMatrix(),t.updateProjectionMatrix());const e=t.parent,n=M.cameras;N(M,e);for(let t=0;t<n.length;t++)N(n[t],e);2===n.length?function(t,e,n){k.setFromMatrixPosition(e.matrixWorld),C.setFromMatrixPosition(n.matrixWorld);const r=k.distanceTo(C),i=e.projectionMatrix.elements,o=n.projectionMatrix.elements,a=i[14]/(i[10]-1),s=i[14]/(i[10]+1),u=(i[9]+1)/i[5],c=(i[9]-1)/i[5],l=(i[8]-1)/i[0],f=(o[8]+1)/o[0],h=a*l,p=a*f,d=r/(-l+f),m=d*-l;e.matrixWorld.decompose(t.position,t.quaternion,t.scale),t.translateX(m),t.translateZ(d),t.matrixWorld.compose(t.position,t.quaternion,t.scale),t.matrixWorldInverse.copy(t.matrixWorld).invert();const y=a+d,v=s+d,g=h-m,b=p+(r-m),_=u*s/v*y,x=c*s/v*y;t.projectionMatrix.makePerspective(g,b,_,x,y,v),t.projectionMatrixInverse.copy(t.projectionMatrix).invert()}(M,w,S):M.projectionMatrix.copy(w.projectionMatrix),function(t,e,n){null===n?t.matrix.copy(e.matrixWorld):(t.matrix.copy(n.matrixWorld),t.matrix.invert(),t.matrix.multiply(e.matrixWorld)),t.matrix.decompose(t.position,t.quaternion,t.scale),t.updateMatrixWorld(!0),t.projectionMatrix.copy(e.projectionMatrix),t.projectionMatrixInverse.copy(e.projectionMatrixInverse),t.isPerspectiveCamera&&(t.fov=2*Ae*Math.atan(1/t.projectionMatrix.elements[5]),t.zoom=1)}(t,M,e)},this.getCamera=function(){return M},this.getFoveation=function(){if(null!==f||null!==h)return s},this.setFoveation=function(t){s=t,null!==f&&(f.fixedFoveation=t),null!==h&&void 0!==h.fixedFoveation&&(h.fixedFoveation=t)},this.hasDepthSensing=function(){return null!==d.texture};let L=null;const j=new Vi;j.setAnimationLoop((function(e,i){if(c=i.getViewerPose(u||o),p=i,null!==c){const e=c.views;null!==h&&(t.setRenderTargetFramebuffer(v,h.framebuffer),t.setRenderTarget(v));let n=!1;e.length!==M.cameras.length&&(M.cameras.length=0,n=!0);for(let r=0;r<e.length;r++){const i=e[r];let o=null;if(null!==h)o=h.getViewport(i);else{const e=l.getViewSubImage(f,i);o=e.viewport,0===r&&(t.setRenderTargetTextures(v,e.colorTexture,f.ignoreDepthValues?void 0:e.depthStencilTexture),t.setRenderTarget(v))}let a=T[r];void 0===a&&(a=new Ri,a.layers.enable(r),a.viewport=new an,T[r]=a),a.matrix.fromArray(i.transform.matrix),a.matrix.decompose(a.position,a.quaternion,a.scale),a.projectionMatrix.fromArray(i.projectionMatrix),a.projectionMatrixInverse.copy(a.projectionMatrix).invert(),a.viewport.set(o.x,o.y,o.width,o.height),0===r&&(M.matrix.copy(a.matrix),M.matrix.decompose(M.position,M.quaternion,M.scale)),!0===n&&M.cameras.push(a)}const i=r.enabledFeatures;if(i&&i.includes("depth-sensing")){const n=l.getDepthInformation(e[0]);n&&n.isValid&&n.texture&&d.init(t,n,r.renderState)}}for(let t=0;t<g.length;t++){const e=b[t],n=g[t];null!==e&&void 0!==n&&n.update(e,i,u||o)}d.render(t,M),L&&L(e,i),i.detectedPlanes&&n.dispatchEvent({type:"planesdetected",data:i}),p=null})),this.setAnimationLoop=function(t){L=t},this.dispose=function(){}}}const Ts=new Qn,Ms=new Vn;function Es(t,e){function n(t,e){!0===t.matrixAutoUpdate&&t.updateMatrix(),e.value.copy(t.matrix)}function r(r,i){r.opacity.value=i.opacity,i.color&&r.diffuse.value.copy(i.color),i.emissive&&r.emissive.value.copy(i.emissive).multiplyScalar(i.emissiveIntensity),i.map&&(r.map.value=i.map,n(i.map,r.mapTransform)),i.alphaMap&&(r.alphaMap.value=i.alphaMap,n(i.alphaMap,r.alphaMapTransform)),i.bumpMap&&(r.bumpMap.value=i.bumpMap,n(i.bumpMap,r.bumpMapTransform),r.bumpScale.value=i.bumpScale,1===i.side&&(r.bumpScale.value*=-1)),i.normalMap&&(r.normalMap.value=i.normalMap,n(i.normalMap,r.normalMapTransform),r.normalScale.value.copy(i.normalScale),1===i.side&&r.normalScale.value.negate()),i.displacementMap&&(r.displacementMap.value=i.displacementMap,n(i.displacementMap,r.displacementMapTransform),r.displacementScale.value=i.displacementScale,r.displacementBias.value=i.displacementBias),i.emissiveMap&&(r.emissiveMap.value=i.emissiveMap,n(i.emissiveMap,r.emissiveMapTransform)),i.specularMap&&(r.specularMap.value=i.specularMap,n(i.specularMap,r.specularMapTransform)),i.alphaTest>0&&(r.alphaTest.value=i.alphaTest);const o=e.get(i),a=o.envMap,s=o.envMapRotation;if(a&&(r.envMap.value=a,Ts.copy(s),Ts.x*=-1,Ts.y*=-1,Ts.z*=-1,a.isCubeTexture&&!1===a.isRenderTargetTexture&&(Ts.y*=-1,Ts.z*=-1),r.envMapRotation.value.setFromMatrix4(Ms.makeRotationFromEuler(Ts)),r.flipEnvMap.value=a.isCubeTexture&&!1===a.isRenderTargetTexture?-1:1,r.reflectivity.value=i.reflectivity,r.ior.value=i.ior,r.refractionRatio.value=i.refractionRatio),i.lightMap){r.lightMap.value=i.lightMap;const e=!0===t._useLegacyLights?Math.PI:1;r.lightMapIntensity.value=i.lightMapIntensity*e,n(i.lightMap,r.lightMapTransform)}i.aoMap&&(r.aoMap.value=i.aoMap,r.aoMapIntensity.value=i.aoMapIntensity,n(i.aoMap,r.aoMapTransform))}return{refreshFogUniforms:function(e,n){n.color.getRGB(e.fogColor.value,Si(t)),n.isFog?(e.fogNear.value=n.near,e.fogFar.value=n.far):n.isFogExp2&&(e.fogDensity.value=n.density)},refreshMaterialUniforms:function(t,i,o,a,s){i.isMeshBasicMaterial||i.isMeshLambertMaterial?r(t,i):i.isMeshToonMaterial?(r(t,i),function(t,e){e.gradientMap&&(t.gradientMap.value=e.gradientMap)}(t,i)):i.isMeshPhongMaterial?(r(t,i),function(t,e){t.specular.value.copy(e.specular),t.shininess.value=Math.max(e.shininess,1e-4)}(t,i)):i.isMeshStandardMaterial?(r(t,i),function(t,e){t.metalness.value=e.metalness,e.metalnessMap&&(t.metalnessMap.value=e.metalnessMap,n(e.metalnessMap,t.metalnessMapTransform)),t.roughness.value=e.roughness,e.roughnessMap&&(t.roughnessMap.value=e.roughnessMap,n(e.roughnessMap,t.roughnessMapTransform)),e.envMap&&(t.envMapIntensity.value=e.envMapIntensity)}(t,i),i.isMeshPhysicalMaterial&&function(t,e,r){t.ior.value=e.ior,e.sheen>0&&(t.sheenColor.value.copy(e.sheenColor).multiplyScalar(e.sheen),t.sheenRoughness.value=e.sheenRoughness,e.sheenColorMap&&(t.sheenColorMap.value=e.sheenColorMap,n(e.sheenColorMap,t.sheenColorMapTransform)),e.sheenRoughnessMap&&(t.sheenRoughnessMap.value=e.sheenRoughnessMap,n(e.sheenRoughnessMap,t.sheenRoughnessMapTransform))),e.clearcoat>0&&(t.clearcoat.value=e.clearcoat,t.clearcoatRoughness.value=e.clearcoatRoughness,e.clearcoatMap&&(t.clearcoatMap.value=e.clearcoatMap,n(e.clearcoatMap,t.clearcoatMapTransform)),e.clearcoatRoughnessMap&&(t.clearcoatRoughnessMap.value=e.clearcoatRoughnessMap,n(e.clearcoatRoughnessMap,t.clearcoatRoughnessMapTransform)),e.clearcoatNormalMap&&(t.clearcoatNormalMap.value=e.clearcoatNormalMap,n(e.clearcoatNormalMap,t.clearcoatNormalMapTransform),t.clearcoatNormalScale.value.copy(e.clearcoatNormalScale),1===e.side&&t.clearcoatNormalScale.value.negate())),e.iridescence>0&&(t.iridescence.value=e.iridescence,t.iridescenceIOR.value=e.iridescenceIOR,t.iridescenceThicknessMinimum.value=e.iridescenceThicknessRange[0],t.iridescenceThicknessMaximum.value=e.iridescenceThicknessRange[1],e.iridescenceMap&&(t.iridescenceMap.value=e.iridescenceMap,n(e.iridescenceMap,t.iridescenceMapTransform)),e.iridescenceThicknessMap&&(t.iridescenceThicknessMap.value=e.iridescenceThicknessMap,n(e.iridescenceThicknessMap,t.iridescenceThicknessMapTransform))),e.transmission>0&&(t.transmission.value=e.transmission,t.transmissionSamplerMap.value=r.texture,t.transmissionSamplerSize.value.set(r.width,r.height),e.transmissionMap&&(t.transmissionMap.value=e.transmissionMap,n(e.transmissionMap,t.transmissionMapTransform)),t.thickness.value=e.thickness,e.thicknessMap&&(t.thicknessMap.value=e.thicknessMap,n(e.thicknessMap,t.thicknessMapTransform)),t.attenuationDistance.value=e.attenuationDistance,t.attenuationColor.value.copy(e.attenuationColor)),e.anisotropy>0&&(t.anisotropyVector.value.set(e.anisotropy*Math.cos(e.anisotropyRotation),e.anisotropy*Math.sin(e.anisotropyRotation)),e.anisotropyMap&&(t.anisotropyMap.value=e.anisotropyMap,n(e.anisotropyMap,t.anisotropyMapTransform))),t.specularIntensity.value=e.specularIntensity,t.specularColor.value.copy(e.specularColor),e.specularColorMap&&(t.specularColorMap.value=e.specularColorMap,n(e.specularColorMap,t.specularColorMapTransform)),e.specularIntensityMap&&(t.specularIntensityMap.value=e.specularIntensityMap,n(e.specularIntensityMap,t.specularIntensityMapTransform))}(t,i,s)):i.isMeshMatcapMaterial?(r(t,i),function(t,e){e.matcap&&(t.matcap.value=e.matcap)}(t,i)):i.isMeshDepthMaterial?r(t,i):i.isMeshDistanceMaterial?(r(t,i),function(t,n){const r=e.get(n).light;t.referencePosition.value.setFromMatrixPosition(r.matrixWorld),t.nearDistance.value=r.shadow.camera.near,t.farDistance.value=r.shadow.camera.far}(t,i)):i.isMeshNormalMaterial?r(t,i):i.isLineBasicMaterial?(function(t,e){t.diffuse.value.copy(e.color),t.opacity.value=e.opacity,e.map&&(t.map.value=e.map,n(e.map,t.mapTransform))}(t,i),i.isLineDashedMaterial&&function(t,e){t.dashSize.value=e.dashSize,t.totalSize.value=e.dashSize+e.gapSize,t.scale.value=e.scale}(t,i)):i.isPointsMaterial?function(t,e,r,i){t.diffuse.value.copy(e.color),t.opacity.value=e.opacity,t.size.value=e.size*r,t.scale.value=.5*i,e.map&&(t.map.value=e.map,n(e.map,t.uvTransform)),e.alphaMap&&(t.alphaMap.value=e.alphaMap,n(e.alphaMap,t.alphaMapTransform)),e.alphaTest>0&&(t.alphaTest.value=e.alphaTest)}(t,i,o,a):i.isSpriteMaterial?function(t,e){t.diffuse.value.copy(e.color),t.opacity.value=e.opacity,t.rotation.value=e.rotation,e.map&&(t.map.value=e.map,n(e.map,t.mapTransform)),e.alphaMap&&(t.alphaMap.value=e.alphaMap,n(e.alphaMap,t.alphaMapTransform)),e.alphaTest>0&&(t.alphaTest.value=e.alphaTest)}(t,i):i.isShadowMaterial?(t.color.value.copy(i.color),t.opacity.value=i.opacity):i.isShaderMaterial&&(i.uniformsNeedUpdate=!1)}}}function As(t,e,n,r){let i={},o={},a=[];const s=t.getParameter(t.MAX_UNIFORM_BUFFER_BINDINGS);function u(t,e,n,r){const i=t.value,o=e+"_"+n;if(void 0===r[o])return r[o]="number"==typeof i||"boolean"==typeof i?i:i.clone(),!0;{const t=r[o];if("number"==typeof i||"boolean"==typeof i){if(t!==i)return r[o]=i,!0}else if(!1===t.equals(i))return t.copy(i),!0}return!1}function c(t){const e={boundary:0,storage:0};return"number"==typeof t||"boolean"==typeof t?(e.boundary=4,e.storage=4):t.isVector2?(e.boundary=8,e.storage=8):t.isVector3||t.isColor?(e.boundary=16,e.storage=12):t.isVector4?(e.boundary=16,e.storage=16):t.isMatrix3?(e.boundary=48,e.storage=48):t.isMatrix4?(e.boundary=64,e.storage=64):t.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",t),e}function l(e){const n=e.target;n.removeEventListener("dispose",l);const r=a.indexOf(n.__bindingPointIndex);a.splice(r,1),t.deleteBuffer(i[n.id]),delete i[n.id],delete o[n.id]}return{bind:function(t,e){const n=e.program;r.uniformBlockBinding(t,n)},update:function(n,f){let h=i[n.id];void 0===h&&(function(t){const e=t.uniforms;let n=0;for(let t=0,r=e.length;t<r;t++){const r=Array.isArray(e[t])?e[t]:[e[t]];for(let t=0,e=r.length;t<e;t++){const e=r[t],i=Array.isArray(e.value)?e.value:[e.value];for(let t=0,r=i.length;t<r;t++){const r=c(i[t]),o=n%16;0!==o&&16-o<r.boundary&&(n+=16-o),e.__data=new Float32Array(r.storage/Float32Array.BYTES_PER_ELEMENT),e.__offset=n,n+=r.storage}}}const r=n%16;r>0&&(n+=16-r),t.__size=n,t.__cache={}}(n),h=function(e){const n=function(){for(let t=0;t<s;t++)if(-1===a.indexOf(t))return a.push(t),t;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}();e.__bindingPointIndex=n;const r=t.createBuffer(),i=e.__size,o=e.usage;return t.bindBuffer(t.UNIFORM_BUFFER,r),t.bufferData(t.UNIFORM_BUFFER,i,o),t.bindBuffer(t.UNIFORM_BUFFER,null),t.bindBufferBase(t.UNIFORM_BUFFER,n,r),r}(n),i[n.id]=h,n.addEventListener("dispose",l));const p=f.program;r.updateUBOMapping(n,p);const d=e.render.frame;o[n.id]!==d&&(function(e){const n=i[e.id],r=e.uniforms,o=e.__cache;t.bindBuffer(t.UNIFORM_BUFFER,n);for(let e=0,n=r.length;e<n;e++){const n=Array.isArray(r[e])?r[e]:[r[e]];for(let r=0,i=n.length;r<i;r++){const i=n[r];if(!0===u(i,e,r,o)){const e=i.__offset,n=Array.isArray(i.value)?i.value:[i.value];let r=0;for(let o=0;o<n.length;o++){const a=n[o],s=c(a);"number"==typeof a||"boolean"==typeof a?(i.__data[0]=a,t.bufferSubData(t.UNIFORM_BUFFER,e+r,i.__data)):a.isMatrix3?(i.__data[0]=a.elements[0],i.__data[1]=a.elements[1],i.__data[2]=a.elements[2],i.__data[3]=0,i.__data[4]=a.elements[3],i.__data[5]=a.elements[4],i.__data[6]=a.elements[5],i.__data[7]=0,i.__data[8]=a.elements[6],i.__data[9]=a.elements[7],i.__data[10]=a.elements[8],i.__data[11]=0):(a.toArray(i.__data,r),r+=s.storage/Float32Array.BYTES_PER_ELEMENT)}t.bufferSubData(t.UNIFORM_BUFFER,e,i.__data)}}}t.bindBuffer(t.UNIFORM_BUFFER,null)}(n),o[n.id]=d)},dispose:function(){for(const e in i)t.deleteBuffer(i[e]);a=[],i={},o={}}}}class Os{constructor(t,e=25e-5){this.isFogExp2=!0,this.name="",this.color=new kr(t),this.density=e}clone(){return new Os(this.color,this.density)}toJSON(){return{type:"FogExp2",name:this.name,color:this.color.getHex(),density:this.density}}}class Ps{constructor(t,e=1,n=1e3){this.isFog=!0,this.name="",this.color=new kr(t),this.near=e,this.far=n}clone(){return new Ps(this.color,this.near,this.far)}toJSON(){return{type:"Fog",name:this.name,color:this.color.getHex(),near:this.near,far:this.far}}}class Rs extends mr{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new Qn,this.environmentIntensity=1,this.environmentRotation=new Qn,this.overrideMaterial=null,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(t,e){return super.copy(t,e),null!==t.background&&(this.background=t.background.clone()),null!==t.environment&&(this.environment=t.environment.clone()),null!==t.fog&&(this.fog=t.fog.clone()),this.backgroundBlurriness=t.backgroundBlurriness,this.backgroundIntensity=t.backgroundIntensity,this.backgroundRotation.copy(t.backgroundRotation),this.environmentIntensity=t.environmentIntensity,this.environmentRotation.copy(t.environmentRotation),null!==t.overrideMaterial&&(this.overrideMaterial=t.overrideMaterial.clone()),this.matrixAutoUpdate=t.matrixAutoUpdate,this}toJSON(t){const e=super.toJSON(t);return null!==this.fog&&(e.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(e.object.backgroundBlurriness=this.backgroundBlurriness),1!==this.backgroundIntensity&&(e.object.backgroundIntensity=this.backgroundIntensity),e.object.backgroundRotation=this.backgroundRotation.toArray(),1!==this.environmentIntensity&&(e.object.environmentIntensity=this.environmentIntensity),e.object.environmentRotation=this.environmentRotation.toArray(),e}}class ks{constructor(t,e){this.isInterleavedBuffer=!0,this.array=t,this.stride=e,this.count=void 0!==t?t.length/e:0,this.usage=be,this._updateRange={offset:0,count:-1},this.updateRanges=[],this.version=0,this.uuid=Oe()}onUploadCallback(){}set needsUpdate(t){!0===t&&this.version++}get updateRange(){return He("THREE.InterleavedBuffer: updateRange() is deprecated and will be removed in r169. Use addUpdateRange() instead."),this._updateRange}setUsage(t){return this.usage=t,this}addUpdateRange(t,e){this.updateRanges.push({start:t,count:e})}clearUpdateRanges(){this.updateRanges.length=0}copy(t){return this.array=new t.array.constructor(t.array),this.count=t.count,this.stride=t.stride,this.usage=t.usage,this}copyAt(t,e,n){t*=this.stride,n*=e.stride;for(let r=0,i=this.stride;r<i;r++)this.array[t+r]=e.array[n+r];return this}set(t,e=0){return this.array.set(t,e),this}clone(t){void 0===t.arrayBuffers&&(t.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=Oe()),void 0===t.arrayBuffers[this.array.buffer._uuid]&&(t.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const e=new this.array.constructor(t.arrayBuffers[this.array.buffer._uuid]),n=new this.constructor(e,this.stride);return n.setUsage(this.usage),n}onUpload(t){return this.onUploadCallback=t,this}toJSON(t){return void 0===t.arrayBuffers&&(t.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=Oe()),void 0===t.arrayBuffers[this.array.buffer._uuid]&&(t.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const Cs=new hn;class Ns{constructor(t,e,n,r=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=t,this.itemSize=e,this.offset=n,this.normalized=r}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(t){this.data.needsUpdate=t}applyMatrix4(t){for(let e=0,n=this.data.count;e<n;e++)Cs.fromBufferAttribute(this,e),Cs.applyMatrix4(t),this.setXYZ(e,Cs.x,Cs.y,Cs.z);return this}applyNormalMatrix(t){for(let e=0,n=this.count;e<n;e++)Cs.fromBufferAttribute(this,e),Cs.applyNormalMatrix(t),this.setXYZ(e,Cs.x,Cs.y,Cs.z);return this}transformDirection(t){for(let e=0,n=this.count;e<n;e++)Cs.fromBufferAttribute(this,e),Cs.transformDirection(t),this.setXYZ(e,Cs.x,Cs.y,Cs.z);return this}getComponent(t,e){let n=this.array[t*this.data.stride+this.offset+e];return this.normalized&&(n=Ce(n,this.array)),n}setComponent(t,e,n){return this.normalized&&(n=Ne(n,this.array)),this.data.array[t*this.data.stride+this.offset+e]=n,this}setX(t,e){return this.normalized&&(e=Ne(e,this.array)),this.data.array[t*this.data.stride+this.offset]=e,this}setY(t,e){return this.normalized&&(e=Ne(e,this.array)),this.data.array[t*this.data.stride+this.offset+1]=e,this}setZ(t,e){return this.normalized&&(e=Ne(e,this.array)),this.data.array[t*this.data.stride+this.offset+2]=e,this}setW(t,e){return this.normalized&&(e=Ne(e,this.array)),this.data.array[t*this.data.stride+this.offset+3]=e,this}getX(t){let e=this.data.array[t*this.data.stride+this.offset];return this.normalized&&(e=Ce(e,this.array)),e}getY(t){let e=this.data.array[t*this.data.stride+this.offset+1];return this.normalized&&(e=Ce(e,this.array)),e}getZ(t){let e=this.data.array[t*this.data.stride+this.offset+2];return this.normalized&&(e=Ce(e,this.array)),e}getW(t){let e=this.data.array[t*this.data.stride+this.offset+3];return this.normalized&&(e=Ce(e,this.array)),e}setXY(t,e,n){return t=t*this.data.stride+this.offset,this.normalized&&(e=Ne(e,this.array),n=Ne(n,this.array)),this.data.array[t+0]=e,this.data.array[t+1]=n,this}setXYZ(t,e,n,r){return t=t*this.data.stride+this.offset,this.normalized&&(e=Ne(e,this.array),n=Ne(n,this.array),r=Ne(r,this.array)),this.data.array[t+0]=e,this.data.array[t+1]=n,this.data.array[t+2]=r,this}setXYZW(t,e,n,r,i){return t=t*this.data.stride+this.offset,this.normalized&&(e=Ne(e,this.array),n=Ne(n,this.array),r=Ne(r,this.array),i=Ne(i,this.array)),this.data.array[t+0]=e,this.data.array[t+1]=n,this.data.array[t+2]=r,this.data.array[t+3]=i,this}clone(t){if(void 0===t){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const t=[];for(let e=0;e<this.count;e++){const n=e*this.data.stride+this.offset;for(let e=0;e<this.itemSize;e++)t.push(this.data.array[n+e])}return new Gr(new this.array.constructor(t),this.itemSize,this.normalized)}return void 0===t.interleavedBuffers&&(t.interleavedBuffers={}),void 0===t.interleavedBuffers[this.data.uuid]&&(t.interleavedBuffers[this.data.uuid]=this.data.clone(t)),new Ns(t.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(t){if(void 0===t){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const t=[];for(let e=0;e<this.count;e++){const n=e*this.data.stride+this.offset;for(let e=0;e<this.itemSize;e++)t.push(this.data.array[n+e])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}return void 0===t.interleavedBuffers&&(t.interleavedBuffers={}),void 0===t.interleavedBuffers[this.data.uuid]&&(t.interleavedBuffers[this.data.uuid]=this.data.toJSON(t)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}class Ls extends Lr{constructor(t){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new kr(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.rotation=t.rotation,this.sizeAttenuation=t.sizeAttenuation,this.fog=t.fog,this}}let js;const Is=new hn,Bs=new hn,Us=new hn,Ds=new je,Fs=new je,zs=new Vn,Vs=new hn,Gs=new hn,Hs=new hn,Ws=new je,qs=new je,Xs=new je;class Ys extends mr{constructor(t=new Ls){if(super(),this.isSprite=!0,this.type="Sprite",void 0===js){js=new ti;const t=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),e=new ks(t,5);js.setIndex([0,1,2,0,2,3]),js.setAttribute("position",new Ns(e,3,0,!1)),js.setAttribute("uv",new Ns(e,2,3,!1))}this.geometry=js,this.material=t,this.center=new je(.5,.5)}raycast(t,e){null===t.camera&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),Bs.setFromMatrixScale(this.matrixWorld),zs.copy(t.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(t.camera.matrixWorldInverse,this.matrixWorld),Us.setFromMatrixPosition(this.modelViewMatrix),t.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&Bs.multiplyScalar(-Us.z);const n=this.material.rotation;let r,i;0!==n&&(i=Math.cos(n),r=Math.sin(n));const o=this.center;Js(Vs.set(-.5,-.5,0),Us,o,Bs,r,i),Js(Gs.set(.5,-.5,0),Us,o,Bs,r,i),Js(Hs.set(.5,.5,0),Us,o,Bs,r,i),Ws.set(0,0),qs.set(1,0),Xs.set(1,1);let a=t.ray.intersectTriangle(Vs,Gs,Hs,!1,Is);if(null===a&&(Js(Gs.set(-.5,.5,0),Us,o,Bs,r,i),qs.set(0,1),a=t.ray.intersectTriangle(Vs,Hs,Gs,!1,Is),null===a))return;const s=t.ray.origin.distanceTo(Is);s<t.near||s>t.far||e.push({distance:s,point:Is.clone(),uv:Er.getInterpolation(Is,Vs,Gs,Hs,Ws,qs,Xs,new je),face:null,object:this})}copy(t,e){return super.copy(t,e),void 0!==t.center&&this.center.copy(t.center),this.material=t.material,this}}function Js(t,e,n,r,i,o){Ds.subVectors(t,n).addScalar(.5).multiply(r),void 0!==i?(Fs.x=o*Ds.x-i*Ds.y,Fs.y=i*Ds.x+o*Ds.y):Fs.copy(Ds),t.copy(e),t.x+=Fs.x,t.y+=Fs.y,t.applyMatrix4(zs)}const Zs=new hn,Ks=new hn;class Qs extends mr{constructor(){super(),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]},isLOD:{value:!0}}),this.autoUpdate=!0}copy(t){super.copy(t,!1);const e=t.levels;for(let t=0,n=e.length;t<n;t++){const n=e[t];this.addLevel(n.object.clone(),n.distance,n.hysteresis)}return this.autoUpdate=t.autoUpdate,this}addLevel(t,e=0,n=0){e=Math.abs(e);const r=this.levels;let i;for(i=0;i<r.length&&!(e<r[i].distance);i++);return r.splice(i,0,{distance:e,hysteresis:n,object:t}),this.add(t),this}getCurrentLevel(){return this._currentLevel}getObjectForDistance(t){const e=this.levels;if(e.length>0){let n,r;for(n=1,r=e.length;n<r;n++){let r=e[n].distance;if(e[n].object.visible&&(r-=r*e[n].hysteresis),t<r)break}return e[n-1].object}return null}raycast(t,e){if(this.levels.length>0){Zs.setFromMatrixPosition(this.matrixWorld);const n=t.ray.origin.distanceTo(Zs);this.getObjectForDistance(n).raycast(t,e)}}update(t){const e=this.levels;if(e.length>1){Zs.setFromMatrixPosition(t.matrixWorld),Ks.setFromMatrixPosition(this.matrixWorld);const n=Zs.distanceTo(Ks)/t.zoom;let r,i;for(e[0].object.visible=!0,r=1,i=e.length;r<i;r++){let t=e[r].distance;if(e[r].object.visible&&(t-=t*e[r].hysteresis),!(n>=t))break;e[r-1].object.visible=!1,e[r].object.visible=!0}for(this._currentLevel=r-1;r<i;r++)e[r].object.visible=!1}}toJSON(t){const e=super.toJSON(t);!1===this.autoUpdate&&(e.object.autoUpdate=!1),e.object.levels=[];const n=this.levels;for(let t=0,r=n.length;t<r;t++){const r=n[t];e.object.levels.push({object:r.object.uuid,distance:r.distance,hysteresis:r.hysteresis})}return e}}const $s=new hn,tu=new an,eu=new an,nu=new hn,ru=new Vn,iu=new hn,ou=new Nn,au=new Vn,su=new zn;class uu extends gi{constructor(t,e){super(t,e),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode=U,this.bindMatrix=new Vn,this.bindMatrixInverse=new Vn,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){const t=this.geometry;null===this.boundingBox&&(this.boundingBox=new mn),this.boundingBox.makeEmpty();const e=t.getAttribute("position");for(let t=0;t<e.count;t++)this.getVertexPosition(t,iu),this.boundingBox.expandByPoint(iu)}computeBoundingSphere(){const t=this.geometry;null===this.boundingSphere&&(this.boundingSphere=new Nn),this.boundingSphere.makeEmpty();const e=t.getAttribute("position");for(let t=0;t<e.count;t++)this.getVertexPosition(t,iu),this.boundingSphere.expandByPoint(iu)}copy(t,e){return super.copy(t,e),this.bindMode=t.bindMode,this.bindMatrix.copy(t.bindMatrix),this.bindMatrixInverse.copy(t.bindMatrixInverse),this.skeleton=t.skeleton,null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone()),null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),this}raycast(t,e){const n=this.material,r=this.matrixWorld;void 0!==n&&(null===this.boundingSphere&&this.computeBoundingSphere(),ou.copy(this.boundingSphere),ou.applyMatrix4(r),!1!==t.ray.intersectsSphere(ou)&&(au.copy(r).invert(),su.copy(t.ray).applyMatrix4(au),null!==this.boundingBox&&!1===su.intersectsBox(this.boundingBox)||this._computeIntersections(t,e,su)))}getVertexPosition(t,e){return super.getVertexPosition(t,e),this.applyBoneTransform(t,e),e}bind(t,e){this.skeleton=t,void 0===e&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),e=this.matrixWorld),this.bindMatrix.copy(e),this.bindMatrixInverse.copy(e).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const t=new an,e=this.geometry.attributes.skinWeight;for(let n=0,r=e.count;n<r;n++){t.fromBufferAttribute(e,n);const r=1/t.manhattanLength();r!==1/0?t.multiplyScalar(r):t.set(1,0,0,0),e.setXYZW(n,t.x,t.y,t.z,t.w)}}updateMatrixWorld(t){super.updateMatrixWorld(t),this.bindMode===U?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode===D?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}applyBoneTransform(t,e){const n=this.skeleton,r=this.geometry;tu.fromBufferAttribute(r.attributes.skinIndex,t),eu.fromBufferAttribute(r.attributes.skinWeight,t),$s.copy(e).applyMatrix4(this.bindMatrix),e.set(0,0,0);for(let t=0;t<4;t++){const r=eu.getComponent(t);if(0!==r){const i=tu.getComponent(t);ru.multiplyMatrices(n.bones[i].matrixWorld,n.boneInverses[i]),e.addScaledVector(nu.copy($s).applyMatrix4(ru),r)}}return e.applyMatrix4(this.bindMatrixInverse)}}class cu extends mr{constructor(){super(),this.isBone=!0,this.type="Bone"}}class lu extends on{constructor(t=null,e=1,n=1,r,i,o,a,s,u=1003,c=1003,l,f){super(null,o,a,s,u,c,r,i,l,f),this.isDataTexture=!0,this.image={data:t,width:e,height:n},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const fu=new Vn,hu=new Vn;class pu{constructor(t=[],e=[]){this.uuid=Oe(),this.bones=t.slice(0),this.boneInverses=e,this.boneMatrices=null,this.boneTexture=null,this.init()}init(){const t=this.bones,e=this.boneInverses;if(this.boneMatrices=new Float32Array(16*t.length),0===e.length)this.calculateInverses();else if(t.length!==e.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let t=0,e=this.bones.length;t<e;t++)this.boneInverses.push(new Vn)}}calculateInverses(){this.boneInverses.length=0;for(let t=0,e=this.bones.length;t<e;t++){const e=new Vn;this.bones[t]&&e.copy(this.bones[t].matrixWorld).invert(),this.boneInverses.push(e)}}pose(){for(let t=0,e=this.bones.length;t<e;t++){const e=this.bones[t];e&&e.matrixWorld.copy(this.boneInverses[t]).invert()}for(let t=0,e=this.bones.length;t<e;t++){const e=this.bones[t];e&&(e.parent&&e.parent.isBone?(e.matrix.copy(e.parent.matrixWorld).invert(),e.matrix.multiply(e.matrixWorld)):e.matrix.copy(e.matrixWorld),e.matrix.decompose(e.position,e.quaternion,e.scale))}}update(){const t=this.bones,e=this.boneInverses,n=this.boneMatrices,r=this.boneTexture;for(let r=0,i=t.length;r<i;r++){const i=t[r]?t[r].matrixWorld:hu;fu.multiplyMatrices(i,e[r]),fu.toArray(n,16*r)}null!==r&&(r.needsUpdate=!0)}clone(){return new pu(this.bones,this.boneInverses)}computeBoneTexture(){let t=Math.sqrt(4*this.bones.length);t=4*Math.ceil(t/4),t=Math.max(t,4);const e=new Float32Array(t*t*4);e.set(this.boneMatrices);const n=new lu(e,t,t,lt,ot);return n.needsUpdate=!0,this.boneMatrices=e,this.boneTexture=n,this}getBoneByName(t){for(let e=0,n=this.bones.length;e<n;e++){const n=this.bones[e];if(n.name===t)return n}}dispose(){null!==this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(t,e){this.uuid=t.uuid;for(let n=0,r=t.bones.length;n<r;n++){const r=t.bones[n];let i=e[r];void 0===i&&(console.warn("THREE.Skeleton: No bone found with UUID:",r),i=new cu),this.bones.push(i),this.boneInverses.push((new Vn).fromArray(t.boneInverses[n]))}return this.init(),this}toJSON(){const t={metadata:{version:4.6,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};t.uuid=this.uuid;const e=this.bones,n=this.boneInverses;for(let r=0,i=e.length;r<i;r++){const i=e[r];t.bones.push(i.uuid);const o=n[r];t.boneInverses.push(o.toArray())}return t}}class du extends Gr{constructor(t,e,n,r=1){super(t,e,n),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=r}copy(t){return super.copy(t),this.meshPerAttribute=t.meshPerAttribute,this}toJSON(){const t=super.toJSON();return t.meshPerAttribute=this.meshPerAttribute,t.isInstancedBufferAttribute=!0,t}}const mu=new Vn,yu=new Vn,vu=[],gu=new mn,bu=new Vn,_u=new gi,xu=new Nn;class wu extends gi{constructor(t,e,n){super(t,e),this.isInstancedMesh=!0,this.instanceMatrix=new du(new Float32Array(16*n),16),this.instanceColor=null,this.morphTexture=null,this.count=n,this.boundingBox=null,this.boundingSphere=null;for(let t=0;t<n;t++)this.setMatrixAt(t,bu)}computeBoundingBox(){const t=this.geometry,e=this.count;null===this.boundingBox&&(this.boundingBox=new mn),null===t.boundingBox&&t.computeBoundingBox(),this.boundingBox.makeEmpty();for(let n=0;n<e;n++)this.getMatrixAt(n,mu),gu.copy(t.boundingBox).applyMatrix4(mu),this.boundingBox.union(gu)}computeBoundingSphere(){const t=this.geometry,e=this.count;null===this.boundingSphere&&(this.boundingSphere=new Nn),null===t.boundingSphere&&t.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let n=0;n<e;n++)this.getMatrixAt(n,mu),xu.copy(t.boundingSphere).applyMatrix4(mu),this.boundingSphere.union(xu)}copy(t,e){return super.copy(t,e),this.instanceMatrix.copy(t.instanceMatrix),null!==t.morphTexture&&(this.morphTexture=t.morphTexture.clone()),null!==t.instanceColor&&(this.instanceColor=t.instanceColor.clone()),this.count=t.count,null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone()),null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),this}getColorAt(t,e){e.fromArray(this.instanceColor.array,3*t)}getMatrixAt(t,e){e.fromArray(this.instanceMatrix.array,16*t)}getMorphAt(t,e){const n=e.morphTargetInfluences,r=this.morphTexture.source.data.data,i=t*(n.length+1)+1;for(let t=0;t<n.length;t++)n[t]=r[i+t]}raycast(t,e){const n=this.matrixWorld,r=this.count;if(_u.geometry=this.geometry,_u.material=this.material,void 0!==_u.material&&(null===this.boundingSphere&&this.computeBoundingSphere(),xu.copy(this.boundingSphere),xu.applyMatrix4(n),!1!==t.ray.intersectsSphere(xu)))for(let i=0;i<r;i++){this.getMatrixAt(i,mu),yu.multiplyMatrices(n,mu),_u.matrixWorld=yu,_u.raycast(t,vu);for(let t=0,n=vu.length;t<n;t++){const n=vu[t];n.instanceId=i,n.object=this,e.push(n)}vu.length=0}}setColorAt(t,e){null===this.instanceColor&&(this.instanceColor=new du(new Float32Array(3*this.instanceMatrix.count),3)),e.toArray(this.instanceColor.array,3*t)}setMatrixAt(t,e){e.toArray(this.instanceMatrix.array,16*t)}setMorphAt(t,e){const n=e.morphTargetInfluences,r=n.length+1;null===this.morphTexture&&(this.morphTexture=new lu(new Float32Array(r*this.count),r,this.count,pt,ot));const i=this.morphTexture.source.data.data;let o=0;for(let t=0;t<n.length;t++)o+=n[t];const a=this.geometry.morphTargetsRelative?1:1-o,s=r*t;i[s]=a,i.set(n,s+1)}updateMorphTargets(){}dispose(){return this.dispatchEvent({type:"dispose"}),null!==this.morphTexture&&(this.morphTexture.dispose(),this.morphTexture=null),this}}function Su(t,e){return t.z-e.z}function Tu(t,e){return e.z-t.z}class Mu{constructor(){this.index=0,this.pool=[],this.list=[]}push(t,e){const n=this.pool,r=this.list;this.index>=n.length&&n.push({start:-1,count:-1,z:-1});const i=n[this.index];r.push(i),this.index++,i.start=t.start,i.count=t.count,i.z=e}reset(){this.list.length=0,this.index=0}}const Eu="batchId",Au=new Vn,Ou=new Vn,Pu=new Vn,Ru=new Vn,ku=new zi,Cu=new mn,Nu=new Nn,Lu=new hn,ju=new Mu,Iu=new gi,Bu=[];function Uu(t,e,n=0){const r=e.itemSize;if(t.isInterleavedBufferAttribute||t.array.constructor!==e.array.constructor){const i=t.count;for(let o=0;o<i;o++)for(let i=0;i<r;i++)e.setComponent(o+n,i,t.getComponent(o,i))}else e.array.set(t.array,n*r);e.needsUpdate=!0}class Du extends gi{get maxGeometryCount(){return this._maxGeometryCount}constructor(t,e,n=2*e,r){super(new ti,r),this.isBatchedMesh=!0,this.perObjectFrustumCulled=!0,this.sortObjects=!0,this.boundingBox=null,this.boundingSphere=null,this.customSort=null,this._drawRanges=[],this._reservedRanges=[],this._visibility=[],this._active=[],this._bounds=[],this._maxGeometryCount=t,this._maxVertexCount=e,this._maxIndexCount=n,this._geometryInitialized=!1,this._geometryCount=0,this._multiDrawCounts=new Int32Array(t),this._multiDrawStarts=new Int32Array(t),this._multiDrawCount=0,this._visibilityChanged=!0,this._matricesTexture=null,this._initMatricesTexture()}_initMatricesTexture(){let t=Math.sqrt(4*this._maxGeometryCount);t=4*Math.ceil(t/4),t=Math.max(t,4);const e=new Float32Array(t*t*4),n=new lu(e,t,t,lt,ot);this._matricesTexture=n}_initializeGeometry(t){const e=this.geometry,n=this._maxVertexCount,r=this._maxGeometryCount,i=this._maxIndexCount;if(!1===this._geometryInitialized){for(const r in t.attributes){const i=t.getAttribute(r),{array:o,itemSize:a,normalized:s}=i,u=new o.constructor(n*a),c=new Gr(u,a,s);e.setAttribute(r,c)}if(null!==t.getIndex()){const t=n>65536?new Uint32Array(i):new Uint16Array(i);e.setIndex(new Gr(t,1))}const o=r>65536?new Uint32Array(n):new Uint16Array(n);e.setAttribute(Eu,new Gr(o,1)),this._geometryInitialized=!0}}_validateGeometry(t){if(t.getAttribute(Eu))throw new Error(`BatchedMesh: Geometry cannot use attribute "${Eu}"`);const e=this.geometry;if(Boolean(t.getIndex())!==Boolean(e.getIndex()))throw new Error('BatchedMesh: All geometries must consistently have "index".');for(const n in e.attributes){if(n===Eu)continue;if(!t.hasAttribute(n))throw new Error(`BatchedMesh: Added geometry missing "${n}". All geometries must have consistent attributes.`);const r=t.getAttribute(n),i=e.getAttribute(n);if(r.itemSize!==i.itemSize||r.normalized!==i.normalized)throw new Error("BatchedMesh: All attributes must have a consistent itemSize and normalized value.")}}setCustomSort(t){return this.customSort=t,this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new mn);const t=this._geometryCount,e=this.boundingBox,n=this._active;e.makeEmpty();for(let r=0;r<t;r++)!1!==n[r]&&(this.getMatrixAt(r,Au),this.getBoundingBoxAt(r,Cu).applyMatrix4(Au),e.union(Cu))}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new Nn);const t=this._geometryCount,e=this.boundingSphere,n=this._active;e.makeEmpty();for(let r=0;r<t;r++)!1!==n[r]&&(this.getMatrixAt(r,Au),this.getBoundingSphereAt(r,Nu).applyMatrix4(Au),e.union(Nu))}addGeometry(t,e=-1,n=-1){if(this._initializeGeometry(t),this._validateGeometry(t),this._geometryCount>=this._maxGeometryCount)throw new Error("BatchedMesh: Maximum geometry count reached.");const r={vertexStart:-1,vertexCount:-1,indexStart:-1,indexCount:-1};let i=null;const o=this._reservedRanges,a=this._drawRanges,s=this._bounds;0!==this._geometryCount&&(i=o[o.length-1]),r.vertexCount=-1===e?t.getAttribute("position").count:e,r.vertexStart=null===i?0:i.vertexStart+i.vertexCount;const u=t.getIndex(),c=null!==u;if(c&&(r.indexCount=-1===n?u.count:n,r.indexStart=null===i?0:i.indexStart+i.indexCount),-1!==r.indexStart&&r.indexStart+r.indexCount>this._maxIndexCount||r.vertexStart+r.vertexCount>this._maxVertexCount)throw new Error("BatchedMesh: Reserved space request exceeds the maximum buffer size.");const l=this._visibility,f=this._active,h=this._matricesTexture,p=this._matricesTexture.image.data;l.push(!0),f.push(!0);const d=this._geometryCount;this._geometryCount++,Pu.toArray(p,16*d),h.needsUpdate=!0,o.push(r),a.push({start:c?r.indexStart:r.vertexStart,count:-1}),s.push({boxInitialized:!1,box:new mn,sphereInitialized:!1,sphere:new Nn});const m=this.geometry.getAttribute(Eu);for(let t=0;t<r.vertexCount;t++)m.setX(r.vertexStart+t,d);return m.needsUpdate=!0,this.setGeometryAt(d,t),d}setGeometryAt(t,e){if(t>=this._geometryCount)throw new Error("BatchedMesh: Maximum geometry count reached.");this._validateGeometry(e);const n=this.geometry,r=null!==n.getIndex(),i=n.getIndex(),o=e.getIndex(),a=this._reservedRanges[t];if(r&&o.count>a.indexCount||e.attributes.position.count>a.vertexCount)throw new Error("BatchedMesh: Reserved space not large enough for provided geometry.");const s=a.vertexStart,u=a.vertexCount;for(const t in n.attributes){if(t===Eu)continue;const r=e.getAttribute(t),i=n.getAttribute(t);Uu(r,i,s);const o=r.itemSize;for(let t=r.count,e=u;t<e;t++){const e=s+t;for(let t=0;t<o;t++)i.setComponent(e,t,0)}i.needsUpdate=!0,i.addUpdateRange(s*o,u*o)}if(r){const t=a.indexStart;for(let e=0;e<o.count;e++)i.setX(t+e,s+o.getX(e));for(let e=o.count,n=a.indexCount;e<n;e++)i.setX(t+e,s);i.needsUpdate=!0,i.addUpdateRange(t,a.indexCount)}const c=this._bounds[t];null!==e.boundingBox?(c.box.copy(e.boundingBox),c.boxInitialized=!0):c.boxInitialized=!1,null!==e.boundingSphere?(c.sphere.copy(e.boundingSphere),c.sphereInitialized=!0):c.sphereInitialized=!1;const l=this._drawRanges[t],f=e.getAttribute("position");return l.count=r?o.count:f.count,this._visibilityChanged=!0,t}deleteGeometry(t){const e=this._active;return t>=e.length||!1===e[t]||(e[t]=!1,this._visibilityChanged=!0),this}getBoundingBoxAt(t,e){if(!1===this._active[t])return null;const n=this._bounds[t],r=n.box,i=this.geometry;if(!1===n.boxInitialized){r.makeEmpty();const e=i.index,o=i.attributes.position,a=this._drawRanges[t];for(let t=a.start,n=a.start+a.count;t<n;t++){let n=t;e&&(n=e.getX(n)),r.expandByPoint(Lu.fromBufferAttribute(o,n))}n.boxInitialized=!0}return e.copy(r),e}getBoundingSphereAt(t,e){if(!1===this._active[t])return null;const n=this._bounds[t],r=n.sphere,i=this.geometry;if(!1===n.sphereInitialized){r.makeEmpty(),this.getBoundingBoxAt(t,Cu),Cu.getCenter(r.center);const e=i.index,o=i.attributes.position,a=this._drawRanges[t];let s=0;for(let t=a.start,n=a.start+a.count;t<n;t++){let n=t;e&&(n=e.getX(n)),Lu.fromBufferAttribute(o,n),s=Math.max(s,r.center.distanceToSquared(Lu))}r.radius=Math.sqrt(s),n.sphereInitialized=!0}return e.copy(r),e}setMatrixAt(t,e){const n=this._active,r=this._matricesTexture,i=this._matricesTexture.image.data;return t>=this._geometryCount||!1===n[t]||(e.toArray(i,16*t),r.needsUpdate=!0),this}getMatrixAt(t,e){const n=this._active,r=this._matricesTexture.image.data;return t>=this._geometryCount||!1===n[t]?null:e.fromArray(r,16*t)}setVisibleAt(t,e){const n=this._visibility,r=this._active;return t>=this._geometryCount||!1===r[t]||n[t]===e||(n[t]=e,this._visibilityChanged=!0),this}getVisibleAt(t){const e=this._visibility,n=this._active;return!(t>=this._geometryCount||!1===n[t])&&e[t]}raycast(t,e){const n=this._visibility,r=this._active,i=this._drawRanges,o=this._geometryCount,a=this.matrixWorld,s=this.geometry;Iu.material=this.material,Iu.geometry.index=s.index,Iu.geometry.attributes=s.attributes,null===Iu.geometry.boundingBox&&(Iu.geometry.boundingBox=new mn),null===Iu.geometry.boundingSphere&&(Iu.geometry.boundingSphere=new Nn);for(let s=0;s<o;s++){if(!n[s]||!r[s])continue;const o=i[s];Iu.geometry.setDrawRange(o.start,o.count),this.getMatrixAt(s,Iu.matrixWorld).premultiply(a),this.getBoundingBoxAt(s,Iu.geometry.boundingBox),this.getBoundingSphereAt(s,Iu.geometry.boundingSphere),Iu.raycast(t,Bu);for(let t=0,n=Bu.length;t<n;t++){const n=Bu[t];n.object=this,n.batchId=s,e.push(n)}Bu.length=0}Iu.material=null,Iu.geometry.index=null,Iu.geometry.attributes={},Iu.geometry.setDrawRange(0,1/0)}copy(t){return super.copy(t),this.geometry=t.geometry.clone(),this.perObjectFrustumCulled=t.perObjectFrustumCulled,this.sortObjects=t.sortObjects,this.boundingBox=null!==t.boundingBox?t.boundingBox.clone():null,this.boundingSphere=null!==t.boundingSphere?t.boundingSphere.clone():null,this._drawRanges=t._drawRanges.map((t=>({...t}))),this._reservedRanges=t._reservedRanges.map((t=>({...t}))),this._visibility=t._visibility.slice(),this._active=t._active.slice(),this._bounds=t._bounds.map((t=>({boxInitialized:t.boxInitialized,box:t.box.clone(),sphereInitialized:t.sphereInitialized,sphere:t.sphere.clone()}))),this._maxGeometryCount=t._maxGeometryCount,this._maxVertexCount=t._maxVertexCount,this._maxIndexCount=t._maxIndexCount,this._geometryInitialized=t._geometryInitialized,this._geometryCount=t._geometryCount,this._multiDrawCounts=t._multiDrawCounts.slice(),this._multiDrawStarts=t._multiDrawStarts.slice(),this._matricesTexture=t._matricesTexture.clone(),this._matricesTexture.image.data=this._matricesTexture.image.slice(),this}dispose(){return this.geometry.dispose(),this._matricesTexture.dispose(),this._matricesTexture=null,this}onBeforeRender(t,e,n,r,i){if(!this._visibilityChanged&&!this.perObjectFrustumCulled&&!this.sortObjects)return;const o=r.getIndex(),a=null===o?1:o.array.BYTES_PER_ELEMENT,s=this._active,u=this._visibility,c=this._multiDrawStarts,l=this._multiDrawCounts,f=this._drawRanges,h=this.perObjectFrustumCulled;h&&(Ru.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse).multiply(this.matrixWorld),ku.setFromProjectionMatrix(Ru,t.coordinateSystem));let p=0;if(this.sortObjects){Ou.copy(this.matrixWorld).invert(),Lu.setFromMatrixPosition(n.matrixWorld).applyMatrix4(Ou);for(let t=0,e=u.length;t<e;t++)if(u[t]&&s[t]){this.getMatrixAt(t,Au),this.getBoundingSphereAt(t,Nu).applyMatrix4(Au);let e=!1;if(h&&(e=!ku.intersectsSphere(Nu)),!e){const e=Lu.distanceTo(Nu.center);ju.push(f[t],e)}}const t=ju.list,e=this.customSort;null===e?t.sort(i.transparent?Tu:Su):e.call(this,t,n);for(let e=0,n=t.length;e<n;e++){const n=t[e];c[p]=n.start*a,l[p]=n.count,p++}ju.reset()}else for(let t=0,e=u.length;t<e;t++)if(u[t]&&s[t]){let e=!1;if(h&&(this.getMatrixAt(t,Au),this.getBoundingSphereAt(t,Nu).applyMatrix4(Au),e=!ku.intersectsSphere(Nu)),!e){const e=f[t];c[p]=e.start*a,l[p]=e.count,p++}}this._multiDrawCount=p,this._visibilityChanged=!1}onBeforeShadow(t,e,n,r,i,o){this.onBeforeRender(t,null,r,i,o)}}class Fu extends Lr{constructor(t){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new kr(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.linewidth=t.linewidth,this.linecap=t.linecap,this.linejoin=t.linejoin,this.fog=t.fog,this}}const zu=new hn,Vu=new hn,Gu=new Vn,Hu=new zn,Wu=new Nn;class qu extends mr{constructor(t=new ti,e=new Fu){super(),this.isLine=!0,this.type="Line",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t,e){return super.copy(t,e),this.material=Array.isArray(t.material)?t.material.slice():t.material,this.geometry=t.geometry,this}computeLineDistances(){const t=this.geometry;if(null===t.index){const e=t.attributes.position,n=[0];for(let t=1,r=e.count;t<r;t++)zu.fromBufferAttribute(e,t-1),Vu.fromBufferAttribute(e,t),n[t]=n[t-1],n[t]+=zu.distanceTo(Vu);t.setAttribute("lineDistance",new qr(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(t,e){const n=this.geometry,r=this.matrixWorld,i=t.params.Line.threshold,o=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),Wu.copy(n.boundingSphere),Wu.applyMatrix4(r),Wu.radius+=i,!1===t.ray.intersectsSphere(Wu))return;Gu.copy(r).invert(),Hu.copy(t.ray).applyMatrix4(Gu);const a=i/((this.scale.x+this.scale.y+this.scale.z)/3),s=a*a,u=new hn,c=new hn,l=new hn,f=new hn,h=this.isLineSegments?2:1,p=n.index,d=n.attributes.position;if(null!==p)for(let n=Math.max(0,o.start),r=Math.min(p.count,o.start+o.count)-1;n<r;n+=h){const r=p.getX(n),i=p.getX(n+1);if(u.fromBufferAttribute(d,r),c.fromBufferAttribute(d,i),Hu.distanceSqToSegment(u,c,f,l)>s)continue;f.applyMatrix4(this.matrixWorld);const o=t.ray.origin.distanceTo(f);o<t.near||o>t.far||e.push({distance:o,point:l.clone().applyMatrix4(this.matrixWorld),index:n,face:null,faceIndex:null,object:this})}else for(let n=Math.max(0,o.start),r=Math.min(d.count,o.start+o.count)-1;n<r;n+=h){if(u.fromBufferAttribute(d,n),c.fromBufferAttribute(d,n+1),Hu.distanceSqToSegment(u,c,f,l)>s)continue;f.applyMatrix4(this.matrixWorld);const r=t.ray.origin.distanceTo(f);r<t.near||r>t.far||e.push({distance:r,point:l.clone().applyMatrix4(this.matrixWorld),index:n,face:null,faceIndex:null,object:this})}}updateMorphTargets(){const t=this.geometry.morphAttributes,e=Object.keys(t);if(e.length>0){const n=t[e[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let t=0,e=n.length;t<e;t++){const e=n[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[e]=t}}}}}const Xu=new hn,Yu=new hn;class Ju extends qu{constructor(t,e){super(t,e),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const t=this.geometry;if(null===t.index){const e=t.attributes.position,n=[];for(let t=0,r=e.count;t<r;t+=2)Xu.fromBufferAttribute(e,t),Yu.fromBufferAttribute(e,t+1),n[t]=0===t?0:n[t-1],n[t+1]=n[t]+Xu.distanceTo(Yu);t.setAttribute("lineDistance",new qr(n,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class Zu extends qu{constructor(t,e){super(t,e),this.isLineLoop=!0,this.type="LineLoop"}}class Ku extends Lr{constructor(t){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new kr(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.size=t.size,this.sizeAttenuation=t.sizeAttenuation,this.fog=t.fog,this}}const Qu=new Vn,$u=new zn,tc=new Nn,ec=new hn;class nc extends mr{constructor(t=new ti,e=new Ku){super(),this.isPoints=!0,this.type="Points",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t,e){return super.copy(t,e),this.material=Array.isArray(t.material)?t.material.slice():t.material,this.geometry=t.geometry,this}raycast(t,e){const n=this.geometry,r=this.matrixWorld,i=t.params.Points.threshold,o=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),tc.copy(n.boundingSphere),tc.applyMatrix4(r),tc.radius+=i,!1===t.ray.intersectsSphere(tc))return;Qu.copy(r).invert(),$u.copy(t.ray).applyMatrix4(Qu);const a=i/((this.scale.x+this.scale.y+this.scale.z)/3),s=a*a,u=n.index,c=n.attributes.position;if(null!==u)for(let n=Math.max(0,o.start),i=Math.min(u.count,o.start+o.count);n<i;n++){const i=u.getX(n);ec.fromBufferAttribute(c,i),rc(ec,i,s,r,t,e,this)}else for(let n=Math.max(0,o.start),i=Math.min(c.count,o.start+o.count);n<i;n++)ec.fromBufferAttribute(c,n),rc(ec,n,s,r,t,e,this)}updateMorphTargets(){const t=this.geometry.morphAttributes,e=Object.keys(t);if(e.length>0){const n=t[e[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let t=0,e=n.length;t<e;t++){const e=n[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[e]=t}}}}}function rc(t,e,n,r,i,o,a){const s=$u.distanceSqToPoint(t);if(s<n){const n=new hn;$u.closestPointToPoint(t,n),n.applyMatrix4(r);const u=i.ray.origin.distanceTo(n);if(u<i.near||u>i.far)return;o.push({distance:u,distanceToRay:Math.sqrt(s),point:n,index:e,face:null,object:a})}}class ic extends on{constructor(t,e,n,r,i,o,a,s,u,c,l,f){super(null,o,a,s,u,c,r,i,l,f),this.isCompressedTexture=!0,this.image={width:e,height:n},this.mipmaps=t,this.flipY=!1,this.generateMipmaps=!1}}class oc{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(t,e){const n=this.getUtoTmapping(t);return this.getPoint(n,e)}getPoints(t=5){const e=[];for(let n=0;n<=t;n++)e.push(this.getPoint(n/t));return e}getSpacedPoints(t=5){const e=[];for(let n=0;n<=t;n++)e.push(this.getPointAt(n/t));return e}getLength(){const t=this.getLengths();return t[t.length-1]}getLengths(t=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===t+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const e=[];let n,r=this.getPoint(0),i=0;e.push(0);for(let o=1;o<=t;o++)n=this.getPoint(o/t),i+=n.distanceTo(r),e.push(i),r=n;return this.cacheArcLengths=e,e}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(t,e){const n=this.getLengths();let r=0;const i=n.length;let o;o=e||t*n[i-1];let a,s=0,u=i-1;for(;s<=u;)if(r=Math.floor(s+(u-s)/2),a=n[r]-o,a<0)s=r+1;else{if(!(a>0)){u=r;break}u=r-1}if(r=u,n[r]===o)return r/(i-1);const c=n[r];return(r+(o-c)/(n[r+1]-c))/(i-1)}getTangent(t,e){const n=1e-4;let r=t-n,i=t+n;r<0&&(r=0),i>1&&(i=1);const o=this.getPoint(r),a=this.getPoint(i),s=e||(o.isVector2?new je:new hn);return s.copy(a).sub(o).normalize(),s}getTangentAt(t,e){const n=this.getUtoTmapping(t);return this.getTangent(n,e)}computeFrenetFrames(t,e){const n=new hn,r=[],i=[],o=[],a=new hn,s=new Vn;for(let e=0;e<=t;e++){const n=e/t;r[e]=this.getTangentAt(n,new hn)}i[0]=new hn,o[0]=new hn;let u=Number.MAX_VALUE;const c=Math.abs(r[0].x),l=Math.abs(r[0].y),f=Math.abs(r[0].z);c<=u&&(u=c,n.set(1,0,0)),l<=u&&(u=l,n.set(0,1,0)),f<=u&&n.set(0,0,1),a.crossVectors(r[0],n).normalize(),i[0].crossVectors(r[0],a),o[0].crossVectors(r[0],i[0]);for(let e=1;e<=t;e++){if(i[e]=i[e-1].clone(),o[e]=o[e-1].clone(),a.crossVectors(r[e-1],r[e]),a.length()>Number.EPSILON){a.normalize();const t=Math.acos(Pe(r[e-1].dot(r[e]),-1,1));i[e].applyMatrix4(s.makeRotationAxis(a,t))}o[e].crossVectors(r[e],i[e])}if(!0===e){let e=Math.acos(Pe(i[0].dot(i[t]),-1,1));e/=t,r[0].dot(a.crossVectors(i[0],i[t]))>0&&(e=-e);for(let n=1;n<=t;n++)i[n].applyMatrix4(s.makeRotationAxis(r[n],e*n)),o[n].crossVectors(r[n],i[n])}return{tangents:r,normals:i,binormals:o}}clone(){return(new this.constructor).copy(this)}copy(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}toJSON(){const t={metadata:{version:4.6,type:"Curve",generator:"Curve.toJSON"}};return t.arcLengthDivisions=this.arcLengthDivisions,t.type=this.type,t}fromJSON(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}}class ac extends oc{constructor(t=0,e=0,n=1,r=1,i=0,o=2*Math.PI,a=!1,s=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=t,this.aY=e,this.xRadius=n,this.yRadius=r,this.aStartAngle=i,this.aEndAngle=o,this.aClockwise=a,this.aRotation=s}getPoint(t,e=new je){const n=e,r=2*Math.PI;let i=this.aEndAngle-this.aStartAngle;const o=Math.abs(i)<Number.EPSILON;for(;i<0;)i+=r;for(;i>r;)i-=r;i<Number.EPSILON&&(i=o?0:r),!0!==this.aClockwise||o||(i===r?i=-r:i-=r);const a=this.aStartAngle+t*i;let s=this.aX+this.xRadius*Math.cos(a),u=this.aY+this.yRadius*Math.sin(a);if(0!==this.aRotation){const t=Math.cos(this.aRotation),e=Math.sin(this.aRotation),n=s-this.aX,r=u-this.aY;s=n*t-r*e+this.aX,u=n*e+r*t+this.aY}return n.set(s,u)}copy(t){return super.copy(t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this}toJSON(){const t=super.toJSON();return t.aX=this.aX,t.aY=this.aY,t.xRadius=this.xRadius,t.yRadius=this.yRadius,t.aStartAngle=this.aStartAngle,t.aEndAngle=this.aEndAngle,t.aClockwise=this.aClockwise,t.aRotation=this.aRotation,t}fromJSON(t){return super.fromJSON(t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this}}class sc extends ac{constructor(t,e,n,r,i,o){super(t,e,n,n,r,i,o),this.isArcCurve=!0,this.type="ArcCurve"}}function uc(){let t=0,e=0,n=0,r=0;function i(i,o,a,s){t=i,e=a,n=-3*i+3*o-2*a-s,r=2*i-2*o+a+s}return{initCatmullRom:function(t,e,n,r,o){i(e,n,o*(n-t),o*(r-e))},initNonuniformCatmullRom:function(t,e,n,r,o,a,s){let u=(e-t)/o-(n-t)/(o+a)+(n-e)/a,c=(n-e)/a-(r-e)/(a+s)+(r-n)/s;u*=a,c*=a,i(e,n,u,c)},calc:function(i){const o=i*i;return t+e*i+n*o+r*(o*i)}}}const cc=new hn,lc=new uc,fc=new uc,hc=new uc;class pc extends oc{constructor(t=[],e=!1,n="centripetal",r=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=t,this.closed=e,this.curveType=n,this.tension=r}getPoint(t,e=new hn){const n=e,r=this.points,i=r.length,o=(i-(this.closed?0:1))*t;let a,s,u=Math.floor(o),c=o-u;this.closed?u+=u>0?0:(Math.floor(Math.abs(u)/i)+1)*i:0===c&&u===i-1&&(u=i-2,c=1),this.closed||u>0?a=r[(u-1)%i]:(cc.subVectors(r[0],r[1]).add(r[0]),a=cc);const l=r[u%i],f=r[(u+1)%i];if(this.closed||u+2<i?s=r[(u+2)%i]:(cc.subVectors(r[i-1],r[i-2]).add(r[i-1]),s=cc),"centripetal"===this.curveType||"chordal"===this.curveType){const t="chordal"===this.curveType?.5:.25;let e=Math.pow(a.distanceToSquared(l),t),n=Math.pow(l.distanceToSquared(f),t),r=Math.pow(f.distanceToSquared(s),t);n<1e-4&&(n=1),e<1e-4&&(e=n),r<1e-4&&(r=n),lc.initNonuniformCatmullRom(a.x,l.x,f.x,s.x,e,n,r),fc.initNonuniformCatmullRom(a.y,l.y,f.y,s.y,e,n,r),hc.initNonuniformCatmullRom(a.z,l.z,f.z,s.z,e,n,r)}else"catmullrom"===this.curveType&&(lc.initCatmullRom(a.x,l.x,f.x,s.x,this.tension),fc.initCatmullRom(a.y,l.y,f.y,s.y,this.tension),hc.initCatmullRom(a.z,l.z,f.z,s.z,this.tension));return n.set(lc.calc(c),fc.calc(c),hc.calc(c)),n}copy(t){super.copy(t),this.points=[];for(let e=0,n=t.points.length;e<n;e++){const n=t.points[e];this.points.push(n.clone())}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this}toJSON(){const t=super.toJSON();t.points=[];for(let e=0,n=this.points.length;e<n;e++){const n=this.points[e];t.points.push(n.toArray())}return t.closed=this.closed,t.curveType=this.curveType,t.tension=this.tension,t}fromJSON(t){super.fromJSON(t),this.points=[];for(let e=0,n=t.points.length;e<n;e++){const n=t.points[e];this.points.push((new hn).fromArray(n))}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this}}function dc(t,e,n,r,i){const o=.5*(r-e),a=.5*(i-n),s=t*t;return(2*n-2*r+o+a)*(t*s)+(-3*n+3*r-2*o-a)*s+o*t+n}function mc(t,e,n,r){return function(t,e){const n=1-t;return n*n*e}(t,e)+function(t,e){return 2*(1-t)*t*e}(t,n)+function(t,e){return t*t*e}(t,r)}function yc(t,e,n,r,i){return function(t,e){const n=1-t;return n*n*n*e}(t,e)+function(t,e){const n=1-t;return 3*n*n*t*e}(t,n)+function(t,e){return 3*(1-t)*t*t*e}(t,r)+function(t,e){return t*t*t*e}(t,i)}class vc extends oc{constructor(t=new je,e=new je,n=new je,r=new je){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=t,this.v1=e,this.v2=n,this.v3=r}getPoint(t,e=new je){const n=e,r=this.v0,i=this.v1,o=this.v2,a=this.v3;return n.set(yc(t,r.x,i.x,o.x,a.x),yc(t,r.y,i.y,o.y,a.y)),n}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this}}class gc extends oc{constructor(t=new hn,e=new hn,n=new hn,r=new hn){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=t,this.v1=e,this.v2=n,this.v3=r}getPoint(t,e=new hn){const n=e,r=this.v0,i=this.v1,o=this.v2,a=this.v3;return n.set(yc(t,r.x,i.x,o.x,a.x),yc(t,r.y,i.y,o.y,a.y),yc(t,r.z,i.z,o.z,a.z)),n}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this}}class bc extends oc{constructor(t=new je,e=new je){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=t,this.v2=e}getPoint(t,e=new je){const n=e;return 1===t?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(t).add(this.v1)),n}getPointAt(t,e){return this.getPoint(t,e)}getTangent(t,e=new je){return e.subVectors(this.v2,this.v1).normalize()}getTangentAt(t,e){return this.getTangent(t,e)}copy(t){return super.copy(t),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class _c extends oc{constructor(t=new hn,e=new hn){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=t,this.v2=e}getPoint(t,e=new hn){const n=e;return 1===t?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(t).add(this.v1)),n}getPointAt(t,e){return this.getPoint(t,e)}getTangent(t,e=new hn){return e.subVectors(this.v2,this.v1).normalize()}getTangentAt(t,e){return this.getTangent(t,e)}copy(t){return super.copy(t),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class xc extends oc{constructor(t=new je,e=new je,n=new je){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=t,this.v1=e,this.v2=n}getPoint(t,e=new je){const n=e,r=this.v0,i=this.v1,o=this.v2;return n.set(mc(t,r.x,i.x,o.x),mc(t,r.y,i.y,o.y)),n}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class wc extends oc{constructor(t=new hn,e=new hn,n=new hn){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=t,this.v1=e,this.v2=n}getPoint(t,e=new hn){const n=e,r=this.v0,i=this.v1,o=this.v2;return n.set(mc(t,r.x,i.x,o.x),mc(t,r.y,i.y,o.y),mc(t,r.z,i.z,o.z)),n}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class Sc extends oc{constructor(t=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=t}getPoint(t,e=new je){const n=e,r=this.points,i=(r.length-1)*t,o=Math.floor(i),a=i-o,s=r[0===o?o:o-1],u=r[o],c=r[o>r.length-2?r.length-1:o+1],l=r[o>r.length-3?r.length-1:o+2];return n.set(dc(a,s.x,u.x,c.x,l.x),dc(a,s.y,u.y,c.y,l.y)),n}copy(t){super.copy(t),this.points=[];for(let e=0,n=t.points.length;e<n;e++){const n=t.points[e];this.points.push(n.clone())}return this}toJSON(){const t=super.toJSON();t.points=[];for(let e=0,n=this.points.length;e<n;e++){const n=this.points[e];t.points.push(n.toArray())}return t}fromJSON(t){super.fromJSON(t),this.points=[];for(let e=0,n=t.points.length;e<n;e++){const n=t.points[e];this.points.push((new je).fromArray(n))}return this}}var Tc=Object.freeze({__proto__:null,ArcCurve:sc,CatmullRomCurve3:pc,CubicBezierCurve:vc,CubicBezierCurve3:gc,EllipseCurve:ac,LineCurve:bc,LineCurve3:_c,QuadraticBezierCurve:xc,QuadraticBezierCurve3:wc,SplineCurve:Sc});class Mc extends oc{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(t){this.curves.push(t)}closePath(){const t=this.curves[0].getPoint(0),e=this.curves[this.curves.length-1].getPoint(1);if(!t.equals(e)){const n=!0===t.isVector2?"LineCurve":"LineCurve3";this.curves.push(new Tc[n](e,t))}return this}getPoint(t,e){const n=t*this.getLength(),r=this.getCurveLengths();let i=0;for(;i<r.length;){if(r[i]>=n){const t=r[i]-n,o=this.curves[i],a=o.getLength(),s=0===a?0:1-t/a;return o.getPointAt(s,e)}i++}return null}getLength(){const t=this.getCurveLengths();return t[t.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const t=[];let e=0;for(let n=0,r=this.curves.length;n<r;n++)e+=this.curves[n].getLength(),t.push(e);return this.cacheLengths=t,t}getSpacedPoints(t=40){const e=[];for(let n=0;n<=t;n++)e.push(this.getPoint(n/t));return this.autoClose&&e.push(e[0]),e}getPoints(t=12){const e=[];let n;for(let r=0,i=this.curves;r<i.length;r++){const o=i[r],a=o.isEllipseCurve?2*t:o.isLineCurve||o.isLineCurve3?1:o.isSplineCurve?t*o.points.length:t,s=o.getPoints(a);for(let t=0;t<s.length;t++){const r=s[t];n&&n.equals(r)||(e.push(r),n=r)}}return this.autoClose&&e.length>1&&!e[e.length-1].equals(e[0])&&e.push(e[0]),e}copy(t){super.copy(t),this.curves=[];for(let e=0,n=t.curves.length;e<n;e++){const n=t.curves[e];this.curves.push(n.clone())}return this.autoClose=t.autoClose,this}toJSON(){const t=super.toJSON();t.autoClose=this.autoClose,t.curves=[];for(let e=0,n=this.curves.length;e<n;e++){const n=this.curves[e];t.curves.push(n.toJSON())}return t}fromJSON(t){super.fromJSON(t),this.autoClose=t.autoClose,this.curves=[];for(let e=0,n=t.curves.length;e<n;e++){const n=t.curves[e];this.curves.push((new Tc[n.type]).fromJSON(n))}return this}}class Ec extends Mc{constructor(t){super(),this.type="Path",this.currentPoint=new je,t&&this.setFromPoints(t)}setFromPoints(t){this.moveTo(t[0].x,t[0].y);for(let e=1,n=t.length;e<n;e++)this.lineTo(t[e].x,t[e].y);return this}moveTo(t,e){return this.currentPoint.set(t,e),this}lineTo(t,e){const n=new bc(this.currentPoint.clone(),new je(t,e));return this.curves.push(n),this.currentPoint.set(t,e),this}quadraticCurveTo(t,e,n,r){const i=new xc(this.currentPoint.clone(),new je(t,e),new je(n,r));return this.curves.push(i),this.currentPoint.set(n,r),this}bezierCurveTo(t,e,n,r,i,o){const a=new vc(this.currentPoint.clone(),new je(t,e),new je(n,r),new je(i,o));return this.curves.push(a),this.currentPoint.set(i,o),this}splineThru(t){const e=[this.currentPoint.clone()].concat(t),n=new Sc(e);return this.curves.push(n),this.currentPoint.copy(t[t.length-1]),this}arc(t,e,n,r,i,o){const a=this.currentPoint.x,s=this.currentPoint.y;return this.absarc(t+a,e+s,n,r,i,o),this}absarc(t,e,n,r,i,o){return this.absellipse(t,e,n,n,r,i,o),this}ellipse(t,e,n,r,i,o,a,s){const u=this.currentPoint.x,c=this.currentPoint.y;return this.absellipse(t+u,e+c,n,r,i,o,a,s),this}absellipse(t,e,n,r,i,o,a,s){const u=new ac(t,e,n,r,i,o,a,s);if(this.curves.length>0){const t=u.getPoint(0);t.equals(this.currentPoint)||this.lineTo(t.x,t.y)}this.curves.push(u);const c=u.getPoint(1);return this.currentPoint.copy(c),this}copy(t){return super.copy(t),this.currentPoint.copy(t.currentPoint),this}toJSON(){const t=super.toJSON();return t.currentPoint=this.currentPoint.toArray(),t}fromJSON(t){return super.fromJSON(t),this.currentPoint.fromArray(t.currentPoint),this}}class Ac extends ti{constructor(t=[new je(0,-.5),new je(.5,0),new je(0,.5)],e=12,n=0,r=2*Math.PI){super(),this.type="LatheGeometry",this.parameters={points:t,segments:e,phiStart:n,phiLength:r},e=Math.floor(e),r=Pe(r,0,2*Math.PI);const i=[],o=[],a=[],s=[],u=[],c=1/e,l=new hn,f=new je,h=new hn,p=new hn,d=new hn;let m=0,y=0;for(let e=0;e<=t.length-1;e++)switch(e){case 0:m=t[e+1].x-t[e].x,y=t[e+1].y-t[e].y,h.x=1*y,h.y=-m,h.z=0*y,d.copy(h),h.normalize(),s.push(h.x,h.y,h.z);break;case t.length-1:s.push(d.x,d.y,d.z);break;default:m=t[e+1].x-t[e].x,y=t[e+1].y-t[e].y,h.x=1*y,h.y=-m,h.z=0*y,p.copy(h),h.x+=d.x,h.y+=d.y,h.z+=d.z,h.normalize(),s.push(h.x,h.y,h.z),d.copy(p)}for(let i=0;i<=e;i++){const h=n+i*c*r,p=Math.sin(h),d=Math.cos(h);for(let n=0;n<=t.length-1;n++){l.x=t[n].x*p,l.y=t[n].y,l.z=t[n].x*d,o.push(l.x,l.y,l.z),f.x=i/e,f.y=n/(t.length-1),a.push(f.x,f.y);const r=s[3*n+0]*p,c=s[3*n+1],h=s[3*n+0]*d;u.push(r,c,h)}}for(let n=0;n<e;n++)for(let e=0;e<t.length-1;e++){const r=e+n*t.length,o=r,a=r+t.length,s=r+t.length+1,u=r+1;i.push(o,a,u),i.push(s,u,a)}this.setIndex(i),this.setAttribute("position",new qr(o,3)),this.setAttribute("uv",new qr(a,2)),this.setAttribute("normal",new qr(u,3))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new Ac(t.points,t.segments,t.phiStart,t.phiLength)}}class Oc extends Ac{constructor(t=1,e=1,n=4,r=8){const i=new Ec;i.absarc(0,-e/2,t,1.5*Math.PI,0),i.absarc(0,e/2,t,0,.5*Math.PI),super(i.getPoints(n),r),this.type="CapsuleGeometry",this.parameters={radius:t,length:e,capSegments:n,radialSegments:r}}static fromJSON(t){return new Oc(t.radius,t.length,t.capSegments,t.radialSegments)}}class Pc extends ti{constructor(t=1,e=32,n=0,r=2*Math.PI){super(),this.type="CircleGeometry",this.parameters={radius:t,segments:e,thetaStart:n,thetaLength:r},e=Math.max(3,e);const i=[],o=[],a=[],s=[],u=new hn,c=new je;o.push(0,0,0),a.push(0,0,1),s.push(.5,.5);for(let i=0,l=3;i<=e;i++,l+=3){const f=n+i/e*r;u.x=t*Math.cos(f),u.y=t*Math.sin(f),o.push(u.x,u.y,u.z),a.push(0,0,1),c.x=(o[l]/t+1)/2,c.y=(o[l+1]/t+1)/2,s.push(c.x,c.y)}for(let t=1;t<=e;t++)i.push(t,t+1,0);this.setIndex(i),this.setAttribute("position",new qr(o,3)),this.setAttribute("normal",new qr(a,3)),this.setAttribute("uv",new qr(s,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new Pc(t.radius,t.segments,t.thetaStart,t.thetaLength)}}class Rc extends ti{constructor(t=1,e=1,n=1,r=32,i=1,o=!1,a=0,s=2*Math.PI){super(),this.type="CylinderGeometry",this.parameters={radiusTop:t,radiusBottom:e,height:n,radialSegments:r,heightSegments:i,openEnded:o,thetaStart:a,thetaLength:s};const u=this;r=Math.floor(r),i=Math.floor(i);const c=[],l=[],f=[],h=[];let p=0;const d=[],m=n/2;let y=0;function v(n){const i=p,o=new je,d=new hn;let v=0;const g=!0===n?t:e,b=!0===n?1:-1;for(let t=1;t<=r;t++)l.push(0,m*b,0),f.push(0,b,0),h.push(.5,.5),p++;const _=p;for(let t=0;t<=r;t++){const e=t/r*s+a,n=Math.cos(e),i=Math.sin(e);d.x=g*i,d.y=m*b,d.z=g*n,l.push(d.x,d.y,d.z),f.push(0,b,0),o.x=.5*n+.5,o.y=.5*i*b+.5,h.push(o.x,o.y),p++}for(let t=0;t<r;t++){const e=i+t,r=_+t;!0===n?c.push(r,r+1,e):c.push(r+1,r,e),v+=3}u.addGroup(y,v,!0===n?1:2),y+=v}!function(){const o=new hn,v=new hn;let g=0;const b=(e-t)/n;for(let u=0;u<=i;u++){const c=[],y=u/i,g=y*(e-t)+t;for(let t=0;t<=r;t++){const e=t/r,i=e*s+a,u=Math.sin(i),d=Math.cos(i);v.x=g*u,v.y=-y*n+m,v.z=g*d,l.push(v.x,v.y,v.z),o.set(u,b,d).normalize(),f.push(o.x,o.y,o.z),h.push(e,1-y),c.push(p++)}d.push(c)}for(let t=0;t<r;t++)for(let e=0;e<i;e++){const n=d[e][t],r=d[e+1][t],i=d[e+1][t+1],o=d[e][t+1];c.push(n,r,o),c.push(r,i,o),g+=6}u.addGroup(y,g,0),y+=g}(),!1===o&&(t>0&&v(!0),e>0&&v(!1)),this.setIndex(c),this.setAttribute("position",new qr(l,3)),this.setAttribute("normal",new qr(f,3)),this.setAttribute("uv",new qr(h,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new Rc(t.radiusTop,t.radiusBottom,t.height,t.radialSegments,t.heightSegments,t.openEnded,t.thetaStart,t.thetaLength)}}class kc extends Rc{constructor(t=1,e=1,n=32,r=1,i=!1,o=0,a=2*Math.PI){super(0,t,e,n,r,i,o,a),this.type="ConeGeometry",this.parameters={radius:t,height:e,radialSegments:n,heightSegments:r,openEnded:i,thetaStart:o,thetaLength:a}}static fromJSON(t){return new kc(t.radius,t.height,t.radialSegments,t.heightSegments,t.openEnded,t.thetaStart,t.thetaLength)}}class Cc extends ti{constructor(t=[],e=[],n=1,r=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:t,indices:e,radius:n,detail:r};const i=[],o=[];function a(t,e,n,r){const i=r+1,o=[];for(let r=0;r<=i;r++){o[r]=[];const a=t.clone().lerp(n,r/i),s=e.clone().lerp(n,r/i),u=i-r;for(let t=0;t<=u;t++)o[r][t]=0===t&&r===i?a:a.clone().lerp(s,t/u)}for(let t=0;t<i;t++)for(let e=0;e<2*(i-t)-1;e++){const n=Math.floor(e/2);e%2==0?(s(o[t][n+1]),s(o[t+1][n]),s(o[t][n])):(s(o[t][n+1]),s(o[t+1][n+1]),s(o[t+1][n]))}}function s(t){i.push(t.x,t.y,t.z)}function u(e,n){const r=3*e;n.x=t[r+0],n.y=t[r+1],n.z=t[r+2]}function c(t,e,n,r){r<0&&1===t.x&&(o[e]=t.x-1),0===n.x&&0===n.z&&(o[e]=r/2/Math.PI+.5)}function l(t){return Math.atan2(t.z,-t.x)}!function(t){const n=new hn,r=new hn,i=new hn;for(let o=0;o<e.length;o+=3)u(e[o+0],n),u(e[o+1],r),u(e[o+2],i),a(n,r,i,t)}(r),function(t){const e=new hn;for(let n=0;n<i.length;n+=3)e.x=i[n+0],e.y=i[n+1],e.z=i[n+2],e.normalize().multiplyScalar(t),i[n+0]=e.x,i[n+1]=e.y,i[n+2]=e.z}(n),function(){const t=new hn;for(let n=0;n<i.length;n+=3){t.x=i[n+0],t.y=i[n+1],t.z=i[n+2];const r=l(t)/2/Math.PI+.5,a=(e=t,Math.atan2(-e.y,Math.sqrt(e.x*e.x+e.z*e.z))/Math.PI+.5);o.push(r,1-a)}var e;(function(){const t=new hn,e=new hn,n=new hn,r=new hn,a=new je,s=new je,u=new je;for(let f=0,h=0;f<i.length;f+=9,h+=6){t.set(i[f+0],i[f+1],i[f+2]),e.set(i[f+3],i[f+4],i[f+5]),n.set(i[f+6],i[f+7],i[f+8]),a.set(o[h+0],o[h+1]),s.set(o[h+2],o[h+3]),u.set(o[h+4],o[h+5]),r.copy(t).add(e).add(n).divideScalar(3);const p=l(r);c(a,h+0,t,p),c(s,h+2,e,p),c(u,h+4,n,p)}})(),function(){for(let t=0;t<o.length;t+=6){const e=o[t+0],n=o[t+2],r=o[t+4],i=Math.max(e,n,r),a=Math.min(e,n,r);i>.9&&a<.1&&(e<.2&&(o[t+0]+=1),n<.2&&(o[t+2]+=1),r<.2&&(o[t+4]+=1))}}()}(),this.setAttribute("position",new qr(i,3)),this.setAttribute("normal",new qr(i.slice(),3)),this.setAttribute("uv",new qr(o,2)),0===r?this.computeVertexNormals():this.normalizeNormals()}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new Cc(t.vertices,t.indices,t.radius,t.details)}}class Nc extends Cc{constructor(t=1,e=0){const n=(1+Math.sqrt(5))/2,r=1/n;super([-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-r,-n,0,-r,n,0,r,-n,0,r,n,-r,-n,0,-r,n,0,r,-n,0,r,n,0,-n,0,-r,n,0,-r,-n,0,r,n,0,r],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],t,e),this.type="DodecahedronGeometry",this.parameters={radius:t,detail:e}}static fromJSON(t){return new Nc(t.radius,t.detail)}}const Lc=new hn,jc=new hn,Ic=new hn,Bc=new Er;class Uc extends ti{constructor(t=null,e=1){if(super(),this.type="EdgesGeometry",this.parameters={geometry:t,thresholdAngle:e},null!==t){const n=4,r=Math.pow(10,n),i=Math.cos(Ee*e),o=t.getIndex(),a=t.getAttribute("position"),s=o?o.count:a.count,u=[0,0,0],c=["a","b","c"],l=new Array(3),f={},h=[];for(let t=0;t<s;t+=3){o?(u[0]=o.getX(t),u[1]=o.getX(t+1),u[2]=o.getX(t+2)):(u[0]=t,u[1]=t+1,u[2]=t+2);const{a:e,b:n,c:s}=Bc;if(e.fromBufferAttribute(a,u[0]),n.fromBufferAttribute(a,u[1]),s.fromBufferAttribute(a,u[2]),Bc.getNormal(Ic),l[0]=`${Math.round(e.x*r)},${Math.round(e.y*r)},${Math.round(e.z*r)}`,l[1]=`${Math.round(n.x*r)},${Math.round(n.y*r)},${Math.round(n.z*r)}`,l[2]=`${Math.round(s.x*r)},${Math.round(s.y*r)},${Math.round(s.z*r)}`,l[0]!==l[1]&&l[1]!==l[2]&&l[2]!==l[0])for(let t=0;t<3;t++){const e=(t+1)%3,n=l[t],r=l[e],o=Bc[c[t]],a=Bc[c[e]],s=`${n}_${r}`,p=`${r}_${n}`;p in f&&f[p]?(Ic.dot(f[p].normal)<=i&&(h.push(o.x,o.y,o.z),h.push(a.x,a.y,a.z)),f[p]=null):s in f||(f[s]={index0:u[t],index1:u[e],normal:Ic.clone()})}}for(const t in f)if(f[t]){const{index0:e,index1:n}=f[t];Lc.fromBufferAttribute(a,e),jc.fromBufferAttribute(a,n),h.push(Lc.x,Lc.y,Lc.z),h.push(jc.x,jc.y,jc.z)}this.setAttribute("position",new qr(h,3))}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}}class Dc extends Ec{constructor(t){super(t),this.uuid=Oe(),this.type="Shape",this.holes=[]}getPointsHoles(t){const e=[];for(let n=0,r=this.holes.length;n<r;n++)e[n]=this.holes[n].getPoints(t);return e}extractPoints(t){return{shape:this.getPoints(t),holes:this.getPointsHoles(t)}}copy(t){super.copy(t),this.holes=[];for(let e=0,n=t.holes.length;e<n;e++){const n=t.holes[e];this.holes.push(n.clone())}return this}toJSON(){const t=super.toJSON();t.uuid=this.uuid,t.holes=[];for(let e=0,n=this.holes.length;e<n;e++){const n=this.holes[e];t.holes.push(n.toJSON())}return t}fromJSON(t){super.fromJSON(t),this.uuid=t.uuid,this.holes=[];for(let e=0,n=t.holes.length;e<n;e++){const n=t.holes[e];this.holes.push((new Ec).fromJSON(n))}return this}}function Fc(t,e,n,r,i){let o,a;if(i===function(t,e,n,r){let i=0;for(let o=e,a=n-r;o<n;o+=r)i+=(t[a]-t[o])*(t[o+1]+t[a+1]),a=o;return i}(t,e,n,r)>0)for(o=e;o<n;o+=r)a=sl(o,t[o],t[o+1],a);else for(o=n-r;o>=e;o-=r)a=sl(o,t[o],t[o+1],a);return a&&el(a,a.next)&&(ul(a),a=a.next),a}function zc(t,e){if(!t)return t;e||(e=t);let n,r=t;do{if(n=!1,r.steiner||!el(r,r.next)&&0!==tl(r.prev,r,r.next))r=r.next;else{if(ul(r),r=e=r.prev,r===r.next)break;n=!0}}while(n||r!==e);return e}function Vc(t,e,n,r,i,o,a){if(!t)return;!a&&o&&function(t,e,n,r){let i=t;do{0===i.z&&(i.z=Zc(i.x,i.y,e,n,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==t);i.prevZ.nextZ=null,i.prevZ=null,function(t){let e,n,r,i,o,a,s,u,c=1;do{for(n=t,t=null,o=null,a=0;n;){for(a++,r=n,s=0,e=0;e<c&&(s++,r=r.nextZ,r);e++);for(u=c;s>0||u>0&&r;)0!==s&&(0===u||!r||n.z<=r.z)?(i=n,n=n.nextZ,s--):(i=r,r=r.nextZ,u--),o?o.nextZ=i:t=i,i.prevZ=o,o=i;n=r}o.nextZ=null,c*=2}while(a>1)}(i)}(t,r,i,o);let s,u,c=t;for(;t.prev!==t.next;)if(s=t.prev,u=t.next,o?Hc(t,r,i,o):Gc(t))e.push(s.i/n|0),e.push(t.i/n|0),e.push(u.i/n|0),ul(t),t=u.next,c=u.next;else if((t=u)===c){a?1===a?Vc(t=Wc(zc(t),e,n),e,n,r,i,o,2):2===a&&qc(t,e,n,r,i,o):Vc(zc(t),e,n,r,i,o,1);break}}function Gc(t){const e=t.prev,n=t,r=t.next;if(tl(e,n,r)>=0)return!1;const i=e.x,o=n.x,a=r.x,s=e.y,u=n.y,c=r.y,l=i<o?i<a?i:a:o<a?o:a,f=s<u?s<c?s:c:u<c?u:c,h=i>o?i>a?i:a:o>a?o:a,p=s>u?s>c?s:c:u>c?u:c;let d=r.next;for(;d!==e;){if(d.x>=l&&d.x<=h&&d.y>=f&&d.y<=p&&Qc(i,s,o,u,a,c,d.x,d.y)&&tl(d.prev,d,d.next)>=0)return!1;d=d.next}return!0}function Hc(t,e,n,r){const i=t.prev,o=t,a=t.next;if(tl(i,o,a)>=0)return!1;const s=i.x,u=o.x,c=a.x,l=i.y,f=o.y,h=a.y,p=s<u?s<c?s:c:u<c?u:c,d=l<f?l<h?l:h:f<h?f:h,m=s>u?s>c?s:c:u>c?u:c,y=l>f?l>h?l:h:f>h?f:h,v=Zc(p,d,e,n,r),g=Zc(m,y,e,n,r);let b=t.prevZ,_=t.nextZ;for(;b&&b.z>=v&&_&&_.z<=g;){if(b.x>=p&&b.x<=m&&b.y>=d&&b.y<=y&&b!==i&&b!==a&&Qc(s,l,u,f,c,h,b.x,b.y)&&tl(b.prev,b,b.next)>=0)return!1;if(b=b.prevZ,_.x>=p&&_.x<=m&&_.y>=d&&_.y<=y&&_!==i&&_!==a&&Qc(s,l,u,f,c,h,_.x,_.y)&&tl(_.prev,_,_.next)>=0)return!1;_=_.nextZ}for(;b&&b.z>=v;){if(b.x>=p&&b.x<=m&&b.y>=d&&b.y<=y&&b!==i&&b!==a&&Qc(s,l,u,f,c,h,b.x,b.y)&&tl(b.prev,b,b.next)>=0)return!1;b=b.prevZ}for(;_&&_.z<=g;){if(_.x>=p&&_.x<=m&&_.y>=d&&_.y<=y&&_!==i&&_!==a&&Qc(s,l,u,f,c,h,_.x,_.y)&&tl(_.prev,_,_.next)>=0)return!1;_=_.nextZ}return!0}function Wc(t,e,n){let r=t;do{const i=r.prev,o=r.next.next;!el(i,o)&&nl(i,r,r.next,o)&&ol(i,o)&&ol(o,i)&&(e.push(i.i/n|0),e.push(r.i/n|0),e.push(o.i/n|0),ul(r),ul(r.next),r=t=o),r=r.next}while(r!==t);return zc(r)}function qc(t,e,n,r,i,o){let a=t;do{let t=a.next.next;for(;t!==a.prev;){if(a.i!==t.i&&$c(a,t)){let s=al(a,t);return a=zc(a,a.next),s=zc(s,s.next),Vc(a,e,n,r,i,o,0),void Vc(s,e,n,r,i,o,0)}t=t.next}a=a.next}while(a!==t)}function Xc(t,e){return t.x-e.x}function Yc(t,e){const n=function(t,e){let n,r=e,i=-1/0;const o=t.x,a=t.y;do{if(a<=r.y&&a>=r.next.y&&r.next.y!==r.y){const t=r.x+(a-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(t<=o&&t>i&&(i=t,n=r.x<r.next.x?r:r.next,t===o))return n}r=r.next}while(r!==e);if(!n)return null;const s=n,u=n.x,c=n.y;let l,f=1/0;r=n;do{o>=r.x&&r.x>=u&&o!==r.x&&Qc(a<c?o:i,a,u,c,a<c?i:o,a,r.x,r.y)&&(l=Math.abs(a-r.y)/(o-r.x),ol(r,t)&&(l<f||l===f&&(r.x>n.x||r.x===n.x&&Jc(n,r)))&&(n=r,f=l)),r=r.next}while(r!==s);return n}(t,e);if(!n)return e;const r=al(n,t);return zc(r,r.next),zc(n,n.next)}function Jc(t,e){return tl(t.prev,t,e.prev)<0&&tl(e.next,t,t.next)<0}function Zc(t,e,n,r,i){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-n)*i|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-r)*i|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function Kc(t){let e=t,n=t;do{(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next}while(e!==t);return n}function Qc(t,e,n,r,i,o,a,s){return(i-a)*(e-s)>=(t-a)*(o-s)&&(t-a)*(r-s)>=(n-a)*(e-s)&&(n-a)*(o-s)>=(i-a)*(r-s)}function $c(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){let n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==e.i&&n.next.i!==e.i&&nl(n,n.next,t,e))return!0;n=n.next}while(n!==t);return!1}(t,e)&&(ol(t,e)&&ol(e,t)&&function(t,e){let n=t,r=!1;const i=(t.x+e.x)/2,o=(t.y+e.y)/2;do{n.y>o!=n.next.y>o&&n.next.y!==n.y&&i<(n.next.x-n.x)*(o-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next}while(n!==t);return r}(t,e)&&(tl(t.prev,t,e.prev)||tl(t,e.prev,e))||el(t,e)&&tl(t.prev,t,t.next)>0&&tl(e.prev,e,e.next)>0)}function tl(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function el(t,e){return t.x===e.x&&t.y===e.y}function nl(t,e,n,r){const i=il(tl(t,e,n)),o=il(tl(t,e,r)),a=il(tl(n,r,t)),s=il(tl(n,r,e));return i!==o&&a!==s||!(0!==i||!rl(t,n,e))||!(0!==o||!rl(t,r,e))||!(0!==a||!rl(n,t,r))||!(0!==s||!rl(n,e,r))}function rl(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function il(t){return t>0?1:t<0?-1:0}function ol(t,e){return tl(t.prev,t,t.next)<0?tl(t,e,t.next)>=0&&tl(t,t.prev,e)>=0:tl(t,e,t.prev)<0||tl(t,t.next,e)<0}function al(t,e){const n=new cl(t.i,t.x,t.y),r=new cl(e.i,e.x,e.y),i=t.next,o=e.prev;return t.next=e,e.prev=t,n.next=i,i.prev=n,r.next=n,n.prev=r,o.next=r,r.prev=o,r}function sl(t,e,n,r){const i=new cl(t,e,n);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function ul(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function cl(t,e,n){this.i=t,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}class ll{static area(t){const e=t.length;let n=0;for(let r=e-1,i=0;i<e;r=i++)n+=t[r].x*t[i].y-t[i].x*t[r].y;return.5*n}static isClockWise(t){return ll.area(t)<0}static triangulateShape(t,e){const n=[],r=[],i=[];fl(t),hl(n,t);let o=t.length;e.forEach(fl);for(let t=0;t<e.length;t++)r.push(o),o+=e[t].length,hl(n,e[t]);const a=function(t,e,n=2){const r=e&&e.length,i=r?e[0]*n:t.length;let o=Fc(t,0,i,n,!0);const a=[];if(!o||o.next===o.prev)return a;let s,u,c,l,f,h,p;if(r&&(o=function(t,e,n,r){const i=[];let o,a,s,u,c;for(o=0,a=e.length;o<a;o++)s=e[o]*r,u=o<a-1?e[o+1]*r:t.length,c=Fc(t,s,u,r,!1),c===c.next&&(c.steiner=!0),i.push(Kc(c));for(i.sort(Xc),o=0;o<i.length;o++)n=Yc(i[o],n);return n}(t,e,o,n)),t.length>80*n){s=c=t[0],u=l=t[1];for(let e=n;e<i;e+=n)f=t[e],h=t[e+1],f<s&&(s=f),h<u&&(u=h),f>c&&(c=f),h>l&&(l=h);p=Math.max(c-s,l-u),p=0!==p?32767/p:0}return Vc(o,a,n,s,u,p,0),a}(n,r);for(let t=0;t<a.length;t+=3)i.push(a.slice(t,t+3));return i}}function fl(t){const e=t.length;e>2&&t[e-1].equals(t[0])&&t.pop()}function hl(t,e){for(let n=0;n<e.length;n++)t.push(e[n].x),t.push(e[n].y)}class pl extends ti{constructor(t=new Dc([new je(.5,.5),new je(-.5,.5),new je(-.5,-.5),new je(.5,-.5)]),e={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:t,options:e},t=Array.isArray(t)?t:[t];const n=this,r=[],i=[];for(let e=0,n=t.length;e<n;e++)o(t[e]);function o(t){const o=[],a=void 0!==e.curveSegments?e.curveSegments:12,s=void 0!==e.steps?e.steps:1,u=void 0!==e.depth?e.depth:1;let c=void 0===e.bevelEnabled||e.bevelEnabled,l=void 0!==e.bevelThickness?e.bevelThickness:.2,f=void 0!==e.bevelSize?e.bevelSize:l-.1,h=void 0!==e.bevelOffset?e.bevelOffset:0,p=void 0!==e.bevelSegments?e.bevelSegments:3;const d=e.extrudePath,m=void 0!==e.UVGenerator?e.UVGenerator:dl;let y,v,g,b,_,x=!1;d&&(y=d.getSpacedPoints(s),x=!0,c=!1,v=d.computeFrenetFrames(s,!1),g=new hn,b=new hn,_=new hn),c||(p=0,l=0,f=0,h=0);const w=t.extractPoints(a);let S=w.shape;const T=w.holes;if(!ll.isClockWise(S)){S=S.reverse();for(let t=0,e=T.length;t<e;t++){const e=T[t];ll.isClockWise(e)&&(T[t]=e.reverse())}}const M=ll.triangulateShape(S,T),E=S;for(let t=0,e=T.length;t<e;t++){const e=T[t];S=S.concat(e)}function A(t,e,n){return e||console.error("THREE.ExtrudeGeometry: vec does not exist"),t.clone().addScaledVector(e,n)}const O=S.length,P=M.length;function R(t,e,n){let r,i,o;const a=t.x-e.x,s=t.y-e.y,u=n.x-t.x,c=n.y-t.y,l=a*a+s*s,f=a*c-s*u;if(Math.abs(f)>Number.EPSILON){const f=Math.sqrt(l),h=Math.sqrt(u*u+c*c),p=e.x-s/f,d=e.y+a/f,m=((n.x-c/h-p)*c-(n.y+u/h-d)*u)/(a*c-s*u);r=p+a*m-t.x,i=d+s*m-t.y;const y=r*r+i*i;if(y<=2)return new je(r,i);o=Math.sqrt(y/2)}else{let t=!1;a>Number.EPSILON?u>Number.EPSILON&&(t=!0):a<-Number.EPSILON?u<-Number.EPSILON&&(t=!0):Math.sign(s)===Math.sign(c)&&(t=!0),t?(r=-s,i=a,o=Math.sqrt(l)):(r=a,i=s,o=Math.sqrt(l/2))}return new je(r/o,i/o)}const k=[];for(let t=0,e=E.length,n=e-1,r=t+1;t<e;t++,n++,r++)n===e&&(n=0),r===e&&(r=0),k[t]=R(E[t],E[n],E[r]);const C=[];let N,L=k.concat();for(let t=0,e=T.length;t<e;t++){const e=T[t];N=[];for(let t=0,n=e.length,r=n-1,i=t+1;t<n;t++,r++,i++)r===n&&(r=0),i===n&&(i=0),N[t]=R(e[t],e[r],e[i]);C.push(N),L=L.concat(N)}for(let t=0;t<p;t++){const e=t/p,n=l*Math.cos(e*Math.PI/2),r=f*Math.sin(e*Math.PI/2)+h;for(let t=0,e=E.length;t<e;t++){const e=A(E[t],k[t],r);B(e.x,e.y,-n)}for(let t=0,e=T.length;t<e;t++){const e=T[t];N=C[t];for(let t=0,i=e.length;t<i;t++){const i=A(e[t],N[t],r);B(i.x,i.y,-n)}}}const j=f+h;for(let t=0;t<O;t++){const e=c?A(S[t],L[t],j):S[t];x?(b.copy(v.normals[0]).multiplyScalar(e.x),g.copy(v.binormals[0]).multiplyScalar(e.y),_.copy(y[0]).add(b).add(g),B(_.x,_.y,_.z)):B(e.x,e.y,0)}for(let t=1;t<=s;t++)for(let e=0;e<O;e++){const n=c?A(S[e],L[e],j):S[e];x?(b.copy(v.normals[t]).multiplyScalar(n.x),g.copy(v.binormals[t]).multiplyScalar(n.y),_.copy(y[t]).add(b).add(g),B(_.x,_.y,_.z)):B(n.x,n.y,u/s*t)}for(let t=p-1;t>=0;t--){const e=t/p,n=l*Math.cos(e*Math.PI/2),r=f*Math.sin(e*Math.PI/2)+h;for(let t=0,e=E.length;t<e;t++){const e=A(E[t],k[t],r);B(e.x,e.y,u+n)}for(let t=0,e=T.length;t<e;t++){const e=T[t];N=C[t];for(let t=0,i=e.length;t<i;t++){const i=A(e[t],N[t],r);x?B(i.x,i.y+y[s-1].y,y[s-1].x+n):B(i.x,i.y,u+n)}}}function I(t,e){let n=t.length;for(;--n>=0;){const r=n;let i=n-1;i<0&&(i=t.length-1);for(let t=0,n=s+2*p;t<n;t++){const n=O*t,o=O*(t+1);D(e+r+n,e+i+n,e+i+o,e+r+o)}}}function B(t,e,n){o.push(t),o.push(e),o.push(n)}function U(t,e,i){F(t),F(e),F(i);const o=r.length/3,a=m.generateTopUV(n,r,o-3,o-2,o-1);z(a[0]),z(a[1]),z(a[2])}function D(t,e,i,o){F(t),F(e),F(o),F(e),F(i),F(o);const a=r.length/3,s=m.generateSideWallUV(n,r,a-6,a-3,a-2,a-1);z(s[0]),z(s[1]),z(s[3]),z(s[1]),z(s[2]),z(s[3])}function F(t){r.push(o[3*t+0]),r.push(o[3*t+1]),r.push(o[3*t+2])}function z(t){i.push(t.x),i.push(t.y)}!function(){const t=r.length/3;if(c){let t=0,e=O*t;for(let t=0;t<P;t++){const n=M[t];U(n[2]+e,n[1]+e,n[0]+e)}t=s+2*p,e=O*t;for(let t=0;t<P;t++){const n=M[t];U(n[0]+e,n[1]+e,n[2]+e)}}else{for(let t=0;t<P;t++){const e=M[t];U(e[2],e[1],e[0])}for(let t=0;t<P;t++){const e=M[t];U(e[0]+O*s,e[1]+O*s,e[2]+O*s)}}n.addGroup(t,r.length/3-t,0)}(),function(){const t=r.length/3;let e=0;I(E,e),e+=E.length;for(let t=0,n=T.length;t<n;t++){const n=T[t];I(n,e),e+=n.length}n.addGroup(t,r.length/3-t,1)}()}this.setAttribute("position",new qr(r,3)),this.setAttribute("uv",new qr(i,2)),this.computeVertexNormals()}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}toJSON(){const t=super.toJSON();return function(t,e,n){if(n.shapes=[],Array.isArray(t))for(let e=0,r=t.length;e<r;e++){const r=t[e];n.shapes.push(r.uuid)}else n.shapes.push(t.uuid);return n.options=Object.assign({},e),void 0!==e.extrudePath&&(n.options.extrudePath=e.extrudePath.toJSON()),n}(this.parameters.shapes,this.parameters.options,t)}static fromJSON(t,e){const n=[];for(let r=0,i=t.shapes.length;r<i;r++){const i=e[t.shapes[r]];n.push(i)}const r=t.options.extrudePath;return void 0!==r&&(t.options.extrudePath=(new Tc[r.type]).fromJSON(r)),new pl(n,t.options)}}const dl={generateTopUV:function(t,e,n,r,i){const o=e[3*n],a=e[3*n+1],s=e[3*r],u=e[3*r+1],c=e[3*i],l=e[3*i+1];return[new je(o,a),new je(s,u),new je(c,l)]},generateSideWallUV:function(t,e,n,r,i,o){const a=e[3*n],s=e[3*n+1],u=e[3*n+2],c=e[3*r],l=e[3*r+1],f=e[3*r+2],h=e[3*i],p=e[3*i+1],d=e[3*i+2],m=e[3*o],y=e[3*o+1],v=e[3*o+2];return Math.abs(s-l)<Math.abs(a-c)?[new je(a,1-u),new je(c,1-f),new je(h,1-d),new je(m,1-v)]:[new je(s,1-u),new je(l,1-f),new je(p,1-d),new je(y,1-v)]}};class ml extends Cc{constructor(t=1,e=0){const n=(1+Math.sqrt(5))/2;super([-1,n,0,1,n,0,-1,-n,0,1,-n,0,0,-1,n,0,1,n,0,-1,-n,0,1,-n,n,0,-1,n,0,1,-n,0,-1,-n,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],t,e),this.type="IcosahedronGeometry",this.parameters={radius:t,detail:e}}static fromJSON(t){return new ml(t.radius,t.detail)}}class yl extends Cc{constructor(t=1,e=0){super([1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],t,e),this.type="OctahedronGeometry",this.parameters={radius:t,detail:e}}static fromJSON(t){return new yl(t.radius,t.detail)}}class vl extends ti{constructor(t=.5,e=1,n=32,r=1,i=0,o=2*Math.PI){super(),this.type="RingGeometry",this.parameters={innerRadius:t,outerRadius:e,thetaSegments:n,phiSegments:r,thetaStart:i,thetaLength:o},n=Math.max(3,n);const a=[],s=[],u=[],c=[];let l=t;const f=(e-t)/(r=Math.max(1,r)),h=new hn,p=new je;for(let t=0;t<=r;t++){for(let t=0;t<=n;t++){const r=i+t/n*o;h.x=l*Math.cos(r),h.y=l*Math.sin(r),s.push(h.x,h.y,h.z),u.push(0,0,1),p.x=(h.x/e+1)/2,p.y=(h.y/e+1)/2,c.push(p.x,p.y)}l+=f}for(let t=0;t<r;t++){const e=t*(n+1);for(let t=0;t<n;t++){const r=t+e,i=r,o=r+n+1,s=r+n+2,u=r+1;a.push(i,o,u),a.push(o,s,u)}}this.setIndex(a),this.setAttribute("position",new qr(s,3)),this.setAttribute("normal",new qr(u,3)),this.setAttribute("uv",new qr(c,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new vl(t.innerRadius,t.outerRadius,t.thetaSegments,t.phiSegments,t.thetaStart,t.thetaLength)}}class gl extends ti{constructor(t=new Dc([new je(0,.5),new je(-.5,-.5),new je(.5,-.5)]),e=12){super(),this.type="ShapeGeometry",this.parameters={shapes:t,curveSegments:e};const n=[],r=[],i=[],o=[];let a=0,s=0;if(!1===Array.isArray(t))u(t);else for(let e=0;e<t.length;e++)u(t[e]),this.addGroup(a,s,e),a+=s,s=0;function u(t){const a=r.length/3,u=t.extractPoints(e);let c=u.shape;const l=u.holes;!1===ll.isClockWise(c)&&(c=c.reverse());for(let t=0,e=l.length;t<e;t++){const e=l[t];!0===ll.isClockWise(e)&&(l[t]=e.reverse())}const f=ll.triangulateShape(c,l);for(let t=0,e=l.length;t<e;t++){const e=l[t];c=c.concat(e)}for(let t=0,e=c.length;t<e;t++){const e=c[t];r.push(e.x,e.y,0),i.push(0,0,1),o.push(e.x,e.y)}for(let t=0,e=f.length;t<e;t++){const e=f[t],r=e[0]+a,i=e[1]+a,o=e[2]+a;n.push(r,i,o),s+=3}}this.setIndex(n),this.setAttribute("position",new qr(r,3)),this.setAttribute("normal",new qr(i,3)),this.setAttribute("uv",new qr(o,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}toJSON(){const t=super.toJSON();return function(t,e){if(e.shapes=[],Array.isArray(t))for(let n=0,r=t.length;n<r;n++){const r=t[n];e.shapes.push(r.uuid)}else e.shapes.push(t.uuid);return e}(this.parameters.shapes,t)}static fromJSON(t,e){const n=[];for(let r=0,i=t.shapes.length;r<i;r++){const i=e[t.shapes[r]];n.push(i)}return new gl(n,t.curveSegments)}}class bl extends ti{constructor(t=1,e=32,n=16,r=0,i=2*Math.PI,o=0,a=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:t,widthSegments:e,heightSegments:n,phiStart:r,phiLength:i,thetaStart:o,thetaLength:a},e=Math.max(3,Math.floor(e)),n=Math.max(2,Math.floor(n));const s=Math.min(o+a,Math.PI);let u=0;const c=[],l=new hn,f=new hn,h=[],p=[],d=[],m=[];for(let h=0;h<=n;h++){const y=[],v=h/n;let g=0;0===h&&0===o?g=.5/e:h===n&&s===Math.PI&&(g=-.5/e);for(let n=0;n<=e;n++){const s=n/e;l.x=-t*Math.cos(r+s*i)*Math.sin(o+v*a),l.y=t*Math.cos(o+v*a),l.z=t*Math.sin(r+s*i)*Math.sin(o+v*a),p.push(l.x,l.y,l.z),f.copy(l).normalize(),d.push(f.x,f.y,f.z),m.push(s+g,1-v),y.push(u++)}c.push(y)}for(let t=0;t<n;t++)for(let r=0;r<e;r++){const e=c[t][r+1],i=c[t][r],a=c[t+1][r],u=c[t+1][r+1];(0!==t||o>0)&&h.push(e,i,u),(t!==n-1||s<Math.PI)&&h.push(i,a,u)}this.setIndex(h),this.setAttribute("position",new qr(p,3)),this.setAttribute("normal",new qr(d,3)),this.setAttribute("uv",new qr(m,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new bl(t.radius,t.widthSegments,t.heightSegments,t.phiStart,t.phiLength,t.thetaStart,t.thetaLength)}}class _l extends Cc{constructor(t=1,e=0){super([1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],t,e),this.type="TetrahedronGeometry",this.parameters={radius:t,detail:e}}static fromJSON(t){return new _l(t.radius,t.detail)}}class xl extends ti{constructor(t=1,e=.4,n=12,r=48,i=2*Math.PI){super(),this.type="TorusGeometry",this.parameters={radius:t,tube:e,radialSegments:n,tubularSegments:r,arc:i},n=Math.floor(n),r=Math.floor(r);const o=[],a=[],s=[],u=[],c=new hn,l=new hn,f=new hn;for(let o=0;o<=n;o++)for(let h=0;h<=r;h++){const p=h/r*i,d=o/n*Math.PI*2;l.x=(t+e*Math.cos(d))*Math.cos(p),l.y=(t+e*Math.cos(d))*Math.sin(p),l.z=e*Math.sin(d),a.push(l.x,l.y,l.z),c.x=t*Math.cos(p),c.y=t*Math.sin(p),f.subVectors(l,c).normalize(),s.push(f.x,f.y,f.z),u.push(h/r),u.push(o/n)}for(let t=1;t<=n;t++)for(let e=1;e<=r;e++){const n=(r+1)*t+e-1,i=(r+1)*(t-1)+e-1,a=(r+1)*(t-1)+e,s=(r+1)*t+e;o.push(n,i,s),o.push(i,a,s)}this.setIndex(o),this.setAttribute("position",new qr(a,3)),this.setAttribute("normal",new qr(s,3)),this.setAttribute("uv",new qr(u,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new xl(t.radius,t.tube,t.radialSegments,t.tubularSegments,t.arc)}}class wl extends ti{constructor(t=1,e=.4,n=64,r=8,i=2,o=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:t,tube:e,tubularSegments:n,radialSegments:r,p:i,q:o},n=Math.floor(n),r=Math.floor(r);const a=[],s=[],u=[],c=[],l=new hn,f=new hn,h=new hn,p=new hn,d=new hn,m=new hn,y=new hn;for(let a=0;a<=n;++a){const g=a/n*i*Math.PI*2;v(g,i,o,t,h),v(g+.01,i,o,t,p),m.subVectors(p,h),y.addVectors(p,h),d.crossVectors(m,y),y.crossVectors(d,m),d.normalize(),y.normalize();for(let t=0;t<=r;++t){const i=t/r*Math.PI*2,o=-e*Math.cos(i),p=e*Math.sin(i);l.x=h.x+(o*y.x+p*d.x),l.y=h.y+(o*y.y+p*d.y),l.z=h.z+(o*y.z+p*d.z),s.push(l.x,l.y,l.z),f.subVectors(l,h).normalize(),u.push(f.x,f.y,f.z),c.push(a/n),c.push(t/r)}}for(let t=1;t<=n;t++)for(let e=1;e<=r;e++){const n=(r+1)*(t-1)+(e-1),i=(r+1)*t+(e-1),o=(r+1)*t+e,s=(r+1)*(t-1)+e;a.push(n,i,s),a.push(i,o,s)}function v(t,e,n,r,i){const o=Math.cos(t),a=Math.sin(t),s=n/e*t,u=Math.cos(s);i.x=r*(2+u)*.5*o,i.y=r*(2+u)*a*.5,i.z=r*Math.sin(s)*.5}this.setIndex(a),this.setAttribute("position",new qr(s,3)),this.setAttribute("normal",new qr(u,3)),this.setAttribute("uv",new qr(c,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new wl(t.radius,t.tube,t.tubularSegments,t.radialSegments,t.p,t.q)}}class Sl extends ti{constructor(t=new wc(new hn(-1,-1,0),new hn(-1,1,0),new hn(1,1,0)),e=64,n=1,r=8,i=!1){super(),this.type="TubeGeometry",this.parameters={path:t,tubularSegments:e,radius:n,radialSegments:r,closed:i};const o=t.computeFrenetFrames(e,i);this.tangents=o.tangents,this.normals=o.normals,this.binormals=o.binormals;const a=new hn,s=new hn,u=new je;let c=new hn;const l=[],f=[],h=[],p=[];function d(i){c=t.getPointAt(i/e,c);const u=o.normals[i],h=o.binormals[i];for(let t=0;t<=r;t++){const e=t/r*Math.PI*2,i=Math.sin(e),o=-Math.cos(e);s.x=o*u.x+i*h.x,s.y=o*u.y+i*h.y,s.z=o*u.z+i*h.z,s.normalize(),f.push(s.x,s.y,s.z),a.x=c.x+n*s.x,a.y=c.y+n*s.y,a.z=c.z+n*s.z,l.push(a.x,a.y,a.z)}}!function(){for(let t=0;t<e;t++)d(t);d(!1===i?e:0),function(){for(let t=0;t<=e;t++)for(let n=0;n<=r;n++)u.x=t/e,u.y=n/r,h.push(u.x,u.y)}(),function(){for(let t=1;t<=e;t++)for(let e=1;e<=r;e++){const n=(r+1)*(t-1)+(e-1),i=(r+1)*t+(e-1),o=(r+1)*t+e,a=(r+1)*(t-1)+e;p.push(n,i,a),p.push(i,o,a)}}()}(),this.setIndex(p),this.setAttribute("position",new qr(l,3)),this.setAttribute("normal",new qr(f,3)),this.setAttribute("uv",new qr(h,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}toJSON(){const t=super.toJSON();return t.path=this.parameters.path.toJSON(),t}static fromJSON(t){return new Sl((new Tc[t.path.type]).fromJSON(t.path),t.tubularSegments,t.radius,t.radialSegments,t.closed)}}class Tl extends ti{constructor(t=null){if(super(),this.type="WireframeGeometry",this.parameters={geometry:t},null!==t){const e=[],n=new Set,r=new hn,i=new hn;if(null!==t.index){const o=t.attributes.position,a=t.index;let s=t.groups;0===s.length&&(s=[{start:0,count:a.count,materialIndex:0}]);for(let t=0,u=s.length;t<u;++t){const u=s[t],c=u.start;for(let t=c,s=c+u.count;t<s;t+=3)for(let s=0;s<3;s++){const u=a.getX(t+s),c=a.getX(t+(s+1)%3);r.fromBufferAttribute(o,u),i.fromBufferAttribute(o,c),!0===Ml(r,i,n)&&(e.push(r.x,r.y,r.z),e.push(i.x,i.y,i.z))}}}else{const o=t.attributes.position;for(let t=0,a=o.count/3;t<a;t++)for(let a=0;a<3;a++){const s=3*t+a,u=3*t+(a+1)%3;r.fromBufferAttribute(o,s),i.fromBufferAttribute(o,u),!0===Ml(r,i,n)&&(e.push(r.x,r.y,r.z),e.push(i.x,i.y,i.z))}}this.setAttribute("position",new qr(e,3))}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}}function Ml(t,e,n){const r=`${t.x},${t.y},${t.z}-${e.x},${e.y},${e.z}`,i=`${e.x},${e.y},${e.z}-${t.x},${t.y},${t.z}`;return!0!==n.has(r)&&!0!==n.has(i)&&(n.add(r),n.add(i),!0)}var El=Object.freeze({__proto__:null,BoxGeometry:_i,CapsuleGeometry:Oc,CircleGeometry:Pc,ConeGeometry:kc,CylinderGeometry:Rc,DodecahedronGeometry:Nc,EdgesGeometry:Uc,ExtrudeGeometry:pl,IcosahedronGeometry:ml,LatheGeometry:Ac,OctahedronGeometry:yl,PlaneGeometry:Hi,PolyhedronGeometry:Cc,RingGeometry:vl,ShapeGeometry:gl,SphereGeometry:bl,TetrahedronGeometry:_l,TorusGeometry:xl,TorusKnotGeometry:wl,TubeGeometry:Sl,WireframeGeometry:Tl});class Al extends Lr{constructor(t){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new kr(0),this.transparent=!0,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.fog=t.fog,this}}class Ol extends Mi{constructor(t){super(t),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}}class Pl extends Lr{constructor(t){super(),this.isMeshStandardMaterial=!0,this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new kr(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new kr(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new je(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Qn,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.defines={STANDARD:""},this.color.copy(t.color),this.roughness=t.roughness,this.metalness=t.metalness,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.roughnessMap=t.roughnessMap,this.metalnessMap=t.metalnessMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapRotation.copy(t.envMapRotation),this.envMapIntensity=t.envMapIntensity,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this.fog=t.fog,this}}class Rl extends Pl{constructor(t){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new je(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return Pe(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(t){this.ior=(1+.4*t)/(1-.4*t)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new kr(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new kr(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new kr(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(t)}get anisotropy(){return this._anisotropy}set anisotropy(t){this._anisotropy>0!=t>0&&this.version++,this._anisotropy=t}get clearcoat(){return this._clearcoat}set clearcoat(t){this._clearcoat>0!=t>0&&this.version++,this._clearcoat=t}get iridescence(){return this._iridescence}set iridescence(t){this._iridescence>0!=t>0&&this.version++,this._iridescence=t}get sheen(){return this._sheen}set sheen(t){this._sheen>0!=t>0&&this.version++,this._sheen=t}get transmission(){return this._transmission}set transmission(t){this._transmission>0!=t>0&&this.version++,this._transmission=t}copy(t){return super.copy(t),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=t.anisotropy,this.anisotropyRotation=t.anisotropyRotation,this.anisotropyMap=t.anisotropyMap,this.clearcoat=t.clearcoat,this.clearcoatMap=t.clearcoatMap,this.clearcoatRoughness=t.clearcoatRoughness,this.clearcoatRoughnessMap=t.clearcoatRoughnessMap,this.clearcoatNormalMap=t.clearcoatNormalMap,this.clearcoatNormalScale.copy(t.clearcoatNormalScale),this.ior=t.ior,this.iridescence=t.iridescence,this.iridescenceMap=t.iridescenceMap,this.iridescenceIOR=t.iridescenceIOR,this.iridescenceThicknessRange=[...t.iridescenceThicknessRange],this.iridescenceThicknessMap=t.iridescenceThicknessMap,this.sheen=t.sheen,this.sheenColor.copy(t.sheenColor),this.sheenColorMap=t.sheenColorMap,this.sheenRoughness=t.sheenRoughness,this.sheenRoughnessMap=t.sheenRoughnessMap,this.transmission=t.transmission,this.transmissionMap=t.transmissionMap,this.thickness=t.thickness,this.thicknessMap=t.thicknessMap,this.attenuationDistance=t.attenuationDistance,this.attenuationColor.copy(t.attenuationColor),this.specularIntensity=t.specularIntensity,this.specularIntensityMap=t.specularIntensityMap,this.specularColor.copy(t.specularColor),this.specularColorMap=t.specularColorMap,this}}class kl extends Lr{constructor(t){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new kr(16777215),this.specular=new kr(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new kr(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new je(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Qn,this.combine=A,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.specular.copy(t.specular),this.shininess=t.shininess,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapRotation.copy(t.envMapRotation),this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this.fog=t.fog,this}}class Cl extends Lr{constructor(t){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new kr(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new kr(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new je(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.gradientMap=t.gradientMap,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.fog=t.fog,this}}class Nl extends Lr{constructor(t){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new je(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(t)}copy(t){return super.copy(t),this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.flatShading=t.flatShading,this}}class Ll extends Lr{constructor(t){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new kr(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new kr(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new je(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Qn,this.combine=A,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapRotation.copy(t.envMapRotation),this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this.fog=t.fog,this}}class jl extends Lr{constructor(t){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new kr(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new je(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.defines={MATCAP:""},this.color.copy(t.color),this.matcap=t.matcap,this.map=t.map,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.flatShading=t.flatShading,this.fog=t.fog,this}}class Il extends Fu{constructor(t){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(t)}copy(t){return super.copy(t),this.scale=t.scale,this.dashSize=t.dashSize,this.gapSize=t.gapSize,this}}function Bl(t,e,n){return!t||!n&&t.constructor===e?t:"number"==typeof e.BYTES_PER_ELEMENT?new e(t):Array.prototype.slice.call(t)}function Ul(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function Dl(t){const e=t.length,n=new Array(e);for(let t=0;t!==e;++t)n[t]=t;return n.sort((function(e,n){return t[e]-t[n]})),n}function Fl(t,e,n){const r=t.length,i=new t.constructor(r);for(let o=0,a=0;a!==r;++o){const r=n[o]*e;for(let n=0;n!==e;++n)i[a++]=t[r+n]}return i}function zl(t,e,n,r){let i=1,o=t[0];for(;void 0!==o&&void 0===o[r];)o=t[i++];if(void 0===o)return;let a=o[r];if(void 0!==a)if(Array.isArray(a))do{a=o[r],void 0!==a&&(e.push(o.time),n.push.apply(n,a)),o=t[i++]}while(void 0!==o);else if(void 0!==a.toArray)do{a=o[r],void 0!==a&&(e.push(o.time),a.toArray(n,n.length)),o=t[i++]}while(void 0!==o);else do{a=o[r],void 0!==a&&(e.push(o.time),n.push(a)),o=t[i++]}while(void 0!==o)}const Vl={convertArray:Bl,isTypedArray:Ul,getKeyframeOrder:Dl,sortedArray:Fl,flattenJSON:zl,subclip:function(t,e,n,r,i=30){const o=t.clone();o.name=e;const a=[];for(let t=0;t<o.tracks.length;++t){const e=o.tracks[t],s=e.getValueSize(),u=[],c=[];for(let t=0;t<e.times.length;++t){const o=e.times[t]*i;if(!(o<n||o>=r)){u.push(e.times[t]);for(let n=0;n<s;++n)c.push(e.values[t*s+n])}}0!==u.length&&(e.times=Bl(u,e.times.constructor),e.values=Bl(c,e.values.constructor),a.push(e))}o.tracks=a;let s=1/0;for(let t=0;t<o.tracks.length;++t)s>o.tracks[t].times[0]&&(s=o.tracks[t].times[0]);for(let t=0;t<o.tracks.length;++t)o.tracks[t].shift(-1*s);return o.resetDuration(),o},makeClipAdditive:function(t,e=0,n=t,r=30){r<=0&&(r=30);const i=n.tracks.length,o=e/r;for(let e=0;e<i;++e){const r=n.tracks[e],i=r.ValueTypeName;if("bool"===i||"string"===i)continue;const a=t.tracks.find((function(t){return t.name===r.name&&t.ValueTypeName===i}));if(void 0===a)continue;let s=0;const u=r.getValueSize();r.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(s=u/3);let c=0;const l=a.getValueSize();a.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(c=l/3);const f=r.times.length-1;let h;if(o<=r.times[0]){const t=s,e=u-s;h=r.values.slice(t,e)}else if(o>=r.times[f]){const t=f*u+s,e=t+u-s;h=r.values.slice(t,e)}else{const t=r.createInterpolant(),e=s,n=u-s;t.evaluate(o),h=t.resultBuffer.slice(e,n)}"quaternion"===i&&(new fn).fromArray(h).normalize().conjugate().toArray(h);const p=a.times.length;for(let t=0;t<p;++t){const e=t*l+c;if("quaternion"===i)fn.multiplyQuaternionsFlat(a.values,e,h,0,a.values,e);else{const t=l-2*c;for(let n=0;n<t;++n)a.values[e+n]-=h[n]}}}return t.blendMode=te,t}};class Gl{constructor(t,e,n,r){this.parameterPositions=t,this._cachedIndex=0,this.resultBuffer=void 0!==r?r:new e.constructor(n),this.sampleValues=e,this.valueSize=n,this.settings=null,this.DefaultSettings_={}}evaluate(t){const e=this.parameterPositions;let n=this._cachedIndex,r=e[n],i=e[n-1];t:{e:{let o;n:{r:if(!(t<r)){for(let o=n+2;;){if(void 0===r){if(t<i)break r;return n=e.length,this._cachedIndex=n,this.copySampleValue_(n-1)}if(n===o)break;if(i=r,r=e[++n],t<r)break e}o=e.length;break n}if(t>=i)break t;{const a=e[1];t<a&&(n=2,i=a);for(let o=n-2;;){if(void 0===i)return this._cachedIndex=0,this.copySampleValue_(0);if(n===o)break;if(r=i,i=e[--n-1],t>=i)break e}o=n,n=0}}for(;n<o;){const r=n+o>>>1;t<e[r]?o=r:n=r+1}if(r=e[n],i=e[n-1],void 0===i)return this._cachedIndex=0,this.copySampleValue_(0);if(void 0===r)return n=e.length,this._cachedIndex=n,this.copySampleValue_(n-1)}this._cachedIndex=n,this.intervalChanged_(n,i,r)}return this.interpolate_(n,i,t,r)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(t){const e=this.resultBuffer,n=this.sampleValues,r=this.valueSize,i=t*r;for(let t=0;t!==r;++t)e[t]=n[i+t];return e}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class Hl extends Gl{constructor(t,e,n,r){super(t,e,n,r),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:Kt,endingEnd:Kt}}intervalChanged_(t,e,n){const r=this.parameterPositions;let i=t-2,o=t+1,a=r[i],s=r[o];if(void 0===a)switch(this.getSettings_().endingStart){case Qt:i=t,a=2*e-n;break;case $t:i=r.length-2,a=e+r[i]-r[i+1];break;default:i=t,a=n}if(void 0===s)switch(this.getSettings_().endingEnd){case Qt:o=t,s=2*n-e;break;case $t:o=1,s=n+r[1]-r[0];break;default:o=t-1,s=e}const u=.5*(n-e),c=this.valueSize;this._weightPrev=u/(e-a),this._weightNext=u/(s-n),this._offsetPrev=i*c,this._offsetNext=o*c}interpolate_(t,e,n,r){const i=this.resultBuffer,o=this.sampleValues,a=this.valueSize,s=t*a,u=s-a,c=this._offsetPrev,l=this._offsetNext,f=this._weightPrev,h=this._weightNext,p=(n-e)/(r-e),d=p*p,m=d*p,y=-f*m+2*f*d-f*p,v=(1+f)*m+(-1.5-2*f)*d+(-.5+f)*p+1,g=(-1-h)*m+(1.5+h)*d+.5*p,b=h*m-h*d;for(let t=0;t!==a;++t)i[t]=y*o[c+t]+v*o[u+t]+g*o[s+t]+b*o[l+t];return i}}class Wl extends Gl{constructor(t,e,n,r){super(t,e,n,r)}interpolate_(t,e,n,r){const i=this.resultBuffer,o=this.sampleValues,a=this.valueSize,s=t*a,u=s-a,c=(n-e)/(r-e),l=1-c;for(let t=0;t!==a;++t)i[t]=o[u+t]*l+o[s+t]*c;return i}}class ql extends Gl{constructor(t,e,n,r){super(t,e,n,r)}interpolate_(t){return this.copySampleValue_(t-1)}}class Xl{constructor(t,e,n,r){if(void 0===t)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===e||0===e.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+t);this.name=t,this.times=Bl(e,this.TimeBufferType),this.values=Bl(n,this.ValueBufferType),this.setInterpolation(r||this.DefaultInterpolation)}static toJSON(t){const e=t.constructor;let n;if(e.toJSON!==this.toJSON)n=e.toJSON(t);else{n={name:t.name,times:Bl(t.times,Array),values:Bl(t.values,Array)};const e=t.getInterpolation();e!==t.DefaultInterpolation&&(n.interpolation=e)}return n.type=t.ValueTypeName,n}InterpolantFactoryMethodDiscrete(t){return new ql(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodLinear(t){return new Wl(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodSmooth(t){return new Hl(this.times,this.values,this.getValueSize(),t)}setInterpolation(t){let e;switch(t){case Yt:e=this.InterpolantFactoryMethodDiscrete;break;case Jt:e=this.InterpolantFactoryMethodLinear;break;case Zt:e=this.InterpolantFactoryMethodSmooth}if(void 0===e){const e="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(t===this.DefaultInterpolation)throw new Error(e);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",e),this}return this.createInterpolant=e,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return Yt;case this.InterpolantFactoryMethodLinear:return Jt;case this.InterpolantFactoryMethodSmooth:return Zt}}getValueSize(){return this.values.length/this.times.length}shift(t){if(0!==t){const e=this.times;for(let n=0,r=e.length;n!==r;++n)e[n]+=t}return this}scale(t){if(1!==t){const e=this.times;for(let n=0,r=e.length;n!==r;++n)e[n]*=t}return this}trim(t,e){const n=this.times,r=n.length;let i=0,o=r-1;for(;i!==r&&n[i]<t;)++i;for(;-1!==o&&n[o]>e;)--o;if(++o,0!==i||o!==r){i>=o&&(o=Math.max(o,1),i=o-1);const t=this.getValueSize();this.times=n.slice(i,o),this.values=this.values.slice(i*t,o*t)}return this}validate(){let t=!0;const e=this.getValueSize();e-Math.floor(e)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),t=!1);const n=this.times,r=this.values,i=n.length;0===i&&(console.error("THREE.KeyframeTrack: Track is empty.",this),t=!1);let o=null;for(let e=0;e!==i;e++){const r=n[e];if("number"==typeof r&&isNaN(r)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,e,r),t=!1;break}if(null!==o&&o>r){console.error("THREE.KeyframeTrack: Out of order keys.",this,e,r,o),t=!1;break}o=r}if(void 0!==r&&Ul(r))for(let e=0,n=r.length;e!==n;++e){const n=r[e];if(isNaN(n)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,e,n),t=!1;break}}return t}optimize(){const t=this.times.slice(),e=this.values.slice(),n=this.getValueSize(),r=this.getInterpolation()===Zt,i=t.length-1;let o=1;for(let a=1;a<i;++a){let i=!1;const s=t[a];if(s!==t[a+1]&&(1!==a||s!==t[0]))if(r)i=!0;else{const t=a*n,r=t-n,o=t+n;for(let a=0;a!==n;++a){const n=e[t+a];if(n!==e[r+a]||n!==e[o+a]){i=!0;break}}}if(i){if(a!==o){t[o]=t[a];const r=a*n,i=o*n;for(let t=0;t!==n;++t)e[i+t]=e[r+t]}++o}}if(i>0){t[o]=t[i];for(let t=i*n,r=o*n,a=0;a!==n;++a)e[r+a]=e[t+a];++o}return o!==t.length?(this.times=t.slice(0,o),this.values=e.slice(0,o*n)):(this.times=t,this.values=e),this}clone(){const t=this.times.slice(),e=this.values.slice(),n=new(0,this.constructor)(this.name,t,e);return n.createInterpolant=this.createInterpolant,n}}Xl.prototype.TimeBufferType=Float32Array,Xl.prototype.ValueBufferType=Float32Array,Xl.prototype.DefaultInterpolation=Jt;class Yl extends Xl{}Yl.prototype.ValueTypeName="bool",Yl.prototype.ValueBufferType=Array,Yl.prototype.DefaultInterpolation=Yt,Yl.prototype.InterpolantFactoryMethodLinear=void 0,Yl.prototype.InterpolantFactoryMethodSmooth=void 0;class Jl extends Xl{}Jl.prototype.ValueTypeName="color";class Zl extends Xl{}Zl.prototype.ValueTypeName="number";class Kl extends Gl{constructor(t,e,n,r){super(t,e,n,r)}interpolate_(t,e,n,r){const i=this.resultBuffer,o=this.sampleValues,a=this.valueSize,s=(n-e)/(r-e);let u=t*a;for(let t=u+a;u!==t;u+=4)fn.slerpFlat(i,0,o,u-a,o,u,s);return i}}class Ql extends Xl{InterpolantFactoryMethodLinear(t){return new Kl(this.times,this.values,this.getValueSize(),t)}}Ql.prototype.ValueTypeName="quaternion",Ql.prototype.DefaultInterpolation=Jt,Ql.prototype.InterpolantFactoryMethodSmooth=void 0;class $l extends Xl{}$l.prototype.ValueTypeName="string",$l.prototype.ValueBufferType=Array,$l.prototype.DefaultInterpolation=Yt,$l.prototype.InterpolantFactoryMethodLinear=void 0,$l.prototype.InterpolantFactoryMethodSmooth=void 0;class tf extends Xl{}tf.prototype.ValueTypeName="vector";class ef{constructor(t="",e=-1,n=[],r=2500){this.name=t,this.tracks=n,this.duration=e,this.blendMode=r,this.uuid=Oe(),this.duration<0&&this.resetDuration()}static parse(t){const e=[],n=t.tracks,r=1/(t.fps||1);for(let t=0,i=n.length;t!==i;++t)e.push(nf(n[t]).scale(r));const i=new this(t.name,t.duration,e,t.blendMode);return i.uuid=t.uuid,i}static toJSON(t){const e=[],n=t.tracks,r={name:t.name,duration:t.duration,tracks:e,uuid:t.uuid,blendMode:t.blendMode};for(let t=0,r=n.length;t!==r;++t)e.push(Xl.toJSON(n[t]));return r}static CreateFromMorphTargetSequence(t,e,n,r){const i=e.length,o=[];for(let t=0;t<i;t++){let a=[],s=[];a.push((t+i-1)%i,t,(t+1)%i),s.push(0,1,0);const u=Dl(a);a=Fl(a,1,u),s=Fl(s,1,u),r||0!==a[0]||(a.push(i),s.push(s[0])),o.push(new Zl(".morphTargetInfluences["+e[t].name+"]",a,s).scale(1/n))}return new this(t,-1,o)}static findByName(t,e){let n=t;if(!Array.isArray(t)){const e=t;n=e.geometry&&e.geometry.animations||e.animations}for(let t=0;t<n.length;t++)if(n[t].name===e)return n[t];return null}static CreateClipsFromMorphTargetSequences(t,e,n){const r={},i=/^([\w-]*?)([\d]+)$/;for(let e=0,n=t.length;e<n;e++){const n=t[e],o=n.name.match(i);if(o&&o.length>1){const t=o[1];let e=r[t];e||(r[t]=e=[]),e.push(n)}}const o=[];for(const t in r)o.push(this.CreateFromMorphTargetSequence(t,r[t],e,n));return o}static parseAnimation(t,e){if(!t)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const n=function(t,e,n,r,i){if(0!==n.length){const o=[],a=[];zl(n,o,a,r),0!==o.length&&i.push(new t(e,o,a))}},r=[],i=t.name||"default",o=t.fps||30,a=t.blendMode;let s=t.length||-1;const u=t.hierarchy||[];for(let t=0;t<u.length;t++){const i=u[t].keys;if(i&&0!==i.length)if(i[0].morphTargets){const t={};let e;for(e=0;e<i.length;e++)if(i[e].morphTargets)for(let n=0;n<i[e].morphTargets.length;n++)t[i[e].morphTargets[n]]=-1;for(const n in t){const t=[],o=[];for(let r=0;r!==i[e].morphTargets.length;++r){const r=i[e];t.push(r.time),o.push(r.morphTarget===n?1:0)}r.push(new Zl(".morphTargetInfluence["+n+"]",t,o))}s=t.length*o}else{const o=".bones["+e[t].name+"]";n(tf,o+".position",i,"pos",r),n(Ql,o+".quaternion",i,"rot",r),n(tf,o+".scale",i,"scl",r)}}return 0===r.length?null:new this(i,s,r,a)}resetDuration(){let t=0;for(let e=0,n=this.tracks.length;e!==n;++e){const n=this.tracks[e];t=Math.max(t,n.times[n.times.length-1])}return this.duration=t,this}trim(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].trim(0,this.duration);return this}validate(){let t=!0;for(let e=0;e<this.tracks.length;e++)t=t&&this.tracks[e].validate();return t}optimize(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].optimize();return this}clone(){const t=[];for(let e=0;e<this.tracks.length;e++)t.push(this.tracks[e].clone());return new this.constructor(this.name,this.duration,t,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function nf(t){if(void 0===t.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const e=function(t){switch(t.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return Zl;case"vector":case"vector2":case"vector3":case"vector4":return tf;case"color":return Jl;case"quaternion":return Ql;case"bool":case"boolean":return Yl;case"string":return $l}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+t)}(t.type);if(void 0===t.times){const e=[],n=[];zl(t.keys,e,n,"value"),t.times=e,t.values=n}return void 0!==e.parse?e.parse(t):new e(t.name,t.times,t.values,t.interpolation)}const rf={enabled:!1,files:{},add:function(t,e){!1!==this.enabled&&(this.files[t]=e)},get:function(t){if(!1!==this.enabled)return this.files[t]},remove:function(t){delete this.files[t]},clear:function(){this.files={}}};class of{constructor(t,e,n){const r=this;let i,o=!1,a=0,s=0;const u=[];this.onStart=void 0,this.onLoad=t,this.onProgress=e,this.onError=n,this.itemStart=function(t){s++,!1===o&&void 0!==r.onStart&&r.onStart(t,a,s),o=!0},this.itemEnd=function(t){a++,void 0!==r.onProgress&&r.onProgress(t,a,s),a===s&&(o=!1,void 0!==r.onLoad&&r.onLoad())},this.itemError=function(t){void 0!==r.onError&&r.onError(t)},this.resolveURL=function(t){return i?i(t):t},this.setURLModifier=function(t){return i=t,this},this.addHandler=function(t,e){return u.push(t,e),this},this.removeHandler=function(t){const e=u.indexOf(t);return-1!==e&&u.splice(e,2),this},this.getHandler=function(t){for(let e=0,n=u.length;e<n;e+=2){const n=u[e],r=u[e+1];if(n.global&&(n.lastIndex=0),n.test(t))return r}return null}}}const af=new of;class sf{constructor(t){this.manager=void 0!==t?t:af,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(t,e){const n=this;return new Promise((function(r,i){n.load(t,r,e,i)}))}parse(){}setCrossOrigin(t){return this.crossOrigin=t,this}setWithCredentials(t){return this.withCredentials=t,this}setPath(t){return this.path=t,this}setResourcePath(t){return this.resourcePath=t,this}setRequestHeader(t){return this.requestHeader=t,this}}sf.DEFAULT_MATERIAL_NAME="__DEFAULT";const uf={};class cf extends Error{constructor(t,e){super(t),this.response=e}}class lf extends sf{constructor(t){super(t)}load(t,e,n,r){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const i=rf.get(t);if(void 0!==i)return this.manager.itemStart(t),setTimeout((()=>{e&&e(i),this.manager.itemEnd(t)}),0),i;if(void 0!==uf[t])return void uf[t].push({onLoad:e,onProgress:n,onError:r});uf[t]=[],uf[t].push({onLoad:e,onProgress:n,onError:r});const o=new Request(t,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),a=this.mimeType,s=this.responseType;fetch(o).then((e=>{if(200===e.status||0===e.status){if(0===e.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),"undefined"==typeof ReadableStream||void 0===e.body||void 0===e.body.getReader)return e;const n=uf[t],r=e.body.getReader(),i=e.headers.get("Content-Length")||e.headers.get("X-File-Size"),o=i?parseInt(i):0,a=0!==o;let s=0;const u=new ReadableStream({start(t){!function e(){r.read().then((({done:r,value:i})=>{if(r)t.close();else{s+=i.byteLength;const r=new ProgressEvent("progress",{lengthComputable:a,loaded:s,total:o});for(let t=0,e=n.length;t<e;t++){const e=n[t];e.onProgress&&e.onProgress(r)}t.enqueue(i),e()}}))}()}});return new Response(u)}throw new cf(`fetch for "${e.url}" responded with ${e.status}: ${e.statusText}`,e)})).then((t=>{switch(s){case"arraybuffer":return t.arrayBuffer();case"blob":return t.blob();case"document":return t.text().then((t=>(new DOMParser).parseFromString(t,a)));case"json":return t.json();default:if(void 0===a)return t.text();{const e=/charset="?([^;"\s]*)"?/i.exec(a),n=e&&e[1]?e[1].toLowerCase():void 0,r=new TextDecoder(n);return t.arrayBuffer().then((t=>r.decode(t)))}}})).then((e=>{rf.add(t,e);const n=uf[t];delete uf[t];for(let t=0,r=n.length;t<r;t++){const r=n[t];r.onLoad&&r.onLoad(e)}})).catch((e=>{const n=uf[t];if(void 0===n)throw this.manager.itemError(t),e;delete uf[t];for(let t=0,r=n.length;t<r;t++){const r=n[t];r.onError&&r.onError(e)}this.manager.itemError(t)})).finally((()=>{this.manager.itemEnd(t)})),this.manager.itemStart(t)}setResponseType(t){return this.responseType=t,this}setMimeType(t){return this.mimeType=t,this}}class ff extends sf{constructor(t){super(t)}load(t,e,n,r){void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const i=this,o=rf.get(t);if(void 0!==o)return i.manager.itemStart(t),setTimeout((function(){e&&e(o),i.manager.itemEnd(t)}),0),o;const a=ze("img");function s(){c(),rf.add(t,this),e&&e(this),i.manager.itemEnd(t)}function u(e){c(),r&&r(e),i.manager.itemError(t),i.manager.itemEnd(t)}function c(){a.removeEventListener("load",s,!1),a.removeEventListener("error",u,!1)}return a.addEventListener("load",s,!1),a.addEventListener("error",u,!1),"data:"!==t.slice(0,5)&&void 0!==this.crossOrigin&&(a.crossOrigin=this.crossOrigin),i.manager.itemStart(t),a.src=t,a}}class hf extends mr{constructor(t,e=1){super(),this.isLight=!0,this.type="Light",this.color=new kr(t),this.intensity=e}dispose(){}copy(t,e){return super.copy(t,e),this.color.copy(t.color),this.intensity=t.intensity,this}toJSON(t){const e=super.toJSON(t);return e.object.color=this.color.getHex(),e.object.intensity=this.intensity,void 0!==this.groundColor&&(e.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(e.object.distance=this.distance),void 0!==this.angle&&(e.object.angle=this.angle),void 0!==this.decay&&(e.object.decay=this.decay),void 0!==this.penumbra&&(e.object.penumbra=this.penumbra),void 0!==this.shadow&&(e.object.shadow=this.shadow.toJSON()),e}}class pf extends hf{constructor(t,e,n){super(t,n),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(mr.DEFAULT_UP),this.updateMatrix(),this.groundColor=new kr(e)}copy(t,e){return super.copy(t,e),this.groundColor.copy(t.groundColor),this}}const df=new Vn,mf=new hn,yf=new hn;class vf{constructor(t){this.camera=t,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new je(512,512),this.map=null,this.mapPass=null,this.matrix=new Vn,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new zi,this._frameExtents=new je(1,1),this._viewportCount=1,this._viewports=[new an(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(t){const e=this.camera,n=this.matrix;mf.setFromMatrixPosition(t.matrixWorld),e.position.copy(mf),yf.setFromMatrixPosition(t.target.matrixWorld),e.lookAt(yf),e.updateMatrixWorld(),df.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),this._frustum.setFromProjectionMatrix(df),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(df)}getViewport(t){return this._viewports[t]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(t){return this.camera=t.camera.clone(),this.bias=t.bias,this.radius=t.radius,this.mapSize.copy(t.mapSize),this}clone(){return(new this.constructor).copy(this)}toJSON(){const t={};return 0!==this.bias&&(t.bias=this.bias),0!==this.normalBias&&(t.normalBias=this.normalBias),1!==this.radius&&(t.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(t.mapSize=this.mapSize.toArray()),t.camera=this.camera.toJSON(!1).object,delete t.camera.matrix,t}}class gf extends vf{constructor(){super(new Ri(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(t){const e=this.camera,n=2*Ae*t.angle*this.focus,r=this.mapSize.width/this.mapSize.height,i=t.distance||e.far;n===e.fov&&r===e.aspect&&i===e.far||(e.fov=n,e.aspect=r,e.far=i,e.updateProjectionMatrix()),super.updateMatrices(t)}copy(t){return super.copy(t),this.focus=t.focus,this}}class bf extends hf{constructor(t,e,n=0,r=Math.PI/3,i=0,o=2){super(t,e),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(mr.DEFAULT_UP),this.updateMatrix(),this.target=new mr,this.distance=n,this.angle=r,this.penumbra=i,this.decay=o,this.map=null,this.shadow=new gf}get power(){return this.intensity*Math.PI}set power(t){this.intensity=t/Math.PI}dispose(){this.shadow.dispose()}copy(t,e){return super.copy(t,e),this.distance=t.distance,this.angle=t.angle,this.penumbra=t.penumbra,this.decay=t.decay,this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}const _f=new Vn,xf=new hn,wf=new hn;class Sf extends vf{constructor(){super(new Ri(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new je(4,2),this._viewportCount=6,this._viewports=[new an(2,1,1,1),new an(0,1,1,1),new an(3,1,1,1),new an(1,1,1,1),new an(3,0,1,1),new an(1,0,1,1)],this._cubeDirections=[new hn(1,0,0),new hn(-1,0,0),new hn(0,0,1),new hn(0,0,-1),new hn(0,1,0),new hn(0,-1,0)],this._cubeUps=[new hn(0,1,0),new hn(0,1,0),new hn(0,1,0),new hn(0,1,0),new hn(0,0,1),new hn(0,0,-1)]}updateMatrices(t,e=0){const n=this.camera,r=this.matrix,i=t.distance||n.far;i!==n.far&&(n.far=i,n.updateProjectionMatrix()),xf.setFromMatrixPosition(t.matrixWorld),n.position.copy(xf),wf.copy(n.position),wf.add(this._cubeDirections[e]),n.up.copy(this._cubeUps[e]),n.lookAt(wf),n.updateMatrixWorld(),r.makeTranslation(-xf.x,-xf.y,-xf.z),_f.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(_f)}}class Tf extends hf{constructor(t,e,n=0,r=2){super(t,e),this.isPointLight=!0,this.type="PointLight",this.distance=n,this.decay=r,this.shadow=new Sf}get power(){return 4*this.intensity*Math.PI}set power(t){this.intensity=t/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(t,e){return super.copy(t,e),this.distance=t.distance,this.decay=t.decay,this.shadow=t.shadow.clone(),this}}class Mf extends vf{constructor(){super(new ro(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class Ef extends hf{constructor(t,e){super(t,e),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(mr.DEFAULT_UP),this.updateMatrix(),this.target=new mr,this.shadow=new Mf}dispose(){this.shadow.dispose()}copy(t){return super.copy(t),this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}class Af extends hf{constructor(t,e){super(t,e),this.isAmbientLight=!0,this.type="AmbientLight"}}class Of extends hf{constructor(t,e,n=10,r=10){super(t,e),this.isRectAreaLight=!0,this.type="RectAreaLight",this.width=n,this.height=r}get power(){return this.intensity*this.width*this.height*Math.PI}set power(t){this.intensity=t/(this.width*this.height*Math.PI)}copy(t){return super.copy(t),this.width=t.width,this.height=t.height,this}toJSON(t){const e=super.toJSON(t);return e.object.width=this.width,e.object.height=this.height,e}}class Pf{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let t=0;t<9;t++)this.coefficients.push(new hn)}set(t){for(let e=0;e<9;e++)this.coefficients[e].copy(t[e]);return this}zero(){for(let t=0;t<9;t++)this.coefficients[t].set(0,0,0);return this}getAt(t,e){const n=t.x,r=t.y,i=t.z,o=this.coefficients;return e.copy(o[0]).multiplyScalar(.282095),e.addScaledVector(o[1],.488603*r),e.addScaledVector(o[2],.488603*i),e.addScaledVector(o[3],.488603*n),e.addScaledVector(o[4],n*r*1.092548),e.addScaledVector(o[5],r*i*1.092548),e.addScaledVector(o[6],.315392*(3*i*i-1)),e.addScaledVector(o[7],n*i*1.092548),e.addScaledVector(o[8],.546274*(n*n-r*r)),e}getIrradianceAt(t,e){const n=t.x,r=t.y,i=t.z,o=this.coefficients;return e.copy(o[0]).multiplyScalar(.886227),e.addScaledVector(o[1],1.023328*r),e.addScaledVector(o[2],1.023328*i),e.addScaledVector(o[3],1.023328*n),e.addScaledVector(o[4],.858086*n*r),e.addScaledVector(o[5],.858086*r*i),e.addScaledVector(o[6],.743125*i*i-.247708),e.addScaledVector(o[7],.858086*n*i),e.addScaledVector(o[8],.429043*(n*n-r*r)),e}add(t){for(let e=0;e<9;e++)this.coefficients[e].add(t.coefficients[e]);return this}addScaledSH(t,e){for(let n=0;n<9;n++)this.coefficients[n].addScaledVector(t.coefficients[n],e);return this}scale(t){for(let e=0;e<9;e++)this.coefficients[e].multiplyScalar(t);return this}lerp(t,e){for(let n=0;n<9;n++)this.coefficients[n].lerp(t.coefficients[n],e);return this}equals(t){for(let e=0;e<9;e++)if(!this.coefficients[e].equals(t.coefficients[e]))return!1;return!0}copy(t){return this.set(t.coefficients)}clone(){return(new this.constructor).copy(this)}fromArray(t,e=0){const n=this.coefficients;for(let r=0;r<9;r++)n[r].fromArray(t,e+3*r);return this}toArray(t=[],e=0){const n=this.coefficients;for(let r=0;r<9;r++)n[r].toArray(t,e+3*r);return t}static getBasisAt(t,e){const n=t.x,r=t.y,i=t.z;e[0]=.282095,e[1]=.488603*r,e[2]=.488603*i,e[3]=.488603*n,e[4]=1.092548*n*r,e[5]=1.092548*r*i,e[6]=.315392*(3*i*i-1),e[7]=1.092548*n*i,e[8]=.546274*(n*n-r*r)}}class Rf extends hf{constructor(t=new Pf,e=1){super(void 0,e),this.isLightProbe=!0,this.sh=t}copy(t){return super.copy(t),this.sh.copy(t.sh),this}fromJSON(t){return this.intensity=t.intensity,this.sh.fromArray(t.sh),this}toJSON(t){const e=super.toJSON(t);return e.object.sh=this.sh.toArray(),e}}class kf extends sf{constructor(t){super(t),this.textures={}}load(t,e,n,r){const i=this,o=new lf(i.manager);o.setPath(i.path),o.setRequestHeader(i.requestHeader),o.setWithCredentials(i.withCredentials),o.load(t,(function(n){try{e(i.parse(JSON.parse(n)))}catch(e){r?r(e):console.error(e),i.manager.itemError(t)}}),n,r)}parse(t){const e=this.textures;function n(t){return void 0===e[t]&&console.warn("THREE.MaterialLoader: Undefined texture",t),e[t]}const r=kf.createMaterialFromType(t.type);if(void 0!==t.uuid&&(r.uuid=t.uuid),void 0!==t.name&&(r.name=t.name),void 0!==t.color&&void 0!==r.color&&r.color.setHex(t.color),void 0!==t.roughness&&(r.roughness=t.roughness),void 0!==t.metalness&&(r.metalness=t.metalness),void 0!==t.sheen&&(r.sheen=t.sheen),void 0!==t.sheenColor&&(r.sheenColor=(new kr).setHex(t.sheenColor)),void 0!==t.sheenRoughness&&(r.sheenRoughness=t.sheenRoughness),void 0!==t.emissive&&void 0!==r.emissive&&r.emissive.setHex(t.emissive),void 0!==t.specular&&void 0!==r.specular&&r.specular.setHex(t.specular),void 0!==t.specularIntensity&&(r.specularIntensity=t.specularIntensity),void 0!==t.specularColor&&void 0!==r.specularColor&&r.specularColor.setHex(t.specularColor),void 0!==t.shininess&&(r.shininess=t.shininess),void 0!==t.clearcoat&&(r.clearcoat=t.clearcoat),void 0!==t.clearcoatRoughness&&(r.clearcoatRoughness=t.clearcoatRoughness),void 0!==t.iridescence&&(r.iridescence=t.iridescence),void 0!==t.iridescenceIOR&&(r.iridescenceIOR=t.iridescenceIOR),void 0!==t.iridescenceThicknessRange&&(r.iridescenceThicknessRange=t.iridescenceThicknessRange),void 0!==t.transmission&&(r.transmission=t.transmission),void 0!==t.thickness&&(r.thickness=t.thickness),void 0!==t.attenuationDistance&&(r.attenuationDistance=t.attenuationDistance),void 0!==t.attenuationColor&&void 0!==r.attenuationColor&&r.attenuationColor.setHex(t.attenuationColor),void 0!==t.anisotropy&&(r.anisotropy=t.anisotropy),void 0!==t.anisotropyRotation&&(r.anisotropyRotation=t.anisotropyRotation),void 0!==t.fog&&(r.fog=t.fog),void 0!==t.flatShading&&(r.flatShading=t.flatShading),void 0!==t.blending&&(r.blending=t.blending),void 0!==t.combine&&(r.combine=t.combine),void 0!==t.side&&(r.side=t.side),void 0!==t.shadowSide&&(r.shadowSide=t.shadowSide),void 0!==t.opacity&&(r.opacity=t.opacity),void 0!==t.transparent&&(r.transparent=t.transparent),void 0!==t.alphaTest&&(r.alphaTest=t.alphaTest),void 0!==t.alphaHash&&(r.alphaHash=t.alphaHash),void 0!==t.depthFunc&&(r.depthFunc=t.depthFunc),void 0!==t.depthTest&&(r.depthTest=t.depthTest),void 0!==t.depthWrite&&(r.depthWrite=t.depthWrite),void 0!==t.colorWrite&&(r.colorWrite=t.colorWrite),void 0!==t.blendSrc&&(r.blendSrc=t.blendSrc),void 0!==t.blendDst&&(r.blendDst=t.blendDst),void 0!==t.blendEquation&&(r.blendEquation=t.blendEquation),void 0!==t.blendSrcAlpha&&(r.blendSrcAlpha=t.blendSrcAlpha),void 0!==t.blendDstAlpha&&(r.blendDstAlpha=t.blendDstAlpha),void 0!==t.blendEquationAlpha&&(r.blendEquationAlpha=t.blendEquationAlpha),void 0!==t.blendColor&&void 0!==r.blendColor&&r.blendColor.setHex(t.blendColor),void 0!==t.blendAlpha&&(r.blendAlpha=t.blendAlpha),void 0!==t.stencilWriteMask&&(r.stencilWriteMask=t.stencilWriteMask),void 0!==t.stencilFunc&&(r.stencilFunc=t.stencilFunc),void 0!==t.stencilRef&&(r.stencilRef=t.stencilRef),void 0!==t.stencilFuncMask&&(r.stencilFuncMask=t.stencilFuncMask),void 0!==t.stencilFail&&(r.stencilFail=t.stencilFail),void 0!==t.stencilZFail&&(r.stencilZFail=t.stencilZFail),void 0!==t.stencilZPass&&(r.stencilZPass=t.stencilZPass),void 0!==t.stencilWrite&&(r.stencilWrite=t.stencilWrite),void 0!==t.wireframe&&(r.wireframe=t.wireframe),void 0!==t.wireframeLinewidth&&(r.wireframeLinewidth=t.wireframeLinewidth),void 0!==t.wireframeLinecap&&(r.wireframeLinecap=t.wireframeLinecap),void 0!==t.wireframeLinejoin&&(r.wireframeLinejoin=t.wireframeLinejoin),void 0!==t.rotation&&(r.rotation=t.rotation),void 0!==t.linewidth&&(r.linewidth=t.linewidth),void 0!==t.dashSize&&(r.dashSize=t.dashSize),void 0!==t.gapSize&&(r.gapSize=t.gapSize),void 0!==t.scale&&(r.scale=t.scale),void 0!==t.polygonOffset&&(r.polygonOffset=t.polygonOffset),void 0!==t.polygonOffsetFactor&&(r.polygonOffsetFactor=t.polygonOffsetFactor),void 0!==t.polygonOffsetUnits&&(r.polygonOffsetUnits=t.polygonOffsetUnits),void 0!==t.dithering&&(r.dithering=t.dithering),void 0!==t.alphaToCoverage&&(r.alphaToCoverage=t.alphaToCoverage),void 0!==t.premultipliedAlpha&&(r.premultipliedAlpha=t.premultipliedAlpha),void 0!==t.forceSinglePass&&(r.forceSinglePass=t.forceSinglePass),void 0!==t.visible&&(r.visible=t.visible),void 0!==t.toneMapped&&(r.toneMapped=t.toneMapped),void 0!==t.userData&&(r.userData=t.userData),void 0!==t.vertexColors&&("number"==typeof t.vertexColors?r.vertexColors=t.vertexColors>0:r.vertexColors=t.vertexColors),void 0!==t.uniforms)for(const e in t.uniforms){const i=t.uniforms[e];switch(r.uniforms[e]={},i.type){case"t":r.uniforms[e].value=n(i.value);break;case"c":r.uniforms[e].value=(new kr).setHex(i.value);break;case"v2":r.uniforms[e].value=(new je).fromArray(i.value);break;case"v3":r.uniforms[e].value=(new hn).fromArray(i.value);break;case"v4":r.uniforms[e].value=(new an).fromArray(i.value);break;case"m3":r.uniforms[e].value=(new Ie).fromArray(i.value);break;case"m4":r.uniforms[e].value=(new Vn).fromArray(i.value);break;default:r.uniforms[e].value=i.value}}if(void 0!==t.defines&&(r.defines=t.defines),void 0!==t.vertexShader&&(r.vertexShader=t.vertexShader),void 0!==t.fragmentShader&&(r.fragmentShader=t.fragmentShader),void 0!==t.glslVersion&&(r.glslVersion=t.glslVersion),void 0!==t.extensions)for(const e in t.extensions)r.extensions[e]=t.extensions[e];if(void 0!==t.lights&&(r.lights=t.lights),void 0!==t.clipping&&(r.clipping=t.clipping),void 0!==t.size&&(r.size=t.size),void 0!==t.sizeAttenuation&&(r.sizeAttenuation=t.sizeAttenuation),void 0!==t.map&&(r.map=n(t.map)),void 0!==t.matcap&&(r.matcap=n(t.matcap)),void 0!==t.alphaMap&&(r.alphaMap=n(t.alphaMap)),void 0!==t.bumpMap&&(r.bumpMap=n(t.bumpMap)),void 0!==t.bumpScale&&(r.bumpScale=t.bumpScale),void 0!==t.normalMap&&(r.normalMap=n(t.normalMap)),void 0!==t.normalMapType&&(r.normalMapType=t.normalMapType),void 0!==t.normalScale){let e=t.normalScale;!1===Array.isArray(e)&&(e=[e,e]),r.normalScale=(new je).fromArray(e)}return void 0!==t.displacementMap&&(r.displacementMap=n(t.displacementMap)),void 0!==t.displacementScale&&(r.displacementScale=t.displacementScale),void 0!==t.displacementBias&&(r.displacementBias=t.displacementBias),void 0!==t.roughnessMap&&(r.roughnessMap=n(t.roughnessMap)),void 0!==t.metalnessMap&&(r.metalnessMap=n(t.metalnessMap)),void 0!==t.emissiveMap&&(r.emissiveMap=n(t.emissiveMap)),void 0!==t.emissiveIntensity&&(r.emissiveIntensity=t.emissiveIntensity),void 0!==t.specularMap&&(r.specularMap=n(t.specularMap)),void 0!==t.specularIntensityMap&&(r.specularIntensityMap=n(t.specularIntensityMap)),void 0!==t.specularColorMap&&(r.specularColorMap=n(t.specularColorMap)),void 0!==t.envMap&&(r.envMap=n(t.envMap)),void 0!==t.envMapRotation&&r.envMapRotation.fromArray(t.envMapRotation),void 0!==t.envMapIntensity&&(r.envMapIntensity=t.envMapIntensity),void 0!==t.reflectivity&&(r.reflectivity=t.reflectivity),void 0!==t.refractionRatio&&(r.refractionRatio=t.refractionRatio),void 0!==t.lightMap&&(r.lightMap=n(t.lightMap)),void 0!==t.lightMapIntensity&&(r.lightMapIntensity=t.lightMapIntensity),void 0!==t.aoMap&&(r.aoMap=n(t.aoMap)),void 0!==t.aoMapIntensity&&(r.aoMapIntensity=t.aoMapIntensity),void 0!==t.gradientMap&&(r.gradientMap=n(t.gradientMap)),void 0!==t.clearcoatMap&&(r.clearcoatMap=n(t.clearcoatMap)),void 0!==t.clearcoatRoughnessMap&&(r.clearcoatRoughnessMap=n(t.clearcoatRoughnessMap)),void 0!==t.clearcoatNormalMap&&(r.clearcoatNormalMap=n(t.clearcoatNormalMap)),void 0!==t.clearcoatNormalScale&&(r.clearcoatNormalScale=(new je).fromArray(t.clearcoatNormalScale)),void 0!==t.iridescenceMap&&(r.iridescenceMap=n(t.iridescenceMap)),void 0!==t.iridescenceThicknessMap&&(r.iridescenceThicknessMap=n(t.iridescenceThicknessMap)),void 0!==t.transmissionMap&&(r.transmissionMap=n(t.transmissionMap)),void 0!==t.thicknessMap&&(r.thicknessMap=n(t.thicknessMap)),void 0!==t.anisotropyMap&&(r.anisotropyMap=n(t.anisotropyMap)),void 0!==t.sheenColorMap&&(r.sheenColorMap=n(t.sheenColorMap)),void 0!==t.sheenRoughnessMap&&(r.sheenRoughnessMap=n(t.sheenRoughnessMap)),r}setTextures(t){return this.textures=t,this}static createMaterialFromType(t){return new{ShadowMaterial:Al,SpriteMaterial:Ls,RawShaderMaterial:Ol,ShaderMaterial:Mi,PointsMaterial:Ku,MeshPhysicalMaterial:Rl,MeshStandardMaterial:Pl,MeshPhongMaterial:kl,MeshToonMaterial:Cl,MeshNormalMaterial:Nl,MeshLambertMaterial:Ll,MeshDepthMaterial:hs,MeshDistanceMaterial:ps,MeshBasicMaterial:jr,MeshMatcapMaterial:jl,LineDashedMaterial:Il,LineBasicMaterial:Fu,Material:Lr}[t]}}class Cf{static decodeText(t){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(t);let e="";for(let n=0,r=t.length;n<r;n++)e+=String.fromCharCode(t[n]);try{return decodeURIComponent(escape(e))}catch(t){return e}}static extractUrlBase(t){const e=t.lastIndexOf("/");return-1===e?"./":t.slice(0,e+1)}static resolveURL(t,e){return"string"!=typeof t||""===t?"":(/^https?:\/\//i.test(e)&&/^\//.test(t)&&(e=e.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(t)||/^data:.*,.*$/i.test(t)||/^blob:.*$/i.test(t)?t:e+t)}}class Nf extends ti{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(t){return super.copy(t),this.instanceCount=t.instanceCount,this}toJSON(){const t=super.toJSON();return t.instanceCount=this.instanceCount,t.isInstancedBufferGeometry=!0,t}}class Lf extends sf{constructor(t){super(t)}load(t,e,n,r){const i=this,o=new lf(i.manager);o.setPath(i.path),o.setRequestHeader(i.requestHeader),o.setWithCredentials(i.withCredentials),o.load(t,(function(n){try{e(i.parse(JSON.parse(n)))}catch(e){r?r(e):console.error(e),i.manager.itemError(t)}}),n,r)}parse(t){const e={},n={};function r(t,r){if(void 0!==e[r])return e[r];const i=t.interleavedBuffers[r],o=function(t,e){if(void 0!==n[e])return n[e];const r=t.arrayBuffers[e],i=new Uint32Array(r).buffer;return n[e]=i,i}(t,i.buffer),a=Fe(i.type,o),s=new ks(a,i.stride);return s.uuid=i.uuid,e[r]=s,s}const i=t.isInstancedBufferGeometry?new Nf:new ti,o=t.data.index;if(void 0!==o){const t=Fe(o.type,o.array);i.setIndex(new Gr(t,1))}const a=t.data.attributes;for(const e in a){const n=a[e];let o;if(n.isInterleavedBufferAttribute){const e=r(t.data,n.data);o=new Ns(e,n.itemSize,n.offset,n.normalized)}else{const t=Fe(n.type,n.array);o=new(n.isInstancedBufferAttribute?du:Gr)(t,n.itemSize,n.normalized)}void 0!==n.name&&(o.name=n.name),void 0!==n.usage&&o.setUsage(n.usage),i.setAttribute(e,o)}const s=t.data.morphAttributes;if(s)for(const e in s){const n=s[e],o=[];for(let e=0,i=n.length;e<i;e++){const i=n[e];let a;if(i.isInterleavedBufferAttribute){const e=r(t.data,i.data);a=new Ns(e,i.itemSize,i.offset,i.normalized)}else{const t=Fe(i.type,i.array);a=new Gr(t,i.itemSize,i.normalized)}void 0!==i.name&&(a.name=i.name),o.push(a)}i.morphAttributes[e]=o}t.data.morphTargetsRelative&&(i.morphTargetsRelative=!0);const u=t.data.groups||t.data.drawcalls||t.data.offsets;if(void 0!==u)for(let t=0,e=u.length;t!==e;++t){const e=u[t];i.addGroup(e.start,e.count,e.materialIndex)}const c=t.data.boundingSphere;if(void 0!==c){const t=new hn;void 0!==c.center&&t.fromArray(c.center),i.boundingSphere=new Nn(t,c.radius)}return t.name&&(i.name=t.name),t.userData&&(i.userData=t.userData),i}}const jf={UVMapping:F,CubeReflectionMapping:z,CubeRefractionMapping:V,EquirectangularReflectionMapping:G,EquirectangularRefractionMapping:H,CubeUVReflectionMapping:W},If={RepeatWrapping:q,ClampToEdgeWrapping:X,MirroredRepeatWrapping:Y},Bf={NearestFilter:J,NearestMipmapNearestFilter:Z,NearestMipmapLinearFilter:K,LinearFilter:Q,LinearMipmapNearestFilter:$,LinearMipmapLinearFilter:tt};let Uf;class Df{static getContext(){return void 0===Uf&&(Uf=new(window.AudioContext||window.webkitAudioContext)),Uf}static setContext(t){Uf=t}}const Ff=new Vn,zf=new Vn,Vf=new Vn;class Gf{constructor(t=!0){this.autoStart=t,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=Hf(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let t=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const e=Hf();t=(e-this.oldTime)/1e3,this.oldTime=e,this.elapsedTime+=t}return t}}function Hf(){return("undefined"==typeof performance?Date:performance).now()}const Wf=new hn,qf=new fn,Xf=new hn,Yf=new hn;class Jf extends mr{constructor(t){super(),this.type="Audio",this.listener=t,this.context=t.context,this.gain=this.context.createGain(),this.gain.connect(t.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(t){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=t,this.connect(),this}setMediaElementSource(t){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(t),this.connect(),this}setMediaStreamSource(t){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(t),this.connect(),this}setBuffer(t){return this.buffer=t,this.sourceType="buffer",this.autoplay&&this.play(),this}play(t=0){if(!0===this.isPlaying)return void console.warn("THREE.Audio: Audio is already playing.");if(!1===this.hasPlaybackControl)return void console.warn("THREE.Audio: this Audio has no playback control.");this._startedAt=this.context.currentTime+t;const e=this.context.createBufferSource();return e.buffer=this.buffer,e.loop=this.loop,e.loopStart=this.loopStart,e.loopEnd=this.loopEnd,e.onended=this.onEnded.bind(this),e.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=e,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,!0===this.loop&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")}stop(){if(!1!==this.hasPlaybackControl)return this._progress=0,null!==this.source&&(this.source.stop(),this.source.onended=null),this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let t=1,e=this.filters.length;t<e;t++)this.filters[t-1].connect(this.filters[t]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(!1!==this._connected){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let t=1,e=this.filters.length;t<e;t++)this.filters[t-1].disconnect(this.filters[t]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}}getFilters(){return this.filters}setFilters(t){return t||(t=[]),!0===this._connected?(this.disconnect(),this.filters=t.slice(),this.connect()):this.filters=t.slice(),this}setDetune(t){return this.detune=t,!0===this.isPlaying&&void 0!==this.source.detune&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(t){return this.setFilters(t?[t]:[])}setPlaybackRate(t){if(!1!==this.hasPlaybackControl)return this.playbackRate=t,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(t){if(!1!==this.hasPlaybackControl)return this.loop=t,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")}setLoopStart(t){return this.loopStart=t,this}setLoopEnd(t){return this.loopEnd=t,this}getVolume(){return this.gain.gain.value}setVolume(t){return this.gain.gain.setTargetAtTime(t,this.context.currentTime,.01),this}}const Zf=new hn,Kf=new fn,Qf=new hn,$f=new hn;class th{constructor(t,e,n){let r,i,o;switch(this.binding=t,this.valueSize=n,e){case"quaternion":r=this._slerp,i=this._slerpAdditive,o=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*n),this._workIndex=5;break;case"string":case"bool":r=this._select,i=this._select,o=this._setAdditiveIdentityOther,this.buffer=new Array(5*n);break;default:r=this._lerp,i=this._lerpAdditive,o=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*n)}this._mixBufferRegion=r,this._mixBufferRegionAdditive=i,this._setIdentity=o,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(t,e){const n=this.buffer,r=this.valueSize,i=t*r+r;let o=this.cumulativeWeight;if(0===o){for(let t=0;t!==r;++t)n[i+t]=n[t];o=e}else{o+=e;const t=e/o;this._mixBufferRegion(n,i,0,t,r)}this.cumulativeWeight=o}accumulateAdditive(t){const e=this.buffer,n=this.valueSize,r=n*this._addIndex;0===this.cumulativeWeightAdditive&&this._setIdentity(),this._mixBufferRegionAdditive(e,r,0,t,n),this.cumulativeWeightAdditive+=t}apply(t){const e=this.valueSize,n=this.buffer,r=t*e+e,i=this.cumulativeWeight,o=this.cumulativeWeightAdditive,a=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,i<1){const t=e*this._origIndex;this._mixBufferRegion(n,r,t,1-i,e)}o>0&&this._mixBufferRegionAdditive(n,r,this._addIndex*e,1,e);for(let t=e,i=e+e;t!==i;++t)if(n[t]!==n[t+e]){a.setValue(n,r);break}}saveOriginalState(){const t=this.binding,e=this.buffer,n=this.valueSize,r=n*this._origIndex;t.getValue(e,r);for(let t=n,i=r;t!==i;++t)e[t]=e[r+t%n];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const t=3*this.valueSize;this.binding.setValue(this.buffer,t)}_setAdditiveIdentityNumeric(){const t=this._addIndex*this.valueSize,e=t+this.valueSize;for(let n=t;n<e;n++)this.buffer[n]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const t=this._origIndex*this.valueSize,e=this._addIndex*this.valueSize;for(let n=0;n<this.valueSize;n++)this.buffer[e+n]=this.buffer[t+n]}_select(t,e,n,r,i){if(r>=.5)for(let r=0;r!==i;++r)t[e+r]=t[n+r]}_slerp(t,e,n,r){fn.slerpFlat(t,e,t,e,t,n,r)}_slerpAdditive(t,e,n,r,i){const o=this._workIndex*i;fn.multiplyQuaternionsFlat(t,o,t,e,t,n),fn.slerpFlat(t,e,t,e,t,o,r)}_lerp(t,e,n,r,i){const o=1-r;for(let a=0;a!==i;++a){const i=e+a;t[i]=t[i]*o+t[n+a]*r}}_lerpAdditive(t,e,n,r,i){for(let o=0;o!==i;++o){const i=e+o;t[i]=t[i]+t[n+o]*r}}}const eh="\\[\\]\\.:\\/",nh=new RegExp("["+eh+"]","g"),rh="[^"+eh+"]",ih="[^"+eh.replace("\\.","")+"]",oh=new RegExp("^"+/((?:WC+[\/:])*)/.source.replace("WC",rh)+/(WCOD+)?/.source.replace("WCOD",ih)+/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",rh)+/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",rh)+"$"),ah=["material","materials","bones","map"];class sh{constructor(t,e,n){this.path=e,this.parsedPath=n||sh.parseTrackName(e),this.node=sh.findNode(t,this.parsedPath.nodeName),this.rootNode=t,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(t,e,n){return t&&t.isAnimationObjectGroup?new sh.Composite(t,e,n):new sh(t,e,n)}static sanitizeNodeName(t){return t.replace(/\s/g,"_").replace(nh,"")}static parseTrackName(t){const e=oh.exec(t);if(null===e)throw new Error("PropertyBinding: Cannot parse trackName: "+t);const n={nodeName:e[2],objectName:e[3],objectIndex:e[4],propertyName:e[5],propertyIndex:e[6]},r=n.nodeName&&n.nodeName.lastIndexOf(".");if(void 0!==r&&-1!==r){const t=n.nodeName.substring(r+1);-1!==ah.indexOf(t)&&(n.nodeName=n.nodeName.substring(0,r),n.objectName=t)}if(null===n.propertyName||0===n.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+t);return n}static findNode(t,e){if(void 0===e||""===e||"."===e||-1===e||e===t.name||e===t.uuid)return t;if(t.skeleton){const n=t.skeleton.getBoneByName(e);if(void 0!==n)return n}if(t.children){const n=function(t){for(let r=0;r<t.length;r++){const i=t[r];if(i.name===e||i.uuid===e)return i;const o=n(i.children);if(o)return o}return null},r=n(t.children);if(r)return r}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(t,e){t[e]=this.targetObject[this.propertyName]}_getValue_array(t,e){const n=this.resolvedProperty;for(let r=0,i=n.length;r!==i;++r)t[e++]=n[r]}_getValue_arrayElement(t,e){t[e]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(t,e){this.resolvedProperty.toArray(t,e)}_setValue_direct(t,e){this.targetObject[this.propertyName]=t[e]}_setValue_direct_setNeedsUpdate(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(t,e){const n=this.resolvedProperty;for(let r=0,i=n.length;r!==i;++r)n[r]=t[e++]}_setValue_array_setNeedsUpdate(t,e){const n=this.resolvedProperty;for(let r=0,i=n.length;r!==i;++r)n[r]=t[e++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(t,e){const n=this.resolvedProperty;for(let r=0,i=n.length;r!==i;++r)n[r]=t[e++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(t,e){this.resolvedProperty[this.propertyIndex]=t[e]}_setValue_arrayElement_setNeedsUpdate(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(t,e){this.resolvedProperty.fromArray(t,e)}_setValue_fromArray_setNeedsUpdate(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(t,e){this.bind(),this.getValue(t,e)}_setValue_unbound(t,e){this.bind(),this.setValue(t,e)}bind(){let t=this.node;const e=this.parsedPath,n=e.objectName,r=e.propertyName;let i=e.propertyIndex;if(t||(t=sh.findNode(this.rootNode,e.nodeName),this.node=t),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!t)return void console.warn("THREE.PropertyBinding: No target node found for track: "+this.path+".");if(n){let r=e.objectIndex;switch(n){case"materials":if(!t.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!t.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);t=t.material.materials;break;case"bones":if(!t.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);t=t.skeleton.bones;for(let e=0;e<t.length;e++)if(t[e].name===r){r=e;break}break;case"map":if("map"in t){t=t.map;break}if(!t.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!t.material.map)return void console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);t=t.material.map;break;default:if(void 0===t[n])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);t=t[n]}if(void 0!==r){if(void 0===t[r])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,t);t=t[r]}}const o=t[r];if(void 0===o){const n=e.nodeName;return void console.error("THREE.PropertyBinding: Trying to update property for track: "+n+"."+r+" but it wasn't found.",t)}let a=this.Versioning.None;this.targetObject=t,void 0!==t.needsUpdate?a=this.Versioning.NeedsUpdate:void 0!==t.matrixWorldNeedsUpdate&&(a=this.Versioning.MatrixWorldNeedsUpdate);let s=this.BindingType.Direct;if(void 0!==i){if("morphTargetInfluences"===r){if(!t.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!t.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==t.morphTargetDictionary[i]&&(i=t.morphTargetDictionary[i])}s=this.BindingType.ArrayElement,this.resolvedProperty=o,this.propertyIndex=i}else void 0!==o.fromArray&&void 0!==o.toArray?(s=this.BindingType.HasFromToArray,this.resolvedProperty=o):Array.isArray(o)?(s=this.BindingType.EntireArray,this.resolvedProperty=o):this.propertyName=r;this.getValue=this.GetterByBindingType[s],this.setValue=this.SetterByBindingTypeAndVersioning[s][a]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}sh.Composite=class{constructor(t,e,n){const r=n||sh.parseTrackName(e);this._targetGroup=t,this._bindings=t.subscribe_(e,r)}getValue(t,e){this.bind();const n=this._targetGroup.nCachedObjects_,r=this._bindings[n];void 0!==r&&r.getValue(t,e)}setValue(t,e){const n=this._bindings;for(let r=this._targetGroup.nCachedObjects_,i=n.length;r!==i;++r)n[r].setValue(t,e)}bind(){const t=this._bindings;for(let e=this._targetGroup.nCachedObjects_,n=t.length;e!==n;++e)t[e].bind()}unbind(){const t=this._bindings;for(let e=this._targetGroup.nCachedObjects_,n=t.length;e!==n;++e)t[e].unbind()}},sh.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},sh.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},sh.prototype.GetterByBindingType=[sh.prototype._getValue_direct,sh.prototype._getValue_array,sh.prototype._getValue_arrayElement,sh.prototype._getValue_toArray],sh.prototype.SetterByBindingTypeAndVersioning=[[sh.prototype._setValue_direct,sh.prototype._setValue_direct_setNeedsUpdate,sh.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[sh.prototype._setValue_array,sh.prototype._setValue_array_setNeedsUpdate,sh.prototype._setValue_array_setMatrixWorldNeedsUpdate],[sh.prototype._setValue_arrayElement,sh.prototype._setValue_arrayElement_setNeedsUpdate,sh.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[sh.prototype._setValue_fromArray,sh.prototype._setValue_fromArray_setNeedsUpdate,sh.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class uh{constructor(t,e,n=null,r=e.blendMode){this._mixer=t,this._clip=e,this._localRoot=n,this.blendMode=r;const i=e.tracks,o=i.length,a=new Array(o),s={endingStart:Kt,endingEnd:Kt};for(let t=0;t!==o;++t){const e=i[t].createInterpolant(null);a[t]=e,e.settings=s}this._interpolantSettings=s,this._interpolants=a,this._propertyBindings=new Array(o),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=2201,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(t){return this._startTime=t,this}setLoop(t,e){return this.loop=t,this.repetitions=e,this}setEffectiveWeight(t){return this.weight=t,this._effectiveWeight=this.enabled?t:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(t){return this._scheduleFading(t,0,1)}fadeOut(t){return this._scheduleFading(t,1,0)}crossFadeFrom(t,e,n){if(t.fadeOut(e),this.fadeIn(e),n){const n=this._clip.duration,r=t._clip.duration,i=r/n,o=n/r;t.warp(1,i,e),this.warp(o,1,e)}return this}crossFadeTo(t,e,n){return t.crossFadeFrom(this,e,n)}stopFading(){const t=this._weightInterpolant;return null!==t&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this}setEffectiveTimeScale(t){return this.timeScale=t,this._effectiveTimeScale=this.paused?0:t,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(t){return this.timeScale=this._clip.duration/t,this.stopWarping()}syncWith(t){return this.time=t.time,this.timeScale=t.timeScale,this.stopWarping()}halt(t){return this.warp(this._effectiveTimeScale,0,t)}warp(t,e,n){const r=this._mixer,i=r.time,o=this.timeScale;let a=this._timeScaleInterpolant;null===a&&(a=r._lendControlInterpolant(),this._timeScaleInterpolant=a);const s=a.parameterPositions,u=a.sampleValues;return s[0]=i,s[1]=i+n,u[0]=t/o,u[1]=e/o,this}stopWarping(){const t=this._timeScaleInterpolant;return null!==t&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(t,e,n,r){if(!this.enabled)return void this._updateWeight(t);const i=this._startTime;if(null!==i){const r=(t-i)*n;r<0||0===n?e=0:(this._startTime=null,e=n*r)}e*=this._updateTimeScale(t);const o=this._updateTime(e),a=this._updateWeight(t);if(a>0){const t=this._interpolants,e=this._propertyBindings;if(this.blendMode===te)for(let n=0,r=t.length;n!==r;++n)t[n].evaluate(o),e[n].accumulateAdditive(a);else for(let n=0,i=t.length;n!==i;++n)t[n].evaluate(o),e[n].accumulate(r,a)}}_updateWeight(t){let e=0;if(this.enabled){e=this.weight;const n=this._weightInterpolant;if(null!==n){const r=n.evaluate(t)[0];e*=r,t>n.parameterPositions[1]&&(this.stopFading(),0===r&&(this.enabled=!1))}}return this._effectiveWeight=e,e}_updateTimeScale(t){let e=0;if(!this.paused){e=this.timeScale;const n=this._timeScaleInterpolant;null!==n&&(e*=n.evaluate(t)[0],t>n.parameterPositions[1]&&(this.stopWarping(),0===e?this.paused=!0:this.timeScale=e))}return this._effectiveTimeScale=e,e}_updateTime(t){const e=this._clip.duration,n=this.loop;let r=this.time+t,i=this._loopCount;const o=2202===n;if(0===t)return-1===i||!o||1&~i?r:e-r;if(2200===n){-1===i&&(this._loopCount=0,this._setEndings(!0,!0,!1));t:{if(r>=e)r=e;else{if(!(r<0)){this.time=r;break t}r=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:t<0?-1:1})}}else{if(-1===i&&(t>=0?(i=0,this._setEndings(!0,0===this.repetitions,o)):this._setEndings(0===this.repetitions,!0,o)),r>=e||r<0){const n=Math.floor(r/e);r-=e*n,i+=Math.abs(n);const a=this.repetitions-i;if(a<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,r=t>0?e:0,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:t>0?1:-1});else{if(1===a){const e=t<0;this._setEndings(e,!e,o)}else this._setEndings(!1,!1,o);this._loopCount=i,this.time=r,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:n})}}else this.time=r;if(o&&!(1&~i))return e-r}return r}_setEndings(t,e,n){const r=this._interpolantSettings;n?(r.endingStart=Qt,r.endingEnd=Qt):(r.endingStart=t?this.zeroSlopeAtStart?Qt:Kt:$t,r.endingEnd=e?this.zeroSlopeAtEnd?Qt:Kt:$t)}_scheduleFading(t,e,n){const r=this._mixer,i=r.time;let o=this._weightInterpolant;null===o&&(o=r._lendControlInterpolant(),this._weightInterpolant=o);const a=o.parameterPositions,s=o.sampleValues;return a[0]=i,s[0]=e,a[1]=i+t,s[1]=n,this}}const ch=new Float32Array(1);class lh{constructor(t){this.value=t}clone(){return new lh(void 0===this.value.clone?this.value:this.value.clone())}}let fh=0;const hh=new Vn;function ph(t,e){return t.distance-e.distance}function dh(t,e,n,r){if(t.layers.test(e.layers)&&t.raycast(e,n),!0===r){const r=t.children;for(let t=0,i=r.length;t<i;t++)dh(r[t],e,n,!0)}}const mh=new je,yh=new hn,vh=new hn,gh=new hn,bh=new hn,_h=new Vn,xh=new Vn;function wh(t){const e=[];!0===t.isBone&&e.push(t);for(let n=0;n<t.children.length;n++)e.push.apply(e,wh(t.children[n]));return e}const Sh=new hn,Th=new kr,Mh=new kr,Eh=new hn,Ah=new hn,Oh=new hn,Ph=new hn,Rh=new Ei;function kh(t,e,n,r,i,o,a){Ph.set(i,o,a).unproject(r);const s=e[t];if(void 0!==s){const t=n.getAttribute("position");for(let e=0,n=s.length;e<n;e++)t.setXYZ(s[e],Ph.x,Ph.y,Ph.z)}}const Ch=new mn,Nh=new hn;let Lh,jh;"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:n}})),"undefined"!=typeof window&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=n),e.ACESFilmicToneMapping=L,e.AddEquation=c,e.AddOperation=P,e.AdditiveAnimationBlendMode=te,e.AdditiveBlending=2,e.AgXToneMapping=I,e.AlphaFormat=1021,e.AlwaysCompare=519,e.AlwaysDepth=1,e.AlwaysStencilFunc=519,e.AmbientLight=Af,e.AnimationAction=uh,e.AnimationClip=ef,e.AnimationLoader=class extends sf{constructor(t){super(t)}load(t,e,n,r){const i=this,o=new lf(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(t,(function(n){try{e(i.parse(JSON.parse(n)))}catch(e){r?r(e):console.error(e),i.manager.itemError(t)}}),n,r)}parse(t){const e=[];for(let n=0;n<t.length;n++){const r=ef.parse(t[n]);e.push(r)}return e}},e.AnimationMixer=class extends Se{constructor(t){super(),this._root=t,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(t,e){const n=t._localRoot||this._root,r=t._clip.tracks,i=r.length,o=t._propertyBindings,a=t._interpolants,s=n.uuid,u=this._bindingsByRootAndName;let c=u[s];void 0===c&&(c={},u[s]=c);for(let t=0;t!==i;++t){const i=r[t],u=i.name;let l=c[u];if(void 0!==l)++l.referenceCount,o[t]=l;else{if(l=o[t],void 0!==l){null===l._cacheIndex&&(++l.referenceCount,this._addInactiveBinding(l,s,u));continue}const r=e&&e._propertyBindings[t].binding.parsedPath;l=new th(sh.create(n,u,r),i.ValueTypeName,i.getValueSize()),++l.referenceCount,this._addInactiveBinding(l,s,u),o[t]=l}a[t].resultBuffer=l.buffer}}_activateAction(t){if(!this._isActiveAction(t)){if(null===t._cacheIndex){const e=(t._localRoot||this._root).uuid,n=t._clip.uuid,r=this._actionsByClip[n];this._bindAction(t,r&&r.knownActions[0]),this._addInactiveAction(t,n,e)}const e=t._propertyBindings;for(let t=0,n=e.length;t!==n;++t){const n=e[t];0==n.useCount++&&(this._lendBinding(n),n.saveOriginalState())}this._lendAction(t)}}_deactivateAction(t){if(this._isActiveAction(t)){const e=t._propertyBindings;for(let t=0,n=e.length;t!==n;++t){const n=e[t];0==--n.useCount&&(n.restoreOriginalState(),this._takeBackBinding(n))}this._takeBackAction(t)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const t=this;this.stats={actions:{get total(){return t._actions.length},get inUse(){return t._nActiveActions}},bindings:{get total(){return t._bindings.length},get inUse(){return t._nActiveBindings}},controlInterpolants:{get total(){return t._controlInterpolants.length},get inUse(){return t._nActiveControlInterpolants}}}}_isActiveAction(t){const e=t._cacheIndex;return null!==e&&e<this._nActiveActions}_addInactiveAction(t,e,n){const r=this._actions,i=this._actionsByClip;let o=i[e];if(void 0===o)o={knownActions:[t],actionByRoot:{}},t._byClipCacheIndex=0,i[e]=o;else{const e=o.knownActions;t._byClipCacheIndex=e.length,e.push(t)}t._cacheIndex=r.length,r.push(t),o.actionByRoot[n]=t}_removeInactiveAction(t){const e=this._actions,n=e[e.length-1],r=t._cacheIndex;n._cacheIndex=r,e[r]=n,e.pop(),t._cacheIndex=null;const i=t._clip.uuid,o=this._actionsByClip,a=o[i],s=a.knownActions,u=s[s.length-1],c=t._byClipCacheIndex;u._byClipCacheIndex=c,s[c]=u,s.pop(),t._byClipCacheIndex=null,delete a.actionByRoot[(t._localRoot||this._root).uuid],0===s.length&&delete o[i],this._removeInactiveBindingsForAction(t)}_removeInactiveBindingsForAction(t){const e=t._propertyBindings;for(let t=0,n=e.length;t!==n;++t){const n=e[t];0==--n.referenceCount&&this._removeInactiveBinding(n)}}_lendAction(t){const e=this._actions,n=t._cacheIndex,r=this._nActiveActions++,i=e[r];t._cacheIndex=r,e[r]=t,i._cacheIndex=n,e[n]=i}_takeBackAction(t){const e=this._actions,n=t._cacheIndex,r=--this._nActiveActions,i=e[r];t._cacheIndex=r,e[r]=t,i._cacheIndex=n,e[n]=i}_addInactiveBinding(t,e,n){const r=this._bindingsByRootAndName,i=this._bindings;let o=r[e];void 0===o&&(o={},r[e]=o),o[n]=t,t._cacheIndex=i.length,i.push(t)}_removeInactiveBinding(t){const e=this._bindings,n=t.binding,r=n.rootNode.uuid,i=n.path,o=this._bindingsByRootAndName,a=o[r],s=e[e.length-1],u=t._cacheIndex;s._cacheIndex=u,e[u]=s,e.pop(),delete a[i],0===Object.keys(a).length&&delete o[r]}_lendBinding(t){const e=this._bindings,n=t._cacheIndex,r=this._nActiveBindings++,i=e[r];t._cacheIndex=r,e[r]=t,i._cacheIndex=n,e[n]=i}_takeBackBinding(t){const e=this._bindings,n=t._cacheIndex,r=--this._nActiveBindings,i=e[r];t._cacheIndex=r,e[r]=t,i._cacheIndex=n,e[n]=i}_lendControlInterpolant(){const t=this._controlInterpolants,e=this._nActiveControlInterpolants++;let n=t[e];return void 0===n&&(n=new Wl(new Float32Array(2),new Float32Array(2),1,ch),n.__cacheIndex=e,t[e]=n),n}_takeBackControlInterpolant(t){const e=this._controlInterpolants,n=t.__cacheIndex,r=--this._nActiveControlInterpolants,i=e[r];t.__cacheIndex=r,e[r]=t,i.__cacheIndex=n,e[n]=i}clipAction(t,e,n){const r=e||this._root,i=r.uuid;let o="string"==typeof t?ef.findByName(r,t):t;const a=null!==o?o.uuid:t,s=this._actionsByClip[a];let u=null;if(void 0===n&&(n=null!==o?o.blendMode:2500),void 0!==s){const t=s.actionByRoot[i];if(void 0!==t&&t.blendMode===n)return t;u=s.knownActions[0],null===o&&(o=u._clip)}if(null===o)return null;const c=new uh(this,o,e,n);return this._bindAction(c,u),this._addInactiveAction(c,a,i),c}existingAction(t,e){const n=e||this._root,r=n.uuid,i="string"==typeof t?ef.findByName(n,t):t,o=i?i.uuid:t,a=this._actionsByClip[o];return void 0!==a&&a.actionByRoot[r]||null}stopAllAction(){const t=this._actions;for(let e=this._nActiveActions-1;e>=0;--e)t[e].stop();return this}update(t){t*=this.timeScale;const e=this._actions,n=this._nActiveActions,r=this.time+=t,i=Math.sign(t),o=this._accuIndex^=1;for(let a=0;a!==n;++a)e[a]._update(r,t,i,o);const a=this._bindings,s=this._nActiveBindings;for(let t=0;t!==s;++t)a[t].apply(o);return this}setTime(t){this.time=0;for(let t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(t)}getRoot(){return this._root}uncacheClip(t){const e=this._actions,n=t.uuid,r=this._actionsByClip,i=r[n];if(void 0!==i){const t=i.knownActions;for(let n=0,r=t.length;n!==r;++n){const r=t[n];this._deactivateAction(r);const i=r._cacheIndex,o=e[e.length-1];r._cacheIndex=null,r._byClipCacheIndex=null,o._cacheIndex=i,e[i]=o,e.pop(),this._removeInactiveBindingsForAction(r)}delete r[n]}}uncacheRoot(t){const e=t.uuid,n=this._actionsByClip;for(const t in n){const r=n[t].actionByRoot[e];void 0!==r&&(this._deactivateAction(r),this._removeInactiveAction(r))}const r=this._bindingsByRootAndName[e];if(void 0!==r)for(const t in r){const e=r[t];e.restoreOriginalState(),this._removeInactiveBinding(e)}}uncacheAction(t,e){const n=this.existingAction(t,e);null!==n&&(this._deactivateAction(n),this._removeInactiveAction(n))}},e.AnimationObjectGroup=class{constructor(){this.isAnimationObjectGroup=!0,this.uuid=Oe(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const t={};this._indicesByUUID=t;for(let e=0,n=arguments.length;e!==n;++e)t[arguments[e].uuid]=e;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const e=this;this.stats={objects:{get total(){return e._objects.length},get inUse(){return this.total-e.nCachedObjects_}},get bindingsPerObject(){return e._bindings.length}}}add(){const t=this._objects,e=this._indicesByUUID,n=this._paths,r=this._parsedPaths,i=this._bindings,o=i.length;let a,s=t.length,u=this.nCachedObjects_;for(let c=0,l=arguments.length;c!==l;++c){const l=arguments[c],f=l.uuid;let h=e[f];if(void 0===h){h=s++,e[f]=h,t.push(l);for(let t=0,e=o;t!==e;++t)i[t].push(new sh(l,n[t],r[t]))}else if(h<u){a=t[h];const s=--u,c=t[s];e[c.uuid]=h,t[h]=c,e[f]=s,t[s]=l;for(let t=0,e=o;t!==e;++t){const e=i[t],o=e[s];let a=e[h];e[h]=o,void 0===a&&(a=new sh(l,n[t],r[t])),e[s]=a}}else t[h]!==a&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=u}remove(){const t=this._objects,e=this._indicesByUUID,n=this._bindings,r=n.length;let i=this.nCachedObjects_;for(let o=0,a=arguments.length;o!==a;++o){const a=arguments[o],s=a.uuid,u=e[s];if(void 0!==u&&u>=i){const o=i++,c=t[o];e[c.uuid]=u,t[u]=c,e[s]=o,t[o]=a;for(let t=0,e=r;t!==e;++t){const e=n[t],r=e[o],i=e[u];e[u]=r,e[o]=i}}}this.nCachedObjects_=i}uncache(){const t=this._objects,e=this._indicesByUUID,n=this._bindings,r=n.length;let i=this.nCachedObjects_,o=t.length;for(let a=0,s=arguments.length;a!==s;++a){const s=arguments[a].uuid,u=e[s];if(void 0!==u)if(delete e[s],u<i){const a=--i,s=t[a],c=--o,l=t[c];e[s.uuid]=u,t[u]=s,e[l.uuid]=a,t[a]=l,t.pop();for(let t=0,e=r;t!==e;++t){const e=n[t],r=e[a],i=e[c];e[u]=r,e[a]=i,e.pop()}}else{const i=--o,a=t[i];i>0&&(e[a.uuid]=u),t[u]=a,t.pop();for(let t=0,e=r;t!==e;++t){const e=n[t];e[u]=e[i],e.pop()}}}this.nCachedObjects_=i}subscribe_(t,e){const n=this._bindingsIndicesByPath;let r=n[t];const i=this._bindings;if(void 0!==r)return i[r];const o=this._paths,a=this._parsedPaths,s=this._objects,u=s.length,c=this.nCachedObjects_,l=new Array(u);r=i.length,n[t]=r,o.push(t),a.push(e),i.push(l);for(let n=c,r=s.length;n!==r;++n){const r=s[n];l[n]=new sh(r,t,e)}return l}unsubscribe_(t){const e=this._bindingsIndicesByPath,n=e[t];if(void 0!==n){const r=this._paths,i=this._parsedPaths,o=this._bindings,a=o.length-1,s=o[a];e[t[a]]=n,o[n]=s,o.pop(),i[n]=i[a],i.pop(),r[n]=r[a],r.pop()}}},e.AnimationUtils=Vl,e.ArcCurve=sc,e.ArrayCamera=gs,e.ArrowHelper=class extends mr{constructor(t=new hn(0,0,1),e=new hn(0,0,0),n=1,r=16776960,i=.2*n,o=.2*i){super(),this.type="ArrowHelper",void 0===Lh&&(Lh=new ti,Lh.setAttribute("position",new qr([0,0,0,0,1,0],3)),jh=new Rc(0,.5,1,5,1),jh.translate(0,-.5,0)),this.position.copy(e),this.line=new qu(Lh,new Fu({color:r,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new gi(jh,new jr({color:r,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(t),this.setLength(n,i,o)}setDirection(t){if(t.y>.99999)this.quaternion.set(0,0,0,1);else if(t.y<-.99999)this.quaternion.set(1,0,0,0);else{Nh.set(t.z,0,-t.x).normalize();const e=Math.acos(t.y);this.quaternion.setFromAxisAngle(Nh,e)}}setLength(t,e=.2*t,n=.2*e){this.line.scale.set(1,Math.max(1e-4,t-e),1),this.line.updateMatrix(),this.cone.scale.set(n,e,n),this.cone.position.y=t,this.cone.updateMatrix()}setColor(t){this.line.material.color.set(t),this.cone.material.color.set(t)}copy(t){return super.copy(t,!1),this.line.copy(t.line),this.cone.copy(t.cone),this}dispose(){this.line.geometry.dispose(),this.line.material.dispose(),this.cone.geometry.dispose(),this.cone.material.dispose()}},e.AttachedBindMode=U,e.Audio=Jf,e.AudioAnalyser=class{constructor(t,e=2048){this.analyser=t.context.createAnalyser(),this.analyser.fftSize=e,this.data=new Uint8Array(this.analyser.frequencyBinCount),t.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let t=0;const e=this.getFrequencyData();for(let n=0;n<e.length;n++)t+=e[n];return t/e.length}},e.AudioContext=Df,e.AudioListener=class extends mr{constructor(){super(),this.type="AudioListener",this.context=Df.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new Gf}getInput(){return this.gain}removeFilter(){return null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(t){return null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=t,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(t){return this.gain.gain.setTargetAtTime(t,this.context.currentTime,.01),this}updateMatrixWorld(t){super.updateMatrixWorld(t);const e=this.context.listener,n=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(Wf,qf,Xf),Yf.set(0,0,-1).applyQuaternion(qf),e.positionX){const t=this.context.currentTime+this.timeDelta;e.positionX.linearRampToValueAtTime(Wf.x,t),e.positionY.linearRampToValueAtTime(Wf.y,t),e.positionZ.linearRampToValueAtTime(Wf.z,t),e.forwardX.linearRampToValueAtTime(Yf.x,t),e.forwardY.linearRampToValueAtTime(Yf.y,t),e.forwardZ.linearRampToValueAtTime(Yf.z,t),e.upX.linearRampToValueAtTime(n.x,t),e.upY.linearRampToValueAtTime(n.y,t),e.upZ.linearRampToValueAtTime(n.z,t)}else e.setPosition(Wf.x,Wf.y,Wf.z),e.setOrientation(Yf.x,Yf.y,Yf.z,n.x,n.y,n.z)}},e.AudioLoader=class extends sf{constructor(t){super(t)}load(t,e,n,r){const i=this,o=new lf(this.manager);function a(e){r?r(e):console.error(e),i.manager.itemError(t)}o.setResponseType("arraybuffer"),o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(t,(function(t){try{const n=t.slice(0);Df.getContext().decodeAudioData(n,(function(t){e(t)})).catch(a)}catch(t){a(t)}}),n,r)}},e.AxesHelper=class extends Ju{constructor(t=1){const e=[0,0,0,t,0,0,0,0,0,0,t,0,0,0,0,0,0,t],n=new ti;n.setAttribute("position",new qr(e,3)),n.setAttribute("color",new qr([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3)),super(n,new Fu({vertexColors:!0,toneMapped:!1})),this.type="AxesHelper"}setColors(t,e,n){const r=new kr,i=this.geometry.attributes.color.array;return r.set(t),r.toArray(i,0),r.toArray(i,3),r.set(e),r.toArray(i,6),r.toArray(i,9),r.set(n),r.toArray(i,12),r.toArray(i,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}},e.BackSide=1,e.BasicDepthPacking=3200,e.BasicShadowMap=0,e.BatchedMesh=Du,e.Bone=cu,e.BooleanKeyframeTrack=Yl,e.Box2=class{constructor(t=new je(1/0,1/0),e=new je(-1/0,-1/0)){this.isBox2=!0,this.min=t,this.max=e}set(t,e){return this.min.copy(t),this.max.copy(e),this}setFromPoints(t){this.makeEmpty();for(let e=0,n=t.length;e<n;e++)this.expandByPoint(t[e]);return this}setFromCenterAndSize(t,e){const n=mh.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(n),this.max.copy(t).add(n),this}clone(){return(new this.constructor).copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(t){return this.isEmpty()?t.set(0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return this.isEmpty()?t.set(0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}containsPoint(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y)}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y}getParameter(t,e){return e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y)}clampPoint(t,e){return e.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return this.clampPoint(t,mh).distanceTo(t)}intersect(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}},e.Box3=mn,e.Box3Helper=class extends Ju{constructor(t,e=16776960){const n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),r=new ti;r.setIndex(new Gr(n,1)),r.setAttribute("position",new qr([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),super(r,new Fu({color:e,toneMapped:!1})),this.box=t,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(t){const e=this.box;e.isEmpty()||(e.getCenter(this.position),e.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(t))}dispose(){this.geometry.dispose(),this.material.dispose()}},e.BoxGeometry=_i,e.BoxHelper=class extends Ju{constructor(t,e=16776960){const n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),r=new Float32Array(24),i=new ti;i.setIndex(new Gr(n,1)),i.setAttribute("position",new Gr(r,3)),super(i,new Fu({color:e,toneMapped:!1})),this.object=t,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(t){if(void 0!==t&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),void 0!==this.object&&Ch.setFromObject(this.object),Ch.isEmpty())return;const e=Ch.min,n=Ch.max,r=this.geometry.attributes.position,i=r.array;i[0]=n.x,i[1]=n.y,i[2]=n.z,i[3]=e.x,i[4]=n.y,i[5]=n.z,i[6]=e.x,i[7]=e.y,i[8]=n.z,i[9]=n.x,i[10]=e.y,i[11]=n.z,i[12]=n.x,i[13]=n.y,i[14]=e.z,i[15]=e.x,i[16]=n.y,i[17]=e.z,i[18]=e.x,i[19]=e.y,i[20]=e.z,i[21]=n.x,i[22]=e.y,i[23]=e.z,r.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(t){return this.object=t,this.update(),this}copy(t,e){return super.copy(t,e),this.object=t.object,this}dispose(){this.geometry.dispose(),this.material.dispose()}},e.BufferAttribute=Gr,e.BufferGeometry=ti,e.BufferGeometryLoader=Lf,e.ByteType=1010,e.Cache=rf,e.Camera=Ei,e.CameraHelper=class extends Ju{constructor(t){const e=new ti,n=new Fu({color:16777215,vertexColors:!0,toneMapped:!1}),r=[],i=[],o={};function a(t,e){s(t),s(e)}function s(t){r.push(0,0,0),i.push(0,0,0),void 0===o[t]&&(o[t]=[]),o[t].push(r.length/3-1)}a("n1","n2"),a("n2","n4"),a("n4","n3"),a("n3","n1"),a("f1","f2"),a("f2","f4"),a("f4","f3"),a("f3","f1"),a("n1","f1"),a("n2","f2"),a("n3","f3"),a("n4","f4"),a("p","n1"),a("p","n2"),a("p","n3"),a("p","n4"),a("u1","u2"),a("u2","u3"),a("u3","u1"),a("c","t"),a("p","c"),a("cn1","cn2"),a("cn3","cn4"),a("cf1","cf2"),a("cf3","cf4"),e.setAttribute("position",new qr(r,3)),e.setAttribute("color",new qr(i,3)),super(e,n),this.type="CameraHelper",this.camera=t,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=o,this.update();const u=new kr(16755200),c=new kr(16711680),l=new kr(43775),f=new kr(16777215),h=new kr(3355443);this.setColors(u,c,l,f,h)}setColors(t,e,n,r,i){const o=this.geometry.getAttribute("color");o.setXYZ(0,t.r,t.g,t.b),o.setXYZ(1,t.r,t.g,t.b),o.setXYZ(2,t.r,t.g,t.b),o.setXYZ(3,t.r,t.g,t.b),o.setXYZ(4,t.r,t.g,t.b),o.setXYZ(5,t.r,t.g,t.b),o.setXYZ(6,t.r,t.g,t.b),o.setXYZ(7,t.r,t.g,t.b),o.setXYZ(8,t.r,t.g,t.b),o.setXYZ(9,t.r,t.g,t.b),o.setXYZ(10,t.r,t.g,t.b),o.setXYZ(11,t.r,t.g,t.b),o.setXYZ(12,t.r,t.g,t.b),o.setXYZ(13,t.r,t.g,t.b),o.setXYZ(14,t.r,t.g,t.b),o.setXYZ(15,t.r,t.g,t.b),o.setXYZ(16,t.r,t.g,t.b),o.setXYZ(17,t.r,t.g,t.b),o.setXYZ(18,t.r,t.g,t.b),o.setXYZ(19,t.r,t.g,t.b),o.setXYZ(20,t.r,t.g,t.b),o.setXYZ(21,t.r,t.g,t.b),o.setXYZ(22,t.r,t.g,t.b),o.setXYZ(23,t.r,t.g,t.b),o.setXYZ(24,e.r,e.g,e.b),o.setXYZ(25,e.r,e.g,e.b),o.setXYZ(26,e.r,e.g,e.b),o.setXYZ(27,e.r,e.g,e.b),o.setXYZ(28,e.r,e.g,e.b),o.setXYZ(29,e.r,e.g,e.b),o.setXYZ(30,e.r,e.g,e.b),o.setXYZ(31,e.r,e.g,e.b),o.setXYZ(32,n.r,n.g,n.b),o.setXYZ(33,n.r,n.g,n.b),o.setXYZ(34,n.r,n.g,n.b),o.setXYZ(35,n.r,n.g,n.b),o.setXYZ(36,n.r,n.g,n.b),o.setXYZ(37,n.r,n.g,n.b),o.setXYZ(38,r.r,r.g,r.b),o.setXYZ(39,r.r,r.g,r.b),o.setXYZ(40,i.r,i.g,i.b),o.setXYZ(41,i.r,i.g,i.b),o.setXYZ(42,i.r,i.g,i.b),o.setXYZ(43,i.r,i.g,i.b),o.setXYZ(44,i.r,i.g,i.b),o.setXYZ(45,i.r,i.g,i.b),o.setXYZ(46,i.r,i.g,i.b),o.setXYZ(47,i.r,i.g,i.b),o.setXYZ(48,i.r,i.g,i.b),o.setXYZ(49,i.r,i.g,i.b),o.needsUpdate=!0}update(){const t=this.geometry,e=this.pointMap;Rh.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),kh("c",e,t,Rh,0,0,-1),kh("t",e,t,Rh,0,0,1),kh("n1",e,t,Rh,-1,-1,-1),kh("n2",e,t,Rh,1,-1,-1),kh("n3",e,t,Rh,-1,1,-1),kh("n4",e,t,Rh,1,1,-1),kh("f1",e,t,Rh,-1,-1,1),kh("f2",e,t,Rh,1,-1,1),kh("f3",e,t,Rh,-1,1,1),kh("f4",e,t,Rh,1,1,1),kh("u1",e,t,Rh,.7,1.1,-1),kh("u2",e,t,Rh,-.7,1.1,-1),kh("u3",e,t,Rh,0,2,-1),kh("cf1",e,t,Rh,-1,0,1),kh("cf2",e,t,Rh,1,0,1),kh("cf3",e,t,Rh,0,-1,1),kh("cf4",e,t,Rh,0,1,1),kh("cn1",e,t,Rh,-1,0,-1),kh("cn2",e,t,Rh,1,0,-1),kh("cn3",e,t,Rh,0,-1,-1),kh("cn4",e,t,Rh,0,1,-1),t.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}},e.CanvasTexture=class extends on{constructor(t,e,n,r,i,o,a,s,u){super(t,e,n,r,i,o,a,s,u),this.isCanvasTexture=!0,this.needsUpdate=!0}},e.CapsuleGeometry=Oc,e.CatmullRomCurve3=pc,e.CineonToneMapping=N,e.CircleGeometry=Pc,e.ClampToEdgeWrapping=X,e.Clock=Gf,e.Color=kr,e.ColorKeyframeTrack=Jl,e.ColorManagement=Je,e.CompressedArrayTexture=class extends ic{constructor(t,e,n,r,i,o){super(t,e,n,i,o),this.isCompressedArrayTexture=!0,this.image.depth=r,this.wrapR=X}},e.CompressedCubeTexture=class extends ic{constructor(t,e,n){super(void 0,t[0].width,t[0].height,e,n,z),this.isCompressedCubeTexture=!0,this.isCubeTexture=!0,this.image=t}},e.CompressedTexture=ic,e.CompressedTextureLoader=class extends sf{constructor(t){super(t)}load(t,e,n,r){const i=this,o=[],a=new ic,s=new lf(this.manager);s.setPath(this.path),s.setResponseType("arraybuffer"),s.setRequestHeader(this.requestHeader),s.setWithCredentials(i.withCredentials);let u=0;function c(c){s.load(t[c],(function(t){const n=i.parse(t,!0);o[c]={width:n.width,height:n.height,format:n.format,mipmaps:n.mipmaps},u+=1,6===u&&(1===n.mipmapCount&&(a.minFilter=Q),a.image=o,a.format=n.format,a.needsUpdate=!0,e&&e(a))}),n,r)}if(Array.isArray(t))for(let e=0,n=t.length;e<n;++e)c(e);else s.load(t,(function(t){const n=i.parse(t,!0);if(n.isCubemap){const t=n.mipmaps.length/n.mipmapCount;for(let e=0;e<t;e++){o[e]={mipmaps:[]};for(let t=0;t<n.mipmapCount;t++)o[e].mipmaps.push(n.mipmaps[e*n.mipmapCount+t]),o[e].format=n.format,o[e].width=n.width,o[e].height=n.height}a.image=o}else a.image.width=n.width,a.image.height=n.height,a.mipmaps=n.mipmaps;1===n.mipmapCount&&(a.minFilter=Q),a.format=n.format,a.needsUpdate=!0,e&&e(a)}),n,r);return a}},e.ConeGeometry=kc,e.ConstantAlphaFactor=213,e.ConstantColorFactor=211,e.CubeCamera=Ci,e.CubeReflectionMapping=z,e.CubeRefractionMapping=V,e.CubeTexture=Ni,e.CubeTextureLoader=class extends sf{constructor(t){super(t)}load(t,e,n,r){const i=new Ni;i.colorSpace=ne;const o=new ff(this.manager);o.setCrossOrigin(this.crossOrigin),o.setPath(this.path);let a=0;function s(n){o.load(t[n],(function(t){i.images[n]=t,a++,6===a&&(i.needsUpdate=!0,e&&e(i))}),void 0,r)}for(let e=0;e<t.length;++e)s(e);return i}},e.CubeUVReflectionMapping=W,e.CubicBezierCurve=vc,e.CubicBezierCurve3=gc,e.CubicInterpolant=Hl,e.CullFaceBack=1,e.CullFaceFront=2,e.CullFaceFrontBack=3,e.CullFaceNone=0,e.Curve=oc,e.CurvePath=Mc,e.CustomBlending=5,e.CustomToneMapping=j,e.CylinderGeometry=Rc,e.Cylindrical=class{constructor(t=1,e=0,n=0){return this.radius=t,this.theta=e,this.y=n,this}set(t,e,n){return this.radius=t,this.theta=e,this.y=n,this}copy(t){return this.radius=t.radius,this.theta=t.theta,this.y=t.y,this}setFromVector3(t){return this.setFromCartesianCoords(t.x,t.y,t.z)}setFromCartesianCoords(t,e,n){return this.radius=Math.sqrt(t*t+n*n),this.theta=Math.atan2(t,n),this.y=e,this}clone(){return(new this.constructor).copy(this)}},e.Data3DTexture=ln,e.DataArrayTexture=cn,e.DataTexture=lu,e.DataTextureLoader=class extends sf{constructor(t){super(t)}load(t,e,n,r){const i=this,o=new lu,a=new lf(this.manager);return a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setPath(this.path),a.setWithCredentials(i.withCredentials),a.load(t,(function(t){let n;try{n=i.parse(t)}catch(t){if(void 0===r)return void console.error(t);r(t)}void 0!==n.image?o.image=n.image:void 0!==n.data&&(o.image.width=n.width,o.image.height=n.height,o.image.data=n.data),o.wrapS=void 0!==n.wrapS?n.wrapS:X,o.wrapT=void 0!==n.wrapT?n.wrapT:X,o.magFilter=void 0!==n.magFilter?n.magFilter:Q,o.minFilter=void 0!==n.minFilter?n.minFilter:Q,o.anisotropy=void 0!==n.anisotropy?n.anisotropy:1,void 0!==n.colorSpace&&(o.colorSpace=n.colorSpace),void 0!==n.flipY&&(o.flipY=n.flipY),void 0!==n.format&&(o.format=n.format),void 0!==n.type&&(o.type=n.type),void 0!==n.mipmaps&&(o.mipmaps=n.mipmaps,o.minFilter=tt),1===n.mipmapCount&&(o.minFilter=Q),void 0!==n.generateMipmaps&&(o.generateMipmaps=n.generateMipmaps),o.needsUpdate=!0,e&&e(o,n)}),n,r),o}},e.DataUtils=Fr,e.DecrementStencilOp=7683,e.DecrementWrapStencilOp=34056,e.DefaultLoadingManager=af,e.DepthFormat=ft,e.DepthStencilFormat=ht,e.DepthTexture=Ao,e.DetachedBindMode=D,e.DirectionalLight=Ef,e.DirectionalLightHelper=class extends mr{constructor(t,e,n){super(),this.light=t,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=n,this.type="DirectionalLightHelper",void 0===e&&(e=1);let r=new ti;r.setAttribute("position",new qr([-e,e,0,e,e,0,e,-e,0,-e,-e,0,-e,e,0],3));const i=new Fu({fog:!1,toneMapped:!1});this.lightPlane=new qu(r,i),this.add(this.lightPlane),r=new ti,r.setAttribute("position",new qr([0,0,0,0,0,1],3)),this.targetLine=new qu(r,i),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),Eh.setFromMatrixPosition(this.light.matrixWorld),Ah.setFromMatrixPosition(this.light.target.matrixWorld),Oh.subVectors(Ah,Eh),this.lightPlane.lookAt(Ah),void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(Ah),this.targetLine.scale.z=Oh.length()}},e.DiscreteInterpolant=ql,e.DisplayP3ColorSpace=ie,e.DodecahedronGeometry=Nc,e.DoubleSide=2,e.DstAlphaFactor=206,e.DstColorFactor=208,e.DynamicCopyUsage=35050,e.DynamicDrawUsage=35048,e.DynamicReadUsage=35049,e.EdgesGeometry=Uc,e.EllipseCurve=ac,e.EqualCompare=514,e.EqualDepth=4,e.EqualStencilFunc=514,e.EquirectangularReflectionMapping=G,e.EquirectangularRefractionMapping=H,e.Euler=Qn,e.EventDispatcher=Se,e.ExtrudeGeometry=pl,e.FileLoader=lf,e.Float16BufferAttribute=class extends Gr{constructor(t,e,n){super(new Uint16Array(t),e,n),this.isFloat16BufferAttribute=!0}getX(t){let e=Dr(this.array[t*this.itemSize]);return this.normalized&&(e=Ce(e,this.array)),e}setX(t,e){return this.normalized&&(e=Ne(e,this.array)),this.array[t*this.itemSize]=Ur(e),this}getY(t){let e=Dr(this.array[t*this.itemSize+1]);return this.normalized&&(e=Ce(e,this.array)),e}setY(t,e){return this.normalized&&(e=Ne(e,this.array)),this.array[t*this.itemSize+1]=Ur(e),this}getZ(t){let e=Dr(this.array[t*this.itemSize+2]);return this.normalized&&(e=Ce(e,this.array)),e}setZ(t,e){return this.normalized&&(e=Ne(e,this.array)),this.array[t*this.itemSize+2]=Ur(e),this}getW(t){let e=Dr(this.array[t*this.itemSize+3]);return this.normalized&&(e=Ce(e,this.array)),e}setW(t,e){return this.normalized&&(e=Ne(e,this.array)),this.array[t*this.itemSize+3]=Ur(e),this}setXY(t,e,n){return t*=this.itemSize,this.normalized&&(e=Ne(e,this.array),n=Ne(n,this.array)),this.array[t+0]=Ur(e),this.array[t+1]=Ur(n),this}setXYZ(t,e,n,r){return t*=this.itemSize,this.normalized&&(e=Ne(e,this.array),n=Ne(n,this.array),r=Ne(r,this.array)),this.array[t+0]=Ur(e),this.array[t+1]=Ur(n),this.array[t+2]=Ur(r),this}setXYZW(t,e,n,r,i){return t*=this.itemSize,this.normalized&&(e=Ne(e,this.array),n=Ne(n,this.array),r=Ne(r,this.array),i=Ne(i,this.array)),this.array[t+0]=Ur(e),this.array[t+1]=Ur(n),this.array[t+2]=Ur(r),this.array[t+3]=Ur(i),this}},e.Float32BufferAttribute=qr,e.FloatType=ot,e.Fog=Ps,e.FogExp2=Os,e.FramebufferTexture=class extends on{constructor(t,e){super({width:t,height:e}),this.isFramebufferTexture=!0,this.magFilter=J,this.minFilter=J,this.generateMipmaps=!1,this.needsUpdate=!0}},e.FrontSide=0,e.Frustum=zi,e.GLBufferAttribute=class{constructor(t,e,n,r,i){this.isGLBufferAttribute=!0,this.name="",this.buffer=t,this.type=e,this.itemSize=n,this.elementSize=r,this.count=i,this.version=0}set needsUpdate(t){!0===t&&this.version++}setBuffer(t){return this.buffer=t,this}setType(t,e){return this.type=t,this.elementSize=e,this}setItemSize(t){return this.itemSize=t,this}setCount(t){return this.count=t,this}},e.GLSL1="100",e.GLSL3=_e,e.GreaterCompare=516,e.GreaterDepth=6,e.GreaterEqualCompare=518,e.GreaterEqualDepth=5,e.GreaterEqualStencilFunc=518,e.GreaterStencilFunc=516,e.GridHelper=class extends Ju{constructor(t=10,e=10,n=4473924,r=8947848){n=new kr(n),r=new kr(r);const i=e/2,o=t/e,a=t/2,s=[],u=[];for(let t=0,c=0,l=-a;t<=e;t++,l+=o){s.push(-a,0,l,a,0,l),s.push(l,0,-a,l,0,a);const e=t===i?n:r;e.toArray(u,c),c+=3,e.toArray(u,c),c+=3,e.toArray(u,c),c+=3,e.toArray(u,c),c+=3}const c=new ti;c.setAttribute("position",new qr(s,3)),c.setAttribute("color",new qr(u,3)),super(c,new Fu({vertexColors:!0,toneMapped:!1})),this.type="GridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}},e.Group=bs,e.HalfFloatType=at,e.HemisphereLight=pf,e.HemisphereLightHelper=class extends mr{constructor(t,e,n){super(),this.light=t,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=n,this.type="HemisphereLightHelper";const r=new yl(e);r.rotateY(.5*Math.PI),this.material=new jr({wireframe:!0,fog:!1,toneMapped:!1}),void 0===this.color&&(this.material.vertexColors=!0);const i=r.getAttribute("position"),o=new Float32Array(3*i.count);r.setAttribute("color",new Gr(o,3)),this.add(new gi(r,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const t=this.children[0];if(void 0!==this.color)this.material.color.set(this.color);else{const e=t.geometry.getAttribute("color");Th.copy(this.light.color),Mh.copy(this.light.groundColor);for(let t=0,n=e.count;t<n;t++){const r=t<n/2?Th:Mh;e.setXYZ(t,r.r,r.g,r.b)}e.needsUpdate=!0}this.light.updateWorldMatrix(!0,!1),t.lookAt(Sh.setFromMatrixPosition(this.light.matrixWorld).negate())}},e.IcosahedronGeometry=ml,e.ImageBitmapLoader=class extends sf{constructor(t){super(t),this.isImageBitmapLoader=!0,"undefined"==typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"==typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(t){return this.options=t,this}load(t,e,n,r){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const i=this,o=rf.get(t);if(void 0!==o)return i.manager.itemStart(t),o.then?void o.then((n=>{e&&e(n),i.manager.itemEnd(t)})).catch((t=>{r&&r(t)})):(setTimeout((function(){e&&e(o),i.manager.itemEnd(t)}),0),o);const a={};a.credentials="anonymous"===this.crossOrigin?"same-origin":"include",a.headers=this.requestHeader;const s=fetch(t,a).then((function(t){return t.blob()})).then((function(t){return createImageBitmap(t,Object.assign(i.options,{colorSpaceConversion:"none"}))})).then((function(n){return rf.add(t,n),e&&e(n),i.manager.itemEnd(t),n})).catch((function(e){r&&r(e),rf.remove(t),i.manager.itemError(t),i.manager.itemEnd(t)}));rf.add(t,s),i.manager.itemStart(t)}},e.ImageLoader=ff,e.ImageUtils=$e,e.IncrementStencilOp=7682,e.IncrementWrapStencilOp=34055,e.InstancedBufferAttribute=du,e.InstancedBufferGeometry=Nf,e.InstancedInterleavedBuffer=class extends ks{constructor(t,e,n=1){super(t,e),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=n}copy(t){return super.copy(t),this.meshPerAttribute=t.meshPerAttribute,this}clone(t){const e=super.clone(t);return e.meshPerAttribute=this.meshPerAttribute,e}toJSON(t){const e=super.toJSON(t);return e.isInstancedInterleavedBuffer=!0,e.meshPerAttribute=this.meshPerAttribute,e}},e.InstancedMesh=wu,e.Int16BufferAttribute=class extends Gr{constructor(t,e,n){super(new Int16Array(t),e,n)}},e.Int32BufferAttribute=class extends Gr{constructor(t,e,n){super(new Int32Array(t),e,n)}},e.Int8BufferAttribute=class extends Gr{constructor(t,e,n){super(new Int8Array(t),e,n)}},e.IntType=rt,e.InterleavedBuffer=ks,e.InterleavedBufferAttribute=Ns,e.Interpolant=Gl,e.InterpolateDiscrete=Yt,e.InterpolateLinear=Jt,e.InterpolateSmooth=Zt,e.InvertStencilOp=5386,e.KeepStencilOp=le,e.KeyframeTrack=Xl,e.LOD=Qs,e.LatheGeometry=Ac,e.Layers=$n,e.LessCompare=513,e.LessDepth=2,e.LessEqualCompare=515,e.LessEqualDepth=3,e.LessEqualStencilFunc=515,e.LessStencilFunc=513,e.Light=hf,e.LightProbe=Rf,e.Line=qu,e.Line3=class{constructor(t=new hn,e=new hn){this.start=t,this.end=e}set(t,e){return this.start.copy(t),this.end.copy(e),this}copy(t){return this.start.copy(t.start),this.end.copy(t.end),this}getCenter(t){return t.addVectors(this.start,this.end).multiplyScalar(.5)}delta(t){return t.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(t,e){return this.delta(e).multiplyScalar(t).add(this.start)}closestPointToPointParameter(t,e){yh.subVectors(t,this.start),vh.subVectors(this.end,this.start);const n=vh.dot(vh);let r=vh.dot(yh)/n;return e&&(r=Pe(r,0,1)),r}closestPointToPoint(t,e,n){const r=this.closestPointToPointParameter(t,e);return this.delta(n).multiplyScalar(r).add(this.start)}applyMatrix4(t){return this.start.applyMatrix4(t),this.end.applyMatrix4(t),this}equals(t){return t.start.equals(this.start)&&t.end.equals(this.end)}clone(){return(new this.constructor).copy(this)}},e.LineBasicMaterial=Fu,e.LineCurve=bc,e.LineCurve3=_c,e.LineDashedMaterial=Il,e.LineLoop=Zu,e.LineSegments=Ju,e.LinearDisplayP3ColorSpace=oe,e.LinearFilter=Q,e.LinearInterpolant=Wl,e.LinearMipMapLinearFilter=1008,e.LinearMipMapNearestFilter=1007,e.LinearMipmapLinearFilter=tt,e.LinearMipmapNearestFilter=$,e.LinearSRGBColorSpace=re,e.LinearToneMapping=k,e.LinearTransfer=ae,e.Loader=sf,e.LoaderUtils=Cf,e.LoadingManager=of,e.LoopOnce=2200,e.LoopPingPong=2202,e.LoopRepeat=2201,e.LuminanceAlphaFormat=1025,e.LuminanceFormat=1024,e.MOUSE={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},e.Material=Lr,e.MaterialLoader=kf,e.MathUtils=Le,e.Matrix3=Ie,e.Matrix4=Vn,e.MaxEquation=104,e.Mesh=gi,e.MeshBasicMaterial=jr,e.MeshDepthMaterial=hs,e.MeshDistanceMaterial=ps,e.MeshLambertMaterial=Ll,e.MeshMatcapMaterial=jl,e.MeshNormalMaterial=Nl,e.MeshPhongMaterial=kl,e.MeshPhysicalMaterial=Rl,e.MeshStandardMaterial=Pl,e.MeshToonMaterial=Cl,e.MinEquation=103,e.MirroredRepeatWrapping=Y,e.MixOperation=O,e.MultiplyBlending=4,e.MultiplyOperation=A,e.NearestFilter=J,e.NearestMipMapLinearFilter=1005,e.NearestMipMapNearestFilter=1004,e.NearestMipmapLinearFilter=K,e.NearestMipmapNearestFilter=Z,e.NeutralToneMapping=B,e.NeverCompare=512,e.NeverDepth=0,e.NeverStencilFunc=512,e.NoBlending=0,e.NoColorSpace=ee,e.NoToneMapping=R,e.NormalAnimationBlendMode=2500,e.NormalBlending=1,e.NotEqualCompare=517,e.NotEqualDepth=7,e.NotEqualStencilFunc=517,e.NumberKeyframeTrack=Zl,e.Object3D=mr,e.ObjectLoader=class extends sf{constructor(t){super(t)}load(t,e,n,r){const i=this,o=""===this.path?Cf.extractUrlBase(t):this.path;this.resourcePath=this.resourcePath||o;const a=new lf(this.manager);a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(t,(function(n){let o=null;try{o=JSON.parse(n)}catch(e){return void 0!==r&&r(e),void console.error("THREE:ObjectLoader: Can't parse "+t+".",e.message)}const a=o.metadata;if(void 0===a||void 0===a.type||"geometry"===a.type.toLowerCase())return void 0!==r&&r(new Error("THREE.ObjectLoader: Can't load "+t)),void console.error("THREE.ObjectLoader: Can't load "+t);i.parse(o,e)}),n,r)}async loadAsync(t,e){const n=""===this.path?Cf.extractUrlBase(t):this.path;this.resourcePath=this.resourcePath||n;const r=new lf(this.manager);r.setPath(this.path),r.setRequestHeader(this.requestHeader),r.setWithCredentials(this.withCredentials);const i=await r.loadAsync(t,e),o=JSON.parse(i),a=o.metadata;if(void 0===a||void 0===a.type||"geometry"===a.type.toLowerCase())throw new Error("THREE.ObjectLoader: Can't load "+t);return await this.parseAsync(o)}parse(t,e){const n=this.parseAnimations(t.animations),r=this.parseShapes(t.shapes),i=this.parseGeometries(t.geometries,r),o=this.parseImages(t.images,(function(){void 0!==e&&e(u)})),a=this.parseTextures(t.textures,o),s=this.parseMaterials(t.materials,a),u=this.parseObject(t.object,i,s,a,n),c=this.parseSkeletons(t.skeletons,u);if(this.bindSkeletons(u,c),void 0!==e){let t=!1;for(const e in o)if(o[e].data instanceof HTMLImageElement){t=!0;break}!1===t&&e(u)}return u}async parseAsync(t){const e=this.parseAnimations(t.animations),n=this.parseShapes(t.shapes),r=this.parseGeometries(t.geometries,n),i=await this.parseImagesAsync(t.images),o=this.parseTextures(t.textures,i),a=this.parseMaterials(t.materials,o),s=this.parseObject(t.object,r,a,o,e),u=this.parseSkeletons(t.skeletons,s);return this.bindSkeletons(s,u),s}parseShapes(t){const e={};if(void 0!==t)for(let n=0,r=t.length;n<r;n++){const r=(new Dc).fromJSON(t[n]);e[r.uuid]=r}return e}parseSkeletons(t,e){const n={},r={};if(e.traverse((function(t){t.isBone&&(r[t.uuid]=t)})),void 0!==t)for(let e=0,i=t.length;e<i;e++){const i=(new pu).fromJSON(t[e],r);n[i.uuid]=i}return n}parseGeometries(t,e){const n={};if(void 0!==t){const r=new Lf;for(let i=0,o=t.length;i<o;i++){let o;const a=t[i];switch(a.type){case"BufferGeometry":case"InstancedBufferGeometry":o=r.parse(a);break;default:a.type in El?o=El[a.type].fromJSON(a,e):console.warn(`THREE.ObjectLoader: Unsupported geometry type "${a.type}"`)}o.uuid=a.uuid,void 0!==a.name&&(o.name=a.name),void 0!==a.userData&&(o.userData=a.userData),n[a.uuid]=o}}return n}parseMaterials(t,e){const n={},r={};if(void 0!==t){const i=new kf;i.setTextures(e);for(let e=0,o=t.length;e<o;e++){const o=t[e];void 0===n[o.uuid]&&(n[o.uuid]=i.parse(o)),r[o.uuid]=n[o.uuid]}}return r}parseAnimations(t){const e={};if(void 0!==t)for(let n=0;n<t.length;n++){const r=t[n],i=ef.parse(r);e[i.uuid]=i}return e}parseImages(t,e){const n=this,r={};let i;function o(t){if("string"==typeof t){const e=t;return function(t){return n.manager.itemStart(t),i.load(t,(function(){n.manager.itemEnd(t)}),void 0,(function(){n.manager.itemError(t),n.manager.itemEnd(t)}))}(/^(\/\/)|([a-z]+:(\/\/)?)/i.test(e)?e:n.resourcePath+e)}return t.data?{data:Fe(t.type,t.data),width:t.width,height:t.height}:null}if(void 0!==t&&t.length>0){const n=new of(e);i=new ff(n),i.setCrossOrigin(this.crossOrigin);for(let e=0,n=t.length;e<n;e++){const n=t[e],i=n.url;if(Array.isArray(i)){const t=[];for(let e=0,n=i.length;e<n;e++){const n=o(i[e]);null!==n&&(n instanceof HTMLImageElement?t.push(n):t.push(new lu(n.data,n.width,n.height)))}r[n.uuid]=new en(t)}else{const t=o(n.url);r[n.uuid]=new en(t)}}}return r}async parseImagesAsync(t){const e=this,n={};let r;async function i(t){if("string"==typeof t){const n=t,i=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(n)?n:e.resourcePath+n;return await r.loadAsync(i)}return t.data?{data:Fe(t.type,t.data),width:t.width,height:t.height}:null}if(void 0!==t&&t.length>0){r=new ff(this.manager),r.setCrossOrigin(this.crossOrigin);for(let e=0,r=t.length;e<r;e++){const r=t[e],o=r.url;if(Array.isArray(o)){const t=[];for(let e=0,n=o.length;e<n;e++){const n=o[e],r=await i(n);null!==r&&(r instanceof HTMLImageElement?t.push(r):t.push(new lu(r.data,r.width,r.height)))}n[r.uuid]=new en(t)}else{const t=await i(r.url);n[r.uuid]=new en(t)}}}return n}parseTextures(t,e){function n(t,e){return"number"==typeof t?t:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",t),e[t])}const r={};if(void 0!==t)for(let i=0,o=t.length;i<o;i++){const o=t[i];void 0===o.image&&console.warn('THREE.ObjectLoader: No "image" specified for',o.uuid),void 0===e[o.image]&&console.warn("THREE.ObjectLoader: Undefined image",o.image);const a=e[o.image],s=a.data;let u;Array.isArray(s)?(u=new Ni,6===s.length&&(u.needsUpdate=!0)):(u=s&&s.data?new lu:new on,s&&(u.needsUpdate=!0)),u.source=a,u.uuid=o.uuid,void 0!==o.name&&(u.name=o.name),void 0!==o.mapping&&(u.mapping=n(o.mapping,jf)),void 0!==o.channel&&(u.channel=o.channel),void 0!==o.offset&&u.offset.fromArray(o.offset),void 0!==o.repeat&&u.repeat.fromArray(o.repeat),void 0!==o.center&&u.center.fromArray(o.center),void 0!==o.rotation&&(u.rotation=o.rotation),void 0!==o.wrap&&(u.wrapS=n(o.wrap[0],If),u.wrapT=n(o.wrap[1],If)),void 0!==o.format&&(u.format=o.format),void 0!==o.internalFormat&&(u.internalFormat=o.internalFormat),void 0!==o.type&&(u.type=o.type),void 0!==o.colorSpace&&(u.colorSpace=o.colorSpace),void 0!==o.minFilter&&(u.minFilter=n(o.minFilter,Bf)),void 0!==o.magFilter&&(u.magFilter=n(o.magFilter,Bf)),void 0!==o.anisotropy&&(u.anisotropy=o.anisotropy),void 0!==o.flipY&&(u.flipY=o.flipY),void 0!==o.generateMipmaps&&(u.generateMipmaps=o.generateMipmaps),void 0!==o.premultiplyAlpha&&(u.premultiplyAlpha=o.premultiplyAlpha),void 0!==o.unpackAlignment&&(u.unpackAlignment=o.unpackAlignment),void 0!==o.compareFunction&&(u.compareFunction=o.compareFunction),void 0!==o.userData&&(u.userData=o.userData),r[o.uuid]=u}return r}parseObject(t,e,n,r,i){let o,a,s;function u(t){return void 0===e[t]&&console.warn("THREE.ObjectLoader: Undefined geometry",t),e[t]}function c(t){if(void 0!==t){if(Array.isArray(t)){const e=[];for(let r=0,i=t.length;r<i;r++){const i=t[r];void 0===n[i]&&console.warn("THREE.ObjectLoader: Undefined material",i),e.push(n[i])}return e}return void 0===n[t]&&console.warn("THREE.ObjectLoader: Undefined material",t),n[t]}}function l(t){return void 0===r[t]&&console.warn("THREE.ObjectLoader: Undefined texture",t),r[t]}switch(t.type){case"Scene":o=new Rs,void 0!==t.background&&(Number.isInteger(t.background)?o.background=new kr(t.background):o.background=l(t.background)),void 0!==t.environment&&(o.environment=l(t.environment)),void 0!==t.fog&&("Fog"===t.fog.type?o.fog=new Ps(t.fog.color,t.fog.near,t.fog.far):"FogExp2"===t.fog.type&&(o.fog=new Os(t.fog.color,t.fog.density)),""!==t.fog.name&&(o.fog.name=t.fog.name)),void 0!==t.backgroundBlurriness&&(o.backgroundBlurriness=t.backgroundBlurriness),void 0!==t.backgroundIntensity&&(o.backgroundIntensity=t.backgroundIntensity),void 0!==t.backgroundRotation&&o.backgroundRotation.fromArray(t.backgroundRotation),void 0!==t.environmentIntensity&&(o.environmentIntensity=t.environmentIntensity),void 0!==t.environmentRotation&&o.environmentRotation.fromArray(t.environmentRotation);break;case"PerspectiveCamera":o=new Ri(t.fov,t.aspect,t.near,t.far),void 0!==t.focus&&(o.focus=t.focus),void 0!==t.zoom&&(o.zoom=t.zoom),void 0!==t.filmGauge&&(o.filmGauge=t.filmGauge),void 0!==t.filmOffset&&(o.filmOffset=t.filmOffset),void 0!==t.view&&(o.view=Object.assign({},t.view));break;case"OrthographicCamera":o=new ro(t.left,t.right,t.top,t.bottom,t.near,t.far),void 0!==t.zoom&&(o.zoom=t.zoom),void 0!==t.view&&(o.view=Object.assign({},t.view));break;case"AmbientLight":o=new Af(t.color,t.intensity);break;case"DirectionalLight":o=new Ef(t.color,t.intensity);break;case"PointLight":o=new Tf(t.color,t.intensity,t.distance,t.decay);break;case"RectAreaLight":o=new Of(t.color,t.intensity,t.width,t.height);break;case"SpotLight":o=new bf(t.color,t.intensity,t.distance,t.angle,t.penumbra,t.decay);break;case"HemisphereLight":o=new pf(t.color,t.groundColor,t.intensity);break;case"LightProbe":o=(new Rf).fromJSON(t);break;case"SkinnedMesh":a=u(t.geometry),s=c(t.material),o=new uu(a,s),void 0!==t.bindMode&&(o.bindMode=t.bindMode),void 0!==t.bindMatrix&&o.bindMatrix.fromArray(t.bindMatrix),void 0!==t.skeleton&&(o.skeleton=t.skeleton);break;case"Mesh":a=u(t.geometry),s=c(t.material),o=new gi(a,s);break;case"InstancedMesh":a=u(t.geometry),s=c(t.material);const e=t.count,n=t.instanceMatrix,r=t.instanceColor;o=new wu(a,s,e),o.instanceMatrix=new du(new Float32Array(n.array),16),void 0!==r&&(o.instanceColor=new du(new Float32Array(r.array),r.itemSize));break;case"BatchedMesh":a=u(t.geometry),s=c(t.material),o=new Du(t.maxGeometryCount,t.maxVertexCount,t.maxIndexCount,s),o.geometry=a,o.perObjectFrustumCulled=t.perObjectFrustumCulled,o.sortObjects=t.sortObjects,o._drawRanges=t.drawRanges,o._reservedRanges=t.reservedRanges,o._visibility=t.visibility,o._active=t.active,o._bounds=t.bounds.map((t=>{const e=new mn;e.min.fromArray(t.boxMin),e.max.fromArray(t.boxMax);const n=new Nn;return n.radius=t.sphereRadius,n.center.fromArray(t.sphereCenter),{boxInitialized:t.boxInitialized,box:e,sphereInitialized:t.sphereInitialized,sphere:n}})),o._maxGeometryCount=t.maxGeometryCount,o._maxVertexCount=t.maxVertexCount,o._maxIndexCount=t.maxIndexCount,o._geometryInitialized=t.geometryInitialized,o._geometryCount=t.geometryCount,o._matricesTexture=l(t.matricesTexture.uuid);break;case"LOD":o=new Qs;break;case"Line":o=new qu(u(t.geometry),c(t.material));break;case"LineLoop":o=new Zu(u(t.geometry),c(t.material));break;case"LineSegments":o=new Ju(u(t.geometry),c(t.material));break;case"PointCloud":case"Points":o=new nc(u(t.geometry),c(t.material));break;case"Sprite":o=new Ys(c(t.material));break;case"Group":o=new bs;break;case"Bone":o=new cu;break;default:o=new mr}if(o.uuid=t.uuid,void 0!==t.name&&(o.name=t.name),void 0!==t.matrix?(o.matrix.fromArray(t.matrix),void 0!==t.matrixAutoUpdate&&(o.matrixAutoUpdate=t.matrixAutoUpdate),o.matrixAutoUpdate&&o.matrix.decompose(o.position,o.quaternion,o.scale)):(void 0!==t.position&&o.position.fromArray(t.position),void 0!==t.rotation&&o.rotation.fromArray(t.rotation),void 0!==t.quaternion&&o.quaternion.fromArray(t.quaternion),void 0!==t.scale&&o.scale.fromArray(t.scale)),void 0!==t.up&&o.up.fromArray(t.up),void 0!==t.castShadow&&(o.castShadow=t.castShadow),void 0!==t.receiveShadow&&(o.receiveShadow=t.receiveShadow),t.shadow&&(void 0!==t.shadow.bias&&(o.shadow.bias=t.shadow.bias),void 0!==t.shadow.normalBias&&(o.shadow.normalBias=t.shadow.normalBias),void 0!==t.shadow.radius&&(o.shadow.radius=t.shadow.radius),void 0!==t.shadow.mapSize&&o.shadow.mapSize.fromArray(t.shadow.mapSize),void 0!==t.shadow.camera&&(o.shadow.camera=this.parseObject(t.shadow.camera))),void 0!==t.visible&&(o.visible=t.visible),void 0!==t.frustumCulled&&(o.frustumCulled=t.frustumCulled),void 0!==t.renderOrder&&(o.renderOrder=t.renderOrder),void 0!==t.userData&&(o.userData=t.userData),void 0!==t.layers&&(o.layers.mask=t.layers),void 0!==t.children){const a=t.children;for(let t=0;t<a.length;t++)o.add(this.parseObject(a[t],e,n,r,i))}if(void 0!==t.animations){const e=t.animations;for(let t=0;t<e.length;t++){const n=e[t];o.animations.push(i[n])}}if("LOD"===t.type){void 0!==t.autoUpdate&&(o.autoUpdate=t.autoUpdate);const e=t.levels;for(let t=0;t<e.length;t++){const n=e[t],r=o.getObjectByProperty("uuid",n.object);void 0!==r&&o.addLevel(r,n.distance,n.hysteresis)}}return o}bindSkeletons(t,e){0!==Object.keys(e).length&&t.traverse((function(t){if(!0===t.isSkinnedMesh&&void 0!==t.skeleton){const n=e[t.skeleton];void 0===n?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",t.skeleton):t.bind(n,t.bindMatrix)}}))}},e.ObjectSpaceNormalMap=1,e.OctahedronGeometry=yl,e.OneFactor=201,e.OneMinusConstantAlphaFactor=214,e.OneMinusConstantColorFactor=212,e.OneMinusDstAlphaFactor=207,e.OneMinusDstColorFactor=209,e.OneMinusSrcAlphaFactor=v,e.OneMinusSrcColorFactor=203,e.OrthographicCamera=ro,e.P3Primaries=ce,e.PCFShadowMap=r,e.PCFSoftShadowMap=i,e.PMREMGenerator=mo,e.Path=Ec,e.PerspectiveCamera=Ri,e.Plane=Ui,e.PlaneGeometry=Hi,e.PlaneHelper=class extends qu{constructor(t,e=1,n=16776960){const r=n,i=new ti;i.setAttribute("position",new qr([1,-1,0,-1,1,0,-1,-1,0,1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],3)),i.computeBoundingSphere(),super(i,new Fu({color:r,toneMapped:!1})),this.type="PlaneHelper",this.plane=t,this.size=e;const o=new ti;o.setAttribute("position",new qr([1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],3)),o.computeBoundingSphere(),this.add(new gi(o,new jr({color:r,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(t){this.position.set(0,0,0),this.scale.set(.5*this.size,.5*this.size,1),this.lookAt(this.plane.normal),this.translateZ(-this.plane.constant),super.updateMatrixWorld(t)}dispose(){this.geometry.dispose(),this.material.dispose(),this.children[0].geometry.dispose(),this.children[0].material.dispose()}},e.PointLight=Tf,e.PointLightHelper=class extends gi{constructor(t,e,n){super(new bl(e,4,2),new jr({wireframe:!0,fog:!1,toneMapped:!1})),this.light=t,this.color=n,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)}},e.Points=nc,e.PointsMaterial=Ku,e.PolarGridHelper=class extends Ju{constructor(t=10,e=16,n=8,r=64,i=4473924,o=8947848){i=new kr(i),o=new kr(o);const a=[],s=[];if(e>1)for(let n=0;n<e;n++){const r=n/e*(2*Math.PI),u=Math.sin(r)*t,c=Math.cos(r)*t;a.push(0,0,0),a.push(u,0,c);const l=1&n?i:o;s.push(l.r,l.g,l.b),s.push(l.r,l.g,l.b)}for(let e=0;e<n;e++){const u=1&e?i:o,c=t-t/n*e;for(let t=0;t<r;t++){let e=t/r*(2*Math.PI),n=Math.sin(e)*c,i=Math.cos(e)*c;a.push(n,0,i),s.push(u.r,u.g,u.b),e=(t+1)/r*(2*Math.PI),n=Math.sin(e)*c,i=Math.cos(e)*c,a.push(n,0,i),s.push(u.r,u.g,u.b)}}const u=new ti;u.setAttribute("position",new qr(a,3)),u.setAttribute("color",new qr(s,3)),super(u,new Fu({vertexColors:!0,toneMapped:!1})),this.type="PolarGridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}},e.PolyhedronGeometry=Cc,e.PositionalAudio=class extends Jf{constructor(t){super(t),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}connect(){super.connect(),this.panner.connect(this.gain)}disconnect(){super.disconnect(),this.panner.disconnect(this.gain)}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(t){return this.panner.refDistance=t,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(t){return this.panner.rolloffFactor=t,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(t){return this.panner.distanceModel=t,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(t){return this.panner.maxDistance=t,this}setDirectionalCone(t,e,n){return this.panner.coneInnerAngle=t,this.panner.coneOuterAngle=e,this.panner.coneOuterGain=n,this}updateMatrixWorld(t){if(super.updateMatrixWorld(t),!0===this.hasPlaybackControl&&!1===this.isPlaying)return;this.matrixWorld.decompose(Zf,Kf,Qf),$f.set(0,0,1).applyQuaternion(Kf);const e=this.panner;if(e.positionX){const t=this.context.currentTime+this.listener.timeDelta;e.positionX.linearRampToValueAtTime(Zf.x,t),e.positionY.linearRampToValueAtTime(Zf.y,t),e.positionZ.linearRampToValueAtTime(Zf.z,t),e.orientationX.linearRampToValueAtTime($f.x,t),e.orientationY.linearRampToValueAtTime($f.y,t),e.orientationZ.linearRampToValueAtTime($f.z,t)}else e.setPosition(Zf.x,Zf.y,Zf.z),e.setOrientation($f.x,$f.y,$f.z)}},e.PropertyBinding=sh,e.PropertyMixer=th,e.QuadraticBezierCurve=xc,e.QuadraticBezierCurve3=wc,e.Quaternion=fn,e.QuaternionKeyframeTrack=Ql,e.QuaternionLinearInterpolant=Kl,e.RED_GREEN_RGTC2_Format=qt,e.RED_RGTC1_Format=36283,e.REVISION=n,e.RGBADepthPacking=3201,e.RGBAFormat=lt,e.RGBAIntegerFormat=yt,e.RGBA_ASTC_10x10_Format=Dt,e.RGBA_ASTC_10x5_Format=It,e.RGBA_ASTC_10x6_Format=Bt,e.RGBA_ASTC_10x8_Format=Ut,e.RGBA_ASTC_12x10_Format=Ft,e.RGBA_ASTC_12x12_Format=zt,e.RGBA_ASTC_4x4_Format=Ot,e.RGBA_ASTC_5x4_Format=Pt,e.RGBA_ASTC_5x5_Format=Rt,e.RGBA_ASTC_6x5_Format=kt,e.RGBA_ASTC_6x6_Format=Ct,e.RGBA_ASTC_8x5_Format=Nt,e.RGBA_ASTC_8x6_Format=Lt,e.RGBA_ASTC_8x8_Format=jt,e.RGBA_BPTC_Format=Vt,e.RGBA_ETC2_EAC_Format=At,e.RGBA_PVRTC_2BPPV1_Format=Tt,e.RGBA_PVRTC_4BPPV1_Format=St,e.RGBA_S3TC_DXT1_Format=gt,e.RGBA_S3TC_DXT3_Format=bt,e.RGBA_S3TC_DXT5_Format=_t,e.RGBFormat=1022,e.RGB_BPTC_SIGNED_Format=Gt,e.RGB_BPTC_UNSIGNED_Format=Ht,e.RGB_ETC1_Format=Mt,e.RGB_ETC2_Format=Et,e.RGB_PVRTC_2BPPV1_Format=wt,e.RGB_PVRTC_4BPPV1_Format=xt,e.RGB_S3TC_DXT1_Format=vt,e.RGFormat=1030,e.RGIntegerFormat=mt,e.RawShaderMaterial=Ol,e.Ray=zn,e.Raycaster=class{constructor(t,e,n=0,r=1/0){this.ray=new zn(t,e),this.near=n,this.far=r,this.camera=null,this.layers=new $n,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(t,e){this.ray.set(t,e)}setFromCamera(t,e){e.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(t.x,t.y,.5).unproject(e).sub(this.ray.origin).normalize(),this.camera=e):e.isOrthographicCamera?(this.ray.origin.set(t.x,t.y,(e.near+e.far)/(e.near-e.far)).unproject(e),this.ray.direction.set(0,0,-1).transformDirection(e.matrixWorld),this.camera=e):console.error("THREE.Raycaster: Unsupported camera type: "+e.type)}setFromXRController(t){return hh.identity().extractRotation(t.matrixWorld),this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(0,0,-1).applyMatrix4(hh),this}intersectObject(t,e=!0,n=[]){return dh(t,this,n,e),n.sort(ph),n}intersectObjects(t,e=!0,n=[]){for(let r=0,i=t.length;r<i;r++)dh(t[r],this,n,e);return n.sort(ph),n}},e.Rec709Primaries=ue,e.RectAreaLight=Of,e.RedFormat=pt,e.RedIntegerFormat=dt,e.ReinhardToneMapping=C,e.RenderTarget=sn,e.RepeatWrapping=q,e.ReplaceStencilOp=7681,e.ReverseSubtractEquation=102,e.RingGeometry=vl,e.SIGNED_RED_GREEN_RGTC2_Format=Xt,e.SIGNED_RED_RGTC1_Format=Wt,e.SRGBColorSpace=ne,e.SRGBTransfer=se,e.Scene=Rs,e.ShaderChunk=Wi,e.ShaderLib=Xi,e.ShaderMaterial=Mi,e.ShadowMaterial=Al,e.Shape=Dc,e.ShapeGeometry=gl,e.ShapePath=class{constructor(){this.type="ShapePath",this.color=new kr,this.subPaths=[],this.currentPath=null}moveTo(t,e){return this.currentPath=new Ec,this.subPaths.push(this.currentPath),this.currentPath.moveTo(t,e),this}lineTo(t,e){return this.currentPath.lineTo(t,e),this}quadraticCurveTo(t,e,n,r){return this.currentPath.quadraticCurveTo(t,e,n,r),this}bezierCurveTo(t,e,n,r,i,o){return this.currentPath.bezierCurveTo(t,e,n,r,i,o),this}splineThru(t){return this.currentPath.splineThru(t),this}toShapes(t){function e(t,e){const n=e.length;let r=!1;for(let i=n-1,o=0;o<n;i=o++){let n=e[i],a=e[o],s=a.x-n.x,u=a.y-n.y;if(Math.abs(u)>Number.EPSILON){if(u<0&&(n=e[o],s=-s,a=e[i],u=-u),t.y<n.y||t.y>a.y)continue;if(t.y===n.y){if(t.x===n.x)return!0}else{const e=u*(t.x-n.x)-s*(t.y-n.y);if(0===e)return!0;if(e<0)continue;r=!r}}else{if(t.y!==n.y)continue;if(a.x<=t.x&&t.x<=n.x||n.x<=t.x&&t.x<=a.x)return!0}}return r}const n=ll.isClockWise,r=this.subPaths;if(0===r.length)return[];let i,o,a;const s=[];if(1===r.length)return o=r[0],a=new Dc,a.curves=o.curves,s.push(a),s;let u=!n(r[0].getPoints());u=t?!u:u;const c=[],l=[];let f,h,p=[],d=0;l[d]=void 0,p[d]=[];for(let e=0,a=r.length;e<a;e++)o=r[e],f=o.getPoints(),i=n(f),i=t?!i:i,i?(!u&&l[d]&&d++,l[d]={s:new Dc,p:f},l[d].s.curves=o.curves,u&&d++,p[d]=[]):p[d].push({h:o,p:f[0]});if(!l[0])return function(t){const e=[];for(let n=0,r=t.length;n<r;n++){const r=t[n],i=new Dc;i.curves=r.curves,e.push(i)}return e}(r);if(l.length>1){let t=!1,n=0;for(let t=0,e=l.length;t<e;t++)c[t]=[];for(let r=0,i=l.length;r<i;r++){const i=p[r];for(let o=0;o<i.length;o++){const a=i[o];let s=!0;for(let i=0;i<l.length;i++)e(a.p,l[i].p)&&(r!==i&&n++,s?(s=!1,c[i].push(a)):t=!0);s&&c[r].push(a)}}n>0&&!1===t&&(p=c)}for(let t=0,e=l.length;t<e;t++){a=l[t].s,s.push(a),h=p[t];for(let t=0,e=h.length;t<e;t++)a.holes.push(h[t].h)}return s}},e.ShapeUtils=ll,e.ShortType=1011,e.Skeleton=pu,e.SkeletonHelper=class extends Ju{constructor(t){const e=wh(t),n=new ti,r=[],i=[],o=new kr(0,0,1),a=new kr(0,1,0);for(let t=0;t<e.length;t++){const n=e[t];n.parent&&n.parent.isBone&&(r.push(0,0,0),r.push(0,0,0),i.push(o.r,o.g,o.b),i.push(a.r,a.g,a.b))}n.setAttribute("position",new qr(r,3)),n.setAttribute("color",new qr(i,3)),super(n,new Fu({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0})),this.isSkeletonHelper=!0,this.type="SkeletonHelper",this.root=t,this.bones=e,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(t){const e=this.bones,n=this.geometry,r=n.getAttribute("position");xh.copy(this.root.matrixWorld).invert();for(let t=0,n=0;t<e.length;t++){const i=e[t];i.parent&&i.parent.isBone&&(_h.multiplyMatrices(xh,i.matrixWorld),bh.setFromMatrixPosition(_h),r.setXYZ(n,bh.x,bh.y,bh.z),_h.multiplyMatrices(xh,i.parent.matrixWorld),bh.setFromMatrixPosition(_h),r.setXYZ(n+1,bh.x,bh.y,bh.z),n+=2)}n.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(t)}dispose(){this.geometry.dispose(),this.material.dispose()}},e.SkinnedMesh=uu,e.Source=en,e.Sphere=Nn,e.SphereGeometry=bl,e.Spherical=class{constructor(t=1,e=0,n=0){return this.radius=t,this.phi=e,this.theta=n,this}set(t,e,n){return this.radius=t,this.phi=e,this.theta=n,this}copy(t){return this.radius=t.radius,this.phi=t.phi,this.theta=t.theta,this}makeSafe(){const t=1e-6;return this.phi=Math.max(t,Math.min(Math.PI-t,this.phi)),this}setFromVector3(t){return this.setFromCartesianCoords(t.x,t.y,t.z)}setFromCartesianCoords(t,e,n){return this.radius=Math.sqrt(t*t+e*e+n*n),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(t,n),this.phi=Math.acos(Pe(e/this.radius,-1,1))),this}clone(){return(new this.constructor).copy(this)}},e.SphericalHarmonics3=Pf,e.SplineCurve=Sc,e.SpotLight=bf,e.SpotLightHelper=class extends mr{constructor(t,e){super(),this.light=t,this.matrixAutoUpdate=!1,this.color=e,this.type="SpotLightHelper";const n=new ti,r=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let t=0,e=1,n=32;t<n;t++,e++){const i=t/n*Math.PI*2,o=e/n*Math.PI*2;r.push(Math.cos(i),Math.sin(i),1,Math.cos(o),Math.sin(o),1)}n.setAttribute("position",new qr(r,3));const i=new Fu({fog:!1,toneMapped:!1});this.cone=new Ju(n,i),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),this.parent?(this.parent.updateWorldMatrix(!0),this.matrix.copy(this.parent.matrixWorld).invert().multiply(this.light.matrixWorld)):this.matrix.copy(this.light.matrixWorld),this.matrixWorld.copy(this.light.matrixWorld);const t=this.light.distance?this.light.distance:1e3,e=t*Math.tan(this.light.angle);this.cone.scale.set(e,e,t),gh.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(gh),void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}},e.Sprite=Ys,e.SpriteMaterial=Ls,e.SrcAlphaFactor=y,e.SrcAlphaSaturateFactor=210,e.SrcColorFactor=202,e.StaticCopyUsage=35046,e.StaticDrawUsage=be,e.StaticReadUsage=35045,e.StereoCamera=class{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new Ri,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new Ri,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(t){const e=this._cache;if(e.focus!==t.focus||e.fov!==t.fov||e.aspect!==t.aspect*this.aspect||e.near!==t.near||e.far!==t.far||e.zoom!==t.zoom||e.eyeSep!==this.eyeSep){e.focus=t.focus,e.fov=t.fov,e.aspect=t.aspect*this.aspect,e.near=t.near,e.far=t.far,e.zoom=t.zoom,e.eyeSep=this.eyeSep,Vf.copy(t.projectionMatrix);const n=e.eyeSep/2,r=n*e.near/e.focus,i=e.near*Math.tan(Ee*e.fov*.5)/e.zoom;let o,a;zf.elements[12]=-n,Ff.elements[12]=n,o=-i*e.aspect+r,a=i*e.aspect+r,Vf.elements[0]=2*e.near/(a-o),Vf.elements[8]=(a+o)/(a-o),this.cameraL.projectionMatrix.copy(Vf),o=-i*e.aspect-r,a=i*e.aspect-r,Vf.elements[0]=2*e.near/(a-o),Vf.elements[8]=(a+o)/(a-o),this.cameraR.projectionMatrix.copy(Vf)}this.cameraL.matrixWorld.copy(t.matrixWorld).multiply(zf),this.cameraR.matrixWorld.copy(t.matrixWorld).multiply(Ff)}},e.StreamCopyUsage=35042,e.StreamDrawUsage=35040,e.StreamReadUsage=35041,e.StringKeyframeTrack=$l,e.SubtractEquation=101,e.SubtractiveBlending=3,e.TOUCH={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},e.TangentSpaceNormalMap=0,e.TetrahedronGeometry=_l,e.Texture=on,e.TextureLoader=class extends sf{constructor(t){super(t)}load(t,e,n,r){const i=new on,o=new ff(this.manager);return o.setCrossOrigin(this.crossOrigin),o.setPath(this.path),o.load(t,(function(t){i.image=t,i.needsUpdate=!0,void 0!==e&&e(i)}),n,r),i}},e.TorusGeometry=xl,e.TorusKnotGeometry=wl,e.Triangle=Er,e.TriangleFanDrawMode=2,e.TriangleStripDrawMode=1,e.TrianglesDrawMode=0,e.TubeGeometry=Sl,e.UVMapping=F,e.Uint16BufferAttribute=Hr,e.Uint32BufferAttribute=Wr,e.Uint8BufferAttribute=class extends Gr{constructor(t,e,n){super(new Uint8Array(t),e,n)}},e.Uint8ClampedBufferAttribute=class extends Gr{constructor(t,e,n){super(new Uint8ClampedArray(t),e,n)}},e.Uniform=lh,e.UniformsGroup=class extends Se{constructor(){super(),this.isUniformsGroup=!0,Object.defineProperty(this,"id",{value:fh++}),this.name="",this.usage=be,this.uniforms=[]}add(t){return this.uniforms.push(t),this}remove(t){const e=this.uniforms.indexOf(t);return-1!==e&&this.uniforms.splice(e,1),this}setName(t){return this.name=t,this}setUsage(t){return this.usage=t,this}dispose(){return this.dispatchEvent({type:"dispose"}),this}copy(t){this.name=t.name,this.usage=t.usage;const e=t.uniforms;this.uniforms.length=0;for(let t=0,n=e.length;t<n;t++){const n=Array.isArray(e[t])?e[t]:[e[t]];for(let t=0;t<n.length;t++)this.uniforms.push(n[t].clone())}return this}clone(){return(new this.constructor).copy(this)}},e.UniformsLib=qi,e.UniformsUtils=Ti,e.UnsignedByteType=et,e.UnsignedInt248Type=ct,e.UnsignedInt5999Type=35902,e.UnsignedIntType=it,e.UnsignedShort4444Type=st,e.UnsignedShort5551Type=ut,e.UnsignedShortType=nt,e.VSMShadowMap=o,e.Vector2=je,e.Vector3=hn,e.Vector4=an,e.VectorKeyframeTrack=tf,e.VideoTexture=class extends on{constructor(t,e,n,r,i,o,a,s,u){super(t,e,n,r,i,o,a,s,u),this.isVideoTexture=!0,this.minFilter=void 0!==o?o:Q,this.magFilter=void 0!==i?i:Q,this.generateMipmaps=!1;const c=this;"requestVideoFrameCallback"in t&&t.requestVideoFrameCallback((function e(){c.needsUpdate=!0,t.requestVideoFrameCallback(e)}))}clone(){return new this.constructor(this.image).copy(this)}update(){const t=this.image;!1=="requestVideoFrameCallback"in t&&t.readyState>=t.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}},e.WebGL3DRenderTarget=class extends un{constructor(t=1,e=1,n=1,r={}){super(t,e,r),this.isWebGL3DRenderTarget=!0,this.depth=n,this.texture=new ln(null,t,e,n),this.texture.isRenderTargetTexture=!0}},e.WebGLArrayRenderTarget=class extends un{constructor(t=1,e=1,n=1,r={}){super(t,e,r),this.isWebGLArrayRenderTarget=!0,this.depth=n,this.texture=new cn(null,t,e,n),this.texture.isRenderTargetTexture=!0}},e.WebGLCoordinateSystem=xe,e.WebGLCubeRenderTarget=Li,e.WebGLMultipleRenderTargets=class extends un{constructor(t=1,e=1,n=1,r={}){console.warn('THREE.WebGLMultipleRenderTargets has been deprecated and will be removed in r172. Use THREE.WebGLRenderTarget and set the "count" parameter to enable MRT.'),super(t,e,{...r,count:n}),this.isWebGLMultipleRenderTargets=!0}get texture(){return this.textures}},e.WebGLRenderTarget=un,e.WebGLRenderer=class{constructor(t={}){const{canvas:e=Ve(),context:r=null,depth:i=!0,stencil:o=!1,alpha:a=!1,antialias:s=!1,premultipliedAlpha:u=!0,preserveDrawingBuffer:c=!1,powerPreference:l="default",failIfMajorPerformanceCaveat:f=!1}=t;let h;if(this.isWebGLRenderer=!0,null!==r){if("undefined"!=typeof WebGLRenderingContext&&r instanceof WebGLRenderingContext)throw new Error("THREE.WebGLRenderer: WebGL 1 is not supported since r163.");h=r.getContextAttributes().alpha}else h=a;const p=new Uint32Array(4),d=new Int32Array(4);let m=null,y=null;const v=[],g=[];this.domElement=e,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this._outputColorSpace=ne,this._useLegacyLights=!1,this.toneMapping=R,this.toneMappingExposure=1;const b=this;let _=!1,x=0,w=0,S=null,T=-1,M=null;const E=new an,A=new an;let O=null;const P=new kr(0);let k=0,C=e.width,N=e.height,L=1,j=null,I=null;const B=new an(0,0,C,N),U=new an(0,0,C,N);let D=!1;const F=new zi;let z=!1,V=!1;const G=new Vn,H=new je,W=new hn,q={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function X(){return null===S?L:1}let Y,J,Z,K,Q,$,rt,ft,ht,pt,vt,gt,bt,_t,xt,wt,St,Tt,Mt,Et,At,Ot,Pt,Rt,kt=r;function Ct(t,n){const r=e.getContext(t,n);return null!==r?r:null}try{const t={alpha:!0,depth:i,stencil:o,antialias:s,premultipliedAlpha:u,preserveDrawingBuffer:c,powerPreference:l,failIfMajorPerformanceCaveat:f};if("setAttribute"in e&&e.setAttribute("data-engine",`three.js r${n}`),e.addEventListener("webglcontextlost",jt,!1),e.addEventListener("webglcontextrestored",It,!1),e.addEventListener("webglcontextcreationerror",Bt,!1),null===kt){const e="webgl2";if(kt=Ct(e,t),null===kt)throw Ct(e)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}}catch(t){throw console.error("THREE.WebGLRenderer: "+t.message),t}function Nt(){Y=new xo(kt),Y.init(),J=new to(kt,Y,t),Ot=new vs(kt,Y),Z=new ms(kt),K=new To(kt),Q=new es,$=new ys(kt,Y,Z,Q,J,Ot,K),rt=new no(b),ft=new _o(b),ht=new Gi(kt),Pt=new Qi(kt,ht),pt=new wo(kt,ht,K,Pt),vt=new Eo(kt,pt,ht,K),Mt=new Mo(kt,J,$),wt=new eo(Q),gt=new ts(b,rt,ft,Y,J,Pt,wt),bt=new Es(b,Q),_t=new os,xt=new fs(Y),Tt=new Ki(b,rt,ft,Z,vt,h,u),St=new ds(b,vt,J),Rt=new As(kt,K,J,Z),Et=new $i(kt,Y,K),At=new So(kt,Y,K),K.programs=gt.programs,b.capabilities=J,b.extensions=Y,b.properties=Q,b.renderLists=_t,b.shadowMap=St,b.state=Z,b.info=K}Nt();const Lt=new Ss(b,kt);function jt(t){t.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),_=!0}function It(){console.log("THREE.WebGLRenderer: Context Restored."),_=!1;const t=K.autoReset,e=St.enabled,n=St.autoUpdate,r=St.needsUpdate,i=St.type;Nt(),K.autoReset=t,St.enabled=e,St.autoUpdate=n,St.needsUpdate=r,St.type=i}function Bt(t){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",t.statusMessage)}function Ut(t){const e=t.target;e.removeEventListener("dispose",Ut),function(t){(function(t){const e=Q.get(t).programs;void 0!==e&&(e.forEach((function(t){gt.releaseProgram(t)})),t.isShaderMaterial&&gt.releaseShaderCache(t))})(t),Q.remove(t)}(e)}function Dt(t,e,n){!0===t.transparent&&2===t.side&&!1===t.forceSinglePass?(t.side=1,t.needsUpdate=!0,Yt(t,e,n),t.side=0,t.needsUpdate=!0,Yt(t,e,n),t.side=2):Yt(t,e,n)}this.xr=Lt,this.getContext=function(){return kt},this.getContextAttributes=function(){return kt.getContextAttributes()},this.forceContextLoss=function(){const t=Y.get("WEBGL_lose_context");t&&t.loseContext()},this.forceContextRestore=function(){const t=Y.get("WEBGL_lose_context");t&&t.restoreContext()},this.getPixelRatio=function(){return L},this.setPixelRatio=function(t){void 0!==t&&(L=t,this.setSize(C,N,!1))},this.getSize=function(t){return t.set(C,N)},this.setSize=function(t,n,r=!0){Lt.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(C=t,N=n,e.width=Math.floor(t*L),e.height=Math.floor(n*L),!0===r&&(e.style.width=t+"px",e.style.height=n+"px"),this.setViewport(0,0,t,n))},this.getDrawingBufferSize=function(t){return t.set(C*L,N*L).floor()},this.setDrawingBufferSize=function(t,n,r){C=t,N=n,L=r,e.width=Math.floor(t*r),e.height=Math.floor(n*r),this.setViewport(0,0,t,n)},this.getCurrentViewport=function(t){return t.copy(E)},this.getViewport=function(t){return t.copy(B)},this.setViewport=function(t,e,n,r){t.isVector4?B.set(t.x,t.y,t.z,t.w):B.set(t,e,n,r),Z.viewport(E.copy(B).multiplyScalar(L).round())},this.getScissor=function(t){return t.copy(U)},this.setScissor=function(t,e,n,r){t.isVector4?U.set(t.x,t.y,t.z,t.w):U.set(t,e,n,r),Z.scissor(A.copy(U).multiplyScalar(L).round())},this.getScissorTest=function(){return D},this.setScissorTest=function(t){Z.setScissorTest(D=t)},this.setOpaqueSort=function(t){j=t},this.setTransparentSort=function(t){I=t},this.getClearColor=function(t){return t.copy(Tt.getClearColor())},this.setClearColor=function(){Tt.setClearColor.apply(Tt,arguments)},this.getClearAlpha=function(){return Tt.getClearAlpha()},this.setClearAlpha=function(){Tt.setClearAlpha.apply(Tt,arguments)},this.clear=function(t=!0,e=!0,n=!0){let r=0;if(t){let t=!1;if(null!==S){const e=S.texture.format;t=e===yt||e===mt||e===dt}if(t){const t=S.texture.type,e=t===et||t===it||t===nt||t===ct||t===st||t===ut,n=Tt.getClearColor(),r=Tt.getClearAlpha(),i=n.r,o=n.g,a=n.b;e?(p[0]=i,p[1]=o,p[2]=a,p[3]=r,kt.clearBufferuiv(kt.COLOR,0,p)):(d[0]=i,d[1]=o,d[2]=a,d[3]=r,kt.clearBufferiv(kt.COLOR,0,d))}else r|=kt.COLOR_BUFFER_BIT}e&&(r|=kt.DEPTH_BUFFER_BIT),n&&(r|=kt.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),kt.clear(r)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){e.removeEventListener("webglcontextlost",jt,!1),e.removeEventListener("webglcontextrestored",It,!1),e.removeEventListener("webglcontextcreationerror",Bt,!1),_t.dispose(),xt.dispose(),Q.dispose(),rt.dispose(),ft.dispose(),vt.dispose(),Pt.dispose(),Rt.dispose(),gt.dispose(),Lt.dispose(),Lt.removeEventListener("sessionstart",zt),Lt.removeEventListener("sessionend",Vt),Gt.stop()},this.renderBufferDirect=function(t,e,n,r,i,o){null===e&&(e=q);const a=i.isMesh&&i.matrixWorld.determinant()<0,s=function(t,e,n,r,i){!0!==e.isScene&&(e=q),$.resetTextureUnits();const o=e.fog,a=r.isMeshStandardMaterial?e.environment:null,s=null===S?b.outputColorSpace:!0===S.isXRRenderTarget?S.texture.colorSpace:re,u=(r.isMeshStandardMaterial?ft:rt).get(r.envMap||a),c=!0===r.vertexColors&&!!n.attributes.color&&4===n.attributes.color.itemSize,l=!!n.attributes.tangent&&(!!r.normalMap||r.anisotropy>0),f=!!n.morphAttributes.position,h=!!n.morphAttributes.normal,p=!!n.morphAttributes.color;let d=R;r.toneMapped&&(null!==S&&!0!==S.isXRRenderTarget||(d=b.toneMapping));const m=n.morphAttributes.position||n.morphAttributes.normal||n.morphAttributes.color,v=void 0!==m?m.length:0,g=Q.get(r),_=y.state.lights;if(!0===z&&(!0===V||t!==M)){const e=t===M&&r.id===T;wt.setState(r,t,e)}let x=!1;r.version===g.__version?g.needsLights&&g.lightsStateVersion!==_.state.version||g.outputColorSpace!==s||i.isBatchedMesh&&!1===g.batching?x=!0:i.isBatchedMesh||!0!==g.batching?i.isInstancedMesh&&!1===g.instancing?x=!0:i.isInstancedMesh||!0!==g.instancing?i.isSkinnedMesh&&!1===g.skinning?x=!0:i.isSkinnedMesh||!0!==g.skinning?i.isInstancedMesh&&!0===g.instancingColor&&null===i.instanceColor||i.isInstancedMesh&&!1===g.instancingColor&&null!==i.instanceColor||i.isInstancedMesh&&!0===g.instancingMorph&&null===i.morphTexture||i.isInstancedMesh&&!1===g.instancingMorph&&null!==i.morphTexture||g.envMap!==u||!0===r.fog&&g.fog!==o?x=!0:void 0===g.numClippingPlanes||g.numClippingPlanes===wt.numPlanes&&g.numIntersection===wt.numIntersection?(g.vertexAlphas!==c||g.vertexTangents!==l||g.morphTargets!==f||g.morphNormals!==h||g.morphColors!==p||g.toneMapping!==d||g.morphTargetsCount!==v)&&(x=!0):x=!0:x=!0:x=!0:x=!0:(x=!0,g.__version=r.version);let w=g.currentProgram;!0===x&&(w=Yt(r,e,i));let E=!1,A=!1,O=!1;const P=w.getUniforms(),k=g.uniforms;if(Z.useProgram(w.program)&&(E=!0,A=!0,O=!0),r.id!==T&&(T=r.id,A=!0),E||M!==t){P.setValue(kt,"projectionMatrix",t.projectionMatrix),P.setValue(kt,"viewMatrix",t.matrixWorldInverse);const e=P.map.cameraPosition;void 0!==e&&e.setValue(kt,W.setFromMatrixPosition(t.matrixWorld)),J.logarithmicDepthBuffer&&P.setValue(kt,"logDepthBufFC",2/(Math.log(t.far+1)/Math.LN2)),(r.isMeshPhongMaterial||r.isMeshToonMaterial||r.isMeshLambertMaterial||r.isMeshBasicMaterial||r.isMeshStandardMaterial||r.isShaderMaterial)&&P.setValue(kt,"isOrthographic",!0===t.isOrthographicCamera),M!==t&&(M=t,A=!0,O=!0)}if(i.isSkinnedMesh){P.setOptional(kt,i,"bindMatrix"),P.setOptional(kt,i,"bindMatrixInverse");const t=i.skeleton;t&&(null===t.boneTexture&&t.computeBoneTexture(),P.setValue(kt,"boneTexture",t.boneTexture,$))}i.isBatchedMesh&&(P.setOptional(kt,i,"batchingTexture"),P.setValue(kt,"batchingTexture",i._matricesTexture,$));const C=n.morphAttributes;var j,I;if(void 0===C.position&&void 0===C.normal&&void 0===C.color||Mt.update(i,n,w),(A||g.receiveShadow!==i.receiveShadow)&&(g.receiveShadow=i.receiveShadow,P.setValue(kt,"receiveShadow",i.receiveShadow)),r.isMeshGouraudMaterial&&null!==r.envMap&&(k.envMap.value=u,k.flipEnvMap.value=u.isCubeTexture&&!1===u.isRenderTargetTexture?-1:1),r.isMeshStandardMaterial&&null===r.envMap&&null!==e.environment&&(k.envMapIntensity.value=e.environmentIntensity),A&&(P.setValue(kt,"toneMappingExposure",b.toneMappingExposure),g.needsLights&&(I=O,(j=k).ambientLightColor.needsUpdate=I,j.lightProbe.needsUpdate=I,j.directionalLights.needsUpdate=I,j.directionalLightShadows.needsUpdate=I,j.pointLights.needsUpdate=I,j.pointLightShadows.needsUpdate=I,j.spotLights.needsUpdate=I,j.spotLightShadows.needsUpdate=I,j.rectAreaLights.needsUpdate=I,j.hemisphereLights.needsUpdate=I),o&&!0===r.fog&&bt.refreshFogUniforms(k,o),bt.refreshMaterialUniforms(k,r,L,N,y.state.transmissionRenderTarget),Ca.upload(kt,Jt(g),k,$)),r.isShaderMaterial&&!0===r.uniformsNeedUpdate&&(Ca.upload(kt,Jt(g),k,$),r.uniformsNeedUpdate=!1),r.isSpriteMaterial&&P.setValue(kt,"center",i.center),P.setValue(kt,"modelViewMatrix",i.modelViewMatrix),P.setValue(kt,"normalMatrix",i.normalMatrix),P.setValue(kt,"modelMatrix",i.matrixWorld),r.isShaderMaterial||r.isRawShaderMaterial){const t=r.uniformsGroups;for(let e=0,n=t.length;e<n;e++){const n=t[e];Rt.update(n,w),Rt.bind(n,w)}}return w}(t,e,n,r,i);Z.setMaterial(r,a);let u=n.index,c=1;if(!0===r.wireframe){if(u=pt.getWireframeAttribute(n),void 0===u)return;c=2}const l=n.drawRange,f=n.attributes.position;let h=l.start*c,p=(l.start+l.count)*c;null!==o&&(h=Math.max(h,o.start*c),p=Math.min(p,(o.start+o.count)*c)),null!==u?(h=Math.max(h,0),p=Math.min(p,u.count)):null!=f&&(h=Math.max(h,0),p=Math.min(p,f.count));const d=p-h;if(d<0||d===1/0)return;let m;Pt.setup(i,r,s,n,u);let v=Et;if(null!==u&&(m=ht.get(u),v=At,v.setIndex(m)),i.isMesh)!0===r.wireframe?(Z.setLineWidth(r.wireframeLinewidth*X()),v.setMode(kt.LINES)):v.setMode(kt.TRIANGLES);else if(i.isLine){let t=r.linewidth;void 0===t&&(t=1),Z.setLineWidth(t*X()),i.isLineSegments?v.setMode(kt.LINES):i.isLineLoop?v.setMode(kt.LINE_LOOP):v.setMode(kt.LINE_STRIP)}else i.isPoints?v.setMode(kt.POINTS):i.isSprite&&v.setMode(kt.TRIANGLES);if(i.isBatchedMesh)v.renderMultiDraw(i._multiDrawStarts,i._multiDrawCounts,i._multiDrawCount);else if(i.isInstancedMesh)v.renderInstances(h,d,i.count);else if(n.isInstancedBufferGeometry){const t=void 0!==n._maxInstanceCount?n._maxInstanceCount:1/0,e=Math.min(n.instanceCount,t);v.renderInstances(h,d,e)}else v.render(h,d)},this.compile=function(t,e,n=null){null===n&&(n=t),y=xt.get(n),y.init(),g.push(y),n.traverseVisible((function(t){t.isLight&&t.layers.test(e.layers)&&(y.pushLight(t),t.castShadow&&y.pushShadow(t))})),t!==n&&t.traverseVisible((function(t){t.isLight&&t.layers.test(e.layers)&&(y.pushLight(t),t.castShadow&&y.pushShadow(t))})),y.setupLights(b._useLegacyLights);const r=new Set;return t.traverse((function(t){const e=t.material;if(e)if(Array.isArray(e))for(let i=0;i<e.length;i++){const o=e[i];Dt(o,n,t),r.add(o)}else Dt(e,n,t),r.add(e)})),g.pop(),y=null,r},this.compileAsync=function(t,e,n=null){const r=this.compile(t,e,n);return new Promise((e=>{function n(){r.forEach((function(t){Q.get(t).currentProgram.isReady()&&r.delete(t)})),0!==r.size?setTimeout(n,10):e(t)}null!==Y.get("KHR_parallel_shader_compile")?n():setTimeout(n,10)}))};let Ft=null;function zt(){Gt.stop()}function Vt(){Gt.start()}const Gt=new Vi;function Ht(t,e,n,r){if(!1===t.visible)return;if(t.layers.test(e.layers))if(t.isGroup)n=t.renderOrder;else if(t.isLOD)!0===t.autoUpdate&&t.update(e);else if(t.isLight)y.pushLight(t),t.castShadow&&y.pushShadow(t);else if(t.isSprite){if(!t.frustumCulled||F.intersectsSprite(t)){r&&W.setFromMatrixPosition(t.matrixWorld).applyMatrix4(G);const e=vt.update(t),i=t.material;i.visible&&m.push(t,e,i,n,W.z,null)}}else if((t.isMesh||t.isLine||t.isPoints)&&(!t.frustumCulled||F.intersectsObject(t))){const e=vt.update(t),i=t.material;if(r&&(void 0!==t.boundingSphere?(null===t.boundingSphere&&t.computeBoundingSphere(),W.copy(t.boundingSphere.center)):(null===e.boundingSphere&&e.computeBoundingSphere(),W.copy(e.boundingSphere.center)),W.applyMatrix4(t.matrixWorld).applyMatrix4(G)),Array.isArray(i)){const r=e.groups;for(let o=0,a=r.length;o<a;o++){const a=r[o],s=i[a.materialIndex];s&&s.visible&&m.push(t,e,s,n,W.z,a)}}else i.visible&&m.push(t,e,i,n,W.z,null)}const i=t.children;for(let t=0,o=i.length;t<o;t++)Ht(i[t],e,n,r)}function Wt(t,e,n,r){const i=t.opaque,a=t.transmissive,s=t.transparent;y.setupLightsView(n),!0===z&&wt.setGlobalState(b.clippingPlanes,n),a.length>0&&function(t,e,n,r){if(null!==(!0===n.isScene?n.overrideMaterial:null))return;null===y.state.transmissionRenderTarget&&(y.state.transmissionRenderTarget=new un(1,1,{generateMipmaps:!0,type:Y.has("EXT_color_buffer_half_float")||Y.has("EXT_color_buffer_float")?at:et,minFilter:tt,samples:4,stencilBuffer:o}),Q.get(y.state.transmissionRenderTarget).__isTransmissionRenderTarget=!0);const i=y.state.transmissionRenderTarget;b.getDrawingBufferSize(H),i.setSize(H.x,H.y);const a=b.getRenderTarget();b.setRenderTarget(i),b.getClearColor(P),k=b.getClearAlpha(),k<1&&b.setClearColor(16777215,.5),b.clear();const s=b.toneMapping;b.toneMapping=R,qt(t,n,r),$.updateMultisampleRenderTarget(i),$.updateRenderTargetMipmap(i);let u=!1;for(let t=0,i=e.length;t<i;t++){const i=e[t],o=i.object,a=i.geometry,s=i.material,c=i.group;if(2===s.side&&o.layers.test(r.layers)){const t=s.side;s.side=1,s.needsUpdate=!0,Xt(o,n,r,a,s,c),s.side=t,s.needsUpdate=!0,u=!0}}!0===u&&($.updateMultisampleRenderTarget(i),$.updateRenderTargetMipmap(i)),b.setRenderTarget(a),b.setClearColor(P,k),b.toneMapping=s}(i,a,e,n),r&&Z.viewport(E.copy(r)),i.length>0&&qt(i,e,n),a.length>0&&qt(a,e,n),s.length>0&&qt(s,e,n),Z.buffers.depth.setTest(!0),Z.buffers.depth.setMask(!0),Z.buffers.color.setMask(!0),Z.setPolygonOffset(!1)}function qt(t,e,n){const r=!0===e.isScene?e.overrideMaterial:null;for(let i=0,o=t.length;i<o;i++){const o=t[i],a=o.object,s=o.geometry,u=null===r?o.material:r,c=o.group;a.layers.test(n.layers)&&Xt(a,e,n,s,u,c)}}function Xt(t,e,n,r,i,o){t.onBeforeRender(b,e,n,r,i,o),t.modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,t.matrixWorld),t.normalMatrix.getNormalMatrix(t.modelViewMatrix),i.onBeforeRender(b,e,n,r,t,o),!0===i.transparent&&2===i.side&&!1===i.forceSinglePass?(i.side=1,i.needsUpdate=!0,b.renderBufferDirect(n,e,r,i,t,o),i.side=0,i.needsUpdate=!0,b.renderBufferDirect(n,e,r,i,t,o),i.side=2):b.renderBufferDirect(n,e,r,i,t,o),t.onAfterRender(b,e,n,r,i,o)}function Yt(t,e,n){!0!==e.isScene&&(e=q);const r=Q.get(t),i=y.state.lights,o=y.state.shadowsArray,a=i.state.version,s=gt.getParameters(t,i.state,o,e,n),u=gt.getProgramCacheKey(s);let c=r.programs;r.environment=t.isMeshStandardMaterial?e.environment:null,r.fog=e.fog,r.envMap=(t.isMeshStandardMaterial?ft:rt).get(t.envMap||r.environment),r.envMapRotation=null!==r.environment&&null===t.envMap?e.environmentRotation:t.envMapRotation,void 0===c&&(t.addEventListener("dispose",Ut),c=new Map,r.programs=c);let l=c.get(u);if(void 0!==l){if(r.currentProgram===l&&r.lightsStateVersion===a)return Zt(t,s),l}else s.uniforms=gt.getUniforms(t),t.onBuild(n,s,b),t.onBeforeCompile(s,b),l=gt.acquireProgram(s,u),c.set(u,l),r.uniforms=s.uniforms;const f=r.uniforms;return(t.isShaderMaterial||t.isRawShaderMaterial)&&!0!==t.clipping||(f.clippingPlanes=wt.uniform),Zt(t,s),r.needsLights=function(t){return t.isMeshLambertMaterial||t.isMeshToonMaterial||t.isMeshPhongMaterial||t.isMeshStandardMaterial||t.isShadowMaterial||t.isShaderMaterial&&!0===t.lights}(t),r.lightsStateVersion=a,r.needsLights&&(f.ambientLightColor.value=i.state.ambient,f.lightProbe.value=i.state.probe,f.directionalLights.value=i.state.directional,f.directionalLightShadows.value=i.state.directionalShadow,f.spotLights.value=i.state.spot,f.spotLightShadows.value=i.state.spotShadow,f.rectAreaLights.value=i.state.rectArea,f.ltc_1.value=i.state.rectAreaLTC1,f.ltc_2.value=i.state.rectAreaLTC2,f.pointLights.value=i.state.point,f.pointLightShadows.value=i.state.pointShadow,f.hemisphereLights.value=i.state.hemi,f.directionalShadowMap.value=i.state.directionalShadowMap,f.directionalShadowMatrix.value=i.state.directionalShadowMatrix,f.spotShadowMap.value=i.state.spotShadowMap,f.spotLightMatrix.value=i.state.spotLightMatrix,f.spotLightMap.value=i.state.spotLightMap,f.pointShadowMap.value=i.state.pointShadowMap,f.pointShadowMatrix.value=i.state.pointShadowMatrix),r.currentProgram=l,r.uniformsList=null,l}function Jt(t){if(null===t.uniformsList){const e=t.currentProgram.getUniforms();t.uniformsList=Ca.seqWithValue(e.seq,t.uniforms)}return t.uniformsList}function Zt(t,e){const n=Q.get(t);n.outputColorSpace=e.outputColorSpace,n.batching=e.batching,n.instancing=e.instancing,n.instancingColor=e.instancingColor,n.instancingMorph=e.instancingMorph,n.skinning=e.skinning,n.morphTargets=e.morphTargets,n.morphNormals=e.morphNormals,n.morphColors=e.morphColors,n.morphTargetsCount=e.morphTargetsCount,n.numClippingPlanes=e.numClippingPlanes,n.numIntersection=e.numClipIntersection,n.vertexAlphas=e.vertexAlphas,n.vertexTangents=e.vertexTangents,n.toneMapping=e.toneMapping}Gt.setAnimationLoop((function(t){Ft&&Ft(t)})),"undefined"!=typeof self&&Gt.setContext(self),this.setAnimationLoop=function(t){Ft=t,Lt.setAnimationLoop(t),null===t?Gt.stop():Gt.start()},Lt.addEventListener("sessionstart",zt),Lt.addEventListener("sessionend",Vt),this.render=function(t,e){if(void 0!==e&&!0!==e.isCamera)return void console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");if(!0===_)return;!0===t.matrixWorldAutoUpdate&&t.updateMatrixWorld(),null===e.parent&&!0===e.matrixWorldAutoUpdate&&e.updateMatrixWorld(),!0===Lt.enabled&&!0===Lt.isPresenting&&(!0===Lt.cameraAutoUpdate&&Lt.updateCamera(e),e=Lt.getCamera()),!0===t.isScene&&t.onBeforeRender(b,t,e,S),y=xt.get(t,g.length),y.init(),g.push(y),G.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),F.setFromProjectionMatrix(G),V=this.localClippingEnabled,z=wt.init(this.clippingPlanes,V),m=_t.get(t,v.length),m.init(),v.push(m),Ht(t,e,0,b.sortObjects),m.finish(),!0===b.sortObjects&&m.sort(j,I),this.info.render.frame++,!0===z&&wt.beginShadows();const n=y.state.shadowsArray;if(St.render(n,t,e),!0===z&&wt.endShadows(),!0===this.info.autoReset&&this.info.reset(),!1!==Lt.enabled&&!1!==Lt.isPresenting&&!1!==Lt.hasDepthSensing()||Tt.render(m,t),y.setupLights(b._useLegacyLights),e.isArrayCamera){const n=e.cameras;for(let e=0,r=n.length;e<r;e++){const r=n[e];Wt(m,t,r,r.viewport)}}else Wt(m,t,e);null!==S&&($.updateMultisampleRenderTarget(S),$.updateRenderTargetMipmap(S)),!0===t.isScene&&t.onAfterRender(b,t,e),Pt.resetDefaultState(),T=-1,M=null,g.pop(),y=g.length>0?g[g.length-1]:null,v.pop(),m=v.length>0?v[v.length-1]:null},this.getActiveCubeFace=function(){return x},this.getActiveMipmapLevel=function(){return w},this.getRenderTarget=function(){return S},this.setRenderTargetTextures=function(t,e,n){Q.get(t.texture).__webglTexture=e,Q.get(t.depthTexture).__webglTexture=n;const r=Q.get(t);r.__hasExternalTextures=!0,r.__autoAllocateDepthBuffer=void 0===n,r.__autoAllocateDepthBuffer||!0===Y.has("WEBGL_multisampled_render_to_texture")&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),r.__useRenderToTexture=!1)},this.setRenderTargetFramebuffer=function(t,e){const n=Q.get(t);n.__webglFramebuffer=e,n.__useDefaultFramebuffer=void 0===e},this.setRenderTarget=function(t,e=0,n=0){S=t,x=e,w=n;let r=!0,i=null,o=!1,a=!1;if(t){const s=Q.get(t);void 0!==s.__useDefaultFramebuffer?(Z.bindFramebuffer(kt.FRAMEBUFFER,null),r=!1):void 0===s.__webglFramebuffer?$.setupRenderTarget(t):s.__hasExternalTextures&&$.rebindTextures(t,Q.get(t.texture).__webglTexture,Q.get(t.depthTexture).__webglTexture);const u=t.texture;(u.isData3DTexture||u.isDataArrayTexture||u.isCompressedArrayTexture)&&(a=!0);const c=Q.get(t).__webglFramebuffer;t.isWebGLCubeRenderTarget?(i=Array.isArray(c[e])?c[e][n]:c[e],o=!0):i=t.samples>0&&!1===$.useMultisampledRTT(t)?Q.get(t).__webglMultisampledFramebuffer:Array.isArray(c)?c[n]:c,E.copy(t.viewport),A.copy(t.scissor),O=t.scissorTest}else E.copy(B).multiplyScalar(L).floor(),A.copy(U).multiplyScalar(L).floor(),O=D;if(Z.bindFramebuffer(kt.FRAMEBUFFER,i)&&r&&Z.drawBuffers(t,i),Z.viewport(E),Z.scissor(A),Z.setScissorTest(O),o){const r=Q.get(t.texture);kt.framebufferTexture2D(kt.FRAMEBUFFER,kt.COLOR_ATTACHMENT0,kt.TEXTURE_CUBE_MAP_POSITIVE_X+e,r.__webglTexture,n)}else if(a){const r=Q.get(t.texture),i=e||0;kt.framebufferTextureLayer(kt.FRAMEBUFFER,kt.COLOR_ATTACHMENT0,r.__webglTexture,n||0,i)}T=-1},this.readRenderTargetPixels=function(t,e,n,r,i,o,a){if(!t||!t.isWebGLRenderTarget)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let s=Q.get(t).__webglFramebuffer;if(t.isWebGLCubeRenderTarget&&void 0!==a&&(s=s[a]),s){Z.bindFramebuffer(kt.FRAMEBUFFER,s);try{const a=t.texture,s=a.format,u=a.type;if(s!==lt&&Ot.convert(s)!==kt.getParameter(kt.IMPLEMENTATION_COLOR_READ_FORMAT))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");const c=u===at&&(Y.has("EXT_color_buffer_half_float")||Y.has("EXT_color_buffer_float"));if(u!==et&&Ot.convert(u)!==kt.getParameter(kt.IMPLEMENTATION_COLOR_READ_TYPE)&&u!==ot&&!c)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");e>=0&&e<=t.width-r&&n>=0&&n<=t.height-i&&kt.readPixels(e,n,r,i,Ot.convert(s),Ot.convert(u),o)}finally{const t=null!==S?Q.get(S).__webglFramebuffer:null;Z.bindFramebuffer(kt.FRAMEBUFFER,t)}}},this.copyFramebufferToTexture=function(t,e,n=0){const r=Math.pow(2,-n),i=Math.floor(e.image.width*r),o=Math.floor(e.image.height*r);$.setTexture2D(e,0),kt.copyTexSubImage2D(kt.TEXTURE_2D,n,0,0,t.x,t.y,i,o),Z.unbindTexture()},this.copyTextureToTexture=function(t,e,n,r=0){const i=e.image.width,o=e.image.height,a=Ot.convert(n.format),s=Ot.convert(n.type);$.setTexture2D(n,0),kt.pixelStorei(kt.UNPACK_FLIP_Y_WEBGL,n.flipY),kt.pixelStorei(kt.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n.premultiplyAlpha),kt.pixelStorei(kt.UNPACK_ALIGNMENT,n.unpackAlignment),e.isDataTexture?kt.texSubImage2D(kt.TEXTURE_2D,r,t.x,t.y,i,o,a,s,e.image.data):e.isCompressedTexture?kt.compressedTexSubImage2D(kt.TEXTURE_2D,r,t.x,t.y,e.mipmaps[0].width,e.mipmaps[0].height,a,e.mipmaps[0].data):kt.texSubImage2D(kt.TEXTURE_2D,r,t.x,t.y,a,s,e.image),0===r&&n.generateMipmaps&&kt.generateMipmap(kt.TEXTURE_2D),Z.unbindTexture()},this.copyTextureToTexture3D=function(t,e,n,r,i=0){const o=Math.round(t.max.x-t.min.x),a=Math.round(t.max.y-t.min.y),s=t.max.z-t.min.z+1,u=Ot.convert(r.format),c=Ot.convert(r.type);let l;if(r.isData3DTexture)$.setTexture3D(r,0),l=kt.TEXTURE_3D;else{if(!r.isDataArrayTexture&&!r.isCompressedArrayTexture)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");$.setTexture2DArray(r,0),l=kt.TEXTURE_2D_ARRAY}kt.pixelStorei(kt.UNPACK_FLIP_Y_WEBGL,r.flipY),kt.pixelStorei(kt.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r.premultiplyAlpha),kt.pixelStorei(kt.UNPACK_ALIGNMENT,r.unpackAlignment);const f=kt.getParameter(kt.UNPACK_ROW_LENGTH),h=kt.getParameter(kt.UNPACK_IMAGE_HEIGHT),p=kt.getParameter(kt.UNPACK_SKIP_PIXELS),d=kt.getParameter(kt.UNPACK_SKIP_ROWS),m=kt.getParameter(kt.UNPACK_SKIP_IMAGES),y=n.isCompressedTexture?n.mipmaps[i]:n.image;kt.pixelStorei(kt.UNPACK_ROW_LENGTH,y.width),kt.pixelStorei(kt.UNPACK_IMAGE_HEIGHT,y.height),kt.pixelStorei(kt.UNPACK_SKIP_PIXELS,t.min.x),kt.pixelStorei(kt.UNPACK_SKIP_ROWS,t.min.y),kt.pixelStorei(kt.UNPACK_SKIP_IMAGES,t.min.z),n.isDataTexture||n.isData3DTexture?kt.texSubImage3D(l,i,e.x,e.y,e.z,o,a,s,u,c,y.data):r.isCompressedArrayTexture?kt.compressedTexSubImage3D(l,i,e.x,e.y,e.z,o,a,s,u,y.data):kt.texSubImage3D(l,i,e.x,e.y,e.z,o,a,s,u,c,y),kt.pixelStorei(kt.UNPACK_ROW_LENGTH,f),kt.pixelStorei(kt.UNPACK_IMAGE_HEIGHT,h),kt.pixelStorei(kt.UNPACK_SKIP_PIXELS,p),kt.pixelStorei(kt.UNPACK_SKIP_ROWS,d),kt.pixelStorei(kt.UNPACK_SKIP_IMAGES,m),0===i&&r.generateMipmaps&&kt.generateMipmap(l),Z.unbindTexture()},this.initTexture=function(t){t.isCubeTexture?$.setTextureCube(t,0):t.isData3DTexture?$.setTexture3D(t,0):t.isDataArrayTexture||t.isCompressedArrayTexture?$.setTexture2DArray(t,0):$.setTexture2D(t,0),Z.unbindTexture()},this.resetState=function(){x=0,w=0,S=null,Z.reset(),Pt.reset()},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return xe}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(t){this._outputColorSpace=t;const e=this.getContext();e.drawingBufferColorSpace=t===ie?"display-p3":"srgb",e.unpackColorSpace=Je.workingColorSpace===oe?"display-p3":"srgb"}get useLegacyLights(){return console.warn("THREE.WebGLRenderer: The property .useLegacyLights has been deprecated. Migrate your lighting according to the following guide: https://discourse.threejs.org/t/updates-to-lighting-in-three-js-r155/53733."),this._useLegacyLights}set useLegacyLights(t){console.warn("THREE.WebGLRenderer: The property .useLegacyLights has been deprecated. Migrate your lighting according to the following guide: https://discourse.threejs.org/t/updates-to-lighting-in-three-js-r155/53733."),this._useLegacyLights=t}},e.WebGLUtils=vs,e.WebGPUCoordinateSystem=we,e.WireframeGeometry=Tl,e.WrapAroundEnding=$t,e.ZeroCurvatureEnding=Kt,e.ZeroFactor=200,e.ZeroSlopeEnding=Qt,e.ZeroStencilOp=0,e.createCanvasElement=Ve},4127:(t,e,n)=>{n.d(e,{A:()=>be});var r={};function i(t,e){return function(){return t.apply(e,arguments)}}function o(t){return o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},o(t)}n.r(r),n.d(r,{hasBrowserEnv:()=>lt,hasStandardBrowserEnv:()=>ft,hasStandardBrowserWebWorkerEnv:()=>ht});var a,s=Object.prototype.toString,u=Object.getPrototypeOf,c=(a=Object.create(null),function(t){var e=s.call(t);return a[e]||(a[e]=e.slice(8,-1).toLowerCase())}),l=function(t){return t=t.toLowerCase(),function(e){return c(e)===t}},f=function(t){return function(e){return o(e)===t}},h=Array.isArray,p=f("undefined"),d=l("ArrayBuffer"),m=f("string"),y=f("function"),v=f("number"),g=function(t){return null!==t&&"object"===o(t)},b=function(t){if("object"!==c(t))return!1;var e=u(t);return!(null!==e&&e!==Object.prototype&&null!==Object.getPrototypeOf(e)||Symbol.toStringTag in t||Symbol.iterator in t)},_=l("Date"),x=l("File"),w=l("Blob"),S=l("FileList"),T=l("URLSearchParams");function M(t,e){var n,r,i=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}).allOwnKeys,a=void 0!==i&&i;if(null!=t)if("object"!==o(t)&&(t=[t]),h(t))for(n=0,r=t.length;n<r;n++)e.call(null,t[n],n,t);else{var s,u=a?Object.getOwnPropertyNames(t):Object.keys(t),c=u.length;for(n=0;n<c;n++)s=u[n],e.call(null,t[s],s,t)}}function E(t,e){e=e.toLowerCase();for(var n,r=Object.keys(t),i=r.length;i-- >0;)if(e===(n=r[i]).toLowerCase())return n;return null}var A,O,P="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:global,R=function(t){return!p(t)&&t!==P},k=(A="undefined"!=typeof Uint8Array&&u(Uint8Array),function(t){return A&&t instanceof A}),C=l("HTMLFormElement"),N=(O=Object.prototype.hasOwnProperty,function(t,e){return O.call(t,e)}),L=l("RegExp"),j=function(t,e){var n=Object.getOwnPropertyDescriptors(t),r={};M(n,(function(n,i){var o;!1!==(o=e(n,i,t))&&(r[i]=o||n)})),Object.defineProperties(t,r)},I="abcdefghijklmnopqrstuvwxyz",B="0123456789",U={DIGIT:B,ALPHA:I,ALPHA_DIGIT:I+I.toUpperCase()+B},D=l("AsyncFunction");const F={isArray:h,isArrayBuffer:d,isBuffer:function(t){return null!==t&&!p(t)&&null!==t.constructor&&!p(t.constructor)&&y(t.constructor.isBuffer)&&t.constructor.isBuffer(t)},isFormData:function(t){var e;return t&&("function"==typeof FormData&&t instanceof FormData||y(t.append)&&("formdata"===(e=c(t))||"object"===e&&y(t.toString)&&"[object FormData]"===t.toString()))},isArrayBufferView:function(t){return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(t):t&&t.buffer&&d(t.buffer)},isString:m,isNumber:v,isBoolean:function(t){return!0===t||!1===t},isObject:g,isPlainObject:b,isUndefined:p,isDate:_,isFile:x,isBlob:w,isRegExp:L,isFunction:y,isStream:function(t){return g(t)&&y(t.pipe)},isURLSearchParams:T,isTypedArray:k,isFileList:S,forEach:M,merge:function t(){for(var e=(R(this)&&this||{}).caseless,n={},r=function(r,i){var o=e&&E(n,i)||i;b(n[o])&&b(r)?n[o]=t(n[o],r):b(r)?n[o]=t({},r):h(r)?n[o]=r.slice():n[o]=r},i=0,o=arguments.length;i<o;i++)arguments[i]&&M(arguments[i],r);return n},extend:function(t,e,n){return M(e,(function(e,r){n&&y(e)?t[r]=i(e,n):t[r]=e}),{allOwnKeys:(arguments.length>3&&void 0!==arguments[3]?arguments[3]:{}).allOwnKeys}),t},trim:function(t){return t.trim?t.trim():t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")},stripBOM:function(t){return 65279===t.charCodeAt(0)&&(t=t.slice(1)),t},inherits:function(t,e,n,r){t.prototype=Object.create(e.prototype,r),t.prototype.constructor=t,Object.defineProperty(t,"super",{value:e.prototype}),n&&Object.assign(t.prototype,n)},toFlatObject:function(t,e,n,r){var i,o,a,s={};if(e=e||{},null==t)return e;do{for(o=(i=Object.getOwnPropertyNames(t)).length;o-- >0;)a=i[o],r&&!r(a,t,e)||s[a]||(e[a]=t[a],s[a]=!0);t=!1!==n&&u(t)}while(t&&(!n||n(t,e))&&t!==Object.prototype);return e},kindOf:c,kindOfTest:l,endsWith:function(t,e,n){t=String(t),(void 0===n||n>t.length)&&(n=t.length),n-=e.length;var r=t.indexOf(e,n);return-1!==r&&r===n},toArray:function(t){if(!t)return null;if(h(t))return t;var e=t.length;if(!v(e))return null;for(var n=new Array(e);e-- >0;)n[e]=t[e];return n},forEachEntry:function(t,e){for(var n,r=(t&&t[Symbol.iterator]).call(t);(n=r.next())&&!n.done;){var i=n.value;e.call(t,i[0],i[1])}},matchAll:function(t,e){for(var n,r=[];null!==(n=t.exec(e));)r.push(n);return r},isHTMLForm:C,hasOwnProperty:N,hasOwnProp:N,reduceDescriptors:j,freezeMethods:function(t){j(t,(function(e,n){if(y(t)&&-1!==["arguments","caller","callee"].indexOf(n))return!1;var r=t[n];y(r)&&(e.enumerable=!1,"writable"in e?e.writable=!1:e.set||(e.set=function(){throw Error("Can not rewrite read-only method '"+n+"'")}))}))},toObjectSet:function(t,e){var n={},r=function(t){t.forEach((function(t){n[t]=!0}))};return h(t)?r(t):r(String(t).split(e)),n},toCamelCase:function(t){return t.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,(function(t,e,n){return e.toUpperCase()+n}))},noop:function(){},toFiniteNumber:function(t,e){return t=+t,Number.isFinite(t)?t:e},findKey:E,global:P,isContextDefined:R,ALPHABET:U,generateString:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:16,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:U.ALPHA_DIGIT,n="",r=e.length;t--;)n+=e[Math.random()*r|0];return n},isSpecCompliantForm:function(t){return!!(t&&y(t.append)&&"FormData"===t[Symbol.toStringTag]&&t[Symbol.iterator])},toJSONObject:function(t){var e=new Array(10);return function t(n,r){if(g(n)){if(e.indexOf(n)>=0)return;if(!("toJSON"in n)){e[r]=n;var i=h(n)?[]:{};return M(n,(function(e,n){var o=t(e,r+1);!p(o)&&(i[n]=o)})),e[r]=void 0,i}}return n}(t,0)},isAsyncFn:D,isThenable:function(t){return t&&(g(t)||y(t))&&y(t.then)&&y(t.catch)}};function z(t,e,n,r,i){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=(new Error).stack,this.message=t,this.name="AxiosError",e&&(this.code=e),n&&(this.config=n),r&&(this.request=r),i&&(this.response=i)}F.inherits(z,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:F.toJSONObject(this.config),code:this.code,status:this.response&&this.response.status?this.response.status:null}}});var V=z.prototype,G={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach((function(t){G[t]={value:t}})),Object.defineProperties(z,G),Object.defineProperty(V,"isAxiosError",{value:!0}),z.from=function(t,e,n,r,i,o){var a=Object.create(V);return F.toFlatObject(t,a,(function(t){return t!==Error.prototype}),(function(t){return"isAxiosError"!==t})),z.call(a,t.message,e,n,r,i),a.cause=t,a.name=t.name,o&&Object.assign(a,o),a};const H=z;function W(t){return W="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},W(t)}function q(t){return F.isPlainObject(t)||F.isArray(t)}function X(t){return F.endsWith(t,"[]")?t.slice(0,-2):t}function Y(t,e,n){return t?t.concat(e).map((function(t,e){return t=X(t),!n&&e?"["+t+"]":t})).join(n?".":""):e}var J=F.toFlatObject(F,{},null,(function(t){return/^is[A-Z]/.test(t)}));const Z=function(t,e,n){if(!F.isObject(t))throw new TypeError("target must be an object");e=e||new FormData;var r=(n=F.toFlatObject(n,{metaTokens:!0,dots:!1,indexes:!1},!1,(function(t,e){return!F.isUndefined(e[t])}))).metaTokens,i=n.visitor||c,o=n.dots,a=n.indexes,s=(n.Blob||"undefined"!=typeof Blob&&Blob)&&F.isSpecCompliantForm(e);if(!F.isFunction(i))throw new TypeError("visitor must be a function");function u(t){if(null===t)return"";if(F.isDate(t))return t.toISOString();if(!s&&F.isBlob(t))throw new H("Blob is not supported. Use a Buffer instead.");return F.isArrayBuffer(t)||F.isTypedArray(t)?s&&"function"==typeof Blob?new Blob([t]):Buffer.from(t):t}function c(t,n,i){var s=t;if(t&&!i&&"object"===W(t))if(F.endsWith(n,"{}"))n=r?n:n.slice(0,-2),t=JSON.stringify(t);else if(F.isArray(t)&&function(t){return F.isArray(t)&&!t.some(q)}(t)||(F.isFileList(t)||F.endsWith(n,"[]"))&&(s=F.toArray(t)))return n=X(n),s.forEach((function(t,r){!F.isUndefined(t)&&null!==t&&e.append(!0===a?Y([n],r,o):null===a?n:n+"[]",u(t))})),!1;return!!q(t)||(e.append(Y(i,n,o),u(t)),!1)}var l=[],f=Object.assign(J,{defaultVisitor:c,convertValue:u,isVisitable:q});if(!F.isObject(t))throw new TypeError("data must be an object");return function t(n,r){if(!F.isUndefined(n)){if(-1!==l.indexOf(n))throw Error("Circular reference detected in "+r.join("."));l.push(n),F.forEach(n,(function(n,o){!0===(!(F.isUndefined(n)||null===n)&&i.call(e,n,F.isString(o)?o.trim():o,r,f))&&t(n,r?r.concat(o):[o])})),l.pop()}}(t),e};function K(t){var e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(t).replace(/[!'()~]|%20|%00/g,(function(t){return e[t]}))}function Q(t,e){this._pairs=[],t&&Z(t,this,e)}var $=Q.prototype;$.append=function(t,e){this._pairs.push([t,e])},$.toString=function(t){var e=t?function(e){return t.call(this,e,K)}:K;return this._pairs.map((function(t){return e(t[0])+"="+e(t[1])}),"").join("&")};const tt=Q;function et(t){return encodeURIComponent(t).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function nt(t,e,n){if(!e)return t;var r,i=n&&n.encode||et,o=n&&n.serialize;if(r=o?o(e,n):F.isURLSearchParams(e)?e.toString():new tt(e,n).toString(i)){var a=t.indexOf("#");-1!==a&&(t=t.slice(0,a)),t+=(-1===t.indexOf("?")?"?":"&")+r}return t}function rt(t){return rt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},rt(t)}function it(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,ot(r.key),r)}}function ot(t){var e=function(t,e){if("object"!=rt(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=rt(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==rt(e)?e:e+""}const at=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.handlers=[]},(e=[{key:"use",value:function(t,e,n){return this.handlers.push({fulfilled:t,rejected:e,synchronous:!!n&&n.synchronous,runWhen:n?n.runWhen:null}),this.handlers.length-1}},{key:"eject",value:function(t){this.handlers[t]&&(this.handlers[t]=null)}},{key:"clear",value:function(){this.handlers&&(this.handlers=[])}},{key:"forEach",value:function(t){F.forEach(this.handlers,(function(e){null!==e&&t(e)}))}}])&&it(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}(),st={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},ut={isBrowser:!0,classes:{URLSearchParams:"undefined"!=typeof URLSearchParams?URLSearchParams:tt,FormData:"undefined"!=typeof FormData?FormData:null,Blob:"undefined"!=typeof Blob?Blob:null},protocols:["http","https","file","blob","url","data"]};var ct,lt="undefined"!=typeof window&&"undefined"!=typeof document,ft=(ct="undefined"!=typeof navigator&&navigator.product,lt&&["ReactNative","NativeScript","NS"].indexOf(ct)<0),ht="undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&"function"==typeof self.importScripts;function pt(t){return pt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},pt(t)}function dt(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function mt(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?dt(Object(n),!0).forEach((function(e){var r,i,o,a;r=t,i=e,o=n[e],a=function(t,e){if("object"!=pt(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=pt(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(i),(i="symbol"==pt(a)?a:a+"")in r?Object.defineProperty(r,i,{value:o,enumerable:!0,configurable:!0,writable:!0}):r[i]=o})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):dt(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}const yt=mt(mt({},r),ut),vt=function(t){function e(t,n,r,i){var o=t[i++];if("__proto__"===o)return!0;var a=Number.isFinite(+o),s=i>=t.length;return o=!o&&F.isArray(r)?r.length:o,s?(F.hasOwnProp(r,o)?r[o]=[r[o],n]:r[o]=n,!a):(r[o]&&F.isObject(r[o])||(r[o]=[]),e(t,n,r[o],i)&&F.isArray(r[o])&&(r[o]=function(t){var e,n,r={},i=Object.keys(t),o=i.length;for(e=0;e<o;e++)r[n=i[e]]=t[n];return r}(r[o])),!a)}if(F.isFormData(t)&&F.isFunction(t.entries)){var n={};return F.forEachEntry(t,(function(t,r){e(function(t){return F.matchAll(/\w+|\[(\w*)]/g,t).map((function(t){return"[]"===t[0]?"":t[1]||t[0]}))}(t),r,n,0)})),n}return null};var gt={transitional:st,adapter:["xhr","http"],transformRequest:[function(t,e){var n,r=e.getContentType()||"",i=r.indexOf("application/json")>-1,o=F.isObject(t);if(o&&F.isHTMLForm(t)&&(t=new FormData(t)),F.isFormData(t))return i?JSON.stringify(vt(t)):t;if(F.isArrayBuffer(t)||F.isBuffer(t)||F.isStream(t)||F.isFile(t)||F.isBlob(t))return t;if(F.isArrayBufferView(t))return t.buffer;if(F.isURLSearchParams(t))return e.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),t.toString();if(o){if(r.indexOf("application/x-www-form-urlencoded")>-1)return function(t,e){return Z(t,new yt.classes.URLSearchParams,Object.assign({visitor:function(t,e,n,r){return yt.isNode&&F.isBuffer(t)?(this.append(e,t.toString("base64")),!1):r.defaultVisitor.apply(this,arguments)}},e))}(t,this.formSerializer).toString();if((n=F.isFileList(t))||r.indexOf("multipart/form-data")>-1){var a=this.env&&this.env.FormData;return Z(n?{"files[]":t}:t,a&&new a,this.formSerializer)}}return o||i?(e.setContentType("application/json",!1),function(t,e,n){if(F.isString(t))try{return(0,JSON.parse)(t),F.trim(t)}catch(t){if("SyntaxError"!==t.name)throw t}return(0,JSON.stringify)(t)}(t)):t}],transformResponse:[function(t){var e=this.transitional||gt.transitional,n=e&&e.forcedJSONParsing,r="json"===this.responseType;if(t&&F.isString(t)&&(n&&!this.responseType||r)){var i=!(e&&e.silentJSONParsing)&&r;try{return JSON.parse(t)}catch(t){if(i){if("SyntaxError"===t.name)throw H.from(t,H.ERR_BAD_RESPONSE,this,null,this.response);throw t}}}return t}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:yt.classes.FormData,Blob:yt.classes.Blob},validateStatus:function(t){return t>=200&&t<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};F.forEach(["delete","get","head","post","put","patch"],(function(t){gt.headers[t]={}}));const bt=gt;var _t=F.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]);function xt(t){return xt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},xt(t)}function wt(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function St(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Tt(r.key),r)}}function Tt(t){var e=function(t,e){if("object"!=xt(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=xt(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==xt(e)?e:e+""}var Mt=Symbol("internals");function Et(t){return t&&String(t).trim().toLowerCase()}function At(t){return!1===t||null==t?t:F.isArray(t)?t.map(At):String(t)}function Ot(t,e,n,r,i){return F.isFunction(r)?r.call(this,e,n):(i&&(e=n),F.isString(e)?F.isString(r)?-1!==e.indexOf(r):F.isRegExp(r)?r.test(e):void 0:void 0)}var Pt=function(){return t=function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),e&&this.set(e)},e=[{key:"set",value:function(t,e,n){var r=this;function i(t,e,n){var i=Et(e);if(!i)throw new Error("header name must be a non-empty string");var o=F.findKey(r,i);(!o||void 0===r[o]||!0===n||void 0===n&&!1!==r[o])&&(r[o||e]=At(t))}var o,a,s,u,c,l=function(t,e){return F.forEach(t,(function(t,n){return i(t,n,e)}))};return F.isPlainObject(t)||t instanceof this.constructor?l(t,e):F.isString(t)&&(t=t.trim())&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(t.trim())?l((c={},(o=t)&&o.split("\n").forEach((function(t){u=t.indexOf(":"),a=t.substring(0,u).trim().toLowerCase(),s=t.substring(u+1).trim(),!a||c[a]&&_t[a]||("set-cookie"===a?c[a]?c[a].push(s):c[a]=[s]:c[a]=c[a]?c[a]+", "+s:s)})),c),e):null!=t&&i(e,t,n),this}},{key:"get",value:function(t,e){if(t=Et(t)){var n=F.findKey(this,t);if(n){var r=this[n];if(!e)return r;if(!0===e)return function(t){for(var e,n=Object.create(null),r=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;e=r.exec(t);)n[e[1]]=e[2];return n}(r);if(F.isFunction(e))return e.call(this,r,n);if(F.isRegExp(e))return e.exec(r);throw new TypeError("parser must be boolean|regexp|function")}}}},{key:"has",value:function(t,e){if(t=Et(t)){var n=F.findKey(this,t);return!(!n||void 0===this[n]||e&&!Ot(0,this[n],n,e))}return!1}},{key:"delete",value:function(t,e){var n=this,r=!1;function i(t){if(t=Et(t)){var i=F.findKey(n,t);!i||e&&!Ot(0,n[i],i,e)||(delete n[i],r=!0)}}return F.isArray(t)?t.forEach(i):i(t),r}},{key:"clear",value:function(t){for(var e=Object.keys(this),n=e.length,r=!1;n--;){var i=e[n];t&&!Ot(0,this[i],i,t,!0)||(delete this[i],r=!0)}return r}},{key:"normalize",value:function(t){var e=this,n={};return F.forEach(this,(function(r,i){var o=F.findKey(n,i);if(o)return e[o]=At(r),void delete e[i];var a=t?function(t){return t.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(function(t,e,n){return e.toUpperCase()+n}))}(i):String(i).trim();a!==i&&delete e[i],e[a]=At(r),n[a]=!0})),this}},{key:"concat",value:function(){for(var t,e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return(t=this.constructor).concat.apply(t,[this].concat(n))}},{key:"toJSON",value:function(t){var e=Object.create(null);return F.forEach(this,(function(n,r){null!=n&&!1!==n&&(e[r]=t&&F.isArray(n)?n.join(", "):n)})),e}},{key:Symbol.iterator,value:function(){return Object.entries(this.toJSON())[Symbol.iterator]()}},{key:"toString",value:function(){return Object.entries(this.toJSON()).map((function(t){var e,n,r=(n=2,function(t){if(Array.isArray(t))return t}(e=t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,i,o,a,s=[],u=!0,c=!1;try{if(o=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=o.call(n)).done)&&(s.push(r.value),s.length!==e);u=!0);}catch(t){c=!0,i=t}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw i}}return s}}(e,n)||function(t,e){if(t){if("string"==typeof t)return wt(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?wt(t,e):void 0}}(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}());return r[0]+": "+r[1]})).join("\n")}},{key:Symbol.toStringTag,get:function(){return"AxiosHeaders"}}],n=[{key:"from",value:function(t){return t instanceof this?t:new this(t)}},{key:"concat",value:function(t){for(var e=new this(t),n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];return r.forEach((function(t){return e.set(t)})),e}},{key:"accessor",value:function(t){var e=(this[Mt]=this[Mt]={accessors:{}}).accessors,n=this.prototype;function r(t){var r=Et(t);e[r]||(function(t,e){var n=F.toCamelCase(" "+e);["get","set","has"].forEach((function(r){Object.defineProperty(t,r+n,{value:function(t,n,i){return this[r].call(this,e,t,n,i)},configurable:!0})}))}(n,t),e[r]=!0)}return F.isArray(t)?t.forEach(r):r(t),this}}],e&&St(t.prototype,e),n&&St(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,n}();Pt.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),F.reduceDescriptors(Pt.prototype,(function(t,e){var n=t.value,r=e[0].toUpperCase()+e.slice(1);return{get:function(){return n},set:function(t){this[r]=t}}})),F.freezeMethods(Pt);const Rt=Pt;function kt(t,e){var n=this||bt,r=e||n,i=Rt.from(r.headers),o=r.data;return F.forEach(t,(function(t){o=t.call(n,o,i.normalize(),e?e.status:void 0)})),i.normalize(),o}function Ct(t){return!(!t||!t.__CANCEL__)}function Nt(t,e,n){H.call(this,null==t?"canceled":t,H.ERR_CANCELED,e,n),this.name="CanceledError"}F.inherits(Nt,H,{__CANCEL__:!0});const Lt=Nt,jt=yt.hasStandardBrowserEnv?{write:function(t,e,n,r,i,o){var a=[t+"="+encodeURIComponent(e)];F.isNumber(n)&&a.push("expires="+new Date(n).toGMTString()),F.isString(r)&&a.push("path="+r),F.isString(i)&&a.push("domain="+i),!0===o&&a.push("secure"),document.cookie=a.join("; ")},read:function(t){var e=document.cookie.match(new RegExp("(^|;\\s*)("+t+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove:function(t){this.write(t,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}};function It(t,e){return t&&!/^([a-z][a-z\d+\-.]*:)?\/\//i.test(e)?function(t,e){return e?t.replace(/\/?\/$/,"")+"/"+e.replace(/^\/+/,""):t}(t,e):e}const Bt=yt.hasStandardBrowserEnv?function(){var t,e=/(msie|trident)/i.test(navigator.userAgent),n=document.createElement("a");function r(t){var r=t;return e&&(n.setAttribute("href",r),r=n.href),n.setAttribute("href",r),{href:n.href,protocol:n.protocol?n.protocol.replace(/:$/,""):"",host:n.host,search:n.search?n.search.replace(/^\?/,""):"",hash:n.hash?n.hash.replace(/^#/,""):"",hostname:n.hostname,port:n.port,pathname:"/"===n.pathname.charAt(0)?n.pathname:"/"+n.pathname}}return t=r(window.location.href),function(e){var n=F.isString(e)?r(e):e;return n.protocol===t.protocol&&n.host===t.host}}():function(){return!0};function Ut(t,e){if(t){if("string"==typeof t)return Dt(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Dt(t,e):void 0}}function Dt(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function Ft(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}function zt(t,e){var n=0,r=function(t,e){t=t||10;var n,r=new Array(t),i=new Array(t),o=0,a=0;return e=void 0!==e?e:1e3,function(s){var u=Date.now(),c=i[a];n||(n=u),r[o]=s,i[o]=u;for(var l=a,f=0;l!==o;)f+=r[l++],l%=t;if((o=(o+1)%t)===a&&(a=(a+1)%t),!(u-n<e)){var h=c&&u-c;return h?Math.round(1e3*f/h):void 0}}}(50,250);return function(i){var o=i.loaded,a=i.lengthComputable?i.total:void 0,s=o-n,u=r(s);n=o;var c={loaded:o,total:a,progress:a?o/a:void 0,bytes:s,rate:u||void 0,estimated:u&&a&&o<=a?(a-o)/u:void 0,event:i};c[e?"download":"upload"]=!0,t(c)}}function Vt(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var Gt={http:null,xhr:"undefined"!=typeof XMLHttpRequest&&function(t){return new Promise((function(e,n){var r,i,o,a=t.data,s=Rt.from(t.headers).normalize(),u=t.responseType,c=t.withXSRFToken;function l(){t.cancelToken&&t.cancelToken.unsubscribe(r),t.signal&&t.signal.removeEventListener("abort",r)}if(F.isFormData(a))if(yt.hasStandardBrowserEnv||yt.hasStandardBrowserWebWorkerEnv)s.setContentType(!1);else if(!1!==(i=s.getContentType())){var f=function(t){if(Array.isArray(t))return t}(o=i?i.split(";").map((function(t){return t.trim()})).filter(Boolean):[])||Ft(o)||Ut(o)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),h=f[0],p=f.slice(1);s.setContentType([h||"multipart/form-data"].concat(function(t){return function(t){if(Array.isArray(t))return Dt(t)}(t)||Ft(t)||Ut(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(p)).join("; "))}var d=new XMLHttpRequest;if(t.auth){var m=t.auth.username||"",y=t.auth.password?unescape(encodeURIComponent(t.auth.password)):"";s.set("Authorization","Basic "+btoa(m+":"+y))}var v=It(t.baseURL,t.url);function g(){if(d){var r=Rt.from("getAllResponseHeaders"in d&&d.getAllResponseHeaders());!function(t,e,n){var r=n.config.validateStatus;n.status&&r&&!r(n.status)?e(new H("Request failed with status code "+n.status,[H.ERR_BAD_REQUEST,H.ERR_BAD_RESPONSE][Math.floor(n.status/100)-4],n.config,n.request,n)):t(n)}((function(t){e(t),l()}),(function(t){n(t),l()}),{data:u&&"text"!==u&&"json"!==u?d.response:d.responseText,status:d.status,statusText:d.statusText,headers:r,config:t,request:d}),d=null}}if(d.open(t.method.toUpperCase(),nt(v,t.params,t.paramsSerializer),!0),d.timeout=t.timeout,"onloadend"in d?d.onloadend=g:d.onreadystatechange=function(){d&&4===d.readyState&&(0!==d.status||d.responseURL&&0===d.responseURL.indexOf("file:"))&&setTimeout(g)},d.onabort=function(){d&&(n(new H("Request aborted",H.ECONNABORTED,t,d)),d=null)},d.onerror=function(){n(new H("Network Error",H.ERR_NETWORK,t,d)),d=null},d.ontimeout=function(){var e=t.timeout?"timeout of "+t.timeout+"ms exceeded":"timeout exceeded",r=t.transitional||st;t.timeoutErrorMessage&&(e=t.timeoutErrorMessage),n(new H(e,r.clarifyTimeoutError?H.ETIMEDOUT:H.ECONNABORTED,t,d)),d=null},yt.hasStandardBrowserEnv&&(c&&F.isFunction(c)&&(c=c(t)),c||!1!==c&&Bt(v))){var b=t.xsrfHeaderName&&t.xsrfCookieName&&jt.read(t.xsrfCookieName);b&&s.set(t.xsrfHeaderName,b)}void 0===a&&s.setContentType(null),"setRequestHeader"in d&&F.forEach(s.toJSON(),(function(t,e){d.setRequestHeader(e,t)})),F.isUndefined(t.withCredentials)||(d.withCredentials=!!t.withCredentials),u&&"json"!==u&&(d.responseType=t.responseType),"function"==typeof t.onDownloadProgress&&d.addEventListener("progress",zt(t.onDownloadProgress,!0)),"function"==typeof t.onUploadProgress&&d.upload&&d.upload.addEventListener("progress",zt(t.onUploadProgress)),(t.cancelToken||t.signal)&&(r=function(e){d&&(n(!e||e.type?new Lt(null,t,d):e),d.abort(),d=null)},t.cancelToken&&t.cancelToken.subscribe(r),t.signal&&(t.signal.aborted?r():t.signal.addEventListener("abort",r)));var _,x=(_=/^([-+\w]{1,25})(:?\/\/|:)/.exec(v))&&_[1]||"";x&&-1===yt.protocols.indexOf(x)?n(new H("Unsupported protocol "+x+":",H.ERR_BAD_REQUEST,t)):d.send(a||null)}))}};F.forEach(Gt,(function(t,e){if(t){try{Object.defineProperty(t,"name",{value:e})}catch(t){}Object.defineProperty(t,"adapterName",{value:e})}}));var Ht=function(t){return"- ".concat(t)},Wt=function(t){return F.isFunction(t)||null===t||!1===t};const qt=function(t){for(var e,n,r=(t=F.isArray(t)?t:[t]).length,i={},o=0;o<r;o++){var a=void 0;if(n=e=t[o],!Wt(e)&&void 0===(n=Gt[(a=String(e)).toLowerCase()]))throw new H("Unknown adapter '".concat(a,"'"));if(n)break;i[a||"#"+o]=n}if(!n){var s=Object.entries(i).map((function(t){var e=function(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,i,o,a,s=[],u=!0,c=!1;try{if(o=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=o.call(n)).done)&&(s.push(r.value),s.length!==e);u=!0);}catch(t){c=!0,i=t}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw i}}return s}}(t,e)||function(t,e){if(t){if("string"==typeof t)return Vt(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Vt(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(t,2),n=e[0],r=e[1];return"adapter ".concat(n," ")+(!1===r?"is not supported by the environment":"is not available in the build")})),u=r?s.length>1?"since :\n"+s.map(Ht).join("\n"):" "+Ht(s[0]):"as no adapter specified";throw new H("There is no suitable adapter to dispatch the request "+u,"ERR_NOT_SUPPORT")}return n};function Xt(t){if(t.cancelToken&&t.cancelToken.throwIfRequested(),t.signal&&t.signal.aborted)throw new Lt(null,t)}function Yt(t){return Xt(t),t.headers=Rt.from(t.headers),t.data=kt.call(t,t.transformRequest),-1!==["post","put","patch"].indexOf(t.method)&&t.headers.setContentType("application/x-www-form-urlencoded",!1),qt(t.adapter||bt.adapter)(t).then((function(e){return Xt(t),e.data=kt.call(t,t.transformResponse,e),e.headers=Rt.from(e.headers),e}),(function(e){return Ct(e)||(Xt(t),e&&e.response&&(e.response.data=kt.call(t,t.transformResponse,e.response),e.response.headers=Rt.from(e.response.headers))),Promise.reject(e)}))}function Jt(t){return Jt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Jt(t)}function Zt(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}var Kt=function(t){return t instanceof Rt?function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Zt(Object(n),!0).forEach((function(e){var r,i,o,a;r=t,i=e,o=n[e],a=function(t,e){if("object"!=Jt(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=Jt(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(i),(i="symbol"==Jt(a)?a:a+"")in r?Object.defineProperty(r,i,{value:o,enumerable:!0,configurable:!0,writable:!0}):r[i]=o})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Zt(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}({},t):t};function Qt(t,e){e=e||{};var n={};function r(t,e,n){return F.isPlainObject(t)&&F.isPlainObject(e)?F.merge.call({caseless:n},t,e):F.isPlainObject(e)?F.merge({},e):F.isArray(e)?e.slice():e}function i(t,e,n){return F.isUndefined(e)?F.isUndefined(t)?void 0:r(void 0,t,n):r(t,e,n)}function o(t,e){if(!F.isUndefined(e))return r(void 0,e)}function a(t,e){return F.isUndefined(e)?F.isUndefined(t)?void 0:r(void 0,t):r(void 0,e)}function s(n,i,o){return o in e?r(n,i):o in t?r(void 0,n):void 0}var u={url:o,method:o,data:o,baseURL:a,transformRequest:a,transformResponse:a,paramsSerializer:a,timeout:a,timeoutMessage:a,withCredentials:a,withXSRFToken:a,adapter:a,responseType:a,xsrfCookieName:a,xsrfHeaderName:a,onUploadProgress:a,onDownloadProgress:a,decompress:a,maxContentLength:a,maxBodyLength:a,beforeRedirect:a,transport:a,httpAgent:a,httpsAgent:a,cancelToken:a,socketPath:a,responseEncoding:a,validateStatus:s,headers:function(t,e){return i(Kt(t),Kt(e),!0)}};return F.forEach(Object.keys(Object.assign({},t,e)),(function(r){var o=u[r]||i,a=o(t[r],e[r],r);F.isUndefined(a)&&o!==s||(n[r]=a)})),n}function $t(t){return $t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},$t(t)}var te={};["object","boolean","number","function","string","symbol"].forEach((function(t,e){te[t]=function(n){return $t(n)===t||"a"+(e<1?"n ":" ")+t}}));var ee={};te.transitional=function(t,e,n){function r(t,e){return"[Axios v1.6.8] Transitional option '"+t+"'"+e+(n?". "+n:"")}return function(n,i,o){if(!1===t)throw new H(r(i," has been removed"+(e?" in "+e:"")),H.ERR_DEPRECATED);return e&&!ee[i]&&(ee[i]=!0,console.warn(r(i," has been deprecated since v"+e+" and will be removed in the near future"))),!t||t(n,i,o)}};const ne={assertOptions:function(t,e,n){if("object"!==$t(t))throw new H("options must be an object",H.ERR_BAD_OPTION_VALUE);for(var r=Object.keys(t),i=r.length;i-- >0;){var o=r[i],a=e[o];if(a){var s=t[o],u=void 0===s||a(s,o,t);if(!0!==u)throw new H("option "+o+" must be "+u,H.ERR_BAD_OPTION_VALUE)}else if(!0!==n)throw new H("Unknown option "+o,H.ERR_BAD_OPTION)}},validators:te};function re(t){return re="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},re(t)}function ie(){ie=function(){return e};var t,e={},n=Object.prototype,r=n.hasOwnProperty,i=Object.defineProperty||function(t,e,n){t[e]=n.value},o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",s=o.asyncIterator||"@@asyncIterator",u=o.toStringTag||"@@toStringTag";function c(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{c({},"")}catch(t){c=function(t,e,n){return t[e]=n}}function l(t,e,n,r){var o=e&&e.prototype instanceof v?e:v,a=Object.create(o.prototype),s=new R(r||[]);return i(a,"_invoke",{value:E(t,n,s)}),a}function f(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var h="suspendedStart",p="suspendedYield",d="executing",m="completed",y={};function v(){}function g(){}function b(){}var _={};c(_,a,(function(){return this}));var x=Object.getPrototypeOf,w=x&&x(x(k([])));w&&w!==n&&r.call(w,a)&&(_=w);var S=b.prototype=v.prototype=Object.create(_);function T(t){["next","throw","return"].forEach((function(e){c(t,e,(function(t){return this._invoke(e,t)}))}))}function M(t,e){function n(i,o,a,s){var u=f(t[i],t,o);if("throw"!==u.type){var c=u.arg,l=c.value;return l&&"object"==re(l)&&r.call(l,"__await")?e.resolve(l.__await).then((function(t){n("next",t,a,s)}),(function(t){n("throw",t,a,s)})):e.resolve(l).then((function(t){c.value=t,a(c)}),(function(t){return n("throw",t,a,s)}))}s(u.arg)}var o;i(this,"_invoke",{value:function(t,r){function i(){return new e((function(e,i){n(t,r,e,i)}))}return o=o?o.then(i,i):i()}})}function E(e,n,r){var i=h;return function(o,a){if(i===d)throw Error("Generator is already running");if(i===m){if("throw"===o)throw a;return{value:t,done:!0}}for(r.method=o,r.arg=a;;){var s=r.delegate;if(s){var u=A(s,r);if(u){if(u===y)continue;return u}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(i===h)throw i=m,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);i=d;var c=f(e,n,r);if("normal"===c.type){if(i=r.done?m:p,c.arg===y)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(i=m,r.method="throw",r.arg=c.arg)}}}function A(e,n){var r=n.method,i=e.iterator[r];if(i===t)return n.delegate=null,"throw"===r&&e.iterator.return&&(n.method="return",n.arg=t,A(e,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),y;var o=f(i,e.iterator,n.arg);if("throw"===o.type)return n.method="throw",n.arg=o.arg,n.delegate=null,y;var a=o.arg;return a?a.done?(n[e.resultName]=a.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,y):a:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,y)}function O(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function P(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function R(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(O,this),this.reset(!0)}function k(e){if(e||""===e){var n=e[a];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,o=function n(){for(;++i<e.length;)if(r.call(e,i))return n.value=e[i],n.done=!1,n;return n.value=t,n.done=!0,n};return o.next=o}}throw new TypeError(re(e)+" is not iterable")}return g.prototype=b,i(S,"constructor",{value:b,configurable:!0}),i(b,"constructor",{value:g,configurable:!0}),g.displayName=c(b,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===g||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,c(t,u,"GeneratorFunction")),t.prototype=Object.create(S),t},e.awrap=function(t){return{__await:t}},T(M.prototype),c(M.prototype,s,(function(){return this})),e.AsyncIterator=M,e.async=function(t,n,r,i,o){void 0===o&&(o=Promise);var a=new M(l(t,n,r,i),o);return e.isGeneratorFunction(n)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},T(S),c(S,u,"Generator"),c(S,a,(function(){return this})),c(S,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),n=[];for(var r in e)n.push(r);return n.reverse(),function t(){for(;n.length;){var r=n.pop();if(r in e)return t.value=r,t.done=!1,t}return t.done=!0,t}},e.values=k,R.prototype={constructor:R,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(P),!e)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function i(r,i){return s.type="throw",s.arg=e,n.next=r,i&&(n.method="next",n.arg=t),!!i}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],s=a.completion;if("root"===a.tryLoc)return i("end");if(a.tryLoc<=this.prev){var u=r.call(a,"catchLoc"),c=r.call(a,"finallyLoc");if(u&&c){if(this.prev<a.catchLoc)return i(a.catchLoc,!0);if(this.prev<a.finallyLoc)return i(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return i(a.catchLoc,!0)}else{if(!c)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return i(a.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=t,a.arg=e,o?(this.method="next",this.next=o.finallyLoc,y):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),y},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),P(n),y}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var i=r.arg;P(n)}return i}}throw Error("illegal catch attempt")},delegateYield:function(e,n,r){return this.delegate={iterator:k(e),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=t),y}},e}function oe(t,e,n,r,i,o,a){try{var s=t[o](a),u=s.value}catch(t){return void n(t)}s.done?e(u):Promise.resolve(u).then(r,i)}function ae(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,se(r.key),r)}}function se(t){var e=function(t,e){if("object"!=re(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=re(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==re(e)?e:e+""}var ue=ne.validators,ce=function(){return t=function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.defaults=e,this.interceptors={request:new at,response:new at}},e=[{key:"request",value:(n=ie().mark((function t(e,n){var r,i;return ie().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,this._request(e,n);case 3:return t.abrupt("return",t.sent);case 6:throw t.prev=6,t.t0=t.catch(0),t.t0 instanceof Error&&(Error.captureStackTrace?Error.captureStackTrace(r={}):r=new Error,i=r.stack?r.stack.replace(/^.+\n/,""):"",t.t0.stack?i&&!String(t.t0.stack).endsWith(i.replace(/^.+\n.+\n/,""))&&(t.t0.stack+="\n"+i):t.t0.stack=i),t.t0;case 10:case"end":return t.stop()}}),t,this,[[0,6]])})),r=function(){var t=this,e=arguments;return new Promise((function(r,i){var o=n.apply(t,e);function a(t){oe(o,r,i,a,s,"next",t)}function s(t){oe(o,r,i,a,s,"throw",t)}a(void 0)}))},function(t,e){return r.apply(this,arguments)})},{key:"_request",value:function(t,e){"string"==typeof t?(e=e||{}).url=t:e=t||{};var n=e=Qt(this.defaults,e),r=n.transitional,i=n.paramsSerializer,o=n.headers;void 0!==r&&ne.assertOptions(r,{silentJSONParsing:ue.transitional(ue.boolean),forcedJSONParsing:ue.transitional(ue.boolean),clarifyTimeoutError:ue.transitional(ue.boolean)},!1),null!=i&&(F.isFunction(i)?e.paramsSerializer={serialize:i}:ne.assertOptions(i,{encode:ue.function,serialize:ue.function},!0)),e.method=(e.method||this.defaults.method||"get").toLowerCase();var a=o&&F.merge(o.common,o[e.method]);o&&F.forEach(["delete","get","head","post","put","patch","common"],(function(t){delete o[t]})),e.headers=Rt.concat(a,o);var s=[],u=!0;this.interceptors.request.forEach((function(t){"function"==typeof t.runWhen&&!1===t.runWhen(e)||(u=u&&t.synchronous,s.unshift(t.fulfilled,t.rejected))}));var c,l=[];this.interceptors.response.forEach((function(t){l.push(t.fulfilled,t.rejected)}));var f,h=0;if(!u){var p=[Yt.bind(this),void 0];for(p.unshift.apply(p,s),p.push.apply(p,l),f=p.length,c=Promise.resolve(e);h<f;)c=c.then(p[h++],p[h++]);return c}f=s.length;var d=e;for(h=0;h<f;){var m=s[h++],y=s[h++];try{d=m(d)}catch(t){y.call(this,t);break}}try{c=Yt.call(this,d)}catch(t){return Promise.reject(t)}for(h=0,f=l.length;h<f;)c=c.then(l[h++],l[h++]);return c}},{key:"getUri",value:function(t){return nt(It((t=Qt(this.defaults,t)).baseURL,t.url),t.params,t.paramsSerializer)}}],e&&ae(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,n,r}();F.forEach(["delete","get","head","options"],(function(t){ce.prototype[t]=function(e,n){return this.request(Qt(n||{},{method:t,url:e,data:(n||{}).data}))}})),F.forEach(["post","put","patch"],(function(t){function e(e){return function(n,r,i){return this.request(Qt(i||{},{method:t,headers:e?{"Content-Type":"multipart/form-data"}:{},url:n,data:r}))}}ce.prototype[t]=e(),ce.prototype[t+"Form"]=e(!0)}));const le=ce;function fe(t){return fe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},fe(t)}function he(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,pe(r.key),r)}}function pe(t){var e=function(t,e){if("object"!=fe(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=fe(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==fe(e)?e:e+""}const de=function(){function t(e){if(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),"function"!=typeof e)throw new TypeError("executor must be a function.");var n;this.promise=new Promise((function(t){n=t}));var r=this;this.promise.then((function(t){if(r._listeners){for(var e=r._listeners.length;e-- >0;)r._listeners[e](t);r._listeners=null}})),this.promise.then=function(t){var e,n=new Promise((function(t){r.subscribe(t),e=t})).then(t);return n.cancel=function(){r.unsubscribe(e)},n},e((function(t,e,i){r.reason||(r.reason=new Lt(t,e,i),n(r.reason))}))}return e=t,r=[{key:"source",value:function(){var e;return{token:new t((function(t){e=t})),cancel:e}}}],(n=[{key:"throwIfRequested",value:function(){if(this.reason)throw this.reason}},{key:"subscribe",value:function(t){this.reason?t(this.reason):this._listeners?this._listeners.push(t):this._listeners=[t]}},{key:"unsubscribe",value:function(t){if(this._listeners){var e=this._listeners.indexOf(t);-1!==e&&this._listeners.splice(e,1)}}}])&&he(e.prototype,n),r&&he(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,n,r}();function me(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var ye={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(ye).forEach((function(t){var e,n,r=(n=2,function(t){if(Array.isArray(t))return t}(e=t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,i,o,a,s=[],u=!0,c=!1;try{if(o=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=o.call(n)).done)&&(s.push(r.value),s.length!==e);u=!0);}catch(t){c=!0,i=t}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw i}}return s}}(e,n)||function(t,e){if(t){if("string"==typeof t)return me(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?me(t,e):void 0}}(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),i=r[0],o=r[1];ye[o]=i}));const ve=ye;var ge=function t(e){var n=new le(e),r=i(le.prototype.request,n);return F.extend(r,le.prototype,n,{allOwnKeys:!0}),F.extend(r,n,null,{allOwnKeys:!0}),r.create=function(n){return t(Qt(e,n))},r}(bt);ge.Axios=le,ge.CanceledError=Lt,ge.CancelToken=de,ge.isCancel=Ct,ge.VERSION="1.6.8",ge.toFormData=Z,ge.AxiosError=H,ge.Cancel=ge.CanceledError,ge.all=function(t){return Promise.all(t)},ge.spread=function(t){return function(e){return t.apply(null,e)}},ge.isAxiosError=function(t){return F.isObject(t)&&!0===t.isAxiosError},ge.mergeConfig=Qt,ge.AxiosHeaders=Rt,ge.formToJSON=function(t){return vt(F.isHTMLForm(t)?new FormData(t):t)},ge.getAdapter=qt,ge.HttpStatusCode=ve,ge.default=ge;const be=ge},554:(t,e,n)=>{function r(t){var e="function"==typeof Map?new Map:void 0;return r=function(t){if(null===t||!function(t){try{return-1!==Function.toString.call(t).indexOf("[native code]")}catch(e){return"function"==typeof t}}(t))return t;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,n)}function n(){return function(t,e,n){if(m())return Reflect.construct.apply(null,arguments);var r=[null];r.push.apply(r,e);var i=new(t.bind.apply(t,r));return n&&g(i,n.prototype),i}(t,arguments,y(this).constructor)}return n.prototype=Object.create(t.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),g(n,t)},r(t)}function i(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function o(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?i(Object(n),!0).forEach((function(e){b(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function a(t,e,n,r,i,o,a){try{var s=t[o](a),u=s.value}catch(t){return void n(t)}s.done?e(u):Promise.resolve(u).then(r,i)}function s(t){return function(){var e=this,n=arguments;return new Promise((function(r,i){var o=t.apply(e,n);function s(t){a(o,r,i,s,u,"next",t)}function u(t){a(o,r,i,s,u,"throw",t)}s(void 0)}))}}function u(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=h(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function c(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,i,o,a,s=[],u=!0,c=!1;try{if(o=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=o.call(n)).done)&&(s.push(r.value),s.length!==e);u=!0);}catch(t){c=!0,i=t}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw i}}return s}}(t,e)||h(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function l(){return l="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=y(t)););return t}(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(arguments.length<3?t:n):i.value}},l.apply(this,arguments)}function f(t){return function(t){if(Array.isArray(t))return p(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||h(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function h(t,e){if(t){if("string"==typeof t)return p(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?p(t,e):void 0}}function p(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function d(t,e,n){return e=y(e),function(t,e){if(e&&("object"===x(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,m()?Reflect.construct(e,n||[],y(t).constructor):e.apply(t,n))}function m(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(m=function(){return!!t})()}function y(t){return y=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},y(t)}function v(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&g(t,e)}function g(t,e){return g=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},g(t,e)}function b(t,e,n){return(e=M(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function _(){_=function(){return e};var t,e={},n=Object.prototype,r=n.hasOwnProperty,i=Object.defineProperty||function(t,e,n){t[e]=n.value},o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",s=o.asyncIterator||"@@asyncIterator",u=o.toStringTag||"@@toStringTag";function c(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{c({},"")}catch(t){c=function(t,e,n){return t[e]=n}}function l(t,e,n,r){var o=e&&e.prototype instanceof v?e:v,a=Object.create(o.prototype),s=new C(r||[]);return i(a,"_invoke",{value:O(t,n,s)}),a}function f(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var h="suspendedStart",p="suspendedYield",d="executing",m="completed",y={};function v(){}function g(){}function b(){}var w={};c(w,a,(function(){return this}));var S=Object.getPrototypeOf,T=S&&S(S(N([])));T&&T!==n&&r.call(T,a)&&(w=T);var M=b.prototype=v.prototype=Object.create(w);function E(t){["next","throw","return"].forEach((function(e){c(t,e,(function(t){return this._invoke(e,t)}))}))}function A(t,e){function n(i,o,a,s){var u=f(t[i],t,o);if("throw"!==u.type){var c=u.arg,l=c.value;return l&&"object"==x(l)&&r.call(l,"__await")?e.resolve(l.__await).then((function(t){n("next",t,a,s)}),(function(t){n("throw",t,a,s)})):e.resolve(l).then((function(t){c.value=t,a(c)}),(function(t){return n("throw",t,a,s)}))}s(u.arg)}var o;i(this,"_invoke",{value:function(t,r){function i(){return new e((function(e,i){n(t,r,e,i)}))}return o=o?o.then(i,i):i()}})}function O(e,n,r){var i=h;return function(o,a){if(i===d)throw Error("Generator is already running");if(i===m){if("throw"===o)throw a;return{value:t,done:!0}}for(r.method=o,r.arg=a;;){var s=r.delegate;if(s){var u=P(s,r);if(u){if(u===y)continue;return u}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(i===h)throw i=m,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);i=d;var c=f(e,n,r);if("normal"===c.type){if(i=r.done?m:p,c.arg===y)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(i=m,r.method="throw",r.arg=c.arg)}}}function P(e,n){var r=n.method,i=e.iterator[r];if(i===t)return n.delegate=null,"throw"===r&&e.iterator.return&&(n.method="return",n.arg=t,P(e,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),y;var o=f(i,e.iterator,n.arg);if("throw"===o.type)return n.method="throw",n.arg=o.arg,n.delegate=null,y;var a=o.arg;return a?a.done?(n[e.resultName]=a.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,y):a:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,y)}function R(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function k(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function C(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(R,this),this.reset(!0)}function N(e){if(e||""===e){var n=e[a];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,o=function n(){for(;++i<e.length;)if(r.call(e,i))return n.value=e[i],n.done=!1,n;return n.value=t,n.done=!0,n};return o.next=o}}throw new TypeError(x(e)+" is not iterable")}return g.prototype=b,i(M,"constructor",{value:b,configurable:!0}),i(b,"constructor",{value:g,configurable:!0}),g.displayName=c(b,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===g||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,c(t,u,"GeneratorFunction")),t.prototype=Object.create(M),t},e.awrap=function(t){return{__await:t}},E(A.prototype),c(A.prototype,s,(function(){return this})),e.AsyncIterator=A,e.async=function(t,n,r,i,o){void 0===o&&(o=Promise);var a=new A(l(t,n,r,i),o);return e.isGeneratorFunction(n)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},E(M),c(M,u,"Generator"),c(M,a,(function(){return this})),c(M,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),n=[];for(var r in e)n.push(r);return n.reverse(),function t(){for(;n.length;){var r=n.pop();if(r in e)return t.value=r,t.done=!1,t}return t.done=!0,t}},e.values=N,C.prototype={constructor:C,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(k),!e)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function i(r,i){return s.type="throw",s.arg=e,n.next=r,i&&(n.method="next",n.arg=t),!!i}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],s=a.completion;if("root"===a.tryLoc)return i("end");if(a.tryLoc<=this.prev){var u=r.call(a,"catchLoc"),c=r.call(a,"finallyLoc");if(u&&c){if(this.prev<a.catchLoc)return i(a.catchLoc,!0);if(this.prev<a.finallyLoc)return i(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return i(a.catchLoc,!0)}else{if(!c)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return i(a.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=t,a.arg=e,o?(this.method="next",this.next=o.finallyLoc,y):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),y},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),k(n),y}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var i=r.arg;k(n)}return i}}throw Error("illegal catch attempt")},delegateYield:function(e,n,r){return this.delegate={iterator:N(e),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=t),y}},e}function x(t){return x="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},x(t)}function w(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function S(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,M(r.key),r)}}function T(t,e,n){return e&&S(t.prototype,e),n&&S(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function M(t){var e=function(t,e){if("object"!=x(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=x(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==x(e)?e:e+""}n.d(e,{$EB:()=>L,$Kf:()=>ps,$_I:()=>Nt,$ei:()=>W,$p8:()=>Pl,A$4:()=>Wi,B69:()=>vi,BH$:()=>eu,BKk:()=>Ao,BRH:()=>hl,BXX:()=>ue,B_h:()=>ve,CMB:()=>Kt,CR7:()=>fn,CVz:()=>pe,CWW:()=>Le,Cfg:()=>Rt,Dmk:()=>qt,EAD:()=>vs,EZo:()=>B,EdD:()=>D,F1T:()=>Lo,FFZ:()=>Sn,FV:()=>vt,FXf:()=>V,Fn:()=>Re,Fvt:()=>Dc,GJx:()=>Mt,GWd:()=>Jt,GYF:()=>ds,G_z:()=>Bc,Gu$:()=>wc,Gwm:()=>ut,HIg:()=>Yt,HLH:()=>nn,HO_:()=>Ne,HPb:()=>un,HXV:()=>fe,HiM:()=>El,Hit:()=>Kc,I46:()=>hs,I9Y:()=>Fn,IE4:()=>oe,IUQ:()=>cr,Ipv:()=>cu,Iw4:()=>Ql,Jnc:()=>k,K52:()=>ct,KDk:()=>me,Kef:()=>ke,Kwu:()=>U,Kzv:()=>Zt,LAk:()=>gt,LiQ:()=>J,LlO:()=>Eo,LoY:()=>no,LuO:()=>$l,MBL:()=>$c,MW4:()=>qi,Mjd:()=>mt,N1A:()=>Zs,NTi:()=>I,NZq:()=>Lt,Nt7:()=>$,Nwf:()=>Jl,Nz6:()=>ae,O0B:()=>lr,O49:()=>Ve,O9p:()=>ti,OUM:()=>jt,Oax:()=>Xi,Om:()=>Tt,OuU:()=>K,PPD:()=>Go,PTz:()=>pr,Pem:()=>uu,Pq0:()=>dr,Q1f:()=>Ni,Qev:()=>On,Qrf:()=>_e,RJ4:()=>ze,ROr:()=>rn,RQf:()=>zt,RcT:()=>hn,RiT:()=>el,Riy:()=>de,RlV:()=>Gr,RoJ:()=>Da,Ru$:()=>on,S$4:()=>Pe,THS:()=>Hi,TMh:()=>dn,Tap:()=>pl,TdN:()=>En,TiK:()=>bn,TkQ:()=>re,U3G:()=>st,V3x:()=>Wt,V9B:()=>Bi,VCu:()=>Oa,VT0:()=>te,VVr:()=>tn,Vb5:()=>R,Vnu:()=>Mn,WNZ:()=>P,Wew:()=>Gt,XG_:()=>Ce,XIg:()=>j,XTe:()=>Bl,XrR:()=>ht,Y9S:()=>ll,YHV:()=>tf,YJl:()=>Ca,Yuy:()=>Dt,Z58:()=>ja,ZQM:()=>ee,Zcv:()=>Fo,Zr2:()=>Ye,ZyN:()=>Ol,_4j:()=>Cc,_QJ:()=>Se,a5J:()=>we,aEY:()=>et,aHM:()=>sl,agE:()=>Tn,amv:()=>yn,b4q:()=>jo,bC7:()=>Ee,bCz:()=>F,bI3:()=>He,bkx:()=>Ft,brA:()=>ot,bw0:()=>lt,c90:()=>ie,cHt:()=>Ut,caT:()=>ft,cj9:()=>Dn,czI:()=>ge,dcC:()=>$t,dth:()=>ml,dwI:()=>zn,eB$:()=>Ia,eHc:()=>rt,eHs:()=>Ua,eaF:()=>xo,eoi:()=>_n,er$:()=>Xe,f4X:()=>Y,fBL:()=>Bt,fCn:()=>Ma,fJr:()=>an,gJ2:()=>Ht,gO9:()=>z,gPd:()=>ur,gWB:()=>wn,ghU:()=>Et,hB5:()=>C,hdd:()=>Q,hgQ:()=>nt,hsX:()=>N,hxR:()=>Ot,hy7:()=>_t,i7u:()=>An,iNn:()=>So,ie2:()=>Z,imn:()=>Ii,ix0:()=>Vt,jR7:()=>se,jf0:()=>qe,jsO:()=>ln,jut:()=>Nl,jzd:()=>xn,k6Q:()=>ce,k6q:()=>kt,kBv:()=>A,kG0:()=>en,kO0:()=>gn,kRr:()=>Ct,kTW:()=>At,kTp:()=>le,kYr:()=>cn,klZ:()=>pn,kn4:()=>Hr,kqe:()=>$e,kyO:()=>dt,lGu:()=>it,lGw:()=>Hc,lPF:()=>qn,lyL:()=>Me,mrM:()=>Hs,nCl:()=>xl,nNL:()=>yt,nST:()=>G,o6l:()=>Io,oVO:()=>sn,ojh:()=>q,ojs:()=>Oe,pBf:()=>he,pHI:()=>Pt,paN:()=>ne,psI:()=>xe,qBx:()=>Ic,qU7:()=>ku,qUd:()=>Aa,qa3:()=>ye,qad:()=>X,qtW:()=>Yi,r6x:()=>Ll,rFo:()=>hr,rSH:()=>be,rYR:()=>Ge,sKt:()=>mn,sPf:()=>E,tJf:()=>It,tXL:()=>Lc,tz3:()=>nl,uB5:()=>Te,uSd:()=>Nc,uV5:()=>St,uWO:()=>gs,ubm:()=>Co,vim:()=>vn,vyJ:()=>We,wfO:()=>wt,wn6:()=>tt,wrO:()=>Xt,wtR:()=>O,xFO:()=>xt,xJ6:()=>pc,xSv:()=>at,y3Z:()=>Ae,y_p:()=>pt,zdS:()=>Qt,zkh:()=>Ea,znC:()=>H});var E="163",A={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},O={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},P=0,R=1,k=2,C=0,N=1,L=2,j=0,I=1,B=2,U=3,D=4,F=5,z=100,V=101,G=102,H=103,W=104,q=200,X=201,Y=202,J=203,Z=204,K=205,Q=206,$=207,tt=208,et=209,nt=210,rt=0,it=1,ot=2,at=3,st=4,ut=5,ct=6,lt=7,ft=0,ht=2,pt=0,dt=1,mt=2,yt=3,vt=4,gt=6,bt="attached",_t=301,xt=302,wt=303,St=304,Tt=306,Mt=1e3,Et=1001,At=1002,Ot=1003,Pt=1004,Rt=1005,kt=1006,Ct=1007,Nt=1008,Lt=1008,jt=1009,It=1010,Bt=1011,Ut=1012,Dt=1013,Ft=1014,zt=1015,Vt=1016,Gt=1017,Ht=1018,Wt=1020,qt=35902,Xt=1021,Yt=1022,Jt=1023,Zt=1024,Kt=1025,Qt=1026,$t=1027,te=1028,ee=1029,ne=1030,re=1031,ie=1033,oe=33776,ae=33777,se=33778,ue=33779,ce=35840,le=35841,fe=35842,he=35843,pe=36196,de=37492,me=37496,ye=37808,ve=37809,ge=37810,be=37811,_e=37812,xe=37813,we=37814,Se=37815,Te=37816,Me=37817,Ee=37818,Ae=37819,Oe=37820,Pe=37821,Re=36492,ke=36283,Ce=36284,Ne=36285,Le=36286,je=2300,Ie=2301,Be=2302,Ue=2400,De=2401,Fe=2402,ze=0,Ve=1,Ge=2,He=0,We=1,qe="",Xe="srgb",Ye="srgb-linear",Je="display-p3-linear",Ze="linear",Ke="srgb",Qe="rec709",$e=0,tn=7680,en=7681,nn=7682,rn=7683,on=34055,an=34056,sn=5386,un=512,cn=513,ln=514,fn=515,hn=516,pn=517,dn=518,mn=519,yn=512,vn=513,gn=514,bn=515,_n=516,xn=517,wn=518,Sn=519,Tn=35044,Mn=35048,En=2e3,An=2001,On=function(){return T((function t(){w(this,t)}),[{key:"addEventListener",value:function(t,e){void 0===this._listeners&&(this._listeners={});var n=this._listeners;void 0===n[t]&&(n[t]=[]),-1===n[t].indexOf(e)&&n[t].push(e)}},{key:"hasEventListener",value:function(t,e){if(void 0===this._listeners)return!1;var n=this._listeners;return void 0!==n[t]&&-1!==n[t].indexOf(e)}},{key:"removeEventListener",value:function(t,e){if(void 0!==this._listeners){var n=this._listeners[t];if(void 0!==n){var r=n.indexOf(e);-1!==r&&n.splice(r,1)}}}},{key:"dispatchEvent",value:function(t){if(void 0!==this._listeners){var e=this._listeners[t.type];if(void 0!==e){t.target=this;for(var n=e.slice(0),r=0,i=n.length;r<i;r++)n[r].call(this,t);t.target=null}}}}])}(),Pn=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"],Rn=1234567,kn=Math.PI/180,Cn=180/Math.PI;function Nn(){var t=4294967295*Math.random()|0,e=4294967295*Math.random()|0,n=4294967295*Math.random()|0,r=4294967295*Math.random()|0;return(Pn[255&t]+Pn[t>>8&255]+Pn[t>>16&255]+Pn[t>>24&255]+"-"+Pn[255&e]+Pn[e>>8&255]+"-"+Pn[e>>16&15|64]+Pn[e>>24&255]+"-"+Pn[63&n|128]+Pn[n>>8&255]+"-"+Pn[n>>16&255]+Pn[n>>24&255]+Pn[255&r]+Pn[r>>8&255]+Pn[r>>16&255]+Pn[r>>24&255]).toLowerCase()}function Ln(t,e,n){return Math.max(e,Math.min(n,t))}function jn(t,e){return(t%e+e)%e}function In(t,e,n){return(1-n)*t+n*e}function Bn(t,e){switch(e.constructor){case Float32Array:return t;case Uint32Array:return t/4294967295;case Uint16Array:return t/65535;case Uint8Array:return t/255;case Int32Array:return Math.max(t/2147483647,-1);case Int16Array:return Math.max(t/32767,-1);case Int8Array:return Math.max(t/127,-1);default:throw new Error("Invalid component type.")}}function Un(t,e){switch(e.constructor){case Float32Array:return t;case Uint32Array:return Math.round(4294967295*t);case Uint16Array:return Math.round(65535*t);case Uint8Array:return Math.round(255*t);case Int32Array:return Math.round(2147483647*t);case Int16Array:return Math.round(32767*t);case Int8Array:return Math.round(127*t);default:throw new Error("Invalid component type.")}}var Dn={DEG2RAD:kn,RAD2DEG:Cn,generateUUID:Nn,clamp:Ln,euclideanModulo:jn,mapLinear:function(t,e,n,r,i){return r+(t-e)*(i-r)/(n-e)},inverseLerp:function(t,e,n){return t!==e?(n-t)/(e-t):0},lerp:In,damp:function(t,e,n,r){return In(t,e,1-Math.exp(-n*r))},pingpong:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return e-Math.abs(jn(t,2*e)-e)},smoothstep:function(t,e,n){return t<=e?0:t>=n?1:(t=(t-e)/(n-e))*t*(3-2*t)},smootherstep:function(t,e,n){return t<=e?0:t>=n?1:(t=(t-e)/(n-e))*t*t*(t*(6*t-15)+10)},randInt:function(t,e){return t+Math.floor(Math.random()*(e-t+1))},randFloat:function(t,e){return t+Math.random()*(e-t)},randFloatSpread:function(t){return t*(.5-Math.random())},seededRandom:function(t){void 0!==t&&(Rn=t);var e=Rn+=1831565813;return e=Math.imul(e^e>>>15,1|e),(((e^=e+Math.imul(e^e>>>7,61|e))^e>>>14)>>>0)/4294967296},degToRad:function(t){return t*kn},radToDeg:function(t){return t*Cn},isPowerOfTwo:function(t){return!(t&t-1)&&0!==t},ceilPowerOfTwo:function(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))},floorPowerOfTwo:function(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))},setQuaternionFromProperEuler:function(t,e,n,r,i){var o=Math.cos,a=Math.sin,s=o(n/2),u=a(n/2),c=o((e+r)/2),l=a((e+r)/2),f=o((e-r)/2),h=a((e-r)/2),p=o((r-e)/2),d=a((r-e)/2);switch(i){case"XYX":t.set(s*l,u*f,u*h,s*c);break;case"YZY":t.set(u*h,s*l,u*f,s*c);break;case"ZXZ":t.set(u*f,u*h,s*l,s*c);break;case"XZX":t.set(s*l,u*d,u*p,s*c);break;case"YXY":t.set(u*p,s*l,u*d,s*c);break;case"ZYZ":t.set(u*d,u*p,s*l,s*c);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+i)}},normalize:Un,denormalize:Bn},Fn=function(){return T((function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;w(this,t),t.prototype.isVector2=!0,this.x=e,this.y=n}),[{key:"width",get:function(){return this.x},set:function(t){this.x=t}},{key:"height",get:function(){return this.y},set:function(t){this.y=t}},{key:"set",value:function(t,e){return this.x=t,this.y=e,this}},{key:"setScalar",value:function(t){return this.x=t,this.y=t,this}},{key:"setX",value:function(t){return this.x=t,this}},{key:"setY",value:function(t){return this.y=t,this}},{key:"setComponent",value:function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}return this}},{key:"getComponent",value:function(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}},{key:"clone",value:function(){return new this.constructor(this.x,this.y)}},{key:"copy",value:function(t){return this.x=t.x,this.y=t.y,this}},{key:"add",value:function(t){return this.x+=t.x,this.y+=t.y,this}},{key:"addScalar",value:function(t){return this.x+=t,this.y+=t,this}},{key:"addVectors",value:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this}},{key:"addScaledVector",value:function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this}},{key:"sub",value:function(t){return this.x-=t.x,this.y-=t.y,this}},{key:"subScalar",value:function(t){return this.x-=t,this.y-=t,this}},{key:"subVectors",value:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this}},{key:"multiply",value:function(t){return this.x*=t.x,this.y*=t.y,this}},{key:"multiplyScalar",value:function(t){return this.x*=t,this.y*=t,this}},{key:"divide",value:function(t){return this.x/=t.x,this.y/=t.y,this}},{key:"divideScalar",value:function(t){return this.multiplyScalar(1/t)}},{key:"applyMatrix3",value:function(t){var e=this.x,n=this.y,r=t.elements;return this.x=r[0]*e+r[3]*n+r[6],this.y=r[1]*e+r[4]*n+r[7],this}},{key:"min",value:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}},{key:"max",value:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}},{key:"clamp",value:function(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this}},{key:"clampScalar",value:function(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this}},{key:"clampLength",value:function(t,e){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))}},{key:"floor",value:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}},{key:"ceil",value:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}},{key:"round",value:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},{key:"roundToZero",value:function(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}},{key:"negate",value:function(){return this.x=-this.x,this.y=-this.y,this}},{key:"dot",value:function(t){return this.x*t.x+this.y*t.y}},{key:"cross",value:function(t){return this.x*t.y-this.y*t.x}},{key:"lengthSq",value:function(){return this.x*this.x+this.y*this.y}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y)}},{key:"manhattanLength",value:function(){return Math.abs(this.x)+Math.abs(this.y)}},{key:"normalize",value:function(){return this.divideScalar(this.length()||1)}},{key:"angle",value:function(){return Math.atan2(-this.y,-this.x)+Math.PI}},{key:"angleTo",value:function(t){var e=Math.sqrt(this.lengthSq()*t.lengthSq());if(0===e)return Math.PI/2;var n=this.dot(t)/e;return Math.acos(Ln(n,-1,1))}},{key:"distanceTo",value:function(t){return Math.sqrt(this.distanceToSquared(t))}},{key:"distanceToSquared",value:function(t){var e=this.x-t.x,n=this.y-t.y;return e*e+n*n}},{key:"manhattanDistanceTo",value:function(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}},{key:"setLength",value:function(t){return this.normalize().multiplyScalar(t)}},{key:"lerp",value:function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this}},{key:"lerpVectors",value:function(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this}},{key:"equals",value:function(t){return t.x===this.x&&t.y===this.y}},{key:"fromArray",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=t[e],this.y=t[e+1],this}},{key:"toArray",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t[e]=this.x,t[e+1]=this.y,t}},{key:"fromBufferAttribute",value:function(t,e){return this.x=t.getX(e),this.y=t.getY(e),this}},{key:"rotateAround",value:function(t,e){var n=Math.cos(e),r=Math.sin(e),i=this.x-t.x,o=this.y-t.y;return this.x=i*n-o*r+t.x,this.y=i*r+o*n+t.y,this}},{key:"random",value:function(){return this.x=Math.random(),this.y=Math.random(),this}},{key:Symbol.iterator,value:_().mark((function t(){return _().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.x;case 2:return t.next=4,this.y;case 4:case"end":return t.stop()}}),t,this)}))}])}(),zn=function(){return T((function t(e,n,r,i,o,a,s,u,c){w(this,t),t.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],void 0!==e&&this.set(e,n,r,i,o,a,s,u,c)}),[{key:"set",value:function(t,e,n,r,i,o,a,s,u){var c=this.elements;return c[0]=t,c[1]=r,c[2]=a,c[3]=e,c[4]=i,c[5]=s,c[6]=n,c[7]=o,c[8]=u,this}},{key:"identity",value:function(){return this.set(1,0,0,0,1,0,0,0,1),this}},{key:"copy",value:function(t){var e=this.elements,n=t.elements;return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],this}},{key:"extractBasis",value:function(t,e,n){return t.setFromMatrix3Column(this,0),e.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}},{key:"setFromMatrix4",value:function(t){var e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this}},{key:"multiply",value:function(t){return this.multiplyMatrices(this,t)}},{key:"premultiply",value:function(t){return this.multiplyMatrices(t,this)}},{key:"multiplyMatrices",value:function(t,e){var n=t.elements,r=e.elements,i=this.elements,o=n[0],a=n[3],s=n[6],u=n[1],c=n[4],l=n[7],f=n[2],h=n[5],p=n[8],d=r[0],m=r[3],y=r[6],v=r[1],g=r[4],b=r[7],_=r[2],x=r[5],w=r[8];return i[0]=o*d+a*v+s*_,i[3]=o*m+a*g+s*x,i[6]=o*y+a*b+s*w,i[1]=u*d+c*v+l*_,i[4]=u*m+c*g+l*x,i[7]=u*y+c*b+l*w,i[2]=f*d+h*v+p*_,i[5]=f*m+h*g+p*x,i[8]=f*y+h*b+p*w,this}},{key:"multiplyScalar",value:function(t){var e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this}},{key:"determinant",value:function(){var t=this.elements,e=t[0],n=t[1],r=t[2],i=t[3],o=t[4],a=t[5],s=t[6],u=t[7],c=t[8];return e*o*c-e*a*u-n*i*c+n*a*s+r*i*u-r*o*s}},{key:"invert",value:function(){var t=this.elements,e=t[0],n=t[1],r=t[2],i=t[3],o=t[4],a=t[5],s=t[6],u=t[7],c=t[8],l=c*o-a*u,f=a*s-c*i,h=u*i-o*s,p=e*l+n*f+r*h;if(0===p)return this.set(0,0,0,0,0,0,0,0,0);var d=1/p;return t[0]=l*d,t[1]=(r*u-c*n)*d,t[2]=(a*n-r*o)*d,t[3]=f*d,t[4]=(c*e-r*s)*d,t[5]=(r*i-a*e)*d,t[6]=h*d,t[7]=(n*s-u*e)*d,t[8]=(o*e-n*i)*d,this}},{key:"transpose",value:function(){var t,e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this}},{key:"getNormalMatrix",value:function(t){return this.setFromMatrix4(t).invert().transpose()}},{key:"transposeIntoArray",value:function(t){var e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this}},{key:"setUvTransform",value:function(t,e,n,r,i,o,a){var s=Math.cos(i),u=Math.sin(i);return this.set(n*s,n*u,-n*(s*o+u*a)+o+t,-r*u,r*s,-r*(-u*o+s*a)+a+e,0,0,1),this}},{key:"scale",value:function(t,e){return this.premultiply(Vn.makeScale(t,e)),this}},{key:"rotate",value:function(t){return this.premultiply(Vn.makeRotation(-t)),this}},{key:"translate",value:function(t,e){return this.premultiply(Vn.makeTranslation(t,e)),this}},{key:"makeTranslation",value:function(t,e){return t.isVector2?this.set(1,0,t.x,0,1,t.y,0,0,1):this.set(1,0,t,0,1,e,0,0,1),this}},{key:"makeRotation",value:function(t){var e=Math.cos(t),n=Math.sin(t);return this.set(e,-n,0,n,e,0,0,0,1),this}},{key:"makeScale",value:function(t,e){return this.set(t,0,0,0,e,0,0,0,1),this}},{key:"equals",value:function(t){for(var e=this.elements,n=t.elements,r=0;r<9;r++)if(e[r]!==n[r])return!1;return!0}},{key:"fromArray",value:function(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=0;n<9;n++)this.elements[n]=t[n+e];return this}},{key:"toArray",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this.elements;return t[e]=n[0],t[e+1]=n[1],t[e+2]=n[2],t[e+3]=n[3],t[e+4]=n[4],t[e+5]=n[5],t[e+6]=n[6],t[e+7]=n[7],t[e+8]=n[8],t}},{key:"clone",value:function(){return(new this.constructor).fromArray(this.elements)}}])}(),Vn=new zn;var Gn={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function Hn(t,e){return new Gn[t](e)}function Wn(t){return document.createElementNS("http://www.w3.org/1999/xhtml",t)}function qn(){var t=Wn("canvas");return t.style.display="block",t}var Xn={};function Yn(t){t in Xn||(Xn[t]=!0,console.warn(t))}var Jn,Zn=(new zn).set(.8224621,.177538,0,.0331941,.9668058,0,.0170827,.0723974,.9105199),Kn=(new zn).set(1.2249401,-.2249404,0,-.0420569,1.0420571,0,-.0196376,-.0786361,1.0982735),Qn=b(b(b(b({},Ye,{transfer:Ze,primaries:Qe,toReference:function(t){return t},fromReference:function(t){return t}}),Xe,{transfer:Ke,primaries:Qe,toReference:function(t){return t.convertSRGBToLinear()},fromReference:function(t){return t.convertLinearToSRGB()}}),Je,{transfer:Ze,primaries:"p3",toReference:function(t){return t.applyMatrix3(Kn)},fromReference:function(t){return t.applyMatrix3(Zn)}}),"display-p3",{transfer:Ke,primaries:"p3",toReference:function(t){return t.convertSRGBToLinear().applyMatrix3(Kn)},fromReference:function(t){return t.applyMatrix3(Zn).convertLinearToSRGB()}}),$n=new Set([Ye,Je]),tr={enabled:!0,_workingColorSpace:Ye,get workingColorSpace(){return this._workingColorSpace},set workingColorSpace(t){if(!$n.has(t))throw new Error('Unsupported working color space, "'.concat(t,'".'));this._workingColorSpace=t},convert:function(t,e,n){if(!1===this.enabled||e===n||!e||!n)return t;var r=Qn[e].toReference;return(0,Qn[n].fromReference)(r(t))},fromWorkingColorSpace:function(t,e){return this.convert(t,this._workingColorSpace,e)},toWorkingColorSpace:function(t,e){return this.convert(t,e,this._workingColorSpace)},getPrimaries:function(t){return Qn[t].primaries},getTransfer:function(t){return t===qe?Ze:Qn[t].transfer}};function er(t){return t<.04045?.0773993808*t:Math.pow(.9478672986*t+.0521327014,2.4)}function nr(t){return t<.0031308?12.92*t:1.055*Math.pow(t,.41666)-.055}var rr=function(){return T((function t(){w(this,t)}),null,[{key:"getDataURL",value:function(t){if(/^data:/i.test(t.src))return t.src;if("undefined"==typeof HTMLCanvasElement)return t.src;var e;if(t instanceof HTMLCanvasElement)e=t;else{void 0===Jn&&(Jn=Wn("canvas")),Jn.width=t.width,Jn.height=t.height;var n=Jn.getContext("2d");t instanceof ImageData?n.putImageData(t,0,0):n.drawImage(t,0,0,t.width,t.height),e=Jn}return e.width>2048||e.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",t),e.toDataURL("image/jpeg",.6)):e.toDataURL("image/png")}},{key:"sRGBToLinear",value:function(t){if("undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap){var e=Wn("canvas");e.width=t.width,e.height=t.height;var n=e.getContext("2d");n.drawImage(t,0,0,t.width,t.height);for(var r=n.getImageData(0,0,t.width,t.height),i=r.data,o=0;o<i.length;o++)i[o]=255*er(i[o]/255);return n.putImageData(r,0,0),e}if(t.data){for(var a=t.data.slice(0),s=0;s<a.length;s++)a instanceof Uint8Array||a instanceof Uint8ClampedArray?a[s]=Math.floor(255*er(a[s]/255)):a[s]=er(a[s]);return{data:a,width:t.width,height:t.height}}return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),t}}])}(),ir=0,or=function(){return T((function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;w(this,t),this.isSource=!0,Object.defineProperty(this,"id",{value:ir++}),this.uuid=Nn(),this.data=e,this.dataReady=!0,this.version=0}),[{key:"needsUpdate",set:function(t){!0===t&&this.version++}},{key:"toJSON",value:function(t){var e=void 0===t||"string"==typeof t;if(!e&&void 0!==t.images[this.uuid])return t.images[this.uuid];var n={uuid:this.uuid,url:""},r=this.data;if(null!==r){var i;if(Array.isArray(r)){i=[];for(var o=0,a=r.length;o<a;o++)r[o].isDataTexture?i.push(ar(r[o].image)):i.push(ar(r[o]))}else i=ar(r);n.url=i}return e||(t.images[this.uuid]=n),n}}])}();function ar(t){return"undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap?rr.getDataURL(t):t.data?{data:Array.from(t.data),width:t.width,height:t.height,type:t.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}var sr=0,ur=function(t){function e(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e.DEFAULT_IMAGE,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.DEFAULT_MAPPING,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Et,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Et,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:kt,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:Nt,u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:Jt,c=arguments.length>7&&void 0!==arguments[7]?arguments[7]:jt,l=arguments.length>8&&void 0!==arguments[8]?arguments[8]:e.DEFAULT_ANISOTROPY,f=arguments.length>9&&void 0!==arguments[9]?arguments[9]:qe;return w(this,e),(t=d(this,e)).isTexture=!0,Object.defineProperty(t,"id",{value:sr++}),t.uuid=Nn(),t.name="",t.source=new or(n),t.mipmaps=[],t.mapping=r,t.channel=0,t.wrapS=i,t.wrapT=o,t.magFilter=a,t.minFilter=s,t.anisotropy=l,t.format=u,t.internalFormat=null,t.type=c,t.offset=new Fn(0,0),t.repeat=new Fn(1,1),t.center=new Fn(0,0),t.rotation=0,t.matrixAutoUpdate=!0,t.matrix=new zn,t.generateMipmaps=!0,t.premultiplyAlpha=!1,t.flipY=!0,t.unpackAlignment=4,t.colorSpace=f,t.userData={},t.version=0,t.onUpdate=null,t.isRenderTargetTexture=!1,t.pmremVersion=0,t}return v(e,t),T(e,[{key:"image",get:function(){return this.source.data},set:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.source.data=t}},{key:"updateMatrix",value:function(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(t){return this.name=t.name,this.source=t.source,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.channel=t.channel,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.internalFormat=t.internalFormat,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.colorSpace=t.colorSpace,this.userData=JSON.parse(JSON.stringify(t.userData)),this.needsUpdate=!0,this}},{key:"toJSON",value:function(t){var e=void 0===t||"string"==typeof t;if(!e&&void 0!==t.textures[this.uuid])return t.textures[this.uuid];var n={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(t).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(n.userData=this.userData),e||(t.textures[this.uuid]=n),n}},{key:"dispose",value:function(){this.dispatchEvent({type:"dispose"})}},{key:"transformUv",value:function(t){if(300!==this.mapping)return t;if(t.applyMatrix3(this.matrix),t.x<0||t.x>1)switch(this.wrapS){case Mt:t.x=t.x-Math.floor(t.x);break;case Et:t.x=t.x<0?0:1;break;case At:1===Math.abs(Math.floor(t.x)%2)?t.x=Math.ceil(t.x)-t.x:t.x=t.x-Math.floor(t.x)}if(t.y<0||t.y>1)switch(this.wrapT){case Mt:t.y=t.y-Math.floor(t.y);break;case Et:t.y=t.y<0?0:1;break;case At:1===Math.abs(Math.floor(t.y)%2)?t.y=Math.ceil(t.y)-t.y:t.y=t.y-Math.floor(t.y)}return this.flipY&&(t.y=1-t.y),t}},{key:"needsUpdate",set:function(t){!0===t&&(this.version++,this.source.needsUpdate=!0)}},{key:"needsPMREMUpdate",set:function(t){!0===t&&this.pmremVersion++}}])}(On);ur.DEFAULT_IMAGE=null,ur.DEFAULT_MAPPING=300,ur.DEFAULT_ANISOTROPY=1;var cr=function(){return T((function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;w(this,t),t.prototype.isVector4=!0,this.x=e,this.y=n,this.z=r,this.w=i}),[{key:"width",get:function(){return this.z},set:function(t){this.z=t}},{key:"height",get:function(){return this.w},set:function(t){this.w=t}},{key:"set",value:function(t,e,n,r){return this.x=t,this.y=e,this.z=n,this.w=r,this}},{key:"setScalar",value:function(t){return this.x=t,this.y=t,this.z=t,this.w=t,this}},{key:"setX",value:function(t){return this.x=t,this}},{key:"setY",value:function(t){return this.y=t,this}},{key:"setZ",value:function(t){return this.z=t,this}},{key:"setW",value:function(t){return this.w=t,this}},{key:"setComponent",value:function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;case 3:this.w=e;break;default:throw new Error("index is out of range: "+t)}return this}},{key:"getComponent",value:function(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}}},{key:"clone",value:function(){return new this.constructor(this.x,this.y,this.z,this.w)}},{key:"copy",value:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=void 0!==t.w?t.w:1,this}},{key:"add",value:function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this}},{key:"addScalar",value:function(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this}},{key:"addVectors",value:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.w=t.w+e.w,this}},{key:"addScaledVector",value:function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this.w+=t.w*e,this}},{key:"sub",value:function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this}},{key:"subScalar",value:function(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this}},{key:"subVectors",value:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this}},{key:"multiply",value:function(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this}},{key:"multiplyScalar",value:function(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}},{key:"applyMatrix4",value:function(t){var e=this.x,n=this.y,r=this.z,i=this.w,o=t.elements;return this.x=o[0]*e+o[4]*n+o[8]*r+o[12]*i,this.y=o[1]*e+o[5]*n+o[9]*r+o[13]*i,this.z=o[2]*e+o[6]*n+o[10]*r+o[14]*i,this.w=o[3]*e+o[7]*n+o[11]*r+o[15]*i,this}},{key:"divideScalar",value:function(t){return this.multiplyScalar(1/t)}},{key:"setAxisAngleFromQuaternion",value:function(t){this.w=2*Math.acos(t.w);var e=Math.sqrt(1-t.w*t.w);return e<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/e,this.y=t.y/e,this.z=t.z/e),this}},{key:"setAxisAngleFromRotationMatrix",value:function(t){var e,n,r,i,o=.01,a=.1,s=t.elements,u=s[0],c=s[4],l=s[8],f=s[1],h=s[5],p=s[9],d=s[2],m=s[6],y=s[10];if(Math.abs(c-f)<o&&Math.abs(l-d)<o&&Math.abs(p-m)<o){if(Math.abs(c+f)<a&&Math.abs(l+d)<a&&Math.abs(p+m)<a&&Math.abs(u+h+y-3)<a)return this.set(1,0,0,0),this;e=Math.PI;var v=(u+1)/2,g=(h+1)/2,b=(y+1)/2,_=(c+f)/4,x=(l+d)/4,w=(p+m)/4;return v>g&&v>b?v<o?(n=0,r=.707106781,i=.707106781):(r=_/(n=Math.sqrt(v)),i=x/n):g>b?g<o?(n=.707106781,r=0,i=.707106781):(n=_/(r=Math.sqrt(g)),i=w/r):b<o?(n=.707106781,r=.707106781,i=0):(n=x/(i=Math.sqrt(b)),r=w/i),this.set(n,r,i,e),this}var S=Math.sqrt((m-p)*(m-p)+(l-d)*(l-d)+(f-c)*(f-c));return Math.abs(S)<.001&&(S=1),this.x=(m-p)/S,this.y=(l-d)/S,this.z=(f-c)/S,this.w=Math.acos((u+h+y-1)/2),this}},{key:"min",value:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this}},{key:"max",value:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this}},{key:"clamp",value:function(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this.w=Math.max(t.w,Math.min(e.w,this.w)),this}},{key:"clampScalar",value:function(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this.w=Math.max(t,Math.min(e,this.w)),this}},{key:"clampLength",value:function(t,e){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))}},{key:"floor",value:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}},{key:"ceil",value:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}},{key:"round",value:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}},{key:"roundToZero",value:function(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}},{key:"negate",value:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}},{key:"dot",value:function(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}},{key:"lengthSq",value:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}},{key:"manhattanLength",value:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}},{key:"normalize",value:function(){return this.divideScalar(this.length()||1)}},{key:"setLength",value:function(t){return this.normalize().multiplyScalar(t)}},{key:"lerp",value:function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this}},{key:"lerpVectors",value:function(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this.z=t.z+(e.z-t.z)*n,this.w=t.w+(e.w-t.w)*n,this}},{key:"equals",value:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w}},{key:"fromArray",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this}},{key:"toArray",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w,t}},{key:"fromBufferAttribute",value:function(t,e){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this.w=t.getW(e),this}},{key:"random",value:function(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}},{key:Symbol.iterator,value:_().mark((function t(){return _().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.x;case 2:return t.next=4,this.y;case 4:return t.next=6,this.z;case 6:return t.next=8,this.w;case 8:case"end":return t.stop()}}),t,this)}))}])}(),lr=function(t){function e(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};w(this,e),(t=d(this,e)).isRenderTarget=!0,t.width=n,t.height=r,t.depth=1,t.scissor=new cr(0,0,n,r),t.scissorTest=!1,t.viewport=new cr(0,0,n,r);var o={width:n,height:r,depth:1};i=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:kt,depthBuffer:!0,stencilBuffer:!1,depthTexture:null,samples:0,count:1},i);var a=new ur(o,i.mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.colorSpace);a.flipY=!1,a.generateMipmaps=i.generateMipmaps,a.internalFormat=i.internalFormat,t.textures=[];for(var s=i.count,u=0;u<s;u++)t.textures[u]=a.clone(),t.textures[u].isRenderTargetTexture=!0;return t.depthBuffer=i.depthBuffer,t.stencilBuffer=i.stencilBuffer,t.depthTexture=i.depthTexture,t.samples=i.samples,t}return v(e,t),T(e,[{key:"texture",get:function(){return this.textures[0]},set:function(t){this.textures[0]=t}},{key:"setSize",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;if(this.width!==t||this.height!==e||this.depth!==n){this.width=t,this.height=e,this.depth=n;for(var r=0,i=this.textures.length;r<i;r++)this.textures[r].image.width=t,this.textures[r].image.height=e,this.textures[r].image.depth=n;this.dispose()}this.viewport.set(0,0,t,e),this.scissor.set(0,0,t,e)}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(t){this.width=t.width,this.height=t.height,this.depth=t.depth,this.scissor.copy(t.scissor),this.scissorTest=t.scissorTest,this.viewport.copy(t.viewport),this.textures.length=0;for(var e=0,n=t.textures.length;e<n;e++)this.textures[e]=t.textures[e].clone(),this.textures[e].isRenderTargetTexture=!0;var r=Object.assign({},t.texture.image);return this.texture.source=new or(r),this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,null!==t.depthTexture&&(this.depthTexture=t.depthTexture.clone()),this.samples=t.samples,this}},{key:"dispose",value:function(){this.dispatchEvent({type:"dispose"})}}])}(On),fr=function(t){function e(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return w(this,e),(t=d(this,e,[n,r,i])).isWebGLRenderTarget=!0,t}return v(e,t),T(e)}(lr),hr=function(t){function e(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return w(this,e),(t=d(this,e,[null])).isDataArrayTexture=!0,t.image={data:n,width:r,height:i,depth:o},t.magFilter=Ot,t.minFilter=Ot,t.wrapR=Et,t.generateMipmaps=!1,t.flipY=!1,t.unpackAlignment=1,t}return v(e,t),T(e)}(ur),pr=function(){return T((function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;w(this,t),this.isQuaternion=!0,this._x=e,this._y=n,this._z=r,this._w=i}),[{key:"x",get:function(){return this._x},set:function(t){this._x=t,this._onChangeCallback()}},{key:"y",get:function(){return this._y},set:function(t){this._y=t,this._onChangeCallback()}},{key:"z",get:function(){return this._z},set:function(t){this._z=t,this._onChangeCallback()}},{key:"w",get:function(){return this._w},set:function(t){this._w=t,this._onChangeCallback()}},{key:"set",value:function(t,e,n,r){return this._x=t,this._y=e,this._z=n,this._w=r,this._onChangeCallback(),this}},{key:"clone",value:function(){return new this.constructor(this._x,this._y,this._z,this._w)}},{key:"copy",value:function(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this}},{key:"setFromEuler",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=t._x,r=t._y,i=t._z,o=t._order,a=Math.cos,s=Math.sin,u=a(n/2),c=a(r/2),l=a(i/2),f=s(n/2),h=s(r/2),p=s(i/2);switch(o){case"XYZ":this._x=f*c*l+u*h*p,this._y=u*h*l-f*c*p,this._z=u*c*p+f*h*l,this._w=u*c*l-f*h*p;break;case"YXZ":this._x=f*c*l+u*h*p,this._y=u*h*l-f*c*p,this._z=u*c*p-f*h*l,this._w=u*c*l+f*h*p;break;case"ZXY":this._x=f*c*l-u*h*p,this._y=u*h*l+f*c*p,this._z=u*c*p+f*h*l,this._w=u*c*l-f*h*p;break;case"ZYX":this._x=f*c*l-u*h*p,this._y=u*h*l+f*c*p,this._z=u*c*p-f*h*l,this._w=u*c*l+f*h*p;break;case"YZX":this._x=f*c*l+u*h*p,this._y=u*h*l+f*c*p,this._z=u*c*p-f*h*l,this._w=u*c*l-f*h*p;break;case"XZY":this._x=f*c*l-u*h*p,this._y=u*h*l-f*c*p,this._z=u*c*p+f*h*l,this._w=u*c*l+f*h*p;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+o)}return!0===e&&this._onChangeCallback(),this}},{key:"setFromAxisAngle",value:function(t,e){var n=e/2,r=Math.sin(n);return this._x=t.x*r,this._y=t.y*r,this._z=t.z*r,this._w=Math.cos(n),this._onChangeCallback(),this}},{key:"setFromRotationMatrix",value:function(t){var e=t.elements,n=e[0],r=e[4],i=e[8],o=e[1],a=e[5],s=e[9],u=e[2],c=e[6],l=e[10],f=n+a+l;if(f>0){var h=.5/Math.sqrt(f+1);this._w=.25/h,this._x=(c-s)*h,this._y=(i-u)*h,this._z=(o-r)*h}else if(n>a&&n>l){var p=2*Math.sqrt(1+n-a-l);this._w=(c-s)/p,this._x=.25*p,this._y=(r+o)/p,this._z=(i+u)/p}else if(a>l){var d=2*Math.sqrt(1+a-n-l);this._w=(i-u)/d,this._x=(r+o)/d,this._y=.25*d,this._z=(s+c)/d}else{var m=2*Math.sqrt(1+l-n-a);this._w=(o-r)/m,this._x=(i+u)/m,this._y=(s+c)/m,this._z=.25*m}return this._onChangeCallback(),this}},{key:"setFromUnitVectors",value:function(t,e){var n=t.dot(e)+1;return n<Number.EPSILON?(n=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=n):(this._x=0,this._y=-t.z,this._z=t.y,this._w=n)):(this._x=t.y*e.z-t.z*e.y,this._y=t.z*e.x-t.x*e.z,this._z=t.x*e.y-t.y*e.x,this._w=n),this.normalize()}},{key:"angleTo",value:function(t){return 2*Math.acos(Math.abs(Ln(this.dot(t),-1,1)))}},{key:"rotateTowards",value:function(t,e){var n=this.angleTo(t);if(0===n)return this;var r=Math.min(1,e/n);return this.slerp(t,r),this}},{key:"identity",value:function(){return this.set(0,0,0,1)}},{key:"invert",value:function(){return this.conjugate()}},{key:"conjugate",value:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}},{key:"dot",value:function(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w}},{key:"lengthSq",value:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}},{key:"length",value:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}},{key:"normalize",value:function(){var t=this.length();return 0===t?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this}},{key:"multiply",value:function(t){return this.multiplyQuaternions(this,t)}},{key:"premultiply",value:function(t){return this.multiplyQuaternions(t,this)}},{key:"multiplyQuaternions",value:function(t,e){var n=t._x,r=t._y,i=t._z,o=t._w,a=e._x,s=e._y,u=e._z,c=e._w;return this._x=n*c+o*a+r*u-i*s,this._y=r*c+o*s+i*a-n*u,this._z=i*c+o*u+n*s-r*a,this._w=o*c-n*a-r*s-i*u,this._onChangeCallback(),this}},{key:"slerp",value:function(t,e){if(0===e)return this;if(1===e)return this.copy(t);var n=this._x,r=this._y,i=this._z,o=this._w,a=o*t._w+n*t._x+r*t._y+i*t._z;if(a<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,a=-a):this.copy(t),a>=1)return this._w=o,this._x=n,this._y=r,this._z=i,this;var s=1-a*a;if(s<=Number.EPSILON){var u=1-e;return this._w=u*o+e*this._w,this._x=u*n+e*this._x,this._y=u*r+e*this._y,this._z=u*i+e*this._z,this.normalize(),this}var c=Math.sqrt(s),l=Math.atan2(c,a),f=Math.sin((1-e)*l)/c,h=Math.sin(e*l)/c;return this._w=o*f+this._w*h,this._x=n*f+this._x*h,this._y=r*f+this._y*h,this._z=i*f+this._z*h,this._onChangeCallback(),this}},{key:"slerpQuaternions",value:function(t,e,n){return this.copy(t).slerp(e,n)}},{key:"random",value:function(){var t=2*Math.PI*Math.random(),e=2*Math.PI*Math.random(),n=Math.random(),r=Math.sqrt(1-n),i=Math.sqrt(n);return this.set(r*Math.sin(t),r*Math.cos(t),i*Math.sin(e),i*Math.cos(e))}},{key:"equals",value:function(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w}},{key:"fromArray",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onChangeCallback(),this}},{key:"toArray",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t}},{key:"fromBufferAttribute",value:function(t,e){return this._x=t.getX(e),this._y=t.getY(e),this._z=t.getZ(e),this._w=t.getW(e),this._onChangeCallback(),this}},{key:"toJSON",value:function(){return this.toArray()}},{key:"_onChange",value:function(t){return this._onChangeCallback=t,this}},{key:"_onChangeCallback",value:function(){}},{key:Symbol.iterator,value:_().mark((function t(){return _().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._x;case 2:return t.next=4,this._y;case 4:return t.next=6,this._z;case 6:return t.next=8,this._w;case 8:case"end":return t.stop()}}),t,this)}))}],[{key:"slerpFlat",value:function(t,e,n,r,i,o,a){var s=n[r+0],u=n[r+1],c=n[r+2],l=n[r+3],f=i[o+0],h=i[o+1],p=i[o+2],d=i[o+3];if(0===a)return t[e+0]=s,t[e+1]=u,t[e+2]=c,void(t[e+3]=l);if(1===a)return t[e+0]=f,t[e+1]=h,t[e+2]=p,void(t[e+3]=d);if(l!==d||s!==f||u!==h||c!==p){var m=1-a,y=s*f+u*h+c*p+l*d,v=y>=0?1:-1,g=1-y*y;if(g>Number.EPSILON){var b=Math.sqrt(g),_=Math.atan2(b,y*v);m=Math.sin(m*_)/b,a=Math.sin(a*_)/b}var x=a*v;if(s=s*m+f*x,u=u*m+h*x,c=c*m+p*x,l=l*m+d*x,m===1-a){var w=1/Math.sqrt(s*s+u*u+c*c+l*l);s*=w,u*=w,c*=w,l*=w}}t[e]=s,t[e+1]=u,t[e+2]=c,t[e+3]=l}},{key:"multiplyQuaternionsFlat",value:function(t,e,n,r,i,o){var a=n[r],s=n[r+1],u=n[r+2],c=n[r+3],l=i[o],f=i[o+1],h=i[o+2],p=i[o+3];return t[e]=a*p+c*l+s*h-u*f,t[e+1]=s*p+c*f+u*l-a*h,t[e+2]=u*p+c*h+a*f-s*l,t[e+3]=c*p-a*l-s*f-u*h,t}}])}(),dr=function(){return T((function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;w(this,t),t.prototype.isVector3=!0,this.x=e,this.y=n,this.z=r}),[{key:"set",value:function(t,e,n){return void 0===n&&(n=this.z),this.x=t,this.y=e,this.z=n,this}},{key:"setScalar",value:function(t){return this.x=t,this.y=t,this.z=t,this}},{key:"setX",value:function(t){return this.x=t,this}},{key:"setY",value:function(t){return this.y=t,this}},{key:"setZ",value:function(t){return this.z=t,this}},{key:"setComponent",value:function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this}},{key:"getComponent",value:function(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}},{key:"clone",value:function(){return new this.constructor(this.x,this.y,this.z)}},{key:"copy",value:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}},{key:"add",value:function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}},{key:"addScalar",value:function(t){return this.x+=t,this.y+=t,this.z+=t,this}},{key:"addVectors",value:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this}},{key:"addScaledVector",value:function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this}},{key:"sub",value:function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}},{key:"subScalar",value:function(t){return this.x-=t,this.y-=t,this.z-=t,this}},{key:"subVectors",value:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this}},{key:"multiply",value:function(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}},{key:"multiplyScalar",value:function(t){return this.x*=t,this.y*=t,this.z*=t,this}},{key:"multiplyVectors",value:function(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this}},{key:"applyEuler",value:function(t){return this.applyQuaternion(yr.setFromEuler(t))}},{key:"applyAxisAngle",value:function(t,e){return this.applyQuaternion(yr.setFromAxisAngle(t,e))}},{key:"applyMatrix3",value:function(t){var e=this.x,n=this.y,r=this.z,i=t.elements;return this.x=i[0]*e+i[3]*n+i[6]*r,this.y=i[1]*e+i[4]*n+i[7]*r,this.z=i[2]*e+i[5]*n+i[8]*r,this}},{key:"applyNormalMatrix",value:function(t){return this.applyMatrix3(t).normalize()}},{key:"applyMatrix4",value:function(t){var e=this.x,n=this.y,r=this.z,i=t.elements,o=1/(i[3]*e+i[7]*n+i[11]*r+i[15]);return this.x=(i[0]*e+i[4]*n+i[8]*r+i[12])*o,this.y=(i[1]*e+i[5]*n+i[9]*r+i[13])*o,this.z=(i[2]*e+i[6]*n+i[10]*r+i[14])*o,this}},{key:"applyQuaternion",value:function(t){var e=this.x,n=this.y,r=this.z,i=t.x,o=t.y,a=t.z,s=t.w,u=2*(o*r-a*n),c=2*(a*e-i*r),l=2*(i*n-o*e);return this.x=e+s*u+o*l-a*c,this.y=n+s*c+a*u-i*l,this.z=r+s*l+i*c-o*u,this}},{key:"project",value:function(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}},{key:"unproject",value:function(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}},{key:"transformDirection",value:function(t){var e=this.x,n=this.y,r=this.z,i=t.elements;return this.x=i[0]*e+i[4]*n+i[8]*r,this.y=i[1]*e+i[5]*n+i[9]*r,this.z=i[2]*e+i[6]*n+i[10]*r,this.normalize()}},{key:"divide",value:function(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}},{key:"divideScalar",value:function(t){return this.multiplyScalar(1/t)}},{key:"min",value:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}},{key:"max",value:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}},{key:"clamp",value:function(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this}},{key:"clampScalar",value:function(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this}},{key:"clampLength",value:function(t,e){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))}},{key:"floor",value:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}},{key:"ceil",value:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}},{key:"round",value:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}},{key:"roundToZero",value:function(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}},{key:"negate",value:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}},{key:"dot",value:function(t){return this.x*t.x+this.y*t.y+this.z*t.z}},{key:"lengthSq",value:function(){return this.x*this.x+this.y*this.y+this.z*this.z}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}},{key:"manhattanLength",value:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}},{key:"normalize",value:function(){return this.divideScalar(this.length()||1)}},{key:"setLength",value:function(t){return this.normalize().multiplyScalar(t)}},{key:"lerp",value:function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this}},{key:"lerpVectors",value:function(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this.z=t.z+(e.z-t.z)*n,this}},{key:"cross",value:function(t){return this.crossVectors(this,t)}},{key:"crossVectors",value:function(t,e){var n=t.x,r=t.y,i=t.z,o=e.x,a=e.y,s=e.z;return this.x=r*s-i*a,this.y=i*o-n*s,this.z=n*a-r*o,this}},{key:"projectOnVector",value:function(t){var e=t.lengthSq();if(0===e)return this.set(0,0,0);var n=t.dot(this)/e;return this.copy(t).multiplyScalar(n)}},{key:"projectOnPlane",value:function(t){return mr.copy(this).projectOnVector(t),this.sub(mr)}},{key:"reflect",value:function(t){return this.sub(mr.copy(t).multiplyScalar(2*this.dot(t)))}},{key:"angleTo",value:function(t){var e=Math.sqrt(this.lengthSq()*t.lengthSq());if(0===e)return Math.PI/2;var n=this.dot(t)/e;return Math.acos(Ln(n,-1,1))}},{key:"distanceTo",value:function(t){return Math.sqrt(this.distanceToSquared(t))}},{key:"distanceToSquared",value:function(t){var e=this.x-t.x,n=this.y-t.y,r=this.z-t.z;return e*e+n*n+r*r}},{key:"manhattanDistanceTo",value:function(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}},{key:"setFromSpherical",value:function(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}},{key:"setFromSphericalCoords",value:function(t,e,n){var r=Math.sin(e)*t;return this.x=r*Math.sin(n),this.y=Math.cos(e)*t,this.z=r*Math.cos(n),this}},{key:"setFromCylindrical",value:function(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}},{key:"setFromCylindricalCoords",value:function(t,e,n){return this.x=t*Math.sin(e),this.y=n,this.z=t*Math.cos(e),this}},{key:"setFromMatrixPosition",value:function(t){var e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this}},{key:"setFromMatrixScale",value:function(t){var e=this.setFromMatrixColumn(t,0).length(),n=this.setFromMatrixColumn(t,1).length(),r=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=n,this.z=r,this}},{key:"setFromMatrixColumn",value:function(t,e){return this.fromArray(t.elements,4*e)}},{key:"setFromMatrix3Column",value:function(t,e){return this.fromArray(t.elements,3*e)}},{key:"setFromEuler",value:function(t){return this.x=t._x,this.y=t._y,this.z=t._z,this}},{key:"setFromColor",value:function(t){return this.x=t.r,this.y=t.g,this.z=t.b,this}},{key:"equals",value:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}},{key:"fromArray",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this}},{key:"toArray",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t}},{key:"fromBufferAttribute",value:function(t,e){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this}},{key:"random",value:function(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}},{key:"randomDirection",value:function(){var t=Math.random()*Math.PI*2,e=2*Math.random()-1,n=Math.sqrt(1-e*e);return this.x=n*Math.cos(t),this.y=e,this.z=n*Math.sin(t),this}},{key:Symbol.iterator,value:_().mark((function t(){return _().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.x;case 2:return t.next=4,this.y;case 4:return t.next=6,this.z;case 6:case"end":return t.stop()}}),t,this)}))}])}(),mr=new dr,yr=new pr,vr=function(){return T((function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new dr(1/0,1/0,1/0),n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new dr(-1/0,-1/0,-1/0);w(this,t),this.isBox3=!0,this.min=e,this.max=n}),[{key:"set",value:function(t,e){return this.min.copy(t),this.max.copy(e),this}},{key:"setFromArray",value:function(t){this.makeEmpty();for(var e=0,n=t.length;e<n;e+=3)this.expandByPoint(br.fromArray(t,e));return this}},{key:"setFromBufferAttribute",value:function(t){this.makeEmpty();for(var e=0,n=t.count;e<n;e++)this.expandByPoint(br.fromBufferAttribute(t,e));return this}},{key:"setFromPoints",value:function(t){this.makeEmpty();for(var e=0,n=t.length;e<n;e++)this.expandByPoint(t[e]);return this}},{key:"setFromCenterAndSize",value:function(t,e){var n=br.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(n),this.max.copy(t).add(n),this}},{key:"setFromObject",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.makeEmpty(),this.expandByObject(t,e)}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(t){return this.min.copy(t.min),this.max.copy(t.max),this}},{key:"makeEmpty",value:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}},{key:"isEmpty",value:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}},{key:"getCenter",value:function(t){return this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}},{key:"getSize",value:function(t){return this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)}},{key:"expandByPoint",value:function(t){return this.min.min(t),this.max.max(t),this}},{key:"expandByVector",value:function(t){return this.min.sub(t),this.max.add(t),this}},{key:"expandByScalar",value:function(t){return this.min.addScalar(-t),this.max.addScalar(t),this}},{key:"expandByObject",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];t.updateWorldMatrix(!1,!1);var n=t.geometry;if(void 0!==n){var r=n.getAttribute("position");if(!0===e&&void 0!==r&&!0!==t.isInstancedMesh)for(var i=0,o=r.count;i<o;i++)!0===t.isMesh?t.getVertexPosition(i,br):br.fromBufferAttribute(r,i),br.applyMatrix4(t.matrixWorld),this.expandByPoint(br);else void 0!==t.boundingBox?(null===t.boundingBox&&t.computeBoundingBox(),_r.copy(t.boundingBox)):(null===n.boundingBox&&n.computeBoundingBox(),_r.copy(n.boundingBox)),_r.applyMatrix4(t.matrixWorld),this.union(_r)}for(var a=t.children,s=0,u=a.length;s<u;s++)this.expandByObject(a[s],e);return this}},{key:"containsPoint",value:function(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y||t.z<this.min.z||t.z>this.max.z)}},{key:"containsBox",value:function(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z}},{key:"getParameter",value:function(t,e){return e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))}},{key:"intersectsBox",value:function(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z)}},{key:"intersectsSphere",value:function(t){return this.clampPoint(t.center,br),br.distanceToSquared(t.center)<=t.radius*t.radius}},{key:"intersectsPlane",value:function(t){var e,n;return t.normal.x>0?(e=t.normal.x*this.min.x,n=t.normal.x*this.max.x):(e=t.normal.x*this.max.x,n=t.normal.x*this.min.x),t.normal.y>0?(e+=t.normal.y*this.min.y,n+=t.normal.y*this.max.y):(e+=t.normal.y*this.max.y,n+=t.normal.y*this.min.y),t.normal.z>0?(e+=t.normal.z*this.min.z,n+=t.normal.z*this.max.z):(e+=t.normal.z*this.max.z,n+=t.normal.z*this.min.z),e<=-t.constant&&n>=-t.constant}},{key:"intersectsTriangle",value:function(t){if(this.isEmpty())return!1;this.getCenter(Ar),Or.subVectors(this.max,Ar),xr.subVectors(t.a,Ar),wr.subVectors(t.b,Ar),Sr.subVectors(t.c,Ar),Tr.subVectors(wr,xr),Mr.subVectors(Sr,wr),Er.subVectors(xr,Sr);var e=[0,-Tr.z,Tr.y,0,-Mr.z,Mr.y,0,-Er.z,Er.y,Tr.z,0,-Tr.x,Mr.z,0,-Mr.x,Er.z,0,-Er.x,-Tr.y,Tr.x,0,-Mr.y,Mr.x,0,-Er.y,Er.x,0];return!!kr(e,xr,wr,Sr,Or)&&!!kr(e=[1,0,0,0,1,0,0,0,1],xr,wr,Sr,Or)&&(Pr.crossVectors(Tr,Mr),kr(e=[Pr.x,Pr.y,Pr.z],xr,wr,Sr,Or))}},{key:"clampPoint",value:function(t,e){return e.copy(t).clamp(this.min,this.max)}},{key:"distanceToPoint",value:function(t){return this.clampPoint(t,br).distanceTo(t)}},{key:"getBoundingSphere",value:function(t){return this.isEmpty()?t.makeEmpty():(this.getCenter(t.center),t.radius=.5*this.getSize(br).length()),t}},{key:"intersect",value:function(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}},{key:"union",value:function(t){return this.min.min(t.min),this.max.max(t.max),this}},{key:"applyMatrix4",value:function(t){return this.isEmpty()||(gr[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),gr[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),gr[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),gr[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),gr[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),gr[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),gr[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),gr[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(gr)),this}},{key:"translate",value:function(t){return this.min.add(t),this.max.add(t),this}},{key:"equals",value:function(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}])}(),gr=[new dr,new dr,new dr,new dr,new dr,new dr,new dr,new dr],br=new dr,_r=new vr,xr=new dr,wr=new dr,Sr=new dr,Tr=new dr,Mr=new dr,Er=new dr,Ar=new dr,Or=new dr,Pr=new dr,Rr=new dr;function kr(t,e,n,r,i){for(var o=0,a=t.length-3;o<=a;o+=3){Rr.fromArray(t,o);var s=i.x*Math.abs(Rr.x)+i.y*Math.abs(Rr.y)+i.z*Math.abs(Rr.z),u=e.dot(Rr),c=n.dot(Rr),l=r.dot(Rr);if(Math.max(-Math.max(u,c,l),Math.min(u,c,l))>s)return!1}return!0}var Cr=new vr,Nr=new dr,Lr=new dr,jr=function(){return T((function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new dr,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;w(this,t),this.isSphere=!0,this.center=e,this.radius=n}),[{key:"set",value:function(t,e){return this.center.copy(t),this.radius=e,this}},{key:"setFromPoints",value:function(t,e){var n=this.center;void 0!==e?n.copy(e):Cr.setFromPoints(t).getCenter(n);for(var r=0,i=0,o=t.length;i<o;i++)r=Math.max(r,n.distanceToSquared(t[i]));return this.radius=Math.sqrt(r),this}},{key:"copy",value:function(t){return this.center.copy(t.center),this.radius=t.radius,this}},{key:"isEmpty",value:function(){return this.radius<0}},{key:"makeEmpty",value:function(){return this.center.set(0,0,0),this.radius=-1,this}},{key:"containsPoint",value:function(t){return t.distanceToSquared(this.center)<=this.radius*this.radius}},{key:"distanceToPoint",value:function(t){return t.distanceTo(this.center)-this.radius}},{key:"intersectsSphere",value:function(t){var e=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=e*e}},{key:"intersectsBox",value:function(t){return t.intersectsSphere(this)}},{key:"intersectsPlane",value:function(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius}},{key:"clampPoint",value:function(t,e){var n=this.center.distanceToSquared(t);return e.copy(t),n>this.radius*this.radius&&(e.sub(this.center).normalize(),e.multiplyScalar(this.radius).add(this.center)),e}},{key:"getBoundingBox",value:function(t){return this.isEmpty()?(t.makeEmpty(),t):(t.set(this.center,this.center),t.expandByScalar(this.radius),t)}},{key:"applyMatrix4",value:function(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this}},{key:"translate",value:function(t){return this.center.add(t),this}},{key:"expandByPoint",value:function(t){if(this.isEmpty())return this.center.copy(t),this.radius=0,this;Nr.subVectors(t,this.center);var e=Nr.lengthSq();if(e>this.radius*this.radius){var n=Math.sqrt(e),r=.5*(n-this.radius);this.center.addScaledVector(Nr,r/n),this.radius+=r}return this}},{key:"union",value:function(t){return t.isEmpty()?this:this.isEmpty()?(this.copy(t),this):(!0===this.center.equals(t.center)?this.radius=Math.max(this.radius,t.radius):(Lr.subVectors(t.center,this.center).setLength(t.radius),this.expandByPoint(Nr.copy(t.center).add(Lr)),this.expandByPoint(Nr.copy(t.center).sub(Lr))),this)}},{key:"equals",value:function(t){return t.center.equals(this.center)&&t.radius===this.radius}},{key:"clone",value:function(){return(new this.constructor).copy(this)}}])}(),Ir=new dr,Br=new dr,Ur=new dr,Dr=new dr,Fr=new dr,zr=new dr,Vr=new dr,Gr=function(){return T((function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new dr,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new dr(0,0,-1);w(this,t),this.origin=e,this.direction=n}),[{key:"set",value:function(t,e){return this.origin.copy(t),this.direction.copy(e),this}},{key:"copy",value:function(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this}},{key:"at",value:function(t,e){return e.copy(this.origin).addScaledVector(this.direction,t)}},{key:"lookAt",value:function(t){return this.direction.copy(t).sub(this.origin).normalize(),this}},{key:"recast",value:function(t){return this.origin.copy(this.at(t,Ir)),this}},{key:"closestPointToPoint",value:function(t,e){e.subVectors(t,this.origin);var n=e.dot(this.direction);return n<0?e.copy(this.origin):e.copy(this.origin).addScaledVector(this.direction,n)}},{key:"distanceToPoint",value:function(t){return Math.sqrt(this.distanceSqToPoint(t))}},{key:"distanceSqToPoint",value:function(t){var e=Ir.subVectors(t,this.origin).dot(this.direction);return e<0?this.origin.distanceToSquared(t):(Ir.copy(this.origin).addScaledVector(this.direction,e),Ir.distanceToSquared(t))}},{key:"distanceSqToSegment",value:function(t,e,n,r){Br.copy(t).add(e).multiplyScalar(.5),Ur.copy(e).sub(t).normalize(),Dr.copy(this.origin).sub(Br);var i,o,a,s,u=.5*t.distanceTo(e),c=-this.direction.dot(Ur),l=Dr.dot(this.direction),f=-Dr.dot(Ur),h=Dr.lengthSq(),p=Math.abs(1-c*c);if(p>0)if(o=c*l-f,s=u*p,(i=c*f-l)>=0)if(o>=-s)if(o<=s){var d=1/p;a=(i*=d)*(i+c*(o*=d)+2*l)+o*(c*i+o+2*f)+h}else o=u,a=-(i=Math.max(0,-(c*o+l)))*i+o*(o+2*f)+h;else o=-u,a=-(i=Math.max(0,-(c*o+l)))*i+o*(o+2*f)+h;else o<=-s?a=-(i=Math.max(0,-(-c*u+l)))*i+(o=i>0?-u:Math.min(Math.max(-u,-f),u))*(o+2*f)+h:o<=s?(i=0,a=(o=Math.min(Math.max(-u,-f),u))*(o+2*f)+h):a=-(i=Math.max(0,-(c*u+l)))*i+(o=i>0?u:Math.min(Math.max(-u,-f),u))*(o+2*f)+h;else o=c>0?-u:u,a=-(i=Math.max(0,-(c*o+l)))*i+o*(o+2*f)+h;return n&&n.copy(this.origin).addScaledVector(this.direction,i),r&&r.copy(Br).addScaledVector(Ur,o),a}},{key:"intersectSphere",value:function(t,e){Ir.subVectors(t.center,this.origin);var n=Ir.dot(this.direction),r=Ir.dot(Ir)-n*n,i=t.radius*t.radius;if(r>i)return null;var o=Math.sqrt(i-r),a=n-o,s=n+o;return s<0?null:a<0?this.at(s,e):this.at(a,e)}},{key:"intersectsSphere",value:function(t){return this.distanceSqToPoint(t.center)<=t.radius*t.radius}},{key:"distanceToPlane",value:function(t){var e=t.normal.dot(this.direction);if(0===e)return 0===t.distanceToPoint(this.origin)?0:null;var n=-(this.origin.dot(t.normal)+t.constant)/e;return n>=0?n:null}},{key:"intersectPlane",value:function(t,e){var n=this.distanceToPlane(t);return null===n?null:this.at(n,e)}},{key:"intersectsPlane",value:function(t){var e=t.distanceToPoint(this.origin);return 0===e||t.normal.dot(this.direction)*e<0}},{key:"intersectBox",value:function(t,e){var n,r,i,o,a,s,u=1/this.direction.x,c=1/this.direction.y,l=1/this.direction.z,f=this.origin;return u>=0?(n=(t.min.x-f.x)*u,r=(t.max.x-f.x)*u):(n=(t.max.x-f.x)*u,r=(t.min.x-f.x)*u),c>=0?(i=(t.min.y-f.y)*c,o=(t.max.y-f.y)*c):(i=(t.max.y-f.y)*c,o=(t.min.y-f.y)*c),n>o||i>r?null:((i>n||isNaN(n))&&(n=i),(o<r||isNaN(r))&&(r=o),l>=0?(a=(t.min.z-f.z)*l,s=(t.max.z-f.z)*l):(a=(t.max.z-f.z)*l,s=(t.min.z-f.z)*l),n>s||a>r?null:((a>n||n!=n)&&(n=a),(s<r||r!=r)&&(r=s),r<0?null:this.at(n>=0?n:r,e)))}},{key:"intersectsBox",value:function(t){return null!==this.intersectBox(t,Ir)}},{key:"intersectTriangle",value:function(t,e,n,r,i){Fr.subVectors(e,t),zr.subVectors(n,t),Vr.crossVectors(Fr,zr);var o,a=this.direction.dot(Vr);if(a>0){if(r)return null;o=1}else{if(!(a<0))return null;o=-1,a=-a}Dr.subVectors(this.origin,t);var s=o*this.direction.dot(zr.crossVectors(Dr,zr));if(s<0)return null;var u=o*this.direction.dot(Fr.cross(Dr));if(u<0)return null;if(s+u>a)return null;var c=-o*Dr.dot(Vr);return c<0?null:this.at(c/a,i)}},{key:"applyMatrix4",value:function(t){return this.origin.applyMatrix4(t),this.direction.transformDirection(t),this}},{key:"equals",value:function(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}},{key:"clone",value:function(){return(new this.constructor).copy(this)}}])}(),Hr=function(){function t(e,n,r,i,o,a,s,u,c,l,f,h,p,d,m,y){w(this,t),t.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],void 0!==e&&this.set(e,n,r,i,o,a,s,u,c,l,f,h,p,d,m,y)}return T(t,[{key:"set",value:function(t,e,n,r,i,o,a,s,u,c,l,f,h,p,d,m){var y=this.elements;return y[0]=t,y[4]=e,y[8]=n,y[12]=r,y[1]=i,y[5]=o,y[9]=a,y[13]=s,y[2]=u,y[6]=c,y[10]=l,y[14]=f,y[3]=h,y[7]=p,y[11]=d,y[15]=m,this}},{key:"identity",value:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}},{key:"clone",value:function(){return(new t).fromArray(this.elements)}},{key:"copy",value:function(t){var e=this.elements,n=t.elements;return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],e[9]=n[9],e[10]=n[10],e[11]=n[11],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15],this}},{key:"copyPosition",value:function(t){var e=this.elements,n=t.elements;return e[12]=n[12],e[13]=n[13],e[14]=n[14],this}},{key:"setFromMatrix3",value:function(t){var e=t.elements;return this.set(e[0],e[3],e[6],0,e[1],e[4],e[7],0,e[2],e[5],e[8],0,0,0,0,1),this}},{key:"extractBasis",value:function(t,e,n){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}},{key:"makeBasis",value:function(t,e,n){return this.set(t.x,e.x,n.x,0,t.y,e.y,n.y,0,t.z,e.z,n.z,0,0,0,0,1),this}},{key:"extractRotation",value:function(t){var e=this.elements,n=t.elements,r=1/Wr.setFromMatrixColumn(t,0).length(),i=1/Wr.setFromMatrixColumn(t,1).length(),o=1/Wr.setFromMatrixColumn(t,2).length();return e[0]=n[0]*r,e[1]=n[1]*r,e[2]=n[2]*r,e[3]=0,e[4]=n[4]*i,e[5]=n[5]*i,e[6]=n[6]*i,e[7]=0,e[8]=n[8]*o,e[9]=n[9]*o,e[10]=n[10]*o,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}},{key:"makeRotationFromEuler",value:function(t){var e=this.elements,n=t.x,r=t.y,i=t.z,o=Math.cos(n),a=Math.sin(n),s=Math.cos(r),u=Math.sin(r),c=Math.cos(i),l=Math.sin(i);if("XYZ"===t.order){var f=o*c,h=o*l,p=a*c,d=a*l;e[0]=s*c,e[4]=-s*l,e[8]=u,e[1]=h+p*u,e[5]=f-d*u,e[9]=-a*s,e[2]=d-f*u,e[6]=p+h*u,e[10]=o*s}else if("YXZ"===t.order){var m=s*c,y=s*l,v=u*c,g=u*l;e[0]=m+g*a,e[4]=v*a-y,e[8]=o*u,e[1]=o*l,e[5]=o*c,e[9]=-a,e[2]=y*a-v,e[6]=g+m*a,e[10]=o*s}else if("ZXY"===t.order){var b=s*c,_=s*l,x=u*c,w=u*l;e[0]=b-w*a,e[4]=-o*l,e[8]=x+_*a,e[1]=_+x*a,e[5]=o*c,e[9]=w-b*a,e[2]=-o*u,e[6]=a,e[10]=o*s}else if("ZYX"===t.order){var S=o*c,T=o*l,M=a*c,E=a*l;e[0]=s*c,e[4]=M*u-T,e[8]=S*u+E,e[1]=s*l,e[5]=E*u+S,e[9]=T*u-M,e[2]=-u,e[6]=a*s,e[10]=o*s}else if("YZX"===t.order){var A=o*s,O=o*u,P=a*s,R=a*u;e[0]=s*c,e[4]=R-A*l,e[8]=P*l+O,e[1]=l,e[5]=o*c,e[9]=-a*c,e[2]=-u*c,e[6]=O*l+P,e[10]=A-R*l}else if("XZY"===t.order){var k=o*s,C=o*u,N=a*s,L=a*u;e[0]=s*c,e[4]=-l,e[8]=u*c,e[1]=k*l+L,e[5]=o*c,e[9]=C*l-N,e[2]=N*l-C,e[6]=a*c,e[10]=L*l+k}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}},{key:"makeRotationFromQuaternion",value:function(t){return this.compose(Xr,t,Yr)}},{key:"lookAt",value:function(t,e,n){var r=this.elements;return Kr.subVectors(t,e),0===Kr.lengthSq()&&(Kr.z=1),Kr.normalize(),Jr.crossVectors(n,Kr),0===Jr.lengthSq()&&(1===Math.abs(n.z)?Kr.x+=1e-4:Kr.z+=1e-4,Kr.normalize(),Jr.crossVectors(n,Kr)),Jr.normalize(),Zr.crossVectors(Kr,Jr),r[0]=Jr.x,r[4]=Zr.x,r[8]=Kr.x,r[1]=Jr.y,r[5]=Zr.y,r[9]=Kr.y,r[2]=Jr.z,r[6]=Zr.z,r[10]=Kr.z,this}},{key:"multiply",value:function(t){return this.multiplyMatrices(this,t)}},{key:"premultiply",value:function(t){return this.multiplyMatrices(t,this)}},{key:"multiplyMatrices",value:function(t,e){var n=t.elements,r=e.elements,i=this.elements,o=n[0],a=n[4],s=n[8],u=n[12],c=n[1],l=n[5],f=n[9],h=n[13],p=n[2],d=n[6],m=n[10],y=n[14],v=n[3],g=n[7],b=n[11],_=n[15],x=r[0],w=r[4],S=r[8],T=r[12],M=r[1],E=r[5],A=r[9],O=r[13],P=r[2],R=r[6],k=r[10],C=r[14],N=r[3],L=r[7],j=r[11],I=r[15];return i[0]=o*x+a*M+s*P+u*N,i[4]=o*w+a*E+s*R+u*L,i[8]=o*S+a*A+s*k+u*j,i[12]=o*T+a*O+s*C+u*I,i[1]=c*x+l*M+f*P+h*N,i[5]=c*w+l*E+f*R+h*L,i[9]=c*S+l*A+f*k+h*j,i[13]=c*T+l*O+f*C+h*I,i[2]=p*x+d*M+m*P+y*N,i[6]=p*w+d*E+m*R+y*L,i[10]=p*S+d*A+m*k+y*j,i[14]=p*T+d*O+m*C+y*I,i[3]=v*x+g*M+b*P+_*N,i[7]=v*w+g*E+b*R+_*L,i[11]=v*S+g*A+b*k+_*j,i[15]=v*T+g*O+b*C+_*I,this}},{key:"multiplyScalar",value:function(t){var e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this}},{key:"determinant",value:function(){var t=this.elements,e=t[0],n=t[4],r=t[8],i=t[12],o=t[1],a=t[5],s=t[9],u=t[13],c=t[2],l=t[6],f=t[10],h=t[14];return t[3]*(+i*s*l-r*u*l-i*a*f+n*u*f+r*a*h-n*s*h)+t[7]*(+e*s*h-e*u*f+i*o*f-r*o*h+r*u*c-i*s*c)+t[11]*(+e*u*l-e*a*h-i*o*l+n*o*h+i*a*c-n*u*c)+t[15]*(-r*a*c-e*s*l+e*a*f+r*o*l-n*o*f+n*s*c)}},{key:"transpose",value:function(){var t,e=this.elements;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}},{key:"setPosition",value:function(t,e,n){var r=this.elements;return t.isVector3?(r[12]=t.x,r[13]=t.y,r[14]=t.z):(r[12]=t,r[13]=e,r[14]=n),this}},{key:"invert",value:function(){var t=this.elements,e=t[0],n=t[1],r=t[2],i=t[3],o=t[4],a=t[5],s=t[6],u=t[7],c=t[8],l=t[9],f=t[10],h=t[11],p=t[12],d=t[13],m=t[14],y=t[15],v=l*m*u-d*f*u+d*s*h-a*m*h-l*s*y+a*f*y,g=p*f*u-c*m*u-p*s*h+o*m*h+c*s*y-o*f*y,b=c*d*u-p*l*u+p*a*h-o*d*h-c*a*y+o*l*y,_=p*l*s-c*d*s-p*a*f+o*d*f+c*a*m-o*l*m,x=e*v+n*g+r*b+i*_;if(0===x)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);var w=1/x;return t[0]=v*w,t[1]=(d*f*i-l*m*i-d*r*h+n*m*h+l*r*y-n*f*y)*w,t[2]=(a*m*i-d*s*i+d*r*u-n*m*u-a*r*y+n*s*y)*w,t[3]=(l*s*i-a*f*i-l*r*u+n*f*u+a*r*h-n*s*h)*w,t[4]=g*w,t[5]=(c*m*i-p*f*i+p*r*h-e*m*h-c*r*y+e*f*y)*w,t[6]=(p*s*i-o*m*i-p*r*u+e*m*u+o*r*y-e*s*y)*w,t[7]=(o*f*i-c*s*i+c*r*u-e*f*u-o*r*h+e*s*h)*w,t[8]=b*w,t[9]=(p*l*i-c*d*i-p*n*h+e*d*h+c*n*y-e*l*y)*w,t[10]=(o*d*i-p*a*i+p*n*u-e*d*u-o*n*y+e*a*y)*w,t[11]=(c*a*i-o*l*i-c*n*u+e*l*u+o*n*h-e*a*h)*w,t[12]=_*w,t[13]=(c*d*r-p*l*r+p*n*f-e*d*f-c*n*m+e*l*m)*w,t[14]=(p*a*r-o*d*r-p*n*s+e*d*s+o*n*m-e*a*m)*w,t[15]=(o*l*r-c*a*r+c*n*s-e*l*s-o*n*f+e*a*f)*w,this}},{key:"scale",value:function(t){var e=this.elements,n=t.x,r=t.y,i=t.z;return e[0]*=n,e[4]*=r,e[8]*=i,e[1]*=n,e[5]*=r,e[9]*=i,e[2]*=n,e[6]*=r,e[10]*=i,e[3]*=n,e[7]*=r,e[11]*=i,this}},{key:"getMaxScaleOnAxis",value:function(){var t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],n=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],r=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,n,r))}},{key:"makeTranslation",value:function(t,e,n){return t.isVector3?this.set(1,0,0,t.x,0,1,0,t.y,0,0,1,t.z,0,0,0,1):this.set(1,0,0,t,0,1,0,e,0,0,1,n,0,0,0,1),this}},{key:"makeRotationX",value:function(t){var e=Math.cos(t),n=Math.sin(t);return this.set(1,0,0,0,0,e,-n,0,0,n,e,0,0,0,0,1),this}},{key:"makeRotationY",value:function(t){var e=Math.cos(t),n=Math.sin(t);return this.set(e,0,n,0,0,1,0,0,-n,0,e,0,0,0,0,1),this}},{key:"makeRotationZ",value:function(t){var e=Math.cos(t),n=Math.sin(t);return this.set(e,-n,0,0,n,e,0,0,0,0,1,0,0,0,0,1),this}},{key:"makeRotationAxis",value:function(t,e){var n=Math.cos(e),r=Math.sin(e),i=1-n,o=t.x,a=t.y,s=t.z,u=i*o,c=i*a;return this.set(u*o+n,u*a-r*s,u*s+r*a,0,u*a+r*s,c*a+n,c*s-r*o,0,u*s-r*a,c*s+r*o,i*s*s+n,0,0,0,0,1),this}},{key:"makeScale",value:function(t,e,n){return this.set(t,0,0,0,0,e,0,0,0,0,n,0,0,0,0,1),this}},{key:"makeShear",value:function(t,e,n,r,i,o){return this.set(1,n,i,0,t,1,o,0,e,r,1,0,0,0,0,1),this}},{key:"compose",value:function(t,e,n){var r=this.elements,i=e._x,o=e._y,a=e._z,s=e._w,u=i+i,c=o+o,l=a+a,f=i*u,h=i*c,p=i*l,d=o*c,m=o*l,y=a*l,v=s*u,g=s*c,b=s*l,_=n.x,x=n.y,w=n.z;return r[0]=(1-(d+y))*_,r[1]=(h+b)*_,r[2]=(p-g)*_,r[3]=0,r[4]=(h-b)*x,r[5]=(1-(f+y))*x,r[6]=(m+v)*x,r[7]=0,r[8]=(p+g)*w,r[9]=(m-v)*w,r[10]=(1-(f+d))*w,r[11]=0,r[12]=t.x,r[13]=t.y,r[14]=t.z,r[15]=1,this}},{key:"decompose",value:function(t,e,n){var r=this.elements,i=Wr.set(r[0],r[1],r[2]).length(),o=Wr.set(r[4],r[5],r[6]).length(),a=Wr.set(r[8],r[9],r[10]).length();this.determinant()<0&&(i=-i),t.x=r[12],t.y=r[13],t.z=r[14],qr.copy(this);var s=1/i,u=1/o,c=1/a;return qr.elements[0]*=s,qr.elements[1]*=s,qr.elements[2]*=s,qr.elements[4]*=u,qr.elements[5]*=u,qr.elements[6]*=u,qr.elements[8]*=c,qr.elements[9]*=c,qr.elements[10]*=c,e.setFromRotationMatrix(qr),n.x=i,n.y=o,n.z=a,this}},{key:"makePerspective",value:function(t,e,n,r,i,o){var a,s,u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:En,c=this.elements,l=2*i/(e-t),f=2*i/(n-r),h=(e+t)/(e-t),p=(n+r)/(n-r);if(u===En)a=-(o+i)/(o-i),s=-2*o*i/(o-i);else{if(u!==An)throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+u);a=-o/(o-i),s=-o*i/(o-i)}return c[0]=l,c[4]=0,c[8]=h,c[12]=0,c[1]=0,c[5]=f,c[9]=p,c[13]=0,c[2]=0,c[6]=0,c[10]=a,c[14]=s,c[3]=0,c[7]=0,c[11]=-1,c[15]=0,this}},{key:"makeOrthographic",value:function(t,e,n,r,i,o){var a,s,u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:En,c=this.elements,l=1/(e-t),f=1/(n-r),h=1/(o-i),p=(e+t)*l,d=(n+r)*f;if(u===En)a=(o+i)*h,s=-2*h;else{if(u!==An)throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+u);a=i*h,s=-1*h}return c[0]=2*l,c[4]=0,c[8]=0,c[12]=-p,c[1]=0,c[5]=2*f,c[9]=0,c[13]=-d,c[2]=0,c[6]=0,c[10]=s,c[14]=-a,c[3]=0,c[7]=0,c[11]=0,c[15]=1,this}},{key:"equals",value:function(t){for(var e=this.elements,n=t.elements,r=0;r<16;r++)if(e[r]!==n[r])return!1;return!0}},{key:"fromArray",value:function(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=0;n<16;n++)this.elements[n]=t[n+e];return this}},{key:"toArray",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this.elements;return t[e]=n[0],t[e+1]=n[1],t[e+2]=n[2],t[e+3]=n[3],t[e+4]=n[4],t[e+5]=n[5],t[e+6]=n[6],t[e+7]=n[7],t[e+8]=n[8],t[e+9]=n[9],t[e+10]=n[10],t[e+11]=n[11],t[e+12]=n[12],t[e+13]=n[13],t[e+14]=n[14],t[e+15]=n[15],t}}])}(),Wr=new dr,qr=new Hr,Xr=new dr(0,0,0),Yr=new dr(1,1,1),Jr=new dr,Zr=new dr,Kr=new dr,Qr=new Hr,$r=new pr,ti=function(){return T((function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:t.DEFAULT_ORDER;w(this,t),this.isEuler=!0,this._x=e,this._y=n,this._z=r,this._order=i}),[{key:"x",get:function(){return this._x},set:function(t){this._x=t,this._onChangeCallback()}},{key:"y",get:function(){return this._y},set:function(t){this._y=t,this._onChangeCallback()}},{key:"z",get:function(){return this._z},set:function(t){this._z=t,this._onChangeCallback()}},{key:"order",get:function(){return this._order},set:function(t){this._order=t,this._onChangeCallback()}},{key:"set",value:function(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this._order;return this._x=t,this._y=e,this._z=n,this._order=r,this._onChangeCallback(),this}},{key:"clone",value:function(){return new this.constructor(this._x,this._y,this._z,this._order)}},{key:"copy",value:function(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this}},{key:"setFromRotationMatrix",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._order,n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=t.elements,i=r[0],o=r[4],a=r[8],s=r[1],u=r[5],c=r[9],l=r[2],f=r[6],h=r[10];switch(e){case"XYZ":this._y=Math.asin(Ln(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-c,h),this._z=Math.atan2(-o,i)):(this._x=Math.atan2(f,u),this._z=0);break;case"YXZ":this._x=Math.asin(-Ln(c,-1,1)),Math.abs(c)<.9999999?(this._y=Math.atan2(a,h),this._z=Math.atan2(s,u)):(this._y=Math.atan2(-l,i),this._z=0);break;case"ZXY":this._x=Math.asin(Ln(f,-1,1)),Math.abs(f)<.9999999?(this._y=Math.atan2(-l,h),this._z=Math.atan2(-o,u)):(this._y=0,this._z=Math.atan2(s,i));break;case"ZYX":this._y=Math.asin(-Ln(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(f,h),this._z=Math.atan2(s,i)):(this._x=0,this._z=Math.atan2(-o,u));break;case"YZX":this._z=Math.asin(Ln(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(-c,u),this._y=Math.atan2(-l,i)):(this._x=0,this._y=Math.atan2(a,h));break;case"XZY":this._z=Math.asin(-Ln(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(f,u),this._y=Math.atan2(a,i)):(this._x=Math.atan2(-c,h),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+e)}return this._order=e,!0===n&&this._onChangeCallback(),this}},{key:"setFromQuaternion",value:function(t,e,n){return Qr.makeRotationFromQuaternion(t),this.setFromRotationMatrix(Qr,e,n)}},{key:"setFromVector3",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._order;return this.set(t.x,t.y,t.z,e)}},{key:"reorder",value:function(t){return $r.setFromEuler(this),this.setFromQuaternion($r,t)}},{key:"equals",value:function(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order}},{key:"fromArray",value:function(t){return this._x=t[0],this._y=t[1],this._z=t[2],void 0!==t[3]&&(this._order=t[3]),this._onChangeCallback(),this}},{key:"toArray",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t}},{key:"_onChange",value:function(t){return this._onChangeCallback=t,this}},{key:"_onChangeCallback",value:function(){}},{key:Symbol.iterator,value:_().mark((function t(){return _().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._x;case 2:return t.next=4,this._y;case 4:return t.next=6,this._z;case 6:return t.next=8,this._order;case 8:case"end":return t.stop()}}),t,this)}))}])}();ti.DEFAULT_ORDER="XYZ";var ei=function(){return T((function t(){w(this,t),this.mask=1}),[{key:"set",value:function(t){this.mask=1<<t>>>0}},{key:"enable",value:function(t){this.mask|=1<<t}},{key:"enableAll",value:function(){this.mask=-1}},{key:"toggle",value:function(t){this.mask^=1<<t}},{key:"disable",value:function(t){this.mask&=~(1<<t)}},{key:"disableAll",value:function(){this.mask=0}},{key:"test",value:function(t){return!!(this.mask&t.mask)}},{key:"isEnabled",value:function(t){return!!(this.mask&1<<t)}}])}(),ni=0,ri=new dr,ii=new pr,oi=new Hr,ai=new dr,si=new dr,ui=new dr,ci=new pr,li=new dr(1,0,0),fi=new dr(0,1,0),hi=new dr(0,0,1),pi={type:"added"},di={type:"removed"},mi={type:"childadded",child:null},yi={type:"childremoved",child:null},vi=function(t){function e(){var t;w(this,e),(t=d(this,e)).isObject3D=!0,Object.defineProperty(t,"id",{value:ni++}),t.uuid=Nn(),t.name="",t.type="Object3D",t.parent=null,t.children=[],t.up=e.DEFAULT_UP.clone();var n=new dr,r=new ti,i=new pr,o=new dr(1,1,1);return r._onChange((function(){i.setFromEuler(r,!1)})),i._onChange((function(){r.setFromQuaternion(i,void 0,!1)})),Object.defineProperties(t,{position:{configurable:!0,enumerable:!0,value:n},rotation:{configurable:!0,enumerable:!0,value:r},quaternion:{configurable:!0,enumerable:!0,value:i},scale:{configurable:!0,enumerable:!0,value:o},modelViewMatrix:{value:new Hr},normalMatrix:{value:new zn}}),t.matrix=new Hr,t.matrixWorld=new Hr,t.matrixAutoUpdate=e.DEFAULT_MATRIX_AUTO_UPDATE,t.matrixWorldAutoUpdate=e.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,t.matrixWorldNeedsUpdate=!1,t.layers=new ei,t.visible=!0,t.castShadow=!1,t.receiveShadow=!1,t.frustumCulled=!0,t.renderOrder=0,t.animations=[],t.userData={},t}return v(e,t),T(e,[{key:"onBeforeShadow",value:function(){}},{key:"onAfterShadow",value:function(){}},{key:"onBeforeRender",value:function(){}},{key:"onAfterRender",value:function(){}},{key:"applyMatrix4",value:function(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)}},{key:"applyQuaternion",value:function(t){return this.quaternion.premultiply(t),this}},{key:"setRotationFromAxisAngle",value:function(t,e){this.quaternion.setFromAxisAngle(t,e)}},{key:"setRotationFromEuler",value:function(t){this.quaternion.setFromEuler(t,!0)}},{key:"setRotationFromMatrix",value:function(t){this.quaternion.setFromRotationMatrix(t)}},{key:"setRotationFromQuaternion",value:function(t){this.quaternion.copy(t)}},{key:"rotateOnAxis",value:function(t,e){return ii.setFromAxisAngle(t,e),this.quaternion.multiply(ii),this}},{key:"rotateOnWorldAxis",value:function(t,e){return ii.setFromAxisAngle(t,e),this.quaternion.premultiply(ii),this}},{key:"rotateX",value:function(t){return this.rotateOnAxis(li,t)}},{key:"rotateY",value:function(t){return this.rotateOnAxis(fi,t)}},{key:"rotateZ",value:function(t){return this.rotateOnAxis(hi,t)}},{key:"translateOnAxis",value:function(t,e){return ri.copy(t).applyQuaternion(this.quaternion),this.position.add(ri.multiplyScalar(e)),this}},{key:"translateX",value:function(t){return this.translateOnAxis(li,t)}},{key:"translateY",value:function(t){return this.translateOnAxis(fi,t)}},{key:"translateZ",value:function(t){return this.translateOnAxis(hi,t)}},{key:"localToWorld",value:function(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(this.matrixWorld)}},{key:"worldToLocal",value:function(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(oi.copy(this.matrixWorld).invert())}},{key:"lookAt",value:function(t,e,n){t.isVector3?ai.copy(t):ai.set(t,e,n);var r=this.parent;this.updateWorldMatrix(!0,!1),si.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?oi.lookAt(si,ai,this.up):oi.lookAt(ai,si,this.up),this.quaternion.setFromRotationMatrix(oi),r&&(oi.extractRotation(r.matrixWorld),ii.setFromRotationMatrix(oi),this.quaternion.premultiply(ii.invert()))}},{key:"add",value:function(t){if(arguments.length>1){for(var e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return t===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(t.removeFromParent(),t.parent=this,this.children.push(t),t.dispatchEvent(pi),mi.child=t,this.dispatchEvent(mi),mi.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this)}},{key:"remove",value:function(t){if(arguments.length>1){for(var e=0;e<arguments.length;e++)this.remove(arguments[e]);return this}var n=this.children.indexOf(t);return-1!==n&&(t.parent=null,this.children.splice(n,1),t.dispatchEvent(di),yi.child=t,this.dispatchEvent(yi),yi.child=null),this}},{key:"removeFromParent",value:function(){var t=this.parent;return null!==t&&t.remove(this),this}},{key:"clear",value:function(){return this.remove.apply(this,f(this.children))}},{key:"attach",value:function(t){return this.updateWorldMatrix(!0,!1),oi.copy(this.matrixWorld).invert(),null!==t.parent&&(t.parent.updateWorldMatrix(!0,!1),oi.multiply(t.parent.matrixWorld)),t.applyMatrix4(oi),t.removeFromParent(),t.parent=this,this.children.push(t),t.updateWorldMatrix(!1,!0),t.dispatchEvent(pi),mi.child=t,this.dispatchEvent(mi),mi.child=null,this}},{key:"getObjectById",value:function(t){return this.getObjectByProperty("id",t)}},{key:"getObjectByName",value:function(t){return this.getObjectByProperty("name",t)}},{key:"getObjectByProperty",value:function(t,e){if(this[t]===e)return this;for(var n=0,r=this.children.length;n<r;n++){var i=this.children[n].getObjectByProperty(t,e);if(void 0!==i)return i}}},{key:"getObjectsByProperty",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];this[t]===e&&n.push(this);for(var r=this.children,i=0,o=r.length;i<o;i++)r[i].getObjectsByProperty(t,e,n);return n}},{key:"getWorldPosition",value:function(t){return this.updateWorldMatrix(!0,!1),t.setFromMatrixPosition(this.matrixWorld)}},{key:"getWorldQuaternion",value:function(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(si,t,ui),t}},{key:"getWorldScale",value:function(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(si,ci,t),t}},{key:"getWorldDirection",value:function(t){this.updateWorldMatrix(!0,!1);var e=this.matrixWorld.elements;return t.set(e[8],e[9],e[10]).normalize()}},{key:"raycast",value:function(){}},{key:"traverse",value:function(t){t(this);for(var e=this.children,n=0,r=e.length;n<r;n++)e[n].traverse(t)}},{key:"traverseVisible",value:function(t){if(!1!==this.visible){t(this);for(var e=this.children,n=0,r=e.length;n<r;n++)e[n].traverseVisible(t)}}},{key:"traverseAncestors",value:function(t){var e=this.parent;null!==e&&(t(e),e.traverseAncestors(t))}},{key:"updateMatrix",value:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}},{key:"updateMatrixWorld",value:function(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);for(var e=this.children,n=0,r=e.length;n<r;n++){var i=e[n];!0!==i.matrixWorldAutoUpdate&&!0!==t||i.updateMatrixWorld(t)}}},{key:"updateWorldMatrix",value:function(t,e){var n=this.parent;if(!0===t&&null!==n&&!0===n.matrixWorldAutoUpdate&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===e)for(var r=this.children,i=0,o=r.length;i<o;i++){var a=r[i];!0===a.matrixWorldAutoUpdate&&a.updateWorldMatrix(!1,!0)}}},{key:"toJSON",value:function(t){var e=void 0===t||"string"==typeof t,n={};e&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},n.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});var r={};function i(e,n){return void 0===e[n.uuid]&&(e[n.uuid]=n.toJSON(t)),n.uuid}if(r.uuid=this.uuid,r.type=this.type,""!==this.name&&(r.name=this.name),!0===this.castShadow&&(r.castShadow=!0),!0===this.receiveShadow&&(r.receiveShadow=!0),!1===this.visible&&(r.visible=!1),!1===this.frustumCulled&&(r.frustumCulled=!1),0!==this.renderOrder&&(r.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(r.userData=this.userData),r.layers=this.layers.mask,r.matrix=this.matrix.toArray(),r.up=this.up.toArray(),!1===this.matrixAutoUpdate&&(r.matrixAutoUpdate=!1),this.isInstancedMesh&&(r.type="InstancedMesh",r.count=this.count,r.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(r.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(r.type="BatchedMesh",r.perObjectFrustumCulled=this.perObjectFrustumCulled,r.sortObjects=this.sortObjects,r.drawRanges=this._drawRanges,r.reservedRanges=this._reservedRanges,r.visibility=this._visibility,r.active=this._active,r.bounds=this._bounds.map((function(t){return{boxInitialized:t.boxInitialized,boxMin:t.box.min.toArray(),boxMax:t.box.max.toArray(),sphereInitialized:t.sphereInitialized,sphereRadius:t.sphere.radius,sphereCenter:t.sphere.center.toArray()}})),r.maxGeometryCount=this._maxGeometryCount,r.maxVertexCount=this._maxVertexCount,r.maxIndexCount=this._maxIndexCount,r.geometryInitialized=this._geometryInitialized,r.geometryCount=this._geometryCount,r.matricesTexture=this._matricesTexture.toJSON(t),null!==this.boundingSphere&&(r.boundingSphere={center:r.boundingSphere.center.toArray(),radius:r.boundingSphere.radius}),null!==this.boundingBox&&(r.boundingBox={min:r.boundingBox.min.toArray(),max:r.boundingBox.max.toArray()})),this.isScene)this.background&&(this.background.isColor?r.background=this.background.toJSON():this.background.isTexture&&(r.background=this.background.toJSON(t).uuid)),this.environment&&this.environment.isTexture&&!0!==this.environment.isRenderTargetTexture&&(r.environment=this.environment.toJSON(t).uuid);else if(this.isMesh||this.isLine||this.isPoints){r.geometry=i(t.geometries,this.geometry);var o=this.geometry.parameters;if(void 0!==o&&void 0!==o.shapes){var a=o.shapes;if(Array.isArray(a))for(var s=0,u=a.length;s<u;s++){var c=a[s];i(t.shapes,c)}else i(t.shapes,a)}}if(this.isSkinnedMesh&&(r.bindMode=this.bindMode,r.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(i(t.skeletons,this.skeleton),r.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){for(var l=[],f=0,h=this.material.length;f<h;f++)l.push(i(t.materials,this.material[f]));r.material=l}else r.material=i(t.materials,this.material);if(this.children.length>0){r.children=[];for(var p=0;p<this.children.length;p++)r.children.push(this.children[p].toJSON(t).object)}if(this.animations.length>0){r.animations=[];for(var d=0;d<this.animations.length;d++){var m=this.animations[d];r.animations.push(i(t.animations,m))}}if(e){var y=T(t.geometries),v=T(t.materials),g=T(t.textures),b=T(t.images),_=T(t.shapes),x=T(t.skeletons),w=T(t.animations),S=T(t.nodes);y.length>0&&(n.geometries=y),v.length>0&&(n.materials=v),g.length>0&&(n.textures=g),b.length>0&&(n.images=b),_.length>0&&(n.shapes=_),x.length>0&&(n.skeletons=x),w.length>0&&(n.animations=w),S.length>0&&(n.nodes=S)}return n.object=r,n;function T(t){var e=[];for(var n in t){var r=t[n];delete r.metadata,e.push(r)}return e}}},{key:"clone",value:function(t){return(new this.constructor).copy(this,t)}},{key:"copy",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.rotation.order=t.rotation.order,this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldAutoUpdate=t.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.animations=t.animations.slice(),this.userData=JSON.parse(JSON.stringify(t.userData)),!0===e)for(var n=0;n<t.children.length;n++){var r=t.children[n];this.add(r.clone())}return this}}])}(On);vi.DEFAULT_UP=new dr(0,1,0),vi.DEFAULT_MATRIX_AUTO_UPDATE=!0,vi.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;var gi=new dr,bi=new dr,_i=new dr,xi=new dr,wi=new dr,Si=new dr,Ti=new dr,Mi=new dr,Ei=new dr,Ai=new dr,Oi=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new dr,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new dr,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new dr;w(this,t),this.a=e,this.b=n,this.c=r}return T(t,[{key:"set",value:function(t,e,n){return this.a.copy(t),this.b.copy(e),this.c.copy(n),this}},{key:"setFromPointsAndIndices",value:function(t,e,n,r){return this.a.copy(t[e]),this.b.copy(t[n]),this.c.copy(t[r]),this}},{key:"setFromAttributeAndIndices",value:function(t,e,n,r){return this.a.fromBufferAttribute(t,e),this.b.fromBufferAttribute(t,n),this.c.fromBufferAttribute(t,r),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this}},{key:"getArea",value:function(){return gi.subVectors(this.c,this.b),bi.subVectors(this.a,this.b),.5*gi.cross(bi).length()}},{key:"getMidpoint",value:function(t){return t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}},{key:"getNormal",value:function(e){return t.getNormal(this.a,this.b,this.c,e)}},{key:"getPlane",value:function(t){return t.setFromCoplanarPoints(this.a,this.b,this.c)}},{key:"getBarycoord",value:function(e,n){return t.getBarycoord(e,this.a,this.b,this.c,n)}},{key:"getInterpolation",value:function(e,n,r,i,o){return t.getInterpolation(e,this.a,this.b,this.c,n,r,i,o)}},{key:"containsPoint",value:function(e){return t.containsPoint(e,this.a,this.b,this.c)}},{key:"isFrontFacing",value:function(e){return t.isFrontFacing(this.a,this.b,this.c,e)}},{key:"intersectsBox",value:function(t){return t.intersectsTriangle(this)}},{key:"closestPointToPoint",value:function(t,e){var n,r,i=this.a,o=this.b,a=this.c;wi.subVectors(o,i),Si.subVectors(a,i),Mi.subVectors(t,i);var s=wi.dot(Mi),u=Si.dot(Mi);if(s<=0&&u<=0)return e.copy(i);Ei.subVectors(t,o);var c=wi.dot(Ei),l=Si.dot(Ei);if(c>=0&&l<=c)return e.copy(o);var f=s*l-c*u;if(f<=0&&s>=0&&c<=0)return n=s/(s-c),e.copy(i).addScaledVector(wi,n);Ai.subVectors(t,a);var h=wi.dot(Ai),p=Si.dot(Ai);if(p>=0&&h<=p)return e.copy(a);var d=h*u-s*p;if(d<=0&&u>=0&&p<=0)return r=u/(u-p),e.copy(i).addScaledVector(Si,r);var m=c*p-h*l;if(m<=0&&l-c>=0&&h-p>=0)return Ti.subVectors(a,o),r=(l-c)/(l-c+(h-p)),e.copy(o).addScaledVector(Ti,r);var y=1/(m+d+f);return n=d*y,r=f*y,e.copy(i).addScaledVector(wi,n).addScaledVector(Si,r)}},{key:"equals",value:function(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)}}],[{key:"getNormal",value:function(t,e,n,r){r.subVectors(n,e),gi.subVectors(t,e),r.cross(gi);var i=r.lengthSq();return i>0?r.multiplyScalar(1/Math.sqrt(i)):r.set(0,0,0)}},{key:"getBarycoord",value:function(t,e,n,r,i){gi.subVectors(r,e),bi.subVectors(n,e),_i.subVectors(t,e);var o=gi.dot(gi),a=gi.dot(bi),s=gi.dot(_i),u=bi.dot(bi),c=bi.dot(_i),l=o*u-a*a;if(0===l)return i.set(0,0,0),null;var f=1/l,h=(u*s-a*c)*f,p=(o*c-a*s)*f;return i.set(1-h-p,p,h)}},{key:"containsPoint",value:function(t,e,n,r){return null!==this.getBarycoord(t,e,n,r,xi)&&xi.x>=0&&xi.y>=0&&xi.x+xi.y<=1}},{key:"getInterpolation",value:function(t,e,n,r,i,o,a,s){return null===this.getBarycoord(t,e,n,r,xi)?(s.x=0,s.y=0,"z"in s&&(s.z=0),"w"in s&&(s.w=0),null):(s.setScalar(0),s.addScaledVector(i,xi.x),s.addScaledVector(o,xi.y),s.addScaledVector(a,xi.z),s)}},{key:"isFrontFacing",value:function(t,e,n,r){return gi.subVectors(n,e),bi.subVectors(t,e),gi.cross(bi).dot(r)<0}}])}(),Pi={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Ri={h:0,s:0,l:0},ki={h:0,s:0,l:0};function Ci(t,e,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?t+6*(e-t)*n:n<.5?e:n<2/3?t+6*(e-t)*(2/3-n):t}var Ni=function(){return T((function t(e,n,r){return w(this,t),this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,n,r)}),[{key:"set",value:function(t,e,n){if(void 0===e&&void 0===n){var r=t;r&&r.isColor?this.copy(r):"number"==typeof r?this.setHex(r):"string"==typeof r&&this.setStyle(r)}else this.setRGB(t,e,n);return this}},{key:"setScalar",value:function(t){return this.r=t,this.g=t,this.b=t,this}},{key:"setHex",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Xe;return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(255&t)/255,tr.toWorkingColorSpace(this,e),this}},{key:"setRGB",value:function(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:tr.workingColorSpace;return this.r=t,this.g=e,this.b=n,tr.toWorkingColorSpace(this,r),this}},{key:"setHSL",value:function(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:tr.workingColorSpace;if(t=jn(t,1),e=Ln(e,0,1),n=Ln(n,0,1),0===e)this.r=this.g=this.b=n;else{var i=n<=.5?n*(1+e):n+e-n*e,o=2*n-i;this.r=Ci(o,i,t+1/3),this.g=Ci(o,i,t),this.b=Ci(o,i,t-1/3)}return tr.toWorkingColorSpace(this,r),this}},{key:"setStyle",value:function(t){var e,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Xe;function r(e){void 0!==e&&parseFloat(e)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}if(e=/^(\w+)\(([^\)]*)\)/.exec(t)){var i,o=e[1],a=e[2];switch(o){case"rgb":case"rgba":if(i=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return r(i[4]),this.setRGB(Math.min(255,parseInt(i[1],10))/255,Math.min(255,parseInt(i[2],10))/255,Math.min(255,parseInt(i[3],10))/255,n);if(i=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return r(i[4]),this.setRGB(Math.min(100,parseInt(i[1],10))/100,Math.min(100,parseInt(i[2],10))/100,Math.min(100,parseInt(i[3],10))/100,n);break;case"hsl":case"hsla":if(i=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return r(i[4]),this.setHSL(parseFloat(i[1])/360,parseFloat(i[2])/100,parseFloat(i[3])/100,n);break;default:console.warn("THREE.Color: Unknown color model "+t)}}else if(e=/^\#([A-Fa-f\d]+)$/.exec(t)){var s=e[1],u=s.length;if(3===u)return this.setRGB(parseInt(s.charAt(0),16)/15,parseInt(s.charAt(1),16)/15,parseInt(s.charAt(2),16)/15,n);if(6===u)return this.setHex(parseInt(s,16),n);console.warn("THREE.Color: Invalid hex color "+t)}else if(t&&t.length>0)return this.setColorName(t,n);return this}},{key:"setColorName",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Xe,n=Pi[t.toLowerCase()];return void 0!==n?this.setHex(n,e):console.warn("THREE.Color: Unknown color "+t),this}},{key:"clone",value:function(){return new this.constructor(this.r,this.g,this.b)}},{key:"copy",value:function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this}},{key:"copySRGBToLinear",value:function(t){return this.r=er(t.r),this.g=er(t.g),this.b=er(t.b),this}},{key:"copyLinearToSRGB",value:function(t){return this.r=nr(t.r),this.g=nr(t.g),this.b=nr(t.b),this}},{key:"convertSRGBToLinear",value:function(){return this.copySRGBToLinear(this),this}},{key:"convertLinearToSRGB",value:function(){return this.copyLinearToSRGB(this),this}},{key:"getHex",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Xe;return tr.fromWorkingColorSpace(Li.copy(this),t),65536*Math.round(Ln(255*Li.r,0,255))+256*Math.round(Ln(255*Li.g,0,255))+Math.round(Ln(255*Li.b,0,255))}},{key:"getHexString",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Xe;return("000000"+this.getHex(t).toString(16)).slice(-6)}},{key:"getHSL",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:tr.workingColorSpace;tr.fromWorkingColorSpace(Li.copy(this),e);var n,r,i=Li.r,o=Li.g,a=Li.b,s=Math.max(i,o,a),u=Math.min(i,o,a),c=(u+s)/2;if(u===s)n=0,r=0;else{var l=s-u;switch(r=c<=.5?l/(s+u):l/(2-s-u),s){case i:n=(o-a)/l+(o<a?6:0);break;case o:n=(a-i)/l+2;break;case a:n=(i-o)/l+4}n/=6}return t.h=n,t.s=r,t.l=c,t}},{key:"getRGB",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:tr.workingColorSpace;return tr.fromWorkingColorSpace(Li.copy(this),e),t.r=Li.r,t.g=Li.g,t.b=Li.b,t}},{key:"getStyle",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Xe;tr.fromWorkingColorSpace(Li.copy(this),t);var e=Li.r,n=Li.g,r=Li.b;return t!==Xe?"color(".concat(t," ").concat(e.toFixed(3)," ").concat(n.toFixed(3)," ").concat(r.toFixed(3),")"):"rgb(".concat(Math.round(255*e),",").concat(Math.round(255*n),",").concat(Math.round(255*r),")")}},{key:"offsetHSL",value:function(t,e,n){return this.getHSL(Ri),this.setHSL(Ri.h+t,Ri.s+e,Ri.l+n)}},{key:"add",value:function(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this}},{key:"addColors",value:function(t,e){return this.r=t.r+e.r,this.g=t.g+e.g,this.b=t.b+e.b,this}},{key:"addScalar",value:function(t){return this.r+=t,this.g+=t,this.b+=t,this}},{key:"sub",value:function(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this}},{key:"multiply",value:function(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this}},{key:"multiplyScalar",value:function(t){return this.r*=t,this.g*=t,this.b*=t,this}},{key:"lerp",value:function(t,e){return this.r+=(t.r-this.r)*e,this.g+=(t.g-this.g)*e,this.b+=(t.b-this.b)*e,this}},{key:"lerpColors",value:function(t,e,n){return this.r=t.r+(e.r-t.r)*n,this.g=t.g+(e.g-t.g)*n,this.b=t.b+(e.b-t.b)*n,this}},{key:"lerpHSL",value:function(t,e){this.getHSL(Ri),t.getHSL(ki);var n=In(Ri.h,ki.h,e),r=In(Ri.s,ki.s,e),i=In(Ri.l,ki.l,e);return this.setHSL(n,r,i),this}},{key:"setFromVector3",value:function(t){return this.r=t.x,this.g=t.y,this.b=t.z,this}},{key:"applyMatrix3",value:function(t){var e=this.r,n=this.g,r=this.b,i=t.elements;return this.r=i[0]*e+i[3]*n+i[6]*r,this.g=i[1]*e+i[4]*n+i[7]*r,this.b=i[2]*e+i[5]*n+i[8]*r,this}},{key:"equals",value:function(t){return t.r===this.r&&t.g===this.g&&t.b===this.b}},{key:"fromArray",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.r=t[e],this.g=t[e+1],this.b=t[e+2],this}},{key:"toArray",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t[e]=this.r,t[e+1]=this.g,t[e+2]=this.b,t}},{key:"fromBufferAttribute",value:function(t,e){return this.r=t.getX(e),this.g=t.getY(e),this.b=t.getZ(e),this}},{key:"toJSON",value:function(){return this.getHex()}},{key:Symbol.iterator,value:_().mark((function t(){return _().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.r;case 2:return t.next=4,this.g;case 4:return t.next=6,this.b;case 6:case"end":return t.stop()}}),t,this)}))}])}(),Li=new Ni;Ni.NAMES=Pi;var ji=0,Ii=function(t){function e(){var t;return w(this,e),(t=d(this,e)).isMaterial=!0,Object.defineProperty(t,"id",{value:ji++}),t.uuid=Nn(),t.name="",t.type="Material",t.blending=I,t.side=C,t.vertexColors=!1,t.opacity=1,t.transparent=!1,t.alphaHash=!1,t.blendSrc=Z,t.blendDst=K,t.blendEquation=z,t.blendSrcAlpha=null,t.blendDstAlpha=null,t.blendEquationAlpha=null,t.blendColor=new Ni(0,0,0),t.blendAlpha=0,t.depthFunc=at,t.depthTest=!0,t.depthWrite=!0,t.stencilWriteMask=255,t.stencilFunc=mn,t.stencilRef=0,t.stencilFuncMask=255,t.stencilFail=tn,t.stencilZFail=tn,t.stencilZPass=tn,t.stencilWrite=!1,t.clippingPlanes=null,t.clipIntersection=!1,t.clipShadows=!1,t.shadowSide=null,t.colorWrite=!0,t.precision=null,t.polygonOffset=!1,t.polygonOffsetFactor=0,t.polygonOffsetUnits=0,t.dithering=!1,t.alphaToCoverage=!1,t.premultipliedAlpha=!1,t.forceSinglePass=!1,t.visible=!0,t.toneMapped=!0,t.userData={},t.version=0,t._alphaTest=0,t}return v(e,t),T(e,[{key:"alphaTest",get:function(){return this._alphaTest},set:function(t){this._alphaTest>0!=t>0&&this.version++,this._alphaTest=t}},{key:"onBuild",value:function(){}},{key:"onBeforeRender",value:function(){}},{key:"onBeforeCompile",value:function(){}},{key:"customProgramCacheKey",value:function(){return this.onBeforeCompile.toString()}},{key:"setValues",value:function(t){if(void 0!==t)for(var e in t){var n=t[e];if(void 0!==n){var r=this[e];void 0!==r?r&&r.isColor?r.set(n):r&&r.isVector3&&n&&n.isVector3?r.copy(n):this[e]=n:console.warn("THREE.Material: '".concat(e,"' is not a property of THREE.").concat(this.type,"."))}else console.warn("THREE.Material: parameter '".concat(e,"' has value of undefined."))}}},{key:"toJSON",value:function(t){var e=void 0===t||"string"==typeof t;e&&(t={textures:{},images:{}});var n={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};function r(t){var e=[];for(var n in t){var r=t[n];delete r.metadata,e.push(r)}return e}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),void 0!==this.roughness&&(n.roughness=this.roughness),void 0!==this.metalness&&(n.metalness=this.metalness),void 0!==this.sheen&&(n.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(n.sheenColor=this.sheenColor.getHex()),void 0!==this.sheenRoughness&&(n.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),void 0!==this.emissiveIntensity&&1!==this.emissiveIntensity&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),void 0!==this.specularIntensity&&(n.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(n.specularColor=this.specularColor.getHex()),void 0!==this.shininess&&(n.shininess=this.shininess),void 0!==this.clearcoat&&(n.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(t).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(t).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(t).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),void 0!==this.iridescence&&(n.iridescence=this.iridescence),void 0!==this.iridescenceIOR&&(n.iridescenceIOR=this.iridescenceIOR),void 0!==this.iridescenceThicknessRange&&(n.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(n.iridescenceMap=this.iridescenceMap.toJSON(t).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(n.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(t).uuid),void 0!==this.anisotropy&&(n.anisotropy=this.anisotropy),void 0!==this.anisotropyRotation&&(n.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(n.anisotropyMap=this.anisotropyMap.toJSON(t).uuid),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(t).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(t).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(t).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(t).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(t).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(t).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(t).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(t).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(t).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(t).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(t).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(t).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(n.specularIntensityMap=this.specularIntensityMap.toJSON(t).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(n.specularColorMap=this.specularColorMap.toJSON(t).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(t).uuid,void 0!==this.combine&&(n.combine=this.combine)),void 0!==this.envMapRotation&&(n.envMapRotation=this.envMapRotation.toArray()),void 0!==this.envMapIntensity&&(n.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(n.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(n.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(t).uuid),void 0!==this.transmission&&(n.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(n.transmissionMap=this.transmissionMap.toJSON(t).uuid),void 0!==this.thickness&&(n.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(n.thicknessMap=this.thicknessMap.toJSON(t).uuid),void 0!==this.attenuationDistance&&this.attenuationDistance!==1/0&&(n.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationColor&&(n.attenuationColor=this.attenuationColor.getHex()),void 0!==this.size&&(n.size=this.size),null!==this.shadowSide&&(n.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(n.sizeAttenuation=this.sizeAttenuation),this.blending!==I&&(n.blending=this.blending),this.side!==C&&(n.side=this.side),!0===this.vertexColors&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),!0===this.transparent&&(n.transparent=!0),this.blendSrc!==Z&&(n.blendSrc=this.blendSrc),this.blendDst!==K&&(n.blendDst=this.blendDst),this.blendEquation!==z&&(n.blendEquation=this.blendEquation),null!==this.blendSrcAlpha&&(n.blendSrcAlpha=this.blendSrcAlpha),null!==this.blendDstAlpha&&(n.blendDstAlpha=this.blendDstAlpha),null!==this.blendEquationAlpha&&(n.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(n.blendColor=this.blendColor.getHex()),0!==this.blendAlpha&&(n.blendAlpha=this.blendAlpha),this.depthFunc!==at&&(n.depthFunc=this.depthFunc),!1===this.depthTest&&(n.depthTest=this.depthTest),!1===this.depthWrite&&(n.depthWrite=this.depthWrite),!1===this.colorWrite&&(n.colorWrite=this.colorWrite),255!==this.stencilWriteMask&&(n.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==mn&&(n.stencilFunc=this.stencilFunc),0!==this.stencilRef&&(n.stencilRef=this.stencilRef),255!==this.stencilFuncMask&&(n.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==tn&&(n.stencilFail=this.stencilFail),this.stencilZFail!==tn&&(n.stencilZFail=this.stencilZFail),this.stencilZPass!==tn&&(n.stencilZPass=this.stencilZPass),!0===this.stencilWrite&&(n.stencilWrite=this.stencilWrite),void 0!==this.rotation&&0!==this.rotation&&(n.rotation=this.rotation),!0===this.polygonOffset&&(n.polygonOffset=!0),0!==this.polygonOffsetFactor&&(n.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(n.polygonOffsetUnits=this.polygonOffsetUnits),void 0!==this.linewidth&&1!==this.linewidth&&(n.linewidth=this.linewidth),void 0!==this.dashSize&&(n.dashSize=this.dashSize),void 0!==this.gapSize&&(n.gapSize=this.gapSize),void 0!==this.scale&&(n.scale=this.scale),!0===this.dithering&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),!0===this.alphaHash&&(n.alphaHash=!0),!0===this.alphaToCoverage&&(n.alphaToCoverage=!0),!0===this.premultipliedAlpha&&(n.premultipliedAlpha=!0),!0===this.forceSinglePass&&(n.forceSinglePass=!0),!0===this.wireframe&&(n.wireframe=!0),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(n.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(n.wireframeLinejoin=this.wireframeLinejoin),!0===this.flatShading&&(n.flatShading=!0),!1===this.visible&&(n.visible=!1),!1===this.toneMapped&&(n.toneMapped=!1),!1===this.fog&&(n.fog=!1),Object.keys(this.userData).length>0&&(n.userData=this.userData),e){var i=r(t.textures),o=r(t.images);i.length>0&&(n.textures=i),o.length>0&&(n.images=o)}return n}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(t){this.name=t.name,this.blending=t.blending,this.side=t.side,this.vertexColors=t.vertexColors,this.opacity=t.opacity,this.transparent=t.transparent,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendEquation=t.blendEquation,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.blendEquationAlpha=t.blendEquationAlpha,this.blendColor.copy(t.blendColor),this.blendAlpha=t.blendAlpha,this.depthFunc=t.depthFunc,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.stencilWriteMask=t.stencilWriteMask,this.stencilFunc=t.stencilFunc,this.stencilRef=t.stencilRef,this.stencilFuncMask=t.stencilFuncMask,this.stencilFail=t.stencilFail,this.stencilZFail=t.stencilZFail,this.stencilZPass=t.stencilZPass,this.stencilWrite=t.stencilWrite;var e=t.clippingPlanes,n=null;if(null!==e){var r=e.length;n=new Array(r);for(var i=0;i!==r;++i)n[i]=e[i].clone()}return this.clippingPlanes=n,this.clipIntersection=t.clipIntersection,this.clipShadows=t.clipShadows,this.shadowSide=t.shadowSide,this.colorWrite=t.colorWrite,this.precision=t.precision,this.polygonOffset=t.polygonOffset,this.polygonOffsetFactor=t.polygonOffsetFactor,this.polygonOffsetUnits=t.polygonOffsetUnits,this.dithering=t.dithering,this.alphaTest=t.alphaTest,this.alphaHash=t.alphaHash,this.alphaToCoverage=t.alphaToCoverage,this.premultipliedAlpha=t.premultipliedAlpha,this.forceSinglePass=t.forceSinglePass,this.visible=t.visible,this.toneMapped=t.toneMapped,this.userData=JSON.parse(JSON.stringify(t.userData)),this}},{key:"dispose",value:function(){this.dispatchEvent({type:"dispose"})}},{key:"needsUpdate",set:function(t){!0===t&&this.version++}}])}(On),Bi=function(t){function e(t){var n;return w(this,e),(n=d(this,e)).isMeshBasicMaterial=!0,n.type="MeshBasicMaterial",n.color=new Ni(16777215),n.map=null,n.lightMap=null,n.lightMapIntensity=1,n.aoMap=null,n.aoMapIntensity=1,n.specularMap=null,n.alphaMap=null,n.envMap=null,n.envMapRotation=new ti,n.combine=ft,n.reflectivity=1,n.refractionRatio=.98,n.wireframe=!1,n.wireframeLinewidth=1,n.wireframeLinecap="round",n.wireframeLinejoin="round",n.fog=!0,n.setValues(t),n}return v(e,t),T(e,[{key:"copy",value:function(t){return l(y(e.prototype),"copy",this).call(this,t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapRotation.copy(t.envMapRotation),this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.fog=t.fog,this}}])}(Ii),Ui=Di();function Di(){for(var t=new ArrayBuffer(4),e=new Float32Array(t),n=new Uint32Array(t),r=new Uint32Array(512),i=new Uint32Array(512),o=0;o<256;++o){var a=o-127;a<-27?(r[o]=0,r[256|o]=32768,i[o]=24,i[256|o]=24):a<-14?(r[o]=1024>>-a-14,r[256|o]=1024>>-a-14|32768,i[o]=-a-1,i[256|o]=-a-1):a<=15?(r[o]=a+15<<10,r[256|o]=a+15<<10|32768,i[o]=13,i[256|o]=13):a<128?(r[o]=31744,r[256|o]=64512,i[o]=24,i[256|o]=24):(r[o]=31744,r[256|o]=64512,i[o]=13,i[256|o]=13)}for(var s=new Uint32Array(2048),u=new Uint32Array(64),c=new Uint32Array(64),l=1;l<1024;++l){for(var f=l<<13,h=0;!(8388608&f);)f<<=1,h-=8388608;f&=-8388609,h+=947912704,s[l]=f|h}for(var p=1024;p<2048;++p)s[p]=939524096+(p-1024<<13);for(var d=1;d<31;++d)u[d]=d<<23;u[31]=1199570944,u[32]=2147483648;for(var m=33;m<63;++m)u[m]=2147483648+(m-32<<23);u[63]=3347054592;for(var y=1;y<64;++y)32!==y&&(c[y]=1024);return{floatView:e,uint32View:n,baseTable:r,shiftTable:i,mantissaTable:s,exponentTable:u,offsetTable:c}}function Fi(t){Math.abs(t)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),t=Ln(t,-65504,65504),Ui.floatView[0]=t;var e=Ui.uint32View[0],n=e>>23&511;return Ui.baseTable[n]+((8388607&e)>>Ui.shiftTable[n])}function zi(t){var e=t>>10;return Ui.uint32View[0]=Ui.mantissaTable[Ui.offsetTable[e]+(1023&t)]+Ui.exponentTable[e],Ui.floatView[0]}var Vi=new dr,Gi=new Fn,Hi=function(){return T((function t(e,n){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(w(this,t),Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=e,this.itemSize=n,this.count=void 0!==e?e.length/n:0,this.normalized=r,this.usage=Tn,this._updateRange={offset:0,count:-1},this.updateRanges=[],this.gpuType=zt,this.version=0}),[{key:"onUploadCallback",value:function(){}},{key:"needsUpdate",set:function(t){!0===t&&this.version++}},{key:"updateRange",get:function(){return Yn("THREE.BufferAttribute: updateRange() is deprecated and will be removed in r169. Use addUpdateRange() instead."),this._updateRange}},{key:"setUsage",value:function(t){return this.usage=t,this}},{key:"addUpdateRange",value:function(t,e){this.updateRanges.push({start:t,count:e})}},{key:"clearUpdateRanges",value:function(){this.updateRanges.length=0}},{key:"copy",value:function(t){return this.name=t.name,this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.usage=t.usage,this.gpuType=t.gpuType,this}},{key:"copyAt",value:function(t,e,n){t*=this.itemSize,n*=e.itemSize;for(var r=0,i=this.itemSize;r<i;r++)this.array[t+r]=e.array[n+r];return this}},{key:"copyArray",value:function(t){return this.array.set(t),this}},{key:"applyMatrix3",value:function(t){if(2===this.itemSize)for(var e=0,n=this.count;e<n;e++)Gi.fromBufferAttribute(this,e),Gi.applyMatrix3(t),this.setXY(e,Gi.x,Gi.y);else if(3===this.itemSize)for(var r=0,i=this.count;r<i;r++)Vi.fromBufferAttribute(this,r),Vi.applyMatrix3(t),this.setXYZ(r,Vi.x,Vi.y,Vi.z);return this}},{key:"applyMatrix4",value:function(t){for(var e=0,n=this.count;e<n;e++)Vi.fromBufferAttribute(this,e),Vi.applyMatrix4(t),this.setXYZ(e,Vi.x,Vi.y,Vi.z);return this}},{key:"applyNormalMatrix",value:function(t){for(var e=0,n=this.count;e<n;e++)Vi.fromBufferAttribute(this,e),Vi.applyNormalMatrix(t),this.setXYZ(e,Vi.x,Vi.y,Vi.z);return this}},{key:"transformDirection",value:function(t){for(var e=0,n=this.count;e<n;e++)Vi.fromBufferAttribute(this,e),Vi.transformDirection(t),this.setXYZ(e,Vi.x,Vi.y,Vi.z);return this}},{key:"set",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.array.set(t,e),this}},{key:"getComponent",value:function(t,e){var n=this.array[t*this.itemSize+e];return this.normalized&&(n=Bn(n,this.array)),n}},{key:"setComponent",value:function(t,e,n){return this.normalized&&(n=Un(n,this.array)),this.array[t*this.itemSize+e]=n,this}},{key:"getX",value:function(t){var e=this.array[t*this.itemSize];return this.normalized&&(e=Bn(e,this.array)),e}},{key:"setX",value:function(t,e){return this.normalized&&(e=Un(e,this.array)),this.array[t*this.itemSize]=e,this}},{key:"getY",value:function(t){var e=this.array[t*this.itemSize+1];return this.normalized&&(e=Bn(e,this.array)),e}},{key:"setY",value:function(t,e){return this.normalized&&(e=Un(e,this.array)),this.array[t*this.itemSize+1]=e,this}},{key:"getZ",value:function(t){var e=this.array[t*this.itemSize+2];return this.normalized&&(e=Bn(e,this.array)),e}},{key:"setZ",value:function(t,e){return this.normalized&&(e=Un(e,this.array)),this.array[t*this.itemSize+2]=e,this}},{key:"getW",value:function(t){var e=this.array[t*this.itemSize+3];return this.normalized&&(e=Bn(e,this.array)),e}},{key:"setW",value:function(t,e){return this.normalized&&(e=Un(e,this.array)),this.array[t*this.itemSize+3]=e,this}},{key:"setXY",value:function(t,e,n){return t*=this.itemSize,this.normalized&&(e=Un(e,this.array),n=Un(n,this.array)),this.array[t+0]=e,this.array[t+1]=n,this}},{key:"setXYZ",value:function(t,e,n,r){return t*=this.itemSize,this.normalized&&(e=Un(e,this.array),n=Un(n,this.array),r=Un(r,this.array)),this.array[t+0]=e,this.array[t+1]=n,this.array[t+2]=r,this}},{key:"setXYZW",value:function(t,e,n,r,i){return t*=this.itemSize,this.normalized&&(e=Un(e,this.array),n=Un(n,this.array),r=Un(r,this.array),i=Un(i,this.array)),this.array[t+0]=e,this.array[t+1]=n,this.array[t+2]=r,this.array[t+3]=i,this}},{key:"onUpload",value:function(t){return this.onUploadCallback=t,this}},{key:"clone",value:function(){return new this.constructor(this.array,this.itemSize).copy(this)}},{key:"toJSON",value:function(){var t={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return""!==this.name&&(t.name=this.name),this.usage!==Tn&&(t.usage=this.usage),t}}])}(),Wi=function(t){function e(t,n,r){return w(this,e),d(this,e,[new Uint16Array(t),n,r])}return v(e,t),T(e)}(Hi),qi=function(t){function e(t,n,r){return w(this,e),d(this,e,[new Uint32Array(t),n,r])}return v(e,t),T(e)}(Hi),Xi=function(t){function e(t,n,r){var i;return w(this,e),(i=d(this,e,[new Uint16Array(t),n,r])).isFloat16BufferAttribute=!0,i}return v(e,t),T(e,[{key:"getX",value:function(t){var e=zi(this.array[t*this.itemSize]);return this.normalized&&(e=Bn(e,this.array)),e}},{key:"setX",value:function(t,e){return this.normalized&&(e=Un(e,this.array)),this.array[t*this.itemSize]=Fi(e),this}},{key:"getY",value:function(t){var e=zi(this.array[t*this.itemSize+1]);return this.normalized&&(e=Bn(e,this.array)),e}},{key:"setY",value:function(t,e){return this.normalized&&(e=Un(e,this.array)),this.array[t*this.itemSize+1]=Fi(e),this}},{key:"getZ",value:function(t){var e=zi(this.array[t*this.itemSize+2]);return this.normalized&&(e=Bn(e,this.array)),e}},{key:"setZ",value:function(t,e){return this.normalized&&(e=Un(e,this.array)),this.array[t*this.itemSize+2]=Fi(e),this}},{key:"getW",value:function(t){var e=zi(this.array[t*this.itemSize+3]);return this.normalized&&(e=Bn(e,this.array)),e}},{key:"setW",value:function(t,e){return this.normalized&&(e=Un(e,this.array)),this.array[t*this.itemSize+3]=Fi(e),this}},{key:"setXY",value:function(t,e,n){return t*=this.itemSize,this.normalized&&(e=Un(e,this.array),n=Un(n,this.array)),this.array[t+0]=Fi(e),this.array[t+1]=Fi(n),this}},{key:"setXYZ",value:function(t,e,n,r){return t*=this.itemSize,this.normalized&&(e=Un(e,this.array),n=Un(n,this.array),r=Un(r,this.array)),this.array[t+0]=Fi(e),this.array[t+1]=Fi(n),this.array[t+2]=Fi(r),this}},{key:"setXYZW",value:function(t,e,n,r,i){return t*=this.itemSize,this.normalized&&(e=Un(e,this.array),n=Un(n,this.array),r=Un(r,this.array),i=Un(i,this.array)),this.array[t+0]=Fi(e),this.array[t+1]=Fi(n),this.array[t+2]=Fi(r),this.array[t+3]=Fi(i),this}}])}(Hi),Yi=function(t){function e(t,n,r){return w(this,e),d(this,e,[new Float32Array(t),n,r])}return v(e,t),T(e)}(Hi),Ji=0,Zi=new Hr,Ki=new vi,Qi=new dr,$i=new vr,to=new vr,eo=new dr,no=function(t){function e(){var t;return w(this,e),(t=d(this,e)).isBufferGeometry=!0,Object.defineProperty(t,"id",{value:Ji++}),t.uuid=Nn(),t.name="",t.type="BufferGeometry",t.index=null,t.attributes={},t.morphAttributes={},t.morphTargetsRelative=!1,t.groups=[],t.boundingBox=null,t.boundingSphere=null,t.drawRange={start:0,count:1/0},t.userData={},t}return v(e,t),T(e,[{key:"getIndex",value:function(){return this.index}},{key:"setIndex",value:function(t){return Array.isArray(t)?this.index=new(function(t){for(var e=t.length-1;e>=0;--e)if(t[e]>=65535)return!0;return!1}(t)?qi:Wi)(t,1):this.index=t,this}},{key:"getAttribute",value:function(t){return this.attributes[t]}},{key:"setAttribute",value:function(t,e){return this.attributes[t]=e,this}},{key:"deleteAttribute",value:function(t){return delete this.attributes[t],this}},{key:"hasAttribute",value:function(t){return void 0!==this.attributes[t]}},{key:"addGroup",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.groups.push({start:t,count:e,materialIndex:n})}},{key:"clearGroups",value:function(){this.groups=[]}},{key:"setDrawRange",value:function(t,e){this.drawRange.start=t,this.drawRange.count=e}},{key:"applyMatrix4",value:function(t){var e=this.attributes.position;void 0!==e&&(e.applyMatrix4(t),e.needsUpdate=!0);var n=this.attributes.normal;if(void 0!==n){var r=(new zn).getNormalMatrix(t);n.applyNormalMatrix(r),n.needsUpdate=!0}var i=this.attributes.tangent;return void 0!==i&&(i.transformDirection(t),i.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}},{key:"applyQuaternion",value:function(t){return Zi.makeRotationFromQuaternion(t),this.applyMatrix4(Zi),this}},{key:"rotateX",value:function(t){return Zi.makeRotationX(t),this.applyMatrix4(Zi),this}},{key:"rotateY",value:function(t){return Zi.makeRotationY(t),this.applyMatrix4(Zi),this}},{key:"rotateZ",value:function(t){return Zi.makeRotationZ(t),this.applyMatrix4(Zi),this}},{key:"translate",value:function(t,e,n){return Zi.makeTranslation(t,e,n),this.applyMatrix4(Zi),this}},{key:"scale",value:function(t,e,n){return Zi.makeScale(t,e,n),this.applyMatrix4(Zi),this}},{key:"lookAt",value:function(t){return Ki.lookAt(t),Ki.updateMatrix(),this.applyMatrix4(Ki.matrix),this}},{key:"center",value:function(){return this.computeBoundingBox(),this.boundingBox.getCenter(Qi).negate(),this.translate(Qi.x,Qi.y,Qi.z),this}},{key:"setFromPoints",value:function(t){for(var e=[],n=0,r=t.length;n<r;n++){var i=t[n];e.push(i.x,i.y,i.z||0)}return this.setAttribute("position",new Yi(e,3)),this}},{key:"computeBoundingBox",value:function(){null===this.boundingBox&&(this.boundingBox=new vr);var t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute)return console.error("THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),void this.boundingBox.set(new dr(-1/0,-1/0,-1/0),new dr(1/0,1/0,1/0));if(void 0!==t){if(this.boundingBox.setFromBufferAttribute(t),e)for(var n=0,r=e.length;n<r;n++){var i=e[n];$i.setFromBufferAttribute(i),this.morphTargetsRelative?(eo.addVectors(this.boundingBox.min,$i.min),this.boundingBox.expandByPoint(eo),eo.addVectors(this.boundingBox.max,$i.max),this.boundingBox.expandByPoint(eo)):(this.boundingBox.expandByPoint($i.min),this.boundingBox.expandByPoint($i.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}},{key:"computeBoundingSphere",value:function(){null===this.boundingSphere&&(this.boundingSphere=new jr);var t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute)return console.error("THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),void this.boundingSphere.set(new dr,1/0);if(t){var n=this.boundingSphere.center;if($i.setFromBufferAttribute(t),e)for(var r=0,i=e.length;r<i;r++){var o=e[r];to.setFromBufferAttribute(o),this.morphTargetsRelative?(eo.addVectors($i.min,to.min),$i.expandByPoint(eo),eo.addVectors($i.max,to.max),$i.expandByPoint(eo)):($i.expandByPoint(to.min),$i.expandByPoint(to.max))}$i.getCenter(n);for(var a=0,s=0,u=t.count;s<u;s++)eo.fromBufferAttribute(t,s),a=Math.max(a,n.distanceToSquared(eo));if(e)for(var c=0,l=e.length;c<l;c++)for(var f=e[c],h=this.morphTargetsRelative,p=0,d=f.count;p<d;p++)eo.fromBufferAttribute(f,p),h&&(Qi.fromBufferAttribute(t,p),eo.add(Qi)),a=Math.max(a,n.distanceToSquared(eo));this.boundingSphere.radius=Math.sqrt(a),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}},{key:"computeTangents",value:function(){var t=this.index,e=this.attributes;if(null!==t&&void 0!==e.position&&void 0!==e.normal&&void 0!==e.uv){var n=e.position,r=e.normal,i=e.uv;!1===this.hasAttribute("tangent")&&this.setAttribute("tangent",new Hi(new Float32Array(4*n.count),4));for(var o=this.getAttribute("tangent"),a=[],s=[],u=0;u<n.count;u++)a[u]=new dr,s[u]=new dr;var c=new dr,l=new dr,f=new dr,h=new Fn,p=new Fn,d=new Fn,m=new dr,y=new dr,v=this.groups;0===v.length&&(v=[{start:0,count:t.count}]);for(var g=0,b=v.length;g<b;++g)for(var _=v[g],x=_.start,w=x,S=x+_.count;w<S;w+=3)L(t.getX(w+0),t.getX(w+1),t.getX(w+2));for(var T=new dr,M=new dr,E=new dr,A=new dr,O=0,P=v.length;O<P;++O)for(var R=v[O],k=R.start,C=k,N=k+R.count;C<N;C+=3)j(t.getX(C+0)),j(t.getX(C+1)),j(t.getX(C+2))}else console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");function L(t,e,r){c.fromBufferAttribute(n,t),l.fromBufferAttribute(n,e),f.fromBufferAttribute(n,r),h.fromBufferAttribute(i,t),p.fromBufferAttribute(i,e),d.fromBufferAttribute(i,r),l.sub(c),f.sub(c),p.sub(h),d.sub(h);var o=1/(p.x*d.y-d.x*p.y);isFinite(o)&&(m.copy(l).multiplyScalar(d.y).addScaledVector(f,-p.y).multiplyScalar(o),y.copy(f).multiplyScalar(p.x).addScaledVector(l,-d.x).multiplyScalar(o),a[t].add(m),a[e].add(m),a[r].add(m),s[t].add(y),s[e].add(y),s[r].add(y))}function j(t){E.fromBufferAttribute(r,t),A.copy(E);var e=a[t];T.copy(e),T.sub(E.multiplyScalar(E.dot(e))).normalize(),M.crossVectors(A,e);var n=M.dot(s[t])<0?-1:1;o.setXYZW(t,T.x,T.y,T.z,n)}}},{key:"computeVertexNormals",value:function(){var t=this.index,e=this.getAttribute("position");if(void 0!==e){var n=this.getAttribute("normal");if(void 0===n)n=new Hi(new Float32Array(3*e.count),3),this.setAttribute("normal",n);else for(var r=0,i=n.count;r<i;r++)n.setXYZ(r,0,0,0);var o=new dr,a=new dr,s=new dr,u=new dr,c=new dr,l=new dr,f=new dr,h=new dr;if(t)for(var p=0,d=t.count;p<d;p+=3){var m=t.getX(p+0),y=t.getX(p+1),v=t.getX(p+2);o.fromBufferAttribute(e,m),a.fromBufferAttribute(e,y),s.fromBufferAttribute(e,v),f.subVectors(s,a),h.subVectors(o,a),f.cross(h),u.fromBufferAttribute(n,m),c.fromBufferAttribute(n,y),l.fromBufferAttribute(n,v),u.add(f),c.add(f),l.add(f),n.setXYZ(m,u.x,u.y,u.z),n.setXYZ(y,c.x,c.y,c.z),n.setXYZ(v,l.x,l.y,l.z)}else for(var g=0,b=e.count;g<b;g+=3)o.fromBufferAttribute(e,g+0),a.fromBufferAttribute(e,g+1),s.fromBufferAttribute(e,g+2),f.subVectors(s,a),h.subVectors(o,a),f.cross(h),n.setXYZ(g+0,f.x,f.y,f.z),n.setXYZ(g+1,f.x,f.y,f.z),n.setXYZ(g+2,f.x,f.y,f.z);this.normalizeNormals(),n.needsUpdate=!0}}},{key:"normalizeNormals",value:function(){for(var t=this.attributes.normal,e=0,n=t.count;e<n;e++)eo.fromBufferAttribute(t,e),eo.normalize(),t.setXYZ(e,eo.x,eo.y,eo.z)}},{key:"toNonIndexed",value:function(){function t(t,e){for(var n=t.array,r=t.itemSize,i=t.normalized,o=new n.constructor(e.length*r),a=0,s=0,u=0,c=e.length;u<c;u++){a=t.isInterleavedBufferAttribute?e[u]*t.data.stride+t.offset:e[u]*r;for(var l=0;l<r;l++)o[s++]=n[a++]}return new Hi(o,r,i)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;var n=new e,r=this.index.array,i=this.attributes;for(var o in i){var a=t(i[o],r);n.setAttribute(o,a)}var s=this.morphAttributes;for(var u in s){for(var c=[],l=s[u],f=0,h=l.length;f<h;f++){var p=t(l[f],r);c.push(p)}n.morphAttributes[u]=c}n.morphTargetsRelative=this.morphTargetsRelative;for(var d=this.groups,m=0,y=d.length;m<y;m++){var v=d[m];n.addGroup(v.start,v.count,v.materialIndex)}return n}},{key:"toJSON",value:function(){var t={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,""!==this.name&&(t.name=this.name),Object.keys(this.userData).length>0&&(t.userData=this.userData),void 0!==this.parameters){var e=this.parameters;for(var n in e)void 0!==e[n]&&(t[n]=e[n]);return t}t.data={attributes:{}};var r=this.index;null!==r&&(t.data.index={type:r.array.constructor.name,array:Array.prototype.slice.call(r.array)});var i=this.attributes;for(var o in i){var a=i[o];t.data.attributes[o]=a.toJSON(t.data)}var s={},u=!1;for(var c in this.morphAttributes){for(var l=this.morphAttributes[c],f=[],h=0,p=l.length;h<p;h++){var d=l[h];f.push(d.toJSON(t.data))}f.length>0&&(s[c]=f,u=!0)}u&&(t.data.morphAttributes=s,t.data.morphTargetsRelative=this.morphTargetsRelative);var m=this.groups;m.length>0&&(t.data.groups=JSON.parse(JSON.stringify(m)));var y=this.boundingSphere;return null!==y&&(t.data.boundingSphere={center:y.center.toArray(),radius:y.radius}),t}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(t){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;var e={};this.name=t.name;var n=t.index;null!==n&&this.setIndex(n.clone(e));var r=t.attributes;for(var i in r){var o=r[i];this.setAttribute(i,o.clone(e))}var a=t.morphAttributes;for(var s in a){for(var u=[],c=a[s],l=0,f=c.length;l<f;l++)u.push(c[l].clone(e));this.morphAttributes[s]=u}this.morphTargetsRelative=t.morphTargetsRelative;for(var h=t.groups,p=0,d=h.length;p<d;p++){var m=h[p];this.addGroup(m.start,m.count,m.materialIndex)}var y=t.boundingBox;null!==y&&(this.boundingBox=y.clone());var v=t.boundingSphere;return null!==v&&(this.boundingSphere=v.clone()),this.drawRange.start=t.drawRange.start,this.drawRange.count=t.drawRange.count,this.userData=t.userData,this}},{key:"dispose",value:function(){this.dispatchEvent({type:"dispose"})}}])}(On),ro=new Hr,io=new Gr,oo=new jr,ao=new dr,so=new dr,uo=new dr,co=new dr,lo=new dr,fo=new dr,ho=new Fn,po=new Fn,mo=new Fn,yo=new dr,vo=new dr,go=new dr,bo=new dr,_o=new dr,xo=function(t){function e(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new no,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Bi;return w(this,e),(t=d(this,e)).isMesh=!0,t.type="Mesh",t.geometry=n,t.material=r,t.updateMorphTargets(),t}return v(e,t),T(e,[{key:"copy",value:function(t,n){return l(y(e.prototype),"copy",this).call(this,t,n),void 0!==t.morphTargetInfluences&&(this.morphTargetInfluences=t.morphTargetInfluences.slice()),void 0!==t.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},t.morphTargetDictionary)),this.material=Array.isArray(t.material)?t.material.slice():t.material,this.geometry=t.geometry,this}},{key:"updateMorphTargets",value:function(){var t=this.geometry.morphAttributes,e=Object.keys(t);if(e.length>0){var n=t[e[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(var r=0,i=n.length;r<i;r++){var o=n[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=r}}}}},{key:"getVertexPosition",value:function(t,e){var n=this.geometry,r=n.attributes.position,i=n.morphAttributes.position,o=n.morphTargetsRelative;e.fromBufferAttribute(r,t);var a=this.morphTargetInfluences;if(i&&a){fo.set(0,0,0);for(var s=0,u=i.length;s<u;s++){var c=a[s],l=i[s];0!==c&&(lo.fromBufferAttribute(l,t),o?fo.addScaledVector(lo,c):fo.addScaledVector(lo.sub(e),c))}e.add(fo)}return e}},{key:"raycast",value:function(t,e){var n=this.geometry,r=this.material,i=this.matrixWorld;if(void 0!==r){if(null===n.boundingSphere&&n.computeBoundingSphere(),oo.copy(n.boundingSphere),oo.applyMatrix4(i),io.copy(t.ray).recast(t.near),!1===oo.containsPoint(io.origin)){if(null===io.intersectSphere(oo,ao))return;if(io.origin.distanceToSquared(ao)>Math.pow(t.far-t.near,2))return}ro.copy(i).invert(),io.copy(t.ray).applyMatrix4(ro),null!==n.boundingBox&&!1===io.intersectsBox(n.boundingBox)||this._computeIntersections(t,e,io)}}},{key:"_computeIntersections",value:function(t,e,n){var r,i=this.geometry,o=this.material,a=i.index,s=i.attributes.position,u=i.attributes.uv,c=i.attributes.uv1,l=i.attributes.normal,f=i.groups,h=i.drawRange;if(null!==a)if(Array.isArray(o))for(var p=0,d=f.length;p<d;p++)for(var m=f[p],y=o[m.materialIndex],v=Math.max(m.start,h.start),g=Math.min(a.count,Math.min(m.start+m.count,h.start+h.count));v<g;v+=3)(r=wo(this,y,t,n,u,c,l,a.getX(v),a.getX(v+1),a.getX(v+2)))&&(r.faceIndex=Math.floor(v/3),r.face.materialIndex=m.materialIndex,e.push(r));else for(var b=Math.max(0,h.start),_=Math.min(a.count,h.start+h.count);b<_;b+=3)(r=wo(this,o,t,n,u,c,l,a.getX(b),a.getX(b+1),a.getX(b+2)))&&(r.faceIndex=Math.floor(b/3),e.push(r));else if(void 0!==s)if(Array.isArray(o))for(var x=0,w=f.length;x<w;x++)for(var S=f[x],T=o[S.materialIndex],M=Math.max(S.start,h.start),E=Math.min(s.count,Math.min(S.start+S.count,h.start+h.count));M<E;M+=3)(r=wo(this,T,t,n,u,c,l,M,M+1,M+2))&&(r.faceIndex=Math.floor(M/3),r.face.materialIndex=S.materialIndex,e.push(r));else for(var A=Math.max(0,h.start),O=Math.min(s.count,h.start+h.count);A<O;A+=3)(r=wo(this,o,t,n,u,c,l,A,A+1,A+2))&&(r.faceIndex=Math.floor(A/3),e.push(r))}}])}(vi);function wo(t,e,n,r,i,o,a,s,u,c){t.getVertexPosition(s,so),t.getVertexPosition(u,uo),t.getVertexPosition(c,co);var l=function(t,e,n,r,i,o,a,s){if(null===(e.side===N?r.intersectTriangle(a,o,i,!0,s):r.intersectTriangle(i,o,a,e.side===C,s)))return null;_o.copy(s),_o.applyMatrix4(t.matrixWorld);var u=n.ray.origin.distanceTo(_o);return u<n.near||u>n.far?null:{distance:u,point:_o.clone(),object:t}}(t,e,n,r,so,uo,co,bo);if(l){i&&(ho.fromBufferAttribute(i,s),po.fromBufferAttribute(i,u),mo.fromBufferAttribute(i,c),l.uv=Oi.getInterpolation(bo,so,uo,co,ho,po,mo,new Fn)),o&&(ho.fromBufferAttribute(o,s),po.fromBufferAttribute(o,u),mo.fromBufferAttribute(o,c),l.uv1=Oi.getInterpolation(bo,so,uo,co,ho,po,mo,new Fn)),a&&(yo.fromBufferAttribute(a,s),vo.fromBufferAttribute(a,u),go.fromBufferAttribute(a,c),l.normal=Oi.getInterpolation(bo,so,uo,co,yo,vo,go,new dr),l.normal.dot(r.direction)>0&&l.normal.multiplyScalar(-1));var f={a:s,b:u,c,normal:new dr,materialIndex:0};Oi.getNormal(so,uo,co,f.normal),l.face=f}return l}var So=function(t){function e(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1;w(this,e),(t=d(this,e)).type="BoxGeometry",t.parameters={width:n,height:r,depth:i,widthSegments:o,heightSegments:a,depthSegments:s};var u=t;o=Math.floor(o),a=Math.floor(a),s=Math.floor(s);var c=[],l=[],f=[],h=[],p=0,m=0;function y(t,e,n,r,i,o,a,s,d,y,v){for(var g=o/d,b=a/y,_=o/2,x=a/2,w=s/2,S=d+1,T=y+1,M=0,E=0,A=new dr,O=0;O<T;O++)for(var P=O*b-x,R=0;R<S;R++){var k=R*g-_;A[t]=k*r,A[e]=P*i,A[n]=w,l.push(A.x,A.y,A.z),A[t]=0,A[e]=0,A[n]=s>0?1:-1,f.push(A.x,A.y,A.z),h.push(R/d),h.push(1-O/y),M+=1}for(var C=0;C<y;C++)for(var N=0;N<d;N++){var L=p+N+S*C,j=p+N+S*(C+1),I=p+(N+1)+S*(C+1),B=p+(N+1)+S*C;c.push(L,j,B),c.push(j,I,B),E+=6}u.addGroup(m,E,v),m+=E,p+=M}return y("z","y","x",-1,-1,i,r,n,s,a,0),y("z","y","x",1,-1,i,r,-n,s,a,1),y("x","z","y",1,1,n,i,r,o,s,2),y("x","z","y",1,-1,n,i,-r,o,s,3),y("x","y","z",1,-1,n,r,i,o,a,4),y("x","y","z",-1,-1,n,r,-i,o,a,5),t.setIndex(c),t.setAttribute("position",new Yi(l,3)),t.setAttribute("normal",new Yi(f,3)),t.setAttribute("uv",new Yi(h,2)),t}return v(e,t),T(e,[{key:"copy",value:function(t){return l(y(e.prototype),"copy",this).call(this,t),this.parameters=Object.assign({},t.parameters),this}}],[{key:"fromJSON",value:function(t){return new e(t.width,t.height,t.depth,t.widthSegments,t.heightSegments,t.depthSegments)}}])}(no);function To(t){var e={};for(var n in t)for(var r in e[n]={},t[n]){var i=t[n][r];i&&(i.isColor||i.isMatrix3||i.isMatrix4||i.isVector2||i.isVector3||i.isVector4||i.isTexture||i.isQuaternion)?i.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),e[n][r]=null):e[n][r]=i.clone():Array.isArray(i)?e[n][r]=i.slice():e[n][r]=i}return e}function Mo(t){for(var e={},n=0;n<t.length;n++){var r=To(t[n]);for(var i in r)e[i]=r[i]}return e}var Eo={clone:To,merge:Mo},Ao=function(t){function e(t){var n;return w(this,e),(n=d(this,e)).isShaderMaterial=!0,n.type="ShaderMaterial",n.defines={},n.uniforms={},n.uniformsGroups=[],n.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",n.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",n.linewidth=1,n.wireframe=!1,n.wireframeLinewidth=1,n.fog=!1,n.lights=!1,n.clipping=!1,n.forceSinglePass=!0,n.extensions={clipCullDistance:!1,multiDraw:!1},n.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},n.index0AttributeName=void 0,n.uniformsNeedUpdate=!1,n.glslVersion=null,void 0!==t&&n.setValues(t),n}return v(e,t),T(e,[{key:"copy",value:function(t){return l(y(e.prototype),"copy",this).call(this,t),this.fragmentShader=t.fragmentShader,this.vertexShader=t.vertexShader,this.uniforms=To(t.uniforms),this.uniformsGroups=function(t){for(var e=[],n=0;n<t.length;n++)e.push(t[n].clone());return e}(t.uniformsGroups),this.defines=Object.assign({},t.defines),this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.fog=t.fog,this.lights=t.lights,this.clipping=t.clipping,this.extensions=Object.assign({},t.extensions),this.glslVersion=t.glslVersion,this}},{key:"toJSON",value:function(t){var n=l(y(e.prototype),"toJSON",this).call(this,t);for(var r in n.glslVersion=this.glslVersion,n.uniforms={},this.uniforms){var i=this.uniforms[r].value;i&&i.isTexture?n.uniforms[r]={type:"t",value:i.toJSON(t).uuid}:i&&i.isColor?n.uniforms[r]={type:"c",value:i.getHex()}:i&&i.isVector2?n.uniforms[r]={type:"v2",value:i.toArray()}:i&&i.isVector3?n.uniforms[r]={type:"v3",value:i.toArray()}:i&&i.isVector4?n.uniforms[r]={type:"v4",value:i.toArray()}:i&&i.isMatrix3?n.uniforms[r]={type:"m3",value:i.toArray()}:i&&i.isMatrix4?n.uniforms[r]={type:"m4",value:i.toArray()}:n.uniforms[r]={value:i}}Object.keys(this.defines).length>0&&(n.defines=this.defines),n.vertexShader=this.vertexShader,n.fragmentShader=this.fragmentShader,n.lights=this.lights,n.clipping=this.clipping;var o={};for(var a in this.extensions)!0===this.extensions[a]&&(o[a]=!0);return Object.keys(o).length>0&&(n.extensions=o),n}}])}(Ii),Oo=function(t){function e(){var t;return w(this,e),(t=d(this,e)).isCamera=!0,t.type="Camera",t.matrixWorldInverse=new Hr,t.projectionMatrix=new Hr,t.projectionMatrixInverse=new Hr,t.coordinateSystem=En,t}return v(e,t),T(e,[{key:"copy",value:function(t,n){return l(y(e.prototype),"copy",this).call(this,t,n),this.matrixWorldInverse.copy(t.matrixWorldInverse),this.projectionMatrix.copy(t.projectionMatrix),this.projectionMatrixInverse.copy(t.projectionMatrixInverse),this.coordinateSystem=t.coordinateSystem,this}},{key:"getWorldDirection",value:function(t){return l(y(e.prototype),"getWorldDirection",this).call(this,t).negate()}},{key:"updateMatrixWorld",value:function(t){l(y(e.prototype),"updateMatrixWorld",this).call(this,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}},{key:"updateWorldMatrix",value:function(t,n){l(y(e.prototype),"updateWorldMatrix",this).call(this,t,n),this.matrixWorldInverse.copy(this.matrixWorld).invert()}},{key:"clone",value:function(){return(new this.constructor).copy(this)}}])}(vi),Po=new dr,Ro=new Fn,ko=new Fn,Co=function(t){function e(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:50,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2e3;return w(this,e),(t=d(this,e)).isPerspectiveCamera=!0,t.type="PerspectiveCamera",t.fov=n,t.zoom=1,t.near=i,t.far=o,t.focus=10,t.aspect=r,t.view=null,t.filmGauge=35,t.filmOffset=0,t.updateProjectionMatrix(),t}return v(e,t),T(e,[{key:"copy",value:function(t,n){return l(y(e.prototype),"copy",this).call(this,t,n),this.fov=t.fov,this.zoom=t.zoom,this.near=t.near,this.far=t.far,this.focus=t.focus,this.aspect=t.aspect,this.view=null===t.view?null:Object.assign({},t.view),this.filmGauge=t.filmGauge,this.filmOffset=t.filmOffset,this}},{key:"setFocalLength",value:function(t){var e=.5*this.getFilmHeight()/t;this.fov=2*Cn*Math.atan(e),this.updateProjectionMatrix()}},{key:"getFocalLength",value:function(){var t=Math.tan(.5*kn*this.fov);return.5*this.getFilmHeight()/t}},{key:"getEffectiveFOV",value:function(){return 2*Cn*Math.atan(Math.tan(.5*kn*this.fov)/this.zoom)}},{key:"getFilmWidth",value:function(){return this.filmGauge*Math.min(this.aspect,1)}},{key:"getFilmHeight",value:function(){return this.filmGauge/Math.max(this.aspect,1)}},{key:"getViewBounds",value:function(t,e,n){Po.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),e.set(Po.x,Po.y).multiplyScalar(-t/Po.z),Po.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),n.set(Po.x,Po.y).multiplyScalar(-t/Po.z)}},{key:"getViewSize",value:function(t,e){return this.getViewBounds(t,Ro,ko),e.subVectors(ko,Ro)}},{key:"setViewOffset",value:function(t,e,n,r,i,o){this.aspect=t/e,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=n,this.view.offsetY=r,this.view.width=i,this.view.height=o,this.updateProjectionMatrix()}},{key:"clearViewOffset",value:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}},{key:"updateProjectionMatrix",value:function(){var t=this.near,e=t*Math.tan(.5*kn*this.fov)/this.zoom,n=2*e,r=this.aspect*n,i=-.5*r,o=this.view;if(null!==this.view&&this.view.enabled){var a=o.fullWidth,s=o.fullHeight;i+=o.offsetX*r/a,e-=o.offsetY*n/s,r*=o.width/a,n*=o.height/s}var u=this.filmOffset;0!==u&&(i+=t*u/this.getFilmWidth()),this.projectionMatrix.makePerspective(i,i+r,e,e-n,t,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}},{key:"toJSON",value:function(t){var n=l(y(e.prototype),"toJSON",this).call(this,t);return n.object.fov=this.fov,n.object.zoom=this.zoom,n.object.near=this.near,n.object.far=this.far,n.object.focus=this.focus,n.object.aspect=this.aspect,null!==this.view&&(n.object.view=Object.assign({},this.view)),n.object.filmGauge=this.filmGauge,n.object.filmOffset=this.filmOffset,n}}])}(Oo),No=-90,Lo=function(t){function e(t,n,r){var i;w(this,e),(i=d(this,e)).type="CubeCamera",i.renderTarget=r,i.coordinateSystem=null,i.activeMipmapLevel=0;var o=new Co(No,1,t,n);o.layers=i.layers,i.add(o);var a=new Co(No,1,t,n);a.layers=i.layers,i.add(a);var s=new Co(No,1,t,n);s.layers=i.layers,i.add(s);var u=new Co(No,1,t,n);u.layers=i.layers,i.add(u);var c=new Co(No,1,t,n);c.layers=i.layers,i.add(c);var l=new Co(No,1,t,n);return l.layers=i.layers,i.add(l),i}return v(e,t),T(e,[{key:"updateCoordinateSystem",value:function(){var t,e=this.coordinateSystem,n=this.children.concat(),r=c(n,6),i=r[0],o=r[1],a=r[2],s=r[3],l=r[4],f=r[5],h=u(n);try{for(h.s();!(t=h.n()).done;){var p=t.value;this.remove(p)}}catch(t){h.e(t)}finally{h.f()}if(e===En)i.up.set(0,1,0),i.lookAt(1,0,0),o.up.set(0,1,0),o.lookAt(-1,0,0),a.up.set(0,0,-1),a.lookAt(0,1,0),s.up.set(0,0,1),s.lookAt(0,-1,0),l.up.set(0,1,0),l.lookAt(0,0,1),f.up.set(0,1,0),f.lookAt(0,0,-1);else{if(e!==An)throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+e);i.up.set(0,-1,0),i.lookAt(-1,0,0),o.up.set(0,-1,0),o.lookAt(1,0,0),a.up.set(0,0,1),a.lookAt(0,1,0),s.up.set(0,0,-1),s.lookAt(0,-1,0),l.up.set(0,-1,0),l.lookAt(0,0,1),f.up.set(0,-1,0),f.lookAt(0,0,-1)}var d,m=u(n);try{for(m.s();!(d=m.n()).done;){var y=d.value;this.add(y),y.updateMatrixWorld()}}catch(t){m.e(t)}finally{m.f()}}},{key:"update",value:function(t,e){null===this.parent&&this.updateMatrixWorld();var n=this.renderTarget,r=this.activeMipmapLevel;this.coordinateSystem!==t.coordinateSystem&&(this.coordinateSystem=t.coordinateSystem,this.updateCoordinateSystem());var i=c(this.children,6),o=i[0],a=i[1],s=i[2],u=i[3],l=i[4],f=i[5],h=t.getRenderTarget(),p=t.getActiveCubeFace(),d=t.getActiveMipmapLevel(),m=t.xr.enabled;t.xr.enabled=!1;var y=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,t.setRenderTarget(n,0,r),t.render(e,o),t.setRenderTarget(n,1,r),t.render(e,a),t.setRenderTarget(n,2,r),t.render(e,s),t.setRenderTarget(n,3,r),t.render(e,u),t.setRenderTarget(n,4,r),t.render(e,l),n.texture.generateMipmaps=y,t.setRenderTarget(n,5,r),t.render(e,f),t.setRenderTarget(h,p,d),t.xr.enabled=m,n.texture.needsPMREMUpdate=!0}}])}(vi),jo=function(t){function e(t,n,r,i,o,a,s,u,c,l){var f;return w(this,e),(f=d(this,e,[t=void 0!==t?t:[],n=void 0!==n?n:_t,r,i,o,a,s,u,c,l])).isCubeTexture=!0,f.flipY=!1,f}return v(e,t),T(e,[{key:"images",get:function(){return this.image},set:function(t){this.image=t}}])}(ur),Io=function(t){function e(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};w(this,e),(t=d(this,e,[n,n,r])).isWebGLCubeRenderTarget=!0;var i={width:n,height:n,depth:1},o=[i,i,i,i,i,i];return t.texture=new jo(o,r.mapping,r.wrapS,r.wrapT,r.magFilter,r.minFilter,r.format,r.type,r.anisotropy,r.colorSpace),t.texture.isRenderTargetTexture=!0,t.texture.generateMipmaps=void 0!==r.generateMipmaps&&r.generateMipmaps,t.texture.minFilter=void 0!==r.minFilter?r.minFilter:kt,t}return v(e,t),T(e,[{key:"fromEquirectangularTexture",value:function(t,e){this.texture.type=e.type,this.texture.colorSpace=e.colorSpace,this.texture.generateMipmaps=e.generateMipmaps,this.texture.minFilter=e.minFilter,this.texture.magFilter=e.magFilter;var n=new So(5,5,5),r=new Ao({name:"CubemapFromEquirect",uniforms:To({tEquirect:{value:null}}),vertexShader:"\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t}\n\t\t\t",fragmentShader:"\n\n\t\t\t\tuniform sampler2D tEquirect;\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\t#include <common>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t\t}\n\t\t\t",side:N,blending:j});r.uniforms.tEquirect.value=e;var i=new xo(n,r),o=e.minFilter;return e.minFilter===Nt&&(e.minFilter=kt),new Lo(1,10,this).update(t,i),e.minFilter=o,i.geometry.dispose(),i.material.dispose(),this}},{key:"clear",value:function(t,e,n,r){for(var i=t.getRenderTarget(),o=0;o<6;o++)t.setRenderTarget(this,o),t.clear(e,n,r);t.setRenderTarget(i)}}])}(fr),Bo=new dr,Uo=new dr,Do=new zn,Fo=function(){return T((function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new dr(1,0,0),n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;w(this,t),this.isPlane=!0,this.normal=e,this.constant=n}),[{key:"set",value:function(t,e){return this.normal.copy(t),this.constant=e,this}},{key:"setComponents",value:function(t,e,n,r){return this.normal.set(t,e,n),this.constant=r,this}},{key:"setFromNormalAndCoplanarPoint",value:function(t,e){return this.normal.copy(t),this.constant=-e.dot(this.normal),this}},{key:"setFromCoplanarPoints",value:function(t,e,n){var r=Bo.subVectors(n,e).cross(Uo.subVectors(t,e)).normalize();return this.setFromNormalAndCoplanarPoint(r,t),this}},{key:"copy",value:function(t){return this.normal.copy(t.normal),this.constant=t.constant,this}},{key:"normalize",value:function(){var t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this}},{key:"negate",value:function(){return this.constant*=-1,this.normal.negate(),this}},{key:"distanceToPoint",value:function(t){return this.normal.dot(t)+this.constant}},{key:"distanceToSphere",value:function(t){return this.distanceToPoint(t.center)-t.radius}},{key:"projectPoint",value:function(t,e){return e.copy(t).addScaledVector(this.normal,-this.distanceToPoint(t))}},{key:"intersectLine",value:function(t,e){var n=t.delta(Bo),r=this.normal.dot(n);if(0===r)return 0===this.distanceToPoint(t.start)?e.copy(t.start):null;var i=-(t.start.dot(this.normal)+this.constant)/r;return i<0||i>1?null:e.copy(t.start).addScaledVector(n,i)}},{key:"intersectsLine",value:function(t){var e=this.distanceToPoint(t.start),n=this.distanceToPoint(t.end);return e<0&&n>0||n<0&&e>0}},{key:"intersectsBox",value:function(t){return t.intersectsPlane(this)}},{key:"intersectsSphere",value:function(t){return t.intersectsPlane(this)}},{key:"coplanarPoint",value:function(t){return t.copy(this.normal).multiplyScalar(-this.constant)}},{key:"applyMatrix4",value:function(t,e){var n=e||Do.getNormalMatrix(t),r=this.coplanarPoint(Bo).applyMatrix4(t),i=this.normal.applyMatrix3(n).normalize();return this.constant=-r.dot(i),this}},{key:"translate",value:function(t){return this.constant-=t.dot(this.normal),this}},{key:"equals",value:function(t){return t.normal.equals(this.normal)&&t.constant===this.constant}},{key:"clone",value:function(){return(new this.constructor).copy(this)}}])}(),zo=new jr,Vo=new dr,Go=function(){return T((function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Fo,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Fo,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Fo,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Fo,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new Fo,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:new Fo;w(this,t),this.planes=[e,n,r,i,o,a]}),[{key:"set",value:function(t,e,n,r,i,o){var a=this.planes;return a[0].copy(t),a[1].copy(e),a[2].copy(n),a[3].copy(r),a[4].copy(i),a[5].copy(o),this}},{key:"copy",value:function(t){for(var e=this.planes,n=0;n<6;n++)e[n].copy(t.planes[n]);return this}},{key:"setFromProjectionMatrix",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:En,n=this.planes,r=t.elements,i=r[0],o=r[1],a=r[2],s=r[3],u=r[4],c=r[5],l=r[6],f=r[7],h=r[8],p=r[9],d=r[10],m=r[11],y=r[12],v=r[13],g=r[14],b=r[15];if(n[0].setComponents(s-i,f-u,m-h,b-y).normalize(),n[1].setComponents(s+i,f+u,m+h,b+y).normalize(),n[2].setComponents(s+o,f+c,m+p,b+v).normalize(),n[3].setComponents(s-o,f-c,m-p,b-v).normalize(),n[4].setComponents(s-a,f-l,m-d,b-g).normalize(),e===En)n[5].setComponents(s+a,f+l,m+d,b+g).normalize();else{if(e!==An)throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+e);n[5].setComponents(a,l,d,g).normalize()}return this}},{key:"intersectsObject",value:function(t){if(void 0!==t.boundingSphere)null===t.boundingSphere&&t.computeBoundingSphere(),zo.copy(t.boundingSphere).applyMatrix4(t.matrixWorld);else{var e=t.geometry;null===e.boundingSphere&&e.computeBoundingSphere(),zo.copy(e.boundingSphere).applyMatrix4(t.matrixWorld)}return this.intersectsSphere(zo)}},{key:"intersectsSprite",value:function(t){return zo.center.set(0,0,0),zo.radius=.7071067811865476,zo.applyMatrix4(t.matrixWorld),this.intersectsSphere(zo)}},{key:"intersectsSphere",value:function(t){for(var e=this.planes,n=t.center,r=-t.radius,i=0;i<6;i++)if(e[i].distanceToPoint(n)<r)return!1;return!0}},{key:"intersectsBox",value:function(t){for(var e=this.planes,n=0;n<6;n++){var r=e[n];if(Vo.x=r.normal.x>0?t.max.x:t.min.x,Vo.y=r.normal.y>0?t.max.y:t.min.y,Vo.z=r.normal.z>0?t.max.z:t.min.z,r.distanceToPoint(Vo)<0)return!1}return!0}},{key:"containsPoint",value:function(t){for(var e=this.planes,n=0;n<6;n++)if(e[n].distanceToPoint(t)<0)return!1;return!0}},{key:"clone",value:function(){return(new this.constructor).copy(this)}}])}(),Ho=function(t){function e(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;w(this,e),(t=d(this,e)).type="PlaneGeometry",t.parameters={width:n,height:r,widthSegments:i,heightSegments:o};for(var a=n/2,s=r/2,u=Math.floor(i),c=Math.floor(o),l=u+1,f=c+1,h=n/u,p=r/c,m=[],y=[],v=[],g=[],b=0;b<f;b++)for(var _=b*p-s,x=0;x<l;x++){var S=x*h-a;y.push(S,-_,0),v.push(0,0,1),g.push(x/u),g.push(1-b/c)}for(var T=0;T<c;T++)for(var M=0;M<u;M++){var E=M+l*T,A=M+l*(T+1),O=M+1+l*(T+1),P=M+1+l*T;m.push(E,A,P),m.push(A,O,P)}return t.setIndex(m),t.setAttribute("position",new Yi(y,3)),t.setAttribute("normal",new Yi(v,3)),t.setAttribute("uv",new Yi(g,2)),t}return v(e,t),T(e,[{key:"copy",value:function(t){return l(y(e.prototype),"copy",this).call(this,t),this.parameters=Object.assign({},t.parameters),this}}],[{key:"fromJSON",value:function(t){return new e(t.width,t.height,t.widthSegments,t.heightSegments)}}])}(no),Wo="varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",qo="uniform sampler2D t2D;\nuniform float backgroundIntensity;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\ttexColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );\n\t#endif\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",Xo="varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",Yo="#ifdef ENVMAP_TYPE_CUBE\n\tuniform samplerCube envMap;\n#elif defined( ENVMAP_TYPE_CUBE_UV )\n\tuniform sampler2D envMap;\n#endif\nuniform float flipEnvMap;\nuniform float backgroundBlurriness;\nuniform float backgroundIntensity;\nuniform mat3 backgroundRotation;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 texColor = textureCube( envMap, backgroundRotation * vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 texColor = textureCubeUV( envMap, backgroundRotation * vWorldDirection, backgroundBlurriness );\n\t#else\n\t\tvec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t#endif\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",Jo="varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",Zo="uniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\nvarying vec3 vWorldDirection;\nvoid main() {\n\tvec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );\n\tgl_FragColor = texColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",Ko="#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <batching_vertex>\n\t#include <skinbase_vertex>\n\t#include <morphinstance_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",Qo="#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <clipping_planes_fragment>\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#endif\n}",$o="#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <batching_vertex>\n\t#include <skinbase_vertex>\n\t#include <morphinstance_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",ta="#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <clipping_planes_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",ea="varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",na="uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",ra="uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",ia="uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",oa="#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinbase_vertex>\n\t\t#include <skinnormal_vertex>\n\t\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",aa="uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\t\treflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",sa="#define LAMBERT\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",ua="#define LAMBERT\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_lambert_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_lambert_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",ca="#define MATCAP\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",la="#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t#else\n\t\tvec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",fa="#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvarying vec3 vViewPosition;\n#endif\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",ha="#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvarying vec3 vViewPosition;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( 0.0, 0.0, 0.0, opacity );\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), diffuseColor.a );\n\t#ifdef OPAQUE\n\t\tgl_FragColor.a = 1.0;\n\t#endif\n}",pa="#define PHONG\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",da="#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",ma="#define STANDARD\nvarying vec3 vViewPosition;\n#ifdef USE_TRANSMISSION\n\tvarying vec3 vWorldPosition;\n#endif\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n\tvWorldPosition = worldPosition.xyz;\n#endif\n}",ya="#define STANDARD\n#ifdef PHYSICAL\n\t#define IOR\n\t#define USE_SPECULAR\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef IOR\n\tuniform float ior;\n#endif\n#ifdef USE_SPECULAR\n\tuniform float specularIntensity;\n\tuniform vec3 specularColor;\n\t#ifdef USE_SPECULAR_COLORMAP\n\t\tuniform sampler2D specularColorMap;\n\t#endif\n\t#ifdef USE_SPECULAR_INTENSITYMAP\n\t\tuniform sampler2D specularIntensityMap;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_IRIDESCENCE\n\tuniform float iridescence;\n\tuniform float iridescenceIOR;\n\tuniform float iridescenceThicknessMinimum;\n\tuniform float iridescenceThicknessMaximum;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheenColor;\n\tuniform float sheenRoughness;\n\t#ifdef USE_SHEEN_COLORMAP\n\t\tuniform sampler2D sheenColorMap;\n\t#endif\n\t#ifdef USE_SHEEN_ROUGHNESSMAP\n\t\tuniform sampler2D sheenRoughnessMap;\n\t#endif\n#endif\n#ifdef USE_ANISOTROPY\n\tuniform vec2 anisotropyVector;\n\t#ifdef USE_ANISOTROPYMAP\n\t\tuniform sampler2D anisotropyMap;\n\t#endif\n#endif\nvarying vec3 vViewPosition;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <iridescence_fragment>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <transmission_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <iridescence_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n\tvec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n\t#include <transmission_fragment>\n\tvec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n\t#ifdef USE_SHEEN\n\t\tfloat sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );\n\t\toutgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );\n\t\tvec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );\n\t\toutgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;\n\t#endif\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",va="#define TOON\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",ga="#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",ba="uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n#ifdef USE_POINTS_UV\n\tvarying vec2 vUv;\n\tuniform mat3 uvTransform;\n#endif\nvoid main() {\n\t#ifdef USE_POINTS_UV\n\t\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\t#endif\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",_a="uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",xa="#include <common>\n#include <batching_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",wa="uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <logdepthbuf_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\t#include <logdepthbuf_fragment>\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n}",Sa="uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",Ta="uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n}",Ma={common:{diffuse:{value:new Ni(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new zn},alphaMap:{value:null},alphaMapTransform:{value:new zn},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new zn}},envmap:{envMap:{value:null},envMapRotation:{value:new zn},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new zn}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new zn}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new zn},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new zn},normalScale:{value:new Fn(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new zn},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new zn}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new zn}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new zn}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Ni(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Ni(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new zn},alphaTest:{value:0},uvTransform:{value:new zn}},sprite:{diffuse:{value:new Ni(16777215)},opacity:{value:1},center:{value:new Fn(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new zn},alphaMap:{value:null},alphaMapTransform:{value:new zn},alphaTest:{value:0}}},Ea={basic:{uniforms:Mo([Ma.common,Ma.specularmap,Ma.envmap,Ma.aomap,Ma.lightmap,Ma.fog]),vertexShader:oa,fragmentShader:aa},lambert:{uniforms:Mo([Ma.common,Ma.specularmap,Ma.envmap,Ma.aomap,Ma.lightmap,Ma.emissivemap,Ma.bumpmap,Ma.normalmap,Ma.displacementmap,Ma.fog,Ma.lights,{emissive:{value:new Ni(0)}}]),vertexShader:sa,fragmentShader:ua},phong:{uniforms:Mo([Ma.common,Ma.specularmap,Ma.envmap,Ma.aomap,Ma.lightmap,Ma.emissivemap,Ma.bumpmap,Ma.normalmap,Ma.displacementmap,Ma.fog,Ma.lights,{emissive:{value:new Ni(0)},specular:{value:new Ni(1118481)},shininess:{value:30}}]),vertexShader:pa,fragmentShader:da},standard:{uniforms:Mo([Ma.common,Ma.envmap,Ma.aomap,Ma.lightmap,Ma.emissivemap,Ma.bumpmap,Ma.normalmap,Ma.displacementmap,Ma.roughnessmap,Ma.metalnessmap,Ma.fog,Ma.lights,{emissive:{value:new Ni(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:ma,fragmentShader:ya},toon:{uniforms:Mo([Ma.common,Ma.aomap,Ma.lightmap,Ma.emissivemap,Ma.bumpmap,Ma.normalmap,Ma.displacementmap,Ma.gradientmap,Ma.fog,Ma.lights,{emissive:{value:new Ni(0)}}]),vertexShader:va,fragmentShader:ga},matcap:{uniforms:Mo([Ma.common,Ma.bumpmap,Ma.normalmap,Ma.displacementmap,Ma.fog,{matcap:{value:null}}]),vertexShader:ca,fragmentShader:la},points:{uniforms:Mo([Ma.points,Ma.fog]),vertexShader:ba,fragmentShader:_a},dashed:{uniforms:Mo([Ma.common,Ma.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:ra,fragmentShader:ia},depth:{uniforms:Mo([Ma.common,Ma.displacementmap]),vertexShader:Ko,fragmentShader:Qo},normal:{uniforms:Mo([Ma.common,Ma.bumpmap,Ma.normalmap,Ma.displacementmap,{opacity:{value:1}}]),vertexShader:fa,fragmentShader:ha},sprite:{uniforms:Mo([Ma.sprite,Ma.fog]),vertexShader:Sa,fragmentShader:Ta},background:{uniforms:{uvTransform:{value:new zn},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:Wo,fragmentShader:qo},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1},backgroundRotation:{value:new zn}},vertexShader:Xo,fragmentShader:Yo},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:Jo,fragmentShader:Zo},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:ea,fragmentShader:na},distanceRGBA:{uniforms:Mo([Ma.common,Ma.displacementmap,{referencePosition:{value:new dr},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:$o,fragmentShader:ta},shadow:{uniforms:Mo([Ma.lights,Ma.fog,{color:{value:new Ni(0)},opacity:{value:1}}]),vertexShader:xa,fragmentShader:wa}};Ea.physical={uniforms:Mo([Ea.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new zn},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new zn},clearcoatNormalScale:{value:new Fn(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new zn},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new zn},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new zn},sheen:{value:0},sheenColor:{value:new Ni(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new zn},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new zn},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new zn},transmissionSamplerSize:{value:new Fn},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new zn},attenuationDistance:{value:0},attenuationColor:{value:new Ni(0)},specularColor:{value:new Ni(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new zn},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new zn},anisotropyVector:{value:new Fn},anisotropyMap:{value:null},anisotropyMapTransform:{value:new zn}}]),vertexShader:ma,fragmentShader:ya};var Aa=function(t){function e(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.1,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:2e3;return w(this,e),(t=d(this,e)).isOrthographicCamera=!0,t.type="OrthographicCamera",t.zoom=1,t.view=null,t.left=n,t.right=r,t.top=i,t.bottom=o,t.near=a,t.far=s,t.updateProjectionMatrix(),t}return v(e,t),T(e,[{key:"copy",value:function(t,n){return l(y(e.prototype),"copy",this).call(this,t,n),this.left=t.left,this.right=t.right,this.top=t.top,this.bottom=t.bottom,this.near=t.near,this.far=t.far,this.zoom=t.zoom,this.view=null===t.view?null:Object.assign({},t.view),this}},{key:"setViewOffset",value:function(t,e,n,r,i,o){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=n,this.view.offsetY=r,this.view.width=i,this.view.height=o,this.updateProjectionMatrix()}},{key:"clearViewOffset",value:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}},{key:"updateProjectionMatrix",value:function(){var t=(this.right-this.left)/(2*this.zoom),e=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,r=(this.top+this.bottom)/2,i=n-t,o=n+t,a=r+e,s=r-e;if(null!==this.view&&this.view.enabled){var u=(this.right-this.left)/this.view.fullWidth/this.zoom,c=(this.top-this.bottom)/this.view.fullHeight/this.zoom;o=(i+=u*this.view.offsetX)+u*this.view.width,s=(a-=c*this.view.offsetY)-c*this.view.height}this.projectionMatrix.makeOrthographic(i,o,a,s,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}},{key:"toJSON",value:function(t){var n=l(y(e.prototype),"toJSON",this).call(this,t);return n.object.zoom=this.zoom,n.object.left=this.left,n.object.right=this.right,n.object.top=this.top,n.object.bottom=this.bottom,n.object.near=this.near,n.object.far=this.far,null!==this.view&&(n.object.view=Object.assign({},this.view)),n}}])}(Oo);Math.sqrt(5);var Oa=function(t){function e(t,n,r,i,o,a,s,u,c,l){var f;if(w(this,e),(l=void 0!==l?l:Qt)!==Qt&&l!==$t)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");return void 0===r&&l===Qt&&(r=Ft),void 0===r&&l===$t&&(r=Wt),(f=d(this,e,[null,i,o,a,s,u,l,r,c])).isDepthTexture=!0,f.image={width:t,height:n},f.magFilter=void 0!==s?s:Ot,f.minFilter=void 0!==u?u:Ot,f.flipY=!1,f.generateMipmaps=!1,f.compareFunction=null,f}return v(e,t),T(e,[{key:"copy",value:function(t){return l(y(e.prototype),"copy",this).call(this,t),this.compareFunction=t.compareFunction,this}},{key:"toJSON",value:function(t){var n=l(y(e.prototype),"toJSON",this).call(this,t);return null!==this.compareFunction&&(n.compareFunction=this.compareFunction),n}}])}(ur);new Oa(1,1).compareFunction=bn,new Float32Array(16),new Float32Array(9),new Float32Array(4),new Map([["encodings_fragment","colorspace_fragment"],["encodings_pars_fragment","colorspace_pars_fragment"],["output_fragment","opaque_fragment"]]);var Pa,Ra=function(t){function e(t){var n;return w(this,e),(n=d(this,e)).isMeshDepthMaterial=!0,n.type="MeshDepthMaterial",n.depthPacking=3200,n.map=null,n.alphaMap=null,n.displacementMap=null,n.displacementScale=1,n.displacementBias=0,n.wireframe=!1,n.wireframeLinewidth=1,n.setValues(t),n}return v(e,t),T(e,[{key:"copy",value:function(t){return l(y(e.prototype),"copy",this).call(this,t),this.depthPacking=t.depthPacking,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this}}])}(Ii),ka=function(t){function e(t){var n;return w(this,e),(n=d(this,e)).isMeshDistanceMaterial=!0,n.type="MeshDistanceMaterial",n.map=null,n.alphaMap=null,n.displacementMap=null,n.displacementScale=1,n.displacementBias=0,n.setValues(t),n}return v(e,t),T(e,[{key:"copy",value:function(t){return l(y(e.prototype),"copy",this).call(this,t),this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this}}])}(Ii),Ca=function(t){function e(){var t;return w(this,e),(t=d(this,e)).isGroup=!0,t.type="Group",t}return v(e,t),T(e)}(vi),Na=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:25e-5;w(this,t),this.isFogExp2=!0,this.name="",this.color=new Ni(e),this.density=n}return T(t,[{key:"clone",value:function(){return new t(this.color,this.density)}},{key:"toJSON",value:function(){return{type:"FogExp2",name:this.name,color:this.color.getHex(),density:this.density}}}])}(),La=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3;w(this,t),this.isFog=!0,this.name="",this.color=new Ni(e),this.near=n,this.far=r}return T(t,[{key:"clone",value:function(){return new t(this.color,this.near,this.far)}},{key:"toJSON",value:function(){return{type:"Fog",name:this.name,color:this.color.getHex(),near:this.near,far:this.far}}}])}(),ja=function(t){function e(){var t;return w(this,e),(t=d(this,e)).isScene=!0,t.type="Scene",t.background=null,t.environment=null,t.fog=null,t.backgroundBlurriness=0,t.backgroundIntensity=1,t.backgroundRotation=new ti,t.environmentIntensity=1,t.environmentRotation=new ti,t.overrideMaterial=null,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:t})),t}return v(e,t),T(e,[{key:"copy",value:function(t,n){return l(y(e.prototype),"copy",this).call(this,t,n),null!==t.background&&(this.background=t.background.clone()),null!==t.environment&&(this.environment=t.environment.clone()),null!==t.fog&&(this.fog=t.fog.clone()),this.backgroundBlurriness=t.backgroundBlurriness,this.backgroundIntensity=t.backgroundIntensity,this.backgroundRotation.copy(t.backgroundRotation),this.environmentIntensity=t.environmentIntensity,this.environmentRotation.copy(t.environmentRotation),null!==t.overrideMaterial&&(this.overrideMaterial=t.overrideMaterial.clone()),this.matrixAutoUpdate=t.matrixAutoUpdate,this}},{key:"toJSON",value:function(t){var n=l(y(e.prototype),"toJSON",this).call(this,t);return null!==this.fog&&(n.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(n.object.backgroundBlurriness=this.backgroundBlurriness),1!==this.backgroundIntensity&&(n.object.backgroundIntensity=this.backgroundIntensity),n.object.backgroundRotation=this.backgroundRotation.toArray(),1!==this.environmentIntensity&&(n.object.environmentIntensity=this.environmentIntensity),n.object.environmentRotation=this.environmentRotation.toArray(),n}}])}(vi),Ia=function(){return T((function t(e,n){w(this,t),this.isInterleavedBuffer=!0,this.array=e,this.stride=n,this.count=void 0!==e?e.length/n:0,this.usage=Tn,this._updateRange={offset:0,count:-1},this.updateRanges=[],this.version=0,this.uuid=Nn()}),[{key:"onUploadCallback",value:function(){}},{key:"needsUpdate",set:function(t){!0===t&&this.version++}},{key:"updateRange",get:function(){return Yn("THREE.InterleavedBuffer: updateRange() is deprecated and will be removed in r169. Use addUpdateRange() instead."),this._updateRange}},{key:"setUsage",value:function(t){return this.usage=t,this}},{key:"addUpdateRange",value:function(t,e){this.updateRanges.push({start:t,count:e})}},{key:"clearUpdateRanges",value:function(){this.updateRanges.length=0}},{key:"copy",value:function(t){return this.array=new t.array.constructor(t.array),this.count=t.count,this.stride=t.stride,this.usage=t.usage,this}},{key:"copyAt",value:function(t,e,n){t*=this.stride,n*=e.stride;for(var r=0,i=this.stride;r<i;r++)this.array[t+r]=e.array[n+r];return this}},{key:"set",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.array.set(t,e),this}},{key:"clone",value:function(t){void 0===t.arrayBuffers&&(t.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=Nn()),void 0===t.arrayBuffers[this.array.buffer._uuid]&&(t.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);var e=new this.array.constructor(t.arrayBuffers[this.array.buffer._uuid]),n=new this.constructor(e,this.stride);return n.setUsage(this.usage),n}},{key:"onUpload",value:function(t){return this.onUploadCallback=t,this}},{key:"toJSON",value:function(t){return void 0===t.arrayBuffers&&(t.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=Nn()),void 0===t.arrayBuffers[this.array.buffer._uuid]&&(t.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}])}(),Ba=new dr,Ua=function(){function t(e,n,r){var i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];w(this,t),this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=n,this.offset=r,this.normalized=i}return T(t,[{key:"count",get:function(){return this.data.count}},{key:"array",get:function(){return this.data.array}},{key:"needsUpdate",set:function(t){this.data.needsUpdate=t}},{key:"applyMatrix4",value:function(t){for(var e=0,n=this.data.count;e<n;e++)Ba.fromBufferAttribute(this,e),Ba.applyMatrix4(t),this.setXYZ(e,Ba.x,Ba.y,Ba.z);return this}},{key:"applyNormalMatrix",value:function(t){for(var e=0,n=this.count;e<n;e++)Ba.fromBufferAttribute(this,e),Ba.applyNormalMatrix(t),this.setXYZ(e,Ba.x,Ba.y,Ba.z);return this}},{key:"transformDirection",value:function(t){for(var e=0,n=this.count;e<n;e++)Ba.fromBufferAttribute(this,e),Ba.transformDirection(t),this.setXYZ(e,Ba.x,Ba.y,Ba.z);return this}},{key:"getComponent",value:function(t,e){var n=this.array[t*this.data.stride+this.offset+e];return this.normalized&&(n=Bn(n,this.array)),n}},{key:"setComponent",value:function(t,e,n){return this.normalized&&(n=Un(n,this.array)),this.data.array[t*this.data.stride+this.offset+e]=n,this}},{key:"setX",value:function(t,e){return this.normalized&&(e=Un(e,this.array)),this.data.array[t*this.data.stride+this.offset]=e,this}},{key:"setY",value:function(t,e){return this.normalized&&(e=Un(e,this.array)),this.data.array[t*this.data.stride+this.offset+1]=e,this}},{key:"setZ",value:function(t,e){return this.normalized&&(e=Un(e,this.array)),this.data.array[t*this.data.stride+this.offset+2]=e,this}},{key:"setW",value:function(t,e){return this.normalized&&(e=Un(e,this.array)),this.data.array[t*this.data.stride+this.offset+3]=e,this}},{key:"getX",value:function(t){var e=this.data.array[t*this.data.stride+this.offset];return this.normalized&&(e=Bn(e,this.array)),e}},{key:"getY",value:function(t){var e=this.data.array[t*this.data.stride+this.offset+1];return this.normalized&&(e=Bn(e,this.array)),e}},{key:"getZ",value:function(t){var e=this.data.array[t*this.data.stride+this.offset+2];return this.normalized&&(e=Bn(e,this.array)),e}},{key:"getW",value:function(t){var e=this.data.array[t*this.data.stride+this.offset+3];return this.normalized&&(e=Bn(e,this.array)),e}},{key:"setXY",value:function(t,e,n){return t=t*this.data.stride+this.offset,this.normalized&&(e=Un(e,this.array),n=Un(n,this.array)),this.data.array[t+0]=e,this.data.array[t+1]=n,this}},{key:"setXYZ",value:function(t,e,n,r){return t=t*this.data.stride+this.offset,this.normalized&&(e=Un(e,this.array),n=Un(n,this.array),r=Un(r,this.array)),this.data.array[t+0]=e,this.data.array[t+1]=n,this.data.array[t+2]=r,this}},{key:"setXYZW",value:function(t,e,n,r,i){return t=t*this.data.stride+this.offset,this.normalized&&(e=Un(e,this.array),n=Un(n,this.array),r=Un(r,this.array),i=Un(i,this.array)),this.data.array[t+0]=e,this.data.array[t+1]=n,this.data.array[t+2]=r,this.data.array[t+3]=i,this}},{key:"clone",value:function(e){if(void 0===e){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");for(var n=[],r=0;r<this.count;r++)for(var i=r*this.data.stride+this.offset,o=0;o<this.itemSize;o++)n.push(this.data.array[i+o]);return new Hi(new this.array.constructor(n),this.itemSize,this.normalized)}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new t(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}},{key:"toJSON",value:function(t){if(void 0===t){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");for(var e=[],n=0;n<this.count;n++)for(var r=n*this.data.stride+this.offset,i=0;i<this.itemSize;i++)e.push(this.data.array[r+i]);return{itemSize:this.itemSize,type:this.array.constructor.name,array:e,normalized:this.normalized}}return void 0===t.interleavedBuffers&&(t.interleavedBuffers={}),void 0===t.interleavedBuffers[this.data.uuid]&&(t.interleavedBuffers[this.data.uuid]=this.data.toJSON(t)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}])}(),Da=function(t){function e(t){var n;return w(this,e),(n=d(this,e)).isSpriteMaterial=!0,n.type="SpriteMaterial",n.color=new Ni(16777215),n.map=null,n.alphaMap=null,n.rotation=0,n.sizeAttenuation=!0,n.transparent=!0,n.fog=!0,n.setValues(t),n}return v(e,t),T(e,[{key:"copy",value:function(t){return l(y(e.prototype),"copy",this).call(this,t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.rotation=t.rotation,this.sizeAttenuation=t.sizeAttenuation,this.fog=t.fog,this}}])}(Ii),Fa=new dr,za=new dr,Va=new dr,Ga=new Fn,Ha=new Fn,Wa=new Hr,qa=new dr,Xa=new dr,Ya=new dr,Ja=new Fn,Za=new Fn,Ka=new Fn,Qa=function(t){function e(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Da;if(w(this,e),(t=d(this,e)).isSprite=!0,t.type="Sprite",void 0===Pa){Pa=new no;var r=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),i=new Ia(r,5);Pa.setIndex([0,1,2,0,2,3]),Pa.setAttribute("position",new Ua(i,3,0,!1)),Pa.setAttribute("uv",new Ua(i,2,3,!1))}return t.geometry=Pa,t.material=n,t.center=new Fn(.5,.5),t}return v(e,t),T(e,[{key:"raycast",value:function(t,e){null===t.camera&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),za.setFromMatrixScale(this.matrixWorld),Wa.copy(t.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(t.camera.matrixWorldInverse,this.matrixWorld),Va.setFromMatrixPosition(this.modelViewMatrix),t.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&za.multiplyScalar(-Va.z);var n,r,i=this.material.rotation;0!==i&&(r=Math.cos(i),n=Math.sin(i));var o=this.center;$a(qa.set(-.5,-.5,0),Va,o,za,n,r),$a(Xa.set(.5,-.5,0),Va,o,za,n,r),$a(Ya.set(.5,.5,0),Va,o,za,n,r),Ja.set(0,0),Za.set(1,0),Ka.set(1,1);var a=t.ray.intersectTriangle(qa,Xa,Ya,!1,Fa);if(null!==a||($a(Xa.set(-.5,.5,0),Va,o,za,n,r),Za.set(0,1),null!==(a=t.ray.intersectTriangle(qa,Ya,Xa,!1,Fa)))){var s=t.ray.origin.distanceTo(Fa);s<t.near||s>t.far||e.push({distance:s,point:Fa.clone(),uv:Oi.getInterpolation(Fa,qa,Xa,Ya,Ja,Za,Ka,new Fn),face:null,object:this})}}},{key:"copy",value:function(t,n){return l(y(e.prototype),"copy",this).call(this,t,n),void 0!==t.center&&this.center.copy(t.center),this.material=t.material,this}}])}(vi);function $a(t,e,n,r,i,o){Ga.subVectors(t,n).addScalar(.5).multiply(r),void 0!==i?(Ha.x=o*Ga.x-i*Ga.y,Ha.y=i*Ga.x+o*Ga.y):Ha.copy(Ga),t.copy(e),t.x+=Ha.x,t.y+=Ha.y,t.applyMatrix4(Wa)}var ts=new dr,es=new dr,ns=function(t){function e(){var t;return w(this,e),(t=d(this,e))._currentLevel=0,t.type="LOD",Object.defineProperties(t,{levels:{enumerable:!0,value:[]},isLOD:{value:!0}}),t.autoUpdate=!0,t}return v(e,t),T(e,[{key:"copy",value:function(t){l(y(e.prototype),"copy",this).call(this,t,!1);for(var n=t.levels,r=0,i=n.length;r<i;r++){var o=n[r];this.addLevel(o.object.clone(),o.distance,o.hysteresis)}return this.autoUpdate=t.autoUpdate,this}},{key:"addLevel",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;e=Math.abs(e);var r,i=this.levels;for(r=0;r<i.length&&!(e<i[r].distance);r++);return i.splice(r,0,{distance:e,hysteresis:n,object:t}),this.add(t),this}},{key:"getCurrentLevel",value:function(){return this._currentLevel}},{key:"getObjectForDistance",value:function(t){var e=this.levels;if(e.length>0){var n,r;for(n=1,r=e.length;n<r;n++){var i=e[n].distance;if(e[n].object.visible&&(i-=i*e[n].hysteresis),t<i)break}return e[n-1].object}return null}},{key:"raycast",value:function(t,e){if(this.levels.length>0){ts.setFromMatrixPosition(this.matrixWorld);var n=t.ray.origin.distanceTo(ts);this.getObjectForDistance(n).raycast(t,e)}}},{key:"update",value:function(t){var e=this.levels;if(e.length>1){ts.setFromMatrixPosition(t.matrixWorld),es.setFromMatrixPosition(this.matrixWorld);var n,r,i=ts.distanceTo(es)/t.zoom;for(e[0].object.visible=!0,n=1,r=e.length;n<r;n++){var o=e[n].distance;if(e[n].object.visible&&(o-=o*e[n].hysteresis),!(i>=o))break;e[n-1].object.visible=!1,e[n].object.visible=!0}for(this._currentLevel=n-1;n<r;n++)e[n].object.visible=!1}}},{key:"toJSON",value:function(t){var n=l(y(e.prototype),"toJSON",this).call(this,t);!1===this.autoUpdate&&(n.object.autoUpdate=!1),n.object.levels=[];for(var r=this.levels,i=0,o=r.length;i<o;i++){var a=r[i];n.object.levels.push({object:a.object.uuid,distance:a.distance,hysteresis:a.hysteresis})}return n}}])}(vi),rs=new dr,is=new cr,os=new cr,as=new dr,ss=new Hr,us=new dr,cs=new jr,ls=new Hr,fs=new Gr,hs=function(t){function e(t,n){var r;return w(this,e),(r=d(this,e,[t,n])).isSkinnedMesh=!0,r.type="SkinnedMesh",r.bindMode=bt,r.bindMatrix=new Hr,r.bindMatrixInverse=new Hr,r.boundingBox=null,r.boundingSphere=null,r}return v(e,t),T(e,[{key:"computeBoundingBox",value:function(){var t=this.geometry;null===this.boundingBox&&(this.boundingBox=new vr),this.boundingBox.makeEmpty();for(var e=t.getAttribute("position"),n=0;n<e.count;n++)this.getVertexPosition(n,us),this.boundingBox.expandByPoint(us)}},{key:"computeBoundingSphere",value:function(){var t=this.geometry;null===this.boundingSphere&&(this.boundingSphere=new jr),this.boundingSphere.makeEmpty();for(var e=t.getAttribute("position"),n=0;n<e.count;n++)this.getVertexPosition(n,us),this.boundingSphere.expandByPoint(us)}},{key:"copy",value:function(t,n){return l(y(e.prototype),"copy",this).call(this,t,n),this.bindMode=t.bindMode,this.bindMatrix.copy(t.bindMatrix),this.bindMatrixInverse.copy(t.bindMatrixInverse),this.skeleton=t.skeleton,null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone()),null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),this}},{key:"raycast",value:function(t,e){var n=this.material,r=this.matrixWorld;void 0!==n&&(null===this.boundingSphere&&this.computeBoundingSphere(),cs.copy(this.boundingSphere),cs.applyMatrix4(r),!1!==t.ray.intersectsSphere(cs)&&(ls.copy(r).invert(),fs.copy(t.ray).applyMatrix4(ls),null!==this.boundingBox&&!1===fs.intersectsBox(this.boundingBox)||this._computeIntersections(t,e,fs)))}},{key:"getVertexPosition",value:function(t,n){return l(y(e.prototype),"getVertexPosition",this).call(this,t,n),this.applyBoneTransform(t,n),n}},{key:"bind",value:function(t,e){this.skeleton=t,void 0===e&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),e=this.matrixWorld),this.bindMatrix.copy(e),this.bindMatrixInverse.copy(e).invert()}},{key:"pose",value:function(){this.skeleton.pose()}},{key:"normalizeSkinWeights",value:function(){for(var t=new cr,e=this.geometry.attributes.skinWeight,n=0,r=e.count;n<r;n++){t.fromBufferAttribute(e,n);var i=1/t.manhattanLength();i!==1/0?t.multiplyScalar(i):t.set(1,0,0,0),e.setXYZW(n,t.x,t.y,t.z,t.w)}}},{key:"updateMatrixWorld",value:function(t){l(y(e.prototype),"updateMatrixWorld",this).call(this,t),this.bindMode===bt?this.bindMatrixInverse.copy(this.matrixWorld).invert():"detached"===this.bindMode?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}},{key:"applyBoneTransform",value:function(t,e){var n=this.skeleton,r=this.geometry;is.fromBufferAttribute(r.attributes.skinIndex,t),os.fromBufferAttribute(r.attributes.skinWeight,t),rs.copy(e).applyMatrix4(this.bindMatrix),e.set(0,0,0);for(var i=0;i<4;i++){var o=os.getComponent(i);if(0!==o){var a=is.getComponent(i);ss.multiplyMatrices(n.bones[a].matrixWorld,n.boneInverses[a]),e.addScaledVector(as.copy(rs).applyMatrix4(ss),o)}}return e.applyMatrix4(this.bindMatrixInverse)}}])}(xo),ps=function(t){function e(){var t;return w(this,e),(t=d(this,e)).isBone=!0,t.type="Bone",t}return v(e,t),T(e)}(vi),ds=function(t){function e(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0,s=arguments.length>5?arguments[5]:void 0,u=arguments.length>6?arguments[6]:void 0,c=arguments.length>7?arguments[7]:void 0,l=arguments.length>8&&void 0!==arguments[8]?arguments[8]:Ot,f=arguments.length>9&&void 0!==arguments[9]?arguments[9]:Ot,h=arguments.length>10?arguments[10]:void 0,p=arguments.length>11?arguments[11]:void 0;return w(this,e),(t=d(this,e,[null,s,u,c,l,f,o,a,h,p])).isDataTexture=!0,t.image={data:n,width:r,height:i},t.generateMipmaps=!1,t.flipY=!1,t.unpackAlignment=1,t}return v(e,t),T(e)}(ur),ms=new Hr,ys=new Hr,vs=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];w(this,t),this.uuid=Nn(),this.bones=e.slice(0),this.boneInverses=n,this.boneMatrices=null,this.boneTexture=null,this.init()}return T(t,[{key:"init",value:function(){var t=this.bones,e=this.boneInverses;if(this.boneMatrices=new Float32Array(16*t.length),0===e.length)this.calculateInverses();else if(t.length!==e.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(var n=0,r=this.bones.length;n<r;n++)this.boneInverses.push(new Hr)}}},{key:"calculateInverses",value:function(){this.boneInverses.length=0;for(var t=0,e=this.bones.length;t<e;t++){var n=new Hr;this.bones[t]&&n.copy(this.bones[t].matrixWorld).invert(),this.boneInverses.push(n)}}},{key:"pose",value:function(){for(var t=0,e=this.bones.length;t<e;t++){var n=this.bones[t];n&&n.matrixWorld.copy(this.boneInverses[t]).invert()}for(var r=0,i=this.bones.length;r<i;r++){var o=this.bones[r];o&&(o.parent&&o.parent.isBone?(o.matrix.copy(o.parent.matrixWorld).invert(),o.matrix.multiply(o.matrixWorld)):o.matrix.copy(o.matrixWorld),o.matrix.decompose(o.position,o.quaternion,o.scale))}}},{key:"update",value:function(){for(var t=this.bones,e=this.boneInverses,n=this.boneMatrices,r=this.boneTexture,i=0,o=t.length;i<o;i++){var a=t[i]?t[i].matrixWorld:ys;ms.multiplyMatrices(a,e[i]),ms.toArray(n,16*i)}null!==r&&(r.needsUpdate=!0)}},{key:"clone",value:function(){return new t(this.bones,this.boneInverses)}},{key:"computeBoneTexture",value:function(){var t=Math.sqrt(4*this.bones.length);t=4*Math.ceil(t/4),t=Math.max(t,4);var e=new Float32Array(t*t*4);e.set(this.boneMatrices);var n=new ds(e,t,t,Jt,zt);return n.needsUpdate=!0,this.boneMatrices=e,this.boneTexture=n,this}},{key:"getBoneByName",value:function(t){for(var e=0,n=this.bones.length;e<n;e++){var r=this.bones[e];if(r.name===t)return r}}},{key:"dispose",value:function(){null!==this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=null)}},{key:"fromJSON",value:function(t,e){this.uuid=t.uuid;for(var n=0,r=t.bones.length;n<r;n++){var i=t.bones[n],o=e[i];void 0===o&&(console.warn("THREE.Skeleton: No bone found with UUID:",i),o=new ps),this.bones.push(o),this.boneInverses.push((new Hr).fromArray(t.boneInverses[n]))}return this.init(),this}},{key:"toJSON",value:function(){var t={metadata:{version:4.6,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};t.uuid=this.uuid;for(var e=this.bones,n=this.boneInverses,r=0,i=e.length;r<i;r++){var o=e[r];t.bones.push(o.uuid);var a=n[r];t.boneInverses.push(a.toArray())}return t}}])}(),gs=function(t){function e(t,n,r){var i,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return w(this,e),(i=d(this,e,[t,n,r])).isInstancedBufferAttribute=!0,i.meshPerAttribute=o,i}return v(e,t),T(e,[{key:"copy",value:function(t){return l(y(e.prototype),"copy",this).call(this,t),this.meshPerAttribute=t.meshPerAttribute,this}},{key:"toJSON",value:function(){var t=l(y(e.prototype),"toJSON",this).call(this);return t.meshPerAttribute=this.meshPerAttribute,t.isInstancedBufferAttribute=!0,t}}])}(Hi),bs=new Hr,_s=new Hr,xs=[],ws=new vr,Ss=new Hr,Ts=new xo,Ms=new jr,Es=function(t){function e(t,n,r){var i;w(this,e),(i=d(this,e,[t,n])).isInstancedMesh=!0,i.instanceMatrix=new gs(new Float32Array(16*r),16),i.instanceColor=null,i.morphTexture=null,i.count=r,i.boundingBox=null,i.boundingSphere=null;for(var o=0;o<r;o++)i.setMatrixAt(o,Ss);return i}return v(e,t),T(e,[{key:"computeBoundingBox",value:function(){var t=this.geometry,e=this.count;null===this.boundingBox&&(this.boundingBox=new vr),null===t.boundingBox&&t.computeBoundingBox(),this.boundingBox.makeEmpty();for(var n=0;n<e;n++)this.getMatrixAt(n,bs),ws.copy(t.boundingBox).applyMatrix4(bs),this.boundingBox.union(ws)}},{key:"computeBoundingSphere",value:function(){var t=this.geometry,e=this.count;null===this.boundingSphere&&(this.boundingSphere=new jr),null===t.boundingSphere&&t.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(var n=0;n<e;n++)this.getMatrixAt(n,bs),Ms.copy(t.boundingSphere).applyMatrix4(bs),this.boundingSphere.union(Ms)}},{key:"copy",value:function(t,n){return l(y(e.prototype),"copy",this).call(this,t,n),this.instanceMatrix.copy(t.instanceMatrix),null!==t.morphTexture&&(this.morphTexture=t.morphTexture.clone()),null!==t.instanceColor&&(this.instanceColor=t.instanceColor.clone()),this.count=t.count,null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone()),null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),this}},{key:"getColorAt",value:function(t,e){e.fromArray(this.instanceColor.array,3*t)}},{key:"getMatrixAt",value:function(t,e){e.fromArray(this.instanceMatrix.array,16*t)}},{key:"getMorphAt",value:function(t,e){for(var n=e.morphTargetInfluences,r=this.morphTexture.source.data.data,i=t*(n.length+1)+1,o=0;o<n.length;o++)n[o]=r[i+o]}},{key:"raycast",value:function(t,e){var n=this.matrixWorld,r=this.count;if(Ts.geometry=this.geometry,Ts.material=this.material,void 0!==Ts.material&&(null===this.boundingSphere&&this.computeBoundingSphere(),Ms.copy(this.boundingSphere),Ms.applyMatrix4(n),!1!==t.ray.intersectsSphere(Ms)))for(var i=0;i<r;i++){this.getMatrixAt(i,bs),_s.multiplyMatrices(n,bs),Ts.matrixWorld=_s,Ts.raycast(t,xs);for(var o=0,a=xs.length;o<a;o++){var s=xs[o];s.instanceId=i,s.object=this,e.push(s)}xs.length=0}}},{key:"setColorAt",value:function(t,e){null===this.instanceColor&&(this.instanceColor=new gs(new Float32Array(3*this.instanceMatrix.count),3)),e.toArray(this.instanceColor.array,3*t)}},{key:"setMatrixAt",value:function(t,e){e.toArray(this.instanceMatrix.array,16*t)}},{key:"setMorphAt",value:function(t,e){var n=e.morphTargetInfluences,r=n.length+1;null===this.morphTexture&&(this.morphTexture=new ds(new Float32Array(r*this.count),r,this.count,te,zt));for(var i=this.morphTexture.source.data.data,o=0,a=0;a<n.length;a++)o+=n[a];var s=this.geometry.morphTargetsRelative?1:1-o,u=r*t;i[u]=s,i.set(n,u+1)}},{key:"updateMorphTargets",value:function(){}},{key:"dispose",value:function(){return this.dispatchEvent({type:"dispose"}),null!==this.morphTexture&&(this.morphTexture.dispose(),this.morphTexture=null),this}}])}(xo);function As(t,e){return t.z-e.z}function Os(t,e){return e.z-t.z}var Ps=function(){return T((function t(){w(this,t),this.index=0,this.pool=[],this.list=[]}),[{key:"push",value:function(t,e){var n=this.pool,r=this.list;this.index>=n.length&&n.push({start:-1,count:-1,z:-1});var i=n[this.index];r.push(i),this.index++,i.start=t.start,i.count=t.count,i.z=e}},{key:"reset",value:function(){this.list.length=0,this.index=0}}])}(),Rs="batchId",ks=new Hr,Cs=new Hr,Ns=new Hr,Ls=new Hr,js=new Go,Is=new vr,Bs=new jr,Us=new dr,Ds=new Ps,Fs=new xo,zs=[];function Vs(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=e.itemSize;if(t.isInterleavedBufferAttribute||t.array.constructor!==e.array.constructor)for(var i=t.count,o=0;o<i;o++)for(var a=0;a<r;a++)e.setComponent(o+n,a,t.getComponent(o,a));else e.array.set(t.array,n*r);e.needsUpdate=!0}var Gs=function(t){function e(t,n){var r,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2*n,o=arguments.length>3?arguments[3]:void 0;return w(this,e),(r=d(this,e,[new no,o])).isBatchedMesh=!0,r.perObjectFrustumCulled=!0,r.sortObjects=!0,r.boundingBox=null,r.boundingSphere=null,r.customSort=null,r._drawRanges=[],r._reservedRanges=[],r._visibility=[],r._active=[],r._bounds=[],r._maxGeometryCount=t,r._maxVertexCount=n,r._maxIndexCount=i,r._geometryInitialized=!1,r._geometryCount=0,r._multiDrawCounts=new Int32Array(t),r._multiDrawStarts=new Int32Array(t),r._multiDrawCount=0,r._visibilityChanged=!0,r._matricesTexture=null,r._initMatricesTexture(),r}return v(e,t),T(e,[{key:"maxGeometryCount",get:function(){return this._maxGeometryCount}},{key:"_initMatricesTexture",value:function(){var t=Math.sqrt(4*this._maxGeometryCount);t=4*Math.ceil(t/4),t=Math.max(t,4);var e=new Float32Array(t*t*4),n=new ds(e,t,t,Jt,zt);this._matricesTexture=n}},{key:"_initializeGeometry",value:function(t){var e=this.geometry,n=this._maxVertexCount,r=this._maxGeometryCount,i=this._maxIndexCount;if(!1===this._geometryInitialized){for(var o in t.attributes){var a=t.getAttribute(o),s=a.array,u=a.itemSize,c=a.normalized,l=new s.constructor(n*u),f=new Hi(l,u,c);e.setAttribute(o,f)}if(null!==t.getIndex()){var h=n>65536?new Uint32Array(i):new Uint16Array(i);e.setIndex(new Hi(h,1))}var p=r>65536?new Uint32Array(n):new Uint16Array(n);e.setAttribute(Rs,new Hi(p,1)),this._geometryInitialized=!0}}},{key:"_validateGeometry",value:function(t){if(t.getAttribute(Rs))throw new Error('BatchedMesh: Geometry cannot use attribute "'.concat(Rs,'"'));var e=this.geometry;if(Boolean(t.getIndex())!==Boolean(e.getIndex()))throw new Error('BatchedMesh: All geometries must consistently have "index".');for(var n in e.attributes)if(n!==Rs){if(!t.hasAttribute(n))throw new Error('BatchedMesh: Added geometry missing "'.concat(n,'". All geometries must have consistent attributes.'));var r=t.getAttribute(n),i=e.getAttribute(n);if(r.itemSize!==i.itemSize||r.normalized!==i.normalized)throw new Error("BatchedMesh: All attributes must have a consistent itemSize and normalized value.")}}},{key:"setCustomSort",value:function(t){return this.customSort=t,this}},{key:"computeBoundingBox",value:function(){null===this.boundingBox&&(this.boundingBox=new vr);var t=this._geometryCount,e=this.boundingBox,n=this._active;e.makeEmpty();for(var r=0;r<t;r++)!1!==n[r]&&(this.getMatrixAt(r,ks),this.getBoundingBoxAt(r,Is).applyMatrix4(ks),e.union(Is))}},{key:"computeBoundingSphere",value:function(){null===this.boundingSphere&&(this.boundingSphere=new jr);var t=this._geometryCount,e=this.boundingSphere,n=this._active;e.makeEmpty();for(var r=0;r<t;r++)!1!==n[r]&&(this.getMatrixAt(r,ks),this.getBoundingSphereAt(r,Bs).applyMatrix4(ks),e.union(Bs))}},{key:"addGeometry",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;if(this._initializeGeometry(t),this._validateGeometry(t),this._geometryCount>=this._maxGeometryCount)throw new Error("BatchedMesh: Maximum geometry count reached.");var r={vertexStart:-1,vertexCount:-1,indexStart:-1,indexCount:-1},i=null,o=this._reservedRanges,a=this._drawRanges,s=this._bounds;0!==this._geometryCount&&(i=o[o.length-1]),r.vertexCount=-1===e?t.getAttribute("position").count:e,r.vertexStart=null===i?0:i.vertexStart+i.vertexCount;var u=t.getIndex(),c=null!==u;if(c&&(r.indexCount=-1===n?u.count:n,r.indexStart=null===i?0:i.indexStart+i.indexCount),-1!==r.indexStart&&r.indexStart+r.indexCount>this._maxIndexCount||r.vertexStart+r.vertexCount>this._maxVertexCount)throw new Error("BatchedMesh: Reserved space request exceeds the maximum buffer size.");var l=this._visibility,f=this._active,h=this._matricesTexture,p=this._matricesTexture.image.data;l.push(!0),f.push(!0);var d=this._geometryCount;this._geometryCount++,Ns.toArray(p,16*d),h.needsUpdate=!0,o.push(r),a.push({start:c?r.indexStart:r.vertexStart,count:-1}),s.push({boxInitialized:!1,box:new vr,sphereInitialized:!1,sphere:new jr});for(var m=this.geometry.getAttribute(Rs),y=0;y<r.vertexCount;y++)m.setX(r.vertexStart+y,d);return m.needsUpdate=!0,this.setGeometryAt(d,t),d}},{key:"setGeometryAt",value:function(t,e){if(t>=this._geometryCount)throw new Error("BatchedMesh: Maximum geometry count reached.");this._validateGeometry(e);var n=this.geometry,r=null!==n.getIndex(),i=n.getIndex(),o=e.getIndex(),a=this._reservedRanges[t];if(r&&o.count>a.indexCount||e.attributes.position.count>a.vertexCount)throw new Error("BatchedMesh: Reserved space not large enough for provided geometry.");var s=a.vertexStart,u=a.vertexCount;for(var c in n.attributes)if(c!==Rs){var l=e.getAttribute(c),f=n.getAttribute(c);Vs(l,f,s);for(var h=l.itemSize,p=l.count,d=u;p<d;p++)for(var m=s+p,y=0;y<h;y++)f.setComponent(m,y,0);f.needsUpdate=!0,f.addUpdateRange(s*h,u*h)}if(r){for(var v=a.indexStart,g=0;g<o.count;g++)i.setX(v+g,s+o.getX(g));for(var b=o.count,_=a.indexCount;b<_;b++)i.setX(v+b,s);i.needsUpdate=!0,i.addUpdateRange(v,a.indexCount)}var x=this._bounds[t];null!==e.boundingBox?(x.box.copy(e.boundingBox),x.boxInitialized=!0):x.boxInitialized=!1,null!==e.boundingSphere?(x.sphere.copy(e.boundingSphere),x.sphereInitialized=!0):x.sphereInitialized=!1;var w=this._drawRanges[t],S=e.getAttribute("position");return w.count=r?o.count:S.count,this._visibilityChanged=!0,t}},{key:"deleteGeometry",value:function(t){var e=this._active;return t>=e.length||!1===e[t]||(e[t]=!1,this._visibilityChanged=!0),this}},{key:"getBoundingBoxAt",value:function(t,e){if(!1===this._active[t])return null;var n=this._bounds[t],r=n.box,i=this.geometry;if(!1===n.boxInitialized){r.makeEmpty();for(var o=i.index,a=i.attributes.position,s=this._drawRanges[t],u=s.start,c=s.start+s.count;u<c;u++){var l=u;o&&(l=o.getX(l)),r.expandByPoint(Us.fromBufferAttribute(a,l))}n.boxInitialized=!0}return e.copy(r),e}},{key:"getBoundingSphereAt",value:function(t,e){if(!1===this._active[t])return null;var n=this._bounds[t],r=n.sphere,i=this.geometry;if(!1===n.sphereInitialized){r.makeEmpty(),this.getBoundingBoxAt(t,Is),Is.getCenter(r.center);for(var o=i.index,a=i.attributes.position,s=this._drawRanges[t],u=0,c=s.start,l=s.start+s.count;c<l;c++){var f=c;o&&(f=o.getX(f)),Us.fromBufferAttribute(a,f),u=Math.max(u,r.center.distanceToSquared(Us))}r.radius=Math.sqrt(u),n.sphereInitialized=!0}return e.copy(r),e}},{key:"setMatrixAt",value:function(t,e){var n=this._active,r=this._matricesTexture,i=this._matricesTexture.image.data;return t>=this._geometryCount||!1===n[t]||(e.toArray(i,16*t),r.needsUpdate=!0),this}},{key:"getMatrixAt",value:function(t,e){var n=this._active,r=this._matricesTexture.image.data;return t>=this._geometryCount||!1===n[t]?null:e.fromArray(r,16*t)}},{key:"setVisibleAt",value:function(t,e){var n=this._visibility,r=this._active;return t>=this._geometryCount||!1===r[t]||n[t]===e||(n[t]=e,this._visibilityChanged=!0),this}},{key:"getVisibleAt",value:function(t){var e=this._visibility,n=this._active;return!(t>=this._geometryCount||!1===n[t])&&e[t]}},{key:"raycast",value:function(t,e){var n=this._visibility,r=this._active,i=this._drawRanges,o=this._geometryCount,a=this.matrixWorld,s=this.geometry;Fs.material=this.material,Fs.geometry.index=s.index,Fs.geometry.attributes=s.attributes,null===Fs.geometry.boundingBox&&(Fs.geometry.boundingBox=new vr),null===Fs.geometry.boundingSphere&&(Fs.geometry.boundingSphere=new jr);for(var u=0;u<o;u++)if(n[u]&&r[u]){var c=i[u];Fs.geometry.setDrawRange(c.start,c.count),this.getMatrixAt(u,Fs.matrixWorld).premultiply(a),this.getBoundingBoxAt(u,Fs.geometry.boundingBox),this.getBoundingSphereAt(u,Fs.geometry.boundingSphere),Fs.raycast(t,zs);for(var l=0,f=zs.length;l<f;l++){var h=zs[l];h.object=this,h.batchId=u,e.push(h)}zs.length=0}Fs.material=null,Fs.geometry.index=null,Fs.geometry.attributes={},Fs.geometry.setDrawRange(0,1/0)}},{key:"copy",value:function(t){return l(y(e.prototype),"copy",this).call(this,t),this.geometry=t.geometry.clone(),this.perObjectFrustumCulled=t.perObjectFrustumCulled,this.sortObjects=t.sortObjects,this.boundingBox=null!==t.boundingBox?t.boundingBox.clone():null,this.boundingSphere=null!==t.boundingSphere?t.boundingSphere.clone():null,this._drawRanges=t._drawRanges.map((function(t){return o({},t)})),this._reservedRanges=t._reservedRanges.map((function(t){return o({},t)})),this._visibility=t._visibility.slice(),this._active=t._active.slice(),this._bounds=t._bounds.map((function(t){return{boxInitialized:t.boxInitialized,box:t.box.clone(),sphereInitialized:t.sphereInitialized,sphere:t.sphere.clone()}})),this._maxGeometryCount=t._maxGeometryCount,this._maxVertexCount=t._maxVertexCount,this._maxIndexCount=t._maxIndexCount,this._geometryInitialized=t._geometryInitialized,this._geometryCount=t._geometryCount,this._multiDrawCounts=t._multiDrawCounts.slice(),this._multiDrawStarts=t._multiDrawStarts.slice(),this._matricesTexture=t._matricesTexture.clone(),this._matricesTexture.image.data=this._matricesTexture.image.slice(),this}},{key:"dispose",value:function(){return this.geometry.dispose(),this._matricesTexture.dispose(),this._matricesTexture=null,this}},{key:"onBeforeRender",value:function(t,e,n,r,i){if(this._visibilityChanged||this.perObjectFrustumCulled||this.sortObjects){var o=r.getIndex(),a=null===o?1:o.array.BYTES_PER_ELEMENT,s=this._active,u=this._visibility,c=this._multiDrawStarts,l=this._multiDrawCounts,f=this._drawRanges,h=this.perObjectFrustumCulled;h&&(Ls.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse).multiply(this.matrixWorld),js.setFromProjectionMatrix(Ls,t.coordinateSystem));var p=0;if(this.sortObjects){Cs.copy(this.matrixWorld).invert(),Us.setFromMatrixPosition(n.matrixWorld).applyMatrix4(Cs);for(var d=0,m=u.length;d<m;d++)if(u[d]&&s[d]){this.getMatrixAt(d,ks),this.getBoundingSphereAt(d,Bs).applyMatrix4(ks);var y=!1;if(h&&(y=!js.intersectsSphere(Bs)),!y){var v=Us.distanceTo(Bs.center);Ds.push(f[d],v)}}var g=Ds.list,b=this.customSort;null===b?g.sort(i.transparent?Os:As):b.call(this,g,n);for(var _=0,x=g.length;_<x;_++){var w=g[_];c[p]=w.start*a,l[p]=w.count,p++}Ds.reset()}else for(var S=0,T=u.length;S<T;S++)if(u[S]&&s[S]){var M=!1;if(h&&(this.getMatrixAt(S,ks),this.getBoundingSphereAt(S,Bs).applyMatrix4(ks),M=!js.intersectsSphere(Bs)),!M){var E=f[S];c[p]=E.start*a,l[p]=E.count,p++}}this._multiDrawCount=p,this._visibilityChanged=!1}}},{key:"onBeforeShadow",value:function(t,e,n,r,i,o){this.onBeforeRender(t,null,r,i,o)}}])}(xo),Hs=function(t){function e(t){var n;return w(this,e),(n=d(this,e)).isLineBasicMaterial=!0,n.type="LineBasicMaterial",n.color=new Ni(16777215),n.map=null,n.linewidth=1,n.linecap="round",n.linejoin="round",n.fog=!0,n.setValues(t),n}return v(e,t),T(e,[{key:"copy",value:function(t){return l(y(e.prototype),"copy",this).call(this,t),this.color.copy(t.color),this.map=t.map,this.linewidth=t.linewidth,this.linecap=t.linecap,this.linejoin=t.linejoin,this.fog=t.fog,this}}])}(Ii),Ws=new dr,qs=new dr,Xs=new Hr,Ys=new Gr,Js=new jr,Zs=function(t){function e(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new no,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Hs;return w(this,e),(t=d(this,e)).isLine=!0,t.type="Line",t.geometry=n,t.material=r,t.updateMorphTargets(),t}return v(e,t),T(e,[{key:"copy",value:function(t,n){return l(y(e.prototype),"copy",this).call(this,t,n),this.material=Array.isArray(t.material)?t.material.slice():t.material,this.geometry=t.geometry,this}},{key:"computeLineDistances",value:function(){var t=this.geometry;if(null===t.index){for(var e=t.attributes.position,n=[0],r=1,i=e.count;r<i;r++)Ws.fromBufferAttribute(e,r-1),qs.fromBufferAttribute(e,r),n[r]=n[r-1],n[r]+=Ws.distanceTo(qs);t.setAttribute("lineDistance",new Yi(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}},{key:"raycast",value:function(t,e){var n=this.geometry,r=this.matrixWorld,i=t.params.Line.threshold,o=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),Js.copy(n.boundingSphere),Js.applyMatrix4(r),Js.radius+=i,!1!==t.ray.intersectsSphere(Js)){Xs.copy(r).invert(),Ys.copy(t.ray).applyMatrix4(Xs);var a=i/((this.scale.x+this.scale.y+this.scale.z)/3),s=a*a,u=new dr,c=new dr,l=new dr,f=new dr,h=this.isLineSegments?2:1,p=n.index,d=n.attributes.position;if(null!==p)for(var m=Math.max(0,o.start),y=Math.min(p.count,o.start+o.count)-1;m<y;m+=h){var v=p.getX(m),g=p.getX(m+1);if(u.fromBufferAttribute(d,v),c.fromBufferAttribute(d,g),!(Ys.distanceSqToSegment(u,c,f,l)>s)){f.applyMatrix4(this.matrixWorld);var b=t.ray.origin.distanceTo(f);b<t.near||b>t.far||e.push({distance:b,point:l.clone().applyMatrix4(this.matrixWorld),index:m,face:null,faceIndex:null,object:this})}}else for(var _=Math.max(0,o.start),x=Math.min(d.count,o.start+o.count)-1;_<x;_+=h)if(u.fromBufferAttribute(d,_),c.fromBufferAttribute(d,_+1),!(Ys.distanceSqToSegment(u,c,f,l)>s)){f.applyMatrix4(this.matrixWorld);var w=t.ray.origin.distanceTo(f);w<t.near||w>t.far||e.push({distance:w,point:l.clone().applyMatrix4(this.matrixWorld),index:_,face:null,faceIndex:null,object:this})}}}},{key:"updateMorphTargets",value:function(){var t=this.geometry.morphAttributes,e=Object.keys(t);if(e.length>0){var n=t[e[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(var r=0,i=n.length;r<i;r++){var o=n[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=r}}}}}])}(vi),Ks=new dr,Qs=new dr,$s=function(t){function e(t,n){var r;return w(this,e),(r=d(this,e,[t,n])).isLineSegments=!0,r.type="LineSegments",r}return v(e,t),T(e,[{key:"computeLineDistances",value:function(){var t=this.geometry;if(null===t.index){for(var e=t.attributes.position,n=[],r=0,i=e.count;r<i;r+=2)Ks.fromBufferAttribute(e,r),Qs.fromBufferAttribute(e,r+1),n[r]=0===r?0:n[r-1],n[r+1]=n[r]+Ks.distanceTo(Qs);t.setAttribute("lineDistance",new Yi(n,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}])}(Zs),tu=function(t){function e(t,n){var r;return w(this,e),(r=d(this,e,[t,n])).isLineLoop=!0,r.type="LineLoop",r}return v(e,t),T(e)}(Zs),eu=function(t){function e(t){var n;return w(this,e),(n=d(this,e)).isPointsMaterial=!0,n.type="PointsMaterial",n.color=new Ni(16777215),n.map=null,n.alphaMap=null,n.size=1,n.sizeAttenuation=!0,n.fog=!0,n.setValues(t),n}return v(e,t),T(e,[{key:"copy",value:function(t){return l(y(e.prototype),"copy",this).call(this,t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.size=t.size,this.sizeAttenuation=t.sizeAttenuation,this.fog=t.fog,this}}])}(Ii),nu=new Hr,ru=new Gr,iu=new jr,ou=new dr,au=function(t){function e(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new no,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new eu;return w(this,e),(t=d(this,e)).isPoints=!0,t.type="Points",t.geometry=n,t.material=r,t.updateMorphTargets(),t}return v(e,t),T(e,[{key:"copy",value:function(t,n){return l(y(e.prototype),"copy",this).call(this,t,n),this.material=Array.isArray(t.material)?t.material.slice():t.material,this.geometry=t.geometry,this}},{key:"raycast",value:function(t,e){var n=this.geometry,r=this.matrixWorld,i=t.params.Points.threshold,o=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),iu.copy(n.boundingSphere),iu.applyMatrix4(r),iu.radius+=i,!1!==t.ray.intersectsSphere(iu)){nu.copy(r).invert(),ru.copy(t.ray).applyMatrix4(nu);var a=i/((this.scale.x+this.scale.y+this.scale.z)/3),s=a*a,u=n.index,c=n.attributes.position;if(null!==u)for(var l=Math.max(0,o.start),f=Math.min(u.count,o.start+o.count);l<f;l++){var h=u.getX(l);ou.fromBufferAttribute(c,h),su(ou,h,s,r,t,e,this)}else for(var p=Math.max(0,o.start),d=Math.min(c.count,o.start+o.count);p<d;p++)ou.fromBufferAttribute(c,p),su(ou,p,s,r,t,e,this)}}},{key:"updateMorphTargets",value:function(){var t=this.geometry.morphAttributes,e=Object.keys(t);if(e.length>0){var n=t[e[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(var r=0,i=n.length;r<i;r++){var o=n[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=r}}}}}])}(vi);function su(t,e,n,r,i,o,a){var s=ru.distanceSqToPoint(t);if(s<n){var u=new dr;ru.closestPointToPoint(t,u),u.applyMatrix4(r);var c=i.ray.origin.distanceTo(u);if(c<i.near||c>i.far)return;o.push({distance:c,distanceToRay:Math.sqrt(s),point:u,index:e,face:null,object:a})}}var uu=function(t){function e(t,n){var r;return w(this,e),(r=d(this,e,[{width:t,height:n}])).isFramebufferTexture=!0,r.magFilter=Ot,r.minFilter=Ot,r.generateMipmaps=!1,r.needsUpdate=!0,r}return v(e,t),T(e)}(ur),cu=function(){return T((function t(){w(this,t),this.type="Curve",this.arcLengthDivisions=200}),[{key:"getPoint",value:function(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}},{key:"getPointAt",value:function(t,e){var n=this.getUtoTmapping(t);return this.getPoint(n,e)}},{key:"getPoints",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5,e=[],n=0;n<=t;n++)e.push(this.getPoint(n/t));return e}},{key:"getSpacedPoints",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5,e=[],n=0;n<=t;n++)e.push(this.getPointAt(n/t));return e}},{key:"getLength",value:function(){var t=this.getLengths();return t[t.length-1]}},{key:"getLengths",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.arcLengthDivisions;if(this.cacheArcLengths&&this.cacheArcLengths.length===t+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var e,n=[],r=this.getPoint(0),i=0;n.push(0);for(var o=1;o<=t;o++)i+=(e=this.getPoint(o/t)).distanceTo(r),n.push(i),r=e;return this.cacheArcLengths=n,n}},{key:"updateArcLengths",value:function(){this.needsUpdate=!0,this.getLengths()}},{key:"getUtoTmapping",value:function(t,e){var n,r=this.getLengths(),i=0,o=r.length;n=e||t*r[o-1];for(var a,s=0,u=o-1;s<=u;)if((a=r[i=Math.floor(s+(u-s)/2)]-n)<0)s=i+1;else{if(!(a>0)){u=i;break}u=i-1}if(r[i=u]===n)return i/(o-1);var c=r[i];return(i+(n-c)/(r[i+1]-c))/(o-1)}},{key:"getTangent",value:function(t,e){var n=1e-4,r=t-n,i=t+n;r<0&&(r=0),i>1&&(i=1);var o=this.getPoint(r),a=this.getPoint(i),s=e||(o.isVector2?new Fn:new dr);return s.copy(a).sub(o).normalize(),s}},{key:"getTangentAt",value:function(t,e){var n=this.getUtoTmapping(t);return this.getTangent(n,e)}},{key:"computeFrenetFrames",value:function(t,e){for(var n=new dr,r=[],i=[],o=[],a=new dr,s=new Hr,u=0;u<=t;u++){var c=u/t;r[u]=this.getTangentAt(c,new dr)}i[0]=new dr,o[0]=new dr;var l=Number.MAX_VALUE,f=Math.abs(r[0].x),h=Math.abs(r[0].y),p=Math.abs(r[0].z);f<=l&&(l=f,n.set(1,0,0)),h<=l&&(l=h,n.set(0,1,0)),p<=l&&n.set(0,0,1),a.crossVectors(r[0],n).normalize(),i[0].crossVectors(r[0],a),o[0].crossVectors(r[0],i[0]);for(var d=1;d<=t;d++){if(i[d]=i[d-1].clone(),o[d]=o[d-1].clone(),a.crossVectors(r[d-1],r[d]),a.length()>Number.EPSILON){a.normalize();var m=Math.acos(Ln(r[d-1].dot(r[d]),-1,1));i[d].applyMatrix4(s.makeRotationAxis(a,m))}o[d].crossVectors(r[d],i[d])}if(!0===e){var y=Math.acos(Ln(i[0].dot(i[t]),-1,1));y/=t,r[0].dot(a.crossVectors(i[0],i[t]))>0&&(y=-y);for(var v=1;v<=t;v++)i[v].applyMatrix4(s.makeRotationAxis(r[v],y*v)),o[v].crossVectors(r[v],i[v])}return{tangents:r,normals:i,binormals:o}}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}},{key:"toJSON",value:function(){var t={metadata:{version:4.6,type:"Curve",generator:"Curve.toJSON"}};return t.arcLengthDivisions=this.arcLengthDivisions,t.type=this.type,t}},{key:"fromJSON",value:function(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}}])}(),lu=function(t){function e(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:2*Math.PI,u=arguments.length>6&&void 0!==arguments[6]&&arguments[6],c=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0;return w(this,e),(t=d(this,e)).isEllipseCurve=!0,t.type="EllipseCurve",t.aX=n,t.aY=r,t.xRadius=i,t.yRadius=o,t.aStartAngle=a,t.aEndAngle=s,t.aClockwise=u,t.aRotation=c,t}return v(e,t),T(e,[{key:"getPoint",value:function(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Fn,n=2*Math.PI,r=this.aEndAngle-this.aStartAngle,i=Math.abs(r)<Number.EPSILON;r<0;)r+=n;for(;r>n;)r-=n;r<Number.EPSILON&&(r=i?0:n),!0!==this.aClockwise||i||(r===n?r=-n:r-=n);var o=this.aStartAngle+t*r,a=this.aX+this.xRadius*Math.cos(o),s=this.aY+this.yRadius*Math.sin(o);if(0!==this.aRotation){var u=Math.cos(this.aRotation),c=Math.sin(this.aRotation),l=a-this.aX,f=s-this.aY;a=l*u-f*c+this.aX,s=l*c+f*u+this.aY}return e.set(a,s)}},{key:"copy",value:function(t){return l(y(e.prototype),"copy",this).call(this,t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this}},{key:"toJSON",value:function(){var t=l(y(e.prototype),"toJSON",this).call(this);return t.aX=this.aX,t.aY=this.aY,t.xRadius=this.xRadius,t.yRadius=this.yRadius,t.aStartAngle=this.aStartAngle,t.aEndAngle=this.aEndAngle,t.aClockwise=this.aClockwise,t.aRotation=this.aRotation,t}},{key:"fromJSON",value:function(t){return l(y(e.prototype),"fromJSON",this).call(this,t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this}}])}(cu),fu=function(t){function e(t,n,r,i,o,a){var s;return w(this,e),(s=d(this,e,[t,n,r,r,i,o,a])).isArcCurve=!0,s.type="ArcCurve",s}return v(e,t),T(e)}(lu);function hu(){var t=0,e=0,n=0,r=0;function i(i,o,a,s){t=i,e=a,n=-3*i+3*o-2*a-s,r=2*i-2*o+a+s}return{initCatmullRom:function(t,e,n,r,o){i(e,n,o*(n-t),o*(r-e))},initNonuniformCatmullRom:function(t,e,n,r,o,a,s){var u=(e-t)/o-(n-t)/(o+a)+(n-e)/a,c=(n-e)/a-(r-e)/(a+s)+(r-n)/s;i(e,n,u*=a,c*=a)},calc:function(i){var o=i*i;return t+e*i+n*o+r*(o*i)}}}var pu=new dr,du=new hu,mu=new hu,yu=new hu,vu=function(t){function e(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"centripetal",o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5;return w(this,e),(t=d(this,e)).isCatmullRomCurve3=!0,t.type="CatmullRomCurve3",t.points=n,t.closed=r,t.curveType=i,t.tension=o,t}return v(e,t),T(e,[{key:"getPoint",value:function(t){var e,n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new dr,i=this.points,o=i.length,a=(o-(this.closed?0:1))*t,s=Math.floor(a),u=a-s;this.closed?s+=s>0?0:(Math.floor(Math.abs(s)/o)+1)*o:0===u&&s===o-1&&(s=o-2,u=1),this.closed||s>0?e=i[(s-1)%o]:(pu.subVectors(i[0],i[1]).add(i[0]),e=pu);var c=i[s%o],l=i[(s+1)%o];if(this.closed||s+2<o?n=i[(s+2)%o]:(pu.subVectors(i[o-1],i[o-2]).add(i[o-1]),n=pu),"centripetal"===this.curveType||"chordal"===this.curveType){var f="chordal"===this.curveType?.5:.25,h=Math.pow(e.distanceToSquared(c),f),p=Math.pow(c.distanceToSquared(l),f),d=Math.pow(l.distanceToSquared(n),f);p<1e-4&&(p=1),h<1e-4&&(h=p),d<1e-4&&(d=p),du.initNonuniformCatmullRom(e.x,c.x,l.x,n.x,h,p,d),mu.initNonuniformCatmullRom(e.y,c.y,l.y,n.y,h,p,d),yu.initNonuniformCatmullRom(e.z,c.z,l.z,n.z,h,p,d)}else"catmullrom"===this.curveType&&(du.initCatmullRom(e.x,c.x,l.x,n.x,this.tension),mu.initCatmullRom(e.y,c.y,l.y,n.y,this.tension),yu.initCatmullRom(e.z,c.z,l.z,n.z,this.tension));return r.set(du.calc(u),mu.calc(u),yu.calc(u)),r}},{key:"copy",value:function(t){l(y(e.prototype),"copy",this).call(this,t),this.points=[];for(var n=0,r=t.points.length;n<r;n++){var i=t.points[n];this.points.push(i.clone())}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this}},{key:"toJSON",value:function(){var t=l(y(e.prototype),"toJSON",this).call(this);t.points=[];for(var n=0,r=this.points.length;n<r;n++){var i=this.points[n];t.points.push(i.toArray())}return t.closed=this.closed,t.curveType=this.curveType,t.tension=this.tension,t}},{key:"fromJSON",value:function(t){l(y(e.prototype),"fromJSON",this).call(this,t),this.points=[];for(var n=0,r=t.points.length;n<r;n++){var i=t.points[n];this.points.push((new dr).fromArray(i))}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this}}])}(cu);function gu(t,e,n,r,i){var o=.5*(r-e),a=.5*(i-n),s=t*t;return(2*n-2*r+o+a)*(t*s)+(-3*n+3*r-2*o-a)*s+o*t+n}function bu(t,e,n,r){return function(t,e){var n=1-t;return n*n*e}(t,e)+function(t,e){return 2*(1-t)*t*e}(t,n)+function(t,e){return t*t*e}(t,r)}function _u(t,e,n,r,i){return function(t,e){var n=1-t;return n*n*n*e}(t,e)+function(t,e){var n=1-t;return 3*n*n*t*e}(t,n)+function(t,e){return 3*(1-t)*t*t*e}(t,r)+function(t,e){return t*t*t*e}(t,i)}var xu=function(t){function e(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Fn,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Fn,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Fn,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Fn;return w(this,e),(t=d(this,e)).isCubicBezierCurve=!0,t.type="CubicBezierCurve",t.v0=n,t.v1=r,t.v2=i,t.v3=o,t}return v(e,t),T(e,[{key:"getPoint",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Fn,n=this.v0,r=this.v1,i=this.v2,o=this.v3;return e.set(_u(t,n.x,r.x,i.x,o.x),_u(t,n.y,r.y,i.y,o.y)),e}},{key:"copy",value:function(t){return l(y(e.prototype),"copy",this).call(this,t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this}},{key:"toJSON",value:function(){var t=l(y(e.prototype),"toJSON",this).call(this);return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t}},{key:"fromJSON",value:function(t){return l(y(e.prototype),"fromJSON",this).call(this,t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this}}])}(cu),wu=function(t){function e(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new dr,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new dr,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new dr,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new dr;return w(this,e),(t=d(this,e)).isCubicBezierCurve3=!0,t.type="CubicBezierCurve3",t.v0=n,t.v1=r,t.v2=i,t.v3=o,t}return v(e,t),T(e,[{key:"getPoint",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new dr,n=this.v0,r=this.v1,i=this.v2,o=this.v3;return e.set(_u(t,n.x,r.x,i.x,o.x),_u(t,n.y,r.y,i.y,o.y),_u(t,n.z,r.z,i.z,o.z)),e}},{key:"copy",value:function(t){return l(y(e.prototype),"copy",this).call(this,t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this}},{key:"toJSON",value:function(){var t=l(y(e.prototype),"toJSON",this).call(this);return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t}},{key:"fromJSON",value:function(t){return l(y(e.prototype),"fromJSON",this).call(this,t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this}}])}(cu),Su=function(t){function e(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Fn,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Fn;return w(this,e),(t=d(this,e)).isLineCurve=!0,t.type="LineCurve",t.v1=n,t.v2=r,t}return v(e,t),T(e,[{key:"getPoint",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Fn;return 1===t?e.copy(this.v2):(e.copy(this.v2).sub(this.v1),e.multiplyScalar(t).add(this.v1)),e}},{key:"getPointAt",value:function(t,e){return this.getPoint(t,e)}},{key:"getTangent",value:function(t){return(arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Fn).subVectors(this.v2,this.v1).normalize()}},{key:"getTangentAt",value:function(t,e){return this.getTangent(t,e)}},{key:"copy",value:function(t){return l(y(e.prototype),"copy",this).call(this,t),this.v1.copy(t.v1),this.v2.copy(t.v2),this}},{key:"toJSON",value:function(){var t=l(y(e.prototype),"toJSON",this).call(this);return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}},{key:"fromJSON",value:function(t){return l(y(e.prototype),"fromJSON",this).call(this,t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}])}(cu),Tu=function(t){function e(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new dr,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new dr;return w(this,e),(t=d(this,e)).isLineCurve3=!0,t.type="LineCurve3",t.v1=n,t.v2=r,t}return v(e,t),T(e,[{key:"getPoint",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new dr;return 1===t?e.copy(this.v2):(e.copy(this.v2).sub(this.v1),e.multiplyScalar(t).add(this.v1)),e}},{key:"getPointAt",value:function(t,e){return this.getPoint(t,e)}},{key:"getTangent",value:function(t){return(arguments.length>1&&void 0!==arguments[1]?arguments[1]:new dr).subVectors(this.v2,this.v1).normalize()}},{key:"getTangentAt",value:function(t,e){return this.getTangent(t,e)}},{key:"copy",value:function(t){return l(y(e.prototype),"copy",this).call(this,t),this.v1.copy(t.v1),this.v2.copy(t.v2),this}},{key:"toJSON",value:function(){var t=l(y(e.prototype),"toJSON",this).call(this);return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}},{key:"fromJSON",value:function(t){return l(y(e.prototype),"fromJSON",this).call(this,t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}])}(cu),Mu=function(t){function e(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Fn,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Fn,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Fn;return w(this,e),(t=d(this,e)).isQuadraticBezierCurve=!0,t.type="QuadraticBezierCurve",t.v0=n,t.v1=r,t.v2=i,t}return v(e,t),T(e,[{key:"getPoint",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Fn,n=this.v0,r=this.v1,i=this.v2;return e.set(bu(t,n.x,r.x,i.x),bu(t,n.y,r.y,i.y)),e}},{key:"copy",value:function(t){return l(y(e.prototype),"copy",this).call(this,t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this}},{key:"toJSON",value:function(){var t=l(y(e.prototype),"toJSON",this).call(this);return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}},{key:"fromJSON",value:function(t){return l(y(e.prototype),"fromJSON",this).call(this,t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}])}(cu),Eu=function(t){function e(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new dr,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new dr,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new dr;return w(this,e),(t=d(this,e)).isQuadraticBezierCurve3=!0,t.type="QuadraticBezierCurve3",t.v0=n,t.v1=r,t.v2=i,t}return v(e,t),T(e,[{key:"getPoint",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new dr,n=this.v0,r=this.v1,i=this.v2;return e.set(bu(t,n.x,r.x,i.x),bu(t,n.y,r.y,i.y),bu(t,n.z,r.z,i.z)),e}},{key:"copy",value:function(t){return l(y(e.prototype),"copy",this).call(this,t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this}},{key:"toJSON",value:function(){var t=l(y(e.prototype),"toJSON",this).call(this);return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}},{key:"fromJSON",value:function(t){return l(y(e.prototype),"fromJSON",this).call(this,t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}])}(cu),Au=function(t){function e(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return w(this,e),(t=d(this,e)).isSplineCurve=!0,t.type="SplineCurve",t.points=n,t}return v(e,t),T(e,[{key:"getPoint",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Fn,n=this.points,r=(n.length-1)*t,i=Math.floor(r),o=r-i,a=n[0===i?i:i-1],s=n[i],u=n[i>n.length-2?n.length-1:i+1],c=n[i>n.length-3?n.length-1:i+2];return e.set(gu(o,a.x,s.x,u.x,c.x),gu(o,a.y,s.y,u.y,c.y)),e}},{key:"copy",value:function(t){l(y(e.prototype),"copy",this).call(this,t),this.points=[];for(var n=0,r=t.points.length;n<r;n++){var i=t.points[n];this.points.push(i.clone())}return this}},{key:"toJSON",value:function(){var t=l(y(e.prototype),"toJSON",this).call(this);t.points=[];for(var n=0,r=this.points.length;n<r;n++){var i=this.points[n];t.points.push(i.toArray())}return t}},{key:"fromJSON",value:function(t){l(y(e.prototype),"fromJSON",this).call(this,t),this.points=[];for(var n=0,r=t.points.length;n<r;n++){var i=t.points[n];this.points.push((new Fn).fromArray(i))}return this}}])}(cu),Ou=Object.freeze({__proto__:null,ArcCurve:fu,CatmullRomCurve3:vu,CubicBezierCurve:xu,CubicBezierCurve3:wu,EllipseCurve:lu,LineCurve:Su,LineCurve3:Tu,QuadraticBezierCurve:Mu,QuadraticBezierCurve3:Eu,SplineCurve:Au}),Pu=function(t){function e(t){var n;return w(this,e),(n=d(this,e)).type="Path",n.currentPoint=new Fn,t&&n.setFromPoints(t),n}return v(e,t),T(e,[{key:"setFromPoints",value:function(t){this.moveTo(t[0].x,t[0].y);for(var e=1,n=t.length;e<n;e++)this.lineTo(t[e].x,t[e].y);return this}},{key:"moveTo",value:function(t,e){return this.currentPoint.set(t,e),this}},{key:"lineTo",value:function(t,e){var n=new Su(this.currentPoint.clone(),new Fn(t,e));return this.curves.push(n),this.currentPoint.set(t,e),this}},{key:"quadraticCurveTo",value:function(t,e,n,r){var i=new Mu(this.currentPoint.clone(),new Fn(t,e),new Fn(n,r));return this.curves.push(i),this.currentPoint.set(n,r),this}},{key:"bezierCurveTo",value:function(t,e,n,r,i,o){var a=new xu(this.currentPoint.clone(),new Fn(t,e),new Fn(n,r),new Fn(i,o));return this.curves.push(a),this.currentPoint.set(i,o),this}},{key:"splineThru",value:function(t){var e=[this.currentPoint.clone()].concat(t),n=new Au(e);return this.curves.push(n),this.currentPoint.copy(t[t.length-1]),this}},{key:"arc",value:function(t,e,n,r,i,o){var a=this.currentPoint.x,s=this.currentPoint.y;return this.absarc(t+a,e+s,n,r,i,o),this}},{key:"absarc",value:function(t,e,n,r,i,o){return this.absellipse(t,e,n,n,r,i,o),this}},{key:"ellipse",value:function(t,e,n,r,i,o,a,s){var u=this.currentPoint.x,c=this.currentPoint.y;return this.absellipse(t+u,e+c,n,r,i,o,a,s),this}},{key:"absellipse",value:function(t,e,n,r,i,o,a,s){var u=new lu(t,e,n,r,i,o,a,s);if(this.curves.length>0){var c=u.getPoint(0);c.equals(this.currentPoint)||this.lineTo(c.x,c.y)}this.curves.push(u);var l=u.getPoint(1);return this.currentPoint.copy(l),this}},{key:"copy",value:function(t){return l(y(e.prototype),"copy",this).call(this,t),this.currentPoint.copy(t.currentPoint),this}},{key:"toJSON",value:function(){var t=l(y(e.prototype),"toJSON",this).call(this);return t.currentPoint=this.currentPoint.toArray(),t}},{key:"fromJSON",value:function(t){return l(y(e.prototype),"fromJSON",this).call(this,t),this.currentPoint.fromArray(t.currentPoint),this}}])}(function(t){function e(){var t;return w(this,e),(t=d(this,e)).type="CurvePath",t.curves=[],t.autoClose=!1,t}return v(e,t),T(e,[{key:"add",value:function(t){this.curves.push(t)}},{key:"closePath",value:function(){var t=this.curves[0].getPoint(0),e=this.curves[this.curves.length-1].getPoint(1);if(!t.equals(e)){var n=!0===t.isVector2?"LineCurve":"LineCurve3";this.curves.push(new Ou[n](e,t))}return this}},{key:"getPoint",value:function(t,e){for(var n=t*this.getLength(),r=this.getCurveLengths(),i=0;i<r.length;){if(r[i]>=n){var o=r[i]-n,a=this.curves[i],s=a.getLength(),u=0===s?0:1-o/s;return a.getPointAt(u,e)}i++}return null}},{key:"getLength",value:function(){var t=this.getCurveLengths();return t[t.length-1]}},{key:"updateArcLengths",value:function(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}},{key:"getCurveLengths",value:function(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;for(var t=[],e=0,n=0,r=this.curves.length;n<r;n++)e+=this.curves[n].getLength(),t.push(e);return this.cacheLengths=t,t}},{key:"getSpacedPoints",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:40,e=[],n=0;n<=t;n++)e.push(this.getPoint(n/t));return this.autoClose&&e.push(e[0]),e}},{key:"getPoints",value:function(){for(var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:12,n=[],r=0,i=this.curves;r<i.length;r++)for(var o=i[r],a=o.isEllipseCurve?2*e:o.isLineCurve||o.isLineCurve3?1:o.isSplineCurve?e*o.points.length:e,s=o.getPoints(a),u=0;u<s.length;u++){var c=s[u];t&&t.equals(c)||(n.push(c),t=c)}return this.autoClose&&n.length>1&&!n[n.length-1].equals(n[0])&&n.push(n[0]),n}},{key:"copy",value:function(t){l(y(e.prototype),"copy",this).call(this,t),this.curves=[];for(var n=0,r=t.curves.length;n<r;n++){var i=t.curves[n];this.curves.push(i.clone())}return this.autoClose=t.autoClose,this}},{key:"toJSON",value:function(){var t=l(y(e.prototype),"toJSON",this).call(this);t.autoClose=this.autoClose,t.curves=[];for(var n=0,r=this.curves.length;n<r;n++){var i=this.curves[n];t.curves.push(i.toJSON())}return t}},{key:"fromJSON",value:function(t){l(y(e.prototype),"fromJSON",this).call(this,t),this.autoClose=t.autoClose,this.curves=[];for(var n=0,r=t.curves.length;n<r;n++){var i=t.curves[n];this.curves.push((new Ou[i.type]).fromJSON(i))}return this}}])}(cu)),Ru=function(t){function e(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[new Fn(0,-.5),new Fn(.5,0),new Fn(0,.5)],r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:12,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2*Math.PI;w(this,e),(t=d(this,e)).type="LatheGeometry",t.parameters={points:n,segments:r,phiStart:i,phiLength:o},r=Math.floor(r),o=Ln(o,0,2*Math.PI);for(var a=[],s=[],u=[],c=[],l=[],f=1/r,h=new dr,p=new Fn,m=new dr,y=new dr,v=new dr,g=0,b=0,_=0;_<=n.length-1;_++)switch(_){case 0:g=n[_+1].x-n[_].x,b=n[_+1].y-n[_].y,m.x=1*b,m.y=-g,m.z=0*b,v.copy(m),m.normalize(),c.push(m.x,m.y,m.z);break;case n.length-1:c.push(v.x,v.y,v.z);break;default:g=n[_+1].x-n[_].x,b=n[_+1].y-n[_].y,m.x=1*b,m.y=-g,m.z=0*b,y.copy(m),m.x+=v.x,m.y+=v.y,m.z+=v.z,m.normalize(),c.push(m.x,m.y,m.z),v.copy(y)}for(var x=0;x<=r;x++)for(var S=i+x*f*o,T=Math.sin(S),M=Math.cos(S),E=0;E<=n.length-1;E++){h.x=n[E].x*T,h.y=n[E].y,h.z=n[E].x*M,s.push(h.x,h.y,h.z),p.x=x/r,p.y=E/(n.length-1),u.push(p.x,p.y);var A=c[3*E+0]*T,O=c[3*E+1],P=c[3*E+0]*M;l.push(A,O,P)}for(var R=0;R<r;R++)for(var k=0;k<n.length-1;k++){var C=k+R*n.length,N=C,L=C+n.length,j=C+n.length+1,I=C+1;a.push(N,L,I),a.push(j,I,L)}return t.setIndex(a),t.setAttribute("position",new Yi(s,3)),t.setAttribute("uv",new Yi(u,2)),t.setAttribute("normal",new Yi(l,3)),t}return v(e,t),T(e,[{key:"copy",value:function(t){return l(y(e.prototype),"copy",this).call(this,t),this.parameters=Object.assign({},t.parameters),this}}],[{key:"fromJSON",value:function(t){return new e(t.points,t.segments,t.phiStart,t.phiLength)}}])}(no),ku=function(t){function e(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:8;w(this,e);var a=new Pu;return a.absarc(0,-r/2,n,1.5*Math.PI,0),a.absarc(0,r/2,n,0,.5*Math.PI),(t=d(this,e,[a.getPoints(i),o])).type="CapsuleGeometry",t.parameters={radius:n,length:r,capSegments:i,radialSegments:o},t}return v(e,t),T(e,null,[{key:"fromJSON",value:function(t){return new e(t.radius,t.length,t.capSegments,t.radialSegments)}}])}(Ru),Cu=function(t){function e(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2*Math.PI;w(this,e),(t=d(this,e)).type="CircleGeometry",t.parameters={radius:n,segments:r,thetaStart:i,thetaLength:o},r=Math.max(3,r);var a=[],s=[],u=[],c=[],l=new dr,f=new Fn;s.push(0,0,0),u.push(0,0,1),c.push(.5,.5);for(var h=0,p=3;h<=r;h++,p+=3){var m=i+h/r*o;l.x=n*Math.cos(m),l.y=n*Math.sin(m),s.push(l.x,l.y,l.z),u.push(0,0,1),f.x=(s[p]/n+1)/2,f.y=(s[p+1]/n+1)/2,c.push(f.x,f.y)}for(var y=1;y<=r;y++)a.push(y,y+1,0);return t.setIndex(a),t.setAttribute("position",new Yi(s,3)),t.setAttribute("normal",new Yi(u,3)),t.setAttribute("uv",new Yi(c,2)),t}return v(e,t),T(e,[{key:"copy",value:function(t){return l(y(e.prototype),"copy",this).call(this,t),this.parameters=Object.assign({},t.parameters),this}}],[{key:"fromJSON",value:function(t){return new e(t.radius,t.segments,t.thetaStart,t.thetaLength)}}])}(no),Nu=function(t){function e(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:32,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,s=arguments.length>5&&void 0!==arguments[5]&&arguments[5],u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,c=arguments.length>7&&void 0!==arguments[7]?arguments[7]:2*Math.PI;w(this,e),(t=d(this,e)).type="CylinderGeometry",t.parameters={radiusTop:n,radiusBottom:r,height:i,radialSegments:o,heightSegments:a,openEnded:s,thetaStart:u,thetaLength:c};var l=t;o=Math.floor(o),a=Math.floor(a);var f=[],h=[],p=[],m=[],y=0,v=[],g=i/2,b=0;function _(t){for(var e=y,i=new Fn,a=new dr,s=0,d=!0===t?n:r,v=!0===t?1:-1,_=1;_<=o;_++)h.push(0,g*v,0),p.push(0,v,0),m.push(.5,.5),y++;for(var x=y,w=0;w<=o;w++){var S=w/o*c+u,T=Math.cos(S),M=Math.sin(S);a.x=d*M,a.y=g*v,a.z=d*T,h.push(a.x,a.y,a.z),p.push(0,v,0),i.x=.5*T+.5,i.y=.5*M*v+.5,m.push(i.x,i.y),y++}for(var E=0;E<o;E++){var A=e+E,O=x+E;!0===t?f.push(O,O+1,A):f.push(O+1,O,A),s+=3}l.addGroup(b,s,!0===t?1:2),b+=s}return function(){for(var t=new dr,e=new dr,s=0,d=(r-n)/i,_=0;_<=a;_++){for(var x=[],w=_/a,S=w*(r-n)+n,T=0;T<=o;T++){var M=T/o,E=M*c+u,A=Math.sin(E),O=Math.cos(E);e.x=S*A,e.y=-w*i+g,e.z=S*O,h.push(e.x,e.y,e.z),t.set(A,d,O).normalize(),p.push(t.x,t.y,t.z),m.push(M,1-w),x.push(y++)}v.push(x)}for(var P=0;P<o;P++)for(var R=0;R<a;R++){var k=v[R][P],C=v[R+1][P],N=v[R+1][P+1],L=v[R][P+1];f.push(k,C,L),f.push(C,N,L),s+=6}l.addGroup(b,s,0),b+=s}(),!1===s&&(n>0&&_(!0),r>0&&_(!1)),t.setIndex(f),t.setAttribute("position",new Yi(h,3)),t.setAttribute("normal",new Yi(p,3)),t.setAttribute("uv",new Yi(m,2)),t}return v(e,t),T(e,[{key:"copy",value:function(t){return l(y(e.prototype),"copy",this).call(this,t),this.parameters=Object.assign({},t.parameters),this}}],[{key:"fromJSON",value:function(t){return new e(t.radiusTop,t.radiusBottom,t.height,t.radialSegments,t.heightSegments,t.openEnded,t.thetaStart,t.thetaLength)}}])}(no),Lu=function(t){function e(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:32,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,a=arguments.length>4&&void 0!==arguments[4]&&arguments[4],s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:2*Math.PI;return w(this,e),(t=d(this,e,[0,n,r,i,o,a,s,u])).type="ConeGeometry",t.parameters={radius:n,height:r,radialSegments:i,heightSegments:o,openEnded:a,thetaStart:s,thetaLength:u},t}return v(e,t),T(e,null,[{key:"fromJSON",value:function(t){return new e(t.radius,t.height,t.radialSegments,t.heightSegments,t.openEnded,t.thetaStart,t.thetaLength)}}])}(Nu),ju=function(t){function e(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;w(this,e),(t=d(this,e)).type="PolyhedronGeometry",t.parameters={vertices:n,indices:r,radius:i,detail:o};var a=[],s=[];function u(t,e,n,r){for(var i=r+1,o=[],a=0;a<=i;a++){o[a]=[];for(var s=t.clone().lerp(n,a/i),u=e.clone().lerp(n,a/i),l=i-a,f=0;f<=l;f++)o[a][f]=0===f&&a===i?s:s.clone().lerp(u,f/l)}for(var h=0;h<i;h++)for(var p=0;p<2*(i-h)-1;p++){var d=Math.floor(p/2);p%2==0?(c(o[h][d+1]),c(o[h+1][d]),c(o[h][d])):(c(o[h][d+1]),c(o[h+1][d+1]),c(o[h+1][d]))}}function c(t){a.push(t.x,t.y,t.z)}function l(t,e){var r=3*t;e.x=n[r+0],e.y=n[r+1],e.z=n[r+2]}function f(t,e,n,r){r<0&&1===t.x&&(s[e]=t.x-1),0===n.x&&0===n.z&&(s[e]=r/2/Math.PI+.5)}function h(t){return Math.atan2(t.z,-t.x)}return function(t){for(var e=new dr,n=new dr,i=new dr,o=0;o<r.length;o+=3)l(r[o+0],e),l(r[o+1],n),l(r[o+2],i),u(e,n,i,t)}(o),function(t){for(var e=new dr,n=0;n<a.length;n+=3)e.x=a[n+0],e.y=a[n+1],e.z=a[n+2],e.normalize().multiplyScalar(t),a[n+0]=e.x,a[n+1]=e.y,a[n+2]=e.z}(i),function(){for(var t=new dr,e=0;e<a.length;e+=3){t.x=a[e+0],t.y=a[e+1],t.z=a[e+2];var n=h(t)/2/Math.PI+.5,r=(i=t,Math.atan2(-i.y,Math.sqrt(i.x*i.x+i.z*i.z))/Math.PI+.5);s.push(n,1-r)}var i;(function(){for(var t=new dr,e=new dr,n=new dr,r=new dr,i=new Fn,o=new Fn,u=new Fn,c=0,l=0;c<a.length;c+=9,l+=6){t.set(a[c+0],a[c+1],a[c+2]),e.set(a[c+3],a[c+4],a[c+5]),n.set(a[c+6],a[c+7],a[c+8]),i.set(s[l+0],s[l+1]),o.set(s[l+2],s[l+3]),u.set(s[l+4],s[l+5]),r.copy(t).add(e).add(n).divideScalar(3);var p=h(r);f(i,l+0,t,p),f(o,l+2,e,p),f(u,l+4,n,p)}})(),function(){for(var t=0;t<s.length;t+=6){var e=s[t+0],n=s[t+2],r=s[t+4],i=Math.max(e,n,r),o=Math.min(e,n,r);i>.9&&o<.1&&(e<.2&&(s[t+0]+=1),n<.2&&(s[t+2]+=1),r<.2&&(s[t+4]+=1))}}()}(),t.setAttribute("position",new Yi(a,3)),t.setAttribute("normal",new Yi(a.slice(),3)),t.setAttribute("uv",new Yi(s,2)),0===o?t.computeVertexNormals():t.normalizeNormals(),t}return v(e,t),T(e,[{key:"copy",value:function(t){return l(y(e.prototype),"copy",this).call(this,t),this.parameters=Object.assign({},t.parameters),this}}],[{key:"fromJSON",value:function(t){return new e(t.vertices,t.indices,t.radius,t.details)}}])}(no),Iu=function(t){function e(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;w(this,e);var i=(1+Math.sqrt(5))/2,o=1/i;return(t=d(this,e,[[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-o,-i,0,-o,i,0,o,-i,0,o,i,-o,-i,0,-o,i,0,o,-i,0,o,i,0,-i,0,-o,i,0,-o,-i,0,o,i,0,o],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],n,r])).type="DodecahedronGeometry",t.parameters={radius:n,detail:r},t}return v(e,t),T(e,null,[{key:"fromJSON",value:function(t){return new e(t.radius,t.detail)}}])}(ju),Bu=new dr,Uu=new dr,Du=new dr,Fu=new Oi,zu=function(t){function e(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(w(this,e),(t=d(this,e)).type="EdgesGeometry",t.parameters={geometry:n,thresholdAngle:r},null!==n){for(var i=Math.pow(10,4),o=Math.cos(kn*r),a=n.getIndex(),s=n.getAttribute("position"),u=a?a.count:s.count,c=[0,0,0],l=["a","b","c"],f=new Array(3),h={},p=[],m=0;m<u;m+=3){a?(c[0]=a.getX(m),c[1]=a.getX(m+1),c[2]=a.getX(m+2)):(c[0]=m,c[1]=m+1,c[2]=m+2);var y=Fu.a,v=Fu.b,g=Fu.c;if(y.fromBufferAttribute(s,c[0]),v.fromBufferAttribute(s,c[1]),g.fromBufferAttribute(s,c[2]),Fu.getNormal(Du),f[0]="".concat(Math.round(y.x*i),",").concat(Math.round(y.y*i),",").concat(Math.round(y.z*i)),f[1]="".concat(Math.round(v.x*i),",").concat(Math.round(v.y*i),",").concat(Math.round(v.z*i)),f[2]="".concat(Math.round(g.x*i),",").concat(Math.round(g.y*i),",").concat(Math.round(g.z*i)),f[0]!==f[1]&&f[1]!==f[2]&&f[2]!==f[0])for(var b=0;b<3;b++){var _=(b+1)%3,x=f[b],S=f[_],T=Fu[l[b]],M=Fu[l[_]],E="".concat(x,"_").concat(S),A="".concat(S,"_").concat(x);A in h&&h[A]?(Du.dot(h[A].normal)<=o&&(p.push(T.x,T.y,T.z),p.push(M.x,M.y,M.z)),h[A]=null):E in h||(h[E]={index0:c[b],index1:c[_],normal:Du.clone()})}}for(var O in h)if(h[O]){var P=h[O],R=P.index0,k=P.index1;Bu.fromBufferAttribute(s,R),Uu.fromBufferAttribute(s,k),p.push(Bu.x,Bu.y,Bu.z),p.push(Uu.x,Uu.y,Uu.z)}t.setAttribute("position",new Yi(p,3))}return t}return v(e,t),T(e,[{key:"copy",value:function(t){return l(y(e.prototype),"copy",this).call(this,t),this.parameters=Object.assign({},t.parameters),this}}])}(no),Vu=function(t){function e(t){var n;return w(this,e),(n=d(this,e,[t])).uuid=Nn(),n.type="Shape",n.holes=[],n}return v(e,t),T(e,[{key:"getPointsHoles",value:function(t){for(var e=[],n=0,r=this.holes.length;n<r;n++)e[n]=this.holes[n].getPoints(t);return e}},{key:"extractPoints",value:function(t){return{shape:this.getPoints(t),holes:this.getPointsHoles(t)}}},{key:"copy",value:function(t){l(y(e.prototype),"copy",this).call(this,t),this.holes=[];for(var n=0,r=t.holes.length;n<r;n++){var i=t.holes[n];this.holes.push(i.clone())}return this}},{key:"toJSON",value:function(){var t=l(y(e.prototype),"toJSON",this).call(this);t.uuid=this.uuid,t.holes=[];for(var n=0,r=this.holes.length;n<r;n++){var i=this.holes[n];t.holes.push(i.toJSON())}return t}},{key:"fromJSON",value:function(t){l(y(e.prototype),"fromJSON",this).call(this,t),this.uuid=t.uuid,this.holes=[];for(var n=0,r=t.holes.length;n<r;n++){var i=t.holes[n];this.holes.push((new Pu).fromJSON(i))}return this}}])}(Pu);function Gu(t,e,n,r,i){var o,a;if(i===function(t,e,n,r){for(var i=0,o=e,a=n-r;o<n;o+=r)i+=(t[a]-t[o])*(t[o+1]+t[a+1]),a=o;return i}(t,e,n,r)>0)for(o=e;o<n;o+=r)a=lc(o,t[o],t[o+1],a);else for(o=n-r;o>=e;o-=r)a=lc(o,t[o],t[o+1],a);return a&&ic(a,a.next)&&(fc(a),a=a.next),a}function Hu(t,e){if(!t)return t;e||(e=t);var n,r=t;do{if(n=!1,r.steiner||!ic(r,r.next)&&0!==rc(r.prev,r,r.next))r=r.next;else{if(fc(r),(r=e=r.prev)===r.next)break;n=!0}}while(n||r!==e);return e}function Wu(t,e,n,r,i,o,a){if(t){!a&&o&&function(t,e,n,r){var i=t;do{0===i.z&&(i.z=$u(i.x,i.y,e,n,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==t);i.prevZ.nextZ=null,i.prevZ=null,function(t){var e,n,r,i,o,a,s,u,c=1;do{for(n=t,t=null,o=null,a=0;n;){for(a++,r=n,s=0,e=0;e<c&&(s++,r=r.nextZ);e++);for(u=c;s>0||u>0&&r;)0!==s&&(0===u||!r||n.z<=r.z)?(i=n,n=n.nextZ,s--):(i=r,r=r.nextZ,u--),o?o.nextZ=i:t=i,i.prevZ=o,o=i;n=r}o.nextZ=null,c*=2}while(a>1)}(i)}(t,r,i,o);for(var s,u,c=t;t.prev!==t.next;)if(s=t.prev,u=t.next,o?Xu(t,r,i,o):qu(t))e.push(s.i/n|0),e.push(t.i/n|0),e.push(u.i/n|0),fc(t),t=u.next,c=u.next;else if((t=u)===c){a?1===a?Wu(t=Yu(Hu(t),e,n),e,n,r,i,o,2):2===a&&Ju(t,e,n,r,i,o):Wu(Hu(t),e,n,r,i,o,1);break}}}function qu(t){var e=t.prev,n=t,r=t.next;if(rc(e,n,r)>=0)return!1;for(var i=e.x,o=n.x,a=r.x,s=e.y,u=n.y,c=r.y,l=i<o?i<a?i:a:o<a?o:a,f=s<u?s<c?s:c:u<c?u:c,h=i>o?i>a?i:a:o>a?o:a,p=s>u?s>c?s:c:u>c?u:c,d=r.next;d!==e;){if(d.x>=l&&d.x<=h&&d.y>=f&&d.y<=p&&ec(i,s,o,u,a,c,d.x,d.y)&&rc(d.prev,d,d.next)>=0)return!1;d=d.next}return!0}function Xu(t,e,n,r){var i=t.prev,o=t,a=t.next;if(rc(i,o,a)>=0)return!1;for(var s=i.x,u=o.x,c=a.x,l=i.y,f=o.y,h=a.y,p=s<u?s<c?s:c:u<c?u:c,d=l<f?l<h?l:h:f<h?f:h,m=s>u?s>c?s:c:u>c?u:c,y=l>f?l>h?l:h:f>h?f:h,v=$u(p,d,e,n,r),g=$u(m,y,e,n,r),b=t.prevZ,_=t.nextZ;b&&b.z>=v&&_&&_.z<=g;){if(b.x>=p&&b.x<=m&&b.y>=d&&b.y<=y&&b!==i&&b!==a&&ec(s,l,u,f,c,h,b.x,b.y)&&rc(b.prev,b,b.next)>=0)return!1;if(b=b.prevZ,_.x>=p&&_.x<=m&&_.y>=d&&_.y<=y&&_!==i&&_!==a&&ec(s,l,u,f,c,h,_.x,_.y)&&rc(_.prev,_,_.next)>=0)return!1;_=_.nextZ}for(;b&&b.z>=v;){if(b.x>=p&&b.x<=m&&b.y>=d&&b.y<=y&&b!==i&&b!==a&&ec(s,l,u,f,c,h,b.x,b.y)&&rc(b.prev,b,b.next)>=0)return!1;b=b.prevZ}for(;_&&_.z<=g;){if(_.x>=p&&_.x<=m&&_.y>=d&&_.y<=y&&_!==i&&_!==a&&ec(s,l,u,f,c,h,_.x,_.y)&&rc(_.prev,_,_.next)>=0)return!1;_=_.nextZ}return!0}function Yu(t,e,n){var r=t;do{var i=r.prev,o=r.next.next;!ic(i,o)&&oc(i,r,r.next,o)&&uc(i,o)&&uc(o,i)&&(e.push(i.i/n|0),e.push(r.i/n|0),e.push(o.i/n|0),fc(r),fc(r.next),r=t=o),r=r.next}while(r!==t);return Hu(r)}function Ju(t,e,n,r,i,o){var a=t;do{for(var s=a.next.next;s!==a.prev;){if(a.i!==s.i&&nc(a,s)){var u=cc(a,s);return a=Hu(a,a.next),u=Hu(u,u.next),Wu(a,e,n,r,i,o,0),void Wu(u,e,n,r,i,o,0)}s=s.next}a=a.next}while(a!==t)}function Zu(t,e){return t.x-e.x}function Ku(t,e){var n=function(t,e){var n,r=e,i=-1/0,o=t.x,a=t.y;do{if(a<=r.y&&a>=r.next.y&&r.next.y!==r.y){var s=r.x+(a-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(s<=o&&s>i&&(i=s,n=r.x<r.next.x?r:r.next,s===o))return n}r=r.next}while(r!==e);if(!n)return null;var u,c=n,l=n.x,f=n.y,h=1/0;r=n;do{o>=r.x&&r.x>=l&&o!==r.x&&ec(a<f?o:i,a,l,f,a<f?i:o,a,r.x,r.y)&&(u=Math.abs(a-r.y)/(o-r.x),uc(r,t)&&(u<h||u===h&&(r.x>n.x||r.x===n.x&&Qu(n,r)))&&(n=r,h=u)),r=r.next}while(r!==c);return n}(t,e);if(!n)return e;var r=cc(n,t);return Hu(r,r.next),Hu(n,n.next)}function Qu(t,e){return rc(t.prev,t,e.prev)<0&&rc(e.next,t,t.next)<0}function $u(t,e,n,r,i){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-n)*i|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-r)*i|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function tc(t){var e=t,n=t;do{(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next}while(e!==t);return n}function ec(t,e,n,r,i,o,a,s){return(i-a)*(e-s)>=(t-a)*(o-s)&&(t-a)*(r-s)>=(n-a)*(e-s)&&(n-a)*(o-s)>=(i-a)*(r-s)}function nc(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==e.i&&n.next.i!==e.i&&oc(n,n.next,t,e))return!0;n=n.next}while(n!==t);return!1}(t,e)&&(uc(t,e)&&uc(e,t)&&function(t,e){var n=t,r=!1,i=(t.x+e.x)/2,o=(t.y+e.y)/2;do{n.y>o!=n.next.y>o&&n.next.y!==n.y&&i<(n.next.x-n.x)*(o-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next}while(n!==t);return r}(t,e)&&(rc(t.prev,t,e.prev)||rc(t,e.prev,e))||ic(t,e)&&rc(t.prev,t,t.next)>0&&rc(e.prev,e,e.next)>0)}function rc(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function ic(t,e){return t.x===e.x&&t.y===e.y}function oc(t,e,n,r){var i=sc(rc(t,e,n)),o=sc(rc(t,e,r)),a=sc(rc(n,r,t)),s=sc(rc(n,r,e));return i!==o&&a!==s||!(0!==i||!ac(t,n,e))||!(0!==o||!ac(t,r,e))||!(0!==a||!ac(n,t,r))||!(0!==s||!ac(n,e,r))}function ac(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function sc(t){return t>0?1:t<0?-1:0}function uc(t,e){return rc(t.prev,t,t.next)<0?rc(t,e,t.next)>=0&&rc(t,t.prev,e)>=0:rc(t,e,t.prev)<0||rc(t,t.next,e)<0}function cc(t,e){var n=new hc(t.i,t.x,t.y),r=new hc(e.i,e.x,e.y),i=t.next,o=e.prev;return t.next=e,e.prev=t,n.next=i,i.prev=n,r.next=n,n.prev=r,o.next=r,r.prev=o,r}function lc(t,e,n,r){var i=new hc(t,e,n);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function fc(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function hc(t,e,n){this.i=t,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}var pc=function(){function t(){w(this,t)}return T(t,null,[{key:"area",value:function(t){for(var e=t.length,n=0,r=e-1,i=0;i<e;r=i++)n+=t[r].x*t[i].y-t[i].x*t[r].y;return.5*n}},{key:"isClockWise",value:function(e){return t.area(e)<0}},{key:"triangulateShape",value:function(t,e){var n=[],r=[],i=[];dc(t),mc(n,t);var o=t.length;e.forEach(dc);for(var a=0;a<e.length;a++)r.push(o),o+=e[a].length,mc(n,e[a]);for(var s=function(t,e){var n,r,i,o,a,s,u,c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,l=e&&e.length,f=l?e[0]*c:t.length,h=Gu(t,0,f,c,!0),p=[];if(!h||h.next===h.prev)return p;if(l&&(h=function(t,e,n,r){var i,o,a,s=[];for(i=0,o=e.length;i<o;i++)(a=Gu(t,e[i]*r,i<o-1?e[i+1]*r:t.length,r,!1))===a.next&&(a.steiner=!0),s.push(tc(a));for(s.sort(Zu),i=0;i<s.length;i++)n=Ku(s[i],n);return n}(t,e,h,c)),t.length>80*c){n=i=t[0],r=o=t[1];for(var d=c;d<f;d+=c)(a=t[d])<n&&(n=a),(s=t[d+1])<r&&(r=s),a>i&&(i=a),s>o&&(o=s);u=0!==(u=Math.max(i-n,o-r))?32767/u:0}return Wu(h,p,c,n,r,u,0),p}(n,r),u=0;u<s.length;u+=3)i.push(s.slice(u,u+3));return i}}])}();function dc(t){var e=t.length;e>2&&t[e-1].equals(t[0])&&t.pop()}function mc(t,e){for(var n=0;n<e.length;n++)t.push(e[n].x),t.push(e[n].y)}var yc=function(t){function e(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Vu([new Fn(.5,.5),new Fn(-.5,.5),new Fn(-.5,-.5),new Fn(.5,-.5)]),r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};w(this,e),(t=d(this,e)).type="ExtrudeGeometry",t.parameters={shapes:n,options:r},n=Array.isArray(n)?n:[n];for(var i=t,o=[],a=[],s=0,u=n.length;s<u;s++)c(n[s]);function c(t){var e,n,s,u,c,l=[],f=void 0!==r.curveSegments?r.curveSegments:12,h=void 0!==r.steps?r.steps:1,p=void 0!==r.depth?r.depth:1,d=void 0===r.bevelEnabled||r.bevelEnabled,m=void 0!==r.bevelThickness?r.bevelThickness:.2,y=void 0!==r.bevelSize?r.bevelSize:m-.1,v=void 0!==r.bevelOffset?r.bevelOffset:0,g=void 0!==r.bevelSegments?r.bevelSegments:3,b=r.extrudePath,_=void 0!==r.UVGenerator?r.UVGenerator:vc,x=!1;b&&(e=b.getSpacedPoints(h),x=!0,d=!1,n=b.computeFrenetFrames(h,!1),s=new dr,u=new dr,c=new dr),d||(g=0,m=0,y=0,v=0);var w=t.extractPoints(f),S=w.shape,T=w.holes;if(!pc.isClockWise(S)){S=S.reverse();for(var M=0,E=T.length;M<E;M++){var A=T[M];pc.isClockWise(A)&&(T[M]=A.reverse())}}for(var O=pc.triangulateShape(S,T),P=S,R=0,k=T.length;R<k;R++){var C=T[R];S=S.concat(C)}function N(t,e,n){return e||console.error("THREE.ExtrudeGeometry: vec does not exist"),t.clone().addScaledVector(e,n)}var L=S.length,j=O.length;function I(t,e,n){var r,i,o,a=t.x-e.x,s=t.y-e.y,u=n.x-t.x,c=n.y-t.y,l=a*a+s*s,f=a*c-s*u;if(Math.abs(f)>Number.EPSILON){var h=Math.sqrt(l),p=Math.sqrt(u*u+c*c),d=e.x-s/h,m=e.y+a/h,y=((n.x-c/p-d)*c-(n.y+u/p-m)*u)/(a*c-s*u),v=(r=d+a*y-t.x)*r+(i=m+s*y-t.y)*i;if(v<=2)return new Fn(r,i);o=Math.sqrt(v/2)}else{var g=!1;a>Number.EPSILON?u>Number.EPSILON&&(g=!0):a<-Number.EPSILON?u<-Number.EPSILON&&(g=!0):Math.sign(s)===Math.sign(c)&&(g=!0),g?(r=-s,i=a,o=Math.sqrt(l)):(r=a,i=s,o=Math.sqrt(l/2))}return new Fn(r/o,i/o)}for(var B=[],U=0,D=P.length,F=D-1,z=U+1;U<D;U++,F++,z++)F===D&&(F=0),z===D&&(z=0),B[U]=I(P[U],P[F],P[z]);for(var V,G=[],H=B.concat(),W=0,q=T.length;W<q;W++){var X=T[W];V=[];for(var Y=0,J=X.length,Z=J-1,K=Y+1;Y<J;Y++,Z++,K++)Z===J&&(Z=0),K===J&&(K=0),V[Y]=I(X[Y],X[Z],X[K]);G.push(V),H=H.concat(V)}for(var Q=0;Q<g;Q++){for(var $=Q/g,tt=m*Math.cos($*Math.PI/2),et=y*Math.sin($*Math.PI/2)+v,nt=0,rt=P.length;nt<rt;nt++){var it=N(P[nt],B[nt],et);kt(it.x,it.y,-tt)}for(var ot=0,at=T.length;ot<at;ot++){var st=T[ot];V=G[ot];for(var ut=0,ct=st.length;ut<ct;ut++){var lt=N(st[ut],V[ut],et);kt(lt.x,lt.y,-tt)}}}for(var ft=y+v,ht=0;ht<L;ht++){var pt=d?N(S[ht],H[ht],ft):S[ht];x?(u.copy(n.normals[0]).multiplyScalar(pt.x),s.copy(n.binormals[0]).multiplyScalar(pt.y),c.copy(e[0]).add(u).add(s),kt(c.x,c.y,c.z)):kt(pt.x,pt.y,0)}for(var dt=1;dt<=h;dt++)for(var mt=0;mt<L;mt++){var yt=d?N(S[mt],H[mt],ft):S[mt];x?(u.copy(n.normals[dt]).multiplyScalar(yt.x),s.copy(n.binormals[dt]).multiplyScalar(yt.y),c.copy(e[dt]).add(u).add(s),kt(c.x,c.y,c.z)):kt(yt.x,yt.y,p/h*dt)}for(var vt=g-1;vt>=0;vt--){for(var gt=vt/g,bt=m*Math.cos(gt*Math.PI/2),_t=y*Math.sin(gt*Math.PI/2)+v,xt=0,wt=P.length;xt<wt;xt++){var St=N(P[xt],B[xt],_t);kt(St.x,St.y,p+bt)}for(var Tt=0,Mt=T.length;Tt<Mt;Tt++){var Et=T[Tt];V=G[Tt];for(var At=0,Ot=Et.length;At<Ot;At++){var Pt=N(Et[At],V[At],_t);x?kt(Pt.x,Pt.y+e[h-1].y,e[h-1].x+bt):kt(Pt.x,Pt.y,p+bt)}}}function Rt(t,e){for(var n=t.length;--n>=0;){var r=n,i=n-1;i<0&&(i=t.length-1);for(var o=0,a=h+2*g;o<a;o++){var s=L*o,u=L*(o+1);Nt(e+r+s,e+i+s,e+i+u,e+r+u)}}}function kt(t,e,n){l.push(t),l.push(e),l.push(n)}function Ct(t,e,n){Lt(t),Lt(e),Lt(n);var r=o.length/3,a=_.generateTopUV(i,o,r-3,r-2,r-1);jt(a[0]),jt(a[1]),jt(a[2])}function Nt(t,e,n,r){Lt(t),Lt(e),Lt(r),Lt(e),Lt(n),Lt(r);var a=o.length/3,s=_.generateSideWallUV(i,o,a-6,a-3,a-2,a-1);jt(s[0]),jt(s[1]),jt(s[3]),jt(s[1]),jt(s[2]),jt(s[3])}function Lt(t){o.push(l[3*t+0]),o.push(l[3*t+1]),o.push(l[3*t+2])}function jt(t){a.push(t.x),a.push(t.y)}!function(){var t=o.length/3;if(d){for(var e=0,n=L*e,r=0;r<j;r++){var a=O[r];Ct(a[2]+n,a[1]+n,a[0]+n)}n=L*(e=h+2*g);for(var s=0;s<j;s++){var u=O[s];Ct(u[0]+n,u[1]+n,u[2]+n)}}else{for(var c=0;c<j;c++){var l=O[c];Ct(l[2],l[1],l[0])}for(var f=0;f<j;f++){var p=O[f];Ct(p[0]+L*h,p[1]+L*h,p[2]+L*h)}}i.addGroup(t,o.length/3-t,0)}(),function(){var t=o.length/3,e=0;Rt(P,e),e+=P.length;for(var n=0,r=T.length;n<r;n++){var a=T[n];Rt(a,e),e+=a.length}i.addGroup(t,o.length/3-t,1)}()}return t.setAttribute("position",new Yi(o,3)),t.setAttribute("uv",new Yi(a,2)),t.computeVertexNormals(),t}return v(e,t),T(e,[{key:"copy",value:function(t){return l(y(e.prototype),"copy",this).call(this,t),this.parameters=Object.assign({},t.parameters),this}},{key:"toJSON",value:function(){var t=l(y(e.prototype),"toJSON",this).call(this);return function(t,e,n){if(n.shapes=[],Array.isArray(t))for(var r=0,i=t.length;r<i;r++){var o=t[r];n.shapes.push(o.uuid)}else n.shapes.push(t.uuid);return n.options=Object.assign({},e),void 0!==e.extrudePath&&(n.options.extrudePath=e.extrudePath.toJSON()),n}(this.parameters.shapes,this.parameters.options,t)}}],[{key:"fromJSON",value:function(t,n){for(var r=[],i=0,o=t.shapes.length;i<o;i++){var a=n[t.shapes[i]];r.push(a)}var s=t.options.extrudePath;return void 0!==s&&(t.options.extrudePath=(new Ou[s.type]).fromJSON(s)),new e(r,t.options)}}])}(no),vc={generateTopUV:function(t,e,n,r,i){var o=e[3*n],a=e[3*n+1],s=e[3*r],u=e[3*r+1],c=e[3*i],l=e[3*i+1];return[new Fn(o,a),new Fn(s,u),new Fn(c,l)]},generateSideWallUV:function(t,e,n,r,i,o){var a=e[3*n],s=e[3*n+1],u=e[3*n+2],c=e[3*r],l=e[3*r+1],f=e[3*r+2],h=e[3*i],p=e[3*i+1],d=e[3*i+2],m=e[3*o],y=e[3*o+1],v=e[3*o+2];return Math.abs(s-l)<Math.abs(a-c)?[new Fn(a,1-u),new Fn(c,1-f),new Fn(h,1-d),new Fn(m,1-v)]:[new Fn(s,1-u),new Fn(l,1-f),new Fn(p,1-d),new Fn(y,1-v)]}},gc=function(t){function e(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;w(this,e);var i=(1+Math.sqrt(5))/2;return(t=d(this,e,[[-1,i,0,1,i,0,-1,-i,0,1,-i,0,0,-1,i,0,1,i,0,-1,-i,0,1,-i,i,0,-1,i,0,1,-i,0,-1,-i,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],n,r])).type="IcosahedronGeometry",t.parameters={radius:n,detail:r},t}return v(e,t),T(e,null,[{key:"fromJSON",value:function(t){return new e(t.radius,t.detail)}}])}(ju),bc=function(t){function e(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return w(this,e),(t=d(this,e,[[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],n,r])).type="OctahedronGeometry",t.parameters={radius:n,detail:r},t}return v(e,t),T(e,null,[{key:"fromJSON",value:function(t){return new e(t.radius,t.detail)}}])}(ju),_c=function(t){function e(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.5,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:32,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:2*Math.PI;w(this,e),(t=d(this,e)).type="RingGeometry",t.parameters={innerRadius:n,outerRadius:r,thetaSegments:i,phiSegments:o,thetaStart:a,thetaLength:s},i=Math.max(3,i);for(var u=[],c=[],l=[],f=[],h=n,p=(r-n)/(o=Math.max(1,o)),m=new dr,y=new Fn,v=0;v<=o;v++){for(var g=0;g<=i;g++){var b=a+g/i*s;m.x=h*Math.cos(b),m.y=h*Math.sin(b),c.push(m.x,m.y,m.z),l.push(0,0,1),y.x=(m.x/r+1)/2,y.y=(m.y/r+1)/2,f.push(y.x,y.y)}h+=p}for(var _=0;_<o;_++)for(var x=_*(i+1),S=0;S<i;S++){var T=S+x,M=T,E=T+i+1,A=T+i+2,O=T+1;u.push(M,E,O),u.push(E,A,O)}return t.setIndex(u),t.setAttribute("position",new Yi(c,3)),t.setAttribute("normal",new Yi(l,3)),t.setAttribute("uv",new Yi(f,2)),t}return v(e,t),T(e,[{key:"copy",value:function(t){return l(y(e.prototype),"copy",this).call(this,t),this.parameters=Object.assign({},t.parameters),this}}],[{key:"fromJSON",value:function(t){return new e(t.innerRadius,t.outerRadius,t.thetaSegments,t.phiSegments,t.thetaStart,t.thetaLength)}}])}(no),xc=function(t){function e(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Vu([new Fn(0,.5),new Fn(-.5,-.5),new Fn(.5,-.5)]),r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:12;w(this,e),(t=d(this,e)).type="ShapeGeometry",t.parameters={shapes:n,curveSegments:r};var i=[],o=[],a=[],s=[],u=0,c=0;if(!1===Array.isArray(n))f(n);else for(var l=0;l<n.length;l++)f(n[l]),t.addGroup(u,c,l),u+=c,c=0;function f(t){var e=o.length/3,n=t.extractPoints(r),u=n.shape,l=n.holes;!1===pc.isClockWise(u)&&(u=u.reverse());for(var f=0,h=l.length;f<h;f++){var p=l[f];!0===pc.isClockWise(p)&&(l[f]=p.reverse())}for(var d=pc.triangulateShape(u,l),m=0,y=l.length;m<y;m++){var v=l[m];u=u.concat(v)}for(var g=0,b=u.length;g<b;g++){var _=u[g];o.push(_.x,_.y,0),a.push(0,0,1),s.push(_.x,_.y)}for(var x=0,w=d.length;x<w;x++){var S=d[x],T=S[0]+e,M=S[1]+e,E=S[2]+e;i.push(T,M,E),c+=3}}return t.setIndex(i),t.setAttribute("position",new Yi(o,3)),t.setAttribute("normal",new Yi(a,3)),t.setAttribute("uv",new Yi(s,2)),t}return v(e,t),T(e,[{key:"copy",value:function(t){return l(y(e.prototype),"copy",this).call(this,t),this.parameters=Object.assign({},t.parameters),this}},{key:"toJSON",value:function(){var t=l(y(e.prototype),"toJSON",this).call(this);return function(t,e){if(e.shapes=[],Array.isArray(t))for(var n=0,r=t.length;n<r;n++){var i=t[n];e.shapes.push(i.uuid)}else e.shapes.push(t.uuid);return e}(this.parameters.shapes,t)}}],[{key:"fromJSON",value:function(t,n){for(var r=[],i=0,o=t.shapes.length;i<o;i++){var a=n[t.shapes[i]];r.push(a)}return new e(r,t.curveSegments)}}])}(no),wc=function(t){function e(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:16,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:2*Math.PI,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:Math.PI;w(this,e),(t=d(this,e)).type="SphereGeometry",t.parameters={radius:n,widthSegments:r,heightSegments:i,phiStart:o,phiLength:a,thetaStart:s,thetaLength:u},r=Math.max(3,Math.floor(r)),i=Math.max(2,Math.floor(i));for(var c=Math.min(s+u,Math.PI),l=0,f=[],h=new dr,p=new dr,m=[],y=[],v=[],g=[],b=0;b<=i;b++){var _=[],x=b/i,S=0;0===b&&0===s?S=.5/r:b===i&&c===Math.PI&&(S=-.5/r);for(var T=0;T<=r;T++){var M=T/r;h.x=-n*Math.cos(o+M*a)*Math.sin(s+x*u),h.y=n*Math.cos(s+x*u),h.z=n*Math.sin(o+M*a)*Math.sin(s+x*u),y.push(h.x,h.y,h.z),p.copy(h).normalize(),v.push(p.x,p.y,p.z),g.push(M+S,1-x),_.push(l++)}f.push(_)}for(var E=0;E<i;E++)for(var A=0;A<r;A++){var O=f[E][A+1],P=f[E][A],R=f[E+1][A],k=f[E+1][A+1];(0!==E||s>0)&&m.push(O,P,k),(E!==i-1||c<Math.PI)&&m.push(P,R,k)}return t.setIndex(m),t.setAttribute("position",new Yi(y,3)),t.setAttribute("normal",new Yi(v,3)),t.setAttribute("uv",new Yi(g,2)),t}return v(e,t),T(e,[{key:"copy",value:function(t){return l(y(e.prototype),"copy",this).call(this,t),this.parameters=Object.assign({},t.parameters),this}}],[{key:"fromJSON",value:function(t){return new e(t.radius,t.widthSegments,t.heightSegments,t.phiStart,t.phiLength,t.thetaStart,t.thetaLength)}}])}(no),Sc=function(t){function e(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return w(this,e),(t=d(this,e,[[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],n,r])).type="TetrahedronGeometry",t.parameters={radius:n,detail:r},t}return v(e,t),T(e,null,[{key:"fromJSON",value:function(t){return new e(t.radius,t.detail)}}])}(ju),Tc=function(t){function e(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.4,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:12,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:48,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:2*Math.PI;w(this,e),(t=d(this,e)).type="TorusGeometry",t.parameters={radius:n,tube:r,radialSegments:i,tubularSegments:o,arc:a},i=Math.floor(i),o=Math.floor(o);for(var s=[],u=[],c=[],l=[],f=new dr,h=new dr,p=new dr,m=0;m<=i;m++)for(var y=0;y<=o;y++){var v=y/o*a,g=m/i*Math.PI*2;h.x=(n+r*Math.cos(g))*Math.cos(v),h.y=(n+r*Math.cos(g))*Math.sin(v),h.z=r*Math.sin(g),u.push(h.x,h.y,h.z),f.x=n*Math.cos(v),f.y=n*Math.sin(v),p.subVectors(h,f).normalize(),c.push(p.x,p.y,p.z),l.push(y/o),l.push(m/i)}for(var b=1;b<=i;b++)for(var _=1;_<=o;_++){var x=(o+1)*b+_-1,S=(o+1)*(b-1)+_-1,T=(o+1)*(b-1)+_,M=(o+1)*b+_;s.push(x,S,M),s.push(S,T,M)}return t.setIndex(s),t.setAttribute("position",new Yi(u,3)),t.setAttribute("normal",new Yi(c,3)),t.setAttribute("uv",new Yi(l,2)),t}return v(e,t),T(e,[{key:"copy",value:function(t){return l(y(e.prototype),"copy",this).call(this,t),this.parameters=Object.assign({},t.parameters),this}}],[{key:"fromJSON",value:function(t){return new e(t.radius,t.tube,t.radialSegments,t.tubularSegments,t.arc)}}])}(no),Mc=function(t){function e(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.4,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:64,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:8,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:2,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:3;w(this,e),(t=d(this,e)).type="TorusKnotGeometry",t.parameters={radius:n,tube:r,tubularSegments:i,radialSegments:o,p:a,q:s},i=Math.floor(i),o=Math.floor(o);for(var u=[],c=[],l=[],f=[],h=new dr,p=new dr,m=new dr,y=new dr,v=new dr,g=new dr,b=new dr,_=0;_<=i;++_){var x=_/i*a*Math.PI*2;N(x,a,s,n,m),N(x+.01,a,s,n,y),g.subVectors(y,m),b.addVectors(y,m),v.crossVectors(g,b),b.crossVectors(v,g),v.normalize(),b.normalize();for(var S=0;S<=o;++S){var T=S/o*Math.PI*2,M=-r*Math.cos(T),E=r*Math.sin(T);h.x=m.x+(M*b.x+E*v.x),h.y=m.y+(M*b.y+E*v.y),h.z=m.z+(M*b.z+E*v.z),c.push(h.x,h.y,h.z),p.subVectors(h,m).normalize(),l.push(p.x,p.y,p.z),f.push(_/i),f.push(S/o)}}for(var A=1;A<=i;A++)for(var O=1;O<=o;O++){var P=(o+1)*(A-1)+(O-1),R=(o+1)*A+(O-1),k=(o+1)*A+O,C=(o+1)*(A-1)+O;u.push(P,R,C),u.push(R,k,C)}function N(t,e,n,r,i){var o=Math.cos(t),a=Math.sin(t),s=n/e*t,u=Math.cos(s);i.x=r*(2+u)*.5*o,i.y=r*(2+u)*a*.5,i.z=r*Math.sin(s)*.5}return t.setIndex(u),t.setAttribute("position",new Yi(c,3)),t.setAttribute("normal",new Yi(l,3)),t.setAttribute("uv",new Yi(f,2)),t}return v(e,t),T(e,[{key:"copy",value:function(t){return l(y(e.prototype),"copy",this).call(this,t),this.parameters=Object.assign({},t.parameters),this}}],[{key:"fromJSON",value:function(t){return new e(t.radius,t.tube,t.tubularSegments,t.radialSegments,t.p,t.q)}}])}(no),Ec=function(t){function e(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Eu(new dr(-1,-1,0),new dr(-1,1,0),new dr(1,1,0)),r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:64,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:8,a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];w(this,e),(t=d(this,e)).type="TubeGeometry",t.parameters={path:n,tubularSegments:r,radius:i,radialSegments:o,closed:a};var s=n.computeFrenetFrames(r,a);t.tangents=s.tangents,t.normals=s.normals,t.binormals=s.binormals;var u=new dr,c=new dr,l=new Fn,f=new dr,h=[],p=[],m=[],y=[];function v(t){f=n.getPointAt(t/r,f);for(var e=s.normals[t],a=s.binormals[t],l=0;l<=o;l++){var d=l/o*Math.PI*2,m=Math.sin(d),y=-Math.cos(d);c.x=y*e.x+m*a.x,c.y=y*e.y+m*a.y,c.z=y*e.z+m*a.z,c.normalize(),p.push(c.x,c.y,c.z),u.x=f.x+i*c.x,u.y=f.y+i*c.y,u.z=f.z+i*c.z,h.push(u.x,u.y,u.z)}}return function(){for(var t=0;t<r;t++)v(t);v(!1===a?r:0),function(){for(var t=0;t<=r;t++)for(var e=0;e<=o;e++)l.x=t/r,l.y=e/o,m.push(l.x,l.y)}(),function(){for(var t=1;t<=r;t++)for(var e=1;e<=o;e++){var n=(o+1)*(t-1)+(e-1),i=(o+1)*t+(e-1),a=(o+1)*t+e,s=(o+1)*(t-1)+e;y.push(n,i,s),y.push(i,a,s)}}()}(),t.setIndex(y),t.setAttribute("position",new Yi(h,3)),t.setAttribute("normal",new Yi(p,3)),t.setAttribute("uv",new Yi(m,2)),t}return v(e,t),T(e,[{key:"copy",value:function(t){return l(y(e.prototype),"copy",this).call(this,t),this.parameters=Object.assign({},t.parameters),this}},{key:"toJSON",value:function(){var t=l(y(e.prototype),"toJSON",this).call(this);return t.path=this.parameters.path.toJSON(),t}}],[{key:"fromJSON",value:function(t){return new e((new Ou[t.path.type]).fromJSON(t.path),t.tubularSegments,t.radius,t.radialSegments,t.closed)}}])}(no),Ac=function(t){function e(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(w(this,e),(t=d(this,e)).type="WireframeGeometry",t.parameters={geometry:n},null!==n){var r=[],i=new Set,o=new dr,a=new dr;if(null!==n.index){var s=n.attributes.position,u=n.index,c=n.groups;0===c.length&&(c=[{start:0,count:u.count,materialIndex:0}]);for(var l=0,f=c.length;l<f;++l)for(var h=c[l],p=h.start,m=p,y=p+h.count;m<y;m+=3)for(var v=0;v<3;v++){var g=u.getX(m+v),b=u.getX(m+(v+1)%3);o.fromBufferAttribute(s,g),a.fromBufferAttribute(s,b),!0===Oc(o,a,i)&&(r.push(o.x,o.y,o.z),r.push(a.x,a.y,a.z))}}else for(var _=n.attributes.position,x=0,S=_.count/3;x<S;x++)for(var T=0;T<3;T++){var M=3*x+T,E=3*x+(T+1)%3;o.fromBufferAttribute(_,M),a.fromBufferAttribute(_,E),!0===Oc(o,a,i)&&(r.push(o.x,o.y,o.z),r.push(a.x,a.y,a.z))}t.setAttribute("position",new Yi(r,3))}return t}return v(e,t),T(e,[{key:"copy",value:function(t){return l(y(e.prototype),"copy",this).call(this,t),this.parameters=Object.assign({},t.parameters),this}}])}(no);function Oc(t,e,n){var r="".concat(t.x,",").concat(t.y,",").concat(t.z,"-").concat(e.x,",").concat(e.y,",").concat(e.z),i="".concat(e.x,",").concat(e.y,",").concat(e.z,"-").concat(t.x,",").concat(t.y,",").concat(t.z);return!0!==n.has(r)&&!0!==n.has(i)&&(n.add(r),n.add(i),!0)}var Pc=Object.freeze({__proto__:null,BoxGeometry:So,CapsuleGeometry:ku,CircleGeometry:Cu,ConeGeometry:Lu,CylinderGeometry:Nu,DodecahedronGeometry:Iu,EdgesGeometry:zu,ExtrudeGeometry:yc,IcosahedronGeometry:gc,LatheGeometry:Ru,OctahedronGeometry:bc,PlaneGeometry:Ho,PolyhedronGeometry:ju,RingGeometry:_c,ShapeGeometry:xc,SphereGeometry:wc,TetrahedronGeometry:Sc,TorusGeometry:Tc,TorusKnotGeometry:Mc,TubeGeometry:Ec,WireframeGeometry:Ac}),Rc=function(t){function e(t){var n;return w(this,e),(n=d(this,e)).isShadowMaterial=!0,n.type="ShadowMaterial",n.color=new Ni(0),n.transparent=!0,n.fog=!0,n.setValues(t),n}return v(e,t),T(e,[{key:"copy",value:function(t){return l(y(e.prototype),"copy",this).call(this,t),this.color.copy(t.color),this.fog=t.fog,this}}])}(Ii),kc=function(t){function e(t){var n;return w(this,e),(n=d(this,e,[t])).isRawShaderMaterial=!0,n.type="RawShaderMaterial",n}return v(e,t),T(e)}(Ao),Cc=function(t){function e(t){var n;return w(this,e),(n=d(this,e)).isMeshStandardMaterial=!0,n.defines={STANDARD:""},n.type="MeshStandardMaterial",n.color=new Ni(16777215),n.roughness=1,n.metalness=0,n.map=null,n.lightMap=null,n.lightMapIntensity=1,n.aoMap=null,n.aoMapIntensity=1,n.emissive=new Ni(0),n.emissiveIntensity=1,n.emissiveMap=null,n.bumpMap=null,n.bumpScale=1,n.normalMap=null,n.normalMapType=He,n.normalScale=new Fn(1,1),n.displacementMap=null,n.displacementScale=1,n.displacementBias=0,n.roughnessMap=null,n.metalnessMap=null,n.alphaMap=null,n.envMap=null,n.envMapRotation=new ti,n.envMapIntensity=1,n.wireframe=!1,n.wireframeLinewidth=1,n.wireframeLinecap="round",n.wireframeLinejoin="round",n.flatShading=!1,n.fog=!0,n.setValues(t),n}return v(e,t),T(e,[{key:"copy",value:function(t){return l(y(e.prototype),"copy",this).call(this,t),this.defines={STANDARD:""},this.color.copy(t.color),this.roughness=t.roughness,this.metalness=t.metalness,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.roughnessMap=t.roughnessMap,this.metalnessMap=t.metalnessMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapRotation.copy(t.envMapRotation),this.envMapIntensity=t.envMapIntensity,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this.fog=t.fog,this}}])}(Ii),Nc=function(t){function e(t){var n;return w(this,e),(n=d(this,e)).isMeshPhysicalMaterial=!0,n.defines={STANDARD:"",PHYSICAL:""},n.type="MeshPhysicalMaterial",n.anisotropyRotation=0,n.anisotropyMap=null,n.clearcoatMap=null,n.clearcoatRoughness=0,n.clearcoatRoughnessMap=null,n.clearcoatNormalScale=new Fn(1,1),n.clearcoatNormalMap=null,n.ior=1.5,Object.defineProperty(n,"reflectivity",{get:function(){return Ln(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(t){this.ior=(1+.4*t)/(1-.4*t)}}),n.iridescenceMap=null,n.iridescenceIOR=1.3,n.iridescenceThicknessRange=[100,400],n.iridescenceThicknessMap=null,n.sheenColor=new Ni(0),n.sheenColorMap=null,n.sheenRoughness=1,n.sheenRoughnessMap=null,n.transmissionMap=null,n.thickness=0,n.thicknessMap=null,n.attenuationDistance=1/0,n.attenuationColor=new Ni(1,1,1),n.specularIntensity=1,n.specularIntensityMap=null,n.specularColor=new Ni(1,1,1),n.specularColorMap=null,n._anisotropy=0,n._clearcoat=0,n._iridescence=0,n._sheen=0,n._transmission=0,n.setValues(t),n}return v(e,t),T(e,[{key:"anisotropy",get:function(){return this._anisotropy},set:function(t){this._anisotropy>0!=t>0&&this.version++,this._anisotropy=t}},{key:"clearcoat",get:function(){return this._clearcoat},set:function(t){this._clearcoat>0!=t>0&&this.version++,this._clearcoat=t}},{key:"iridescence",get:function(){return this._iridescence},set:function(t){this._iridescence>0!=t>0&&this.version++,this._iridescence=t}},{key:"sheen",get:function(){return this._sheen},set:function(t){this._sheen>0!=t>0&&this.version++,this._sheen=t}},{key:"transmission",get:function(){return this._transmission},set:function(t){this._transmission>0!=t>0&&this.version++,this._transmission=t}},{key:"copy",value:function(t){return l(y(e.prototype),"copy",this).call(this,t),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=t.anisotropy,this.anisotropyRotation=t.anisotropyRotation,this.anisotropyMap=t.anisotropyMap,this.clearcoat=t.clearcoat,this.clearcoatMap=t.clearcoatMap,this.clearcoatRoughness=t.clearcoatRoughness,this.clearcoatRoughnessMap=t.clearcoatRoughnessMap,this.clearcoatNormalMap=t.clearcoatNormalMap,this.clearcoatNormalScale.copy(t.clearcoatNormalScale),this.ior=t.ior,this.iridescence=t.iridescence,this.iridescenceMap=t.iridescenceMap,this.iridescenceIOR=t.iridescenceIOR,this.iridescenceThicknessRange=f(t.iridescenceThicknessRange),this.iridescenceThicknessMap=t.iridescenceThicknessMap,this.sheen=t.sheen,this.sheenColor.copy(t.sheenColor),this.sheenColorMap=t.sheenColorMap,this.sheenRoughness=t.sheenRoughness,this.sheenRoughnessMap=t.sheenRoughnessMap,this.transmission=t.transmission,this.transmissionMap=t.transmissionMap,this.thickness=t.thickness,this.thicknessMap=t.thicknessMap,this.attenuationDistance=t.attenuationDistance,this.attenuationColor.copy(t.attenuationColor),this.specularIntensity=t.specularIntensity,this.specularIntensityMap=t.specularIntensityMap,this.specularColor.copy(t.specularColor),this.specularColorMap=t.specularColorMap,this}}])}(Cc),Lc=function(t){function e(t){var n;return w(this,e),(n=d(this,e)).isMeshPhongMaterial=!0,n.type="MeshPhongMaterial",n.color=new Ni(16777215),n.specular=new Ni(1118481),n.shininess=30,n.map=null,n.lightMap=null,n.lightMapIntensity=1,n.aoMap=null,n.aoMapIntensity=1,n.emissive=new Ni(0),n.emissiveIntensity=1,n.emissiveMap=null,n.bumpMap=null,n.bumpScale=1,n.normalMap=null,n.normalMapType=He,n.normalScale=new Fn(1,1),n.displacementMap=null,n.displacementScale=1,n.displacementBias=0,n.specularMap=null,n.alphaMap=null,n.envMap=null,n.envMapRotation=new ti,n.combine=ft,n.reflectivity=1,n.refractionRatio=.98,n.wireframe=!1,n.wireframeLinewidth=1,n.wireframeLinecap="round",n.wireframeLinejoin="round",n.flatShading=!1,n.fog=!0,n.setValues(t),n}return v(e,t),T(e,[{key:"copy",value:function(t){return l(y(e.prototype),"copy",this).call(this,t),this.color.copy(t.color),this.specular.copy(t.specular),this.shininess=t.shininess,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapRotation.copy(t.envMapRotation),this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this.fog=t.fog,this}}])}(Ii),jc=function(t){function e(t){var n;return w(this,e),(n=d(this,e)).isMeshToonMaterial=!0,n.defines={TOON:""},n.type="MeshToonMaterial",n.color=new Ni(16777215),n.map=null,n.gradientMap=null,n.lightMap=null,n.lightMapIntensity=1,n.aoMap=null,n.aoMapIntensity=1,n.emissive=new Ni(0),n.emissiveIntensity=1,n.emissiveMap=null,n.bumpMap=null,n.bumpScale=1,n.normalMap=null,n.normalMapType=He,n.normalScale=new Fn(1,1),n.displacementMap=null,n.displacementScale=1,n.displacementBias=0,n.alphaMap=null,n.wireframe=!1,n.wireframeLinewidth=1,n.wireframeLinecap="round",n.wireframeLinejoin="round",n.fog=!0,n.setValues(t),n}return v(e,t),T(e,[{key:"copy",value:function(t){return l(y(e.prototype),"copy",this).call(this,t),this.color.copy(t.color),this.map=t.map,this.gradientMap=t.gradientMap,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.fog=t.fog,this}}])}(Ii),Ic=function(t){function e(t){var n;return w(this,e),(n=d(this,e)).isMeshNormalMaterial=!0,n.type="MeshNormalMaterial",n.bumpMap=null,n.bumpScale=1,n.normalMap=null,n.normalMapType=He,n.normalScale=new Fn(1,1),n.displacementMap=null,n.displacementScale=1,n.displacementBias=0,n.wireframe=!1,n.wireframeLinewidth=1,n.flatShading=!1,n.setValues(t),n}return v(e,t),T(e,[{key:"copy",value:function(t){return l(y(e.prototype),"copy",this).call(this,t),this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.flatShading=t.flatShading,this}}])}(Ii),Bc=function(t){function e(t){var n;return w(this,e),(n=d(this,e)).isMeshLambertMaterial=!0,n.type="MeshLambertMaterial",n.color=new Ni(16777215),n.map=null,n.lightMap=null,n.lightMapIntensity=1,n.aoMap=null,n.aoMapIntensity=1,n.emissive=new Ni(0),n.emissiveIntensity=1,n.emissiveMap=null,n.bumpMap=null,n.bumpScale=1,n.normalMap=null,n.normalMapType=He,n.normalScale=new Fn(1,1),n.displacementMap=null,n.displacementScale=1,n.displacementBias=0,n.specularMap=null,n.alphaMap=null,n.envMap=null,n.envMapRotation=new ti,n.combine=ft,n.reflectivity=1,n.refractionRatio=.98,n.wireframe=!1,n.wireframeLinewidth=1,n.wireframeLinecap="round",n.wireframeLinejoin="round",n.flatShading=!1,n.fog=!0,n.setValues(t),n}return v(e,t),T(e,[{key:"copy",value:function(t){return l(y(e.prototype),"copy",this).call(this,t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapRotation.copy(t.envMapRotation),this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this.fog=t.fog,this}}])}(Ii),Uc=function(t){function e(t){var n;return w(this,e),(n=d(this,e)).isMeshMatcapMaterial=!0,n.defines={MATCAP:""},n.type="MeshMatcapMaterial",n.color=new Ni(16777215),n.matcap=null,n.map=null,n.bumpMap=null,n.bumpScale=1,n.normalMap=null,n.normalMapType=He,n.normalScale=new Fn(1,1),n.displacementMap=null,n.displacementScale=1,n.displacementBias=0,n.alphaMap=null,n.flatShading=!1,n.fog=!0,n.setValues(t),n}return v(e,t),T(e,[{key:"copy",value:function(t){return l(y(e.prototype),"copy",this).call(this,t),this.defines={MATCAP:""},this.color.copy(t.color),this.matcap=t.matcap,this.map=t.map,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.flatShading=t.flatShading,this.fog=t.fog,this}}])}(Ii),Dc=function(t){function e(t){var n;return w(this,e),(n=d(this,e)).isLineDashedMaterial=!0,n.type="LineDashedMaterial",n.scale=1,n.dashSize=3,n.gapSize=1,n.setValues(t),n}return v(e,t),T(e,[{key:"copy",value:function(t){return l(y(e.prototype),"copy",this).call(this,t),this.scale=t.scale,this.dashSize=t.dashSize,this.gapSize=t.gapSize,this}}])}(Hs);function Fc(t,e,n){return!t||!n&&t.constructor===e?t:"number"==typeof e.BYTES_PER_ELEMENT?new e(t):Array.prototype.slice.call(t)}function zc(t){for(var e=t.length,n=new Array(e),r=0;r!==e;++r)n[r]=r;return n.sort((function(e,n){return t[e]-t[n]})),n}function Vc(t,e,n){for(var r=t.length,i=new t.constructor(r),o=0,a=0;a!==r;++o)for(var s=n[o]*e,u=0;u!==e;++u)i[a++]=t[s+u];return i}function Gc(t,e,n,r){for(var i=1,o=t[0];void 0!==o&&void 0===o[r];)o=t[i++];if(void 0!==o){var a=o[r];if(void 0!==a)if(Array.isArray(a))do{void 0!==(a=o[r])&&(e.push(o.time),n.push.apply(n,a)),o=t[i++]}while(void 0!==o);else if(void 0!==a.toArray)do{void 0!==(a=o[r])&&(e.push(o.time),a.toArray(n,n.length)),o=t[i++]}while(void 0!==o);else do{void 0!==(a=o[r])&&(e.push(o.time),n.push(a)),o=t[i++]}while(void 0!==o)}}var Hc=function(){return T((function t(e,n,r,i){w(this,t),this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=void 0!==i?i:new n.constructor(r),this.sampleValues=n,this.valueSize=r,this.settings=null,this.DefaultSettings_={}}),[{key:"evaluate",value:function(t){var e=this.parameterPositions,n=this._cachedIndex,r=e[n],i=e[n-1];t:{e:{var o;n:{r:if(!(t<r)){for(var a=n+2;;){if(void 0===r){if(t<i)break r;return n=e.length,this._cachedIndex=n,this.copySampleValue_(n-1)}if(n===a)break;if(i=r,t<(r=e[++n]))break e}o=e.length;break n}if(t>=i)break t;var s=e[1];t<s&&(n=2,i=s);for(var u=n-2;;){if(void 0===i)return this._cachedIndex=0,this.copySampleValue_(0);if(n===u)break;if(r=i,t>=(i=e[--n-1]))break e}o=n,n=0}for(;n<o;){var c=n+o>>>1;t<e[c]?o=c:n=c+1}if(r=e[n],void 0===(i=e[n-1]))return this._cachedIndex=0,this.copySampleValue_(0);if(void 0===r)return n=e.length,this._cachedIndex=n,this.copySampleValue_(n-1)}this._cachedIndex=n,this.intervalChanged_(n,i,r)}return this.interpolate_(n,i,t,r)}},{key:"getSettings_",value:function(){return this.settings||this.DefaultSettings_}},{key:"copySampleValue_",value:function(t){for(var e=this.resultBuffer,n=this.sampleValues,r=this.valueSize,i=t*r,o=0;o!==r;++o)e[o]=n[i+o];return e}},{key:"interpolate_",value:function(){throw new Error("call to abstract method")}},{key:"intervalChanged_",value:function(){}}])}(),Wc=function(t){function e(t,n,r,i){var o;return w(this,e),(o=d(this,e,[t,n,r,i]))._weightPrev=-0,o._offsetPrev=-0,o._weightNext=-0,o._offsetNext=-0,o.DefaultSettings_={endingStart:Ue,endingEnd:Ue},o}return v(e,t),T(e,[{key:"intervalChanged_",value:function(t,e,n){var r=this.parameterPositions,i=t-2,o=t+1,a=r[i],s=r[o];if(void 0===a)switch(this.getSettings_().endingStart){case De:i=t,a=2*e-n;break;case Fe:a=e+r[i=r.length-2]-r[i+1];break;default:i=t,a=n}if(void 0===s)switch(this.getSettings_().endingEnd){case De:o=t,s=2*n-e;break;case Fe:o=1,s=n+r[1]-r[0];break;default:o=t-1,s=e}var u=.5*(n-e),c=this.valueSize;this._weightPrev=u/(e-a),this._weightNext=u/(s-n),this._offsetPrev=i*c,this._offsetNext=o*c}},{key:"interpolate_",value:function(t,e,n,r){for(var i=this.resultBuffer,o=this.sampleValues,a=this.valueSize,s=t*a,u=s-a,c=this._offsetPrev,l=this._offsetNext,f=this._weightPrev,h=this._weightNext,p=(n-e)/(r-e),d=p*p,m=d*p,y=-f*m+2*f*d-f*p,v=(1+f)*m+(-1.5-2*f)*d+(-.5+f)*p+1,g=(-1-h)*m+(1.5+h)*d+.5*p,b=h*m-h*d,_=0;_!==a;++_)i[_]=y*o[c+_]+v*o[u+_]+g*o[s+_]+b*o[l+_];return i}}])}(Hc),qc=function(t){function e(t,n,r,i){return w(this,e),d(this,e,[t,n,r,i])}return v(e,t),T(e,[{key:"interpolate_",value:function(t,e,n,r){for(var i=this.resultBuffer,o=this.sampleValues,a=this.valueSize,s=t*a,u=s-a,c=(n-e)/(r-e),l=1-c,f=0;f!==a;++f)i[f]=o[u+f]*l+o[s+f]*c;return i}}])}(Hc),Xc=function(t){function e(t,n,r,i){return w(this,e),d(this,e,[t,n,r,i])}return v(e,t),T(e,[{key:"interpolate_",value:function(t){return this.copySampleValue_(t-1)}}])}(Hc),Yc=function(){return T((function t(e,n,r,i){if(w(this,t),void 0===e)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===n||0===n.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=Fc(n,this.TimeBufferType),this.values=Fc(r,this.ValueBufferType),this.setInterpolation(i||this.DefaultInterpolation)}),[{key:"InterpolantFactoryMethodDiscrete",value:function(t){return new Xc(this.times,this.values,this.getValueSize(),t)}},{key:"InterpolantFactoryMethodLinear",value:function(t){return new qc(this.times,this.values,this.getValueSize(),t)}},{key:"InterpolantFactoryMethodSmooth",value:function(t){return new Wc(this.times,this.values,this.getValueSize(),t)}},{key:"setInterpolation",value:function(t){var e;switch(t){case je:e=this.InterpolantFactoryMethodDiscrete;break;case Ie:e=this.InterpolantFactoryMethodLinear;break;case Be:e=this.InterpolantFactoryMethodSmooth}if(void 0===e){var n="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(t===this.DefaultInterpolation)throw new Error(n);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",n),this}return this.createInterpolant=e,this}},{key:"getInterpolation",value:function(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return je;case this.InterpolantFactoryMethodLinear:return Ie;case this.InterpolantFactoryMethodSmooth:return Be}}},{key:"getValueSize",value:function(){return this.values.length/this.times.length}},{key:"shift",value:function(t){if(0!==t)for(var e=this.times,n=0,r=e.length;n!==r;++n)e[n]+=t;return this}},{key:"scale",value:function(t){if(1!==t)for(var e=this.times,n=0,r=e.length;n!==r;++n)e[n]*=t;return this}},{key:"trim",value:function(t,e){for(var n=this.times,r=n.length,i=0,o=r-1;i!==r&&n[i]<t;)++i;for(;-1!==o&&n[o]>e;)--o;if(++o,0!==i||o!==r){i>=o&&(i=(o=Math.max(o,1))-1);var a=this.getValueSize();this.times=n.slice(i,o),this.values=this.values.slice(i*a,o*a)}return this}},{key:"validate",value:function(){var t=!0,e=this.getValueSize();e-Math.floor(e)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),t=!1);var n,r=this.times,i=this.values,o=r.length;0===o&&(console.error("THREE.KeyframeTrack: Track is empty.",this),t=!1);for(var a=null,s=0;s!==o;s++){var u=r[s];if("number"==typeof u&&isNaN(u)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,s,u),t=!1;break}if(null!==a&&a>u){console.error("THREE.KeyframeTrack: Out of order keys.",this,s,u,a),t=!1;break}a=u}if(void 0!==i&&(n=i,ArrayBuffer.isView(n)&&!(n instanceof DataView)))for(var c=0,l=i.length;c!==l;++c){var f=i[c];if(isNaN(f)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,c,f),t=!1;break}}return t}},{key:"optimize",value:function(){for(var t=this.times.slice(),e=this.values.slice(),n=this.getValueSize(),r=this.getInterpolation()===Be,i=t.length-1,o=1,a=1;a<i;++a){var s=!1,u=t[a];if(u!==t[a+1]&&(1!==a||u!==t[0]))if(r)s=!0;else for(var c=a*n,l=c-n,f=c+n,h=0;h!==n;++h){var p=e[c+h];if(p!==e[l+h]||p!==e[f+h]){s=!0;break}}if(s){if(a!==o){t[o]=t[a];for(var d=a*n,m=o*n,y=0;y!==n;++y)e[m+y]=e[d+y]}++o}}if(i>0){t[o]=t[i];for(var v=i*n,g=o*n,b=0;b!==n;++b)e[g+b]=e[v+b];++o}return o!==t.length?(this.times=t.slice(0,o),this.values=e.slice(0,o*n)):(this.times=t,this.values=e),this}},{key:"clone",value:function(){var t=this.times.slice(),e=this.values.slice(),n=new(0,this.constructor)(this.name,t,e);return n.createInterpolant=this.createInterpolant,n}}],[{key:"toJSON",value:function(t){var e,n=t.constructor;if(n.toJSON!==this.toJSON)e=n.toJSON(t);else{e={name:t.name,times:Fc(t.times,Array),values:Fc(t.values,Array)};var r=t.getInterpolation();r!==t.DefaultInterpolation&&(e.interpolation=r)}return e.type=t.ValueTypeName,e}}])}();Yc.prototype.TimeBufferType=Float32Array,Yc.prototype.ValueBufferType=Float32Array,Yc.prototype.DefaultInterpolation=Ie;var Jc=function(t){function e(){return w(this,e),d(this,e,arguments)}return v(e,t),T(e)}(Yc);Jc.prototype.ValueTypeName="bool",Jc.prototype.ValueBufferType=Array,Jc.prototype.DefaultInterpolation=je,Jc.prototype.InterpolantFactoryMethodLinear=void 0,Jc.prototype.InterpolantFactoryMethodSmooth=void 0;var Zc=function(t){function e(){return w(this,e),d(this,e,arguments)}return v(e,t),T(e)}(Yc);Zc.prototype.ValueTypeName="color";var Kc=function(t){function e(){return w(this,e),d(this,e,arguments)}return v(e,t),T(e)}(Yc);Kc.prototype.ValueTypeName="number";var Qc=function(t){function e(t,n,r,i){return w(this,e),d(this,e,[t,n,r,i])}return v(e,t),T(e,[{key:"interpolate_",value:function(t,e,n,r){for(var i=this.resultBuffer,o=this.sampleValues,a=this.valueSize,s=(n-e)/(r-e),u=t*a,c=u+a;u!==c;u+=4)pr.slerpFlat(i,0,o,u-a,o,u,s);return i}}])}(Hc),$c=function(t){function e(){return w(this,e),d(this,e,arguments)}return v(e,t),T(e,[{key:"InterpolantFactoryMethodLinear",value:function(t){return new Qc(this.times,this.values,this.getValueSize(),t)}}])}(Yc);$c.prototype.ValueTypeName="quaternion",$c.prototype.DefaultInterpolation=Ie,$c.prototype.InterpolantFactoryMethodSmooth=void 0;var tl=function(t){function e(){return w(this,e),d(this,e,arguments)}return v(e,t),T(e)}(Yc);tl.prototype.ValueTypeName="string",tl.prototype.ValueBufferType=Array,tl.prototype.DefaultInterpolation=je,tl.prototype.InterpolantFactoryMethodLinear=void 0,tl.prototype.InterpolantFactoryMethodSmooth=void 0;var el=function(t){function e(){return w(this,e),d(this,e,arguments)}return v(e,t),T(e)}(Yc);el.prototype.ValueTypeName="vector";var nl=function(){return T((function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2500;w(this,t),this.name=e,this.tracks=r,this.duration=n,this.blendMode=i,this.uuid=Nn(),this.duration<0&&this.resetDuration()}),[{key:"resetDuration",value:function(){for(var t=0,e=0,n=this.tracks.length;e!==n;++e){var r=this.tracks[e];t=Math.max(t,r.times[r.times.length-1])}return this.duration=t,this}},{key:"trim",value:function(){for(var t=0;t<this.tracks.length;t++)this.tracks[t].trim(0,this.duration);return this}},{key:"validate",value:function(){for(var t=!0,e=0;e<this.tracks.length;e++)t=t&&this.tracks[e].validate();return t}},{key:"optimize",value:function(){for(var t=0;t<this.tracks.length;t++)this.tracks[t].optimize();return this}},{key:"clone",value:function(){for(var t=[],e=0;e<this.tracks.length;e++)t.push(this.tracks[e].clone());return new this.constructor(this.name,this.duration,t,this.blendMode)}},{key:"toJSON",value:function(){return this.constructor.toJSON(this)}}],[{key:"parse",value:function(t){for(var e=[],n=t.tracks,r=1/(t.fps||1),i=0,o=n.length;i!==o;++i)e.push(rl(n[i]).scale(r));var a=new this(t.name,t.duration,e,t.blendMode);return a.uuid=t.uuid,a}},{key:"toJSON",value:function(t){for(var e=[],n=t.tracks,r={name:t.name,duration:t.duration,tracks:e,uuid:t.uuid,blendMode:t.blendMode},i=0,o=n.length;i!==o;++i)e.push(Yc.toJSON(n[i]));return r}},{key:"CreateFromMorphTargetSequence",value:function(t,e,n,r){for(var i=e.length,o=[],a=0;a<i;a++){var s=[],u=[];s.push((a+i-1)%i,a,(a+1)%i),u.push(0,1,0);var c=zc(s);s=Vc(s,1,c),u=Vc(u,1,c),r||0!==s[0]||(s.push(i),u.push(u[0])),o.push(new Kc(".morphTargetInfluences["+e[a].name+"]",s,u).scale(1/n))}return new this(t,-1,o)}},{key:"findByName",value:function(t,e){var n=t;if(!Array.isArray(t)){var r=t;n=r.geometry&&r.geometry.animations||r.animations}for(var i=0;i<n.length;i++)if(n[i].name===e)return n[i];return null}},{key:"CreateClipsFromMorphTargetSequences",value:function(t,e,n){for(var r={},i=/^([\w-]*?)([\d]+)$/,o=0,a=t.length;o<a;o++){var s=t[o],u=s.name.match(i);if(u&&u.length>1){var c=u[1],l=r[c];l||(r[c]=l=[]),l.push(s)}}var f=[];for(var h in r)f.push(this.CreateFromMorphTargetSequence(h,r[h],e,n));return f}},{key:"parseAnimation",value:function(t,e){if(!t)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;for(var n=function(t,e,n,r,i){if(0!==n.length){var o=[],a=[];Gc(n,o,a,r),0!==o.length&&i.push(new t(e,o,a))}},r=[],i=t.name||"default",o=t.fps||30,a=t.blendMode,s=t.length||-1,u=t.hierarchy||[],c=0;c<u.length;c++){var l=u[c].keys;if(l&&0!==l.length)if(l[0].morphTargets){var f={},h=void 0;for(h=0;h<l.length;h++)if(l[h].morphTargets)for(var p=0;p<l[h].morphTargets.length;p++)f[l[h].morphTargets[p]]=-1;for(var d in f){for(var m=[],y=[],v=0;v!==l[h].morphTargets.length;++v){var g=l[h];m.push(g.time),y.push(g.morphTarget===d?1:0)}r.push(new Kc(".morphTargetInfluence["+d+"]",m,y))}s=f.length*o}else{var b=".bones["+e[c].name+"]";n(el,b+".position",l,"pos",r),n($c,b+".quaternion",l,"rot",r),n(el,b+".scale",l,"scl",r)}}return 0===r.length?null:new this(i,s,r,a)}}])}();function rl(t){if(void 0===t.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");var e=function(t){switch(t.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return Kc;case"vector":case"vector2":case"vector3":case"vector4":return el;case"color":return Zc;case"quaternion":return $c;case"bool":case"boolean":return Jc;case"string":return tl}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+t)}(t.type);if(void 0===t.times){var n=[],r=[];Gc(t.keys,n,r,"value"),t.times=n,t.values=r}return void 0!==e.parse?e.parse(t):new e(t.name,t.times,t.values,t.interpolation)}var il={enabled:!1,files:{},add:function(t,e){!1!==this.enabled&&(this.files[t]=e)},get:function(t){if(!1!==this.enabled)return this.files[t]},remove:function(t){delete this.files[t]},clear:function(){this.files={}}},ol=T((function t(e,n,r){w(this,t);var i=this,o=!1,a=0,s=0,u=void 0,c=[];this.onStart=void 0,this.onLoad=e,this.onProgress=n,this.onError=r,this.itemStart=function(t){s++,!1===o&&void 0!==i.onStart&&i.onStart(t,a,s),o=!0},this.itemEnd=function(t){a++,void 0!==i.onProgress&&i.onProgress(t,a,s),a===s&&(o=!1,void 0!==i.onLoad&&i.onLoad())},this.itemError=function(t){void 0!==i.onError&&i.onError(t)},this.resolveURL=function(t){return u?u(t):t},this.setURLModifier=function(t){return u=t,this},this.addHandler=function(t,e){return c.push(t,e),this},this.removeHandler=function(t){var e=c.indexOf(t);return-1!==e&&c.splice(e,2),this},this.getHandler=function(t){for(var e=0,n=c.length;e<n;e+=2){var r=c[e],i=c[e+1];if(r.global&&(r.lastIndex=0),r.test(t))return i}return null}})),al=new ol,sl=function(){return T((function t(e){w(this,t),this.manager=void 0!==e?e:al,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}),[{key:"load",value:function(){}},{key:"loadAsync",value:function(t,e){var n=this;return new Promise((function(r,i){n.load(t,r,e,i)}))}},{key:"parse",value:function(){}},{key:"setCrossOrigin",value:function(t){return this.crossOrigin=t,this}},{key:"setWithCredentials",value:function(t){return this.withCredentials=t,this}},{key:"setPath",value:function(t){return this.path=t,this}},{key:"setResourcePath",value:function(t){return this.resourcePath=t,this}},{key:"setRequestHeader",value:function(t){return this.requestHeader=t,this}}])}();sl.DEFAULT_MATERIAL_NAME="__DEFAULT";var ul={},cl=function(t){function e(t,n){var r;return w(this,e),(r=d(this,e,[t])).response=n,r}return v(e,t),T(e)}(r(Error)),ll=function(t){function e(t){return w(this,e),d(this,e,[t])}return v(e,t),T(e,[{key:"load",value:function(t,e,n,r){var i=this;void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);var o=il.get(t);if(void 0!==o)return this.manager.itemStart(t),setTimeout((function(){e&&e(o),i.manager.itemEnd(t)}),0),o;if(void 0===ul[t]){ul[t]=[],ul[t].push({onLoad:e,onProgress:n,onError:r});var a=new Request(t,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),s=this.mimeType,u=this.responseType;fetch(a).then((function(e){if(200===e.status||0===e.status){if(0===e.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),"undefined"==typeof ReadableStream||void 0===e.body||void 0===e.body.getReader)return e;var n=ul[t],r=e.body.getReader(),i=e.headers.get("Content-Length")||e.headers.get("X-File-Size"),o=i?parseInt(i):0,a=0!==o,s=0,u=new ReadableStream({start:function(t){!function e(){r.read().then((function(r){var i=r.done,u=r.value;if(i)t.close();else{s+=u.byteLength;for(var c=new ProgressEvent("progress",{lengthComputable:a,loaded:s,total:o}),l=0,f=n.length;l<f;l++){var h=n[l];h.onProgress&&h.onProgress(c)}t.enqueue(u),e()}}))}()}});return new Response(u)}throw new cl('fetch for "'.concat(e.url,'" responded with ').concat(e.status,": ").concat(e.statusText),e)})).then((function(t){switch(u){case"arraybuffer":return t.arrayBuffer();case"blob":return t.blob();case"document":return t.text().then((function(t){return(new DOMParser).parseFromString(t,s)}));case"json":return t.json();default:if(void 0===s)return t.text();var e=/charset="?([^;"\s]*)"?/i.exec(s),n=e&&e[1]?e[1].toLowerCase():void 0,r=new TextDecoder(n);return t.arrayBuffer().then((function(t){return r.decode(t)}))}})).then((function(e){il.add(t,e);var n=ul[t];delete ul[t];for(var r=0,i=n.length;r<i;r++){var o=n[r];o.onLoad&&o.onLoad(e)}})).catch((function(e){var n=ul[t];if(void 0===n)throw i.manager.itemError(t),e;delete ul[t];for(var r=0,o=n.length;r<o;r++){var a=n[r];a.onError&&a.onError(e)}i.manager.itemError(t)})).finally((function(){i.manager.itemEnd(t)})),this.manager.itemStart(t)}else ul[t].push({onLoad:e,onProgress:n,onError:r})}},{key:"setResponseType",value:function(t){return this.responseType=t,this}},{key:"setMimeType",value:function(t){return this.mimeType=t,this}}])}(sl),fl=function(t){function e(t){return w(this,e),d(this,e,[t])}return v(e,t),T(e,[{key:"load",value:function(t,e,n,r){void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);var i=this,o=il.get(t);if(void 0!==o)return i.manager.itemStart(t),setTimeout((function(){e&&e(o),i.manager.itemEnd(t)}),0),o;var a=Wn("img");function s(){c(),il.add(t,this),e&&e(this),i.manager.itemEnd(t)}function u(e){c(),r&&r(e),i.manager.itemError(t),i.manager.itemEnd(t)}function c(){a.removeEventListener("load",s,!1),a.removeEventListener("error",u,!1)}return a.addEventListener("load",s,!1),a.addEventListener("error",u,!1),"data:"!==t.slice(0,5)&&void 0!==this.crossOrigin&&(a.crossOrigin=this.crossOrigin),i.manager.itemStart(t),a.src=t,a}}])}(sl),hl=function(t){function e(t){return w(this,e),d(this,e,[t])}return v(e,t),T(e,[{key:"load",value:function(t,e,n,r){var i=this,o=new ds,a=new ll(this.manager);return a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setPath(this.path),a.setWithCredentials(i.withCredentials),a.load(t,(function(t){var n;try{n=i.parse(t)}catch(t){if(void 0===r)return void console.error(t);r(t)}void 0!==n.image?o.image=n.image:void 0!==n.data&&(o.image.width=n.width,o.image.height=n.height,o.image.data=n.data),o.wrapS=void 0!==n.wrapS?n.wrapS:Et,o.wrapT=void 0!==n.wrapT?n.wrapT:Et,o.magFilter=void 0!==n.magFilter?n.magFilter:kt,o.minFilter=void 0!==n.minFilter?n.minFilter:kt,o.anisotropy=void 0!==n.anisotropy?n.anisotropy:1,void 0!==n.colorSpace&&(o.colorSpace=n.colorSpace),void 0!==n.flipY&&(o.flipY=n.flipY),void 0!==n.format&&(o.format=n.format),void 0!==n.type&&(o.type=n.type),void 0!==n.mipmaps&&(o.mipmaps=n.mipmaps,o.minFilter=Nt),1===n.mipmapCount&&(o.minFilter=kt),void 0!==n.generateMipmaps&&(o.generateMipmaps=n.generateMipmaps),o.needsUpdate=!0,e&&e(o,n)}),n,r),o}}])}(sl),pl=function(t){function e(t){return w(this,e),d(this,e,[t])}return v(e,t),T(e,[{key:"load",value:function(t,e,n,r){var i=new ur,o=new fl(this.manager);return o.setCrossOrigin(this.crossOrigin),o.setPath(this.path),o.load(t,(function(t){i.image=t,i.needsUpdate=!0,void 0!==e&&e(i)}),n,r),i}}])}(sl),dl=function(t){function e(t){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return w(this,e),(n=d(this,e)).isLight=!0,n.type="Light",n.color=new Ni(t),n.intensity=r,n}return v(e,t),T(e,[{key:"dispose",value:function(){}},{key:"copy",value:function(t,n){return l(y(e.prototype),"copy",this).call(this,t,n),this.color.copy(t.color),this.intensity=t.intensity,this}},{key:"toJSON",value:function(t){var n=l(y(e.prototype),"toJSON",this).call(this,t);return n.object.color=this.color.getHex(),n.object.intensity=this.intensity,void 0!==this.groundColor&&(n.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(n.object.distance=this.distance),void 0!==this.angle&&(n.object.angle=this.angle),void 0!==this.decay&&(n.object.decay=this.decay),void 0!==this.penumbra&&(n.object.penumbra=this.penumbra),void 0!==this.shadow&&(n.object.shadow=this.shadow.toJSON()),n}}])}(vi),ml=function(t){function e(t,n,r){var i;return w(this,e),(i=d(this,e,[t,r])).isHemisphereLight=!0,i.type="HemisphereLight",i.position.copy(vi.DEFAULT_UP),i.updateMatrix(),i.groundColor=new Ni(n),i}return v(e,t),T(e,[{key:"copy",value:function(t,n){return l(y(e.prototype),"copy",this).call(this,t,n),this.groundColor.copy(t.groundColor),this}}])}(dl),yl=new Hr,vl=new dr,gl=new dr,bl=function(){return T((function t(e){w(this,t),this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new Fn(512,512),this.map=null,this.mapPass=null,this.matrix=new Hr,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new Go,this._frameExtents=new Fn(1,1),this._viewportCount=1,this._viewports=[new cr(0,0,1,1)]}),[{key:"getViewportCount",value:function(){return this._viewportCount}},{key:"getFrustum",value:function(){return this._frustum}},{key:"updateMatrices",value:function(t){var e=this.camera,n=this.matrix;vl.setFromMatrixPosition(t.matrixWorld),e.position.copy(vl),gl.setFromMatrixPosition(t.target.matrixWorld),e.lookAt(gl),e.updateMatrixWorld(),yl.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),this._frustum.setFromProjectionMatrix(yl),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(yl)}},{key:"getViewport",value:function(t){return this._viewports[t]}},{key:"getFrameExtents",value:function(){return this._frameExtents}},{key:"dispose",value:function(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}},{key:"copy",value:function(t){return this.camera=t.camera.clone(),this.bias=t.bias,this.radius=t.radius,this.mapSize.copy(t.mapSize),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"toJSON",value:function(){var t={};return 0!==this.bias&&(t.bias=this.bias),0!==this.normalBias&&(t.normalBias=this.normalBias),1!==this.radius&&(t.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(t.mapSize=this.mapSize.toArray()),t.camera=this.camera.toJSON(!1).object,delete t.camera.matrix,t}}])}(),_l=function(t){function e(){var t;return w(this,e),(t=d(this,e,[new Co(50,1,.5,500)])).isSpotLightShadow=!0,t.focus=1,t}return v(e,t),T(e,[{key:"updateMatrices",value:function(t){var n=this.camera,r=2*Cn*t.angle*this.focus,i=this.mapSize.width/this.mapSize.height,o=t.distance||n.far;r===n.fov&&i===n.aspect&&o===n.far||(n.fov=r,n.aspect=i,n.far=o,n.updateProjectionMatrix()),l(y(e.prototype),"updateMatrices",this).call(this,t)}},{key:"copy",value:function(t){return l(y(e.prototype),"copy",this).call(this,t),this.focus=t.focus,this}}])}(bl),xl=function(t){function e(t,n){var r,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Math.PI/3,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:2;return w(this,e),(r=d(this,e,[t,n])).isSpotLight=!0,r.type="SpotLight",r.position.copy(vi.DEFAULT_UP),r.updateMatrix(),r.target=new vi,r.distance=i,r.angle=o,r.penumbra=a,r.decay=s,r.map=null,r.shadow=new _l,r}return v(e,t),T(e,[{key:"power",get:function(){return this.intensity*Math.PI},set:function(t){this.intensity=t/Math.PI}},{key:"dispose",value:function(){this.shadow.dispose()}},{key:"copy",value:function(t,n){return l(y(e.prototype),"copy",this).call(this,t,n),this.distance=t.distance,this.angle=t.angle,this.penumbra=t.penumbra,this.decay=t.decay,this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}])}(dl),wl=new Hr,Sl=new dr,Tl=new dr,Ml=function(t){function e(){var t;return w(this,e),(t=d(this,e,[new Co(90,1,.5,500)])).isPointLightShadow=!0,t._frameExtents=new Fn(4,2),t._viewportCount=6,t._viewports=[new cr(2,1,1,1),new cr(0,1,1,1),new cr(3,1,1,1),new cr(1,1,1,1),new cr(3,0,1,1),new cr(1,0,1,1)],t._cubeDirections=[new dr(1,0,0),new dr(-1,0,0),new dr(0,0,1),new dr(0,0,-1),new dr(0,1,0),new dr(0,-1,0)],t._cubeUps=[new dr(0,1,0),new dr(0,1,0),new dr(0,1,0),new dr(0,1,0),new dr(0,0,1),new dr(0,0,-1)],t}return v(e,t),T(e,[{key:"updateMatrices",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this.camera,r=this.matrix,i=t.distance||n.far;i!==n.far&&(n.far=i,n.updateProjectionMatrix()),Sl.setFromMatrixPosition(t.matrixWorld),n.position.copy(Sl),Tl.copy(n.position),Tl.add(this._cubeDirections[e]),n.up.copy(this._cubeUps[e]),n.lookAt(Tl),n.updateMatrixWorld(),r.makeTranslation(-Sl.x,-Sl.y,-Sl.z),wl.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(wl)}}])}(bl),El=function(t){function e(t,n){var r,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;return w(this,e),(r=d(this,e,[t,n])).isPointLight=!0,r.type="PointLight",r.distance=i,r.decay=o,r.shadow=new Ml,r}return v(e,t),T(e,[{key:"power",get:function(){return 4*this.intensity*Math.PI},set:function(t){this.intensity=t/(4*Math.PI)}},{key:"dispose",value:function(){this.shadow.dispose()}},{key:"copy",value:function(t,n){return l(y(e.prototype),"copy",this).call(this,t,n),this.distance=t.distance,this.decay=t.decay,this.shadow=t.shadow.clone(),this}}])}(dl),Al=function(t){function e(){var t;return w(this,e),(t=d(this,e,[new Aa(-5,5,5,-5,.5,500)])).isDirectionalLightShadow=!0,t}return v(e,t),T(e)}(bl),Ol=function(t){function e(t,n){var r;return w(this,e),(r=d(this,e,[t,n])).isDirectionalLight=!0,r.type="DirectionalLight",r.position.copy(vi.DEFAULT_UP),r.updateMatrix(),r.target=new vi,r.shadow=new Al,r}return v(e,t),T(e,[{key:"dispose",value:function(){this.shadow.dispose()}},{key:"copy",value:function(t){return l(y(e.prototype),"copy",this).call(this,t),this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}])}(dl),Pl=function(t){function e(t,n){var r;return w(this,e),(r=d(this,e,[t,n])).isAmbientLight=!0,r.type="AmbientLight",r}return v(e,t),T(e)}(dl),Rl=function(t){function e(t,n){var r,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;return w(this,e),(r=d(this,e,[t,n])).isRectAreaLight=!0,r.type="RectAreaLight",r.width=i,r.height=o,r}return v(e,t),T(e,[{key:"power",get:function(){return this.intensity*this.width*this.height*Math.PI},set:function(t){this.intensity=t/(this.width*this.height*Math.PI)}},{key:"copy",value:function(t){return l(y(e.prototype),"copy",this).call(this,t),this.width=t.width,this.height=t.height,this}},{key:"toJSON",value:function(t){var n=l(y(e.prototype),"toJSON",this).call(this,t);return n.object.width=this.width,n.object.height=this.height,n}}])}(dl),kl=function(){return T((function t(){w(this,t),this.isSphericalHarmonics3=!0,this.coefficients=[];for(var e=0;e<9;e++)this.coefficients.push(new dr)}),[{key:"set",value:function(t){for(var e=0;e<9;e++)this.coefficients[e].copy(t[e]);return this}},{key:"zero",value:function(){for(var t=0;t<9;t++)this.coefficients[t].set(0,0,0);return this}},{key:"getAt",value:function(t,e){var n=t.x,r=t.y,i=t.z,o=this.coefficients;return e.copy(o[0]).multiplyScalar(.282095),e.addScaledVector(o[1],.488603*r),e.addScaledVector(o[2],.488603*i),e.addScaledVector(o[3],.488603*n),e.addScaledVector(o[4],n*r*1.092548),e.addScaledVector(o[5],r*i*1.092548),e.addScaledVector(o[6],.315392*(3*i*i-1)),e.addScaledVector(o[7],n*i*1.092548),e.addScaledVector(o[8],.546274*(n*n-r*r)),e}},{key:"getIrradianceAt",value:function(t,e){var n=t.x,r=t.y,i=t.z,o=this.coefficients;return e.copy(o[0]).multiplyScalar(.886227),e.addScaledVector(o[1],1.023328*r),e.addScaledVector(o[2],1.023328*i),e.addScaledVector(o[3],1.023328*n),e.addScaledVector(o[4],.858086*n*r),e.addScaledVector(o[5],.858086*r*i),e.addScaledVector(o[6],.743125*i*i-.247708),e.addScaledVector(o[7],.858086*n*i),e.addScaledVector(o[8],.429043*(n*n-r*r)),e}},{key:"add",value:function(t){for(var e=0;e<9;e++)this.coefficients[e].add(t.coefficients[e]);return this}},{key:"addScaledSH",value:function(t,e){for(var n=0;n<9;n++)this.coefficients[n].addScaledVector(t.coefficients[n],e);return this}},{key:"scale",value:function(t){for(var e=0;e<9;e++)this.coefficients[e].multiplyScalar(t);return this}},{key:"lerp",value:function(t,e){for(var n=0;n<9;n++)this.coefficients[n].lerp(t.coefficients[n],e);return this}},{key:"equals",value:function(t){for(var e=0;e<9;e++)if(!this.coefficients[e].equals(t.coefficients[e]))return!1;return!0}},{key:"copy",value:function(t){return this.set(t.coefficients)}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"fromArray",value:function(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this.coefficients,r=0;r<9;r++)n[r].fromArray(t,e+3*r);return this}},{key:"toArray",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this.coefficients,r=0;r<9;r++)n[r].toArray(t,e+3*r);return t}}],[{key:"getBasisAt",value:function(t,e){var n=t.x,r=t.y,i=t.z;e[0]=.282095,e[1]=.488603*r,e[2]=.488603*i,e[3]=.488603*n,e[4]=1.092548*n*r,e[5]=1.092548*r*i,e[6]=.315392*(3*i*i-1),e[7]=1.092548*n*i,e[8]=.546274*(n*n-r*r)}}])}(),Cl=function(t){function e(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new kl,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return w(this,e),(t=d(this,e,[void 0,r])).isLightProbe=!0,t.sh=n,t}return v(e,t),T(e,[{key:"copy",value:function(t){return l(y(e.prototype),"copy",this).call(this,t),this.sh.copy(t.sh),this}},{key:"fromJSON",value:function(t){return this.intensity=t.intensity,this.sh.fromArray(t.sh),this}},{key:"toJSON",value:function(t){var n=l(y(e.prototype),"toJSON",this).call(this,t);return n.object.sh=this.sh.toArray(),n}}])}(dl),Nl=function(t){function e(t){var n;return w(this,e),(n=d(this,e,[t])).textures={},n}return v(e,t),T(e,[{key:"load",value:function(t,e,n,r){var i=this,o=new ll(i.manager);o.setPath(i.path),o.setRequestHeader(i.requestHeader),o.setWithCredentials(i.withCredentials),o.load(t,(function(n){try{e(i.parse(JSON.parse(n)))}catch(e){r?r(e):console.error(e),i.manager.itemError(t)}}),n,r)}},{key:"parse",value:function(t){var n=this.textures;function r(t){return void 0===n[t]&&console.warn("THREE.MaterialLoader: Undefined texture",t),n[t]}var i=e.createMaterialFromType(t.type);if(void 0!==t.uuid&&(i.uuid=t.uuid),void 0!==t.name&&(i.name=t.name),void 0!==t.color&&void 0!==i.color&&i.color.setHex(t.color),void 0!==t.roughness&&(i.roughness=t.roughness),void 0!==t.metalness&&(i.metalness=t.metalness),void 0!==t.sheen&&(i.sheen=t.sheen),void 0!==t.sheenColor&&(i.sheenColor=(new Ni).setHex(t.sheenColor)),void 0!==t.sheenRoughness&&(i.sheenRoughness=t.sheenRoughness),void 0!==t.emissive&&void 0!==i.emissive&&i.emissive.setHex(t.emissive),void 0!==t.specular&&void 0!==i.specular&&i.specular.setHex(t.specular),void 0!==t.specularIntensity&&(i.specularIntensity=t.specularIntensity),void 0!==t.specularColor&&void 0!==i.specularColor&&i.specularColor.setHex(t.specularColor),void 0!==t.shininess&&(i.shininess=t.shininess),void 0!==t.clearcoat&&(i.clearcoat=t.clearcoat),void 0!==t.clearcoatRoughness&&(i.clearcoatRoughness=t.clearcoatRoughness),void 0!==t.iridescence&&(i.iridescence=t.iridescence),void 0!==t.iridescenceIOR&&(i.iridescenceIOR=t.iridescenceIOR),void 0!==t.iridescenceThicknessRange&&(i.iridescenceThicknessRange=t.iridescenceThicknessRange),void 0!==t.transmission&&(i.transmission=t.transmission),void 0!==t.thickness&&(i.thickness=t.thickness),void 0!==t.attenuationDistance&&(i.attenuationDistance=t.attenuationDistance),void 0!==t.attenuationColor&&void 0!==i.attenuationColor&&i.attenuationColor.setHex(t.attenuationColor),void 0!==t.anisotropy&&(i.anisotropy=t.anisotropy),void 0!==t.anisotropyRotation&&(i.anisotropyRotation=t.anisotropyRotation),void 0!==t.fog&&(i.fog=t.fog),void 0!==t.flatShading&&(i.flatShading=t.flatShading),void 0!==t.blending&&(i.blending=t.blending),void 0!==t.combine&&(i.combine=t.combine),void 0!==t.side&&(i.side=t.side),void 0!==t.shadowSide&&(i.shadowSide=t.shadowSide),void 0!==t.opacity&&(i.opacity=t.opacity),void 0!==t.transparent&&(i.transparent=t.transparent),void 0!==t.alphaTest&&(i.alphaTest=t.alphaTest),void 0!==t.alphaHash&&(i.alphaHash=t.alphaHash),void 0!==t.depthFunc&&(i.depthFunc=t.depthFunc),void 0!==t.depthTest&&(i.depthTest=t.depthTest),void 0!==t.depthWrite&&(i.depthWrite=t.depthWrite),void 0!==t.colorWrite&&(i.colorWrite=t.colorWrite),void 0!==t.blendSrc&&(i.blendSrc=t.blendSrc),void 0!==t.blendDst&&(i.blendDst=t.blendDst),void 0!==t.blendEquation&&(i.blendEquation=t.blendEquation),void 0!==t.blendSrcAlpha&&(i.blendSrcAlpha=t.blendSrcAlpha),void 0!==t.blendDstAlpha&&(i.blendDstAlpha=t.blendDstAlpha),void 0!==t.blendEquationAlpha&&(i.blendEquationAlpha=t.blendEquationAlpha),void 0!==t.blendColor&&void 0!==i.blendColor&&i.blendColor.setHex(t.blendColor),void 0!==t.blendAlpha&&(i.blendAlpha=t.blendAlpha),void 0!==t.stencilWriteMask&&(i.stencilWriteMask=t.stencilWriteMask),void 0!==t.stencilFunc&&(i.stencilFunc=t.stencilFunc),void 0!==t.stencilRef&&(i.stencilRef=t.stencilRef),void 0!==t.stencilFuncMask&&(i.stencilFuncMask=t.stencilFuncMask),void 0!==t.stencilFail&&(i.stencilFail=t.stencilFail),void 0!==t.stencilZFail&&(i.stencilZFail=t.stencilZFail),void 0!==t.stencilZPass&&(i.stencilZPass=t.stencilZPass),void 0!==t.stencilWrite&&(i.stencilWrite=t.stencilWrite),void 0!==t.wireframe&&(i.wireframe=t.wireframe),void 0!==t.wireframeLinewidth&&(i.wireframeLinewidth=t.wireframeLinewidth),void 0!==t.wireframeLinecap&&(i.wireframeLinecap=t.wireframeLinecap),void 0!==t.wireframeLinejoin&&(i.wireframeLinejoin=t.wireframeLinejoin),void 0!==t.rotation&&(i.rotation=t.rotation),void 0!==t.linewidth&&(i.linewidth=t.linewidth),void 0!==t.dashSize&&(i.dashSize=t.dashSize),void 0!==t.gapSize&&(i.gapSize=t.gapSize),void 0!==t.scale&&(i.scale=t.scale),void 0!==t.polygonOffset&&(i.polygonOffset=t.polygonOffset),void 0!==t.polygonOffsetFactor&&(i.polygonOffsetFactor=t.polygonOffsetFactor),void 0!==t.polygonOffsetUnits&&(i.polygonOffsetUnits=t.polygonOffsetUnits),void 0!==t.dithering&&(i.dithering=t.dithering),void 0!==t.alphaToCoverage&&(i.alphaToCoverage=t.alphaToCoverage),void 0!==t.premultipliedAlpha&&(i.premultipliedAlpha=t.premultipliedAlpha),void 0!==t.forceSinglePass&&(i.forceSinglePass=t.forceSinglePass),void 0!==t.visible&&(i.visible=t.visible),void 0!==t.toneMapped&&(i.toneMapped=t.toneMapped),void 0!==t.userData&&(i.userData=t.userData),void 0!==t.vertexColors&&("number"==typeof t.vertexColors?i.vertexColors=t.vertexColors>0:i.vertexColors=t.vertexColors),void 0!==t.uniforms)for(var o in t.uniforms){var a=t.uniforms[o];switch(i.uniforms[o]={},a.type){case"t":i.uniforms[o].value=r(a.value);break;case"c":i.uniforms[o].value=(new Ni).setHex(a.value);break;case"v2":i.uniforms[o].value=(new Fn).fromArray(a.value);break;case"v3":i.uniforms[o].value=(new dr).fromArray(a.value);break;case"v4":i.uniforms[o].value=(new cr).fromArray(a.value);break;case"m3":i.uniforms[o].value=(new zn).fromArray(a.value);break;case"m4":i.uniforms[o].value=(new Hr).fromArray(a.value);break;default:i.uniforms[o].value=a.value}}if(void 0!==t.defines&&(i.defines=t.defines),void 0!==t.vertexShader&&(i.vertexShader=t.vertexShader),void 0!==t.fragmentShader&&(i.fragmentShader=t.fragmentShader),void 0!==t.glslVersion&&(i.glslVersion=t.glslVersion),void 0!==t.extensions)for(var s in t.extensions)i.extensions[s]=t.extensions[s];if(void 0!==t.lights&&(i.lights=t.lights),void 0!==t.clipping&&(i.clipping=t.clipping),void 0!==t.size&&(i.size=t.size),void 0!==t.sizeAttenuation&&(i.sizeAttenuation=t.sizeAttenuation),void 0!==t.map&&(i.map=r(t.map)),void 0!==t.matcap&&(i.matcap=r(t.matcap)),void 0!==t.alphaMap&&(i.alphaMap=r(t.alphaMap)),void 0!==t.bumpMap&&(i.bumpMap=r(t.bumpMap)),void 0!==t.bumpScale&&(i.bumpScale=t.bumpScale),void 0!==t.normalMap&&(i.normalMap=r(t.normalMap)),void 0!==t.normalMapType&&(i.normalMapType=t.normalMapType),void 0!==t.normalScale){var u=t.normalScale;!1===Array.isArray(u)&&(u=[u,u]),i.normalScale=(new Fn).fromArray(u)}return void 0!==t.displacementMap&&(i.displacementMap=r(t.displacementMap)),void 0!==t.displacementScale&&(i.displacementScale=t.displacementScale),void 0!==t.displacementBias&&(i.displacementBias=t.displacementBias),void 0!==t.roughnessMap&&(i.roughnessMap=r(t.roughnessMap)),void 0!==t.metalnessMap&&(i.metalnessMap=r(t.metalnessMap)),void 0!==t.emissiveMap&&(i.emissiveMap=r(t.emissiveMap)),void 0!==t.emissiveIntensity&&(i.emissiveIntensity=t.emissiveIntensity),void 0!==t.specularMap&&(i.specularMap=r(t.specularMap)),void 0!==t.specularIntensityMap&&(i.specularIntensityMap=r(t.specularIntensityMap)),void 0!==t.specularColorMap&&(i.specularColorMap=r(t.specularColorMap)),void 0!==t.envMap&&(i.envMap=r(t.envMap)),void 0!==t.envMapRotation&&i.envMapRotation.fromArray(t.envMapRotation),void 0!==t.envMapIntensity&&(i.envMapIntensity=t.envMapIntensity),void 0!==t.reflectivity&&(i.reflectivity=t.reflectivity),void 0!==t.refractionRatio&&(i.refractionRatio=t.refractionRatio),void 0!==t.lightMap&&(i.lightMap=r(t.lightMap)),void 0!==t.lightMapIntensity&&(i.lightMapIntensity=t.lightMapIntensity),void 0!==t.aoMap&&(i.aoMap=r(t.aoMap)),void 0!==t.aoMapIntensity&&(i.aoMapIntensity=t.aoMapIntensity),void 0!==t.gradientMap&&(i.gradientMap=r(t.gradientMap)),void 0!==t.clearcoatMap&&(i.clearcoatMap=r(t.clearcoatMap)),void 0!==t.clearcoatRoughnessMap&&(i.clearcoatRoughnessMap=r(t.clearcoatRoughnessMap)),void 0!==t.clearcoatNormalMap&&(i.clearcoatNormalMap=r(t.clearcoatNormalMap)),void 0!==t.clearcoatNormalScale&&(i.clearcoatNormalScale=(new Fn).fromArray(t.clearcoatNormalScale)),void 0!==t.iridescenceMap&&(i.iridescenceMap=r(t.iridescenceMap)),void 0!==t.iridescenceThicknessMap&&(i.iridescenceThicknessMap=r(t.iridescenceThicknessMap)),void 0!==t.transmissionMap&&(i.transmissionMap=r(t.transmissionMap)),void 0!==t.thicknessMap&&(i.thicknessMap=r(t.thicknessMap)),void 0!==t.anisotropyMap&&(i.anisotropyMap=r(t.anisotropyMap)),void 0!==t.sheenColorMap&&(i.sheenColorMap=r(t.sheenColorMap)),void 0!==t.sheenRoughnessMap&&(i.sheenRoughnessMap=r(t.sheenRoughnessMap)),i}},{key:"setTextures",value:function(t){return this.textures=t,this}}],[{key:"createMaterialFromType",value:function(t){return new{ShadowMaterial:Rc,SpriteMaterial:Da,RawShaderMaterial:kc,ShaderMaterial:Ao,PointsMaterial:eu,MeshPhysicalMaterial:Nc,MeshStandardMaterial:Cc,MeshPhongMaterial:Lc,MeshToonMaterial:jc,MeshNormalMaterial:Ic,MeshLambertMaterial:Bc,MeshDepthMaterial:Ra,MeshDistanceMaterial:ka,MeshBasicMaterial:Bi,MeshMatcapMaterial:Uc,LineDashedMaterial:Dc,LineBasicMaterial:Hs,Material:Ii}[t]}}])}(sl),Ll=function(){return T((function t(){w(this,t)}),null,[{key:"decodeText",value:function(t){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(t);for(var e="",n=0,r=t.length;n<r;n++)e+=String.fromCharCode(t[n]);try{return decodeURIComponent(escape(e))}catch(t){return e}}},{key:"extractUrlBase",value:function(t){var e=t.lastIndexOf("/");return-1===e?"./":t.slice(0,e+1)}},{key:"resolveURL",value:function(t,e){return"string"!=typeof t||""===t?"":(/^https?:\/\//i.test(e)&&/^\//.test(t)&&(e=e.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(t)||/^data:.*,.*$/i.test(t)||/^blob:.*$/i.test(t)?t:e+t)}}])}(),jl=function(t){function e(){var t;return w(this,e),(t=d(this,e)).isInstancedBufferGeometry=!0,t.type="InstancedBufferGeometry",t.instanceCount=1/0,t}return v(e,t),T(e,[{key:"copy",value:function(t){return l(y(e.prototype),"copy",this).call(this,t),this.instanceCount=t.instanceCount,this}},{key:"toJSON",value:function(){var t=l(y(e.prototype),"toJSON",this).call(this);return t.instanceCount=this.instanceCount,t.isInstancedBufferGeometry=!0,t}}])}(no),Il=function(t){function e(t){return w(this,e),d(this,e,[t])}return v(e,t),T(e,[{key:"load",value:function(t,e,n,r){var i=this,o=new ll(i.manager);o.setPath(i.path),o.setRequestHeader(i.requestHeader),o.setWithCredentials(i.withCredentials),o.load(t,(function(n){try{e(i.parse(JSON.parse(n)))}catch(e){r?r(e):console.error(e),i.manager.itemError(t)}}),n,r)}},{key:"parse",value:function(t){var e={},n={};function r(t,r){if(void 0!==e[r])return e[r];var i=t.interleavedBuffers[r],o=function(t,e){if(void 0!==n[e])return n[e];var r=t.arrayBuffers[e],i=new Uint32Array(r).buffer;return n[e]=i,i}(t,i.buffer),a=Hn(i.type,o),s=new Ia(a,i.stride);return s.uuid=i.uuid,e[r]=s,s}var i=t.isInstancedBufferGeometry?new jl:new no,o=t.data.index;if(void 0!==o){var a=Hn(o.type,o.array);i.setIndex(new Hi(a,1))}var s=t.data.attributes;for(var u in s){var c=s[u],l=void 0;if(c.isInterleavedBufferAttribute){var f=r(t.data,c.data);l=new Ua(f,c.itemSize,c.offset,c.normalized)}else{var h=Hn(c.type,c.array);l=new(c.isInstancedBufferAttribute?gs:Hi)(h,c.itemSize,c.normalized)}void 0!==c.name&&(l.name=c.name),void 0!==c.usage&&l.setUsage(c.usage),i.setAttribute(u,l)}var p=t.data.morphAttributes;if(p)for(var d in p){for(var m=p[d],y=[],v=0,g=m.length;v<g;v++){var b=m[v],_=void 0;if(b.isInterleavedBufferAttribute){var x=r(t.data,b.data);_=new Ua(x,b.itemSize,b.offset,b.normalized)}else{var w=Hn(b.type,b.array);_=new Hi(w,b.itemSize,b.normalized)}void 0!==b.name&&(_.name=b.name),y.push(_)}i.morphAttributes[d]=y}t.data.morphTargetsRelative&&(i.morphTargetsRelative=!0);var S=t.data.groups||t.data.drawcalls||t.data.offsets;if(void 0!==S)for(var T=0,M=S.length;T!==M;++T){var E=S[T];i.addGroup(E.start,E.count,E.materialIndex)}var A=t.data.boundingSphere;if(void 0!==A){var O=new dr;void 0!==A.center&&O.fromArray(A.center),i.boundingSphere=new jr(O,A.radius)}return t.name&&(i.name=t.name),t.userData&&(i.userData=t.userData),i}}])}(sl),Bl=function(t){function e(t){return w(this,e),d(this,e,[t])}return v(e,t),T(e,[{key:"load",value:function(t,e,n,r){var i=this,o=""===this.path?Ll.extractUrlBase(t):this.path;this.resourcePath=this.resourcePath||o;var a=new ll(this.manager);a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(t,(function(n){var o=null;try{o=JSON.parse(n)}catch(e){return void 0!==r&&r(e),void console.error("THREE:ObjectLoader: Can't parse "+t+".",e.message)}var a=o.metadata;if(void 0===a||void 0===a.type||"geometry"===a.type.toLowerCase())return void 0!==r&&r(new Error("THREE.ObjectLoader: Can't load "+t)),void console.error("THREE.ObjectLoader: Can't load "+t);i.parse(o,e)}),n,r)}},{key:"loadAsync",value:(i=s(_().mark((function t(e,n){var r,i,o,a,s,u;return _().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=this,i=""===this.path?Ll.extractUrlBase(e):this.path,this.resourcePath=this.resourcePath||i,(o=new ll(this.manager)).setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),t.next=9,o.loadAsync(e,n);case 9:if(a=t.sent,s=JSON.parse(a),void 0!==(u=s.metadata)&&void 0!==u.type&&"geometry"!==u.type.toLowerCase()){t.next=14;break}throw new Error("THREE.ObjectLoader: Can't load "+e);case 14:return t.next=16,r.parseAsync(s);case 16:return t.abrupt("return",t.sent);case 17:case"end":return t.stop()}}),t,this)}))),function(t,e){return i.apply(this,arguments)})},{key:"parse",value:function(t,e){var n=this.parseAnimations(t.animations),r=this.parseShapes(t.shapes),i=this.parseGeometries(t.geometries,r),o=this.parseImages(t.images,(function(){void 0!==e&&e(u)})),a=this.parseTextures(t.textures,o),s=this.parseMaterials(t.materials,a),u=this.parseObject(t.object,i,s,a,n),c=this.parseSkeletons(t.skeletons,u);if(this.bindSkeletons(u,c),void 0!==e){var l=!1;for(var f in o)if(o[f].data instanceof HTMLImageElement){l=!0;break}!1===l&&e(u)}return u}},{key:"parseAsync",value:(r=s(_().mark((function t(e){var n,r,i,o,a,s,u,c;return _().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=this.parseAnimations(e.animations),r=this.parseShapes(e.shapes),i=this.parseGeometries(e.geometries,r),t.next=5,this.parseImagesAsync(e.images);case 5:return o=t.sent,a=this.parseTextures(e.textures,o),s=this.parseMaterials(e.materials,a),u=this.parseObject(e.object,i,s,a,n),c=this.parseSkeletons(e.skeletons,u),this.bindSkeletons(u,c),t.abrupt("return",u);case 12:case"end":return t.stop()}}),t,this)}))),function(t){return r.apply(this,arguments)})},{key:"parseShapes",value:function(t){var e={};if(void 0!==t)for(var n=0,r=t.length;n<r;n++){var i=(new Vu).fromJSON(t[n]);e[i.uuid]=i}return e}},{key:"parseSkeletons",value:function(t,e){var n={},r={};if(e.traverse((function(t){t.isBone&&(r[t.uuid]=t)})),void 0!==t)for(var i=0,o=t.length;i<o;i++){var a=(new vs).fromJSON(t[i],r);n[a.uuid]=a}return n}},{key:"parseGeometries",value:function(t,e){var n={};if(void 0!==t)for(var r=new Il,i=0,o=t.length;i<o;i++){var a=void 0,s=t[i];switch(s.type){case"BufferGeometry":case"InstancedBufferGeometry":a=r.parse(s);break;default:s.type in Pc?a=Pc[s.type].fromJSON(s,e):console.warn('THREE.ObjectLoader: Unsupported geometry type "'.concat(s.type,'"'))}a.uuid=s.uuid,void 0!==s.name&&(a.name=s.name),void 0!==s.userData&&(a.userData=s.userData),n[s.uuid]=a}return n}},{key:"parseMaterials",value:function(t,e){var n={},r={};if(void 0!==t){var i=new Nl;i.setTextures(e);for(var o=0,a=t.length;o<a;o++){var s=t[o];void 0===n[s.uuid]&&(n[s.uuid]=i.parse(s)),r[s.uuid]=n[s.uuid]}}return r}},{key:"parseAnimations",value:function(t){var e={};if(void 0!==t)for(var n=0;n<t.length;n++){var r=t[n],i=nl.parse(r);e[i.uuid]=i}return e}},{key:"parseImages",value:function(t,e){var n,r=this,i={};function o(t){if("string"==typeof t){var e=t;return function(t){return r.manager.itemStart(t),n.load(t,(function(){r.manager.itemEnd(t)}),void 0,(function(){r.manager.itemError(t),r.manager.itemEnd(t)}))}(/^(\/\/)|([a-z]+:(\/\/)?)/i.test(e)?e:r.resourcePath+e)}return t.data?{data:Hn(t.type,t.data),width:t.width,height:t.height}:null}if(void 0!==t&&t.length>0){var a=new ol(e);(n=new fl(a)).setCrossOrigin(this.crossOrigin);for(var s=0,u=t.length;s<u;s++){var c=t[s],l=c.url;if(Array.isArray(l)){for(var f=[],h=0,p=l.length;h<p;h++){var d=o(l[h]);null!==d&&(d instanceof HTMLImageElement?f.push(d):f.push(new ds(d.data,d.width,d.height)))}i[c.uuid]=new or(f)}else{var m=o(c.url);i[c.uuid]=new or(m)}}}return i}},{key:"parseImagesAsync",value:(n=s(_().mark((function t(e){var n,r,i,o,a,u,c,l,f,h,p,d,m,y,v;return _().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a=function(){return a=s(_().mark((function t(e){var r,o;return _().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if("string"!=typeof e){t.next=8;break}return o=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(r=e)?r:n.resourcePath+r,t.next=5,i.loadAsync(o);case 5:return t.abrupt("return",t.sent);case 8:if(!e.data){t.next=12;break}return t.abrupt("return",{data:Hn(e.type,e.data),width:e.width,height:e.height});case 12:return t.abrupt("return",null);case 13:case"end":return t.stop()}}),t)}))),a.apply(this,arguments)},o=function(t){return a.apply(this,arguments)},n=this,r={},!(void 0!==e&&e.length>0)){t.next=33;break}(i=new fl(this.manager)).setCrossOrigin(this.crossOrigin),u=0,c=e.length;case 8:if(!(u<c)){t.next=33;break}if(l=e[u],f=l.url,!Array.isArray(f)){t.next=26;break}h=[],p=0,d=f.length;case 14:if(!(p<d)){t.next=23;break}return m=f[p],t.next=18,o(m);case 18:null!==(y=t.sent)&&(y instanceof HTMLImageElement?h.push(y):h.push(new ds(y.data,y.width,y.height)));case 20:p++,t.next=14;break;case 23:r[l.uuid]=new or(h),t.next=30;break;case 26:return t.next=28,o(l.url);case 28:v=t.sent,r[l.uuid]=new or(v);case 30:u++,t.next=8;break;case 33:return t.abrupt("return",r);case 34:case"end":return t.stop()}}),t,this)}))),function(t){return n.apply(this,arguments)})},{key:"parseTextures",value:function(t,e){function n(t,e){return"number"==typeof t?t:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",t),e[t])}var r={};if(void 0!==t)for(var i=0,o=t.length;i<o;i++){var a=t[i];void 0===a.image&&console.warn('THREE.ObjectLoader: No "image" specified for',a.uuid),void 0===e[a.image]&&console.warn("THREE.ObjectLoader: Undefined image",a.image);var s=e[a.image],u=s.data,c=void 0;Array.isArray(u)?(c=new jo,6===u.length&&(c.needsUpdate=!0)):(c=u&&u.data?new ds:new ur,u&&(c.needsUpdate=!0)),c.source=s,c.uuid=a.uuid,void 0!==a.name&&(c.name=a.name),void 0!==a.mapping&&(c.mapping=n(a.mapping,Ul)),void 0!==a.channel&&(c.channel=a.channel),void 0!==a.offset&&c.offset.fromArray(a.offset),void 0!==a.repeat&&c.repeat.fromArray(a.repeat),void 0!==a.center&&c.center.fromArray(a.center),void 0!==a.rotation&&(c.rotation=a.rotation),void 0!==a.wrap&&(c.wrapS=n(a.wrap[0],Dl),c.wrapT=n(a.wrap[1],Dl)),void 0!==a.format&&(c.format=a.format),void 0!==a.internalFormat&&(c.internalFormat=a.internalFormat),void 0!==a.type&&(c.type=a.type),void 0!==a.colorSpace&&(c.colorSpace=a.colorSpace),void 0!==a.minFilter&&(c.minFilter=n(a.minFilter,Fl)),void 0!==a.magFilter&&(c.magFilter=n(a.magFilter,Fl)),void 0!==a.anisotropy&&(c.anisotropy=a.anisotropy),void 0!==a.flipY&&(c.flipY=a.flipY),void 0!==a.generateMipmaps&&(c.generateMipmaps=a.generateMipmaps),void 0!==a.premultiplyAlpha&&(c.premultiplyAlpha=a.premultiplyAlpha),void 0!==a.unpackAlignment&&(c.unpackAlignment=a.unpackAlignment),void 0!==a.compareFunction&&(c.compareFunction=a.compareFunction),void 0!==a.userData&&(c.userData=a.userData),r[a.uuid]=c}return r}},{key:"parseObject",value:function(t,e,n,r,i){var o,a,s;function u(t){return void 0===e[t]&&console.warn("THREE.ObjectLoader: Undefined geometry",t),e[t]}function c(t){if(void 0!==t){if(Array.isArray(t)){for(var e=[],r=0,i=t.length;r<i;r++){var o=t[r];void 0===n[o]&&console.warn("THREE.ObjectLoader: Undefined material",o),e.push(n[o])}return e}return void 0===n[t]&&console.warn("THREE.ObjectLoader: Undefined material",t),n[t]}}function l(t){return void 0===r[t]&&console.warn("THREE.ObjectLoader: Undefined texture",t),r[t]}switch(t.type){case"Scene":o=new ja,void 0!==t.background&&(Number.isInteger(t.background)?o.background=new Ni(t.background):o.background=l(t.background)),void 0!==t.environment&&(o.environment=l(t.environment)),void 0!==t.fog&&("Fog"===t.fog.type?o.fog=new La(t.fog.color,t.fog.near,t.fog.far):"FogExp2"===t.fog.type&&(o.fog=new Na(t.fog.color,t.fog.density)),""!==t.fog.name&&(o.fog.name=t.fog.name)),void 0!==t.backgroundBlurriness&&(o.backgroundBlurriness=t.backgroundBlurriness),void 0!==t.backgroundIntensity&&(o.backgroundIntensity=t.backgroundIntensity),void 0!==t.backgroundRotation&&o.backgroundRotation.fromArray(t.backgroundRotation),void 0!==t.environmentIntensity&&(o.environmentIntensity=t.environmentIntensity),void 0!==t.environmentRotation&&o.environmentRotation.fromArray(t.environmentRotation);break;case"PerspectiveCamera":o=new Co(t.fov,t.aspect,t.near,t.far),void 0!==t.focus&&(o.focus=t.focus),void 0!==t.zoom&&(o.zoom=t.zoom),void 0!==t.filmGauge&&(o.filmGauge=t.filmGauge),void 0!==t.filmOffset&&(o.filmOffset=t.filmOffset),void 0!==t.view&&(o.view=Object.assign({},t.view));break;case"OrthographicCamera":o=new Aa(t.left,t.right,t.top,t.bottom,t.near,t.far),void 0!==t.zoom&&(o.zoom=t.zoom),void 0!==t.view&&(o.view=Object.assign({},t.view));break;case"AmbientLight":o=new Pl(t.color,t.intensity);break;case"DirectionalLight":o=new Ol(t.color,t.intensity);break;case"PointLight":o=new El(t.color,t.intensity,t.distance,t.decay);break;case"RectAreaLight":o=new Rl(t.color,t.intensity,t.width,t.height);break;case"SpotLight":o=new xl(t.color,t.intensity,t.distance,t.angle,t.penumbra,t.decay);break;case"HemisphereLight":o=new ml(t.color,t.groundColor,t.intensity);break;case"LightProbe":o=(new Cl).fromJSON(t);break;case"SkinnedMesh":a=u(t.geometry),s=c(t.material),o=new hs(a,s),void 0!==t.bindMode&&(o.bindMode=t.bindMode),void 0!==t.bindMatrix&&o.bindMatrix.fromArray(t.bindMatrix),void 0!==t.skeleton&&(o.skeleton=t.skeleton);break;case"Mesh":a=u(t.geometry),s=c(t.material),o=new xo(a,s);break;case"InstancedMesh":a=u(t.geometry),s=c(t.material);var f=t.count,h=t.instanceMatrix,p=t.instanceColor;(o=new Es(a,s,f)).instanceMatrix=new gs(new Float32Array(h.array),16),void 0!==p&&(o.instanceColor=new gs(new Float32Array(p.array),p.itemSize));break;case"BatchedMesh":a=u(t.geometry),s=c(t.material),(o=new Gs(t.maxGeometryCount,t.maxVertexCount,t.maxIndexCount,s)).geometry=a,o.perObjectFrustumCulled=t.perObjectFrustumCulled,o.sortObjects=t.sortObjects,o._drawRanges=t.drawRanges,o._reservedRanges=t.reservedRanges,o._visibility=t.visibility,o._active=t.active,o._bounds=t.bounds.map((function(t){var e=new vr;e.min.fromArray(t.boxMin),e.max.fromArray(t.boxMax);var n=new jr;return n.radius=t.sphereRadius,n.center.fromArray(t.sphereCenter),{boxInitialized:t.boxInitialized,box:e,sphereInitialized:t.sphereInitialized,sphere:n}})),o._maxGeometryCount=t.maxGeometryCount,o._maxVertexCount=t.maxVertexCount,o._maxIndexCount=t.maxIndexCount,o._geometryInitialized=t.geometryInitialized,o._geometryCount=t.geometryCount,o._matricesTexture=l(t.matricesTexture.uuid);break;case"LOD":o=new ns;break;case"Line":o=new Zs(u(t.geometry),c(t.material));break;case"LineLoop":o=new tu(u(t.geometry),c(t.material));break;case"LineSegments":o=new $s(u(t.geometry),c(t.material));break;case"PointCloud":case"Points":o=new au(u(t.geometry),c(t.material));break;case"Sprite":o=new Qa(c(t.material));break;case"Group":o=new Ca;break;case"Bone":o=new ps;break;default:o=new vi}if(o.uuid=t.uuid,void 0!==t.name&&(o.name=t.name),void 0!==t.matrix?(o.matrix.fromArray(t.matrix),void 0!==t.matrixAutoUpdate&&(o.matrixAutoUpdate=t.matrixAutoUpdate),o.matrixAutoUpdate&&o.matrix.decompose(o.position,o.quaternion,o.scale)):(void 0!==t.position&&o.position.fromArray(t.position),void 0!==t.rotation&&o.rotation.fromArray(t.rotation),void 0!==t.quaternion&&o.quaternion.fromArray(t.quaternion),void 0!==t.scale&&o.scale.fromArray(t.scale)),void 0!==t.up&&o.up.fromArray(t.up),void 0!==t.castShadow&&(o.castShadow=t.castShadow),void 0!==t.receiveShadow&&(o.receiveShadow=t.receiveShadow),t.shadow&&(void 0!==t.shadow.bias&&(o.shadow.bias=t.shadow.bias),void 0!==t.shadow.normalBias&&(o.shadow.normalBias=t.shadow.normalBias),void 0!==t.shadow.radius&&(o.shadow.radius=t.shadow.radius),void 0!==t.shadow.mapSize&&o.shadow.mapSize.fromArray(t.shadow.mapSize),void 0!==t.shadow.camera&&(o.shadow.camera=this.parseObject(t.shadow.camera))),void 0!==t.visible&&(o.visible=t.visible),void 0!==t.frustumCulled&&(o.frustumCulled=t.frustumCulled),void 0!==t.renderOrder&&(o.renderOrder=t.renderOrder),void 0!==t.userData&&(o.userData=t.userData),void 0!==t.layers&&(o.layers.mask=t.layers),void 0!==t.children)for(var d=t.children,m=0;m<d.length;m++)o.add(this.parseObject(d[m],e,n,r,i));if(void 0!==t.animations)for(var y=t.animations,v=0;v<y.length;v++){var g=y[v];o.animations.push(i[g])}if("LOD"===t.type){void 0!==t.autoUpdate&&(o.autoUpdate=t.autoUpdate);for(var b=t.levels,_=0;_<b.length;_++){var x=b[_],w=o.getObjectByProperty("uuid",x.object);void 0!==w&&o.addLevel(w,x.distance,x.hysteresis)}}return o}},{key:"bindSkeletons",value:function(t,e){0!==Object.keys(e).length&&t.traverse((function(t){if(!0===t.isSkinnedMesh&&void 0!==t.skeleton){var n=e[t.skeleton];void 0===n?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",t.skeleton):t.bind(n,t.bindMatrix)}}))}}]);var n,r,i}(sl),Ul={UVMapping:300,CubeReflectionMapping:_t,CubeRefractionMapping:xt,EquirectangularReflectionMapping:wt,EquirectangularRefractionMapping:St,CubeUVReflectionMapping:Tt},Dl={RepeatWrapping:Mt,ClampToEdgeWrapping:Et,MirroredRepeatWrapping:At},Fl={NearestFilter:Ot,NearestMipmapNearestFilter:Pt,NearestMipmapLinearFilter:Rt,LinearFilter:kt,LinearMipmapNearestFilter:Ct,LinearMipmapLinearFilter:Nt},zl=function(){return T((function t(e,n,r){var i,o,a;switch(w(this,t),this.binding=e,this.valueSize=r,n){case"quaternion":i=this._slerp,o=this._slerpAdditive,a=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*r),this._workIndex=5;break;case"string":case"bool":i=this._select,o=this._select,a=this._setAdditiveIdentityOther,this.buffer=new Array(5*r);break;default:i=this._lerp,o=this._lerpAdditive,a=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*r)}this._mixBufferRegion=i,this._mixBufferRegionAdditive=o,this._setIdentity=a,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}),[{key:"accumulate",value:function(t,e){var n=this.buffer,r=this.valueSize,i=t*r+r,o=this.cumulativeWeight;if(0===o){for(var a=0;a!==r;++a)n[i+a]=n[a];o=e}else{var s=e/(o+=e);this._mixBufferRegion(n,i,0,s,r)}this.cumulativeWeight=o}},{key:"accumulateAdditive",value:function(t){var e=this.buffer,n=this.valueSize,r=n*this._addIndex;0===this.cumulativeWeightAdditive&&this._setIdentity(),this._mixBufferRegionAdditive(e,r,0,t,n),this.cumulativeWeightAdditive+=t}},{key:"apply",value:function(t){var e=this.valueSize,n=this.buffer,r=t*e+e,i=this.cumulativeWeight,o=this.cumulativeWeightAdditive,a=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,i<1){var s=e*this._origIndex;this._mixBufferRegion(n,r,s,1-i,e)}o>0&&this._mixBufferRegionAdditive(n,r,this._addIndex*e,1,e);for(var u=e,c=e+e;u!==c;++u)if(n[u]!==n[u+e]){a.setValue(n,r);break}}},{key:"saveOriginalState",value:function(){var t=this.binding,e=this.buffer,n=this.valueSize,r=n*this._origIndex;t.getValue(e,r);for(var i=n,o=r;i!==o;++i)e[i]=e[r+i%n];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}},{key:"restoreOriginalState",value:function(){var t=3*this.valueSize;this.binding.setValue(this.buffer,t)}},{key:"_setAdditiveIdentityNumeric",value:function(){for(var t=this._addIndex*this.valueSize,e=t+this.valueSize,n=t;n<e;n++)this.buffer[n]=0}},{key:"_setAdditiveIdentityQuaternion",value:function(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}},{key:"_setAdditiveIdentityOther",value:function(){for(var t=this._origIndex*this.valueSize,e=this._addIndex*this.valueSize,n=0;n<this.valueSize;n++)this.buffer[e+n]=this.buffer[t+n]}},{key:"_select",value:function(t,e,n,r,i){if(r>=.5)for(var o=0;o!==i;++o)t[e+o]=t[n+o]}},{key:"_slerp",value:function(t,e,n,r){pr.slerpFlat(t,e,t,e,t,n,r)}},{key:"_slerpAdditive",value:function(t,e,n,r,i){var o=this._workIndex*i;pr.multiplyQuaternionsFlat(t,o,t,e,t,n),pr.slerpFlat(t,e,t,e,t,o,r)}},{key:"_lerp",value:function(t,e,n,r,i){for(var o=1-r,a=0;a!==i;++a){var s=e+a;t[s]=t[s]*o+t[n+a]*r}}},{key:"_lerpAdditive",value:function(t,e,n,r,i){for(var o=0;o!==i;++o){var a=e+o;t[a]=t[a]+t[n+o]*r}}}])}(),Vl="\\[\\]\\.:\\/",Gl=new RegExp("["+Vl+"]","g"),Hl="[^"+Vl+"]",Wl="[^"+Vl.replace("\\.","")+"]",ql=new RegExp("^"+/((?:WC+[\/:])*)/.source.replace("WC",Hl)+/(WCOD+)?/.source.replace("WCOD",Wl)+/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",Hl)+/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",Hl)+"$"),Xl=["material","materials","bones","map"],Yl=function(){return T((function t(e,n,r){w(this,t);var i=r||Jl.parseTrackName(n);this._targetGroup=e,this._bindings=e.subscribe_(n,i)}),[{key:"getValue",value:function(t,e){this.bind();var n=this._targetGroup.nCachedObjects_,r=this._bindings[n];void 0!==r&&r.getValue(t,e)}},{key:"setValue",value:function(t,e){for(var n=this._bindings,r=this._targetGroup.nCachedObjects_,i=n.length;r!==i;++r)n[r].setValue(t,e)}},{key:"bind",value:function(){for(var t=this._bindings,e=this._targetGroup.nCachedObjects_,n=t.length;e!==n;++e)t[e].bind()}},{key:"unbind",value:function(){for(var t=this._bindings,e=this._targetGroup.nCachedObjects_,n=t.length;e!==n;++e)t[e].unbind()}}])}(),Jl=function(){function t(e,n,r){w(this,t),this.path=n,this.parsedPath=r||t.parseTrackName(n),this.node=t.findNode(e,this.parsedPath.nodeName),this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}return T(t,[{key:"_getValue_unavailable",value:function(){}},{key:"_setValue_unavailable",value:function(){}},{key:"_getValue_direct",value:function(t,e){t[e]=this.targetObject[this.propertyName]}},{key:"_getValue_array",value:function(t,e){for(var n=this.resolvedProperty,r=0,i=n.length;r!==i;++r)t[e++]=n[r]}},{key:"_getValue_arrayElement",value:function(t,e){t[e]=this.resolvedProperty[this.propertyIndex]}},{key:"_getValue_toArray",value:function(t,e){this.resolvedProperty.toArray(t,e)}},{key:"_setValue_direct",value:function(t,e){this.targetObject[this.propertyName]=t[e]}},{key:"_setValue_direct_setNeedsUpdate",value:function(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.needsUpdate=!0}},{key:"_setValue_direct_setMatrixWorldNeedsUpdate",value:function(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}},{key:"_setValue_array",value:function(t,e){for(var n=this.resolvedProperty,r=0,i=n.length;r!==i;++r)n[r]=t[e++]}},{key:"_setValue_array_setNeedsUpdate",value:function(t,e){for(var n=this.resolvedProperty,r=0,i=n.length;r!==i;++r)n[r]=t[e++];this.targetObject.needsUpdate=!0}},{key:"_setValue_array_setMatrixWorldNeedsUpdate",value:function(t,e){for(var n=this.resolvedProperty,r=0,i=n.length;r!==i;++r)n[r]=t[e++];this.targetObject.matrixWorldNeedsUpdate=!0}},{key:"_setValue_arrayElement",value:function(t,e){this.resolvedProperty[this.propertyIndex]=t[e]}},{key:"_setValue_arrayElement_setNeedsUpdate",value:function(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.needsUpdate=!0}},{key:"_setValue_arrayElement_setMatrixWorldNeedsUpdate",value:function(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}},{key:"_setValue_fromArray",value:function(t,e){this.resolvedProperty.fromArray(t,e)}},{key:"_setValue_fromArray_setNeedsUpdate",value:function(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.needsUpdate=!0}},{key:"_setValue_fromArray_setMatrixWorldNeedsUpdate",value:function(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.matrixWorldNeedsUpdate=!0}},{key:"_getValue_unbound",value:function(t,e){this.bind(),this.getValue(t,e)}},{key:"_setValue_unbound",value:function(t,e){this.bind(),this.setValue(t,e)}},{key:"bind",value:function(){var e=this.node,n=this.parsedPath,r=n.objectName,i=n.propertyName,o=n.propertyIndex;if(e||(e=t.findNode(this.rootNode,n.nodeName),this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,e){if(r){var a=n.objectIndex;switch(r){case"materials":if(!e.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);e=e.material.materials;break;case"bones":if(!e.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);e=e.skeleton.bones;for(var s=0;s<e.length;s++)if(e[s].name===a){a=s;break}break;case"map":if("map"in e){e=e.map;break}if(!e.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.map)return void console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);e=e.material.map;break;default:if(void 0===e[r])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);e=e[r]}if(void 0!==a){if(void 0===e[a])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);e=e[a]}}var u=e[i];if(void 0!==u){var c=this.Versioning.None;this.targetObject=e,void 0!==e.needsUpdate?c=this.Versioning.NeedsUpdate:void 0!==e.matrixWorldNeedsUpdate&&(c=this.Versioning.MatrixWorldNeedsUpdate);var l=this.BindingType.Direct;if(void 0!==o){if("morphTargetInfluences"===i){if(!e.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!e.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==e.morphTargetDictionary[o]&&(o=e.morphTargetDictionary[o])}l=this.BindingType.ArrayElement,this.resolvedProperty=u,this.propertyIndex=o}else void 0!==u.fromArray&&void 0!==u.toArray?(l=this.BindingType.HasFromToArray,this.resolvedProperty=u):Array.isArray(u)?(l=this.BindingType.EntireArray,this.resolvedProperty=u):this.propertyName=i;this.getValue=this.GetterByBindingType[l],this.setValue=this.SetterByBindingTypeAndVersioning[l][c]}else{var f=n.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+f+"."+i+" but it wasn't found.",e)}}else console.warn("THREE.PropertyBinding: No target node found for track: "+this.path+".")}},{key:"unbind",value:function(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}],[{key:"create",value:function(e,n,r){return e&&e.isAnimationObjectGroup?new t.Composite(e,n,r):new t(e,n,r)}},{key:"sanitizeNodeName",value:function(t){return t.replace(/\s/g,"_").replace(Gl,"")}},{key:"parseTrackName",value:function(t){var e=ql.exec(t);if(null===e)throw new Error("PropertyBinding: Cannot parse trackName: "+t);var n={nodeName:e[2],objectName:e[3],objectIndex:e[4],propertyName:e[5],propertyIndex:e[6]},r=n.nodeName&&n.nodeName.lastIndexOf(".");if(void 0!==r&&-1!==r){var i=n.nodeName.substring(r+1);-1!==Xl.indexOf(i)&&(n.nodeName=n.nodeName.substring(0,r),n.objectName=i)}if(null===n.propertyName||0===n.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+t);return n}},{key:"findNode",value:function(t,e){if(void 0===e||""===e||"."===e||-1===e||e===t.name||e===t.uuid)return t;if(t.skeleton){var n=t.skeleton.getBoneByName(e);if(void 0!==n)return n}if(t.children){var r=function t(n){for(var r=0;r<n.length;r++){var i=n[r];if(i.name===e||i.uuid===e)return i;var o=t(i.children);if(o)return o}return null}(t.children);if(r)return r}return null}}])}();Jl.Composite=Yl,Jl.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Jl.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},Jl.prototype.GetterByBindingType=[Jl.prototype._getValue_direct,Jl.prototype._getValue_array,Jl.prototype._getValue_arrayElement,Jl.prototype._getValue_toArray],Jl.prototype.SetterByBindingTypeAndVersioning=[[Jl.prototype._setValue_direct,Jl.prototype._setValue_direct_setNeedsUpdate,Jl.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[Jl.prototype._setValue_array,Jl.prototype._setValue_array_setNeedsUpdate,Jl.prototype._setValue_array_setMatrixWorldNeedsUpdate],[Jl.prototype._setValue_arrayElement,Jl.prototype._setValue_arrayElement_setNeedsUpdate,Jl.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[Jl.prototype._setValue_fromArray,Jl.prototype._setValue_fromArray_setNeedsUpdate,Jl.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];var Zl=function(){return T((function t(e,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:n.blendMode;w(this,t),this._mixer=e,this._clip=n,this._localRoot=r,this.blendMode=i;for(var o=n.tracks,a=o.length,s=new Array(a),u={endingStart:Ue,endingEnd:Ue},c=0;c!==a;++c){var l=o[c].createInterpolant(null);s[c]=l,l.settings=u}this._interpolantSettings=u,this._interpolants=s,this._propertyBindings=new Array(a),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=2201,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}),[{key:"play",value:function(){return this._mixer._activateAction(this),this}},{key:"stop",value:function(){return this._mixer._deactivateAction(this),this.reset()}},{key:"reset",value:function(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}},{key:"isRunning",value:function(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)}},{key:"isScheduled",value:function(){return this._mixer._isActiveAction(this)}},{key:"startAt",value:function(t){return this._startTime=t,this}},{key:"setLoop",value:function(t,e){return this.loop=t,this.repetitions=e,this}},{key:"setEffectiveWeight",value:function(t){return this.weight=t,this._effectiveWeight=this.enabled?t:0,this.stopFading()}},{key:"getEffectiveWeight",value:function(){return this._effectiveWeight}},{key:"fadeIn",value:function(t){return this._scheduleFading(t,0,1)}},{key:"fadeOut",value:function(t){return this._scheduleFading(t,1,0)}},{key:"crossFadeFrom",value:function(t,e,n){if(t.fadeOut(e),this.fadeIn(e),n){var r=this._clip.duration,i=t._clip.duration,o=i/r,a=r/i;t.warp(1,o,e),this.warp(a,1,e)}return this}},{key:"crossFadeTo",value:function(t,e,n){return t.crossFadeFrom(this,e,n)}},{key:"stopFading",value:function(){var t=this._weightInterpolant;return null!==t&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this}},{key:"setEffectiveTimeScale",value:function(t){return this.timeScale=t,this._effectiveTimeScale=this.paused?0:t,this.stopWarping()}},{key:"getEffectiveTimeScale",value:function(){return this._effectiveTimeScale}},{key:"setDuration",value:function(t){return this.timeScale=this._clip.duration/t,this.stopWarping()}},{key:"syncWith",value:function(t){return this.time=t.time,this.timeScale=t.timeScale,this.stopWarping()}},{key:"halt",value:function(t){return this.warp(this._effectiveTimeScale,0,t)}},{key:"warp",value:function(t,e,n){var r=this._mixer,i=r.time,o=this.timeScale,a=this._timeScaleInterpolant;null===a&&(a=r._lendControlInterpolant(),this._timeScaleInterpolant=a);var s=a.parameterPositions,u=a.sampleValues;return s[0]=i,s[1]=i+n,u[0]=t/o,u[1]=e/o,this}},{key:"stopWarping",value:function(){var t=this._timeScaleInterpolant;return null!==t&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this}},{key:"getMixer",value:function(){return this._mixer}},{key:"getClip",value:function(){return this._clip}},{key:"getRoot",value:function(){return this._localRoot||this._mixer._root}},{key:"_update",value:function(t,e,n,r){if(this.enabled){var i=this._startTime;if(null!==i){var o=(t-i)*n;o<0||0===n?e=0:(this._startTime=null,e=n*o)}e*=this._updateTimeScale(t);var a=this._updateTime(e),s=this._updateWeight(t);if(s>0){var u=this._interpolants,c=this._propertyBindings;if(2501===this.blendMode)for(var l=0,f=u.length;l!==f;++l)u[l].evaluate(a),c[l].accumulateAdditive(s);else for(var h=0,p=u.length;h!==p;++h)u[h].evaluate(a),c[h].accumulate(r,s)}}else this._updateWeight(t)}},{key:"_updateWeight",value:function(t){var e=0;if(this.enabled){e=this.weight;var n=this._weightInterpolant;if(null!==n){var r=n.evaluate(t)[0];e*=r,t>n.parameterPositions[1]&&(this.stopFading(),0===r&&(this.enabled=!1))}}return this._effectiveWeight=e,e}},{key:"_updateTimeScale",value:function(t){var e=0;if(!this.paused){e=this.timeScale;var n=this._timeScaleInterpolant;null!==n&&(e*=n.evaluate(t)[0],t>n.parameterPositions[1]&&(this.stopWarping(),0===e?this.paused=!0:this.timeScale=e))}return this._effectiveTimeScale=e,e}},{key:"_updateTime",value:function(t){var e=this._clip.duration,n=this.loop,r=this.time+t,i=this._loopCount,o=2202===n;if(0===t)return-1===i||!o||1&~i?r:e-r;if(2200===n){-1===i&&(this._loopCount=0,this._setEndings(!0,!0,!1));t:{if(r>=e)r=e;else{if(!(r<0)){this.time=r;break t}r=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:t<0?-1:1})}}else{if(-1===i&&(t>=0?(i=0,this._setEndings(!0,0===this.repetitions,o)):this._setEndings(0===this.repetitions,!0,o)),r>=e||r<0){var a=Math.floor(r/e);r-=e*a,i+=Math.abs(a);var s=this.repetitions-i;if(s<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,r=t>0?e:0,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:t>0?1:-1});else{if(1===s){var u=t<0;this._setEndings(u,!u,o)}else this._setEndings(!1,!1,o);this._loopCount=i,this.time=r,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:a})}}else this.time=r;if(o&&!(1&~i))return e-r}return r}},{key:"_setEndings",value:function(t,e,n){var r=this._interpolantSettings;n?(r.endingStart=De,r.endingEnd=De):(r.endingStart=t?this.zeroSlopeAtStart?De:Ue:Fe,r.endingEnd=e?this.zeroSlopeAtEnd?De:Ue:Fe)}},{key:"_scheduleFading",value:function(t,e,n){var r=this._mixer,i=r.time,o=this._weightInterpolant;null===o&&(o=r._lendControlInterpolant(),this._weightInterpolant=o);var a=o.parameterPositions,s=o.sampleValues;return a[0]=i,s[0]=e,a[1]=i+t,s[1]=n,this}}])}(),Kl=new Float32Array(1),Ql=function(t){function e(t){var n;return w(this,e),(n=d(this,e))._root=t,n._initMemoryManager(),n._accuIndex=0,n.time=0,n.timeScale=1,n}return v(e,t),T(e,[{key:"_bindAction",value:function(t,e){var n=t._localRoot||this._root,r=t._clip.tracks,i=r.length,o=t._propertyBindings,a=t._interpolants,s=n.uuid,u=this._bindingsByRootAndName,c=u[s];void 0===c&&(c={},u[s]=c);for(var l=0;l!==i;++l){var f=r[l],h=f.name,p=c[h];if(void 0!==p)++p.referenceCount,o[l]=p;else{if(void 0!==(p=o[l])){null===p._cacheIndex&&(++p.referenceCount,this._addInactiveBinding(p,s,h));continue}var d=e&&e._propertyBindings[l].binding.parsedPath;++(p=new zl(Jl.create(n,h,d),f.ValueTypeName,f.getValueSize())).referenceCount,this._addInactiveBinding(p,s,h),o[l]=p}a[l].resultBuffer=p.buffer}}},{key:"_activateAction",value:function(t){if(!this._isActiveAction(t)){if(null===t._cacheIndex){var e=(t._localRoot||this._root).uuid,n=t._clip.uuid,r=this._actionsByClip[n];this._bindAction(t,r&&r.knownActions[0]),this._addInactiveAction(t,n,e)}for(var i=t._propertyBindings,o=0,a=i.length;o!==a;++o){var s=i[o];0==s.useCount++&&(this._lendBinding(s),s.saveOriginalState())}this._lendAction(t)}}},{key:"_deactivateAction",value:function(t){if(this._isActiveAction(t)){for(var e=t._propertyBindings,n=0,r=e.length;n!==r;++n){var i=e[n];0==--i.useCount&&(i.restoreOriginalState(),this._takeBackBinding(i))}this._takeBackAction(t)}}},{key:"_initMemoryManager",value:function(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;var t=this;this.stats={actions:{get total(){return t._actions.length},get inUse(){return t._nActiveActions}},bindings:{get total(){return t._bindings.length},get inUse(){return t._nActiveBindings}},controlInterpolants:{get total(){return t._controlInterpolants.length},get inUse(){return t._nActiveControlInterpolants}}}}},{key:"_isActiveAction",value:function(t){var e=t._cacheIndex;return null!==e&&e<this._nActiveActions}},{key:"_addInactiveAction",value:function(t,e,n){var r=this._actions,i=this._actionsByClip,o=i[e];if(void 0===o)o={knownActions:[t],actionByRoot:{}},t._byClipCacheIndex=0,i[e]=o;else{var a=o.knownActions;t._byClipCacheIndex=a.length,a.push(t)}t._cacheIndex=r.length,r.push(t),o.actionByRoot[n]=t}},{key:"_removeInactiveAction",value:function(t){var e=this._actions,n=e[e.length-1],r=t._cacheIndex;n._cacheIndex=r,e[r]=n,e.pop(),t._cacheIndex=null;var i=t._clip.uuid,o=this._actionsByClip,a=o[i],s=a.knownActions,u=s[s.length-1],c=t._byClipCacheIndex;u._byClipCacheIndex=c,s[c]=u,s.pop(),t._byClipCacheIndex=null,delete a.actionByRoot[(t._localRoot||this._root).uuid],0===s.length&&delete o[i],this._removeInactiveBindingsForAction(t)}},{key:"_removeInactiveBindingsForAction",value:function(t){for(var e=t._propertyBindings,n=0,r=e.length;n!==r;++n){var i=e[n];0==--i.referenceCount&&this._removeInactiveBinding(i)}}},{key:"_lendAction",value:function(t){var e=this._actions,n=t._cacheIndex,r=this._nActiveActions++,i=e[r];t._cacheIndex=r,e[r]=t,i._cacheIndex=n,e[n]=i}},{key:"_takeBackAction",value:function(t){var e=this._actions,n=t._cacheIndex,r=--this._nActiveActions,i=e[r];t._cacheIndex=r,e[r]=t,i._cacheIndex=n,e[n]=i}},{key:"_addInactiveBinding",value:function(t,e,n){var r=this._bindingsByRootAndName,i=this._bindings,o=r[e];void 0===o&&(o={},r[e]=o),o[n]=t,t._cacheIndex=i.length,i.push(t)}},{key:"_removeInactiveBinding",value:function(t){var e=this._bindings,n=t.binding,r=n.rootNode.uuid,i=n.path,o=this._bindingsByRootAndName,a=o[r],s=e[e.length-1],u=t._cacheIndex;s._cacheIndex=u,e[u]=s,e.pop(),delete a[i],0===Object.keys(a).length&&delete o[r]}},{key:"_lendBinding",value:function(t){var e=this._bindings,n=t._cacheIndex,r=this._nActiveBindings++,i=e[r];t._cacheIndex=r,e[r]=t,i._cacheIndex=n,e[n]=i}},{key:"_takeBackBinding",value:function(t){var e=this._bindings,n=t._cacheIndex,r=--this._nActiveBindings,i=e[r];t._cacheIndex=r,e[r]=t,i._cacheIndex=n,e[n]=i}},{key:"_lendControlInterpolant",value:function(){var t=this._controlInterpolants,e=this._nActiveControlInterpolants++,n=t[e];return void 0===n&&((n=new qc(new Float32Array(2),new Float32Array(2),1,Kl)).__cacheIndex=e,t[e]=n),n}},{key:"_takeBackControlInterpolant",value:function(t){var e=this._controlInterpolants,n=t.__cacheIndex,r=--this._nActiveControlInterpolants,i=e[r];t.__cacheIndex=r,e[r]=t,i.__cacheIndex=n,e[n]=i}},{key:"clipAction",value:function(t,e,n){var r=e||this._root,i=r.uuid,o="string"==typeof t?nl.findByName(r,t):t,a=null!==o?o.uuid:t,s=this._actionsByClip[a],u=null;if(void 0===n&&(n=null!==o?o.blendMode:2500),void 0!==s){var c=s.actionByRoot[i];if(void 0!==c&&c.blendMode===n)return c;u=s.knownActions[0],null===o&&(o=u._clip)}if(null===o)return null;var l=new Zl(this,o,e,n);return this._bindAction(l,u),this._addInactiveAction(l,a,i),l}},{key:"existingAction",value:function(t,e){var n=e||this._root,r=n.uuid,i="string"==typeof t?nl.findByName(n,t):t,o=i?i.uuid:t,a=this._actionsByClip[o];return void 0!==a&&a.actionByRoot[r]||null}},{key:"stopAllAction",value:function(){for(var t=this._actions,e=this._nActiveActions-1;e>=0;--e)t[e].stop();return this}},{key:"update",value:function(t){t*=this.timeScale;for(var e=this._actions,n=this._nActiveActions,r=this.time+=t,i=Math.sign(t),o=this._accuIndex^=1,a=0;a!==n;++a)e[a]._update(r,t,i,o);for(var s=this._bindings,u=this._nActiveBindings,c=0;c!==u;++c)s[c].apply(o);return this}},{key:"setTime",value:function(t){this.time=0;for(var e=0;e<this._actions.length;e++)this._actions[e].time=0;return this.update(t)}},{key:"getRoot",value:function(){return this._root}},{key:"uncacheClip",value:function(t){var e=this._actions,n=t.uuid,r=this._actionsByClip,i=r[n];if(void 0!==i){for(var o=i.knownActions,a=0,s=o.length;a!==s;++a){var u=o[a];this._deactivateAction(u);var c=u._cacheIndex,l=e[e.length-1];u._cacheIndex=null,u._byClipCacheIndex=null,l._cacheIndex=c,e[c]=l,e.pop(),this._removeInactiveBindingsForAction(u)}delete r[n]}}},{key:"uncacheRoot",value:function(t){var e=t.uuid,n=this._actionsByClip;for(var r in n){var i=n[r].actionByRoot[e];void 0!==i&&(this._deactivateAction(i),this._removeInactiveAction(i))}var o=this._bindingsByRootAndName[e];if(void 0!==o)for(var a in o){var s=o[a];s.restoreOriginalState(),this._removeInactiveBinding(s)}}},{key:"uncacheAction",value:function(t,e){var n=this.existingAction(t,e);null!==n&&(this._deactivateAction(n),this._removeInactiveAction(n))}}])}(On),$l=function(t){function e(t,n){var r,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return w(this,e),(r=d(this,e,[t,n])).isInstancedInterleavedBuffer=!0,r.meshPerAttribute=i,r}return v(e,t),T(e,[{key:"copy",value:function(t){return l(y(e.prototype),"copy",this).call(this,t),this.meshPerAttribute=t.meshPerAttribute,this}},{key:"clone",value:function(t){var n=l(y(e.prototype),"clone",this).call(this,t);return n.meshPerAttribute=this.meshPerAttribute,n}},{key:"toJSON",value:function(t){var n=l(y(e.prototype),"toJSON",this).call(this,t);return n.isInstancedInterleavedBuffer=!0,n.meshPerAttribute=this.meshPerAttribute,n}}])}(Ia),tf=function(){return T((function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return w(this,t),this.radius=e,this.phi=n,this.theta=r,this}),[{key:"set",value:function(t,e,n){return this.radius=t,this.phi=e,this.theta=n,this}},{key:"copy",value:function(t){return this.radius=t.radius,this.phi=t.phi,this.theta=t.theta,this}},{key:"makeSafe",value:function(){var t=1e-6;return this.phi=Math.max(t,Math.min(Math.PI-t,this.phi)),this}},{key:"setFromVector3",value:function(t){return this.setFromCartesianCoords(t.x,t.y,t.z)}},{key:"setFromCartesianCoords",value:function(t,e,n){return this.radius=Math.sqrt(t*t+e*e+n*n),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(t,n),this.phi=Math.acos(Ln(e/this.radius,-1,1))),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}}])}();"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:E}})),"undefined"!=typeof window&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=E)},1180:(t,e,n)=>{n.r(e),n.d(e,{MMDAnimationHelper:()=>$});var r=n(554);function i(t,e,n){return e=s(e),function(t,e){if(e&&("object"===c(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,o()?Reflect.construct(e,n||[],s(t).constructor):e.apply(t,n))}function o(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(o=function(){return!!t})()}function a(){return a="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=s(t)););return t}(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(arguments.length<3?t:n):i.value}},a.apply(this,arguments)}function s(t){return s=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},s(t)}function u(t,e){return u=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},u(t,e)}function c(t){return c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},c(t)}function l(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function f(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,p(r.key),r)}}function h(t,e,n){return e&&f(t.prototype,e),n&&f(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function p(t){var e=function(t,e){if("object"!=c(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=c(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==c(e)?e:e+""}var d=new r.PTz,m=new r.Pq0,y=new r.Pq0,v=new r.Pq0,g=new r.Pq0,b=new r.Pq0,_=new r.PTz,x=new r.Pq0,w=new r.Pq0,S=new r.Pq0,T=new r.kn4,M=function(){return h((function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];l(this,t),this.mesh=e,this.iks=n,this._valid()}),[{key:"update",value:function(){for(var t=this.iks,e=0,n=t.length;e<n;e++)this.updateOne(t[e]);return this}},{key:"updateOne",value:function(t){var e=this.mesh.skeleton.bones,n=Math,r=e[t.effector],i=e[t.target];m.setFromMatrixPosition(i.matrixWorld);for(var o=t.links,a=void 0!==t.iteration?t.iteration:1,s=0;s<a;s++){for(var u=!1,c=0,l=o.length;c<l;c++){var f=e[o[c].index];if(!1===o[c].enabled)break;var h=o[c].limitation,p=o[c].rotationMin,T=o[c].rotationMax;f.matrixWorld.decompose(b,_,x),_.invert(),v.setFromMatrixPosition(r.matrixWorld),g.subVectors(v,b),g.applyQuaternion(_),g.normalize(),y.subVectors(m,b),y.applyQuaternion(_),y.normalize();var M=y.dot(g);if(M>1?M=1:M<-1&&(M=-1),!((M=n.acos(M))<1e-5)){if(void 0!==t.minAngle&&M<t.minAngle&&(M=t.minAngle),void 0!==t.maxAngle&&M>t.maxAngle&&(M=t.maxAngle),w.crossVectors(g,y),w.normalize(),d.setFromAxisAngle(w,M),f.quaternion.multiply(d),void 0!==h){var E=f.quaternion.w;E>1&&(E=1);var A=n.sqrt(1-E*E);f.quaternion.set(h.x*A,h.y*A,h.z*A,E)}void 0!==p&&f.rotation.setFromVector3(S.setFromEuler(f.rotation).max(p)),void 0!==T&&f.rotation.setFromVector3(S.setFromEuler(f.rotation).min(T)),f.updateMatrixWorld(!0),u=!0}}if(!u)break}return this}},{key:"createHelper",value:function(){return new O(this.mesh,this.iks)}},{key:"_valid",value:function(){for(var t=this.iks,e=this.mesh.skeleton.bones,n=0,r=t.length;n<r;n++){var i=t[n],o=e[i.effector],a=i.links,s=void 0,u=void 0;s=o;for(var c=0,l=a.length;c<l;c++)u=e[a[c].index],s.parent!==u&&console.warn("THREE.CCDIKSolver: bone "+s.name+" is not the child of bone "+u.name),s=u}}}])}();function E(t,e){return S.setFromMatrixPosition(t.matrixWorld).applyMatrix4(e)}function A(t,e,n,r){var i=E(n,r);t[3*e+0]=i.x,t[3*e+1]=i.y,t[3*e+2]=i.z}var O=function(t){function e(t){var n,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.25;return l(this,e),(n=i(this,e)).root=t,n.iks=o,n.matrix.copy(t.matrixWorld),n.matrixAutoUpdate=!1,n.sphereGeometry=new r.Gu$(a,16,8),n.targetSphereMaterial=new r.V9B({color:new r.Q1f(16746632),depthTest:!1,depthWrite:!1,transparent:!0}),n.effectorSphereMaterial=new r.V9B({color:new r.Q1f(8978312),depthTest:!1,depthWrite:!1,transparent:!0}),n.linkSphereMaterial=new r.V9B({color:new r.Q1f(8947967),depthTest:!1,depthWrite:!1,transparent:!0}),n.lineMaterial=new r.mrM({color:new r.Q1f(16711680),depthTest:!1,depthWrite:!1,transparent:!0}),n._init(),n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&u(t,e)}(e,t),h(e,[{key:"updateMatrixWorld",value:function(t){var n=this.root;if(this.visible){var r=0,i=this.iks,o=n.skeleton.bones;T.copy(n.matrixWorld).invert();for(var u=0,c=i.length;u<c;u++){var l=i[u],f=o[l.target],h=o[l.effector],p=this.children[r++],d=this.children[r++];p.position.copy(E(f,T)),d.position.copy(E(h,T));for(var m=0,y=l.links.length;m<y;m++){var v=o[l.links[m].index];this.children[r++].position.copy(E(v,T))}var g=this.children[r++],b=g.geometry.attributes.position.array;A(b,0,f,T),A(b,1,h,T);for(var _=0,x=l.links.length;_<x;_++)A(b,_+2,o[l.links[_].index],T);g.geometry.attributes.position.needsUpdate=!0}}this.matrix.copy(n.matrixWorld),a(s(e.prototype),"updateMatrixWorld",this).call(this,t)}},{key:"dispose",value:function(){this.sphereGeometry.dispose(),this.targetSphereMaterial.dispose(),this.effectorSphereMaterial.dispose(),this.linkSphereMaterial.dispose(),this.lineMaterial.dispose();for(var t=this.children,e=0;e<t.length;e++){var n=t[e];n.isLine&&n.geometry.dispose()}}},{key:"_init",value:function(){var t=this,e=this.iks;function n(e){return new r.N1A(function(t){var e=new r.LoY,n=new Float32Array(3*(2+t.links.length));return e.setAttribute("position",new r.THS(n,3)),e}(e),t.lineMaterial)}for(var i=0,o=e.length;i<o;i++){var a=e[i];this.add(new r.eaF(t.sphereGeometry,t.targetSphereMaterial)),this.add(new r.eaF(t.sphereGeometry,t.effectorSphereMaterial));for(var s=0,u=a.links.length;s<u;s++)this.add(new r.eaF(t.sphereGeometry,t.linkSphereMaterial));this.add(n(a))}}}])}(r.B69);function P(t,e,n){return e=C(e),function(t,e){if(e&&("object"===L(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,R()?Reflect.construct(e,n||[],C(t).constructor):e.apply(t,n))}function R(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(R=function(){return!!t})()}function k(){return k="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=C(t)););return t}(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(arguments.length<3?t:n):i.value}},k.apply(this,arguments)}function C(t){return C=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},C(t)}function N(t,e){return N=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},N(t,e)}function L(t){return L="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},L(t)}function j(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function I(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,U(r.key),r)}}function B(t,e,n){return e&&I(t.prototype,e),n&&I(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function U(t){var e=function(t,e){if("object"!=L(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=L(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==L(e)?e:e+""}var D=function(){return B((function t(e,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if(j(this,t),"undefined"==typeof Ammo)throw new Error("THREE.MMDPhysics: Import ammo.js https://github.com/kripken/ammo.js");this.manager=new F,this.mesh=e,this.unitStep=void 0!==o.unitStep?o.unitStep:1/65,this.maxStepNum=void 0!==o.maxStepNum?o.maxStepNum:3,this.gravity=new r.Pq0(0,-98,0),void 0!==o.gravity&&this.gravity.copy(o.gravity),this.world=void 0!==o.world?o.world:null,this.bodies=[],this.constraints=[],this._init(e,n,i)}),[{key:"update",value:function(t){var e,n=this.manager,r=this.mesh,i=!1,o=n.allocThreeVector3(),a=n.allocThreeQuaternion(),s=n.allocThreeVector3();return r.matrixWorld.decompose(o,a,s),1===s.x&&1===s.y&&1===s.z||(i=!0),i&&(null!==(e=r.parent)&&(r.parent=null),s.copy(this.mesh.scale),r.scale.set(1,1,1),r.updateMatrixWorld(!0)),this._updateRigidBodies(),this._stepSimulation(t),this._updateBones(),i&&(null!==e&&(r.parent=e),r.scale.copy(s)),n.freeThreeVector3(s),n.freeThreeQuaternion(a),n.freeThreeVector3(o),this}},{key:"reset",value:function(){for(var t=0,e=this.bodies.length;t<e;t++)this.bodies[t].reset();return this}},{key:"warmup",value:function(t){for(var e=0;e<t;e++)this.update(1/60);return this}},{key:"setGravity",value:function(t){return this.world.setGravity(new Ammo.btVector3(t.x,t.y,t.z)),this.gravity.copy(t),this}},{key:"createHelper",value:function(){return new X(this.mesh,this)}},{key:"_init",value:function(t,e,n){var r=this.manager,i=t.parent;null!==i&&(t.parent=null);var o=r.allocThreeVector3(),a=r.allocThreeQuaternion(),s=r.allocThreeVector3();o.copy(t.position),a.copy(t.quaternion),s.copy(t.scale),t.position.set(0,0,0),t.quaternion.set(0,0,0,1),t.scale.set(1,1,1),t.updateMatrixWorld(!0),null===this.world&&(this.world=this._createWorld(),this.setGravity(this.gravity)),this._initRigidBodies(e),this._initConstraints(n),null!==i&&(t.parent=i),t.position.copy(o),t.quaternion.copy(a),t.scale.copy(s),t.updateMatrixWorld(!0),this.reset(),r.freeThreeVector3(o),r.freeThreeQuaternion(a),r.freeThreeVector3(s)}},{key:"_createWorld",value:function(){var t=new Ammo.btDefaultCollisionConfiguration,e=new Ammo.btCollisionDispatcher(t),n=new Ammo.btDbvtBroadphase,r=new Ammo.btSequentialImpulseConstraintSolver;return new Ammo.btDiscreteDynamicsWorld(e,n,r,t)}},{key:"_initRigidBodies",value:function(t){for(var e=0,n=t.length;e<n;e++)this.bodies.push(new z(this.mesh,this.world,t[e],this.manager))}},{key:"_initConstraints",value:function(t){for(var e=0,n=t.length;e<n;e++){var r=t[e],i=this.bodies[r.rigidBodyIndex1],o=this.bodies[r.rigidBodyIndex2];this.constraints.push(new V(this.mesh,this.world,i,o,r,this.manager))}}},{key:"_stepSimulation",value:function(t){var e=this.unitStep,n=t,r=1+(t/e|0);n<e&&(n=e,r=1),r>this.maxStepNum&&(r=this.maxStepNum),this.world.stepSimulation(n,r,e)}},{key:"_updateRigidBodies",value:function(){for(var t=0,e=this.bodies.length;t<e;t++)this.bodies[t].updateFromBone()}},{key:"_updateBones",value:function(){for(var t=0,e=this.bodies.length;t<e;t++)this.bodies[t].updateBone()}}])}(),F=function(){return B((function t(){j(this,t),this.threeVector3s=[],this.threeMatrix4s=[],this.threeQuaternions=[],this.threeEulers=[],this.transforms=[],this.quaternions=[],this.vector3s=[]}),[{key:"allocThreeVector3",value:function(){return this.threeVector3s.length>0?this.threeVector3s.pop():new r.Pq0}},{key:"freeThreeVector3",value:function(t){this.threeVector3s.push(t)}},{key:"allocThreeMatrix4",value:function(){return this.threeMatrix4s.length>0?this.threeMatrix4s.pop():new r.kn4}},{key:"freeThreeMatrix4",value:function(t){this.threeMatrix4s.push(t)}},{key:"allocThreeQuaternion",value:function(){return this.threeQuaternions.length>0?this.threeQuaternions.pop():new r.PTz}},{key:"freeThreeQuaternion",value:function(t){this.threeQuaternions.push(t)}},{key:"allocThreeEuler",value:function(){return this.threeEulers.length>0?this.threeEulers.pop():new r.O9p}},{key:"freeThreeEuler",value:function(t){this.threeEulers.push(t)}},{key:"allocTransform",value:function(){return this.transforms.length>0?this.transforms.pop():new Ammo.btTransform}},{key:"freeTransform",value:function(t){this.transforms.push(t)}},{key:"allocQuaternion",value:function(){return this.quaternions.length>0?this.quaternions.pop():new Ammo.btQuaternion}},{key:"freeQuaternion",value:function(t){this.quaternions.push(t)}},{key:"allocVector3",value:function(){return this.vector3s.length>0?this.vector3s.pop():new Ammo.btVector3}},{key:"freeVector3",value:function(t){this.vector3s.push(t)}},{key:"setIdentity",value:function(t){t.setIdentity()}},{key:"getBasis",value:function(t){var e=this.allocQuaternion();return t.getBasis().getRotation(e),e}},{key:"getBasisAsMatrix3",value:function(t){var e=this.getBasis(t),n=this.quaternionToMatrix3(e);return this.freeQuaternion(e),n}},{key:"getOrigin",value:function(t){return t.getOrigin()}},{key:"setOrigin",value:function(t,e){t.getOrigin().setValue(e.x(),e.y(),e.z())}},{key:"copyOrigin",value:function(t,e){var n=e.getOrigin();this.setOrigin(t,n)}},{key:"setBasis",value:function(t,e){t.setRotation(e)}},{key:"setBasisFromMatrix3",value:function(t,e){var n=this.matrix3ToQuaternion(e);this.setBasis(t,n),this.freeQuaternion(n)}},{key:"setOriginFromArray3",value:function(t,e){t.getOrigin().setValue(e[0],e[1],e[2])}},{key:"setOriginFromThreeVector3",value:function(t,e){t.getOrigin().setValue(e.x,e.y,e.z)}},{key:"setBasisFromArray3",value:function(t,e){var n=this.allocThreeQuaternion(),r=this.allocThreeEuler();r.set(e[0],e[1],e[2]),this.setBasisFromThreeQuaternion(t,n.setFromEuler(r)),this.freeThreeEuler(r),this.freeThreeQuaternion(n)}},{key:"setBasisFromThreeQuaternion",value:function(t,e){var n=this.allocQuaternion();n.setX(e.x),n.setY(e.y),n.setZ(e.z),n.setW(e.w),this.setBasis(t,n),this.freeQuaternion(n)}},{key:"multiplyTransforms",value:function(t,e){var n=this.allocTransform();this.setIdentity(n);var r=this.getBasisAsMatrix3(t),i=this.getBasisAsMatrix3(e),o=this.getOrigin(t),a=this.getOrigin(e),s=this.multiplyMatrix3ByVector3(r,a),u=this.addVector3(s,o);this.setOrigin(n,u);var c=this.multiplyMatrices3(r,i);return this.setBasisFromMatrix3(n,c),this.freeVector3(s),this.freeVector3(u),n}},{key:"inverseTransform",value:function(t){var e=this.allocTransform(),n=this.getBasisAsMatrix3(t),r=this.getOrigin(t),i=this.transposeMatrix3(n),o=this.negativeVector3(r),a=this.multiplyMatrix3ByVector3(i,o);return this.setOrigin(e,a),this.setBasisFromMatrix3(e,i),this.freeVector3(o),this.freeVector3(a),e}},{key:"multiplyMatrices3",value:function(t,e){var n=[],r=this.rowOfMatrix3(t,0),i=this.rowOfMatrix3(t,1),o=this.rowOfMatrix3(t,2),a=this.columnOfMatrix3(e,0),s=this.columnOfMatrix3(e,1),u=this.columnOfMatrix3(e,2);return n[0]=this.dotVectors3(r,a),n[1]=this.dotVectors3(r,s),n[2]=this.dotVectors3(r,u),n[3]=this.dotVectors3(i,a),n[4]=this.dotVectors3(i,s),n[5]=this.dotVectors3(i,u),n[6]=this.dotVectors3(o,a),n[7]=this.dotVectors3(o,s),n[8]=this.dotVectors3(o,u),this.freeVector3(r),this.freeVector3(i),this.freeVector3(o),this.freeVector3(a),this.freeVector3(s),this.freeVector3(u),n}},{key:"addVector3",value:function(t,e){var n=this.allocVector3();return n.setValue(t.x()+e.x(),t.y()+e.y(),t.z()+e.z()),n}},{key:"dotVectors3",value:function(t,e){return t.x()*e.x()+t.y()*e.y()+t.z()*e.z()}},{key:"rowOfMatrix3",value:function(t,e){var n=this.allocVector3();return n.setValue(t[3*e+0],t[3*e+1],t[3*e+2]),n}},{key:"columnOfMatrix3",value:function(t,e){var n=this.allocVector3();return n.setValue(t[e+0],t[e+3],t[e+6]),n}},{key:"negativeVector3",value:function(t){var e=this.allocVector3();return e.setValue(-t.x(),-t.y(),-t.z()),e}},{key:"multiplyMatrix3ByVector3",value:function(t,e){var n=this.allocVector3(),r=this.rowOfMatrix3(t,0),i=this.rowOfMatrix3(t,1),o=this.rowOfMatrix3(t,2),a=this.dotVectors3(r,e),s=this.dotVectors3(i,e),u=this.dotVectors3(o,e);return n.setValue(a,s,u),this.freeVector3(r),this.freeVector3(i),this.freeVector3(o),n}},{key:"transposeMatrix3",value:function(t){var e=[];return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],e}},{key:"quaternionToMatrix3",value:function(t){var e=[],n=t.x(),r=t.y(),i=t.z(),o=t.w(),a=n*n,s=r*r,u=i*i,c=n*r,l=r*i,f=i*n,h=n*o,p=r*o,d=i*o;return e[0]=1-2*(s+u),e[1]=2*(c-d),e[2]=2*(f+p),e[3]=2*(c+d),e[4]=1-2*(u+a),e[5]=2*(l-h),e[6]=2*(f-p),e[7]=2*(l+h),e[8]=1-2*(a+s),e}},{key:"matrix3ToQuaternion",value:function(t){var e,n,r,i,o,a=t[0]+t[4]+t[8];a>0?(o=.25*(e=2*Math.sqrt(a+1)),n=(t[7]-t[5])/e,r=(t[2]-t[6])/e,i=(t[3]-t[1])/e):t[0]>t[4]&&t[0]>t[8]?(e=2*Math.sqrt(1+t[0]-t[4]-t[8]),o=(t[7]-t[5])/e,n=.25*e,r=(t[1]+t[3])/e,i=(t[2]+t[6])/e):t[4]>t[8]?(e=2*Math.sqrt(1+t[4]-t[0]-t[8]),o=(t[2]-t[6])/e,n=(t[1]+t[3])/e,r=.25*e,i=(t[5]+t[7])/e):(e=2*Math.sqrt(1+t[8]-t[0]-t[4]),o=(t[3]-t[1])/e,n=(t[2]+t[6])/e,r=(t[5]+t[7])/e,i=.25*e);var s=this.allocQuaternion();return s.setX(n),s.setY(r),s.setZ(i),s.setW(o),s}}])}(),z=function(){return B((function t(e,n,r,i){j(this,t),this.mesh=e,this.world=n,this.params=r,this.manager=i,this.body=null,this.bone=null,this.boneOffsetForm=null,this.boneOffsetFormInverse=null,this._init()}),[{key:"reset",value:function(){return this._setTransformFromBone(),this}},{key:"updateFromBone",value:function(){return-1!==this.params.boneIndex&&0===this.params.type&&this._setTransformFromBone(),this}},{key:"updateBone",value:function(){return 0===this.params.type||-1===this.params.boneIndex||(this._updateBoneRotation(),1===this.params.type&&this._updateBonePosition(),this.bone.updateMatrixWorld(!0),2===this.params.type&&this._setPositionFromBone()),this}},{key:"_init",value:function(){var t=this.manager,e=this.params,n=this.mesh.skeleton.bones,i=-1===e.boneIndex?new r.$Kf:n[e.boneIndex],o=function(t){switch(t.shapeType){case 0:return new Ammo.btSphereShape(t.width);case 1:return new Ammo.btBoxShape(new Ammo.btVector3(t.width,t.height,t.depth));case 2:return new Ammo.btCapsuleShape(t.width,t.height);default:throw new Error("unknown shape type "+t.shapeType)}}(e),a=0===e.type?0:e.weight,s=t.allocVector3();s.setValue(0,0,0),0!==a&&o.calculateLocalInertia(a,s);var u=t.allocTransform();t.setIdentity(u),t.setOriginFromArray3(u,e.position),t.setBasisFromArray3(u,e.rotation);var c=t.allocThreeVector3(),l=t.allocTransform();t.setIdentity(l),t.setOriginFromThreeVector3(l,i.getWorldPosition(c));var f=t.multiplyTransforms(l,u),h=new Ammo.btDefaultMotionState(f),p=new Ammo.btRigidBodyConstructionInfo(a,h,o,s);p.set_m_friction(e.friction),p.set_m_restitution(e.restitution);var d=new Ammo.btRigidBody(p);0===e.type&&(d.setCollisionFlags(2|d.getCollisionFlags()),d.setActivationState(4)),d.setDamping(e.positionDamping,e.rotationDamping),d.setSleepingThresholds(0,0),this.world.addRigidBody(d,1<<e.groupIndex,e.groupTarget),this.body=d,this.bone=i,this.boneOffsetForm=u,this.boneOffsetFormInverse=t.inverseTransform(u),t.freeVector3(s),t.freeTransform(f),t.freeTransform(l),t.freeThreeVector3(c)}},{key:"_getBoneTransform",value:function(){var t=this.manager,e=t.allocThreeVector3(),n=t.allocThreeQuaternion(),r=t.allocThreeVector3();this.bone.matrixWorld.decompose(e,n,r);var i=t.allocTransform();t.setOriginFromThreeVector3(i,e),t.setBasisFromThreeQuaternion(i,n);var o=t.multiplyTransforms(i,this.boneOffsetForm);return t.freeTransform(i),t.freeThreeVector3(r),t.freeThreeQuaternion(n),t.freeThreeVector3(e),o}},{key:"_getWorldTransformForBone",value:function(){var t=this.manager,e=this.body.getCenterOfMassTransform();return t.multiplyTransforms(e,this.boneOffsetFormInverse)}},{key:"_setTransformFromBone",value:function(){var t=this.manager,e=this._getBoneTransform();this.body.setCenterOfMassTransform(e),this.body.getMotionState().setWorldTransform(e),t.freeTransform(e)}},{key:"_setPositionFromBone",value:function(){var t=this.manager,e=this._getBoneTransform(),n=t.allocTransform();this.body.getMotionState().getWorldTransform(n),t.copyOrigin(n,e),this.body.setCenterOfMassTransform(n),this.body.getMotionState().setWorldTransform(n),t.freeTransform(n),t.freeTransform(e)}},{key:"_updateBoneRotation",value:function(){var t=this.manager,e=this._getWorldTransformForBone(),n=t.getBasis(e),r=t.allocThreeQuaternion(),i=t.allocThreeQuaternion(),o=t.allocThreeQuaternion();r.set(n.x(),n.y(),n.z(),n.w()),i.setFromRotationMatrix(this.bone.matrixWorld),i.conjugate(),i.multiply(r),o.setFromRotationMatrix(this.bone.matrix),this.bone.quaternion.copy(i.multiply(o).normalize()),t.freeThreeQuaternion(r),t.freeThreeQuaternion(i),t.freeThreeQuaternion(o),t.freeQuaternion(n),t.freeTransform(e)}},{key:"_updateBonePosition",value:function(){var t=this.manager,e=this._getWorldTransformForBone(),n=t.allocThreeVector3(),r=t.getOrigin(e);n.set(r.x(),r.y(),r.z()),this.bone.parent&&this.bone.parent.worldToLocal(n),this.bone.position.copy(n),t.freeThreeVector3(n),t.freeTransform(e)}}])}(),V=function(){return B((function t(e,n,r,i,o,a){j(this,t),this.mesh=e,this.world=n,this.bodyA=r,this.bodyB=i,this.params=o,this.manager=a,this.constraint=null,this._init()}),[{key:"_init",value:function(){var t=this.manager,e=this.params,n=this.bodyA,r=this.bodyB,i=t.allocTransform();t.setIdentity(i),t.setOriginFromArray3(i,e.position),t.setBasisFromArray3(i,e.rotation);var o=t.allocTransform(),a=t.allocTransform();n.body.getMotionState().getWorldTransform(o),r.body.getMotionState().getWorldTransform(a);var s=t.inverseTransform(o),u=t.inverseTransform(a),c=t.multiplyTransforms(s,i),l=t.multiplyTransforms(u,i),f=new Ammo.btGeneric6DofSpringConstraint(n.body,r.body,c,l,!0),h=t.allocVector3(),p=t.allocVector3(),d=t.allocVector3(),m=t.allocVector3();h.setValue(e.translationLimitation1[0],e.translationLimitation1[1],e.translationLimitation1[2]),p.setValue(e.translationLimitation2[0],e.translationLimitation2[1],e.translationLimitation2[2]),d.setValue(e.rotationLimitation1[0],e.rotationLimitation1[1],e.rotationLimitation1[2]),m.setValue(e.rotationLimitation2[0],e.rotationLimitation2[1],e.rotationLimitation2[2]),f.setLinearLowerLimit(h),f.setLinearUpperLimit(p),f.setAngularLowerLimit(d),f.setAngularUpperLimit(m);for(var y=0;y<3;y++)0!==e.springPosition[y]&&(f.enableSpring(y,!0),f.setStiffness(y,e.springPosition[y]));for(var v=0;v<3;v++)0!==e.springRotation[v]&&(f.enableSpring(v+3,!0),f.setStiffness(v+3,e.springRotation[v]));if(void 0!==f.setParam)for(var g=0;g<6;g++)f.setParam(2,.475,g);this.world.addConstraint(f,!0),this.constraint=f,t.freeTransform(i),t.freeTransform(o),t.freeTransform(a),t.freeTransform(s),t.freeTransform(u),t.freeTransform(c),t.freeTransform(l),t.freeVector3(h),t.freeVector3(p),t.freeVector3(d),t.freeVector3(m)}}])}(),G=new r.Pq0,H=new r.PTz,W=new r.Pq0,q=new r.kn4,X=function(t){function e(t,n){var i;return j(this,e),(i=P(this,e)).root=t,i.physics=n,i.matrix.copy(t.matrixWorld),i.matrixAutoUpdate=!1,i.materials=[],i.materials.push(new r.V9B({color:new r.Q1f(16746632),wireframe:!0,depthTest:!1,depthWrite:!1,opacity:.25,transparent:!0})),i.materials.push(new r.V9B({color:new r.Q1f(8978312),wireframe:!0,depthTest:!1,depthWrite:!1,opacity:.25,transparent:!0})),i.materials.push(new r.V9B({color:new r.Q1f(8947967),wireframe:!0,depthTest:!1,depthWrite:!1,opacity:.25,transparent:!0})),i._init(),i}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&N(t,e)}(e,t),B(e,[{key:"dispose",value:function(){for(var t=this.materials,e=this.children,n=0;n<t.length;n++)t[n].dispose();for(var r=0;r<e.length;r++){var i=e[r];i.isMesh&&i.geometry.dispose()}}},{key:"updateMatrixWorld",value:function(t){var n=this.root;if(this.visible){var r=this.physics.bodies;q.copy(n.matrixWorld).decompose(G,H,W).compose(G,H,W.set(1,1,1)).invert();for(var i=0,o=r.length;i<o;i++){var a=r[i].body,s=this.children[i],u=a.getCenterOfMassTransform(),c=u.getOrigin(),l=u.getRotation();s.position.set(c.x(),c.y(),c.z()).applyMatrix4(q),s.quaternion.setFromRotationMatrix(q).multiply(H.set(l.x(),l.y(),l.z(),l.w()))}}this.matrix.copy(n.matrixWorld).decompose(G,H,W).compose(G,H,W.set(1,1,1)),k(C(e.prototype),"updateMatrixWorld",this).call(this,t)}},{key:"_init",value:function(){var t=this.physics.bodies;function e(t){switch(t.shapeType){case 0:return new r.Gu$(t.width,16,8);case 1:return new r.iNn(2*t.width,2*t.height,2*t.depth,8,8,8);case 2:return new r.qU7(t.width,t.height,8,16);default:return null}}for(var n=0,i=t.length;n<i;n++){var o=t[n].params;this.add(new r.eaF(e(o),this.materials[o.type]))}}}])}(r.B69);function Y(t){return Y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Y(t)}function J(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Z(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Q(r.key),r)}}function K(t,e,n){return e&&Z(t.prototype,e),n&&Z(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function Q(t){var e=function(t,e){if("object"!=Y(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=Y(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Y(e)?e:e+""}var $=function(){return K((function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};J(this,t),this.meshes=[],this.camera=null,this.cameraTarget=new r.B69,this.cameraTarget.name="target",this.audio=null,this.audioManager=null,this.objects=new WeakMap,this.configuration={sync:void 0===e.sync||e.sync,afterglow:void 0!==e.afterglow?e.afterglow:0,resetPhysicsOnLoop:void 0===e.resetPhysicsOnLoop||e.resetPhysicsOnLoop,pmxAnimation:void 0!==e.pmxAnimation&&e.pmxAnimation},this.enabled={animation:!0,ik:!0,grant:!0,physics:!0,cameraAnimation:!0},this.onBeforePhysics=function(){},this.sharedPhysics=!1,this.masterPhysics=null}),[{key:"add",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(t.isSkinnedMesh)this._addMesh(t,e);else if(t.isCamera)this._setupCamera(t,e);else{if("Audio"!==t.type)throw new Error("THREE.MMDAnimationHelper.add: accepts only THREE.SkinnedMesh or THREE.Camera or THREE.Audio instance.");this._setupAudio(t,e)}return this.configuration.sync&&this._syncDuration(),this}},{key:"remove",value:function(t){if(t.isSkinnedMesh)this._removeMesh(t);else if(t.isCamera)this._clearCamera(t);else{if("Audio"!==t.type)throw new Error("THREE.MMDAnimationHelper.remove: accepts only THREE.SkinnedMesh or THREE.Camera or THREE.Audio instance.");this._clearAudio(t)}return this.configuration.sync&&this._syncDuration(),this}},{key:"update",value:function(t){null!==this.audioManager&&this.audioManager.control(t);for(var e=0;e<this.meshes.length;e++)this._animateMesh(this.meshes[e],t);return this.sharedPhysics&&this._updateSharedPhysics(t),null!==this.camera&&this._animateCamera(this.camera,t),this}},{key:"pose",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};!1!==n.resetPose&&t.pose();for(var i=t.skeleton.bones,o=e.bones,a={},s=0,u=i.length;s<u;s++)a[i[s].name]=s;for(var c=new r.Pq0,l=new r.PTz,f=0,h=o.length;f<h;f++){var p=o[f],d=a[p.name];if(void 0!==d){var m=i[d];m.position.add(c.fromArray(p.translation)),m.quaternion.multiply(l.fromArray(p.quaternion))}}if(t.updateMatrixWorld(!0),this.configuration.pmxAnimation&&t.geometry.userData.MMD&&"pmx"===t.geometry.userData.MMD.format){var y=this._sortBoneDataArray(t.geometry.userData.MMD.bones.slice()),v=!1!==n.ik?this._createCCDIKSolver(t):null,g=!1!==n.grant?this.createGrantSolver(t):null;this._animatePMXMesh(t,y,v,g)}else!1!==n.ik&&this._createCCDIKSolver(t).update(),!1!==n.grant&&this.createGrantSolver(t).update();return this}},{key:"enable",value:function(t,e){if(void 0===this.enabled[t])throw new Error("THREE.MMDAnimationHelper.enable: unknown key "+t);if(this.enabled[t]=e,"physics"===t)for(var n=0,r=this.meshes.length;n<r;n++)this._optimizeIK(this.meshes[n],e);return this}},{key:"createGrantSolver",value:function(t){return new at(t,t.geometry.userData.MMD.grants)}},{key:"_addMesh",value:function(t,e){if(this.meshes.indexOf(t)>=0)throw new Error("THREE.MMDAnimationHelper._addMesh: SkinnedMesh '"+t.name+"' has already been added.");return this.meshes.push(t),this.objects.set(t,{looped:!1}),this._setupMeshAnimation(t,e.animation),!1!==e.physics&&this._setupMeshPhysics(t,e),this}},{key:"_setupCamera",value:function(t,e){if(this.camera===t)throw new Error("THREE.MMDAnimationHelper._setupCamera: Camera '"+t.name+"' has already been set.");return this.camera&&this.clearCamera(this.camera),this.camera=t,t.add(this.cameraTarget),this.objects.set(t,{}),void 0!==e.animation&&this._setupCameraAnimation(t,e.animation),this}},{key:"_setupAudio",value:function(t,e){if(this.audio===t)throw new Error("THREE.MMDAnimationHelper._setupAudio: Audio '"+t.name+"' has already been set.");return this.audio&&this.clearAudio(this.audio),this.audio=t,this.audioManager=new it(t,e),this.objects.set(this.audioManager,{duration:this.audioManager.duration}),this}},{key:"_removeMesh",value:function(t){for(var e=!1,n=0,r=0,i=this.meshes.length;r<i;r++)this.meshes[r]!==t?this.meshes[n++]=this.meshes[r]:(this.objects.delete(t),e=!0);if(!e)throw new Error("THREE.MMDAnimationHelper._removeMesh: SkinnedMesh '"+t.name+"' has not been added yet.");return this.meshes.length=n,this}},{key:"_clearCamera",value:function(t){if(t!==this.camera)throw new Error("THREE.MMDAnimationHelper._clearCamera: Camera '"+t.name+"' has not been set yet.");return this.camera.remove(this.cameraTarget),this.objects.delete(this.camera),this.camera=null,this}},{key:"_clearAudio",value:function(t){if(t!==this.audio)throw new Error("THREE.MMDAnimationHelper._clearAudio: Audio '"+t.name+"' has not been set yet.");return this.objects.delete(this.audioManager),this.audio=null,this.audioManager=null,this}},{key:"_setupMeshAnimation",value:function(t,e){var n=this.objects.get(t);if(void 0!==e){var i=Array.isArray(e)?e:[e];n.mixer=new r.Iw4(t);for(var o=0,a=i.length;o<a;o++)n.mixer.clipAction(i[o]).play();n.mixer.addEventListener("loop",(function(t){var e=t.action._clip.tracks;e.length>0&&".bones"!==e[0].name.slice(0,6)||(n.looped=!0)}))}return n.ikSolver=this._createCCDIKSolver(t),n.grantSolver=this.createGrantSolver(t),this}},{key:"_setupCameraAnimation",value:function(t,e){var n=Array.isArray(e)?e:[e],i=this.objects.get(t);i.mixer=new r.Iw4(t);for(var o=0,a=n.length;o<a;o++)i.mixer.clipAction(n[o]).play()}},{key:"_setupMeshPhysics",value:function(t,e){var n=this.objects.get(t);if(void 0===e.world&&this.sharedPhysics){var r=this._getMasterPhysics();null!==r&&(world=r.world)}n.physics=this._createMMDPhysics(t,e),n.mixer&&!1!==e.animationWarmup&&(this._animateMesh(t,0),n.physics.reset()),n.physics.warmup(void 0!==e.warmup?e.warmup:60),this._optimizeIK(t,!0)}},{key:"_animateMesh",value:function(t,e){var n=this.objects.get(t),r=n.mixer,i=n.ikSolver,o=n.grantSolver,a=n.physics,s=n.looped;r&&this.enabled.animation&&(this._restoreBones(t),r.update(e),this._saveBones(t),this.configuration.pmxAnimation&&t.geometry.userData.MMD&&"pmx"===t.geometry.userData.MMD.format?(n.sortedBonesData||(n.sortedBonesData=this._sortBoneDataArray(t.geometry.userData.MMD.bones.slice())),this._animatePMXMesh(t,n.sortedBonesData,i&&this.enabled.ik?i:null,o&&this.enabled.grant?o:null)):(i&&this.enabled.ik&&(t.updateMatrixWorld(!0),i.update()),o&&this.enabled.grant&&o.update())),!0===s&&this.enabled.physics&&(a&&this.configuration.resetPhysicsOnLoop&&a.reset(),n.looped=!1),a&&this.enabled.physics&&!this.sharedPhysics&&(this.onBeforePhysics(t),a.update(e))}},{key:"_sortBoneDataArray",value:function(t){return t.sort((function(t,e){return t.transformationClass!==e.transformationClass?t.transformationClass-e.transformationClass:t.index-e.index}))}},{key:"_animatePMXMesh",value:function(t,e,n,r){et=0,nt.clear();for(var i=0,o=e.length;i<o;i++)rt(t,e[i].index,n,r);return t.updateMatrixWorld(!0),this}},{key:"_animateCamera",value:function(t,e){var n=this.objects.get(t).mixer;n&&this.enabled.cameraAnimation&&(n.update(e),t.updateProjectionMatrix(),t.up.set(0,1,0),t.up.applyQuaternion(t.quaternion),t.lookAt(this.cameraTarget.position))}},{key:"_optimizeIK",value:function(t,e){for(var n=t.geometry.userData.MMD.iks,r=t.geometry.userData.MMD.bones,i=0,o=n.length;i<o;i++)for(var a=n[i].links,s=0,u=a.length;s<u;s++){var c=a[s];c.enabled=!0!==e||!(r[c.index].rigidBodyType>0)}}},{key:"_createCCDIKSolver",value:function(t){if(void 0===M)throw new Error("THREE.MMDAnimationHelper: Import CCDIKSolver.");return new M(t,t.geometry.userData.MMD.iks)}},{key:"_createMMDPhysics",value:function(t,e){if(void 0===D)throw new Error("THREE.MMDPhysics: Import MMDPhysics.");return new D(t,t.geometry.userData.MMD.rigidBodies,t.geometry.userData.MMD.constraints,e)}},{key:"_syncDuration",value:function(){for(var t=0,e=this.objects,n=this.meshes,r=this.camera,i=this.audioManager,o=0,a=n.length;o<a;o++){var s=this.objects.get(n[o]).mixer;if(void 0!==s)for(var u=0;u<s._actions.length;u++){var c=s._actions[u]._clip;e.has(c)||e.set(c,{duration:c.duration}),t=Math.max(t,e.get(c).duration)}}if(null!==r){var l=this.objects.get(r).mixer;if(void 0!==l)for(var f=0,h=l._actions.length;f<h;f++){var p=l._actions[f]._clip;e.has(p)||e.set(p,{duration:p.duration}),t=Math.max(t,e.get(p).duration)}}null!==i&&(t=Math.max(t,e.get(i).duration)),t+=this.configuration.afterglow;for(var d=0,m=this.meshes.length;d<m;d++){var y=this.objects.get(this.meshes[d]).mixer;if(void 0!==y)for(var v=0,g=y._actions.length;v<g;v++)y._actions[v]._clip.duration=t}if(null!==r){var b=this.objects.get(r).mixer;if(void 0!==b)for(var _=0,x=b._actions.length;_<x;_++)b._actions[_]._clip.duration=t}null!==i&&(i.duration=t)}},{key:"_updatePropertyMixersBuffer",value:function(t){for(var e=this.objects.get(t).mixer,n=e._bindings,r=e._accuIndex,i=0,o=n.length;i<o;i++){var a=n[i],s=a.buffer,u=(r+1)*a.valueSize;a.binding.getValue(s,u)}}},{key:"_saveBones",value:function(t){var e=this.objects.get(t),n=t.skeleton.bones,r=e.backupBones;void 0===r&&(r=new Float32Array(7*n.length),e.backupBones=r);for(var i=0,o=n.length;i<o;i++){var a=n[i];a.position.toArray(r,7*i),a.quaternion.toArray(r,7*i+3)}}},{key:"_restoreBones",value:function(t){var e=this.objects.get(t).backupBones;if(void 0!==e)for(var n=t.skeleton.bones,r=0,i=n.length;r<i;r++){var o=n[r];o.position.fromArray(e,7*r),o.quaternion.fromArray(e,7*r+3)}}},{key:"_getMasterPhysics",value:function(){if(null!==this.masterPhysics)return this.masterPhysics;for(var t=0,e=this.meshes.length;t<e;t++){var n=this.meshes[t].physics;if(null!=n)return this.masterPhysics=n,this.masterPhysics}return null}},{key:"_updateSharedPhysics",value:function(t){if(0!==this.meshes.length&&this.enabled.physics&&this.sharedPhysics){var e=this._getMasterPhysics();if(null!==e){for(var n=0,r=this.meshes.length;n<r;n++){var i=this.meshes[n].physics;null!=i&&i.updateRigidBodies()}e.stepSimulation(t);for(var o=0,a=this.meshes.length;o<a;o++){var s=this.meshes[o].physics;null!=s&&s.updateBones()}}}}}])}(),tt=[],et=0,nt=new Map;function rt(t,e,n,i){var o=t.skeleton.bones,a=t.geometry.userData.MMD.bones[e],s=o[e];if(!nt.has(e)){var u=(et>=tt.length&&tt.push(new r.PTz),tt[et++]);if(nt.set(e,u.copy(s.quaternion)),i&&a.grant&&!a.grant.isLocal&&a.grant.affectRotation){var c=a.grant.parentIndex,l=a.grant.ratio;nt.has(c)||rt(t,c,n,i),i.addGrantRotation(s,nt.get(c),l)}if(n&&a.ik){t.updateMatrixWorld(!0),n.updateOne(a.ik);for(var f=a.ik.links,h=0,p=f.length;h<p;h++){var d=f[h];if(!1!==d.enabled){var m=d.index;nt.has(m)&&nt.set(m,nt.get(m).copy(o[m].quaternion))}}}u.copy(s.quaternion)}}var it=function(){return K((function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};J(this,t),this.audio=e,this.elapsedTime=0,this.currentTime=0,this.delayTime=void 0!==n.delayTime?n.delayTime:0,this.audioDuration=this.audio.buffer.duration,this.duration=this.audioDuration+this.delayTime}),[{key:"control",value:function(t){return this.elapsed+=t,this.currentTime+=t,this._shouldStopAudio()&&this.audio.stop(),this._shouldStartAudio()&&this.audio.play(),this}},{key:"_shouldStartAudio",value:function(){if(this.audio.isPlaying)return!1;for(;this.currentTime>=this.duration;)this.currentTime-=this.duration;return!(this.currentTime<this.delayTime||this.currentTime-this.delayTime>this.audioDuration)}},{key:"_shouldStopAudio",value:function(){return this.audio.isPlaying&&this.currentTime>=this.duration}}])}(),ot=new r.PTz,at=function(){return K((function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];J(this,t),this.mesh=e,this.grants=n}),[{key:"update",value:function(){for(var t=this.grants,e=0,n=t.length;e<n;e++)this.updateOne(t[e]);return this}},{key:"updateOne",value:function(t){var e=this.mesh.skeleton.bones,n=e[t.index],r=e[t.parentIndex];return t.isLocal?(t.affectPosition,t.affectRotation):(t.affectPosition,t.affectRotation&&this.addGrantRotation(n,r.quaternion,t.ratio)),this}},{key:"addGrantRotation",value:function(t,e,n){return ot.set(0,0,0,1),ot.slerp(e,n),t.quaternion.multiply(ot),this}}])}()},4323:(t,e,n)=>{n.a(t,(async(t,r)=>{try{function o(t){return o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},o(t)}function a(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function s(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,u(r.key),r)}}function u(t){var e=c(t,"string");return"symbol"==o(e)?e:e+""}function c(t,e){if("object"!=o(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e||"default");if("object"!=o(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}n.d(e,{A:()=>l}),void 0===self.GPUShaderStage&&(self.GPUShaderStage={VERTEX:1,FRAGMENT:2,COMPUTE:4});var i=void 0!==navigator.gpu;"undefined"!=typeof window&&i&&(i=await navigator.gpu.requestAdapter());const l=function(){return t=function t(){a(this,t)},e=[{key:"isAvailable",value:function(){return Boolean(i)}},{key:"getStaticAdapter",value:function(){return i}},{key:"getErrorMessage",value:function(){var t=document.createElement("div");return t.id="webgpumessage",t.style.fontFamily="monospace",t.style.fontSize="13px",t.style.fontWeight="normal",t.style.textAlign="center",t.style.background="#fff",t.style.color="#000",t.style.padding="1.5em",t.style.maxWidth="400px",t.style.margin="5em auto 0",t.innerHTML='Your browser does not support <a href="https://gpuweb.github.io/gpuweb/" style="color:blue">WebGPU</a> yet',t}}],null&&s(t.prototype,null),e&&s(t,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();r()}catch(f){r(f)}}),1)},829:(t,e,n)=>{n.r(e),n.d(e,{OrbitControls:()=>m});var r=n(554);function i(t){return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},i(t)}function o(t,e,n){return e=s(e),function(t,e){if(e&&("object"===i(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,a()?Reflect.construct(e,n||[],s(t).constructor):e.apply(t,n))}function a(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(a=function(){return!!t})()}function s(t){return s=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},s(t)}function u(t,e){return u=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},u(t,e)}var c={type:"change"},l={type:"start"},f={type:"end"},h=new r.RlV,p=new r.Zcv,d=Math.cos(70*r.cj9.DEG2RAD),m=function(t){function e(t,n){var i,a,s,u,m,y,v,g;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(i=o(this,e)).object=t,i.domElement=n,i.domElement.style.touchAction="none",i.enabled=!0,i.target=new r.Pq0,i.cursor=new r.Pq0,i.minDistance=0,i.maxDistance=1/0,i.minZoom=0,i.maxZoom=1/0,i.minTargetRadius=0,i.maxTargetRadius=1/0,i.minPolarAngle=0,i.maxPolarAngle=Math.PI,i.minAzimuthAngle=-1/0,i.maxAzimuthAngle=1/0,i.enableDamping=!1,i.dampingFactor=.05,i.enableZoom=!0,i.zoomSpeed=1,i.enableRotate=!0,i.rotateSpeed=1,i.enablePan=!0,i.panSpeed=1,i.screenSpacePanning=!0,i.keyPanSpeed=7,i.zoomToCursor=!1,i.autoRotate=!1,i.autoRotateSpeed=2,i.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},i.mouseButtons={LEFT:r.kBv.ROTATE,MIDDLE:r.kBv.DOLLY,RIGHT:r.kBv.PAN},i.touches={ONE:r.wtR.ROTATE,TWO:r.wtR.DOLLY_PAN},i.target0=i.target.clone(),i.position0=i.object.position.clone(),i.zoom0=i.object.zoom,i._domElementKeyEvents=null,i.getPolarAngle=function(){return S.phi},i.getAzimuthalAngle=function(){return S.theta},i.getDistance=function(){return this.object.position.distanceTo(this.target)},i.listenToKeyEvents=function(t){t.addEventListener("keydown",pt),this._domElementKeyEvents=t},i.stopListenToKeyEvents=function(){this._domElementKeyEvents.removeEventListener("keydown",pt),this._domElementKeyEvents=null},i.saveState=function(){b.target0.copy(b.target),b.position0.copy(b.object.position),b.zoom0=b.object.zoom},i.reset=function(){b.target.copy(b.target0),b.object.position.copy(b.position0),b.object.zoom=b.zoom0,b.object.updateProjectionMatrix(),b.dispatchEvent(c),b.update(),x=_.NONE},i.update=(a=new r.Pq0,s=(new r.PTz).setFromUnitVectors(t.up,new r.Pq0(0,1,0)),u=s.clone().invert(),m=new r.Pq0,y=new r.PTz,v=new r.Pq0,g=2*Math.PI,function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=b.object.position;a.copy(n).sub(b.target),a.applyQuaternion(s),S.setFromVector3(a),b.autoRotate&&x===_.NONE&&G(function(t){return null!==t?2*Math.PI/60*b.autoRotateSpeed*t:2*Math.PI/60/60*b.autoRotateSpeed}(e)),b.enableDamping?(S.theta+=T.theta*b.dampingFactor,S.phi+=T.phi*b.dampingFactor):(S.theta+=T.theta,S.phi+=T.phi);var i=b.minAzimuthAngle,o=b.maxAzimuthAngle;isFinite(i)&&isFinite(o)&&(i<-Math.PI?i+=g:i>Math.PI&&(i-=g),o<-Math.PI?o+=g:o>Math.PI&&(o-=g),S.theta=i<=o?Math.max(i,Math.min(o,S.theta)):S.theta>(i+o)/2?Math.max(i,S.theta):Math.min(o,S.theta)),S.phi=Math.max(b.minPolarAngle,Math.min(b.maxPolarAngle,S.phi)),S.makeSafe(),!0===b.enableDamping?b.target.addScaledVector(E,b.dampingFactor):b.target.add(E),b.target.sub(b.cursor),b.target.clampLength(b.minTargetRadius,b.maxTargetRadius),b.target.add(b.cursor);var l=!1;if(b.zoomToCursor&&U||b.object.isOrthographicCamera)S.radius=Q(S.radius);else{var f=S.radius;S.radius=Q(S.radius*M),l=f!=S.radius}if(a.setFromSpherical(S),a.applyQuaternion(u),n.copy(b.target).add(a),b.object.lookAt(b.target),!0===b.enableDamping?(T.theta*=1-b.dampingFactor,T.phi*=1-b.dampingFactor,E.multiplyScalar(1-b.dampingFactor)):(T.set(0,0,0),E.set(0,0,0)),b.zoomToCursor&&U){var A=null;if(b.object.isPerspectiveCamera){var O=a.length(),P=O-(A=Q(O*M));b.object.position.addScaledVector(I,P),b.object.updateMatrixWorld(),l=!!P}else if(b.object.isOrthographicCamera){var R=new r.Pq0(B.x,B.y,0);R.unproject(b.object);var k=b.object.zoom;b.object.zoom=Math.max(b.minZoom,Math.min(b.maxZoom,b.object.zoom/M)),b.object.updateProjectionMatrix(),l=k!==b.object.zoom;var C=new r.Pq0(B.x,B.y,0);C.unproject(b.object),b.object.position.sub(C).add(R),b.object.updateMatrixWorld(),A=a.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),b.zoomToCursor=!1;null!==A&&(this.screenSpacePanning?b.target.set(0,0,-1).transformDirection(b.object.matrix).multiplyScalar(A).add(b.object.position):(h.origin.copy(b.object.position),h.direction.set(0,0,-1).transformDirection(b.object.matrix),Math.abs(b.object.up.dot(h.direction))<d?t.lookAt(b.target):(p.setFromNormalAndCoplanarPoint(b.object.up,b.target),h.intersectPlane(p,b.target))))}else if(b.object.isOrthographicCamera){var N=b.object.zoom;b.object.zoom=Math.max(b.minZoom,Math.min(b.maxZoom,b.object.zoom/M)),N!==b.object.zoom&&(b.object.updateProjectionMatrix(),l=!0)}return M=1,U=!1,!!(l||m.distanceToSquared(b.object.position)>w||8*(1-y.dot(b.object.quaternion))>w||v.distanceToSquared(b.target)>w)&&(b.dispatchEvent(c),m.copy(b.object.position),y.copy(b.object.quaternion),v.copy(b.target),!0)}),i.dispose=function(){b.domElement.removeEventListener("contextmenu",mt),b.domElement.removeEventListener("pointerdown",st),b.domElement.removeEventListener("pointercancel",ct),b.domElement.removeEventListener("wheel",lt),b.domElement.removeEventListener("pointermove",ut),b.domElement.removeEventListener("pointerup",ct),b.domElement.getRootNode().removeEventListener("keydown",ft,{capture:!0}),null!==b._domElementKeyEvents&&(b._domElementKeyEvents.removeEventListener("keydown",pt),b._domElementKeyEvents=null)};var b=i,_={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6},x=_.NONE,w=1e-6,S=new r.YHV,T=new r.YHV,M=1,E=new r.Pq0,A=new r.I9Y,O=new r.I9Y,P=new r.I9Y,R=new r.I9Y,k=new r.I9Y,C=new r.I9Y,N=new r.I9Y,L=new r.I9Y,j=new r.I9Y,I=new r.Pq0,B=new r.I9Y,U=!1,D=[],F={},z=!1;function V(t){var e=Math.abs(.01*t);return Math.pow(.95,b.zoomSpeed*e)}function G(t){T.theta-=t}function H(t){T.phi-=t}var W,q=(W=new r.Pq0,function(t,e){W.setFromMatrixColumn(e,0),W.multiplyScalar(-t),E.add(W)}),X=function(){var t=new r.Pq0;return function(e,n){!0===b.screenSpacePanning?t.setFromMatrixColumn(n,1):(t.setFromMatrixColumn(n,0),t.crossVectors(b.object.up,t)),t.multiplyScalar(e),E.add(t)}}(),Y=function(){var t=new r.Pq0;return function(e,n){var r=b.domElement;if(b.object.isPerspectiveCamera){var i=b.object.position;t.copy(i).sub(b.target);var o=t.length();o*=Math.tan(b.object.fov/2*Math.PI/180),q(2*e*o/r.clientHeight,b.object.matrix),X(2*n*o/r.clientHeight,b.object.matrix)}else b.object.isOrthographicCamera?(q(e*(b.object.right-b.object.left)/b.object.zoom/r.clientWidth,b.object.matrix),X(n*(b.object.top-b.object.bottom)/b.object.zoom/r.clientHeight,b.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),b.enablePan=!1)}}();function J(t){b.object.isPerspectiveCamera||b.object.isOrthographicCamera?M/=t:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),b.enableZoom=!1)}function Z(t){b.object.isPerspectiveCamera||b.object.isOrthographicCamera?M*=t:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),b.enableZoom=!1)}function K(t,e){if(b.zoomToCursor){U=!0;var n=b.domElement.getBoundingClientRect(),r=t-n.left,i=e-n.top,o=n.width,a=n.height;B.x=r/o*2-1,B.y=-i/a*2+1,I.set(B.x,B.y,1).unproject(b.object).sub(b.object.position).normalize()}}function Q(t){return Math.max(b.minDistance,Math.min(b.maxDistance,t))}function $(t){A.set(t.clientX,t.clientY)}function tt(t){R.set(t.clientX,t.clientY)}function et(t){if(1===D.length)A.set(t.pageX,t.pageY);else{var e=vt(t),n=.5*(t.pageX+e.x),r=.5*(t.pageY+e.y);A.set(n,r)}}function nt(t){if(1===D.length)R.set(t.pageX,t.pageY);else{var e=vt(t),n=.5*(t.pageX+e.x),r=.5*(t.pageY+e.y);R.set(n,r)}}function rt(t){var e=vt(t),n=t.pageX-e.x,r=t.pageY-e.y,i=Math.sqrt(n*n+r*r);N.set(0,i)}function it(t){if(1==D.length)O.set(t.pageX,t.pageY);else{var e=vt(t),n=.5*(t.pageX+e.x),r=.5*(t.pageY+e.y);O.set(n,r)}P.subVectors(O,A).multiplyScalar(b.rotateSpeed);var i=b.domElement;G(2*Math.PI*P.x/i.clientHeight),H(2*Math.PI*P.y/i.clientHeight),A.copy(O)}function ot(t){if(1===D.length)k.set(t.pageX,t.pageY);else{var e=vt(t),n=.5*(t.pageX+e.x),r=.5*(t.pageY+e.y);k.set(n,r)}C.subVectors(k,R).multiplyScalar(b.panSpeed),Y(C.x,C.y),R.copy(k)}function at(t){var e=vt(t),n=t.pageX-e.x,r=t.pageY-e.y,i=Math.sqrt(n*n+r*r);L.set(0,i),j.set(0,Math.pow(L.y/N.y,b.zoomSpeed)),J(j.y),N.copy(L),K(.5*(t.pageX+e.x),.5*(t.pageY+e.y))}function st(t){!1!==b.enabled&&(0===D.length&&(b.domElement.setPointerCapture(t.pointerId),b.domElement.addEventListener("pointermove",ut),b.domElement.addEventListener("pointerup",ct)),function(t){for(var e=0;e<D.length;e++)if(D[e]==t.pointerId)return!0;return!1}(t)||(function(t){D.push(t.pointerId)}(t),"touch"===t.pointerType?dt(t):function(t){var e;switch(t.button){case 0:e=b.mouseButtons.LEFT;break;case 1:e=b.mouseButtons.MIDDLE;break;case 2:e=b.mouseButtons.RIGHT;break;default:e=-1}switch(e){case r.kBv.DOLLY:if(!1===b.enableZoom)return;!function(t){K(t.clientX,t.clientX),N.set(t.clientX,t.clientY)}(t),x=_.DOLLY;break;case r.kBv.ROTATE:if(t.ctrlKey||t.metaKey||t.shiftKey){if(!1===b.enablePan)return;tt(t),x=_.PAN}else{if(!1===b.enableRotate)return;$(t),x=_.ROTATE}break;case r.kBv.PAN:if(t.ctrlKey||t.metaKey||t.shiftKey){if(!1===b.enableRotate)return;$(t),x=_.ROTATE}else{if(!1===b.enablePan)return;tt(t),x=_.PAN}break;default:x=_.NONE}x!==_.NONE&&b.dispatchEvent(l)}(t)))}function ut(t){!1!==b.enabled&&("touch"===t.pointerType?function(t){switch(yt(t),x){case _.TOUCH_ROTATE:if(!1===b.enableRotate)return;it(t),b.update();break;case _.TOUCH_PAN:if(!1===b.enablePan)return;ot(t),b.update();break;case _.TOUCH_DOLLY_PAN:if(!1===b.enableZoom&&!1===b.enablePan)return;!function(t){b.enableZoom&&at(t),b.enablePan&&ot(t)}(t),b.update();break;case _.TOUCH_DOLLY_ROTATE:if(!1===b.enableZoom&&!1===b.enableRotate)return;!function(t){b.enableZoom&&at(t),b.enableRotate&&it(t)}(t),b.update();break;default:x=_.NONE}}(t):function(t){switch(x){case _.ROTATE:if(!1===b.enableRotate)return;!function(t){O.set(t.clientX,t.clientY),P.subVectors(O,A).multiplyScalar(b.rotateSpeed);var e=b.domElement;G(2*Math.PI*P.x/e.clientHeight),H(2*Math.PI*P.y/e.clientHeight),A.copy(O),b.update()}(t);break;case _.DOLLY:if(!1===b.enableZoom)return;!function(t){L.set(t.clientX,t.clientY),j.subVectors(L,N),j.y>0?J(V(j.y)):j.y<0&&Z(V(j.y)),N.copy(L),b.update()}(t);break;case _.PAN:if(!1===b.enablePan)return;!function(t){k.set(t.clientX,t.clientY),C.subVectors(k,R).multiplyScalar(b.panSpeed),Y(C.x,C.y),R.copy(k),b.update()}(t)}}(t))}function ct(t){switch(function(t){delete F[t.pointerId];for(var e=0;e<D.length;e++)if(D[e]==t.pointerId)return void D.splice(e,1)}(t),D.length){case 0:b.domElement.releasePointerCapture(t.pointerId),b.domElement.removeEventListener("pointermove",ut),b.domElement.removeEventListener("pointerup",ct),b.dispatchEvent(f),x=_.NONE;break;case 1:var e=D[0],n=F[e];dt({pointerId:e,pageX:n.x,pageY:n.y})}}function lt(t){!1!==b.enabled&&!1!==b.enableZoom&&x===_.NONE&&(t.preventDefault(),b.dispatchEvent(l),function(t){K(t.clientX,t.clientY),t.deltaY<0?Z(V(t.deltaY)):t.deltaY>0&&J(V(t.deltaY)),b.update()}(function(t){var e=t.deltaMode,n={clientX:t.clientX,clientY:t.clientY,deltaY:t.deltaY};switch(e){case 1:n.deltaY*=16;break;case 2:n.deltaY*=100}return t.ctrlKey&&!z&&(n.deltaY*=10),n}(t)),b.dispatchEvent(f))}function ft(t){"Control"===t.key&&(z=!0,b.domElement.getRootNode().addEventListener("keyup",ht,{passive:!0,capture:!0}))}function ht(t){"Control"===t.key&&(z=!1,b.domElement.getRootNode().removeEventListener("keyup",ht,{passive:!0,capture:!0}))}function pt(t){!1!==b.enabled&&!1!==b.enablePan&&function(t){var e=!1;switch(t.code){case b.keys.UP:t.ctrlKey||t.metaKey||t.shiftKey?H(2*Math.PI*b.rotateSpeed/b.domElement.clientHeight):Y(0,b.keyPanSpeed),e=!0;break;case b.keys.BOTTOM:t.ctrlKey||t.metaKey||t.shiftKey?H(-2*Math.PI*b.rotateSpeed/b.domElement.clientHeight):Y(0,-b.keyPanSpeed),e=!0;break;case b.keys.LEFT:t.ctrlKey||t.metaKey||t.shiftKey?G(2*Math.PI*b.rotateSpeed/b.domElement.clientHeight):Y(b.keyPanSpeed,0),e=!0;break;case b.keys.RIGHT:t.ctrlKey||t.metaKey||t.shiftKey?G(-2*Math.PI*b.rotateSpeed/b.domElement.clientHeight):Y(-b.keyPanSpeed,0),e=!0}e&&(t.preventDefault(),b.update())}(t)}function dt(t){switch(yt(t),D.length){case 1:switch(b.touches.ONE){case r.wtR.ROTATE:if(!1===b.enableRotate)return;et(t),x=_.TOUCH_ROTATE;break;case r.wtR.PAN:if(!1===b.enablePan)return;nt(t),x=_.TOUCH_PAN;break;default:x=_.NONE}break;case 2:switch(b.touches.TWO){case r.wtR.DOLLY_PAN:if(!1===b.enableZoom&&!1===b.enablePan)return;!function(t){b.enableZoom&&rt(t),b.enablePan&&nt(t)}(t),x=_.TOUCH_DOLLY_PAN;break;case r.wtR.DOLLY_ROTATE:if(!1===b.enableZoom&&!1===b.enableRotate)return;!function(t){b.enableZoom&&rt(t),b.enableRotate&&et(t)}(t),x=_.TOUCH_DOLLY_ROTATE;break;default:x=_.NONE}break;default:x=_.NONE}x!==_.NONE&&b.dispatchEvent(l)}function mt(t){!1!==b.enabled&&t.preventDefault()}function yt(t){var e=F[t.pointerId];void 0===e&&(e=new r.I9Y,F[t.pointerId]=e),e.set(t.pageX,t.pageY)}function vt(t){var e=t.pointerId===D[0]?D[1]:D[0];return F[e]}return b.domElement.addEventListener("contextmenu",mt),b.domElement.addEventListener("pointerdown",st),b.domElement.addEventListener("pointercancel",ct),b.domElement.addEventListener("wheel",lt,{passive:!1}),b.domElement.getRootNode().addEventListener("keydown",ft,{passive:!0,capture:!0}),i.update(),i}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&u(t,e)}(e,t),n=e,Object.defineProperty(n,"prototype",{writable:!1}),n;var n}(r.Qev)},8378:(t,e,n)=>{n.r(e),n.d(e,{OutlineEffect:()=>u});var r=n(554);function i(t){return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},i(t)}function o(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,s(r.key),r)}}function a(t,e,n){return e&&o(t.prototype,e),n&&o(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function s(t){var e=function(t,e){if("object"!=i(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=i(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==i(e)?e:e+""}var u=a((function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.enabled=!0;var i=void 0!==n.defaultThickness?n.defaultThickness:.003,o=(new r.Q1f).fromArray(void 0!==n.defaultColor?n.defaultColor:[0,0,0]),a=void 0!==n.defaultAlpha?n.defaultAlpha:1,s=void 0!==n.defaultKeepAlive&&n.defaultKeepAlive,u={},c={},l={},f={outlineThickness:{value:i},outlineColor:{value:o},outlineAlpha:{value:a}},h=["#include <common>","#include <uv_pars_vertex>","#include <displacementmap_pars_vertex>","#include <fog_pars_vertex>","#include <morphtarget_pars_vertex>","#include <skinning_pars_vertex>","#include <logdepthbuf_pars_vertex>","#include <clipping_planes_pars_vertex>","uniform float outlineThickness;","vec4 calculateOutline( vec4 pos, vec3 normal, vec4 skinned ) {","\tfloat thickness = outlineThickness;","\tconst float ratio = 1.0;","\tvec4 pos2 = projectionMatrix * modelViewMatrix * vec4( skinned.xyz + normal, 1.0 );","\tvec4 norm = normalize( pos - pos2 );","\treturn pos + norm * thickness * pos.w * ratio;","}","void main() {","\t#include <uv_vertex>","\t#include <beginnormal_vertex>","\t#include <morphnormal_vertex>","\t#include <skinbase_vertex>","\t#include <skinnormal_vertex>","\t#include <begin_vertex>","\t#include <morphtarget_vertex>","\t#include <skinning_vertex>","\t#include <displacementmap_vertex>","\t#include <project_vertex>","\tvec3 outlineNormal = - objectNormal;","\tgl_Position = calculateOutline( gl_Position, outlineNormal, vec4( transformed, 1.0 ) );","\t#include <logdepthbuf_vertex>","\t#include <clipping_planes_vertex>","\t#include <fog_vertex>","}"].join("\n"),p=["#include <common>","#include <fog_pars_fragment>","#include <logdepthbuf_pars_fragment>","#include <clipping_planes_pars_fragment>","uniform vec3 outlineColor;","uniform float outlineAlpha;","void main() {","\t#include <clipping_planes_fragment>","\t#include <logdepthbuf_fragment>","\tgl_FragColor = vec4( outlineColor, outlineAlpha );","\t#include <tonemapping_fragment>","\t#include <colorspace_fragment>","\t#include <fog_fragment>","\t#include <premultiplied_alpha_fragment>","}"].join("\n");function d(t){var e=function(t){var e=u[t.uuid];return void 0===e&&(e={material:new r.BKk({type:"OutlineEffect",uniforms:r.LlO.merge([r.fCn.fog,r.fCn.displacementmap,f]),vertexShader:h,fragmentShader:p,side:r.hsX}),used:!0,keepAlive:s,count:0},u[t.uuid]=e),e.used=!0,e.material}(t);return c[e.uuid]=t,function(t,e){if("invisible"!==t.name){var n=e.userData.outlineParameters;t.fog=e.fog,t.toneMapped=e.toneMapped,t.premultipliedAlpha=e.premultipliedAlpha,t.displacementMap=e.displacementMap,void 0!==n?(!1===e.visible?t.visible=!1:t.visible=void 0===n.visible||n.visible,t.transparent=void 0!==n.alpha&&n.alpha<1||e.transparent,void 0!==n.keepAlive&&(u[e.uuid].keepAlive=n.keepAlive)):(t.transparent=e.transparent,t.visible=e.visible),!0!==e.wireframe&&!1!==e.depthTest||(t.visible=!1),e.clippingPlanes&&(t.clipping=!0,t.clippingPlanes=e.clippingPlanes,t.clipIntersection=e.clipIntersection,t.clipShadows=e.clipShadows),t.version=e.version}}(e,t),e}function m(t){var e=t.geometry,n=void 0!==e&&void 0!==e.attributes.normal;return!0===t.isMesh&&void 0!==t.material&&!0===n}function y(t){if(!1!==m(t)){if(Array.isArray(t.material))for(var e=0,n=t.material.length;e<n;e++)t.material[e]=d(t.material[e]);else t.material=d(t.material);l[t.uuid]=t.onBeforeRender,t.onBeforeRender=g}}function v(t){if(!1!==m(t)){if(Array.isArray(t.material))for(var e=0,n=t.material.length;e<n;e++)t.material[e]=c[t.material[e].uuid];else t.material=c[t.material.uuid];t.onBeforeRender=l[t.uuid]}}function g(t,e,n,r,i){var o=c[i.uuid];void 0!==o&&function(t,e){var n=e.userData.outlineParameters;t.uniforms.outlineAlpha.value=e.opacity,void 0!==n&&(void 0!==n.thickness&&(t.uniforms.outlineThickness.value=n.thickness),void 0!==n.color&&t.uniforms.outlineColor.value.fromArray(n.color),void 0!==n.alpha&&(t.uniforms.outlineAlpha.value=n.alpha)),e.displacementMap&&(t.uniforms.displacementMap.value=e.displacementMap,t.uniforms.displacementScale.value=e.displacementScale,t.uniforms.displacementBias.value=e.displacementBias)}(i,o)}this.render=function(t,n){if(!1!==this.enabled){var r=e.autoClear;e.autoClear=this.autoClear,e.render(t,n),e.autoClear=r,this.renderOutline(t,n)}else e.render(t,n)},this.renderOutline=function(t,n){var r=e.autoClear,i=t.matrixWorldAutoUpdate,o=t.background,a=e.shadowMap.enabled;t.matrixWorldAutoUpdate=!1,t.background=null,e.autoClear=!1,e.shadowMap.enabled=!1,t.traverse(y),e.render(t,n),t.traverse(v),function(){for(var t,e=0,n=(t=Object.keys(c)).length;e<n;e++)c[t[e]]=void 0;for(var r=0,i=(t=Object.keys(l)).length;r<i;r++)l[t[r]]=void 0;for(var o=0,a=(t=Object.keys(u)).length;o<a;o++){var s=t[o];!1===u[s].used?(u[s].count++,!1===u[s].keepAlive&&u[s].count>60&&delete u[s]):(u[s].used=!1,u[s].count=0)}}(),t.matrixWorldAutoUpdate=i,t.background=o,e.autoClear=r,e.shadowMap.enabled=a},this.autoClear=e.autoClear,this.domElement=e.domElement,this.shadowMap=e.shadowMap,this.clear=function(t,n,r){e.clear(t,n,r)},this.getPixelRatio=function(){return e.getPixelRatio()},this.setPixelRatio=function(t){e.setPixelRatio(t)},this.getSize=function(t){return e.getSize(t)},this.setSize=function(t,n,r){e.setSize(t,n,r)},this.setViewport=function(t,n,r,i){e.setViewport(t,n,r,i)},this.setScissor=function(t,n,r,i){e.setScissor(t,n,r,i)},this.setScissorTest=function(t){e.setScissorTest(t)},this.setRenderTarget=function(t){e.setRenderTarget(t)}}))},9162:(t,e,n)=>{n.r(e),n.d(e,{FBXLoader:()=>it});var r=n(554),i=Uint8Array,o=Uint16Array,a=Int32Array,s=new i([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),u=new i([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),c=new i([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),l=function(t,e){for(var n=new o(31),r=0;r<31;++r)n[r]=e+=1<<t[r-1];var i=new a(n[30]);for(r=1;r<30;++r)for(var s=n[r];s<n[r+1];++s)i[s]=s-n[r]<<5|r;return{b:n,r:i}},f=l(s,2),h=f.b,p=f.r;h[28]=258,p[258]=28;for(var d=l(u,0),m=d.b,y=(d.r,new o(32768)),v=0;v<32768;++v){var g=(43690&v)>>1|(21845&v)<<1;g=(61680&(g=(52428&g)>>2|(13107&g)<<2))>>4|(3855&g)<<4,y[v]=((65280&g)>>8|(255&g)<<8)>>1}var b=function(t,e,n){for(var r=t.length,i=0,a=new o(e);i<r;++i)t[i]&&++a[t[i]-1];var s,u=new o(e);for(i=1;i<e;++i)u[i]=u[i-1]+a[i-1]<<1;if(n){s=new o(1<<e);var c=15-e;for(i=0;i<r;++i)if(t[i])for(var l=i<<4|t[i],f=e-t[i],h=u[t[i]-1]++<<f,p=h|(1<<f)-1;h<=p;++h)s[y[h]>>c]=l}else for(s=new o(r),i=0;i<r;++i)t[i]&&(s[i]=y[u[t[i]-1]++]>>15-t[i]);return s},_=new i(288);for(v=0;v<144;++v)_[v]=8;for(v=144;v<256;++v)_[v]=9;for(v=256;v<280;++v)_[v]=7;for(v=280;v<288;++v)_[v]=8;var x=new i(32);for(v=0;v<32;++v)x[v]=5;var w=b(_,9,1),S=b(x,5,1),T=function(t){for(var e=t[0],n=1;n<t.length;++n)t[n]>e&&(e=t[n]);return e},M=function(t,e,n){var r=e/8|0;return(t[r]|t[r+1]<<8)>>(7&e)&n},E=function(t,e){var n=e/8|0;return(t[n]|t[n+1]<<8|t[n+2]<<16)>>(7&e)},A=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],O=function t(e,n,r){var i=new Error(n||A[e]);if(i.code=e,Error.captureStackTrace&&Error.captureStackTrace(i,t),!r)throw i;return i},P=function(t,e,n,r){var o=t.length,a=r?r.length:0;if(!o||e.f&&!e.l)return n||new i(0);var l=!n,f=l||2!=e.i,p=e.i;l&&(n=new i(3*o));var d,y=function(t){var e=n.length;if(t>e){var r=new i(Math.max(2*e,t));r.set(n),n=r}},v=e.f||0,g=e.p||0,_=e.b||0,x=e.l,A=e.d,P=e.m,R=e.n,k=8*o;do{if(!x){v=M(t,g,1);var C=M(t,g+1,3);if(g+=3,!C){var N=t[(d=g,(H=4+((d+7)/8|0))-4)]|t[H-3]<<8,L=H+N;if(L>o){p&&O(0);break}f&&y(_+N),n.set(t.subarray(H,L),_),e.b=_+=N,e.p=g=8*L,e.f=v;continue}if(1==C)x=w,A=S,P=9,R=5;else if(2==C){var j=M(t,g,31)+257,I=M(t,g+10,15)+4,B=j+M(t,g+5,31)+1;g+=14;for(var U=new i(B),D=new i(19),F=0;F<I;++F)D[c[F]]=M(t,g+3*F,7);g+=3*I;var z=T(D),V=(1<<z)-1,G=b(D,z,1);for(F=0;F<B;){var H,W=G[M(t,g,V)];if(g+=15&W,(H=W>>4)<16)U[F++]=H;else{var q=0,X=0;for(16==H?(X=3+M(t,g,3),g+=2,q=U[F-1]):17==H?(X=3+M(t,g,7),g+=3):18==H&&(X=11+M(t,g,127),g+=7);X--;)U[F++]=q}}var Y=U.subarray(0,j),J=U.subarray(j);P=T(Y),R=T(J),x=b(Y,P,1),A=b(J,R,1)}else O(1);if(g>k){p&&O(0);break}}f&&y(_+131072);for(var Z=(1<<P)-1,K=(1<<R)-1,Q=g;;Q=g){var $=(q=x[E(t,g)&Z])>>4;if((g+=15&q)>k){p&&O(0);break}if(q||O(2),$<256)n[_++]=$;else{if(256==$){Q=g,x=null;break}var tt=$-254;if($>264){var et=s[F=$-257];tt=M(t,g,(1<<et)-1)+h[F],g+=et}var nt=A[E(t,g)&K],rt=nt>>4;if(nt||O(3),g+=15&nt,J=m[rt],rt>3&&(et=u[rt],J+=E(t,g)&(1<<et)-1,g+=et),g>k){p&&O(0);break}f&&y(_+131072);var it=_+tt;if(_<J){var ot=a-J,at=Math.min(J,it);for(ot+_<0&&O(3);_<at;++_)n[_]=r[ot+_]}for(;_<it;++_)n[_]=n[_-J]}}e.l=x,e.p=Q,e.b=_,e.f=v,x&&(v=1,e.m=P,e.d=A,e.n=R)}while(!v);return _!=n.length&&l?function(t,e,n){return(null==e||e<0)&&(e=0),(null==n||n>t.length)&&(n=t.length),new i(t.subarray(e,n))}(n,0,_):n.subarray(0,_)},R=new i(0);function k(t,e){return P(t.subarray((n=t,r=e&&e.dictionary,(8!=(15&n[0])||n[0]>>4>7||(n[0]<<8|n[1])%31)&&O(6,"invalid zlib data"),(n[1]>>5&1)==+!r&&O(6,"invalid zlib data: "+(32&n[1]?"need":"unexpected")+" dictionary"),2+(n[1]>>3&4)),-4),{i:2},e&&e.out,e&&e.dictionary);var n,r}var C="undefined"!=typeof TextDecoder&&new TextDecoder;try{C.decode(R,{stream:!0})}catch(t){}function N(t,e,n){var r=n.length-t-1;if(e>=n[r])return r-1;if(e<=n[t])return t;for(var i=t,o=r,a=Math.floor((i+o)/2);e<n[a]||e>=n[a+1];)e<n[a]?o=a:i=a,a=Math.floor((i+o)/2);return a}function L(t,e){for(var n=1,r=2;r<=t;++r)n*=r;for(var i=1,o=2;o<=e;++o)i*=o;for(var a=2;a<=t-e;++a)i*=a;return n/i}function j(t){return j="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},j(t)}function I(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,B(r.key),r)}}function B(t){var e=function(t,e){if("object"!=j(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=j(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==j(e)?e:e+""}function U(t,e,n){return e=F(e),function(t,e){if(e&&("object"===j(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,D()?Reflect.construct(e,n||[],F(t).constructor):e.apply(t,n))}function D(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(D=function(){return!!t})()}function F(t){return F=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},F(t)}function z(t,e){return z=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},z(t,e)}"function"==typeof queueMicrotask?queueMicrotask:"function"==typeof setTimeout&&setTimeout;var V,G,H,W=function(t){function e(t,n,i,o,a){var s;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(s=U(this,e)).degree=t,s.knots=n,s.controlPoints=[],s.startKnot=o||0,s.endKnot=a||s.knots.length-1;for(var u=0;u<i.length;++u){var c=i[u];s.controlPoints[u]=new r.IUQ(c.x,c.y,c.z,c.w)}return s}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&z(t,e)}(e,t),n=e,i=[{key:"getPoint",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new r.Pq0,n=this.knots[this.startKnot]+t*(this.knots[this.endKnot]-this.knots[this.startKnot]),i=function(t,e,n,i){for(var o=N(t,i,e),a=function(t,e,n,r){var i=[],o=[],a=[];i[0]=1;for(var s=1;s<=n;++s){o[s]=e-r[t+1-s],a[s]=r[t+s]-e;for(var u=0,c=0;c<s;++c){var l=a[c+1],f=o[s-c],h=i[c]/(l+f);i[c]=u+l*h,u=f*h}i[s]=u}return i}(o,i,t,e),s=new r.IUQ(0,0,0,0),u=0;u<=t;++u){var c=n[o-t+u],l=a[u],f=c.w*l;s.x+=c.x*f,s.y+=c.y*f,s.z+=c.z*f,s.w+=c.w*l}return s}(this.degree,this.knots,this.controlPoints,n);return 1!==i.w&&i.divideScalar(i.w),e.set(i.x,i.y,i.z)}},{key:"getTangent",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new r.Pq0,n=this.knots[0]+t*(this.knots[this.knots.length-1]-this.knots[0]),i=function(t,e,n,i,o){var a=function(t,e,n,i,o){for(var a=o<t?o:t,s=[],u=N(t,i,e),c=function(t,e,n,r,i){for(var o=[],a=0;a<=n;++a)o[a]=0;for(var s=[],u=0;u<=r;++u)s[u]=o.slice(0);for(var c=[],l=0;l<=n;++l)c[l]=o.slice(0);c[0][0]=1;for(var f=o.slice(0),h=o.slice(0),p=1;p<=n;++p){f[p]=e-i[t+1-p],h[p]=i[t+p]-e;for(var d=0,m=0;m<p;++m){var y=h[m+1],v=f[p-m];c[p][m]=y+v;var g=c[m][p-1]/c[p][m];c[m][p]=d+y*g,d=v*g}c[p][p]=d}for(var b=0;b<=n;++b)s[0][b]=c[b][n];for(var _=0;_<=n;++_){for(var x=0,w=1,S=[],T=0;T<=n;++T)S[T]=o.slice(0);S[0][0]=1;for(var M=1;M<=r;++M){var E=0,A=_-M,O=n-M;_>=M&&(S[w][0]=S[x][0]/c[O+1][A],E=S[w][0]*c[A][O]);for(var P=_-1<=O?M-1:n-_,R=A>=-1?1:-A;R<=P;++R)S[w][R]=(S[x][R]-S[x][R-1])/c[O+1][A+R],E+=S[w][R]*c[A+R][O];_<=O&&(S[w][M]=-S[x][M-1]/c[O+1][_],E+=S[w][M]*c[_][O]),s[M][_]=E;var k=x;x=w,w=k}}for(var C=n,N=1;N<=r;++N){for(var L=0;L<=n;++L)s[N][L]*=C;C*=n-N}return s}(u,i,t,a,e),l=[],f=0;f<n.length;++f){var h=n[f].clone(),p=h.w;h.x*=p,h.y*=p,h.z*=p,l[f]=h}for(var d=0;d<=a;++d){for(var m=l[u-t].clone().multiplyScalar(c[d][0]),y=1;y<=t;++y)m.add(l[u-t+y].clone().multiplyScalar(c[d][y]));s[d]=m}for(var v=a+1;v<=o+1;++v)s[v]=new r.IUQ(0,0,0);return s}(t,e,n,i,o);return function(t){for(var e=t.length,n=[],i=[],o=0;o<e;++o){var a=t[o];n[o]=new r.Pq0(a.x,a.y,a.z),i[o]=a.w}for(var s=[],u=0;u<e;++u){for(var c=n[u].clone(),l=1;l<=u;++l)c.sub(s[u-l].clone().multiplyScalar(L(u,l)*i[l]));s[u]=c.divideScalar(i[0])}return s}(a)}(this.degree,this.knots,this.controlPoints,n,1);return e.copy(i[1]).normalize(),e}}],i&&I(n.prototype,i),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,i}(r.Ipv);function q(t,e,n){if(et())return Reflect.construct.apply(null,arguments);var r=[null];r.push.apply(r,e);var i=new(t.bind.apply(t,r));return n&&rt(i,n.prototype),i}function X(t){return function(t){if(Array.isArray(t))return J(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||Y(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Y(t,e){if(t){if("string"==typeof t)return J(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?J(t,e):void 0}}function J(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function Z(t){return Z="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Z(t)}function K(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Q(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,tt(r.key),r)}}function $(t,e,n){return e&&Q(t.prototype,e),n&&Q(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function tt(t){var e=function(t,e){if("object"!=Z(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=Z(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Z(e)?e:e+""}function et(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(et=function(){return!!t})()}function nt(t){return nt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},nt(t)}function rt(t,e){return rt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},rt(t,e)}var it=function(t){function e(t){return K(this,e),n=this,i=[t],r=nt(r=e),function(t,e){if(e&&("object"===Z(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(n,et()?Reflect.construct(r,i||[],nt(n).constructor):r.apply(n,i));var n,r,i}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&rt(t,e)}(e,t),$(e,[{key:"load",value:function(t,e,n,i){var o=this,a=""===o.path?r.r6x.extractUrlBase(t):o.path,s=new r.Y9S(this.manager);s.setPath(o.path),s.setResponseType("arraybuffer"),s.setRequestHeader(o.requestHeader),s.setWithCredentials(o.withCredentials),s.load(t,(function(n){try{e(o.parse(n,a))}catch(e){i?i(e):console.error(e),o.manager.itemError(t)}}),n,i)}},{key:"parse",value:function(t,e){if(o="Kaydara FBX Binary  \0",(i=t).byteLength>=21&&o===xt(i,0,21))V=(new ct).parse(t);else{var n=xt(t);if(!function(t){var e,n,r=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"],i=0;for(var o=0;o<r.length;++o)if(n=void 0,n=t[(e=1)-1],t=t.slice(i+e),i++,n===r[o])return!1;return!0}(n))throw new Error("THREE.FBXLoader: Unknown format.");if(ht(n)<7e3)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+ht(n));V=(new ut).parse(n)}var i,o,a=new r.Tap(this.manager).setPath(this.resourcePath||e).setCrossOrigin(this.crossOrigin);return new ot(a,this.manager).parse(V)}}])}(r.aHM),ot=function(){return $((function t(e,n){K(this,t),this.textureLoader=e,this.manager=n}),[{key:"parse",value:function(){G=this.parseConnections();var t=this.parseImages(),e=this.parseTextures(t),n=this.parseMaterials(e),r=this.parseDeformers(),i=(new at).parse(r);return this.parseScene(r,i,n),H}},{key:"parseConnections",value:function(){var t=new Map;return"Connections"in V&&V.Connections.connections.forEach((function(e){var n=e[0],r=e[1],i=e[2];t.has(n)||t.set(n,{parents:[],children:[]});var o={ID:r,relationship:i};t.get(n).parents.push(o),t.has(r)||t.set(r,{parents:[],children:[]});var a={ID:n,relationship:i};t.get(r).children.push(a)})),t}},{key:"parseImages",value:function(){var t={},e={};if("Video"in V.Objects){var n=V.Objects.Video;for(var r in n){var i=n[r];if(t[parseInt(r)]=i.RelativeFilename||i.Filename,"Content"in i){var o=i.Content instanceof ArrayBuffer&&i.Content.byteLength>0,a="string"==typeof i.Content&&""!==i.Content;if(o||a){var s=this.parseImage(n[r]);e[i.RelativeFilename||i.Filename]=s}}}}for(var u in t){var c=t[u];void 0!==e[c]?t[u]=e[c]:t[u]=t[u].split("\\").pop()}return t}},{key:"parseImage",value:function(t){var e,n=t.Content,r=t.RelativeFilename||t.Filename,i=r.slice(r.lastIndexOf(".")+1).toLowerCase();switch(i){case"bmp":e="image/bmp";break;case"jpg":case"jpeg":e="image/jpeg";break;case"png":e="image/png";break;case"tif":e="image/tiff";break;case"tga":null===this.manager.getHandler(".tga")&&console.warn("FBXLoader: TGA loader not found, skipping ",r),e="image/tga";break;default:return void console.warn('FBXLoader: Image type "'+i+'" is not supported.')}if("string"==typeof n)return"data:"+e+";base64,"+n;var o=new Uint8Array(n);return window.URL.createObjectURL(new Blob([o],{type:e}))}},{key:"parseTextures",value:function(t){var e=new Map;if("Texture"in V.Objects){var n=V.Objects.Texture;for(var r in n){var i=this.parseTexture(n[r],t);e.set(parseInt(r),i)}}return e}},{key:"parseTexture",value:function(t,e){var n=this.loadTexture(t,e);n.ID=t.id,n.name=t.attrName;var i=t.WrapModeU,o=t.WrapModeV,a=void 0!==i?i.value:0,s=void 0!==o?o.value:0;if(n.wrapS=0===a?r.GJx:r.ghU,n.wrapT=0===s?r.GJx:r.ghU,"Scaling"in t){var u=t.Scaling.value;n.repeat.x=u[0],n.repeat.y=u[1]}if("Translation"in t){var c=t.Translation.value;n.offset.x=c[0],n.offset.y=c[1]}return n}},{key:"loadTexture",value:function(t,e){var n,i,o=this.textureLoader.path,a=G.get(t.id).children;void 0!==a&&a.length>0&&void 0!==e[a[0].ID]&&(0!==(n=e[a[0].ID]).indexOf("blob:")&&0!==n.indexOf("data:")||this.textureLoader.setPath(void 0));var s=t.FileName.slice(-3).toLowerCase();if("tga"===s){var u=this.manager.getHandler(".tga");null===u?(console.warn("FBXLoader: TGA loader not found, creating placeholder texture for",t.RelativeFilename),i=new r.gPd):(u.setPath(this.textureLoader.path),i=u.load(n))}else if("dds"===s){var c=this.manager.getHandler(".dds");null===c?(console.warn("FBXLoader: DDS loader not found, creating placeholder texture for",t.RelativeFilename),i=new r.gPd):(c.setPath(this.textureLoader.path),i=c.load(n))}else"psd"===s?(console.warn("FBXLoader: PSD textures are not supported, creating placeholder texture for",t.RelativeFilename),i=new r.gPd):i=this.textureLoader.load(n);return this.textureLoader.setPath(o),i}},{key:"parseMaterials",value:function(t){var e=new Map;if("Material"in V.Objects){var n=V.Objects.Material;for(var r in n){var i=this.parseMaterial(n[r],t);null!==i&&e.set(parseInt(r),i)}}return e}},{key:"parseMaterial",value:function(t,e){var n=t.id,i=t.attrName,o=t.ShadingModel;if("object"===Z(o)&&(o=o.value),!G.has(n))return null;var a,s=this.parseParameters(t,e,n);switch(o.toLowerCase()){case"phong":a=new r.tXL;break;case"lambert":a=new r.G_z;break;default:console.warn('THREE.FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',o),a=new r.tXL}return a.setValues(s),a.name=i,a}},{key:"parseParameters",value:function(t,e,n){var i={};t.BumpFactor&&(i.bumpScale=t.BumpFactor.value),t.Diffuse?i.color=(new r.Q1f).fromArray(t.Diffuse.value).convertSRGBToLinear():!t.DiffuseColor||"Color"!==t.DiffuseColor.type&&"ColorRGB"!==t.DiffuseColor.type||(i.color=(new r.Q1f).fromArray(t.DiffuseColor.value).convertSRGBToLinear()),t.DisplacementFactor&&(i.displacementScale=t.DisplacementFactor.value),t.Emissive?i.emissive=(new r.Q1f).fromArray(t.Emissive.value).convertSRGBToLinear():!t.EmissiveColor||"Color"!==t.EmissiveColor.type&&"ColorRGB"!==t.EmissiveColor.type||(i.emissive=(new r.Q1f).fromArray(t.EmissiveColor.value).convertSRGBToLinear()),t.EmissiveFactor&&(i.emissiveIntensity=parseFloat(t.EmissiveFactor.value)),t.Opacity&&(i.opacity=parseFloat(t.Opacity.value)),i.opacity<1&&(i.transparent=!0),t.ReflectionFactor&&(i.reflectivity=t.ReflectionFactor.value),t.Shininess&&(i.shininess=t.Shininess.value),t.Specular?i.specular=(new r.Q1f).fromArray(t.Specular.value).convertSRGBToLinear():t.SpecularColor&&"Color"===t.SpecularColor.type&&(i.specular=(new r.Q1f).fromArray(t.SpecularColor.value).convertSRGBToLinear());var o=this;return G.get(n).children.forEach((function(t){var n=t.relationship;switch(n){case"Bump":i.bumpMap=o.getTexture(e,t.ID);break;case"Maya|TEX_ao_map":i.aoMap=o.getTexture(e,t.ID);break;case"DiffuseColor":case"Maya|TEX_color_map":i.map=o.getTexture(e,t.ID),void 0!==i.map&&(i.map.colorSpace=r.er$);break;case"DisplacementColor":i.displacementMap=o.getTexture(e,t.ID);break;case"EmissiveColor":i.emissiveMap=o.getTexture(e,t.ID),void 0!==i.emissiveMap&&(i.emissiveMap.colorSpace=r.er$);break;case"NormalMap":case"Maya|TEX_normal_map":i.normalMap=o.getTexture(e,t.ID);break;case"ReflectionColor":i.envMap=o.getTexture(e,t.ID),void 0!==i.envMap&&(i.envMap.mapping=r.wfO,i.envMap.colorSpace=r.er$);break;case"SpecularColor":i.specularMap=o.getTexture(e,t.ID),void 0!==i.specularMap&&(i.specularMap.colorSpace=r.er$);break;case"TransparentColor":case"TransparencyFactor":i.alphaMap=o.getTexture(e,t.ID),i.transparent=!0;break;default:console.warn("THREE.FBXLoader: %s map is not supported in three.js, skipping texture.",n)}})),i}},{key:"getTexture",value:function(t,e){return"LayeredTexture"in V.Objects&&e in V.Objects.LayeredTexture&&(console.warn("THREE.FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),e=G.get(e).children[0].ID),t.get(e)}},{key:"parseDeformers",value:function(){var t={},e={};if("Deformer"in V.Objects){var n=V.Objects.Deformer;for(var r in n){var i=n[r],o=G.get(parseInt(r));if("Skin"===i.attrType){var a=this.parseSkeleton(o,n);a.ID=r,o.parents.length>1&&console.warn("THREE.FBXLoader: skeleton attached to more than one geometry is not supported."),a.geometryID=o.parents[0].ID,t[r]=a}else if("BlendShape"===i.attrType){var s={id:r};s.rawTargets=this.parseMorphTargets(o,n),s.id=r,o.parents.length>1&&console.warn("THREE.FBXLoader: morph target attached to more than one geometry is not supported."),e[r]=s}}}return{skeletons:t,morphTargets:e}}},{key:"parseSkeleton",value:function(t,e){var n=[];return t.children.forEach((function(t){var i=e[t.ID];if("Cluster"===i.attrType){var o={ID:t.ID,indices:[],weights:[],transformLink:(new r.kn4).fromArray(i.TransformLink.a)};"Indexes"in i&&(o.indices=i.Indexes.a,o.weights=i.Weights.a),n.push(o)}})),{rawBones:n,bones:[]}}},{key:"parseMorphTargets",value:function(t,e){for(var n=[],r=0;r<t.children.length;r++){var i=t.children[r],o=e[i.ID],a={name:o.attrName,initialWeight:o.DeformPercent,id:o.id,fullWeights:o.FullWeights.a};if("BlendShapeChannel"!==o.attrType)return;a.geoID=G.get(parseInt(i.ID)).children.filter((function(t){return void 0===t.relationship}))[0].ID,n.push(a)}return n}},{key:"parseScene",value:function(t,e,n){H=new r.YJl;var i=this.parseModels(t.skeletons,e,n),o=V.Objects.Model,a=this;i.forEach((function(t){var e=o[t.ID];a.setLookAtProperties(t,e),G.get(t.ID).parents.forEach((function(e){var n=i.get(e.ID);void 0!==n&&n.add(t)})),null===t.parent&&H.add(t)})),this.bindSkeleton(t.skeletons,e,i),this.addGlobalSceneSettings(),H.traverse((function(t){if(t.userData.transformData){t.parent&&(t.userData.transformData.parentMatrix=t.parent.matrix,t.userData.transformData.parentMatrixWorld=t.parent.matrixWorld);var e=gt(t.userData.transformData);t.applyMatrix4(e),t.updateWorldMatrix()}}));var s=(new st).parse();1===H.children.length&&H.children[0].isGroup&&(H.children[0].animations=s,H=H.children[0]),H.animations=s}},{key:"parseModels",value:function(t,e,n){var i=new Map,o=V.Objects.Model;for(var a in o){var s=parseInt(a),u=o[a],c=G.get(s),l=this.buildSkeleton(c,t,s,u.attrName);if(!l){switch(u.attrType){case"Camera":l=this.createCamera(c);break;case"Light":l=this.createLight(c);break;case"Mesh":l=this.createMesh(c,e,n);break;case"NurbsCurve":l=this.createCurve(c,e);break;case"LimbNode":case"Root":l=new r.$Kf;break;default:l=new r.YJl}l.name=u.attrName?r.Nwf.sanitizeNodeName(u.attrName):"",l.userData.originalName=u.attrName,l.ID=s}this.getTransformData(l,u),i.set(s,l)}return i}},{key:"buildSkeleton",value:function(t,e,n,i){var o=null;return t.parents.forEach((function(t){var a=function(){var a=e[s];a.rawBones.forEach((function(e,s){if(e.ID===t.ID){var u=o;(o=new r.$Kf).matrixWorld.copy(e.transformLink),o.name=i?r.Nwf.sanitizeNodeName(i):"",o.userData.originalName=i,o.ID=n,a.bones[s]=o,null!==u&&o.add(u)}}))};for(var s in e)a()})),o}},{key:"createCamera",value:function(t){var e,n;if(t.children.forEach((function(t){var e=V.Objects.NodeAttribute[t.ID];void 0!==e&&(n=e)})),void 0===n)e=new r.B69;else{var i=0;void 0!==n.CameraProjectionType&&1===n.CameraProjectionType.value&&(i=1);var o=1;void 0!==n.NearPlane&&(o=n.NearPlane.value/1e3);var a=1e3;void 0!==n.FarPlane&&(a=n.FarPlane.value/1e3);var s=window.innerWidth,u=window.innerHeight;void 0!==n.AspectWidth&&void 0!==n.AspectHeight&&(s=n.AspectWidth.value,u=n.AspectHeight.value);var c=s/u,l=45;void 0!==n.FieldOfView&&(l=n.FieldOfView.value);var f=n.FocalLength?n.FocalLength.value:null;switch(i){case 0:e=new r.ubm(l,c,o,a),null!==f&&e.setFocalLength(f);break;case 1:e=new r.qUd(-s/2,s/2,u/2,-u/2,o,a);break;default:console.warn("THREE.FBXLoader: Unknown camera type "+i+"."),e=new r.B69}}return e}},{key:"createLight",value:function(t){var e,n;if(t.children.forEach((function(t){var e=V.Objects.NodeAttribute[t.ID];void 0!==e&&(n=e)})),void 0===n)e=new r.B69;else{var i;i=void 0===n.LightType?0:n.LightType.value;var o=16777215;void 0!==n.Color&&(o=(new r.Q1f).fromArray(n.Color.value).convertSRGBToLinear());var a=void 0===n.Intensity?1:n.Intensity.value/100;void 0!==n.CastLightOnObject&&0===n.CastLightOnObject.value&&(a=0);var s=0;switch(void 0!==n.FarAttenuationEnd&&(s=void 0!==n.EnableFarAttenuation&&0===n.EnableFarAttenuation.value?0:n.FarAttenuationEnd.value),i){case 0:e=new r.HiM(o,a,s,1);break;case 1:e=new r.ZyN(o,a);break;case 2:var u=Math.PI/3;void 0!==n.InnerAngle&&(u=r.cj9.degToRad(n.InnerAngle.value));var c=0;void 0!==n.OuterAngle&&(c=r.cj9.degToRad(n.OuterAngle.value),c=Math.max(c,1)),e=new r.nCl(o,a,s,u,c,1);break;default:console.warn("THREE.FBXLoader: Unknown light type "+n.LightType.value+", defaulting to a PointLight."),e=new r.HiM(o,a)}void 0!==n.CastShadows&&1===n.CastShadows.value&&(e.castShadow=!0)}return e}},{key:"createMesh",value:function(t,e,n){var i,o=null,a=null,s=[];return t.children.forEach((function(t){e.has(t.ID)&&(o=e.get(t.ID)),n.has(t.ID)&&s.push(n.get(t.ID))})),s.length>1?a=s:s.length>0?a=s[0]:(a=new r.tXL({name:r.aHM.DEFAULT_MATERIAL_NAME,color:13421772}),s.push(a)),"color"in o.attributes&&s.forEach((function(t){t.vertexColors=!0})),o.FBX_Deformer?(i=new r.I46(o,a)).normalizeSkinWeights():i=new r.eaF(o,a),i}},{key:"createCurve",value:function(t,e){var n=t.children.reduce((function(t,n){return e.has(n.ID)&&(t=e.get(n.ID)),t}),null),i=new r.mrM({name:r.aHM.DEFAULT_MATERIAL_NAME,color:3342591,linewidth:1});return new r.N1A(n,i)}},{key:"getTransformData",value:function(t,e){var n={};"InheritType"in e&&(n.inheritType=parseInt(e.InheritType.value)),n.eulerOrder="RotationOrder"in e?bt(e.RotationOrder.value):"ZYX","Lcl_Translation"in e&&(n.translation=e.Lcl_Translation.value),"PreRotation"in e&&(n.preRotation=e.PreRotation.value),"Lcl_Rotation"in e&&(n.rotation=e.Lcl_Rotation.value),"PostRotation"in e&&(n.postRotation=e.PostRotation.value),"Lcl_Scaling"in e&&(n.scale=e.Lcl_Scaling.value),"ScalingOffset"in e&&(n.scalingOffset=e.ScalingOffset.value),"ScalingPivot"in e&&(n.scalingPivot=e.ScalingPivot.value),"RotationOffset"in e&&(n.rotationOffset=e.RotationOffset.value),"RotationPivot"in e&&(n.rotationPivot=e.RotationPivot.value),t.userData.transformData=n}},{key:"setLookAtProperties",value:function(t,e){"LookAtProperty"in e&&G.get(t.ID).children.forEach((function(e){if("LookAtProperty"===e.relationship){var n=V.Objects.Model[e.ID];if("Lcl_Translation"in n){var i=n.Lcl_Translation.value;void 0!==t.target?(t.target.position.fromArray(i),H.add(t.target)):t.lookAt((new r.Pq0).fromArray(i))}}}))}},{key:"bindSkeleton",value:function(t,e,n){var i=this.parsePoseNodes(),o=function(){var o=t[a];G.get(parseInt(o.ID)).parents.forEach((function(t){if(e.has(t.ID)){var a=t.ID;G.get(a).parents.forEach((function(t){n.has(t.ID)&&n.get(t.ID).bind(new r.EAD(o.bones),i[t.ID])}))}}))};for(var a in t)o()}},{key:"parsePoseNodes",value:function(){var t={};if("Pose"in V.Objects){var e=V.Objects.Pose;for(var n in e)if("BindPose"===e[n].attrType&&e[n].NbPoseNodes>0){var i=e[n].PoseNode;Array.isArray(i)?i.forEach((function(e){t[e.Node]=(new r.kn4).fromArray(e.Matrix.a)})):t[i.Node]=(new r.kn4).fromArray(i.Matrix.a)}}return t}},{key:"addGlobalSceneSettings",value:function(){if("GlobalSettings"in V){if("AmbientColor"in V.GlobalSettings){var t=V.GlobalSettings.AmbientColor.value,e=t[0],n=t[1],i=t[2];if(0!==e||0!==n||0!==i){var o=new r.Q1f(e,n,i).convertSRGBToLinear();H.add(new r.$p8(o,1))}}"UnitScaleFactor"in V.GlobalSettings&&(H.userData.unitScaleFactor=V.GlobalSettings.UnitScaleFactor.value)}}}])}(),at=function(){return $((function t(){K(this,t),this.negativeMaterialIndices=!1}),[{key:"parse",value:function(t){var e=new Map;if("Geometry"in V.Objects){var n=V.Objects.Geometry;for(var r in n){var i=G.get(parseInt(r)),o=this.parseGeometry(i,n[r],t);e.set(parseInt(r),o)}}return!0===this.negativeMaterialIndices&&console.warn("THREE.FBXLoader: The FBX file contains invalid (negative) material indices. The asset might not render as expected."),e}},{key:"parseGeometry",value:function(t,e,n){switch(e.attrType){case"Mesh":return this.parseMeshGeometry(t,e,n);case"NurbsCurve":return this.parseNurbsGeometry(e)}}},{key:"parseMeshGeometry",value:function(t,e,n){var r=n.skeletons,i=[],o=t.parents.map((function(t){return V.Objects.Model[t.ID]}));if(0!==o.length){var a=t.children.reduce((function(t,e){return void 0!==r[e.ID]&&(t=r[e.ID]),t}),null);t.children.forEach((function(t){void 0!==n.morphTargets[t.ID]&&i.push(n.morphTargets[t.ID])}));var s=o[0],u={};"RotationOrder"in s&&(u.eulerOrder=bt(s.RotationOrder.value)),"InheritType"in s&&(u.inheritType=parseInt(s.InheritType.value)),"GeometricTranslation"in s&&(u.translation=s.GeometricTranslation.value),"GeometricRotation"in s&&(u.rotation=s.GeometricRotation.value),"GeometricScaling"in s&&(u.scale=s.GeometricScaling.value);var c=gt(u);return this.genGeometry(e,a,i,c)}}},{key:"genGeometry",value:function(t,e,n,i){var o=new r.LoY;t.attrName&&(o.name=t.attrName);var a=this.parseGeoNode(t,e),s=this.genBuffers(a),u=new r.qtW(s.vertex,3);if(u.applyMatrix4(i),o.setAttribute("position",u),s.colors.length>0&&o.setAttribute("color",new r.qtW(s.colors,3)),e&&(o.setAttribute("skinIndex",new r.A$4(s.weightsIndices,4)),o.setAttribute("skinWeight",new r.qtW(s.vertexWeights,4)),o.FBX_Deformer=e),s.normal.length>0){var c=(new r.dwI).getNormalMatrix(i),l=new r.qtW(s.normal,3);l.applyNormalMatrix(c),o.setAttribute("normal",l)}if(s.uvs.forEach((function(t,e){var n=0===e?"uv":"uv".concat(e);o.setAttribute(n,new r.qtW(s.uvs[e],2))})),a.material&&"AllSame"!==a.material.mappingType){var f=s.materialIndex[0],h=0;if(s.materialIndex.forEach((function(t,e){t!==f&&(o.addGroup(h,e-h,f),f=t,h=e)})),o.groups.length>0){var p=o.groups[o.groups.length-1],d=p.start+p.count;d!==s.materialIndex.length&&o.addGroup(d,s.materialIndex.length-d,f)}0===o.groups.length&&o.addGroup(0,s.materialIndex.length,s.materialIndex[0])}return this.addMorphTargets(o,t,n,i),o}},{key:"parseGeoNode",value:function(t,e){var n={};if(n.vertexPositions=void 0!==t.Vertices?t.Vertices.a:[],n.vertexIndices=void 0!==t.PolygonVertexIndex?t.PolygonVertexIndex.a:[],t.LayerElementColor&&(n.color=this.parseVertexColors(t.LayerElementColor[0])),t.LayerElementMaterial&&(n.material=this.parseMaterialIndices(t.LayerElementMaterial[0])),t.LayerElementNormal&&(n.normal=this.parseNormals(t.LayerElementNormal[0])),t.LayerElementUV){n.uv=[];for(var r=0;t.LayerElementUV[r];)t.LayerElementUV[r].UV&&n.uv.push(this.parseUVs(t.LayerElementUV[r])),r++}return n.weightTable={},null!==e&&(n.skeleton=e,e.rawBones.forEach((function(t,e){t.indices.forEach((function(r,i){void 0===n.weightTable[r]&&(n.weightTable[r]=[]),n.weightTable[r].push({id:e,weight:t.weights[i]})}))}))),n}},{key:"genBuffers",value:function(t){var e={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]},n=0,r=0,i=!1,o=[],a=[],s=[],u=[],c=[],l=[],f=this;return t.vertexIndices.forEach((function(h,p){var d,m=!1;h<0&&(h=~h,m=!0);var y=[],v=[];if(o.push(3*h,3*h+1,3*h+2),t.color){var g=mt(p,n,h,t.color);s.push(g[0],g[1],g[2])}if(t.skeleton){if(void 0!==t.weightTable[h]&&t.weightTable[h].forEach((function(t){v.push(t.weight),y.push(t.id)})),v.length>4){i||(console.warn("THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),i=!0);var b=[0,0,0,0],_=[0,0,0,0];v.forEach((function(t,e){var n=t,r=y[e];_.forEach((function(t,e,i){if(n>t){i[e]=n,n=t;var o=b[e];b[e]=r,r=o}}))})),y=b,v=_}for(;v.length<4;)v.push(0),y.push(0);for(var x=0;x<4;++x)c.push(v[x]),l.push(y[x])}if(t.normal){var w=mt(p,n,h,t.normal);a.push(w[0],w[1],w[2])}t.material&&"AllSame"!==t.material.mappingType&&(d=mt(p,n,h,t.material)[0])<0&&(f.negativeMaterialIndices=!0,d=0),t.uv&&t.uv.forEach((function(t,e){var r=mt(p,n,h,t);void 0===u[e]&&(u[e]=[]),u[e].push(r[0]),u[e].push(r[1])})),r++,m&&(f.genFace(e,t,o,d,a,s,u,c,l,r),n++,r=0,o=[],a=[],s=[],u=[],c=[],l=[])})),e}},{key:"getNormalNewell",value:function(t){for(var e=new r.Pq0(0,0,0),n=0;n<t.length;n++){var i=t[n],o=t[(n+1)%t.length];e.x+=(i.y-o.y)*(i.z+o.z),e.y+=(i.z-o.z)*(i.x+o.x),e.z+=(i.x-o.x)*(i.y+o.y)}return e.normalize(),e}},{key:"getNormalTangentAndBitangent",value:function(t){var e=this.getNormalNewell(t),n=(Math.abs(e.z)>.5?new r.Pq0(0,1,0):new r.Pq0(0,0,1)).cross(e).normalize(),i=e.clone().cross(n).normalize();return{normal:e,tangent:n,bitangent:i}}},{key:"flattenVertex",value:function(t,e,n){return new r.I9Y(t.dot(e),t.dot(n))}},{key:"genFace",value:function(t,e,n,i,o,a,s,u,c,l){var f;if(l>3){for(var h=[],p=0;p<n.length;p+=3)h.push(new r.Pq0(e.vertexPositions[n[p]],e.vertexPositions[n[p+1]],e.vertexPositions[n[p+2]]));for(var d=this.getNormalTangentAndBitangent(h),m=d.tangent,y=d.bitangent,v=[],g=0,b=h;g<b.length;g++){var _=b[g];v.push(this.flattenVertex(_,m,y))}f=r.xJ6.triangulateShape(v,[])}else f=[[0,1,2]];var x,w=function(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=Y(t))){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}(f);try{var S=function(){var r=function(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,i,o,a,s=[],u=!0,c=!1;try{if(o=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=o.call(n)).done)&&(s.push(r.value),s.length!==e);u=!0);}catch(t){c=!0,i=t}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw i}}return s}}(t,e)||Y(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(x.value,3),l=r[0],f=r[1],h=r[2];t.vertex.push(e.vertexPositions[n[3*l]]),t.vertex.push(e.vertexPositions[n[3*l+1]]),t.vertex.push(e.vertexPositions[n[3*l+2]]),t.vertex.push(e.vertexPositions[n[3*f]]),t.vertex.push(e.vertexPositions[n[3*f+1]]),t.vertex.push(e.vertexPositions[n[3*f+2]]),t.vertex.push(e.vertexPositions[n[3*h]]),t.vertex.push(e.vertexPositions[n[3*h+1]]),t.vertex.push(e.vertexPositions[n[3*h+2]]),e.skeleton&&(t.vertexWeights.push(u[4*l]),t.vertexWeights.push(u[4*l+1]),t.vertexWeights.push(u[4*l+2]),t.vertexWeights.push(u[4*l+3]),t.vertexWeights.push(u[4*f]),t.vertexWeights.push(u[4*f+1]),t.vertexWeights.push(u[4*f+2]),t.vertexWeights.push(u[4*f+3]),t.vertexWeights.push(u[4*h]),t.vertexWeights.push(u[4*h+1]),t.vertexWeights.push(u[4*h+2]),t.vertexWeights.push(u[4*h+3]),t.weightsIndices.push(c[4*l]),t.weightsIndices.push(c[4*l+1]),t.weightsIndices.push(c[4*l+2]),t.weightsIndices.push(c[4*l+3]),t.weightsIndices.push(c[4*f]),t.weightsIndices.push(c[4*f+1]),t.weightsIndices.push(c[4*f+2]),t.weightsIndices.push(c[4*f+3]),t.weightsIndices.push(c[4*h]),t.weightsIndices.push(c[4*h+1]),t.weightsIndices.push(c[4*h+2]),t.weightsIndices.push(c[4*h+3])),e.color&&(t.colors.push(a[3*l]),t.colors.push(a[3*l+1]),t.colors.push(a[3*l+2]),t.colors.push(a[3*f]),t.colors.push(a[3*f+1]),t.colors.push(a[3*f+2]),t.colors.push(a[3*h]),t.colors.push(a[3*h+1]),t.colors.push(a[3*h+2])),e.material&&"AllSame"!==e.material.mappingType&&(t.materialIndex.push(i),t.materialIndex.push(i),t.materialIndex.push(i)),e.normal&&(t.normal.push(o[3*l]),t.normal.push(o[3*l+1]),t.normal.push(o[3*l+2]),t.normal.push(o[3*f]),t.normal.push(o[3*f+1]),t.normal.push(o[3*f+2]),t.normal.push(o[3*h]),t.normal.push(o[3*h+1]),t.normal.push(o[3*h+2])),e.uv&&e.uv.forEach((function(e,n){void 0===t.uvs[n]&&(t.uvs[n]=[]),t.uvs[n].push(s[n][2*l]),t.uvs[n].push(s[n][2*l+1]),t.uvs[n].push(s[n][2*f]),t.uvs[n].push(s[n][2*f+1]),t.uvs[n].push(s[n][2*h]),t.uvs[n].push(s[n][2*h+1])}))};for(w.s();!(x=w.n()).done;)S()}catch(t){w.e(t)}finally{w.f()}}},{key:"addMorphTargets",value:function(t,e,n,r){if(0!==n.length){t.morphTargetsRelative=!0,t.morphAttributes.position=[];var i=this;n.forEach((function(n){n.rawTargets.forEach((function(n){var o=V.Objects.Geometry[n.geoID];void 0!==o&&i.genMorphGeometry(t,e,o,r,n.name)}))}))}}},{key:"genMorphGeometry",value:function(t,e,n,i,o){for(var a=void 0!==e.PolygonVertexIndex?e.PolygonVertexIndex.a:[],s=void 0!==n.Vertices?n.Vertices.a:[],u=void 0!==n.Indexes?n.Indexes.a:[],c=3*t.attributes.position.count,l=new Float32Array(c),f=0;f<u.length;f++){var h=3*u[f];l[h]=s[3*f],l[h+1]=s[3*f+1],l[h+2]=s[3*f+2]}var p={vertexIndices:a,vertexPositions:l},d=this.genBuffers(p),m=new r.qtW(d.vertex,3);m.name=o||n.attrName,m.applyMatrix4(i),t.morphAttributes.position.push(m)}},{key:"parseNormals",value:function(t){var e=t.MappingInformationType,n=t.ReferenceInformationType,r=t.Normals.a,i=[];return"IndexToDirect"===n&&("NormalIndex"in t?i=t.NormalIndex.a:"NormalsIndex"in t&&(i=t.NormalsIndex.a)),{dataSize:3,buffer:r,indices:i,mappingType:e,referenceType:n}}},{key:"parseUVs",value:function(t){var e=t.MappingInformationType,n=t.ReferenceInformationType,r=t.UV.a,i=[];return"IndexToDirect"===n&&(i=t.UVIndex.a),{dataSize:2,buffer:r,indices:i,mappingType:e,referenceType:n}}},{key:"parseVertexColors",value:function(t){var e=t.MappingInformationType,n=t.ReferenceInformationType,i=t.Colors.a,o=[];"IndexToDirect"===n&&(o=t.ColorIndex.a);for(var a=0,s=new r.Q1f;a<i.length;a+=4)s.fromArray(i,a).convertSRGBToLinear().toArray(i,a);return{dataSize:4,buffer:i,indices:o,mappingType:e,referenceType:n}}},{key:"parseMaterialIndices",value:function(t){var e=t.MappingInformationType,n=t.ReferenceInformationType;if("NoMappingInformation"===e)return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:n};for(var r=t.Materials.a,i=[],o=0;o<r.length;++o)i.push(o);return{dataSize:1,buffer:r,indices:i,mappingType:e,referenceType:n}}},{key:"parseNurbsGeometry",value:function(t){var e=parseInt(t.Order);if(isNaN(e))return console.error("THREE.FBXLoader: Invalid Order %s given for geometry ID: %s",t.Order,t.id),new r.LoY;for(var n,i,o=e-1,a=t.KnotVector.a,s=[],u=t.Points.a,c=0,l=u.length;c<l;c+=4)s.push((new r.IUQ).fromArray(u,c));if("Closed"===t.Form)s.push(s[0]);else if("Periodic"===t.Form){n=o,i=a.length-1-n;for(var f=0;f<o;++f)s.push(s[f])}var h=new W(o,a,s,n,i).getPoints(12*s.length);return(new r.LoY).setFromPoints(h)}}])}(),st=function(){return $((function t(){K(this,t)}),[{key:"parse",value:function(){var t=[],e=this.parseClips();if(void 0!==e)for(var n in e){var r=e[n],i=this.addClip(r);t.push(i)}return t}},{key:"parseClips",value:function(){if(void 0!==V.Objects.AnimationCurve){var t=this.parseAnimationCurveNodes();this.parseAnimationCurves(t);var e=this.parseAnimationLayers(t);return this.parseAnimStacks(e)}}},{key:"parseAnimationCurveNodes",value:function(){var t=V.Objects.AnimationCurveNode,e=new Map;for(var n in t){var r=t[n];if(null!==r.attrName.match(/S|R|T|DeformPercent/)){var i={id:r.id,attr:r.attrName,curves:{}};e.set(i.id,i)}}return e}},{key:"parseAnimationCurves",value:function(t){var e=V.Objects.AnimationCurve;for(var n in e){var r={id:e[n].id,times:e[n].KeyTime.a.map(pt),values:e[n].KeyValueFloat.a},i=G.get(r.id);if(void 0!==i){var o=i.parents[0].ID,a=i.parents[0].relationship;a.match(/X/)?t.get(o).curves.x=r:a.match(/Y/)?t.get(o).curves.y=r:a.match(/Z/)?t.get(o).curves.z=r:a.match(/DeformPercent/)&&t.has(o)&&(t.get(o).curves.morph=r)}}}},{key:"parseAnimationLayers",value:function(t){var e=V.Objects.AnimationLayer,n=new Map,i=function(){var e=[],i=G.get(parseInt(o));void 0!==i&&(i.children.forEach((function(n,i){if(t.has(n.ID)){var o=t.get(n.ID);if(void 0!==o.curves.x||void 0!==o.curves.y||void 0!==o.curves.z){if(void 0===e[i]){var a=G.get(n.ID).parents.filter((function(t){return void 0!==t.relationship}))[0].ID;if(void 0!==a){var s=V.Objects.Model[a.toString()];if(void 0===s)return void console.warn("THREE.FBXLoader: Encountered a unused curve.",n);var u={modelName:s.attrName?r.Nwf.sanitizeNodeName(s.attrName):"",ID:s.id,initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};H.traverse((function(t){t.ID===s.id&&(u.transform=t.matrix,t.userData.transformData&&(u.eulerOrder=t.userData.transformData.eulerOrder))})),u.transform||(u.transform=new r.kn4),"PreRotation"in s&&(u.preRotation=s.PreRotation.value),"PostRotation"in s&&(u.postRotation=s.PostRotation.value),e[i]=u}}e[i]&&(e[i][o.attr]=o)}else if(void 0!==o.curves.morph){if(void 0===e[i]){var c=G.get(n.ID).parents.filter((function(t){return void 0!==t.relationship}))[0].ID,l=G.get(c).parents[0].ID,f=G.get(l).parents[0].ID,h=G.get(f).parents[0].ID,p=V.Objects.Model[h],d={modelName:p.attrName?r.Nwf.sanitizeNodeName(p.attrName):"",morphName:V.Objects.Deformer[c].attrName};e[i]=d}e[i][o.attr]=o}}})),n.set(parseInt(o),e))};for(var o in e)i();return n}},{key:"parseAnimStacks",value:function(t){var e=V.Objects.AnimationStack,n={};for(var r in e){var i=G.get(parseInt(r)).children;i.length>1&&console.warn("THREE.FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.");var o=t.get(i[0].ID);n[r]={name:e[r].attrName,layer:o}}return n}},{key:"addClip",value:function(t){var e=[],n=this;return t.layer.forEach((function(t){e=e.concat(n.generateTracks(t))})),new r.tz3(t.name,-1,e)}},{key:"generateTracks",value:function(t){var e=[],n=new r.Pq0,i=new r.Pq0;if(t.transform&&t.transform.decompose(n,new r.PTz,i),n=n.toArray(),i=i.toArray(),void 0!==t.T&&Object.keys(t.T.curves).length>0){var o=this.generateVectorTrack(t.modelName,t.T.curves,n,"position");void 0!==o&&e.push(o)}if(void 0!==t.R&&Object.keys(t.R.curves).length>0){var a=this.generateRotationTrack(t.modelName,t.R.curves,t.preRotation,t.postRotation,t.eulerOrder);void 0!==a&&e.push(a)}if(void 0!==t.S&&Object.keys(t.S.curves).length>0){var s=this.generateVectorTrack(t.modelName,t.S.curves,i,"scale");void 0!==s&&e.push(s)}if(void 0!==t.DeformPercent){var u=this.generateMorphTrack(t);void 0!==u&&e.push(u)}return e}},{key:"generateVectorTrack",value:function(t,e,n,i){var o=this.getTimesForAllAxes(e),a=this.getKeyframeTrackValues(o,e,n);return new r.RiT(t+"."+i,o,a)}},{key:"generateRotationTrack",value:function(t,e,n,i,o){var a,s;if(void 0!==e.x&&void 0!==e.y&&void 0!==e.z){var u=this.interpolateRotations(e.x,e.y,e.z,o);a=u[0],s=u[1]}void 0!==n&&((n=n.map(r.cj9.degToRad)).push(o),n=(new r.O9p).fromArray(n),n=(new r.PTz).setFromEuler(n)),void 0!==i&&((i=i.map(r.cj9.degToRad)).push(o),i=(new r.O9p).fromArray(i),i=(new r.PTz).setFromEuler(i).invert());var c=new r.PTz,l=new r.O9p,f=[];if(!s||!a)return new r.MBL(t+".quaternion",[0],[0]);for(var h=0;h<s.length;h+=3)l.set(s[h],s[h+1],s[h+2],o),c.setFromEuler(l),void 0!==n&&c.premultiply(n),void 0!==i&&c.multiply(i),h>2&&(new r.PTz).fromArray(f,(h-3)/3*4).dot(c)<0&&c.set(-c.x,-c.y,-c.z,-c.w),c.toArray(f,h/3*4);return new r.MBL(t+".quaternion",a,f)}},{key:"generateMorphTrack",value:function(t){var e=t.DeformPercent.curves.morph,n=e.values.map((function(t){return t/100})),i=H.getObjectByName(t.modelName).morphTargetDictionary[t.morphName];return new r.Hit(t.modelName+".morphTargetInfluences["+i+"]",e.times,n)}},{key:"getTimesForAllAxes",value:function(t){var e=[];if(void 0!==t.x&&(e=e.concat(t.x.times)),void 0!==t.y&&(e=e.concat(t.y.times)),void 0!==t.z&&(e=e.concat(t.z.times)),(e=e.sort((function(t,e){return t-e}))).length>1){for(var n=1,r=e[0],i=1;i<e.length;i++){var o=e[i];o!==r&&(e[n]=o,r=o,n++)}e=e.slice(0,n)}return e}},{key:"getKeyframeTrackValues",value:function(t,e,n){var r=n,i=[],o=-1,a=-1,s=-1;return t.forEach((function(t){if(e.x&&(o=e.x.times.indexOf(t)),e.y&&(a=e.y.times.indexOf(t)),e.z&&(s=e.z.times.indexOf(t)),-1!==o){var n=e.x.values[o];i.push(n),r[0]=n}else i.push(r[0]);if(-1!==a){var u=e.y.values[a];i.push(u),r[1]=u}else i.push(r[1]);if(-1!==s){var c=e.z.values[s];i.push(c),r[2]=c}else i.push(r[2])})),i}},{key:"interpolateRotations",value:function(t,e,n,i){var o=[],a=[];o.push(t.times[0]),a.push(r.cj9.degToRad(t.values[0])),a.push(r.cj9.degToRad(e.values[0])),a.push(r.cj9.degToRad(n.values[0]));for(var s=1;s<t.values.length;s++){var u=[t.values[s-1],e.values[s-1],n.values[s-1]];if(!(isNaN(u[0])||isNaN(u[1])||isNaN(u[2]))){var c=u.map(r.cj9.degToRad),l=[t.values[s],e.values[s],n.values[s]];if(!(isNaN(l[0])||isNaN(l[1])||isNaN(l[2]))){var f=l.map(r.cj9.degToRad),h=[l[0]-u[0],l[1]-u[1],l[2]-u[2]],p=[Math.abs(h[0]),Math.abs(h[1]),Math.abs(h[2])];if(p[0]>=180||p[1]>=180||p[2]>=180){var d=Math.max.apply(Math,p)/180,m=q(r.O9p,X(c).concat([i])),y=q(r.O9p,X(f).concat([i])),v=(new r.PTz).setFromEuler(m),g=(new r.PTz).setFromEuler(y);v.dot(g)&&g.set(-g.x,-g.y,-g.z,-g.w);for(var b=t.times[s-1],_=t.times[s]-b,x=new r.PTz,w=new r.O9p,S=0;S<1;S+=1/d)x.copy(v.clone().slerp(g.clone(),S)),o.push(b+S*_),w.setFromQuaternion(x,i),a.push(w.x),a.push(w.y),a.push(w.z)}else o.push(t.times[s]),a.push(r.cj9.degToRad(t.values[s])),a.push(r.cj9.degToRad(e.values[s])),a.push(r.cj9.degToRad(n.values[s]))}}}return[o,a]}}])}(),ut=function(){return $((function t(){K(this,t)}),[{key:"getPrevNode",value:function(){return this.nodeStack[this.currentIndent-2]}},{key:"getCurrentNode",value:function(){return this.nodeStack[this.currentIndent-1]}},{key:"getCurrentProp",value:function(){return this.currentProp}},{key:"pushStack",value:function(t){this.nodeStack.push(t),this.currentIndent+=1}},{key:"popStack",value:function(){this.nodeStack.pop(),this.currentIndent-=1}},{key:"setCurrentProp",value:function(t,e){this.currentProp=t,this.currentPropName=e}},{key:"parse",value:function(t){this.currentIndent=0,this.allNodes=new ft,this.nodeStack=[],this.currentProp=[],this.currentPropName="";var e=this,n=t.split(/[\r\n]+/);return n.forEach((function(t,r){var i=t.match(/^[\s\t]*;/),o=t.match(/^[\s\t]*$/);if(!i&&!o){var a=t.match("^\\t{"+e.currentIndent+"}(\\w+):(.*){",""),s=t.match("^\\t{"+e.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),u=t.match("^\\t{"+(e.currentIndent-1)+"}}");a?e.parseNodeBegin(t,a):s?e.parseNodeProperty(t,s,n[++r]):u?e.popStack():t.match(/^[^\s\t}]/)&&e.parseNodePropertyContinued(t)}})),this.allNodes}},{key:"parseNodeBegin",value:function(t,e){var n=e[1].trim().replace(/^"/,"").replace(/"$/,""),r=e[2].split(",").map((function(t){return t.trim().replace(/^"/,"").replace(/"$/,"")})),i={name:n},o=this.parseNodeAttr(r),a=this.getCurrentNode();0===this.currentIndent?this.allNodes.add(n,i):n in a?("PoseNode"===n?a.PoseNode.push(i):void 0!==a[n].id&&(a[n]={},a[n][a[n].id]=a[n]),""!==o.id&&(a[n][o.id]=i)):"number"==typeof o.id?(a[n]={},a[n][o.id]=i):"Properties70"!==n&&(a[n]="PoseNode"===n?[i]:i),"number"==typeof o.id&&(i.id=o.id),""!==o.name&&(i.attrName=o.name),""!==o.type&&(i.attrType=o.type),this.pushStack(i)}},{key:"parseNodeAttr",value:function(t){var e=t[0];""!==t[0]&&(e=parseInt(t[0]),isNaN(e)&&(e=t[0]));var n="",r="";return t.length>1&&(n=t[1].replace(/^(\w+)::/,""),r=t[2]),{id:e,name:n,type:r}}},{key:"parseNodeProperty",value:function(t,e,n){var r=e[1].replace(/^"/,"").replace(/"$/,"").trim(),i=e[2].replace(/^"/,"").replace(/"$/,"").trim();"Content"===r&&","===i&&(i=n.replace(/"/g,"").replace(/,$/,"").trim());var o=this.getCurrentNode();if("Properties70"!==o.name){if("C"===r){var a=i.split(",").slice(1),s=parseInt(a[0]),u=parseInt(a[1]),c=i.split(",").slice(3);r="connections",function(t,e){for(var n=0,r=t.length,i=e.length;n<i;n++,r++)t[r]=e[n]}(i=[s,u],c=c.map((function(t){return t.trim().replace(/^"/,"")}))),void 0===o[r]&&(o[r]=[])}"Node"===r&&(o.id=i),r in o&&Array.isArray(o[r])?o[r].push(i):"a"!==r?o[r]=i:o.a=i,this.setCurrentProp(o,r),"a"===r&&","!==i.slice(-1)&&(o.a=_t(i))}else this.parseNodeSpecialProperty(t,r,i)}},{key:"parseNodePropertyContinued",value:function(t){var e=this.getCurrentNode();e.a+=t,","!==t.slice(-1)&&(e.a=_t(e.a))}},{key:"parseNodeSpecialProperty",value:function(t,e,n){var r=n.split('",').map((function(t){return t.trim().replace(/^\"/,"").replace(/\s/,"_")})),i=r[0],o=r[1],a=r[2],s=r[3],u=r[4];switch(o){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":u=parseFloat(u);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":u=_t(u)}this.getPrevNode()[i]={type:o,type2:a,flag:s,value:u},this.setCurrentProp(this.getPrevNode(),i)}}])}(),ct=function(){return $((function t(){K(this,t)}),[{key:"parse",value:function(t){var e=new lt(t);e.skip(23);var n=e.getUint32();if(n<6400)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+n);for(var r=new ft;!this.endOfContent(e);){var i=this.parseNode(e,n);null!==i&&r.add(i.name,i)}return r}},{key:"endOfContent",value:function(t){return t.size()%16==0?(t.getOffset()+160+16&-16)>=t.size():t.getOffset()+160+16>=t.size()}},{key:"parseNode",value:function(t,e){var n={},r=e>=7500?t.getUint64():t.getUint32(),i=e>=7500?t.getUint64():t.getUint32();e>=7500?t.getUint64():t.getUint32();var o=t.getUint8(),a=t.getString(o);if(0===r)return null;for(var s=[],u=0;u<i;u++)s.push(this.parseProperty(t));var c=s.length>0?s[0]:"",l=s.length>1?s[1]:"",f=s.length>2?s[2]:"";for(n.singleProperty=1===i&&t.getOffset()===r;r>t.getOffset();){var h=this.parseNode(t,e);null!==h&&this.parseSubNode(a,n,h)}return n.propertyList=s,"number"==typeof c&&(n.id=c),""!==l&&(n.attrName=l),""!==f&&(n.attrType=f),""!==a&&(n.name=a),n}},{key:"parseSubNode",value:function(t,e,n){if(!0===n.singleProperty){var r=n.propertyList[0];Array.isArray(r)?(e[n.name]=n,n.a=r):e[n.name]=r}else if("Connections"===t&&"C"===n.name){var i=[];n.propertyList.forEach((function(t,e){0!==e&&i.push(t)})),void 0===e.connections&&(e.connections=[]),e.connections.push(i)}else if("Properties70"===n.name)Object.keys(n).forEach((function(t){e[t]=n[t]}));else if("Properties70"===t&&"P"===n.name){var o,a=n.propertyList[0],s=n.propertyList[1],u=n.propertyList[2],c=n.propertyList[3];0===a.indexOf("Lcl ")&&(a=a.replace("Lcl ","Lcl_")),0===s.indexOf("Lcl ")&&(s=s.replace("Lcl ","Lcl_")),o="Color"===s||"ColorRGB"===s||"Vector"===s||"Vector3D"===s||0===s.indexOf("Lcl_")?[n.propertyList[4],n.propertyList[5],n.propertyList[6]]:n.propertyList[4],e[a]={type:s,type2:u,flag:c,value:o}}else void 0===e[n.name]?"number"==typeof n.id?(e[n.name]={},e[n.name][n.id]=n):e[n.name]=n:"PoseNode"===n.name?(Array.isArray(e[n.name])||(e[n.name]=[e[n.name]]),e[n.name].push(n)):void 0===e[n.name][n.id]&&(e[n.name][n.id]=n)}},{key:"parseProperty",value:function(t){var e,n=t.getString(1);switch(n){case"C":return t.getBoolean();case"D":return t.getFloat64();case"F":return t.getFloat32();case"I":return t.getInt32();case"L":return t.getInt64();case"R":return e=t.getUint32(),t.getArrayBuffer(e);case"S":return e=t.getUint32(),t.getString(e);case"Y":return t.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":var r=t.getUint32(),i=t.getUint32(),o=t.getUint32();if(0===i)switch(n){case"b":case"c":return t.getBooleanArray(r);case"d":return t.getFloat64Array(r);case"f":return t.getFloat32Array(r);case"i":return t.getInt32Array(r);case"l":return t.getInt64Array(r)}var a=k(new Uint8Array(t.getArrayBuffer(o))),s=new lt(a.buffer);switch(n){case"b":case"c":return s.getBooleanArray(r);case"d":return s.getFloat64Array(r);case"f":return s.getFloat32Array(r);case"i":return s.getInt32Array(r);case"l":return s.getInt64Array(r)}break;default:throw new Error("THREE.FBXLoader: Unknown property type "+n)}}}])}(),lt=function(){return $((function t(e,n){K(this,t),this.dv=new DataView(e),this.offset=0,this.littleEndian=void 0===n||n,this._textDecoder=new TextDecoder}),[{key:"getOffset",value:function(){return this.offset}},{key:"size",value:function(){return this.dv.buffer.byteLength}},{key:"skip",value:function(t){this.offset+=t}},{key:"getBoolean",value:function(){return!(1&~this.getUint8())}},{key:"getBooleanArray",value:function(t){for(var e=[],n=0;n<t;n++)e.push(this.getBoolean());return e}},{key:"getUint8",value:function(){var t=this.dv.getUint8(this.offset);return this.offset+=1,t}},{key:"getInt16",value:function(){var t=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,t}},{key:"getInt32",value:function(){var t=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,t}},{key:"getInt32Array",value:function(t){for(var e=[],n=0;n<t;n++)e.push(this.getInt32());return e}},{key:"getUint32",value:function(){var t=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,t}},{key:"getInt64",value:function(){var t,e;return this.littleEndian?(t=this.getUint32(),e=this.getUint32()):(e=this.getUint32(),t=this.getUint32()),2147483648&e?(e=4294967295&~e,4294967295==(t=4294967295&~t)&&(e=e+1&4294967295),-(4294967296*e+(t=t+1&4294967295))):4294967296*e+t}},{key:"getInt64Array",value:function(t){for(var e=[],n=0;n<t;n++)e.push(this.getInt64());return e}},{key:"getUint64",value:function(){var t,e;return this.littleEndian?(t=this.getUint32(),e=this.getUint32()):(e=this.getUint32(),t=this.getUint32()),4294967296*e+t}},{key:"getFloat32",value:function(){var t=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,t}},{key:"getFloat32Array",value:function(t){for(var e=[],n=0;n<t;n++)e.push(this.getFloat32());return e}},{key:"getFloat64",value:function(){var t=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,t}},{key:"getFloat64Array",value:function(t){for(var e=[],n=0;n<t;n++)e.push(this.getFloat64());return e}},{key:"getArrayBuffer",value:function(t){var e=this.dv.buffer.slice(this.offset,this.offset+t);return this.offset+=t,e}},{key:"getString",value:function(t){var e=this.offset,n=new Uint8Array(this.dv.buffer,e,t);this.skip(t);var r=n.indexOf(0);return r>=0&&(n=new Uint8Array(this.dv.buffer,e,r)),this._textDecoder.decode(n)}}])}(),ft=function(){return $((function t(){K(this,t)}),[{key:"add",value:function(t,e){this[t]=e}}])}();function ht(t){var e=t.match(/FBXVersion: (\d+)/);if(e)return parseInt(e[1]);throw new Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function pt(t){return t/46186158e3}var dt=[];function mt(t,e,n,r){var i;switch(r.mappingType){case"ByPolygonVertex":i=t;break;case"ByPolygon":i=e;break;case"ByVertice":i=n;break;case"AllSame":i=r.indices[0];break;default:console.warn("THREE.FBXLoader: unknown attribute mapping type "+r.mappingType)}"IndexToDirect"===r.referenceType&&(i=r.indices[i]);var o=i*r.dataSize,a=o+r.dataSize;return function(t,e,n,r){for(var i=n,o=0;i<r;i++,o++)t[o]=e[i];return t}(dt,r.buffer,o,a)}var yt=new r.O9p,vt=new r.Pq0;function gt(t){var e=new r.kn4,n=new r.kn4,i=new r.kn4,o=new r.kn4,a=new r.kn4,s=new r.kn4,u=new r.kn4,c=new r.kn4,l=new r.kn4,f=new r.kn4,h=new r.kn4,p=new r.kn4,d=t.inheritType?t.inheritType:0;if(t.translation&&e.setPosition(vt.fromArray(t.translation)),t.preRotation){var m=t.preRotation.map(r.cj9.degToRad);m.push(t.eulerOrder||r.O9p.DEFAULT_ORDER),n.makeRotationFromEuler(yt.fromArray(m))}if(t.rotation){var y=t.rotation.map(r.cj9.degToRad);y.push(t.eulerOrder||r.O9p.DEFAULT_ORDER),i.makeRotationFromEuler(yt.fromArray(y))}if(t.postRotation){var v=t.postRotation.map(r.cj9.degToRad);v.push(t.eulerOrder||r.O9p.DEFAULT_ORDER),o.makeRotationFromEuler(yt.fromArray(v)),o.invert()}t.scale&&a.scale(vt.fromArray(t.scale)),t.scalingOffset&&u.setPosition(vt.fromArray(t.scalingOffset)),t.scalingPivot&&s.setPosition(vt.fromArray(t.scalingPivot)),t.rotationOffset&&c.setPosition(vt.fromArray(t.rotationOffset)),t.rotationPivot&&l.setPosition(vt.fromArray(t.rotationPivot)),t.parentMatrixWorld&&(h.copy(t.parentMatrix),f.copy(t.parentMatrixWorld));var g=n.clone().multiply(i).multiply(o),b=new r.kn4;b.extractRotation(f);var _=new r.kn4;_.copyPosition(f);var x=_.clone().invert().multiply(f),w=b.clone().invert().multiply(x),S=a,T=new r.kn4;if(0===d)T.copy(b).multiply(g).multiply(w).multiply(S);else if(1===d)T.copy(b).multiply(w).multiply(g).multiply(S);else{var M=(new r.kn4).scale((new r.Pq0).setFromMatrixScale(h)).clone().invert(),E=w.clone().multiply(M);T.copy(b).multiply(g).multiply(E).multiply(S)}var A=l.clone().invert(),O=s.clone().invert(),P=e.clone().multiply(c).multiply(l).multiply(n).multiply(i).multiply(o).multiply(A).multiply(u).multiply(s).multiply(a).multiply(O),R=(new r.kn4).copyPosition(P),k=f.clone().multiply(R);return p.copyPosition(k),(P=p.clone().multiply(T)).premultiply(f.invert()),P}function bt(t){var e=["ZYX","YZX","XZY","ZXY","YXZ","XYZ"];return 6===(t=t||0)?(console.warn("THREE.FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect."),e[0]):e[t]}function _t(t){return t.split(",").map((function(t){return parseFloat(t)}))}function xt(t,e,n){return void 0===e&&(e=0),void 0===n&&(n=t.byteLength),(new TextDecoder).decode(new Uint8Array(t,e,n))}},532:(t,e,n)=>{n.r(e),n.d(e,{MMDLoader:()=>k});var r=n(554),i={name:"MMDToonShader",defines:{TOON:!0,MATCAP:!0,MATCAP_BLENDING_ADD:!0},uniforms:r.LlO.merge([r.zkh.toon.uniforms,r.zkh.phong.uniforms,r.zkh.matcap.uniforms]),vertexShader:r.zkh.phong.vertexShader.replace("#include <envmap_pars_vertex>","").replace("#include <envmap_vertex>",""),fragmentShader:r.zkh.phong.fragmentShader.replace("#include <common>","\n\t\t\t\t\t#ifdef USE_MATCAP\n\t\t\t\t\t\tuniform sampler2D matcap;\n\t\t\t\t\t#endif\n\n\t\t\t\t\t#include <common>\n\t\t\t\t").replace("#include <envmap_common_pars_fragment>","\n\t\t\t\t\t#include <gradientmap_pars_fragment>\n\t\t\t\t").replace("#include <envmap_pars_fragment>","").replace("#include <lights_phong_pars_fragment>","\nvarying vec3 vViewPosition;\n\nstruct BlinnPhongMaterial {\n\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n\n};\n\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\n\tvec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;\n\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\n\treflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;\n\n}\n\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\n}\n\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n").replace("#include <envmap_fragment>","\n\t\t\t\t\t".concat("\n#ifdef USE_MATCAP\n\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5; // 0.495 to remove artifacts caused by undersized matcap disks\n\tvec4 matcapColor = texture2D( matcap, uv );\n\n\t#ifdef MATCAP_BLENDING_MULTIPLY\n\n\t\toutgoingLight *= matcapColor.rgb;\n\n\t#elif defined( MATCAP_BLENDING_ADD )\n\n\t\toutgoingLight += matcapColor.rgb;\n\n\t#endif\n\n#endif\n","\n\t\t\t\t"))};function o(t){return o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},o(t)}function a(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,s(r.key),r)}}function s(t){var e=function(t,e){if("object"!=o(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=o(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==o(e)?e:e+""}function u(t,e,n){return e=l(e),function(t,e){if(e&&("object"===o(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,c()?Reflect.construct(e,n||[],l(t).constructor):e.apply(t,n))}function c(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(c=function(){return!!t})()}function l(t){return l=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},l(t)}function f(t,e){return f=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},f(t,e)}var h=function(t){function e(t){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),u(this,e,[t])}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&f(t,e)}(e,t),n=e,(i=[{key:"parse",value:function(t){if(t.length<19)throw new Error("THREE.TGALoader: Not enough data to contain header.");var e=0,n=new Uint8Array(t),i={id_length:n[e++],colormap_type:n[e++],image_type:n[e++],colormap_index:n[e++]|n[e++]<<8,colormap_length:n[e++]|n[e++]<<8,colormap_size:n[e++],origin:[n[e++]|n[e++]<<8,n[e++]|n[e++]<<8],width:n[e++]|n[e++]<<8,height:n[e++]|n[e++]<<8,pixel_size:n[e++],flags:n[e++]};if(function(t){switch(t.image_type){case 1:case 9:if(t.colormap_length>256||24!==t.colormap_size||1!==t.colormap_type)throw new Error("THREE.TGALoader: Invalid type colormap data for indexed type.");break;case 2:case 3:case 10:case 11:if(t.colormap_type)throw new Error("THREE.TGALoader: Invalid type colormap data for colormap type.");break;case 0:throw new Error("THREE.TGALoader: No data.");default:throw new Error("THREE.TGALoader: Invalid type "+t.image_type)}if(t.width<=0||t.height<=0)throw new Error("THREE.TGALoader: Invalid image size.");if(8!==t.pixel_size&&16!==t.pixel_size&&24!==t.pixel_size&&32!==t.pixel_size)throw new Error("THREE.TGALoader: Invalid pixel size "+t.pixel_size)}(i),i.id_length+e>t.length)throw new Error("THREE.TGALoader: No data.");e+=i.id_length;var o=!1,a=!1,s=!1;switch(i.image_type){case 9:o=!0,a=!0;break;case 1:a=!0;break;case 10:o=!0;break;case 2:break;case 11:o=!0,s=!0;break;case 3:s=!0}var u=new Uint8Array(i.width*i.height*4),c=function(t,e,n,r,i){var o,a,s=n.pixel_size>>3,u=n.width*n.height*s;if(e&&(a=i.subarray(r,r+=n.colormap_length*(n.colormap_size>>3))),t){var c,l,f;o=new Uint8Array(u);for(var h=0,p=new Uint8Array(s);h<u;)if(l=1+(127&(c=i[r++])),128&c){for(f=0;f<s;++f)p[f]=i[r++];for(f=0;f<l;++f)o.set(p,h+f*s);h+=s*l}else{for(l*=s,f=0;f<l;++f)o[h+f]=i[r++];h+=l}}else o=i.subarray(r,r+=e?n.width*n.height:u);return{pixel_data:o,palettes:a}}(o,a,i,e,n);return function(t,e,n,r,o){var a,u,c,l,f,h;switch((48&i.flags)>>4){default:case 2:a=0,c=1,f=e,u=0,l=1,h=n;break;case 0:a=0,c=1,f=e,u=n-1,l=-1,h=-1;break;case 3:a=e-1,c=-1,f=-1,u=0,l=1,h=n;break;case 1:a=e-1,c=-1,f=-1,u=n-1,l=-1,h=-1}if(s)switch(i.pixel_size){case 8:!function(t,e,n,r,o,a,s,u){var c,l,f,h=0,p=i.width;for(f=e;f!==r;f+=n)for(l=o;l!==s;l+=a,h++)c=u[h],t[4*(l+p*f)+0]=c,t[4*(l+p*f)+1]=c,t[4*(l+p*f)+2]=c,t[4*(l+p*f)+3]=255}(t,u,l,h,a,c,f,r);break;case 16:!function(t,e,n,r,o,a,s,u){var c,l,f=0,h=i.width;for(l=e;l!==r;l+=n)for(c=o;c!==s;c+=a,f+=2)t[4*(c+h*l)+0]=u[f+0],t[4*(c+h*l)+1]=u[f+0],t[4*(c+h*l)+2]=u[f+0],t[4*(c+h*l)+3]=u[f+1]}(t,u,l,h,a,c,f,r);break;default:throw new Error("THREE.TGALoader: Format not supported.")}else switch(i.pixel_size){case 8:!function(t,e,n,r,o,a,s,u,c){var l,f,h,p=c,d=0,m=i.width;for(h=e;h!==r;h+=n)for(f=o;f!==s;f+=a,d++)l=u[d],t[4*(f+m*h)+3]=255,t[4*(f+m*h)+2]=p[3*l+0],t[4*(f+m*h)+1]=p[3*l+1],t[4*(f+m*h)+0]=p[3*l+2]}(t,u,l,h,a,c,f,r,o);break;case 16:!function(t,e,n,r,o,a,s,u){var c,l,f,h=0,p=i.width;for(f=e;f!==r;f+=n)for(l=o;l!==s;l+=a,h+=2)c=u[h+0]+(u[h+1]<<8),t[4*(l+p*f)+0]=(31744&c)>>7,t[4*(l+p*f)+1]=(992&c)>>2,t[4*(l+p*f)+2]=(31&c)<<3,t[4*(l+p*f)+3]=32768&c?0:255}(t,u,l,h,a,c,f,r);break;case 24:!function(t,e,n,r,o,a,s,u){var c,l,f=0,h=i.width;for(l=e;l!==r;l+=n)for(c=o;c!==s;c+=a,f+=3)t[4*(c+h*l)+3]=255,t[4*(c+h*l)+2]=u[f+0],t[4*(c+h*l)+1]=u[f+1],t[4*(c+h*l)+0]=u[f+2]}(t,u,l,h,a,c,f,r);break;case 32:!function(t,e,n,r,o,a,s,u){var c,l,f=0,h=i.width;for(l=e;l!==r;l+=n)for(c=o;c!==s;c+=a,f+=4)t[4*(c+h*l)+2]=u[f+0],t[4*(c+h*l)+1]=u[f+1],t[4*(c+h*l)+0]=u[f+2],t[4*(c+h*l)+3]=u[f+3]}(t,u,l,h,a,c,f,r);break;default:throw new Error("THREE.TGALoader: Format not supported.")}}(u,i.width,i.height,c.pixel_data,c.palettes),{data:u,width:i.width,height:i.height,flipY:!0,generateMipmaps:!0,minFilter:r.$_I}}}])&&a(n.prototype,i),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,i}(r.BRH);function p(){}function d(t,e){this.dv=new DataView(t),this.offset=0,this.littleEndian=void 0===e||e,this.encoder=new p}function m(){}function y(){}p.prototype.s2u=function(t){for(var e=this.s2uTable,n="",r=0;r<t.length;){var i=t[r++];if(!(i>=0&&i<=126||i>=161&&i<=223)&&r<t.length&&(i=i<<8|t[r++]),void 0===e[i])return console.error("unknown char code "+i+"."),n;n+=String.fromCharCode(e[i])}return n},p.prototype.s2uTable={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,10:10,11:11,12:12,13:13,14:14,15:15,16:16,17:17,18:18,19:19,20:20,21:21,22:22,23:23,24:24,25:25,26:26,27:27,28:28,29:29,30:30,31:31,32:32,33:33,34:34,35:35,36:36,37:37,38:38,39:39,40:40,41:41,42:42,43:43,44:44,45:45,46:46,47:47,48:48,49:49,50:50,51:51,52:52,53:53,54:54,55:55,56:56,57:57,58:58,59:59,60:60,61:61,62:62,63:63,64:64,65:65,66:66,67:67,68:68,69:69,70:70,71:71,72:72,73:73,74:74,75:75,76:76,77:77,78:78,79:79,80:80,81:81,82:82,83:83,84:84,85:85,86:86,87:87,88:88,89:89,90:90,91:91,92:92,93:93,94:94,95:95,96:96,97:97,98:98,99:99,100:100,101:101,102:102,103:103,104:104,105:105,106:106,107:107,108:108,109:109,110:110,111:111,112:112,113:113,114:114,115:115,116:116,117:117,118:118,119:119,120:120,121:121,122:122,123:123,124:124,125:125,126:126,161:65377,162:65378,163:65379,164:65380,165:65381,166:65382,167:65383,168:65384,169:65385,170:65386,171:65387,172:65388,173:65389,174:65390,175:65391,176:65392,177:65393,178:65394,179:65395,180:65396,181:65397,182:65398,183:65399,184:65400,185:65401,186:65402,187:65403,188:65404,189:65405,190:65406,191:65407,192:65408,193:65409,194:65410,195:65411,196:65412,197:65413,198:65414,199:65415,200:65416,201:65417,202:65418,203:65419,204:65420,205:65421,206:65422,207:65423,208:65424,209:65425,210:65426,211:65427,212:65428,213:65429,214:65430,215:65431,216:65432,217:65433,218:65434,219:65435,220:65436,221:65437,222:65438,223:65439,33088:12288,33089:12289,33090:12290,33091:65292,33092:65294,33093:12539,33094:65306,33095:65307,33096:65311,33097:65281,33098:12443,33099:12444,33100:180,33101:65344,33102:168,33103:65342,33104:65507,33105:65343,33106:12541,33107:12542,33108:12445,33109:12446,33110:12291,33111:20189,33112:12293,33113:12294,33114:12295,33115:12540,33116:8213,33117:8208,33118:65295,33119:65340,33120:65374,33121:8741,33122:65372,33123:8230,33124:8229,33125:8216,33126:8217,33127:8220,33128:8221,33129:65288,33130:65289,33131:12308,33132:12309,33133:65339,33134:65341,33135:65371,33136:65373,33137:12296,33138:12297,33139:12298,33140:12299,33141:12300,33142:12301,33143:12302,33144:12303,33145:12304,33146:12305,33147:65291,33148:65293,33149:177,33150:215,33152:247,33153:65309,33154:8800,33155:65308,33156:65310,33157:8806,33158:8807,33159:8734,33160:8756,33161:9794,33162:9792,33163:176,33164:8242,33165:8243,33166:8451,33167:65509,33168:65284,33169:65504,33170:65505,33171:65285,33172:65283,33173:65286,33174:65290,33175:65312,33176:167,33177:9734,33178:9733,33179:9675,33180:9679,33181:9678,33182:9671,33183:9670,33184:9633,33185:9632,33186:9651,33187:9650,33188:9661,33189:9660,33190:8251,33191:12306,33192:8594,33193:8592,33194:8593,33195:8595,33196:12307,33208:8712,33209:8715,33210:8838,33211:8839,33212:8834,33213:8835,33214:8746,33215:8745,33224:8743,33225:8744,33226:65506,33227:8658,33228:8660,33229:8704,33230:8707,33242:8736,33243:8869,33244:8978,33245:8706,33246:8711,33247:8801,33248:8786,33249:8810,33250:8811,33251:8730,33252:8765,33253:8733,33254:8757,33255:8747,33256:8748,33264:8491,33265:8240,33266:9839,33267:9837,33268:9834,33269:8224,33270:8225,33271:182,33276:9711,33359:65296,33360:65297,33361:65298,33362:65299,33363:65300,33364:65301,33365:65302,33366:65303,33367:65304,33368:65305,33376:65313,33377:65314,33378:65315,33379:65316,33380:65317,33381:65318,33382:65319,33383:65320,33384:65321,33385:65322,33386:65323,33387:65324,33388:65325,33389:65326,33390:65327,33391:65328,33392:65329,33393:65330,33394:65331,33395:65332,33396:65333,33397:65334,33398:65335,33399:65336,33400:65337,33401:65338,33409:65345,33410:65346,33411:65347,33412:65348,33413:65349,33414:65350,33415:65351,33416:65352,33417:65353,33418:65354,33419:65355,33420:65356,33421:65357,33422:65358,33423:65359,33424:65360,33425:65361,33426:65362,33427:65363,33428:65364,33429:65365,33430:65366,33431:65367,33432:65368,33433:65369,33434:65370,33439:12353,33440:12354,33441:12355,33442:12356,33443:12357,33444:12358,33445:12359,33446:12360,33447:12361,33448:12362,33449:12363,33450:12364,33451:12365,33452:12366,33453:12367,33454:12368,33455:12369,33456:12370,33457:12371,33458:12372,33459:12373,33460:12374,33461:12375,33462:12376,33463:12377,33464:12378,33465:12379,33466:12380,33467:12381,33468:12382,33469:12383,33470:12384,33471:12385,33472:12386,33473:12387,33474:12388,33475:12389,33476:12390,33477:12391,33478:12392,33479:12393,33480:12394,33481:12395,33482:12396,33483:12397,33484:12398,33485:12399,33486:12400,33487:12401,33488:12402,33489:12403,33490:12404,33491:12405,33492:12406,33493:12407,33494:12408,33495:12409,33496:12410,33497:12411,33498:12412,33499:12413,33500:12414,33501:12415,33502:12416,33503:12417,33504:12418,33505:12419,33506:12420,33507:12421,33508:12422,33509:12423,33510:12424,33511:12425,33512:12426,33513:12427,33514:12428,33515:12429,33516:12430,33517:12431,33518:12432,33519:12433,33520:12434,33521:12435,33600:12449,33601:12450,33602:12451,33603:12452,33604:12453,33605:12454,33606:12455,33607:12456,33608:12457,33609:12458,33610:12459,33611:12460,33612:12461,33613:12462,33614:12463,33615:12464,33616:12465,33617:12466,33618:12467,33619:12468,33620:12469,33621:12470,33622:12471,33623:12472,33624:12473,33625:12474,33626:12475,33627:12476,33628:12477,33629:12478,33630:12479,33631:12480,33632:12481,33633:12482,33634:12483,33635:12484,33636:12485,33637:12486,33638:12487,33639:12488,33640:12489,33641:12490,33642:12491,33643:12492,33644:12493,33645:12494,33646:12495,33647:12496,33648:12497,33649:12498,33650:12499,33651:12500,33652:12501,33653:12502,33654:12503,33655:12504,33656:12505,33657:12506,33658:12507,33659:12508,33660:12509,33661:12510,33662:12511,33664:12512,33665:12513,33666:12514,33667:12515,33668:12516,33669:12517,33670:12518,33671:12519,33672:12520,33673:12521,33674:12522,33675:12523,33676:12524,33677:12525,33678:12526,33679:12527,33680:12528,33681:12529,33682:12530,33683:12531,33684:12532,33685:12533,33686:12534,33695:913,33696:914,33697:915,33698:916,33699:917,33700:918,33701:919,33702:920,33703:921,33704:922,33705:923,33706:924,33707:925,33708:926,33709:927,33710:928,33711:929,33712:931,33713:932,33714:933,33715:934,33716:935,33717:936,33718:937,33727:945,33728:946,33729:947,33730:948,33731:949,33732:950,33733:951,33734:952,33735:953,33736:954,33737:955,33738:956,33739:957,33740:958,33741:959,33742:960,33743:961,33744:963,33745:964,33746:965,33747:966,33748:967,33749:968,33750:969,33856:1040,33857:1041,33858:1042,33859:1043,33860:1044,33861:1045,33862:1025,33863:1046,33864:1047,33865:1048,33866:1049,33867:1050,33868:1051,33869:1052,33870:1053,33871:1054,33872:1055,33873:1056,33874:1057,33875:1058,33876:1059,33877:1060,33878:1061,33879:1062,33880:1063,33881:1064,33882:1065,33883:1066,33884:1067,33885:1068,33886:1069,33887:1070,33888:1071,33904:1072,33905:1073,33906:1074,33907:1075,33908:1076,33909:1077,33910:1105,33911:1078,33912:1079,33913:1080,33914:1081,33915:1082,33916:1083,33917:1084,33918:1085,33920:1086,33921:1087,33922:1088,33923:1089,33924:1090,33925:1091,33926:1092,33927:1093,33928:1094,33929:1095,33930:1096,33931:1097,33932:1098,33933:1099,33934:1100,33935:1101,33936:1102,33937:1103,33951:9472,33952:9474,33953:9484,33954:9488,33955:9496,33956:9492,33957:9500,33958:9516,33959:9508,33960:9524,33961:9532,33962:9473,33963:9475,33964:9487,33965:9491,33966:9499,33967:9495,33968:9507,33969:9523,33970:9515,33971:9531,33972:9547,33973:9504,33974:9519,33975:9512,33976:9527,33977:9535,33978:9501,33979:9520,33980:9509,33981:9528,33982:9538,34624:9312,34625:9313,34626:9314,34627:9315,34628:9316,34629:9317,34630:9318,34631:9319,34632:9320,34633:9321,34634:9322,34635:9323,34636:9324,34637:9325,34638:9326,34639:9327,34640:9328,34641:9329,34642:9330,34643:9331,34644:8544,34645:8545,34646:8546,34647:8547,34648:8548,34649:8549,34650:8550,34651:8551,34652:8552,34653:8553,34655:13129,34656:13076,34657:13090,34658:13133,34659:13080,34660:13095,34661:13059,34662:13110,34663:13137,34664:13143,34665:13069,34666:13094,34667:13091,34668:13099,34669:13130,34670:13115,34671:13212,34672:13213,34673:13214,34674:13198,34675:13199,34676:13252,34677:13217,34686:13179,34688:12317,34689:12319,34690:8470,34691:13261,34692:8481,34693:12964,34694:12965,34695:12966,34696:12967,34697:12968,34698:12849,34699:12850,34700:12857,34701:13182,34702:13181,34703:13180,34704:8786,34705:8801,34706:8747,34707:8750,34708:8721,34709:8730,34710:8869,34711:8736,34712:8735,34713:8895,34714:8757,34715:8745,34716:8746,34975:20124,34976:21782,34977:23043,34978:38463,34979:21696,34980:24859,34981:25384,34982:23030,34983:36898,34984:33909,34985:33564,34986:31312,34987:24746,34988:25569,34989:28197,34990:26093,34991:33894,34992:33446,34993:39925,34994:26771,34995:22311,34996:26017,34997:25201,34998:23451,34999:22992,35e3:34427,35001:39156,35002:32098,35003:32190,35004:39822,35005:25110,35006:31903,35007:34999,35008:23433,35009:24245,35010:25353,35011:26263,35012:26696,35013:38343,35014:38797,35015:26447,35016:20197,35017:20234,35018:20301,35019:20381,35020:20553,35021:22258,35022:22839,35023:22996,35024:23041,35025:23561,35026:24799,35027:24847,35028:24944,35029:26131,35030:26885,35031:28858,35032:30031,35033:30064,35034:31227,35035:32173,35036:32239,35037:32963,35038:33806,35039:34915,35040:35586,35041:36949,35042:36986,35043:21307,35044:20117,35045:20133,35046:22495,35047:32946,35048:37057,35049:30959,35050:19968,35051:22769,35052:28322,35053:36920,35054:31282,35055:33576,35056:33419,35057:39983,35058:20801,35059:21360,35060:21693,35061:21729,35062:22240,35063:23035,35064:24341,35065:39154,35066:28139,35067:32996,35068:34093,35136:38498,35137:38512,35138:38560,35139:38907,35140:21515,35141:21491,35142:23431,35143:28879,35144:32701,35145:36802,35146:38632,35147:21359,35148:40284,35149:31418,35150:19985,35151:30867,35152:33276,35153:28198,35154:22040,35155:21764,35156:27421,35157:34074,35158:39995,35159:23013,35160:21417,35161:28006,35162:29916,35163:38287,35164:22082,35165:20113,35166:36939,35167:38642,35168:33615,35169:39180,35170:21473,35171:21942,35172:23344,35173:24433,35174:26144,35175:26355,35176:26628,35177:27704,35178:27891,35179:27945,35180:29787,35181:30408,35182:31310,35183:38964,35184:33521,35185:34907,35186:35424,35187:37613,35188:28082,35189:30123,35190:30410,35191:39365,35192:24742,35193:35585,35194:36234,35195:38322,35196:27022,35197:21421,35198:20870,35200:22290,35201:22576,35202:22852,35203:23476,35204:24310,35205:24616,35206:25513,35207:25588,35208:27839,35209:28436,35210:28814,35211:28948,35212:29017,35213:29141,35214:29503,35215:32257,35216:33398,35217:33489,35218:34199,35219:36960,35220:37467,35221:40219,35222:22633,35223:26044,35224:27738,35225:29989,35226:20985,35227:22830,35228:22885,35229:24448,35230:24540,35231:25276,35232:26106,35233:27178,35234:27431,35235:27572,35236:29579,35237:32705,35238:35158,35239:40236,35240:40206,35241:40644,35242:23713,35243:27798,35244:33659,35245:20740,35246:23627,35247:25014,35248:33222,35249:26742,35250:29281,35251:20057,35252:20474,35253:21368,35254:24681,35255:28201,35256:31311,35257:38899,35258:19979,35259:21270,35260:20206,35261:20309,35262:20285,35263:20385,35264:20339,35265:21152,35266:21487,35267:22025,35268:22799,35269:23233,35270:23478,35271:23521,35272:31185,35273:26247,35274:26524,35275:26550,35276:27468,35277:27827,35278:28779,35279:29634,35280:31117,35281:31166,35282:31292,35283:31623,35284:33457,35285:33499,35286:33540,35287:33655,35288:33775,35289:33747,35290:34662,35291:35506,35292:22057,35293:36008,35294:36838,35295:36942,35296:38686,35297:34442,35298:20420,35299:23784,35300:25105,35301:29273,35302:30011,35303:33253,35304:33469,35305:34558,35306:36032,35307:38597,35308:39187,35309:39381,35310:20171,35311:20250,35312:35299,35313:22238,35314:22602,35315:22730,35316:24315,35317:24555,35318:24618,35319:24724,35320:24674,35321:25040,35322:25106,35323:25296,35324:25913,35392:39745,35393:26214,35394:26800,35395:28023,35396:28784,35397:30028,35398:30342,35399:32117,35400:33445,35401:34809,35402:38283,35403:38542,35404:35997,35405:20977,35406:21182,35407:22806,35408:21683,35409:23475,35410:23830,35411:24936,35412:27010,35413:28079,35414:30861,35415:33995,35416:34903,35417:35442,35418:37799,35419:39608,35420:28012,35421:39336,35422:34521,35423:22435,35424:26623,35425:34510,35426:37390,35427:21123,35428:22151,35429:21508,35430:24275,35431:25313,35432:25785,35433:26684,35434:26680,35435:27579,35436:29554,35437:30906,35438:31339,35439:35226,35440:35282,35441:36203,35442:36611,35443:37101,35444:38307,35445:38548,35446:38761,35447:23398,35448:23731,35449:27005,35450:38989,35451:38990,35452:25499,35453:31520,35454:27179,35456:27263,35457:26806,35458:39949,35459:28511,35460:21106,35461:21917,35462:24688,35463:25324,35464:27963,35465:28167,35466:28369,35467:33883,35468:35088,35469:36676,35470:19988,35471:39993,35472:21494,35473:26907,35474:27194,35475:38788,35476:26666,35477:20828,35478:31427,35479:33970,35480:37340,35481:37772,35482:22107,35483:40232,35484:26658,35485:33541,35486:33841,35487:31909,35488:21e3,35489:33477,35490:29926,35491:20094,35492:20355,35493:20896,35494:23506,35495:21002,35496:21208,35497:21223,35498:24059,35499:21914,35500:22570,35501:23014,35502:23436,35503:23448,35504:23515,35505:24178,35506:24185,35507:24739,35508:24863,35509:24931,35510:25022,35511:25563,35512:25954,35513:26577,35514:26707,35515:26874,35516:27454,35517:27475,35518:27735,35519:28450,35520:28567,35521:28485,35522:29872,35523:29976,35524:30435,35525:30475,35526:31487,35527:31649,35528:31777,35529:32233,35530:32566,35531:32752,35532:32925,35533:33382,35534:33694,35535:35251,35536:35532,35537:36011,35538:36996,35539:37969,35540:38291,35541:38289,35542:38306,35543:38501,35544:38867,35545:39208,35546:33304,35547:20024,35548:21547,35549:23736,35550:24012,35551:29609,35552:30284,35553:30524,35554:23721,35555:32747,35556:36107,35557:38593,35558:38929,35559:38996,35560:39e3,35561:20225,35562:20238,35563:21361,35564:21916,35565:22120,35566:22522,35567:22855,35568:23305,35569:23492,35570:23696,35571:24076,35572:24190,35573:24524,35574:25582,35575:26426,35576:26071,35577:26082,35578:26399,35579:26827,35580:26820,35648:27231,35649:24112,35650:27589,35651:27671,35652:27773,35653:30079,35654:31048,35655:23395,35656:31232,35657:32e3,35658:24509,35659:35215,35660:35352,35661:36020,35662:36215,35663:36556,35664:36637,35665:39138,35666:39438,35667:39740,35668:20096,35669:20605,35670:20736,35671:22931,35672:23452,35673:25135,35674:25216,35675:25836,35676:27450,35677:29344,35678:30097,35679:31047,35680:32681,35681:34811,35682:35516,35683:35696,35684:25516,35685:33738,35686:38816,35687:21513,35688:21507,35689:21931,35690:26708,35691:27224,35692:35440,35693:30759,35694:26485,35695:40653,35696:21364,35697:23458,35698:33050,35699:34384,35700:36870,35701:19992,35702:20037,35703:20167,35704:20241,35705:21450,35706:21560,35707:23470,35708:24339,35709:24613,35710:25937,35712:26429,35713:27714,35714:27762,35715:27875,35716:28792,35717:29699,35718:31350,35719:31406,35720:31496,35721:32026,35722:31998,35723:32102,35724:26087,35725:29275,35726:21435,35727:23621,35728:24040,35729:25298,35730:25312,35731:25369,35732:28192,35733:34394,35734:35377,35735:36317,35736:37624,35737:28417,35738:31142,35739:39770,35740:20136,35741:20139,35742:20140,35743:20379,35744:20384,35745:20689,35746:20807,35747:31478,35748:20849,35749:20982,35750:21332,35751:21281,35752:21375,35753:21483,35754:21932,35755:22659,35756:23777,35757:24375,35758:24394,35759:24623,35760:24656,35761:24685,35762:25375,35763:25945,35764:27211,35765:27841,35766:29378,35767:29421,35768:30703,35769:33016,35770:33029,35771:33288,35772:34126,35773:37111,35774:37857,35775:38911,35776:39255,35777:39514,35778:20208,35779:20957,35780:23597,35781:26241,35782:26989,35783:23616,35784:26354,35785:26997,35786:29577,35787:26704,35788:31873,35789:20677,35790:21220,35791:22343,35792:24062,35793:37670,35794:26020,35795:27427,35796:27453,35797:29748,35798:31105,35799:31165,35800:31563,35801:32202,35802:33465,35803:33740,35804:34943,35805:35167,35806:35641,35807:36817,35808:37329,35809:21535,35810:37504,35811:20061,35812:20534,35813:21477,35814:21306,35815:29399,35816:29590,35817:30697,35818:33510,35819:36527,35820:39366,35821:39368,35822:39378,35823:20855,35824:24858,35825:34398,35826:21936,35827:31354,35828:20598,35829:23507,35830:36935,35831:38533,35832:20018,35833:27355,35834:37351,35835:23633,35836:23624,35904:25496,35905:31391,35906:27795,35907:38772,35908:36705,35909:31402,35910:29066,35911:38536,35912:31874,35913:26647,35914:32368,35915:26705,35916:37740,35917:21234,35918:21531,35919:34219,35920:35347,35921:32676,35922:36557,35923:37089,35924:21350,35925:34952,35926:31041,35927:20418,35928:20670,35929:21009,35930:20804,35931:21843,35932:22317,35933:29674,35934:22411,35935:22865,35936:24418,35937:24452,35938:24693,35939:24950,35940:24935,35941:25001,35942:25522,35943:25658,35944:25964,35945:26223,35946:26690,35947:28179,35948:30054,35949:31293,35950:31995,35951:32076,35952:32153,35953:32331,35954:32619,35955:33550,35956:33610,35957:34509,35958:35336,35959:35427,35960:35686,35961:36605,35962:38938,35963:40335,35964:33464,35965:36814,35966:39912,35968:21127,35969:25119,35970:25731,35971:28608,35972:38553,35973:26689,35974:20625,35975:27424,35976:27770,35977:28500,35978:31348,35979:32080,35980:34880,35981:35363,35982:26376,35983:20214,35984:20537,35985:20518,35986:20581,35987:20860,35988:21048,35989:21091,35990:21927,35991:22287,35992:22533,35993:23244,35994:24314,35995:25010,35996:25080,35997:25331,35998:25458,35999:26908,36e3:27177,36001:29309,36002:29356,36003:29486,36004:30740,36005:30831,36006:32121,36007:30476,36008:32937,36009:35211,36010:35609,36011:36066,36012:36562,36013:36963,36014:37749,36015:38522,36016:38997,36017:39443,36018:40568,36019:20803,36020:21407,36021:21427,36022:24187,36023:24358,36024:28187,36025:28304,36026:29572,36027:29694,36028:32067,36029:33335,36030:35328,36031:35578,36032:38480,36033:20046,36034:20491,36035:21476,36036:21628,36037:22266,36038:22993,36039:23396,36040:24049,36041:24235,36042:24359,36043:25144,36044:25925,36045:26543,36046:28246,36047:29392,36048:31946,36049:34996,36050:32929,36051:32993,36052:33776,36053:34382,36054:35463,36055:36328,36056:37431,36057:38599,36058:39015,36059:40723,36060:20116,36061:20114,36062:20237,36063:21320,36064:21577,36065:21566,36066:23087,36067:24460,36068:24481,36069:24735,36070:26791,36071:27278,36072:29786,36073:30849,36074:35486,36075:35492,36076:35703,36077:37264,36078:20062,36079:39881,36080:20132,36081:20348,36082:20399,36083:20505,36084:20502,36085:20809,36086:20844,36087:21151,36088:21177,36089:21246,36090:21402,36091:21475,36092:21521,36160:21518,36161:21897,36162:22353,36163:22434,36164:22909,36165:23380,36166:23389,36167:23439,36168:24037,36169:24039,36170:24055,36171:24184,36172:24195,36173:24218,36174:24247,36175:24344,36176:24658,36177:24908,36178:25239,36179:25304,36180:25511,36181:25915,36182:26114,36183:26179,36184:26356,36185:26477,36186:26657,36187:26775,36188:27083,36189:27743,36190:27946,36191:28009,36192:28207,36193:28317,36194:30002,36195:30343,36196:30828,36197:31295,36198:31968,36199:32005,36200:32024,36201:32094,36202:32177,36203:32789,36204:32771,36205:32943,36206:32945,36207:33108,36208:33167,36209:33322,36210:33618,36211:34892,36212:34913,36213:35611,36214:36002,36215:36092,36216:37066,36217:37237,36218:37489,36219:30783,36220:37628,36221:38308,36222:38477,36224:38917,36225:39321,36226:39640,36227:40251,36228:21083,36229:21163,36230:21495,36231:21512,36232:22741,36233:25335,36234:28640,36235:35946,36236:36703,36237:40633,36238:20811,36239:21051,36240:21578,36241:22269,36242:31296,36243:37239,36244:40288,36245:40658,36246:29508,36247:28425,36248:33136,36249:29969,36250:24573,36251:24794,36252:39592,36253:29403,36254:36796,36255:27492,36256:38915,36257:20170,36258:22256,36259:22372,36260:22718,36261:23130,36262:24680,36263:25031,36264:26127,36265:26118,36266:26681,36267:26801,36268:28151,36269:30165,36270:32058,36271:33390,36272:39746,36273:20123,36274:20304,36275:21449,36276:21766,36277:23919,36278:24038,36279:24046,36280:26619,36281:27801,36282:29811,36283:30722,36284:35408,36285:37782,36286:35039,36287:22352,36288:24231,36289:25387,36290:20661,36291:20652,36292:20877,36293:26368,36294:21705,36295:22622,36296:22971,36297:23472,36298:24425,36299:25165,36300:25505,36301:26685,36302:27507,36303:28168,36304:28797,36305:37319,36306:29312,36307:30741,36308:30758,36309:31085,36310:25998,36311:32048,36312:33756,36313:35009,36314:36617,36315:38555,36316:21092,36317:22312,36318:26448,36319:32618,36320:36001,36321:20916,36322:22338,36323:38442,36324:22586,36325:27018,36326:32948,36327:21682,36328:23822,36329:22524,36330:30869,36331:40442,36332:20316,36333:21066,36334:21643,36335:25662,36336:26152,36337:26388,36338:26613,36339:31364,36340:31574,36341:32034,36342:37679,36343:26716,36344:39853,36345:31545,36346:21273,36347:20874,36348:21047,36416:23519,36417:25334,36418:25774,36419:25830,36420:26413,36421:27578,36422:34217,36423:38609,36424:30352,36425:39894,36426:25420,36427:37638,36428:39851,36429:30399,36430:26194,36431:19977,36432:20632,36433:21442,36434:23665,36435:24808,36436:25746,36437:25955,36438:26719,36439:29158,36440:29642,36441:29987,36442:31639,36443:32386,36444:34453,36445:35715,36446:36059,36447:37240,36448:39184,36449:26028,36450:26283,36451:27531,36452:20181,36453:20180,36454:20282,36455:20351,36456:21050,36457:21496,36458:21490,36459:21987,36460:22235,36461:22763,36462:22987,36463:22985,36464:23039,36465:23376,36466:23629,36467:24066,36468:24107,36469:24535,36470:24605,36471:25351,36472:25903,36473:23388,36474:26031,36475:26045,36476:26088,36477:26525,36478:27490,36480:27515,36481:27663,36482:29509,36483:31049,36484:31169,36485:31992,36486:32025,36487:32043,36488:32930,36489:33026,36490:33267,36491:35222,36492:35422,36493:35433,36494:35430,36495:35468,36496:35566,36497:36039,36498:36060,36499:38604,36500:39164,36501:27503,36502:20107,36503:20284,36504:20365,36505:20816,36506:23383,36507:23546,36508:24904,36509:25345,36510:26178,36511:27425,36512:28363,36513:27835,36514:29246,36515:29885,36516:30164,36517:30913,36518:31034,36519:32780,36520:32819,36521:33258,36522:33940,36523:36766,36524:27728,36525:40575,36526:24335,36527:35672,36528:40235,36529:31482,36530:36600,36531:23437,36532:38635,36533:19971,36534:21489,36535:22519,36536:22833,36537:23241,36538:23460,36539:24713,36540:28287,36541:28422,36542:30142,36543:36074,36544:23455,36545:34048,36546:31712,36547:20594,36548:26612,36549:33437,36550:23649,36551:34122,36552:32286,36553:33294,36554:20889,36555:23556,36556:25448,36557:36198,36558:26012,36559:29038,36560:31038,36561:32023,36562:32773,36563:35613,36564:36554,36565:36974,36566:34503,36567:37034,36568:20511,36569:21242,36570:23610,36571:26451,36572:28796,36573:29237,36574:37196,36575:37320,36576:37675,36577:33509,36578:23490,36579:24369,36580:24825,36581:20027,36582:21462,36583:23432,36584:25163,36585:26417,36586:27530,36587:29417,36588:29664,36589:31278,36590:33131,36591:36259,36592:37202,36593:39318,36594:20754,36595:21463,36596:21610,36597:23551,36598:25480,36599:27193,36600:32172,36601:38656,36602:22234,36603:21454,36604:21608,36672:23447,36673:23601,36674:24030,36675:20462,36676:24833,36677:25342,36678:27954,36679:31168,36680:31179,36681:32066,36682:32333,36683:32722,36684:33261,36685:33311,36686:33936,36687:34886,36688:35186,36689:35728,36690:36468,36691:36655,36692:36913,36693:37195,36694:37228,36695:38598,36696:37276,36697:20160,36698:20303,36699:20805,36700:21313,36701:24467,36702:25102,36703:26580,36704:27713,36705:28171,36706:29539,36707:32294,36708:37325,36709:37507,36710:21460,36711:22809,36712:23487,36713:28113,36714:31069,36715:32302,36716:31899,36717:22654,36718:29087,36719:20986,36720:34899,36721:36848,36722:20426,36723:23803,36724:26149,36725:30636,36726:31459,36727:33308,36728:39423,36729:20934,36730:24490,36731:26092,36732:26991,36733:27529,36734:28147,36736:28310,36737:28516,36738:30462,36739:32020,36740:24033,36741:36981,36742:37255,36743:38918,36744:20966,36745:21021,36746:25152,36747:26257,36748:26329,36749:28186,36750:24246,36751:32210,36752:32626,36753:26360,36754:34223,36755:34295,36756:35576,36757:21161,36758:21465,36759:22899,36760:24207,36761:24464,36762:24661,36763:37604,36764:38500,36765:20663,36766:20767,36767:21213,36768:21280,36769:21319,36770:21484,36771:21736,36772:21830,36773:21809,36774:22039,36775:22888,36776:22974,36777:23100,36778:23477,36779:23558,36780:23567,36781:23569,36782:23578,36783:24196,36784:24202,36785:24288,36786:24432,36787:25215,36788:25220,36789:25307,36790:25484,36791:25463,36792:26119,36793:26124,36794:26157,36795:26230,36796:26494,36797:26786,36798:27167,36799:27189,36800:27836,36801:28040,36802:28169,36803:28248,36804:28988,36805:28966,36806:29031,36807:30151,36808:30465,36809:30813,36810:30977,36811:31077,36812:31216,36813:31456,36814:31505,36815:31911,36816:32057,36817:32918,36818:33750,36819:33931,36820:34121,36821:34909,36822:35059,36823:35359,36824:35388,36825:35412,36826:35443,36827:35937,36828:36062,36829:37284,36830:37478,36831:37758,36832:37912,36833:38556,36834:38808,36835:19978,36836:19976,36837:19998,36838:20055,36839:20887,36840:21104,36841:22478,36842:22580,36843:22732,36844:23330,36845:24120,36846:24773,36847:25854,36848:26465,36849:26454,36850:27972,36851:29366,36852:30067,36853:31331,36854:33976,36855:35698,36856:37304,36857:37664,36858:22065,36859:22516,36860:39166,36928:25325,36929:26893,36930:27542,36931:29165,36932:32340,36933:32887,36934:33394,36935:35302,36936:39135,36937:34645,36938:36785,36939:23611,36940:20280,36941:20449,36942:20405,36943:21767,36944:23072,36945:23517,36946:23529,36947:24515,36948:24910,36949:25391,36950:26032,36951:26187,36952:26862,36953:27035,36954:28024,36955:28145,36956:30003,36957:30137,36958:30495,36959:31070,36960:31206,36961:32051,36962:33251,36963:33455,36964:34218,36965:35242,36966:35386,36967:36523,36968:36763,36969:36914,36970:37341,36971:38663,36972:20154,36973:20161,36974:20995,36975:22645,36976:22764,36977:23563,36978:29978,36979:23613,36980:33102,36981:35338,36982:36805,36983:38499,36984:38765,36985:31525,36986:35535,36987:38920,36988:37218,36989:22259,36990:21416,36992:36887,36993:21561,36994:22402,36995:24101,36996:25512,36997:27700,36998:28810,36999:30561,37e3:31883,37001:32736,37002:34928,37003:36930,37004:37204,37005:37648,37006:37656,37007:38543,37008:29790,37009:39620,37010:23815,37011:23913,37012:25968,37013:26530,37014:36264,37015:38619,37016:25454,37017:26441,37018:26905,37019:33733,37020:38935,37021:38592,37022:35070,37023:28548,37024:25722,37025:23544,37026:19990,37027:28716,37028:30045,37029:26159,37030:20932,37031:21046,37032:21218,37033:22995,37034:24449,37035:24615,37036:25104,37037:25919,37038:25972,37039:26143,37040:26228,37041:26866,37042:26646,37043:27491,37044:28165,37045:29298,37046:29983,37047:30427,37048:31934,37049:32854,37050:22768,37051:35069,37052:35199,37053:35488,37054:35475,37055:35531,37056:36893,37057:37266,37058:38738,37059:38745,37060:25993,37061:31246,37062:33030,37063:38587,37064:24109,37065:24796,37066:25114,37067:26021,37068:26132,37069:26512,37070:30707,37071:31309,37072:31821,37073:32318,37074:33034,37075:36012,37076:36196,37077:36321,37078:36447,37079:30889,37080:20999,37081:25305,37082:25509,37083:25666,37084:25240,37085:35373,37086:31363,37087:31680,37088:35500,37089:38634,37090:32118,37091:33292,37092:34633,37093:20185,37094:20808,37095:21315,37096:21344,37097:23459,37098:23554,37099:23574,37100:24029,37101:25126,37102:25159,37103:25776,37104:26643,37105:26676,37106:27849,37107:27973,37108:27927,37109:26579,37110:28508,37111:29006,37112:29053,37113:26059,37114:31359,37115:31661,37116:32218,37184:32330,37185:32680,37186:33146,37187:33307,37188:33337,37189:34214,37190:35438,37191:36046,37192:36341,37193:36984,37194:36983,37195:37549,37196:37521,37197:38275,37198:39854,37199:21069,37200:21892,37201:28472,37202:28982,37203:20840,37204:31109,37205:32341,37206:33203,37207:31950,37208:22092,37209:22609,37210:23720,37211:25514,37212:26366,37213:26365,37214:26970,37215:29401,37216:30095,37217:30094,37218:30990,37219:31062,37220:31199,37221:31895,37222:32032,37223:32068,37224:34311,37225:35380,37226:38459,37227:36961,37228:40736,37229:20711,37230:21109,37231:21452,37232:21474,37233:20489,37234:21930,37235:22766,37236:22863,37237:29245,37238:23435,37239:23652,37240:21277,37241:24803,37242:24819,37243:25436,37244:25475,37245:25407,37246:25531,37248:25805,37249:26089,37250:26361,37251:24035,37252:27085,37253:27133,37254:28437,37255:29157,37256:20105,37257:30185,37258:30456,37259:31379,37260:31967,37261:32207,37262:32156,37263:32865,37264:33609,37265:33624,37266:33900,37267:33980,37268:34299,37269:35013,37270:36208,37271:36865,37272:36973,37273:37783,37274:38684,37275:39442,37276:20687,37277:22679,37278:24974,37279:33235,37280:34101,37281:36104,37282:36896,37283:20419,37284:20596,37285:21063,37286:21363,37287:24687,37288:25417,37289:26463,37290:28204,37291:36275,37292:36895,37293:20439,37294:23646,37295:36042,37296:26063,37297:32154,37298:21330,37299:34966,37300:20854,37301:25539,37302:23384,37303:23403,37304:23562,37305:25613,37306:26449,37307:36956,37308:20182,37309:22810,37310:22826,37311:27760,37312:35409,37313:21822,37314:22549,37315:22949,37316:24816,37317:25171,37318:26561,37319:33333,37320:26965,37321:38464,37322:39364,37323:39464,37324:20307,37325:22534,37326:23550,37327:32784,37328:23729,37329:24111,37330:24453,37331:24608,37332:24907,37333:25140,37334:26367,37335:27888,37336:28382,37337:32974,37338:33151,37339:33492,37340:34955,37341:36024,37342:36864,37343:36910,37344:38538,37345:40667,37346:39899,37347:20195,37348:21488,37349:22823,37350:31532,37351:37261,37352:38988,37353:40441,37354:28381,37355:28711,37356:21331,37357:21828,37358:23429,37359:25176,37360:25246,37361:25299,37362:27810,37363:28655,37364:29730,37365:35351,37366:37944,37367:28609,37368:35582,37369:33592,37370:20967,37371:34552,37372:21482,37440:21481,37441:20294,37442:36948,37443:36784,37444:22890,37445:33073,37446:24061,37447:31466,37448:36799,37449:26842,37450:35895,37451:29432,37452:40008,37453:27197,37454:35504,37455:20025,37456:21336,37457:22022,37458:22374,37459:25285,37460:25506,37461:26086,37462:27470,37463:28129,37464:28251,37465:28845,37466:30701,37467:31471,37468:31658,37469:32187,37470:32829,37471:32966,37472:34507,37473:35477,37474:37723,37475:22243,37476:22727,37477:24382,37478:26029,37479:26262,37480:27264,37481:27573,37482:30007,37483:35527,37484:20516,37485:30693,37486:22320,37487:24347,37488:24677,37489:26234,37490:27744,37491:30196,37492:31258,37493:32622,37494:33268,37495:34584,37496:36933,37497:39347,37498:31689,37499:30044,37500:31481,37501:31569,37502:33988,37504:36880,37505:31209,37506:31378,37507:33590,37508:23265,37509:30528,37510:20013,37511:20210,37512:23449,37513:24544,37514:25277,37515:26172,37516:26609,37517:27880,37518:34411,37519:34935,37520:35387,37521:37198,37522:37619,37523:39376,37524:27159,37525:28710,37526:29482,37527:33511,37528:33879,37529:36015,37530:19969,37531:20806,37532:20939,37533:21899,37534:23541,37535:24086,37536:24115,37537:24193,37538:24340,37539:24373,37540:24427,37541:24500,37542:25074,37543:25361,37544:26274,37545:26397,37546:28526,37547:29266,37548:30010,37549:30522,37550:32884,37551:33081,37552:33144,37553:34678,37554:35519,37555:35548,37556:36229,37557:36339,37558:37530,37559:38263,37560:38914,37561:40165,37562:21189,37563:25431,37564:30452,37565:26389,37566:27784,37567:29645,37568:36035,37569:37806,37570:38515,37571:27941,37572:22684,37573:26894,37574:27084,37575:36861,37576:37786,37577:30171,37578:36890,37579:22618,37580:26626,37581:25524,37582:27131,37583:20291,37584:28460,37585:26584,37586:36795,37587:34086,37588:32180,37589:37716,37590:26943,37591:28528,37592:22378,37593:22775,37594:23340,37595:32044,37596:29226,37597:21514,37598:37347,37599:40372,37600:20141,37601:20302,37602:20572,37603:20597,37604:21059,37605:35998,37606:21576,37607:22564,37608:23450,37609:24093,37610:24213,37611:24237,37612:24311,37613:24351,37614:24716,37615:25269,37616:25402,37617:25552,37618:26799,37619:27712,37620:30855,37621:31118,37622:31243,37623:32224,37624:33351,37625:35330,37626:35558,37627:36420,37628:36883,37696:37048,37697:37165,37698:37336,37699:40718,37700:27877,37701:25688,37702:25826,37703:25973,37704:28404,37705:30340,37706:31515,37707:36969,37708:37841,37709:28346,37710:21746,37711:24505,37712:25764,37713:36685,37714:36845,37715:37444,37716:20856,37717:22635,37718:22825,37719:23637,37720:24215,37721:28155,37722:32399,37723:29980,37724:36028,37725:36578,37726:39003,37727:28857,37728:20253,37729:27583,37730:28593,37731:3e4,37732:38651,37733:20814,37734:21520,37735:22581,37736:22615,37737:22956,37738:23648,37739:24466,37740:26007,37741:26460,37742:28193,37743:30331,37744:33759,37745:36077,37746:36884,37747:37117,37748:37709,37749:30757,37750:30778,37751:21162,37752:24230,37753:22303,37754:22900,37755:24594,37756:20498,37757:20826,37758:20908,37760:20941,37761:20992,37762:21776,37763:22612,37764:22616,37765:22871,37766:23445,37767:23798,37768:23947,37769:24764,37770:25237,37771:25645,37772:26481,37773:26691,37774:26812,37775:26847,37776:30423,37777:28120,37778:28271,37779:28059,37780:28783,37781:29128,37782:24403,37783:30168,37784:31095,37785:31561,37786:31572,37787:31570,37788:31958,37789:32113,37790:21040,37791:33891,37792:34153,37793:34276,37794:35342,37795:35588,37796:35910,37797:36367,37798:36867,37799:36879,37800:37913,37801:38518,37802:38957,37803:39472,37804:38360,37805:20685,37806:21205,37807:21516,37808:22530,37809:23566,37810:24999,37811:25758,37812:27934,37813:30643,37814:31461,37815:33012,37816:33796,37817:36947,37818:37509,37819:23776,37820:40199,37821:21311,37822:24471,37823:24499,37824:28060,37825:29305,37826:30563,37827:31167,37828:31716,37829:27602,37830:29420,37831:35501,37832:26627,37833:27233,37834:20984,37835:31361,37836:26932,37837:23626,37838:40182,37839:33515,37840:23493,37841:37193,37842:28702,37843:22136,37844:23663,37845:24775,37846:25958,37847:27788,37848:35930,37849:36929,37850:38931,37851:21585,37852:26311,37853:37389,37854:22856,37855:37027,37856:20869,37857:20045,37858:20970,37859:34201,37860:35598,37861:28760,37862:25466,37863:37707,37864:26978,37865:39348,37866:32260,37867:30071,37868:21335,37869:26976,37870:36575,37871:38627,37872:27741,37873:20108,37874:23612,37875:24336,37876:36841,37877:21250,37878:36049,37879:32905,37880:34425,37881:24319,37882:26085,37883:20083,37884:20837,37952:22914,37953:23615,37954:38894,37955:20219,37956:22922,37957:24525,37958:35469,37959:28641,37960:31152,37961:31074,37962:23527,37963:33905,37964:29483,37965:29105,37966:24180,37967:24565,37968:25467,37969:25754,37970:29123,37971:31896,37972:20035,37973:24316,37974:20043,37975:22492,37976:22178,37977:24745,37978:28611,37979:32013,37980:33021,37981:33075,37982:33215,37983:36786,37984:35223,37985:34468,37986:24052,37987:25226,37988:25773,37989:35207,37990:26487,37991:27874,37992:27966,37993:29750,37994:30772,37995:23110,37996:32629,37997:33453,37998:39340,37999:20467,38e3:24259,38001:25309,38002:25490,38003:25943,38004:26479,38005:30403,38006:29260,38007:32972,38008:32954,38009:36649,38010:37197,38011:20493,38012:22521,38013:23186,38014:26757,38016:26995,38017:29028,38018:29437,38019:36023,38020:22770,38021:36064,38022:38506,38023:36889,38024:34687,38025:31204,38026:30695,38027:33833,38028:20271,38029:21093,38030:21338,38031:25293,38032:26575,38033:27850,38034:30333,38035:31636,38036:31893,38037:33334,38038:34180,38039:36843,38040:26333,38041:28448,38042:29190,38043:32283,38044:33707,38045:39361,38046:40614,38047:20989,38048:31665,38049:30834,38050:31672,38051:32903,38052:31560,38053:27368,38054:24161,38055:32908,38056:30033,38057:30048,38058:20843,38059:37474,38060:28300,38061:30330,38062:37271,38063:39658,38064:20240,38065:32624,38066:25244,38067:31567,38068:38309,38069:40169,38070:22138,38071:22617,38072:34532,38073:38588,38074:20276,38075:21028,38076:21322,38077:21453,38078:21467,38079:24070,38080:25644,38081:26001,38082:26495,38083:27710,38084:27726,38085:29256,38086:29359,38087:29677,38088:30036,38089:32321,38090:33324,38091:34281,38092:36009,38093:31684,38094:37318,38095:29033,38096:38930,38097:39151,38098:25405,38099:26217,38100:30058,38101:30436,38102:30928,38103:34115,38104:34542,38105:21290,38106:21329,38107:21542,38108:22915,38109:24199,38110:24444,38111:24754,38112:25161,38113:25209,38114:25259,38115:26e3,38116:27604,38117:27852,38118:30130,38119:30382,38120:30865,38121:31192,38122:32203,38123:32631,38124:32933,38125:34987,38126:35513,38127:36027,38128:36991,38129:38750,38130:39131,38131:27147,38132:31800,38133:20633,38134:23614,38135:24494,38136:26503,38137:27608,38138:29749,38139:30473,38140:32654,38208:40763,38209:26570,38210:31255,38211:21305,38212:30091,38213:39661,38214:24422,38215:33181,38216:33777,38217:32920,38218:24380,38219:24517,38220:30050,38221:31558,38222:36924,38223:26727,38224:23019,38225:23195,38226:32016,38227:30334,38228:35628,38229:20469,38230:24426,38231:27161,38232:27703,38233:28418,38234:29922,38235:31080,38236:34920,38237:35413,38238:35961,38239:24287,38240:25551,38241:30149,38242:31186,38243:33495,38244:37672,38245:37618,38246:33948,38247:34541,38248:39981,38249:21697,38250:24428,38251:25996,38252:27996,38253:28693,38254:36007,38255:36051,38256:38971,38257:25935,38258:29942,38259:19981,38260:20184,38261:22496,38262:22827,38263:23142,38264:23500,38265:20904,38266:24067,38267:24220,38268:24598,38269:25206,38270:25975,38272:26023,38273:26222,38274:28014,38275:29238,38276:31526,38277:33104,38278:33178,38279:33433,38280:35676,38281:36e3,38282:36070,38283:36212,38284:38428,38285:38468,38286:20398,38287:25771,38288:27494,38289:33310,38290:33889,38291:34154,38292:37096,38293:23553,38294:26963,38295:39080,38296:33914,38297:34135,38298:20239,38299:21103,38300:24489,38301:24133,38302:26381,38303:31119,38304:33145,38305:35079,38306:35206,38307:28149,38308:24343,38309:25173,38310:27832,38311:20175,38312:29289,38313:39826,38314:20998,38315:21563,38316:22132,38317:22707,38318:24996,38319:25198,38320:28954,38321:22894,38322:31881,38323:31966,38324:32027,38325:38640,38326:25991,38327:32862,38328:19993,38329:20341,38330:20853,38331:22592,38332:24163,38333:24179,38334:24330,38335:26564,38336:20006,38337:34109,38338:38281,38339:38491,38340:31859,38341:38913,38342:20731,38343:22721,38344:30294,38345:30887,38346:21029,38347:30629,38348:34065,38349:31622,38350:20559,38351:22793,38352:29255,38353:31687,38354:32232,38355:36794,38356:36820,38357:36941,38358:20415,38359:21193,38360:23081,38361:24321,38362:38829,38363:20445,38364:33303,38365:37610,38366:22275,38367:25429,38368:27497,38369:29995,38370:35036,38371:36628,38372:31298,38373:21215,38374:22675,38375:24917,38376:25098,38377:26286,38378:27597,38379:31807,38380:33769,38381:20515,38382:20472,38383:21253,38384:21574,38385:22577,38386:22857,38387:23453,38388:23792,38389:23791,38390:23849,38391:24214,38392:25265,38393:25447,38394:25918,38395:26041,38396:26379,38464:27861,38465:27873,38466:28921,38467:30770,38468:32299,38469:32990,38470:33459,38471:33804,38472:34028,38473:34562,38474:35090,38475:35370,38476:35914,38477:37030,38478:37586,38479:39165,38480:40179,38481:40300,38482:20047,38483:20129,38484:20621,38485:21078,38486:22346,38487:22952,38488:24125,38489:24536,38490:24537,38491:25151,38492:26292,38493:26395,38494:26576,38495:26834,38496:20882,38497:32033,38498:32938,38499:33192,38500:35584,38501:35980,38502:36031,38503:37502,38504:38450,38505:21536,38506:38956,38507:21271,38508:20693,38509:21340,38510:22696,38511:25778,38512:26420,38513:29287,38514:30566,38515:31302,38516:37350,38517:21187,38518:27809,38519:27526,38520:22528,38521:24140,38522:22868,38523:26412,38524:32763,38525:20961,38526:30406,38528:25705,38529:30952,38530:39764,38531:40635,38532:22475,38533:22969,38534:26151,38535:26522,38536:27598,38537:21737,38538:27097,38539:24149,38540:33180,38541:26517,38542:39850,38543:26622,38544:40018,38545:26717,38546:20134,38547:20451,38548:21448,38549:25273,38550:26411,38551:27819,38552:36804,38553:20397,38554:32365,38555:40639,38556:19975,38557:24930,38558:28288,38559:28459,38560:34067,38561:21619,38562:26410,38563:39749,38564:24051,38565:31637,38566:23724,38567:23494,38568:34588,38569:28234,38570:34001,38571:31252,38572:33032,38573:22937,38574:31885,38575:27665,38576:30496,38577:21209,38578:22818,38579:28961,38580:29279,38581:30683,38582:38695,38583:40289,38584:26891,38585:23167,38586:23064,38587:20901,38588:21517,38589:21629,38590:26126,38591:30431,38592:36855,38593:37528,38594:40180,38595:23018,38596:29277,38597:28357,38598:20813,38599:26825,38600:32191,38601:32236,38602:38754,38603:40634,38604:25720,38605:27169,38606:33538,38607:22916,38608:23391,38609:27611,38610:29467,38611:30450,38612:32178,38613:32791,38614:33945,38615:20786,38616:26408,38617:40665,38618:30446,38619:26466,38620:21247,38621:39173,38622:23588,38623:25147,38624:31870,38625:36016,38626:21839,38627:24758,38628:32011,38629:38272,38630:21249,38631:20063,38632:20918,38633:22812,38634:29242,38635:32822,38636:37326,38637:24357,38638:30690,38639:21380,38640:24441,38641:32004,38642:34220,38643:35379,38644:36493,38645:38742,38646:26611,38647:34222,38648:37971,38649:24841,38650:24840,38651:27833,38652:30290,38720:35565,38721:36664,38722:21807,38723:20305,38724:20778,38725:21191,38726:21451,38727:23461,38728:24189,38729:24736,38730:24962,38731:25558,38732:26377,38733:26586,38734:28263,38735:28044,38736:29494,38737:29495,38738:30001,38739:31056,38740:35029,38741:35480,38742:36938,38743:37009,38744:37109,38745:38596,38746:34701,38747:22805,38748:20104,38749:20313,38750:19982,38751:35465,38752:36671,38753:38928,38754:20653,38755:24188,38756:22934,38757:23481,38758:24248,38759:25562,38760:25594,38761:25793,38762:26332,38763:26954,38764:27096,38765:27915,38766:28342,38767:29076,38768:29992,38769:31407,38770:32650,38771:32768,38772:33865,38773:33993,38774:35201,38775:35617,38776:36362,38777:36965,38778:38525,38779:39178,38780:24958,38781:25233,38782:27442,38784:27779,38785:28020,38786:32716,38787:32764,38788:28096,38789:32645,38790:34746,38791:35064,38792:26469,38793:33713,38794:38972,38795:38647,38796:27931,38797:32097,38798:33853,38799:37226,38800:20081,38801:21365,38802:23888,38803:27396,38804:28651,38805:34253,38806:34349,38807:35239,38808:21033,38809:21519,38810:23653,38811:26446,38812:26792,38813:29702,38814:29827,38815:30178,38816:35023,38817:35041,38818:37324,38819:38626,38820:38520,38821:24459,38822:29575,38823:31435,38824:33870,38825:25504,38826:30053,38827:21129,38828:27969,38829:28316,38830:29705,38831:30041,38832:30827,38833:31890,38834:38534,38835:31452,38836:40845,38837:20406,38838:24942,38839:26053,38840:34396,38841:20102,38842:20142,38843:20698,38844:20001,38845:20940,38846:23534,38847:26009,38848:26753,38849:28092,38850:29471,38851:30274,38852:30637,38853:31260,38854:31975,38855:33391,38856:35538,38857:36988,38858:37327,38859:38517,38860:38936,38861:21147,38862:32209,38863:20523,38864:21400,38865:26519,38866:28107,38867:29136,38868:29747,38869:33256,38870:36650,38871:38563,38872:40023,38873:40607,38874:29792,38875:22593,38876:28057,38877:32047,38878:39006,38879:20196,38880:20278,38881:20363,38882:20919,38883:21169,38884:23994,38885:24604,38886:29618,38887:31036,38888:33491,38889:37428,38890:38583,38891:38646,38892:38666,38893:40599,38894:40802,38895:26278,38896:27508,38897:21015,38898:21155,38899:28872,38900:35010,38901:24265,38902:24651,38903:24976,38904:28451,38905:29001,38906:31806,38907:32244,38908:32879,38976:34030,38977:36899,38978:37676,38979:21570,38980:39791,38981:27347,38982:28809,38983:36034,38984:36335,38985:38706,38986:21172,38987:23105,38988:24266,38989:24324,38990:26391,38991:27004,38992:27028,38993:28010,38994:28431,38995:29282,38996:29436,38997:31725,38998:32769,38999:32894,39e3:34635,39001:37070,39002:20845,39003:40595,39004:31108,39005:32907,39006:37682,39007:35542,39008:20525,39009:21644,39010:35441,39011:27498,39012:36036,39013:33031,39014:24785,39015:26528,39016:40434,39017:20121,39018:20120,39019:39952,39020:35435,39021:34241,39022:34152,39023:26880,39024:28286,39025:30871,39026:33109,39071:24332,39072:19984,39073:19989,39074:20010,39075:20017,39076:20022,39077:20028,39078:20031,39079:20034,39080:20054,39081:20056,39082:20098,39083:20101,39084:35947,39085:20106,39086:33298,39087:24333,39088:20110,39089:20126,39090:20127,39091:20128,39092:20130,39093:20144,39094:20147,39095:20150,39096:20174,39097:20173,39098:20164,39099:20166,39100:20162,39101:20183,39102:20190,39103:20205,39104:20191,39105:20215,39106:20233,39107:20314,39108:20272,39109:20315,39110:20317,39111:20311,39112:20295,39113:20342,39114:20360,39115:20367,39116:20376,39117:20347,39118:20329,39119:20336,39120:20369,39121:20335,39122:20358,39123:20374,39124:20760,39125:20436,39126:20447,39127:20430,39128:20440,39129:20443,39130:20433,39131:20442,39132:20432,39133:20452,39134:20453,39135:20506,39136:20520,39137:20500,39138:20522,39139:20517,39140:20485,39141:20252,39142:20470,39143:20513,39144:20521,39145:20524,39146:20478,39147:20463,39148:20497,39149:20486,39150:20547,39151:20551,39152:26371,39153:20565,39154:20560,39155:20552,39156:20570,39157:20566,39158:20588,39159:20600,39160:20608,39161:20634,39162:20613,39163:20660,39164:20658,39232:20681,39233:20682,39234:20659,39235:20674,39236:20694,39237:20702,39238:20709,39239:20717,39240:20707,39241:20718,39242:20729,39243:20725,39244:20745,39245:20737,39246:20738,39247:20758,39248:20757,39249:20756,39250:20762,39251:20769,39252:20794,39253:20791,39254:20796,39255:20795,39256:20799,39257:20800,39258:20818,39259:20812,39260:20820,39261:20834,39262:31480,39263:20841,39264:20842,39265:20846,39266:20864,39267:20866,39268:22232,39269:20876,39270:20873,39271:20879,39272:20881,39273:20883,39274:20885,39275:20886,39276:20900,39277:20902,39278:20898,39279:20905,39280:20906,39281:20907,39282:20915,39283:20913,39284:20914,39285:20912,39286:20917,39287:20925,39288:20933,39289:20937,39290:20955,39291:20960,39292:34389,39293:20969,39294:20973,39296:20976,39297:20981,39298:20990,39299:20996,39300:21003,39301:21012,39302:21006,39303:21031,39304:21034,39305:21038,39306:21043,39307:21049,39308:21071,39309:21060,39310:21067,39311:21068,39312:21086,39313:21076,39314:21098,39315:21108,39316:21097,39317:21107,39318:21119,39319:21117,39320:21133,39321:21140,39322:21138,39323:21105,39324:21128,39325:21137,39326:36776,39327:36775,39328:21164,39329:21165,39330:21180,39331:21173,39332:21185,39333:21197,39334:21207,39335:21214,39336:21219,39337:21222,39338:39149,39339:21216,39340:21235,39341:21237,39342:21240,39343:21241,39344:21254,39345:21256,39346:30008,39347:21261,39348:21264,39349:21263,39350:21269,39351:21274,39352:21283,39353:21295,39354:21297,39355:21299,39356:21304,39357:21312,39358:21318,39359:21317,39360:19991,39361:21321,39362:21325,39363:20950,39364:21342,39365:21353,39366:21358,39367:22808,39368:21371,39369:21367,39370:21378,39371:21398,39372:21408,39373:21414,39374:21413,39375:21422,39376:21424,39377:21430,39378:21443,39379:31762,39380:38617,39381:21471,39382:26364,39383:29166,39384:21486,39385:21480,39386:21485,39387:21498,39388:21505,39389:21565,39390:21568,39391:21548,39392:21549,39393:21564,39394:21550,39395:21558,39396:21545,39397:21533,39398:21582,39399:21647,39400:21621,39401:21646,39402:21599,39403:21617,39404:21623,39405:21616,39406:21650,39407:21627,39408:21632,39409:21622,39410:21636,39411:21648,39412:21638,39413:21703,39414:21666,39415:21688,39416:21669,39417:21676,39418:21700,39419:21704,39420:21672,39488:21675,39489:21698,39490:21668,39491:21694,39492:21692,39493:21720,39494:21733,39495:21734,39496:21775,39497:21780,39498:21757,39499:21742,39500:21741,39501:21754,39502:21730,39503:21817,39504:21824,39505:21859,39506:21836,39507:21806,39508:21852,39509:21829,39510:21846,39511:21847,39512:21816,39513:21811,39514:21853,39515:21913,39516:21888,39517:21679,39518:21898,39519:21919,39520:21883,39521:21886,39522:21912,39523:21918,39524:21934,39525:21884,39526:21891,39527:21929,39528:21895,39529:21928,39530:21978,39531:21957,39532:21983,39533:21956,39534:21980,39535:21988,39536:21972,39537:22036,39538:22007,39539:22038,39540:22014,39541:22013,39542:22043,39543:22009,39544:22094,39545:22096,39546:29151,39547:22068,39548:22070,39549:22066,39550:22072,39552:22123,39553:22116,39554:22063,39555:22124,39556:22122,39557:22150,39558:22144,39559:22154,39560:22176,39561:22164,39562:22159,39563:22181,39564:22190,39565:22198,39566:22196,39567:22210,39568:22204,39569:22209,39570:22211,39571:22208,39572:22216,39573:22222,39574:22225,39575:22227,39576:22231,39577:22254,39578:22265,39579:22272,39580:22271,39581:22276,39582:22281,39583:22280,39584:22283,39585:22285,39586:22291,39587:22296,39588:22294,39589:21959,39590:22300,39591:22310,39592:22327,39593:22328,39594:22350,39595:22331,39596:22336,39597:22351,39598:22377,39599:22464,39600:22408,39601:22369,39602:22399,39603:22409,39604:22419,39605:22432,39606:22451,39607:22436,39608:22442,39609:22448,39610:22467,39611:22470,39612:22484,39613:22482,39614:22483,39615:22538,39616:22486,39617:22499,39618:22539,39619:22553,39620:22557,39621:22642,39622:22561,39623:22626,39624:22603,39625:22640,39626:27584,39627:22610,39628:22589,39629:22649,39630:22661,39631:22713,39632:22687,39633:22699,39634:22714,39635:22750,39636:22715,39637:22712,39638:22702,39639:22725,39640:22739,39641:22737,39642:22743,39643:22745,39644:22744,39645:22757,39646:22748,39647:22756,39648:22751,39649:22767,39650:22778,39651:22777,39652:22779,39653:22780,39654:22781,39655:22786,39656:22794,39657:22800,39658:22811,39659:26790,39660:22821,39661:22828,39662:22829,39663:22834,39664:22840,39665:22846,39666:31442,39667:22869,39668:22864,39669:22862,39670:22874,39671:22872,39672:22882,39673:22880,39674:22887,39675:22892,39676:22889,39744:22904,39745:22913,39746:22941,39747:20318,39748:20395,39749:22947,39750:22962,39751:22982,39752:23016,39753:23004,39754:22925,39755:23001,39756:23002,39757:23077,39758:23071,39759:23057,39760:23068,39761:23049,39762:23066,39763:23104,39764:23148,39765:23113,39766:23093,39767:23094,39768:23138,39769:23146,39770:23194,39771:23228,39772:23230,39773:23243,39774:23234,39775:23229,39776:23267,39777:23255,39778:23270,39779:23273,39780:23254,39781:23290,39782:23291,39783:23308,39784:23307,39785:23318,39786:23346,39787:23248,39788:23338,39789:23350,39790:23358,39791:23363,39792:23365,39793:23360,39794:23377,39795:23381,39796:23386,39797:23387,39798:23397,39799:23401,39800:23408,39801:23411,39802:23413,39803:23416,39804:25992,39805:23418,39806:23424,39808:23427,39809:23462,39810:23480,39811:23491,39812:23495,39813:23497,39814:23508,39815:23504,39816:23524,39817:23526,39818:23522,39819:23518,39820:23525,39821:23531,39822:23536,39823:23542,39824:23539,39825:23557,39826:23559,39827:23560,39828:23565,39829:23571,39830:23584,39831:23586,39832:23592,39833:23608,39834:23609,39835:23617,39836:23622,39837:23630,39838:23635,39839:23632,39840:23631,39841:23409,39842:23660,39843:23662,39844:20066,39845:23670,39846:23673,39847:23692,39848:23697,39849:23700,39850:22939,39851:23723,39852:23739,39853:23734,39854:23740,39855:23735,39856:23749,39857:23742,39858:23751,39859:23769,39860:23785,39861:23805,39862:23802,39863:23789,39864:23948,39865:23786,39866:23819,39867:23829,39868:23831,39869:23900,39870:23839,39871:23835,39872:23825,39873:23828,39874:23842,39875:23834,39876:23833,39877:23832,39878:23884,39879:23890,39880:23886,39881:23883,39882:23916,39883:23923,39884:23926,39885:23943,39886:23940,39887:23938,39888:23970,39889:23965,39890:23980,39891:23982,39892:23997,39893:23952,39894:23991,39895:23996,39896:24009,39897:24013,39898:24019,39899:24018,39900:24022,39901:24027,39902:24043,39903:24050,39904:24053,39905:24075,39906:24090,39907:24089,39908:24081,39909:24091,39910:24118,39911:24119,39912:24132,39913:24131,39914:24128,39915:24142,39916:24151,39917:24148,39918:24159,39919:24162,39920:24164,39921:24135,39922:24181,39923:24182,39924:24186,39925:40636,39926:24191,39927:24224,39928:24257,39929:24258,39930:24264,39931:24272,39932:24271,4e4:24278,40001:24291,40002:24285,40003:24282,40004:24283,40005:24290,40006:24289,40007:24296,40008:24297,40009:24300,40010:24305,40011:24307,40012:24304,40013:24308,40014:24312,40015:24318,40016:24323,40017:24329,40018:24413,40019:24412,40020:24331,40021:24337,40022:24342,40023:24361,40024:24365,40025:24376,40026:24385,40027:24392,40028:24396,40029:24398,40030:24367,40031:24401,40032:24406,40033:24407,40034:24409,40035:24417,40036:24429,40037:24435,40038:24439,40039:24451,40040:24450,40041:24447,40042:24458,40043:24456,40044:24465,40045:24455,40046:24478,40047:24473,40048:24472,40049:24480,40050:24488,40051:24493,40052:24508,40053:24534,40054:24571,40055:24548,40056:24568,40057:24561,40058:24541,40059:24755,40060:24575,40061:24609,40062:24672,40064:24601,40065:24592,40066:24617,40067:24590,40068:24625,40069:24603,40070:24597,40071:24619,40072:24614,40073:24591,40074:24634,40075:24666,40076:24641,40077:24682,40078:24695,40079:24671,40080:24650,40081:24646,40082:24653,40083:24675,40084:24643,40085:24676,40086:24642,40087:24684,40088:24683,40089:24665,40090:24705,40091:24717,40092:24807,40093:24707,40094:24730,40095:24708,40096:24731,40097:24726,40098:24727,40099:24722,40100:24743,40101:24715,40102:24801,40103:24760,40104:24800,40105:24787,40106:24756,40107:24560,40108:24765,40109:24774,40110:24757,40111:24792,40112:24909,40113:24853,40114:24838,40115:24822,40116:24823,40117:24832,40118:24820,40119:24826,40120:24835,40121:24865,40122:24827,40123:24817,40124:24845,40125:24846,40126:24903,40127:24894,40128:24872,40129:24871,40130:24906,40131:24895,40132:24892,40133:24876,40134:24884,40135:24893,40136:24898,40137:24900,40138:24947,40139:24951,40140:24920,40141:24921,40142:24922,40143:24939,40144:24948,40145:24943,40146:24933,40147:24945,40148:24927,40149:24925,40150:24915,40151:24949,40152:24985,40153:24982,40154:24967,40155:25004,40156:24980,40157:24986,40158:24970,40159:24977,40160:25003,40161:25006,40162:25036,40163:25034,40164:25033,40165:25079,40166:25032,40167:25027,40168:25030,40169:25018,40170:25035,40171:32633,40172:25037,40173:25062,40174:25059,40175:25078,40176:25082,40177:25076,40178:25087,40179:25085,40180:25084,40181:25086,40182:25088,40183:25096,40184:25097,40185:25101,40186:25100,40187:25108,40188:25115,40256:25118,40257:25121,40258:25130,40259:25134,40260:25136,40261:25138,40262:25139,40263:25153,40264:25166,40265:25182,40266:25187,40267:25179,40268:25184,40269:25192,40270:25212,40271:25218,40272:25225,40273:25214,40274:25234,40275:25235,40276:25238,40277:25300,40278:25219,40279:25236,40280:25303,40281:25297,40282:25275,40283:25295,40284:25343,40285:25286,40286:25812,40287:25288,40288:25308,40289:25292,40290:25290,40291:25282,40292:25287,40293:25243,40294:25289,40295:25356,40296:25326,40297:25329,40298:25383,40299:25346,40300:25352,40301:25327,40302:25333,40303:25424,40304:25406,40305:25421,40306:25628,40307:25423,40308:25494,40309:25486,40310:25472,40311:25515,40312:25462,40313:25507,40314:25487,40315:25481,40316:25503,40317:25525,40318:25451,40320:25449,40321:25534,40322:25577,40323:25536,40324:25542,40325:25571,40326:25545,40327:25554,40328:25590,40329:25540,40330:25622,40331:25652,40332:25606,40333:25619,40334:25638,40335:25654,40336:25885,40337:25623,40338:25640,40339:25615,40340:25703,40341:25711,40342:25718,40343:25678,40344:25898,40345:25749,40346:25747,40347:25765,40348:25769,40349:25736,40350:25788,40351:25818,40352:25810,40353:25797,40354:25799,40355:25787,40356:25816,40357:25794,40358:25841,40359:25831,40360:33289,40361:25824,40362:25825,40363:25260,40364:25827,40365:25839,40366:25900,40367:25846,40368:25844,40369:25842,40370:25850,40371:25856,40372:25853,40373:25880,40374:25884,40375:25861,40376:25892,40377:25891,40378:25899,40379:25908,40380:25909,40381:25911,40382:25910,40383:25912,40384:30027,40385:25928,40386:25942,40387:25941,40388:25933,40389:25944,40390:25950,40391:25949,40392:25970,40393:25976,40394:25986,40395:25987,40396:35722,40397:26011,40398:26015,40399:26027,40400:26039,40401:26051,40402:26054,40403:26049,40404:26052,40405:26060,40406:26066,40407:26075,40408:26073,40409:26080,40410:26081,40411:26097,40412:26482,40413:26122,40414:26115,40415:26107,40416:26483,40417:26165,40418:26166,40419:26164,40420:26140,40421:26191,40422:26180,40423:26185,40424:26177,40425:26206,40426:26205,40427:26212,40428:26215,40429:26216,40430:26207,40431:26210,40432:26224,40433:26243,40434:26248,40435:26254,40436:26249,40437:26244,40438:26264,40439:26269,40440:26305,40441:26297,40442:26313,40443:26302,40444:26300,40512:26308,40513:26296,40514:26326,40515:26330,40516:26336,40517:26175,40518:26342,40519:26345,40520:26352,40521:26357,40522:26359,40523:26383,40524:26390,40525:26398,40526:26406,40527:26407,40528:38712,40529:26414,40530:26431,40531:26422,40532:26433,40533:26424,40534:26423,40535:26438,40536:26462,40537:26464,40538:26457,40539:26467,40540:26468,40541:26505,40542:26480,40543:26537,40544:26492,40545:26474,40546:26508,40547:26507,40548:26534,40549:26529,40550:26501,40551:26551,40552:26607,40553:26548,40554:26604,40555:26547,40556:26601,40557:26552,40558:26596,40559:26590,40560:26589,40561:26594,40562:26606,40563:26553,40564:26574,40565:26566,40566:26599,40567:27292,40568:26654,40569:26694,40570:26665,40571:26688,40572:26701,40573:26674,40574:26702,40576:26803,40577:26667,40578:26713,40579:26723,40580:26743,40581:26751,40582:26783,40583:26767,40584:26797,40585:26772,40586:26781,40587:26779,40588:26755,40589:27310,40590:26809,40591:26740,40592:26805,40593:26784,40594:26810,40595:26895,40596:26765,40597:26750,40598:26881,40599:26826,40600:26888,40601:26840,40602:26914,40603:26918,40604:26849,40605:26892,40606:26829,40607:26836,40608:26855,40609:26837,40610:26934,40611:26898,40612:26884,40613:26839,40614:26851,40615:26917,40616:26873,40617:26848,40618:26863,40619:26920,40620:26922,40621:26906,40622:26915,40623:26913,40624:26822,40625:27001,40626:26999,40627:26972,40628:27e3,40629:26987,40630:26964,40631:27006,40632:26990,40633:26937,40634:26996,40635:26941,40636:26969,40637:26928,40638:26977,40639:26974,40640:26973,40641:27009,40642:26986,40643:27058,40644:27054,40645:27088,40646:27071,40647:27073,40648:27091,40649:27070,40650:27086,40651:23528,40652:27082,40653:27101,40654:27067,40655:27075,40656:27047,40657:27182,40658:27025,40659:27040,40660:27036,40661:27029,40662:27060,40663:27102,40664:27112,40665:27138,40666:27163,40667:27135,40668:27402,40669:27129,40670:27122,40671:27111,40672:27141,40673:27057,40674:27166,40675:27117,40676:27156,40677:27115,40678:27146,40679:27154,40680:27329,40681:27171,40682:27155,40683:27204,40684:27148,40685:27250,40686:27190,40687:27256,40688:27207,40689:27234,40690:27225,40691:27238,40692:27208,40693:27192,40694:27170,40695:27280,40696:27277,40697:27296,40698:27268,40699:27298,40700:27299,40768:27287,40769:34327,40770:27323,40771:27331,40772:27330,40773:27320,40774:27315,40775:27308,40776:27358,40777:27345,40778:27359,40779:27306,40780:27354,40781:27370,40782:27387,40783:27397,40784:34326,40785:27386,40786:27410,40787:27414,40788:39729,40789:27423,40790:27448,40791:27447,40792:30428,40793:27449,40794:39150,40795:27463,40796:27459,40797:27465,40798:27472,40799:27481,40800:27476,40801:27483,40802:27487,40803:27489,40804:27512,40805:27513,40806:27519,40807:27520,40808:27524,40809:27523,40810:27533,40811:27544,40812:27541,40813:27550,40814:27556,40815:27562,40816:27563,40817:27567,40818:27570,40819:27569,40820:27571,40821:27575,40822:27580,40823:27590,40824:27595,40825:27603,40826:27615,40827:27628,40828:27627,40829:27635,40830:27631,40832:40638,40833:27656,40834:27667,40835:27668,40836:27675,40837:27684,40838:27683,40839:27742,40840:27733,40841:27746,40842:27754,40843:27778,40844:27789,40845:27802,40846:27777,40847:27803,40848:27774,40849:27752,40850:27763,40851:27794,40852:27792,40853:27844,40854:27889,40855:27859,40856:27837,40857:27863,40858:27845,40859:27869,40860:27822,40861:27825,40862:27838,40863:27834,40864:27867,40865:27887,40866:27865,40867:27882,40868:27935,40869:34893,40870:27958,40871:27947,40872:27965,40873:27960,40874:27929,40875:27957,40876:27955,40877:27922,40878:27916,40879:28003,40880:28051,40881:28004,40882:27994,40883:28025,40884:27993,40885:28046,40886:28053,40887:28644,40888:28037,40889:28153,40890:28181,40891:28170,40892:28085,40893:28103,40894:28134,40895:28088,40896:28102,40897:28140,40898:28126,40899:28108,40900:28136,40901:28114,40902:28101,40903:28154,40904:28121,40905:28132,40906:28117,40907:28138,40908:28142,40909:28205,40910:28270,40911:28206,40912:28185,40913:28274,40914:28255,40915:28222,40916:28195,40917:28267,40918:28203,40919:28278,40920:28237,40921:28191,40922:28227,40923:28218,40924:28238,40925:28196,40926:28415,40927:28189,40928:28216,40929:28290,40930:28330,40931:28312,40932:28361,40933:28343,40934:28371,40935:28349,40936:28335,40937:28356,40938:28338,40939:28372,40940:28373,40941:28303,40942:28325,40943:28354,40944:28319,40945:28481,40946:28433,40947:28748,40948:28396,40949:28408,40950:28414,40951:28479,40952:28402,40953:28465,40954:28399,40955:28466,40956:28364,57408:28478,57409:28435,57410:28407,57411:28550,57412:28538,57413:28536,57414:28545,57415:28544,57416:28527,57417:28507,57418:28659,57419:28525,57420:28546,57421:28540,57422:28504,57423:28558,57424:28561,57425:28610,57426:28518,57427:28595,57428:28579,57429:28577,57430:28580,57431:28601,57432:28614,57433:28586,57434:28639,57435:28629,57436:28652,57437:28628,57438:28632,57439:28657,57440:28654,57441:28635,57442:28681,57443:28683,57444:28666,57445:28689,57446:28673,57447:28687,57448:28670,57449:28699,57450:28698,57451:28532,57452:28701,57453:28696,57454:28703,57455:28720,57456:28734,57457:28722,57458:28753,57459:28771,57460:28825,57461:28818,57462:28847,57463:28913,57464:28844,57465:28856,57466:28851,57467:28846,57468:28895,57469:28875,57470:28893,57472:28889,57473:28937,57474:28925,57475:28956,57476:28953,57477:29029,57478:29013,57479:29064,57480:29030,57481:29026,57482:29004,57483:29014,57484:29036,57485:29071,57486:29179,57487:29060,57488:29077,57489:29096,57490:29100,57491:29143,57492:29113,57493:29118,57494:29138,57495:29129,57496:29140,57497:29134,57498:29152,57499:29164,57500:29159,57501:29173,57502:29180,57503:29177,57504:29183,57505:29197,57506:29200,57507:29211,57508:29224,57509:29229,57510:29228,57511:29232,57512:29234,57513:29243,57514:29244,57515:29247,57516:29248,57517:29254,57518:29259,57519:29272,57520:29300,57521:29310,57522:29314,57523:29313,57524:29319,57525:29330,57526:29334,57527:29346,57528:29351,57529:29369,57530:29362,57531:29379,57532:29382,57533:29380,57534:29390,57535:29394,57536:29410,57537:29408,57538:29409,57539:29433,57540:29431,57541:20495,57542:29463,57543:29450,57544:29468,57545:29462,57546:29469,57547:29492,57548:29487,57549:29481,57550:29477,57551:29502,57552:29518,57553:29519,57554:40664,57555:29527,57556:29546,57557:29544,57558:29552,57559:29560,57560:29557,57561:29563,57562:29562,57563:29640,57564:29619,57565:29646,57566:29627,57567:29632,57568:29669,57569:29678,57570:29662,57571:29858,57572:29701,57573:29807,57574:29733,57575:29688,57576:29746,57577:29754,57578:29781,57579:29759,57580:29791,57581:29785,57582:29761,57583:29788,57584:29801,57585:29808,57586:29795,57587:29802,57588:29814,57589:29822,57590:29835,57591:29854,57592:29863,57593:29898,57594:29903,57595:29908,57596:29681,57664:29920,57665:29923,57666:29927,57667:29929,57668:29934,57669:29938,57670:29936,57671:29937,57672:29944,57673:29943,57674:29956,57675:29955,57676:29957,57677:29964,57678:29966,57679:29965,57680:29973,57681:29971,57682:29982,57683:29990,57684:29996,57685:30012,57686:30020,57687:30029,57688:30026,57689:30025,57690:30043,57691:30022,57692:30042,57693:30057,57694:30052,57695:30055,57696:30059,57697:30061,57698:30072,57699:30070,57700:30086,57701:30087,57702:30068,57703:30090,57704:30089,57705:30082,57706:30100,57707:30106,57708:30109,57709:30117,57710:30115,57711:30146,57712:30131,57713:30147,57714:30133,57715:30141,57716:30136,57717:30140,57718:30129,57719:30157,57720:30154,57721:30162,57722:30169,57723:30179,57724:30174,57725:30206,57726:30207,57728:30204,57729:30209,57730:30192,57731:30202,57732:30194,57733:30195,57734:30219,57735:30221,57736:30217,57737:30239,57738:30247,57739:30240,57740:30241,57741:30242,57742:30244,57743:30260,57744:30256,57745:30267,57746:30279,57747:30280,57748:30278,57749:30300,57750:30296,57751:30305,57752:30306,57753:30312,57754:30313,57755:30314,57756:30311,57757:30316,57758:30320,57759:30322,57760:30326,57761:30328,57762:30332,57763:30336,57764:30339,57765:30344,57766:30347,57767:30350,57768:30358,57769:30355,57770:30361,57771:30362,57772:30384,57773:30388,57774:30392,57775:30393,57776:30394,57777:30402,57778:30413,57779:30422,57780:30418,57781:30430,57782:30433,57783:30437,57784:30439,57785:30442,57786:34351,57787:30459,57788:30472,57789:30471,57790:30468,57791:30505,57792:30500,57793:30494,57794:30501,57795:30502,57796:30491,57797:30519,57798:30520,57799:30535,57800:30554,57801:30568,57802:30571,57803:30555,57804:30565,57805:30591,57806:30590,57807:30585,57808:30606,57809:30603,57810:30609,57811:30624,57812:30622,57813:30640,57814:30646,57815:30649,57816:30655,57817:30652,57818:30653,57819:30651,57820:30663,57821:30669,57822:30679,57823:30682,57824:30684,57825:30691,57826:30702,57827:30716,57828:30732,57829:30738,57830:31014,57831:30752,57832:31018,57833:30789,57834:30862,57835:30836,57836:30854,57837:30844,57838:30874,57839:30860,57840:30883,57841:30901,57842:30890,57843:30895,57844:30929,57845:30918,57846:30923,57847:30932,57848:30910,57849:30908,57850:30917,57851:30922,57852:30956,57920:30951,57921:30938,57922:30973,57923:30964,57924:30983,57925:30994,57926:30993,57927:31001,57928:31020,57929:31019,57930:31040,57931:31072,57932:31063,57933:31071,57934:31066,57935:31061,57936:31059,57937:31098,57938:31103,57939:31114,57940:31133,57941:31143,57942:40779,57943:31146,57944:31150,57945:31155,57946:31161,57947:31162,57948:31177,57949:31189,57950:31207,57951:31212,57952:31201,57953:31203,57954:31240,57955:31245,57956:31256,57957:31257,57958:31264,57959:31263,57960:31104,57961:31281,57962:31291,57963:31294,57964:31287,57965:31299,57966:31319,57967:31305,57968:31329,57969:31330,57970:31337,57971:40861,57972:31344,57973:31353,57974:31357,57975:31368,57976:31383,57977:31381,57978:31384,57979:31382,57980:31401,57981:31432,57982:31408,57984:31414,57985:31429,57986:31428,57987:31423,57988:36995,57989:31431,57990:31434,57991:31437,57992:31439,57993:31445,57994:31443,57995:31449,57996:31450,57997:31453,57998:31457,57999:31458,58e3:31462,58001:31469,58002:31472,58003:31490,58004:31503,58005:31498,58006:31494,58007:31539,58008:31512,58009:31513,58010:31518,58011:31541,58012:31528,58013:31542,58014:31568,58015:31610,58016:31492,58017:31565,58018:31499,58019:31564,58020:31557,58021:31605,58022:31589,58023:31604,58024:31591,58025:31600,58026:31601,58027:31596,58028:31598,58029:31645,58030:31640,58031:31647,58032:31629,58033:31644,58034:31642,58035:31627,58036:31634,58037:31631,58038:31581,58039:31641,58040:31691,58041:31681,58042:31692,58043:31695,58044:31668,58045:31686,58046:31709,58047:31721,58048:31761,58049:31764,58050:31718,58051:31717,58052:31840,58053:31744,58054:31751,58055:31763,58056:31731,58057:31735,58058:31767,58059:31757,58060:31734,58061:31779,58062:31783,58063:31786,58064:31775,58065:31799,58066:31787,58067:31805,58068:31820,58069:31811,58070:31828,58071:31823,58072:31808,58073:31824,58074:31832,58075:31839,58076:31844,58077:31830,58078:31845,58079:31852,58080:31861,58081:31875,58082:31888,58083:31908,58084:31917,58085:31906,58086:31915,58087:31905,58088:31912,58089:31923,58090:31922,58091:31921,58092:31918,58093:31929,58094:31933,58095:31936,58096:31941,58097:31938,58098:31960,58099:31954,58100:31964,58101:31970,58102:39739,58103:31983,58104:31986,58105:31988,58106:31990,58107:31994,58108:32006,58176:32002,58177:32028,58178:32021,58179:32010,58180:32069,58181:32075,58182:32046,58183:32050,58184:32063,58185:32053,58186:32070,58187:32115,58188:32086,58189:32078,58190:32114,58191:32104,58192:32110,58193:32079,58194:32099,58195:32147,58196:32137,58197:32091,58198:32143,58199:32125,58200:32155,58201:32186,58202:32174,58203:32163,58204:32181,58205:32199,58206:32189,58207:32171,58208:32317,58209:32162,58210:32175,58211:32220,58212:32184,58213:32159,58214:32176,58215:32216,58216:32221,58217:32228,58218:32222,58219:32251,58220:32242,58221:32225,58222:32261,58223:32266,58224:32291,58225:32289,58226:32274,58227:32305,58228:32287,58229:32265,58230:32267,58231:32290,58232:32326,58233:32358,58234:32315,58235:32309,58236:32313,58237:32323,58238:32311,58240:32306,58241:32314,58242:32359,58243:32349,58244:32342,58245:32350,58246:32345,58247:32346,58248:32377,58249:32362,58250:32361,58251:32380,58252:32379,58253:32387,58254:32213,58255:32381,58256:36782,58257:32383,58258:32392,58259:32393,58260:32396,58261:32402,58262:32400,58263:32403,58264:32404,58265:32406,58266:32398,58267:32411,58268:32412,58269:32568,58270:32570,58271:32581,58272:32588,58273:32589,58274:32590,58275:32592,58276:32593,58277:32597,58278:32596,58279:32600,58280:32607,58281:32608,58282:32616,58283:32617,58284:32615,58285:32632,58286:32642,58287:32646,58288:32643,58289:32648,58290:32647,58291:32652,58292:32660,58293:32670,58294:32669,58295:32666,58296:32675,58297:32687,58298:32690,58299:32697,58300:32686,58301:32694,58302:32696,58303:35697,58304:32709,58305:32710,58306:32714,58307:32725,58308:32724,58309:32737,58310:32742,58311:32745,58312:32755,58313:32761,58314:39132,58315:32774,58316:32772,58317:32779,58318:32786,58319:32792,58320:32793,58321:32796,58322:32801,58323:32808,58324:32831,58325:32827,58326:32842,58327:32838,58328:32850,58329:32856,58330:32858,58331:32863,58332:32866,58333:32872,58334:32883,58335:32882,58336:32880,58337:32886,58338:32889,58339:32893,58340:32895,58341:32900,58342:32902,58343:32901,58344:32923,58345:32915,58346:32922,58347:32941,58348:20880,58349:32940,58350:32987,58351:32997,58352:32985,58353:32989,58354:32964,58355:32986,58356:32982,58357:33033,58358:33007,58359:33009,58360:33051,58361:33065,58362:33059,58363:33071,58364:33099,58432:38539,58433:33094,58434:33086,58435:33107,58436:33105,58437:33020,58438:33137,58439:33134,58440:33125,58441:33126,58442:33140,58443:33155,58444:33160,58445:33162,58446:33152,58447:33154,58448:33184,58449:33173,58450:33188,58451:33187,58452:33119,58453:33171,58454:33193,58455:33200,58456:33205,58457:33214,58458:33208,58459:33213,58460:33216,58461:33218,58462:33210,58463:33225,58464:33229,58465:33233,58466:33241,58467:33240,58468:33224,58469:33242,58470:33247,58471:33248,58472:33255,58473:33274,58474:33275,58475:33278,58476:33281,58477:33282,58478:33285,58479:33287,58480:33290,58481:33293,58482:33296,58483:33302,58484:33321,58485:33323,58486:33336,58487:33331,58488:33344,58489:33369,58490:33368,58491:33373,58492:33370,58493:33375,58494:33380,58496:33378,58497:33384,58498:33386,58499:33387,58500:33326,58501:33393,58502:33399,58503:33400,58504:33406,58505:33421,58506:33426,58507:33451,58508:33439,58509:33467,58510:33452,58511:33505,58512:33507,58513:33503,58514:33490,58515:33524,58516:33523,58517:33530,58518:33683,58519:33539,58520:33531,58521:33529,58522:33502,58523:33542,58524:33500,58525:33545,58526:33497,58527:33589,58528:33588,58529:33558,58530:33586,58531:33585,58532:33600,58533:33593,58534:33616,58535:33605,58536:33583,58537:33579,58538:33559,58539:33560,58540:33669,58541:33690,58542:33706,58543:33695,58544:33698,58545:33686,58546:33571,58547:33678,58548:33671,58549:33674,58550:33660,58551:33717,58552:33651,58553:33653,58554:33696,58555:33673,58556:33704,58557:33780,58558:33811,58559:33771,58560:33742,58561:33789,58562:33795,58563:33752,58564:33803,58565:33729,58566:33783,58567:33799,58568:33760,58569:33778,58570:33805,58571:33826,58572:33824,58573:33725,58574:33848,58575:34054,58576:33787,58577:33901,58578:33834,58579:33852,58580:34138,58581:33924,58582:33911,58583:33899,58584:33965,58585:33902,58586:33922,58587:33897,58588:33862,58589:33836,58590:33903,58591:33913,58592:33845,58593:33994,58594:33890,58595:33977,58596:33983,58597:33951,58598:34009,58599:33997,58600:33979,58601:34010,58602:34e3,58603:33985,58604:33990,58605:34006,58606:33953,58607:34081,58608:34047,58609:34036,58610:34071,58611:34072,58612:34092,58613:34079,58614:34069,58615:34068,58616:34044,58617:34112,58618:34147,58619:34136,58620:34120,58688:34113,58689:34306,58690:34123,58691:34133,58692:34176,58693:34212,58694:34184,58695:34193,58696:34186,58697:34216,58698:34157,58699:34196,58700:34203,58701:34282,58702:34183,58703:34204,58704:34167,58705:34174,58706:34192,58707:34249,58708:34234,58709:34255,58710:34233,58711:34256,58712:34261,58713:34269,58714:34277,58715:34268,58716:34297,58717:34314,58718:34323,58719:34315,58720:34302,58721:34298,58722:34310,58723:34338,58724:34330,58725:34352,58726:34367,58727:34381,58728:20053,58729:34388,58730:34399,58731:34407,58732:34417,58733:34451,58734:34467,58735:34473,58736:34474,58737:34443,58738:34444,58739:34486,58740:34479,58741:34500,58742:34502,58743:34480,58744:34505,58745:34851,58746:34475,58747:34516,58748:34526,58749:34537,58750:34540,58752:34527,58753:34523,58754:34543,58755:34578,58756:34566,58757:34568,58758:34560,58759:34563,58760:34555,58761:34577,58762:34569,58763:34573,58764:34553,58765:34570,58766:34612,58767:34623,58768:34615,58769:34619,58770:34597,58771:34601,58772:34586,58773:34656,58774:34655,58775:34680,58776:34636,58777:34638,58778:34676,58779:34647,58780:34664,58781:34670,58782:34649,58783:34643,58784:34659,58785:34666,58786:34821,58787:34722,58788:34719,58789:34690,58790:34735,58791:34763,58792:34749,58793:34752,58794:34768,58795:38614,58796:34731,58797:34756,58798:34739,58799:34759,58800:34758,58801:34747,58802:34799,58803:34802,58804:34784,58805:34831,58806:34829,58807:34814,58808:34806,58809:34807,58810:34830,58811:34770,58812:34833,58813:34838,58814:34837,58815:34850,58816:34849,58817:34865,58818:34870,58819:34873,58820:34855,58821:34875,58822:34884,58823:34882,58824:34898,58825:34905,58826:34910,58827:34914,58828:34923,58829:34945,58830:34942,58831:34974,58832:34933,58833:34941,58834:34997,58835:34930,58836:34946,58837:34967,58838:34962,58839:34990,58840:34969,58841:34978,58842:34957,58843:34980,58844:34992,58845:35007,58846:34993,58847:35011,58848:35012,58849:35028,58850:35032,58851:35033,58852:35037,58853:35065,58854:35074,58855:35068,58856:35060,58857:35048,58858:35058,58859:35076,58860:35084,58861:35082,58862:35091,58863:35139,58864:35102,58865:35109,58866:35114,58867:35115,58868:35137,58869:35140,58870:35131,58871:35126,58872:35128,58873:35148,58874:35101,58875:35168,58876:35166,58944:35174,58945:35172,58946:35181,58947:35178,58948:35183,58949:35188,58950:35191,58951:35198,58952:35203,58953:35208,58954:35210,58955:35219,58956:35224,58957:35233,58958:35241,58959:35238,58960:35244,58961:35247,58962:35250,58963:35258,58964:35261,58965:35263,58966:35264,58967:35290,58968:35292,58969:35293,58970:35303,58971:35316,58972:35320,58973:35331,58974:35350,58975:35344,58976:35340,58977:35355,58978:35357,58979:35365,58980:35382,58981:35393,58982:35419,58983:35410,58984:35398,58985:35400,58986:35452,58987:35437,58988:35436,58989:35426,58990:35461,58991:35458,58992:35460,58993:35496,58994:35489,58995:35473,58996:35493,58997:35494,58998:35482,58999:35491,59e3:35524,59001:35533,59002:35522,59003:35546,59004:35563,59005:35571,59006:35559,59008:35556,59009:35569,59010:35604,59011:35552,59012:35554,59013:35575,59014:35550,59015:35547,59016:35596,59017:35591,59018:35610,59019:35553,59020:35606,59021:35600,59022:35607,59023:35616,59024:35635,59025:38827,59026:35622,59027:35627,59028:35646,59029:35624,59030:35649,59031:35660,59032:35663,59033:35662,59034:35657,59035:35670,59036:35675,59037:35674,59038:35691,59039:35679,59040:35692,59041:35695,59042:35700,59043:35709,59044:35712,59045:35724,59046:35726,59047:35730,59048:35731,59049:35734,59050:35737,59051:35738,59052:35898,59053:35905,59054:35903,59055:35912,59056:35916,59057:35918,59058:35920,59059:35925,59060:35938,59061:35948,59062:35960,59063:35962,59064:35970,59065:35977,59066:35973,59067:35978,59068:35981,59069:35982,59070:35988,59071:35964,59072:35992,59073:25117,59074:36013,59075:36010,59076:36029,59077:36018,59078:36019,59079:36014,59080:36022,59081:36040,59082:36033,59083:36068,59084:36067,59085:36058,59086:36093,59087:36090,59088:36091,59089:36100,59090:36101,59091:36106,59092:36103,59093:36111,59094:36109,59095:36112,59096:40782,59097:36115,59098:36045,59099:36116,59100:36118,59101:36199,59102:36205,59103:36209,59104:36211,59105:36225,59106:36249,59107:36290,59108:36286,59109:36282,59110:36303,59111:36314,59112:36310,59113:36300,59114:36315,59115:36299,59116:36330,59117:36331,59118:36319,59119:36323,59120:36348,59121:36360,59122:36361,59123:36351,59124:36381,59125:36382,59126:36368,59127:36383,59128:36418,59129:36405,59130:36400,59131:36404,59132:36426,59200:36423,59201:36425,59202:36428,59203:36432,59204:36424,59205:36441,59206:36452,59207:36448,59208:36394,59209:36451,59210:36437,59211:36470,59212:36466,59213:36476,59214:36481,59215:36487,59216:36485,59217:36484,59218:36491,59219:36490,59220:36499,59221:36497,59222:36500,59223:36505,59224:36522,59225:36513,59226:36524,59227:36528,59228:36550,59229:36529,59230:36542,59231:36549,59232:36552,59233:36555,59234:36571,59235:36579,59236:36604,59237:36603,59238:36587,59239:36606,59240:36618,59241:36613,59242:36629,59243:36626,59244:36633,59245:36627,59246:36636,59247:36639,59248:36635,59249:36620,59250:36646,59251:36659,59252:36667,59253:36665,59254:36677,59255:36674,59256:36670,59257:36684,59258:36681,59259:36678,59260:36686,59261:36695,59262:36700,59264:36706,59265:36707,59266:36708,59267:36764,59268:36767,59269:36771,59270:36781,59271:36783,59272:36791,59273:36826,59274:36837,59275:36834,59276:36842,59277:36847,59278:36999,59279:36852,59280:36869,59281:36857,59282:36858,59283:36881,59284:36885,59285:36897,59286:36877,59287:36894,59288:36886,59289:36875,59290:36903,59291:36918,59292:36917,59293:36921,59294:36856,59295:36943,59296:36944,59297:36945,59298:36946,59299:36878,59300:36937,59301:36926,59302:36950,59303:36952,59304:36958,59305:36968,59306:36975,59307:36982,59308:38568,59309:36978,59310:36994,59311:36989,59312:36993,59313:36992,59314:37002,59315:37001,59316:37007,59317:37032,59318:37039,59319:37041,59320:37045,59321:37090,59322:37092,59323:25160,59324:37083,59325:37122,59326:37138,59327:37145,59328:37170,59329:37168,59330:37194,59331:37206,59332:37208,59333:37219,59334:37221,59335:37225,59336:37235,59337:37234,59338:37259,59339:37257,59340:37250,59341:37282,59342:37291,59343:37295,59344:37290,59345:37301,59346:37300,59347:37306,59348:37312,59349:37313,59350:37321,59351:37323,59352:37328,59353:37334,59354:37343,59355:37345,59356:37339,59357:37372,59358:37365,59359:37366,59360:37406,59361:37375,59362:37396,59363:37420,59364:37397,59365:37393,59366:37470,59367:37463,59368:37445,59369:37449,59370:37476,59371:37448,59372:37525,59373:37439,59374:37451,59375:37456,59376:37532,59377:37526,59378:37523,59379:37531,59380:37466,59381:37583,59382:37561,59383:37559,59384:37609,59385:37647,59386:37626,59387:37700,59388:37678,59456:37657,59457:37666,59458:37658,59459:37667,59460:37690,59461:37685,59462:37691,59463:37724,59464:37728,59465:37756,59466:37742,59467:37718,59468:37808,59469:37804,59470:37805,59471:37780,59472:37817,59473:37846,59474:37847,59475:37864,59476:37861,59477:37848,59478:37827,59479:37853,59480:37840,59481:37832,59482:37860,59483:37914,59484:37908,59485:37907,59486:37891,59487:37895,59488:37904,59489:37942,59490:37931,59491:37941,59492:37921,59493:37946,59494:37953,59495:37970,59496:37956,59497:37979,59498:37984,59499:37986,59500:37982,59501:37994,59502:37417,59503:38e3,59504:38005,59505:38007,59506:38013,59507:37978,59508:38012,59509:38014,59510:38017,59511:38015,59512:38274,59513:38279,59514:38282,59515:38292,59516:38294,59517:38296,59518:38297,59520:38304,59521:38312,59522:38311,59523:38317,59524:38332,59525:38331,59526:38329,59527:38334,59528:38346,59529:28662,59530:38339,59531:38349,59532:38348,59533:38357,59534:38356,59535:38358,59536:38364,59537:38369,59538:38373,59539:38370,59540:38433,59541:38440,59542:38446,59543:38447,59544:38466,59545:38476,59546:38479,59547:38475,59548:38519,59549:38492,59550:38494,59551:38493,59552:38495,59553:38502,59554:38514,59555:38508,59556:38541,59557:38552,59558:38549,59559:38551,59560:38570,59561:38567,59562:38577,59563:38578,59564:38576,59565:38580,59566:38582,59567:38584,59568:38585,59569:38606,59570:38603,59571:38601,59572:38605,59573:35149,59574:38620,59575:38669,59576:38613,59577:38649,59578:38660,59579:38662,59580:38664,59581:38675,59582:38670,59583:38673,59584:38671,59585:38678,59586:38681,59587:38692,59588:38698,59589:38704,59590:38713,59591:38717,59592:38718,59593:38724,59594:38726,59595:38728,59596:38722,59597:38729,59598:38748,59599:38752,59600:38756,59601:38758,59602:38760,59603:21202,59604:38763,59605:38769,59606:38777,59607:38789,59608:38780,59609:38785,59610:38778,59611:38790,59612:38795,59613:38799,59614:38800,59615:38812,59616:38824,59617:38822,59618:38819,59619:38835,59620:38836,59621:38851,59622:38854,59623:38856,59624:38859,59625:38876,59626:38893,59627:40783,59628:38898,59629:31455,59630:38902,59631:38901,59632:38927,59633:38924,59634:38968,59635:38948,59636:38945,59637:38967,59638:38973,59639:38982,59640:38991,59641:38987,59642:39019,59643:39023,59644:39024,59712:39025,59713:39028,59714:39027,59715:39082,59716:39087,59717:39089,59718:39094,59719:39108,59720:39107,59721:39110,59722:39145,59723:39147,59724:39171,59725:39177,59726:39186,59727:39188,59728:39192,59729:39201,59730:39197,59731:39198,59732:39204,59733:39200,59734:39212,59735:39214,59736:39229,59737:39230,59738:39234,59739:39241,59740:39237,59741:39248,59742:39243,59743:39249,59744:39250,59745:39244,59746:39253,59747:39319,59748:39320,59749:39333,59750:39341,59751:39342,59752:39356,59753:39391,59754:39387,59755:39389,59756:39384,59757:39377,59758:39405,59759:39406,59760:39409,59761:39410,59762:39419,59763:39416,59764:39425,59765:39439,59766:39429,59767:39394,59768:39449,59769:39467,59770:39479,59771:39493,59772:39490,59773:39488,59774:39491,59776:39486,59777:39509,59778:39501,59779:39515,59780:39511,59781:39519,59782:39522,59783:39525,59784:39524,59785:39529,59786:39531,59787:39530,59788:39597,59789:39600,59790:39612,59791:39616,59792:39631,59793:39633,59794:39635,59795:39636,59796:39646,59797:39647,59798:39650,59799:39651,59800:39654,59801:39663,59802:39659,59803:39662,59804:39668,59805:39665,59806:39671,59807:39675,59808:39686,59809:39704,59810:39706,59811:39711,59812:39714,59813:39715,59814:39717,59815:39719,59816:39720,59817:39721,59818:39722,59819:39726,59820:39727,59821:39730,59822:39748,59823:39747,59824:39759,59825:39757,59826:39758,59827:39761,59828:39768,59829:39796,59830:39827,59831:39811,59832:39825,59833:39830,59834:39831,59835:39839,59836:39840,59837:39848,59838:39860,59839:39872,59840:39882,59841:39865,59842:39878,59843:39887,59844:39889,59845:39890,59846:39907,59847:39906,59848:39908,59849:39892,59850:39905,59851:39994,59852:39922,59853:39921,59854:39920,59855:39957,59856:39956,59857:39945,59858:39955,59859:39948,59860:39942,59861:39944,59862:39954,59863:39946,59864:39940,59865:39982,59866:39963,59867:39973,59868:39972,59869:39969,59870:39984,59871:40007,59872:39986,59873:40006,59874:39998,59875:40026,59876:40032,59877:40039,59878:40054,59879:40056,59880:40167,59881:40172,59882:40176,59883:40201,59884:40200,59885:40171,59886:40195,59887:40198,59888:40234,59889:40230,59890:40367,59891:40227,59892:40223,59893:40260,59894:40213,59895:40210,59896:40257,59897:40255,59898:40254,59899:40262,59900:40264,59968:40285,59969:40286,59970:40292,59971:40273,59972:40272,59973:40281,59974:40306,59975:40329,59976:40327,59977:40363,59978:40303,59979:40314,59980:40346,59981:40356,59982:40361,59983:40370,59984:40388,59985:40385,59986:40379,59987:40376,59988:40378,59989:40390,59990:40399,59991:40386,59992:40409,59993:40403,59994:40440,59995:40422,59996:40429,59997:40431,59998:40445,59999:40474,6e4:40475,60001:40478,60002:40565,60003:40569,60004:40573,60005:40577,60006:40584,60007:40587,60008:40588,60009:40594,60010:40597,60011:40593,60012:40605,60013:40613,60014:40617,60015:40632,60016:40618,60017:40621,60018:38753,60019:40652,60020:40654,60021:40655,60022:40656,60023:40660,60024:40668,60025:40670,60026:40669,60027:40672,60028:40677,60029:40680,60030:40687,60032:40692,60033:40694,60034:40695,60035:40697,60036:40699,60037:40700,60038:40701,60039:40711,60040:40712,60041:30391,60042:40725,60043:40737,60044:40748,60045:40766,60046:40778,60047:40786,60048:40788,60049:40803,60050:40799,60051:40800,60052:40801,60053:40806,60054:40807,60055:40812,60056:40810,60057:40823,60058:40818,60059:40822,60060:40853,60061:40860,60062:40864,60063:22575,60064:27079,60065:36953,60066:29796,60067:20956,60068:29081,60736:32394,60737:35100,60738:37704,60739:37512,60740:34012,60741:20425,60742:28859,60743:26161,60744:26824,60745:37625,60746:26363,60747:24389,60748:20008,60749:20193,60750:20220,60751:20224,60752:20227,60753:20281,60754:20310,60755:20370,60756:20362,60757:20378,60758:20372,60759:20429,60760:20544,60761:20514,60762:20479,60763:20510,60764:20550,60765:20592,60766:20546,60767:20628,60768:20724,60769:20696,60770:20810,60771:20836,60772:20893,60773:20926,60774:20972,60775:21013,60776:21148,60777:21158,60778:21184,60779:21211,60780:21248,60781:21255,60782:21284,60783:21362,60784:21395,60785:21426,60786:21469,60787:64014,60788:21660,60789:21642,60790:21673,60791:21759,60792:21894,60793:22361,60794:22373,60795:22444,60796:22472,60797:22471,60798:64015,60800:64016,60801:22686,60802:22706,60803:22795,60804:22867,60805:22875,60806:22877,60807:22883,60808:22948,60809:22970,60810:23382,60811:23488,60812:29999,60813:23512,60814:23532,60815:23582,60816:23718,60817:23738,60818:23797,60819:23847,60820:23891,60821:64017,60822:23874,60823:23917,60824:23992,60825:23993,60826:24016,60827:24353,60828:24372,60829:24423,60830:24503,60831:24542,60832:24669,60833:24709,60834:24714,60835:24798,60836:24789,60837:24864,60838:24818,60839:24849,60840:24887,60841:24880,60842:24984,60843:25107,60844:25254,60845:25589,60846:25696,60847:25757,60848:25806,60849:25934,60850:26112,60851:26133,60852:26171,60853:26121,60854:26158,60855:26142,60856:26148,60857:26213,60858:26199,60859:26201,60860:64018,60861:26227,60862:26265,60863:26272,60864:26290,60865:26303,60866:26362,60867:26382,60868:63785,60869:26470,60870:26555,60871:26706,60872:26560,60873:26625,60874:26692,60875:26831,60876:64019,60877:26984,60878:64020,60879:27032,60880:27106,60881:27184,60882:27243,60883:27206,60884:27251,60885:27262,60886:27362,60887:27364,60888:27606,60889:27711,60890:27740,60891:27782,60892:27759,60893:27866,60894:27908,60895:28039,60896:28015,60897:28054,60898:28076,60899:28111,60900:28152,60901:28146,60902:28156,60903:28217,60904:28252,60905:28199,60906:28220,60907:28351,60908:28552,60909:28597,60910:28661,60911:28677,60912:28679,60913:28712,60914:28805,60915:28843,60916:28943,60917:28932,60918:29020,60919:28998,60920:28999,60921:64021,60922:29121,60923:29182,60924:29361,60992:29374,60993:29476,60994:64022,60995:29559,60996:29629,60997:29641,60998:29654,60999:29667,61e3:29650,61001:29703,61002:29685,61003:29734,61004:29738,61005:29737,61006:29742,61007:29794,61008:29833,61009:29855,61010:29953,61011:30063,61012:30338,61013:30364,61014:30366,61015:30363,61016:30374,61017:64023,61018:30534,61019:21167,61020:30753,61021:30798,61022:30820,61023:30842,61024:31024,61025:64024,61026:64025,61027:64026,61028:31124,61029:64027,61030:31131,61031:31441,61032:31463,61033:64028,61034:31467,61035:31646,61036:64029,61037:32072,61038:32092,61039:32183,61040:32160,61041:32214,61042:32338,61043:32583,61044:32673,61045:64030,61046:33537,61047:33634,61048:33663,61049:33735,61050:33782,61051:33864,61052:33972,61053:34131,61054:34137,61056:34155,61057:64031,61058:34224,61059:64032,61060:64033,61061:34823,61062:35061,61063:35346,61064:35383,61065:35449,61066:35495,61067:35518,61068:35551,61069:64034,61070:35574,61071:35667,61072:35711,61073:36080,61074:36084,61075:36114,61076:36214,61077:64035,61078:36559,61079:64036,61080:64037,61081:36967,61082:37086,61083:64038,61084:37141,61085:37159,61086:37338,61087:37335,61088:37342,61089:37357,61090:37358,61091:37348,61092:37349,61093:37382,61094:37392,61095:37386,61096:37434,61097:37440,61098:37436,61099:37454,61100:37465,61101:37457,61102:37433,61103:37479,61104:37543,61105:37495,61106:37496,61107:37607,61108:37591,61109:37593,61110:37584,61111:64039,61112:37589,61113:37600,61114:37587,61115:37669,61116:37665,61117:37627,61118:64040,61119:37662,61120:37631,61121:37661,61122:37634,61123:37744,61124:37719,61125:37796,61126:37830,61127:37854,61128:37880,61129:37937,61130:37957,61131:37960,61132:38290,61133:63964,61134:64041,61135:38557,61136:38575,61137:38707,61138:38715,61139:38723,61140:38733,61141:38735,61142:38737,61143:38741,61144:38999,61145:39013,61146:64042,61147:64043,61148:39207,61149:64044,61150:39326,61151:39502,61152:39641,61153:39644,61154:39797,61155:39794,61156:39823,61157:39857,61158:39867,61159:39936,61160:40304,61161:40299,61162:64045,61163:40473,61164:40657,61167:8560,61168:8561,61169:8562,61170:8563,61171:8564,61172:8565,61173:8566,61174:8567,61175:8568,61176:8569,61177:65506,61178:65508,61179:65287,61180:65282,61504:57344,61505:57345,61506:57346,61507:57347,61508:57348,61509:57349,61510:57350,61511:57351,61512:57352,61513:57353,61514:57354,61515:57355,61516:57356,61517:57357,61518:57358,61519:57359,61520:57360,61521:57361,61522:57362,61523:57363,61524:57364,61525:57365,61526:57366,61527:57367,61528:57368,61529:57369,61530:57370,61531:57371,61532:57372,61533:57373,61534:57374,61535:57375,61536:57376,61537:57377,61538:57378,61539:57379,61540:57380,61541:57381,61542:57382,61543:57383,61544:57384,61545:57385,61546:57386,61547:57387,61548:57388,61549:57389,61550:57390,61551:57391,61552:57392,61553:57393,61554:57394,61555:57395,61556:57396,61557:57397,61558:57398,61559:57399,61560:57400,61561:57401,61562:57402,61563:57403,61564:57404,61565:57405,61566:57406,61568:57407,61569:57408,61570:57409,61571:57410,61572:57411,61573:57412,61574:57413,61575:57414,61576:57415,61577:57416,61578:57417,61579:57418,61580:57419,61581:57420,61582:57421,61583:57422,61584:57423,61585:57424,61586:57425,61587:57426,61588:57427,61589:57428,61590:57429,61591:57430,61592:57431,61593:57432,61594:57433,61595:57434,61596:57435,61597:57436,61598:57437,61599:57438,61600:57439,61601:57440,61602:57441,61603:57442,61604:57443,61605:57444,61606:57445,61607:57446,61608:57447,61609:57448,61610:57449,61611:57450,61612:57451,61613:57452,61614:57453,61615:57454,61616:57455,61617:57456,61618:57457,61619:57458,61620:57459,61621:57460,61622:57461,61623:57462,61624:57463,61625:57464,61626:57465,61627:57466,61628:57467,61629:57468,61630:57469,61631:57470,61632:57471,61633:57472,61634:57473,61635:57474,61636:57475,61637:57476,61638:57477,61639:57478,61640:57479,61641:57480,61642:57481,61643:57482,61644:57483,61645:57484,61646:57485,61647:57486,61648:57487,61649:57488,61650:57489,61651:57490,61652:57491,61653:57492,61654:57493,61655:57494,61656:57495,61657:57496,61658:57497,61659:57498,61660:57499,61661:57500,61662:57501,61663:57502,61664:57503,61665:57504,61666:57505,61667:57506,61668:57507,61669:57508,61670:57509,61671:57510,61672:57511,61673:57512,61674:57513,61675:57514,61676:57515,61677:57516,61678:57517,61679:57518,61680:57519,61681:57520,61682:57521,61683:57522,61684:57523,61685:57524,61686:57525,61687:57526,61688:57527,61689:57528,61690:57529,61691:57530,61692:57531,61760:57532,61761:57533,61762:57534,61763:57535,61764:57536,61765:57537,61766:57538,61767:57539,61768:57540,61769:57541,61770:57542,61771:57543,61772:57544,61773:57545,61774:57546,61775:57547,61776:57548,61777:57549,61778:57550,61779:57551,61780:57552,61781:57553,61782:57554,61783:57555,61784:57556,61785:57557,61786:57558,61787:57559,61788:57560,61789:57561,61790:57562,61791:57563,61792:57564,61793:57565,61794:57566,61795:57567,61796:57568,61797:57569,61798:57570,61799:57571,61800:57572,61801:57573,61802:57574,61803:57575,61804:57576,61805:57577,61806:57578,61807:57579,61808:57580,61809:57581,61810:57582,61811:57583,61812:57584,61813:57585,61814:57586,61815:57587,61816:57588,61817:57589,61818:57590,61819:57591,61820:57592,61821:57593,61822:57594,61824:57595,61825:57596,61826:57597,61827:57598,61828:57599,61829:57600,61830:57601,61831:57602,61832:57603,61833:57604,61834:57605,61835:57606,61836:57607,61837:57608,61838:57609,61839:57610,61840:57611,61841:57612,61842:57613,61843:57614,61844:57615,61845:57616,61846:57617,61847:57618,61848:57619,61849:57620,61850:57621,61851:57622,61852:57623,61853:57624,61854:57625,61855:57626,61856:57627,61857:57628,61858:57629,61859:57630,61860:57631,61861:57632,61862:57633,61863:57634,61864:57635,61865:57636,61866:57637,61867:57638,61868:57639,61869:57640,61870:57641,61871:57642,61872:57643,61873:57644,61874:57645,61875:57646,61876:57647,61877:57648,61878:57649,61879:57650,61880:57651,61881:57652,61882:57653,61883:57654,61884:57655,61885:57656,61886:57657,61887:57658,61888:57659,61889:57660,61890:57661,61891:57662,61892:57663,61893:57664,61894:57665,61895:57666,61896:57667,61897:57668,61898:57669,61899:57670,61900:57671,61901:57672,61902:57673,61903:57674,61904:57675,61905:57676,61906:57677,61907:57678,61908:57679,61909:57680,61910:57681,61911:57682,61912:57683,61913:57684,61914:57685,61915:57686,61916:57687,61917:57688,61918:57689,61919:57690,61920:57691,61921:57692,61922:57693,61923:57694,61924:57695,61925:57696,61926:57697,61927:57698,61928:57699,61929:57700,61930:57701,61931:57702,61932:57703,61933:57704,61934:57705,61935:57706,61936:57707,61937:57708,61938:57709,61939:57710,61940:57711,61941:57712,61942:57713,61943:57714,61944:57715,61945:57716,61946:57717,61947:57718,61948:57719,62016:57720,62017:57721,62018:57722,62019:57723,62020:57724,62021:57725,62022:57726,62023:57727,62024:57728,62025:57729,62026:57730,62027:57731,62028:57732,62029:57733,62030:57734,62031:57735,62032:57736,62033:57737,62034:57738,62035:57739,62036:57740,62037:57741,62038:57742,62039:57743,62040:57744,62041:57745,62042:57746,62043:57747,62044:57748,62045:57749,62046:57750,62047:57751,62048:57752,62049:57753,62050:57754,62051:57755,62052:57756,62053:57757,62054:57758,62055:57759,62056:57760,62057:57761,62058:57762,62059:57763,62060:57764,62061:57765,62062:57766,62063:57767,62064:57768,62065:57769,62066:57770,62067:57771,62068:57772,62069:57773,62070:57774,62071:57775,62072:57776,62073:57777,62074:57778,62075:57779,62076:57780,62077:57781,62078:57782,62080:57783,62081:57784,62082:57785,62083:57786,62084:57787,62085:57788,62086:57789,62087:57790,62088:57791,62089:57792,62090:57793,62091:57794,62092:57795,62093:57796,62094:57797,62095:57798,62096:57799,62097:57800,62098:57801,62099:57802,62100:57803,62101:57804,62102:57805,62103:57806,62104:57807,62105:57808,62106:57809,62107:57810,62108:57811,62109:57812,62110:57813,62111:57814,62112:57815,62113:57816,62114:57817,62115:57818,62116:57819,62117:57820,62118:57821,62119:57822,62120:57823,62121:57824,62122:57825,62123:57826,62124:57827,62125:57828,62126:57829,62127:57830,62128:57831,62129:57832,62130:57833,62131:57834,62132:57835,62133:57836,62134:57837,62135:57838,62136:57839,62137:57840,62138:57841,62139:57842,62140:57843,62141:57844,62142:57845,62143:57846,62144:57847,62145:57848,62146:57849,62147:57850,62148:57851,62149:57852,62150:57853,62151:57854,62152:57855,62153:57856,62154:57857,62155:57858,62156:57859,62157:57860,62158:57861,62159:57862,62160:57863,62161:57864,62162:57865,62163:57866,62164:57867,62165:57868,62166:57869,62167:57870,62168:57871,62169:57872,62170:57873,62171:57874,62172:57875,62173:57876,62174:57877,62175:57878,62176:57879,62177:57880,62178:57881,62179:57882,62180:57883,62181:57884,62182:57885,62183:57886,62184:57887,62185:57888,62186:57889,62187:57890,62188:57891,62189:57892,62190:57893,62191:57894,62192:57895,62193:57896,62194:57897,62195:57898,62196:57899,62197:57900,62198:57901,62199:57902,62200:57903,62201:57904,62202:57905,62203:57906,62204:57907,62272:57908,62273:57909,62274:57910,62275:57911,62276:57912,62277:57913,62278:57914,62279:57915,62280:57916,62281:57917,62282:57918,62283:57919,62284:57920,62285:57921,62286:57922,62287:57923,62288:57924,62289:57925,62290:57926,62291:57927,62292:57928,62293:57929,62294:57930,62295:57931,62296:57932,62297:57933,62298:57934,62299:57935,62300:57936,62301:57937,62302:57938,62303:57939,62304:57940,62305:57941,62306:57942,62307:57943,62308:57944,62309:57945,62310:57946,62311:57947,62312:57948,62313:57949,62314:57950,62315:57951,62316:57952,62317:57953,62318:57954,62319:57955,62320:57956,62321:57957,62322:57958,62323:57959,62324:57960,62325:57961,62326:57962,62327:57963,62328:57964,62329:57965,62330:57966,62331:57967,62332:57968,62333:57969,62334:57970,62336:57971,62337:57972,62338:57973,62339:57974,62340:57975,62341:57976,62342:57977,62343:57978,62344:57979,62345:57980,62346:57981,62347:57982,62348:57983,62349:57984,62350:57985,62351:57986,62352:57987,62353:57988,62354:57989,62355:57990,62356:57991,62357:57992,62358:57993,62359:57994,62360:57995,62361:57996,62362:57997,62363:57998,62364:57999,62365:58e3,62366:58001,62367:58002,62368:58003,62369:58004,62370:58005,62371:58006,62372:58007,62373:58008,62374:58009,62375:58010,62376:58011,62377:58012,62378:58013,62379:58014,62380:58015,62381:58016,62382:58017,62383:58018,62384:58019,62385:58020,62386:58021,62387:58022,62388:58023,62389:58024,62390:58025,62391:58026,62392:58027,62393:58028,62394:58029,62395:58030,62396:58031,62397:58032,62398:58033,62399:58034,62400:58035,62401:58036,62402:58037,62403:58038,62404:58039,62405:58040,62406:58041,62407:58042,62408:58043,62409:58044,62410:58045,62411:58046,62412:58047,62413:58048,62414:58049,62415:58050,62416:58051,62417:58052,62418:58053,62419:58054,62420:58055,62421:58056,62422:58057,62423:58058,62424:58059,62425:58060,62426:58061,62427:58062,62428:58063,62429:58064,62430:58065,62431:58066,62432:58067,62433:58068,62434:58069,62435:58070,62436:58071,62437:58072,62438:58073,62439:58074,62440:58075,62441:58076,62442:58077,62443:58078,62444:58079,62445:58080,62446:58081,62447:58082,62448:58083,62449:58084,62450:58085,62451:58086,62452:58087,62453:58088,62454:58089,62455:58090,62456:58091,62457:58092,62458:58093,62459:58094,62460:58095,62528:58096,62529:58097,62530:58098,62531:58099,62532:58100,62533:58101,62534:58102,62535:58103,62536:58104,62537:58105,62538:58106,62539:58107,62540:58108,62541:58109,62542:58110,62543:58111,62544:58112,62545:58113,62546:58114,62547:58115,62548:58116,62549:58117,62550:58118,62551:58119,62552:58120,62553:58121,62554:58122,62555:58123,62556:58124,62557:58125,62558:58126,62559:58127,62560:58128,62561:58129,62562:58130,62563:58131,62564:58132,62565:58133,62566:58134,62567:58135,62568:58136,62569:58137,62570:58138,62571:58139,62572:58140,62573:58141,62574:58142,62575:58143,62576:58144,62577:58145,62578:58146,62579:58147,62580:58148,62581:58149,62582:58150,62583:58151,62584:58152,62585:58153,62586:58154,62587:58155,62588:58156,62589:58157,62590:58158,62592:58159,62593:58160,62594:58161,62595:58162,62596:58163,62597:58164,62598:58165,62599:58166,62600:58167,62601:58168,62602:58169,62603:58170,62604:58171,62605:58172,62606:58173,62607:58174,62608:58175,62609:58176,62610:58177,62611:58178,62612:58179,62613:58180,62614:58181,62615:58182,62616:58183,62617:58184,62618:58185,62619:58186,62620:58187,62621:58188,62622:58189,62623:58190,62624:58191,62625:58192,62626:58193,62627:58194,62628:58195,62629:58196,62630:58197,62631:58198,62632:58199,62633:58200,62634:58201,62635:58202,62636:58203,62637:58204,62638:58205,62639:58206,62640:58207,62641:58208,62642:58209,62643:58210,62644:58211,62645:58212,62646:58213,62647:58214,62648:58215,62649:58216,62650:58217,62651:58218,62652:58219,62653:58220,62654:58221,62655:58222,62656:58223,62657:58224,62658:58225,62659:58226,62660:58227,62661:58228,62662:58229,62663:58230,62664:58231,62665:58232,62666:58233,62667:58234,62668:58235,62669:58236,62670:58237,62671:58238,62672:58239,62673:58240,62674:58241,62675:58242,62676:58243,62677:58244,62678:58245,62679:58246,62680:58247,62681:58248,62682:58249,62683:58250,62684:58251,62685:58252,62686:58253,62687:58254,62688:58255,62689:58256,62690:58257,62691:58258,62692:58259,62693:58260,62694:58261,62695:58262,62696:58263,62697:58264,62698:58265,62699:58266,62700:58267,62701:58268,62702:58269,62703:58270,62704:58271,62705:58272,62706:58273,62707:58274,62708:58275,62709:58276,62710:58277,62711:58278,62712:58279,62713:58280,62714:58281,62715:58282,62716:58283,62784:58284,62785:58285,62786:58286,62787:58287,62788:58288,62789:58289,62790:58290,62791:58291,62792:58292,62793:58293,62794:58294,62795:58295,62796:58296,62797:58297,62798:58298,62799:58299,62800:58300,62801:58301,62802:58302,62803:58303,62804:58304,62805:58305,62806:58306,62807:58307,62808:58308,62809:58309,62810:58310,62811:58311,62812:58312,62813:58313,62814:58314,62815:58315,62816:58316,62817:58317,62818:58318,62819:58319,62820:58320,62821:58321,62822:58322,62823:58323,62824:58324,62825:58325,62826:58326,62827:58327,62828:58328,62829:58329,62830:58330,62831:58331,62832:58332,62833:58333,62834:58334,62835:58335,62836:58336,62837:58337,62838:58338,62839:58339,62840:58340,62841:58341,62842:58342,62843:58343,62844:58344,62845:58345,62846:58346,62848:58347,62849:58348,62850:58349,62851:58350,62852:58351,62853:58352,62854:58353,62855:58354,62856:58355,62857:58356,62858:58357,62859:58358,62860:58359,62861:58360,62862:58361,62863:58362,62864:58363,62865:58364,62866:58365,62867:58366,62868:58367,62869:58368,62870:58369,62871:58370,62872:58371,62873:58372,62874:58373,62875:58374,62876:58375,62877:58376,62878:58377,62879:58378,62880:58379,62881:58380,62882:58381,62883:58382,62884:58383,62885:58384,62886:58385,62887:58386,62888:58387,62889:58388,62890:58389,62891:58390,62892:58391,62893:58392,62894:58393,62895:58394,62896:58395,62897:58396,62898:58397,62899:58398,62900:58399,62901:58400,62902:58401,62903:58402,62904:58403,62905:58404,62906:58405,62907:58406,62908:58407,62909:58408,62910:58409,62911:58410,62912:58411,62913:58412,62914:58413,62915:58414,62916:58415,62917:58416,62918:58417,62919:58418,62920:58419,62921:58420,62922:58421,62923:58422,62924:58423,62925:58424,62926:58425,62927:58426,62928:58427,62929:58428,62930:58429,62931:58430,62932:58431,62933:58432,62934:58433,62935:58434,62936:58435,62937:58436,62938:58437,62939:58438,62940:58439,62941:58440,62942:58441,62943:58442,62944:58443,62945:58444,62946:58445,62947:58446,62948:58447,62949:58448,62950:58449,62951:58450,62952:58451,62953:58452,62954:58453,62955:58454,62956:58455,62957:58456,62958:58457,62959:58458,62960:58459,62961:58460,62962:58461,62963:58462,62964:58463,62965:58464,62966:58465,62967:58466,62968:58467,62969:58468,62970:58469,62971:58470,62972:58471,63040:58472,63041:58473,63042:58474,63043:58475,63044:58476,63045:58477,63046:58478,63047:58479,63048:58480,63049:58481,63050:58482,63051:58483,63052:58484,63053:58485,63054:58486,63055:58487,63056:58488,63057:58489,63058:58490,63059:58491,63060:58492,63061:58493,63062:58494,63063:58495,63064:58496,63065:58497,63066:58498,63067:58499,63068:58500,63069:58501,63070:58502,63071:58503,63072:58504,63073:58505,63074:58506,63075:58507,63076:58508,63077:58509,63078:58510,63079:58511,63080:58512,63081:58513,63082:58514,63083:58515,63084:58516,63085:58517,63086:58518,63087:58519,63088:58520,63089:58521,63090:58522,63091:58523,63092:58524,63093:58525,63094:58526,63095:58527,63096:58528,63097:58529,63098:58530,63099:58531,63100:58532,63101:58533,63102:58534,63104:58535,63105:58536,63106:58537,63107:58538,63108:58539,63109:58540,63110:58541,63111:58542,63112:58543,63113:58544,63114:58545,63115:58546,63116:58547,63117:58548,63118:58549,63119:58550,63120:58551,63121:58552,63122:58553,63123:58554,63124:58555,63125:58556,63126:58557,63127:58558,63128:58559,63129:58560,63130:58561,63131:58562,63132:58563,63133:58564,63134:58565,63135:58566,63136:58567,63137:58568,63138:58569,63139:58570,63140:58571,63141:58572,63142:58573,63143:58574,63144:58575,63145:58576,63146:58577,63147:58578,63148:58579,63149:58580,63150:58581,63151:58582,63152:58583,63153:58584,63154:58585,63155:58586,63156:58587,63157:58588,63158:58589,63159:58590,63160:58591,63161:58592,63162:58593,63163:58594,63164:58595,63165:58596,63166:58597,63167:58598,63168:58599,63169:58600,63170:58601,63171:58602,63172:58603,63173:58604,63174:58605,63175:58606,63176:58607,63177:58608,63178:58609,63179:58610,63180:58611,63181:58612,63182:58613,63183:58614,63184:58615,63185:58616,63186:58617,63187:58618,63188:58619,63189:58620,63190:58621,63191:58622,63192:58623,63193:58624,63194:58625,63195:58626,63196:58627,63197:58628,63198:58629,63199:58630,63200:58631,63201:58632,63202:58633,63203:58634,63204:58635,63205:58636,63206:58637,63207:58638,63208:58639,63209:58640,63210:58641,63211:58642,63212:58643,63213:58644,63214:58645,63215:58646,63216:58647,63217:58648,63218:58649,63219:58650,63220:58651,63221:58652,63222:58653,63223:58654,63224:58655,63225:58656,63226:58657,63227:58658,63228:58659,63296:58660,63297:58661,63298:58662,63299:58663,63300:58664,63301:58665,63302:58666,63303:58667,63304:58668,63305:58669,63306:58670,63307:58671,63308:58672,63309:58673,63310:58674,63311:58675,63312:58676,63313:58677,63314:58678,63315:58679,63316:58680,63317:58681,63318:58682,63319:58683,63320:58684,63321:58685,63322:58686,63323:58687,63324:58688,63325:58689,63326:58690,63327:58691,63328:58692,63329:58693,63330:58694,63331:58695,63332:58696,63333:58697,63334:58698,63335:58699,63336:58700,63337:58701,63338:58702,63339:58703,63340:58704,63341:58705,63342:58706,63343:58707,63344:58708,63345:58709,63346:58710,63347:58711,63348:58712,63349:58713,63350:58714,63351:58715,63352:58716,63353:58717,63354:58718,63355:58719,63356:58720,63357:58721,63358:58722,63360:58723,63361:58724,63362:58725,63363:58726,63364:58727,63365:58728,63366:58729,63367:58730,63368:58731,63369:58732,63370:58733,63371:58734,63372:58735,63373:58736,63374:58737,63375:58738,63376:58739,63377:58740,63378:58741,63379:58742,63380:58743,63381:58744,63382:58745,63383:58746,63384:58747,63385:58748,63386:58749,63387:58750,63388:58751,63389:58752,63390:58753,63391:58754,63392:58755,63393:58756,63394:58757,63395:58758,63396:58759,63397:58760,63398:58761,63399:58762,63400:58763,63401:58764,63402:58765,63403:58766,63404:58767,63405:58768,63406:58769,63407:58770,63408:58771,63409:58772,63410:58773,63411:58774,63412:58775,63413:58776,63414:58777,63415:58778,63416:58779,63417:58780,63418:58781,63419:58782,63420:58783,63421:58784,63422:58785,63423:58786,63424:58787,63425:58788,63426:58789,63427:58790,63428:58791,63429:58792,63430:58793,63431:58794,63432:58795,63433:58796,63434:58797,63435:58798,63436:58799,63437:58800,63438:58801,63439:58802,63440:58803,63441:58804,63442:58805,63443:58806,63444:58807,63445:58808,63446:58809,63447:58810,63448:58811,63449:58812,63450:58813,63451:58814,63452:58815,63453:58816,63454:58817,63455:58818,63456:58819,63457:58820,63458:58821,63459:58822,63460:58823,63461:58824,63462:58825,63463:58826,63464:58827,63465:58828,63466:58829,63467:58830,63468:58831,63469:58832,63470:58833,63471:58834,63472:58835,63473:58836,63474:58837,63475:58838,63476:58839,63477:58840,63478:58841,63479:58842,63480:58843,63481:58844,63482:58845,63483:58846,63484:58847,63552:58848,63553:58849,63554:58850,63555:58851,63556:58852,63557:58853,63558:58854,63559:58855,63560:58856,63561:58857,63562:58858,63563:58859,63564:58860,63565:58861,63566:58862,63567:58863,63568:58864,63569:58865,63570:58866,63571:58867,63572:58868,63573:58869,63574:58870,63575:58871,63576:58872,63577:58873,63578:58874,63579:58875,63580:58876,63581:58877,63582:58878,63583:58879,63584:58880,63585:58881,63586:58882,63587:58883,63588:58884,63589:58885,63590:58886,63591:58887,63592:58888,63593:58889,63594:58890,63595:58891,63596:58892,63597:58893,63598:58894,63599:58895,63600:58896,63601:58897,63602:58898,63603:58899,63604:58900,63605:58901,63606:58902,63607:58903,63608:58904,63609:58905,63610:58906,63611:58907,63612:58908,63613:58909,63614:58910,63616:58911,63617:58912,63618:58913,63619:58914,63620:58915,63621:58916,63622:58917,63623:58918,63624:58919,63625:58920,63626:58921,63627:58922,63628:58923,63629:58924,63630:58925,63631:58926,63632:58927,63633:58928,63634:58929,63635:58930,63636:58931,63637:58932,63638:58933,63639:58934,63640:58935,63641:58936,63642:58937,63643:58938,63644:58939,63645:58940,63646:58941,63647:58942,63648:58943,63649:58944,63650:58945,63651:58946,63652:58947,63653:58948,63654:58949,63655:58950,63656:58951,63657:58952,63658:58953,63659:58954,63660:58955,63661:58956,63662:58957,63663:58958,63664:58959,63665:58960,63666:58961,63667:58962,63668:58963,63669:58964,63670:58965,63671:58966,63672:58967,63673:58968,63674:58969,63675:58970,63676:58971,63677:58972,63678:58973,63679:58974,63680:58975,63681:58976,63682:58977,63683:58978,63684:58979,63685:58980,63686:58981,63687:58982,63688:58983,63689:58984,63690:58985,63691:58986,63692:58987,63693:58988,63694:58989,63695:58990,63696:58991,63697:58992,63698:58993,63699:58994,63700:58995,63701:58996,63702:58997,63703:58998,63704:58999,63705:59e3,63706:59001,63707:59002,63708:59003,63709:59004,63710:59005,63711:59006,63712:59007,63713:59008,63714:59009,63715:59010,63716:59011,63717:59012,63718:59013,63719:59014,63720:59015,63721:59016,63722:59017,63723:59018,63724:59019,63725:59020,63726:59021,63727:59022,63728:59023,63729:59024,63730:59025,63731:59026,63732:59027,63733:59028,63734:59029,63735:59030,63736:59031,63737:59032,63738:59033,63739:59034,63740:59035,64064:8560,64065:8561,64066:8562,64067:8563,64068:8564,64069:8565,64070:8566,64071:8567,64072:8568,64073:8569,64074:8544,64075:8545,64076:8546,64077:8547,64078:8548,64079:8549,64080:8550,64081:8551,64082:8552,64083:8553,64084:65506,64085:65508,64086:65287,64087:65282,64088:12849,64089:8470,64090:8481,64091:8757,64092:32394,64093:35100,64094:37704,64095:37512,64096:34012,64097:20425,64098:28859,64099:26161,64100:26824,64101:37625,64102:26363,64103:24389,64104:20008,64105:20193,64106:20220,64107:20224,64108:20227,64109:20281,64110:20310,64111:20370,64112:20362,64113:20378,64114:20372,64115:20429,64116:20544,64117:20514,64118:20479,64119:20510,64120:20550,64121:20592,64122:20546,64123:20628,64124:20724,64125:20696,64126:20810,64128:20836,64129:20893,64130:20926,64131:20972,64132:21013,64133:21148,64134:21158,64135:21184,64136:21211,64137:21248,64138:21255,64139:21284,64140:21362,64141:21395,64142:21426,64143:21469,64144:64014,64145:21660,64146:21642,64147:21673,64148:21759,64149:21894,64150:22361,64151:22373,64152:22444,64153:22472,64154:22471,64155:64015,64156:64016,64157:22686,64158:22706,64159:22795,64160:22867,64161:22875,64162:22877,64163:22883,64164:22948,64165:22970,64166:23382,64167:23488,64168:29999,64169:23512,64170:23532,64171:23582,64172:23718,64173:23738,64174:23797,64175:23847,64176:23891,64177:64017,64178:23874,64179:23917,64180:23992,64181:23993,64182:24016,64183:24353,64184:24372,64185:24423,64186:24503,64187:24542,64188:24669,64189:24709,64190:24714,64191:24798,64192:24789,64193:24864,64194:24818,64195:24849,64196:24887,64197:24880,64198:24984,64199:25107,64200:25254,64201:25589,64202:25696,64203:25757,64204:25806,64205:25934,64206:26112,64207:26133,64208:26171,64209:26121,64210:26158,64211:26142,64212:26148,64213:26213,64214:26199,64215:26201,64216:64018,64217:26227,64218:26265,64219:26272,64220:26290,64221:26303,64222:26362,64223:26382,64224:63785,64225:26470,64226:26555,64227:26706,64228:26560,64229:26625,64230:26692,64231:26831,64232:64019,64233:26984,64234:64020,64235:27032,64236:27106,64237:27184,64238:27243,64239:27206,64240:27251,64241:27262,64242:27362,64243:27364,64244:27606,64245:27711,64246:27740,64247:27782,64248:27759,64249:27866,64250:27908,64251:28039,64252:28015,64320:28054,64321:28076,64322:28111,64323:28152,64324:28146,64325:28156,64326:28217,64327:28252,64328:28199,64329:28220,64330:28351,64331:28552,64332:28597,64333:28661,64334:28677,64335:28679,64336:28712,64337:28805,64338:28843,64339:28943,64340:28932,64341:29020,64342:28998,64343:28999,64344:64021,64345:29121,64346:29182,64347:29361,64348:29374,64349:29476,64350:64022,64351:29559,64352:29629,64353:29641,64354:29654,64355:29667,64356:29650,64357:29703,64358:29685,64359:29734,64360:29738,64361:29737,64362:29742,64363:29794,64364:29833,64365:29855,64366:29953,64367:30063,64368:30338,64369:30364,64370:30366,64371:30363,64372:30374,64373:64023,64374:30534,64375:21167,64376:30753,64377:30798,64378:30820,64379:30842,64380:31024,64381:64024,64382:64025,64384:64026,64385:31124,64386:64027,64387:31131,64388:31441,64389:31463,64390:64028,64391:31467,64392:31646,64393:64029,64394:32072,64395:32092,64396:32183,64397:32160,64398:32214,64399:32338,64400:32583,64401:32673,64402:64030,64403:33537,64404:33634,64405:33663,64406:33735,64407:33782,64408:33864,64409:33972,64410:34131,64411:34137,64412:34155,64413:64031,64414:34224,64415:64032,64416:64033,64417:34823,64418:35061,64419:35346,64420:35383,64421:35449,64422:35495,64423:35518,64424:35551,64425:64034,64426:35574,64427:35667,64428:35711,64429:36080,64430:36084,64431:36114,64432:36214,64433:64035,64434:36559,64435:64036,64436:64037,64437:36967,64438:37086,64439:64038,64440:37141,64441:37159,64442:37338,64443:37335,64444:37342,64445:37357,64446:37358,64447:37348,64448:37349,64449:37382,64450:37392,64451:37386,64452:37434,64453:37440,64454:37436,64455:37454,64456:37465,64457:37457,64458:37433,64459:37479,64460:37543,64461:37495,64462:37496,64463:37607,64464:37591,64465:37593,64466:37584,64467:64039,64468:37589,64469:37600,64470:37587,64471:37669,64472:37665,64473:37627,64474:64040,64475:37662,64476:37631,64477:37661,64478:37634,64479:37744,64480:37719,64481:37796,64482:37830,64483:37854,64484:37880,64485:37937,64486:37957,64487:37960,64488:38290,64489:63964,64490:64041,64491:38557,64492:38575,64493:38707,64494:38715,64495:38723,64496:38733,64497:38735,64498:38737,64499:38741,64500:38999,64501:39013,64502:64042,64503:64043,64504:39207,64505:64044,64506:39326,64507:39502,64508:39641,64576:39644,64577:39797,64578:39794,64579:39823,64580:39857,64581:39867,64582:39936,64583:40304,64584:40299,64585:64045,64586:40473,64587:40657},d.prototype={constructor:d,getInt8:function(){var t=this.dv.getInt8(this.offset);return this.offset+=1,t},getInt8Array:function(t){for(var e=[],n=0;n<t;n++)e.push(this.getInt8());return e},getUint8:function(){var t=this.dv.getUint8(this.offset);return this.offset+=1,t},getUint8Array:function(t){for(var e=[],n=0;n<t;n++)e.push(this.getUint8());return e},getInt16:function(){var t=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,t},getInt16Array:function(t){for(var e=[],n=0;n<t;n++)e.push(this.getInt16());return e},getUint16:function(){var t=this.dv.getUint16(this.offset,this.littleEndian);return this.offset+=2,t},getUint16Array:function(t){for(var e=[],n=0;n<t;n++)e.push(this.getUint16());return e},getInt32:function(){var t=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,t},getInt32Array:function(t){for(var e=[],n=0;n<t;n++)e.push(this.getInt32());return e},getUint32:function(){var t=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,t},getUint32Array:function(t){for(var e=[],n=0;n<t;n++)e.push(this.getUint32());return e},getFloat32:function(){var t=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,t},getFloat32Array:function(t){for(var e=[],n=0;n<t;n++)e.push(this.getFloat32());return e},getFloat64:function(){var t=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,t},getFloat64Array:function(t){for(var e=[],n=0;n<t;n++)e.push(this.getFloat64());return e},getIndex:function(t,e){switch(t){case 1:return!0===e?this.getUint8():this.getInt8();case 2:return!0===e?this.getUint16():this.getInt16();case 4:return this.getInt32();default:throw"unknown number type "+t+" exception."}},getIndexArray:function(t,e,n){for(var r=[],i=0;i<e;i++)r.push(this.getIndex(t,n));return r},getChars:function(t){for(var e="";t>0;){var n=this.getUint8();if(t--,0===n)break;e+=String.fromCharCode(n)}for(;t>0;)this.getUint8(),t--;return e},getSjisStringsAsUnicode:function(t){for(var e=[];t>0;){var n=this.getUint8();if(t--,0===n)break;e.push(n)}for(;t>0;)this.getUint8(),t--;return this.encoder.s2u(new Uint8Array(e))},getUnicodeStrings:function(t){for(var e="";t>0;){var n=this.getUint16();if(t-=2,0===n)break;e+=String.fromCharCode(n)}for(;t>0;)this.getUint8(),t--;return e},getTextBuffer:function(){var t=this.getUint32();return this.getUnicodeStrings(t)}},m.prototype={constructor:m,leftToRightVector3:function(t){t[2]=-t[2]},leftToRightQuaternion:function(t){t[0]=-t[0],t[1]=-t[1]},leftToRightEuler:function(t){t[0]=-t[0],t[1]=-t[1]},leftToRightIndexOrder:function(t){var e=t[2];t[2]=t[0],t[0]=e},leftToRightVector3Range:function(t,e){var n=-e[2];e[2]=-t[2],t[2]=n},leftToRightEulerRange:function(t,e){var n=-e[0],r=-e[1];e[0]=-t[0],e[1]=-t[1],t[0]=n,t[1]=r}},y.prototype.parsePmd=function(t,e){var n,r={},i=new d(t);return r.metadata={},r.metadata.format="pmd",r.metadata.coordinateSystem="left",function(){var t=r.metadata;if(t.magic=i.getChars(3),"Pmd"!==t.magic)throw"PMD file magic is not Pmd, but "+t.magic;t.version=i.getFloat32(),t.modelName=i.getSjisStringsAsUnicode(20),t.comment=i.getSjisStringsAsUnicode(256)}(),function(){var t,e=r.metadata;e.vertexCount=i.getUint32(),r.vertices=[];for(var n=0;n<e.vertexCount;n++)r.vertices.push((t=void 0,(t={}).position=i.getFloat32Array(3),t.normal=i.getFloat32Array(3),t.uv=i.getFloat32Array(2),t.skinIndices=i.getUint16Array(2),t.skinWeights=[i.getUint8()/100],t.skinWeights.push(1-t.skinWeights[0]),t.edgeFlag=i.getUint8(),t))}(),function(){var t,e=r.metadata;e.faceCount=i.getUint32()/3,r.faces=[];for(var n=0;n<e.faceCount;n++)r.faces.push((t=void 0,(t={}).indices=i.getUint16Array(3),t))}(),function(){var t,e=r.metadata;e.materialCount=i.getUint32(),r.materials=[];for(var n=0;n<e.materialCount;n++)r.materials.push((t=void 0,(t={}).diffuse=i.getFloat32Array(4),t.shininess=i.getFloat32(),t.specular=i.getFloat32Array(3),t.ambient=i.getFloat32Array(3),t.toonIndex=i.getInt8(),t.edgeFlag=i.getUint8(),t.faceCount=i.getUint32()/3,t.fileName=i.getSjisStringsAsUnicode(20),t))}(),function(){var t,e=r.metadata;e.boneCount=i.getUint16(),r.bones=[];for(var n=0;n<e.boneCount;n++)r.bones.push((t=void 0,(t={}).name=i.getSjisStringsAsUnicode(20),t.parentIndex=i.getInt16(),t.tailIndex=i.getInt16(),t.type=i.getUint8(),t.ikIndex=i.getInt16(),t.position=i.getFloat32Array(3),t))}(),function(){var t=function(){var t={};t.target=i.getUint16(),t.effector=i.getUint16(),t.linkCount=i.getUint8(),t.iteration=i.getUint16(),t.maxAngle=i.getFloat32(),t.links=[];for(var e=0;e<t.linkCount;e++){var n={};n.index=i.getUint16(),t.links.push(n)}return t},e=r.metadata;e.ikCount=i.getUint16(),r.iks=[];for(var n=0;n<e.ikCount;n++)r.iks.push(t())}(),function(){var t=function(){var t={};t.name=i.getSjisStringsAsUnicode(20),t.elementCount=i.getUint32(),t.type=i.getUint8(),t.elements=[];for(var e=0;e<t.elementCount;e++)t.elements.push({index:i.getUint32(),position:i.getFloat32Array(3)});return t},e=r.metadata;e.morphCount=i.getUint16(),r.morphs=[];for(var n=0;n<e.morphCount;n++)r.morphs.push(t())}(),function(){var t,e=r.metadata;e.morphFrameCount=i.getUint8(),r.morphFrames=[];for(var n=0;n<e.morphFrameCount;n++)r.morphFrames.push((t=void 0,(t={}).index=i.getUint16(),t))}(),function(){var t,e=r.metadata;e.boneFrameNameCount=i.getUint8(),r.boneFrameNames=[];for(var n=0;n<e.boneFrameNameCount;n++)r.boneFrameNames.push((t=void 0,(t={}).name=i.getSjisStringsAsUnicode(50),t))}(),function(){var t,e=r.metadata;e.boneFrameCount=i.getUint32(),r.boneFrames=[];for(var n=0;n<e.boneFrameCount;n++)r.boneFrames.push((t=void 0,(t={}).boneIndex=i.getInt16(),t.frameIndex=i.getUint8(),t))}(),(n=r.metadata).englishCompatibility=i.getUint8(),n.englishCompatibility>0&&(n.englishModelName=i.getSjisStringsAsUnicode(20),n.englishComment=i.getSjisStringsAsUnicode(256)),function(){var t=r.metadata;if(0!==t.englishCompatibility){r.englishBoneNames=[];for(var e=0;e<t.boneCount;e++)r.englishBoneNames.push((n=void 0,(n={}).name=i.getSjisStringsAsUnicode(20),n));var n}}(),function(){var t=r.metadata;if(0!==t.englishCompatibility){r.englishMorphNames=[];for(var e=0;e<t.morphCount-1;e++)r.englishMorphNames.push((n=void 0,(n={}).name=i.getSjisStringsAsUnicode(20),n));var n}}(),function(){var t=r.metadata;if(0!==t.englishCompatibility){r.englishBoneFrameNames=[];for(var e=0;e<t.boneFrameNameCount;e++)r.englishBoneFrameNames.push((n=void 0,(n={}).name=i.getSjisStringsAsUnicode(50),n));var n}}(),function(){var t;r.toonTextures=[];for(var e=0;e<10;e++)r.toonTextures.push((t=void 0,(t={}).fileName=i.getSjisStringsAsUnicode(100),t))}(),function(){var t,e=r.metadata;e.rigidBodyCount=i.getUint32(),r.rigidBodies=[];for(var n=0;n<e.rigidBodyCount;n++)r.rigidBodies.push((t=void 0,(t={}).name=i.getSjisStringsAsUnicode(20),t.boneIndex=i.getInt16(),t.groupIndex=i.getUint8(),t.groupTarget=i.getUint16(),t.shapeType=i.getUint8(),t.width=i.getFloat32(),t.height=i.getFloat32(),t.depth=i.getFloat32(),t.position=i.getFloat32Array(3),t.rotation=i.getFloat32Array(3),t.weight=i.getFloat32(),t.positionDamping=i.getFloat32(),t.rotationDamping=i.getFloat32(),t.restitution=i.getFloat32(),t.friction=i.getFloat32(),t.type=i.getUint8(),t))}(),function(){var t,e=r.metadata;e.constraintCount=i.getUint32(),r.constraints=[];for(var n=0;n<e.constraintCount;n++)r.constraints.push((t=void 0,(t={}).name=i.getSjisStringsAsUnicode(20),t.rigidBodyIndex1=i.getUint32(),t.rigidBodyIndex2=i.getUint32(),t.position=i.getFloat32Array(3),t.rotation=i.getFloat32Array(3),t.translationLimitation1=i.getFloat32Array(3),t.translationLimitation2=i.getFloat32Array(3),t.rotationLimitation1=i.getFloat32Array(3),t.rotationLimitation2=i.getFloat32Array(3),t.springPosition=i.getFloat32Array(3),t.springRotation=i.getFloat32Array(3),t))}(),!0===e&&this.leftToRightModel(r),r},y.prototype.parsePmx=function(t,e){var n={},r=new d(t);return n.metadata={},n.metadata.format="pmx",n.metadata.coordinateSystem="left",function(){var t=n.metadata;if(t.magic=r.getChars(4),"PMX "!==t.magic)throw"PMX file magic is not PMX , but "+t.magic;if(t.version=r.getFloat32(),2!==t.version&&2.1!==t.version)throw"PMX version "+t.version+" is not supported.";t.headerSize=r.getUint8(),t.encoding=r.getUint8(),t.additionalUvNum=r.getUint8(),t.vertexIndexSize=r.getUint8(),t.textureIndexSize=r.getUint8(),t.materialIndexSize=r.getUint8(),t.boneIndexSize=r.getUint8(),t.morphIndexSize=r.getUint8(),t.rigidBodyIndexSize=r.getUint8(),t.modelName=r.getTextBuffer(),t.englishModelName=r.getTextBuffer(),t.comment=r.getTextBuffer(),t.englishComment=r.getTextBuffer()}(),function(){var t=function(){var t={};t.position=r.getFloat32Array(3),t.normal=r.getFloat32Array(3),t.uv=r.getFloat32Array(2),t.auvs=[];for(var i=0;i<n.metadata.additionalUvNum;i++)t.auvs.push(r.getFloat32Array(4));t.type=r.getUint8();var o=e.boneIndexSize;if(0===t.type)t.skinIndices=r.getIndexArray(o,1),t.skinWeights=[1];else if(1===t.type)t.skinIndices=r.getIndexArray(o,2),t.skinWeights=r.getFloat32Array(1),t.skinWeights.push(1-t.skinWeights[0]);else if(2===t.type)t.skinIndices=r.getIndexArray(o,4),t.skinWeights=r.getFloat32Array(4);else{if(3!==t.type)throw"unsupport bone type "+t.type+" exception.";t.skinIndices=r.getIndexArray(o,2),t.skinWeights=r.getFloat32Array(1),t.skinWeights.push(1-t.skinWeights[0]),t.skinC=r.getFloat32Array(3),t.skinR0=r.getFloat32Array(3),t.skinR1=r.getFloat32Array(3),t.type=1}return t.edgeRatio=r.getFloat32(),t},e=n.metadata;e.vertexCount=r.getUint32(),n.vertices=[];for(var i=0;i<e.vertexCount;i++)n.vertices.push(t())}(),function(){var t,e=n.metadata;e.faceCount=r.getUint32()/3,n.faces=[];for(var i=0;i<e.faceCount;i++)n.faces.push((t=void 0,(t={}).indices=r.getIndexArray(e.vertexIndexSize,3,!0),t))}(),function(){var t=n.metadata;t.textureCount=r.getUint32(),n.textures=[];for(var e=0;e<t.textureCount;e++)n.textures.push(r.getTextBuffer())}(),function(){var t=function(){var t={};if(t.name=r.getTextBuffer(),t.englishName=r.getTextBuffer(),t.diffuse=r.getFloat32Array(4),t.specular=r.getFloat32Array(3),t.shininess=r.getFloat32(),t.ambient=r.getFloat32Array(3),t.flag=r.getUint8(),t.edgeColor=r.getFloat32Array(4),t.edgeSize=r.getFloat32(),t.textureIndex=r.getIndex(n.metadata.textureIndexSize),t.envTextureIndex=r.getIndex(n.metadata.textureIndexSize),t.envFlag=r.getUint8(),t.toonFlag=r.getUint8(),0===t.toonFlag)t.toonIndex=r.getIndex(n.metadata.textureIndexSize);else{if(1!==t.toonFlag)throw"unknown toon flag "+t.toonFlag+" exception.";t.toonIndex=r.getInt8()}return t.comment=r.getTextBuffer(),t.faceCount=r.getUint32()/3,t},e=n.metadata;e.materialCount=r.getUint32(),n.materials=[];for(var i=0;i<e.materialCount;i++)n.materials.push(t())}(),function(){var t=function(){var t={};if(t.name=r.getTextBuffer(),t.englishName=r.getTextBuffer(),t.position=r.getFloat32Array(3),t.parentIndex=r.getIndex(n.metadata.boneIndexSize),t.transformationClass=r.getUint32(),t.flag=r.getUint16(),1&t.flag?t.connectIndex=r.getIndex(n.metadata.boneIndexSize):t.offsetPosition=r.getFloat32Array(3),256&t.flag||512&t.flag){var e={};e.isLocal=!!(128&t.flag),e.affectRotation=!!(256&t.flag),e.affectPosition=!!(512&t.flag),e.parentIndex=r.getIndex(n.metadata.boneIndexSize),e.ratio=r.getFloat32(),t.grant=e}if(1024&t.flag&&(t.fixAxis=r.getFloat32Array(3)),2048&t.flag&&(t.localXVector=r.getFloat32Array(3),t.localZVector=r.getFloat32Array(3)),8192&t.flag&&(t.key=r.getUint32()),32&t.flag){var i={};i.effector=r.getIndex(n.metadata.boneIndexSize),i.target=null,i.iteration=r.getUint32(),i.maxAngle=r.getFloat32(),i.linkCount=r.getUint32(),i.links=[];for(var o=0;o<i.linkCount;o++){var a={};a.index=r.getIndex(n.metadata.boneIndexSize),a.angleLimitation=r.getUint8(),1===a.angleLimitation&&(a.lowerLimitationAngle=r.getFloat32Array(3),a.upperLimitationAngle=r.getFloat32Array(3)),i.links.push(a)}t.ik=i}return t},e=n.metadata;e.boneCount=r.getUint32(),n.bones=[];for(var i=0;i<e.boneCount;i++)n.bones.push(t())}(),function(){var t=function(){var t={};t.name=r.getTextBuffer(),t.englishName=r.getTextBuffer(),t.panel=r.getUint8(),t.type=r.getUint8(),t.elementCount=r.getUint32(),t.elements=[];for(var e=0;e<t.elementCount;e++)if(0===t.type)(i={}).index=r.getIndex(n.metadata.morphIndexSize),i.ratio=r.getFloat32(),t.elements.push(i);else if(1===t.type)(i={}).index=r.getIndex(n.metadata.vertexIndexSize,!0),i.position=r.getFloat32Array(3),t.elements.push(i);else if(2===t.type)(i={}).index=r.getIndex(n.metadata.boneIndexSize),i.position=r.getFloat32Array(3),i.rotation=r.getFloat32Array(4),t.elements.push(i);else if(3===t.type)(i={}).index=r.getIndex(n.metadata.vertexIndexSize,!0),i.uv=r.getFloat32Array(4),t.elements.push(i);else if(4===t.type);else if(5===t.type);else if(6===t.type);else if(7===t.type);else if(8===t.type){var i;(i={}).index=r.getIndex(n.metadata.materialIndexSize),i.type=r.getUint8(),i.diffuse=r.getFloat32Array(4),i.specular=r.getFloat32Array(3),i.shininess=r.getFloat32(),i.ambient=r.getFloat32Array(3),i.edgeColor=r.getFloat32Array(4),i.edgeSize=r.getFloat32(),i.textureColor=r.getFloat32Array(4),i.sphereTextureColor=r.getFloat32Array(4),i.toonColor=r.getFloat32Array(4),t.elements.push(i)}return t},e=n.metadata;e.morphCount=r.getUint32(),n.morphs=[];for(var i=0;i<e.morphCount;i++)n.morphs.push(t())}(),function(){var t=function(){var t={};t.name=r.getTextBuffer(),t.englishName=r.getTextBuffer(),t.type=r.getUint8(),t.elementCount=r.getUint32(),t.elements=[];for(var e=0;e<t.elementCount;e++){var i={};i.target=r.getUint8(),i.index=0===i.target?r.getIndex(n.metadata.boneIndexSize):r.getIndex(n.metadata.morphIndexSize),t.elements.push(i)}return t},e=n.metadata;e.frameCount=r.getUint32(),n.frames=[];for(var i=0;i<e.frameCount;i++)n.frames.push(t())}(),function(){var t,e=n.metadata;e.rigidBodyCount=r.getUint32(),n.rigidBodies=[];for(var i=0;i<e.rigidBodyCount;i++)n.rigidBodies.push((t=void 0,(t={}).name=r.getTextBuffer(),t.englishName=r.getTextBuffer(),t.boneIndex=r.getIndex(n.metadata.boneIndexSize),t.groupIndex=r.getUint8(),t.groupTarget=r.getUint16(),t.shapeType=r.getUint8(),t.width=r.getFloat32(),t.height=r.getFloat32(),t.depth=r.getFloat32(),t.position=r.getFloat32Array(3),t.rotation=r.getFloat32Array(3),t.weight=r.getFloat32(),t.positionDamping=r.getFloat32(),t.rotationDamping=r.getFloat32(),t.restitution=r.getFloat32(),t.friction=r.getFloat32(),t.type=r.getUint8(),t))}(),function(){var t,e=n.metadata;e.constraintCount=r.getUint32(),n.constraints=[];for(var i=0;i<e.constraintCount;i++)n.constraints.push((t=void 0,(t={}).name=r.getTextBuffer(),t.englishName=r.getTextBuffer(),t.type=r.getUint8(),t.rigidBodyIndex1=r.getIndex(n.metadata.rigidBodyIndexSize),t.rigidBodyIndex2=r.getIndex(n.metadata.rigidBodyIndexSize),t.position=r.getFloat32Array(3),t.rotation=r.getFloat32Array(3),t.translationLimitation1=r.getFloat32Array(3),t.translationLimitation2=r.getFloat32Array(3),t.rotationLimitation1=r.getFloat32Array(3),t.rotationLimitation2=r.getFloat32Array(3),t.springPosition=r.getFloat32Array(3),t.springRotation=r.getFloat32Array(3),t))}(),!0===e&&this.leftToRightModel(n),n},y.prototype.parseVmd=function(t,e){var n={},r=new d(t);return n.metadata={},n.metadata.coordinateSystem="left",function(){var t=n.metadata;if(t.magic=r.getChars(30),"Vocaloid Motion Data 0002"!==t.magic)throw"VMD file magic is not Vocaloid Motion Data 0002, but "+t.magic;t.name=r.getSjisStringsAsUnicode(20)}(),function(){var t,e=n.metadata;e.motionCount=r.getUint32(),n.motions=[];for(var i=0;i<e.motionCount;i++)n.motions.push((t=void 0,(t={}).boneName=r.getSjisStringsAsUnicode(15),t.frameNum=r.getUint32(),t.position=r.getFloat32Array(3),t.rotation=r.getFloat32Array(4),t.interpolation=r.getUint8Array(64),t))}(),function(){var t,e=n.metadata;e.morphCount=r.getUint32(),n.morphs=[];for(var i=0;i<e.morphCount;i++)n.morphs.push((t=void 0,(t={}).morphName=r.getSjisStringsAsUnicode(15),t.frameNum=r.getUint32(),t.weight=r.getFloat32(),t))}(),function(){var t,e=n.metadata;e.cameraCount=r.getUint32(),n.cameras=[];for(var i=0;i<e.cameraCount;i++)n.cameras.push((t=void 0,(t={}).frameNum=r.getUint32(),t.distance=r.getFloat32(),t.position=r.getFloat32Array(3),t.rotation=r.getFloat32Array(3),t.interpolation=r.getUint8Array(24),t.fov=r.getUint32(),t.perspective=r.getUint8(),t))}(),!0===e&&this.leftToRightVmd(n),n},y.prototype.parseVpd=function(t,e){var n={metadata:{}};n.metadata.coordinateSystem="left",n.bones=[];var r=t.replace(/\/\/\w*(\r|\n|\r\n)/g,"").split(/\r|\n|\r\n/);function i(){throw"the file seems not vpd file."}return"Vocaloid Pose Data file"!==r[0]&&i(),r.length<4&&i(),n.metadata.parentFile=r[2],n.metadata.boneCount=parseInt(r[3]),function(){for(var t=/^\s*(Bone[0-9]+)\s*\{\s*(.*)$/,e=/^\s*(-?[0-9]+\.[0-9]+)\s*,\s*(-?[0-9]+\.[0-9]+)\s*,\s*(-?[0-9]+\.[0-9]+)\s*;/,o=/^\s*(-?[0-9]+\.[0-9]+)\s*,\s*(-?[0-9]+\.[0-9]+)\s*,\s*(-?[0-9]+\.[0-9]+)\s*,\s*(-?[0-9]+\.[0-9]+)\s*;/,a=/^\s*}/,s=n.bones,u=null,c=null,l=null,f=4;f<r.length;f++){var h,p=r[f];null!==(h=p.match(t))&&(null!==u&&i(),u=h[2]),null!==(h=p.match(e))&&(null!==c&&i(),c=[parseFloat(h[1]),parseFloat(h[2]),parseFloat(h[3])]),null!==(h=p.match(o))&&(null!==l&&i(),l=[parseFloat(h[1]),parseFloat(h[2]),parseFloat(h[3]),parseFloat(h[4])]),null!==(h=p.match(a))&&(null!==u&&null!==c&&null!==l||i(),s.push({name:u,translation:c,quaternion:l}),u=null,c=null,l=null)}null===u&&null===c&&null===l||i()}(),!0===e&&this.leftToRightVpd(n),n},y.prototype.mergeVmds=function(t){var e={metadata:{}};e.metadata.name=t[0].metadata.name,e.metadata.coordinateSystem=t[0].metadata.coordinateSystem,e.metadata.motionCount=0,e.metadata.morphCount=0,e.metadata.cameraCount=0,e.motions=[],e.morphs=[],e.cameras=[];for(var n=0;n<t.length;n++){var r=t[n];e.metadata.motionCount+=r.metadata.motionCount,e.metadata.morphCount+=r.metadata.morphCount,e.metadata.cameraCount+=r.metadata.cameraCount;for(var i=0;i<r.metadata.motionCount;i++)e.motions.push(r.motions[i]);for(i=0;i<r.metadata.morphCount;i++)e.morphs.push(r.morphs[i]);for(i=0;i<r.metadata.cameraCount;i++)e.cameras.push(r.cameras[i])}return e},y.prototype.leftToRightModel=function(t){if("right"!==t.metadata.coordinateSystem){t.metadata.coordinateSystem="right";for(var e=new m,n=0;n<t.metadata.vertexCount;n++)e.leftToRightVector3(t.vertices[n].position),e.leftToRightVector3(t.vertices[n].normal);for(n=0;n<t.metadata.faceCount;n++)e.leftToRightIndexOrder(t.faces[n].indices);for(n=0;n<t.metadata.boneCount;n++)e.leftToRightVector3(t.bones[n].position);for(n=0;n<t.metadata.morphCount;n++){var r=t.morphs[n];if("pmx"!==t.metadata.format||1===r.type)for(var i=0;i<r.elements.length;i++)e.leftToRightVector3(r.elements[i].position)}for(n=0;n<t.metadata.rigidBodyCount;n++)e.leftToRightVector3(t.rigidBodies[n].position),e.leftToRightEuler(t.rigidBodies[n].rotation);for(n=0;n<t.metadata.constraintCount;n++)e.leftToRightVector3(t.constraints[n].position),e.leftToRightEuler(t.constraints[n].rotation),e.leftToRightVector3Range(t.constraints[n].translationLimitation1,t.constraints[n].translationLimitation2),e.leftToRightEulerRange(t.constraints[n].rotationLimitation1,t.constraints[n].rotationLimitation2)}},y.prototype.leftToRightVmd=function(t){if("right"!==t.metadata.coordinateSystem){t.metadata.coordinateSystem="right";for(var e=new m,n=0;n<t.metadata.motionCount;n++)e.leftToRightVector3(t.motions[n].position),e.leftToRightQuaternion(t.motions[n].rotation);for(n=0;n<t.metadata.cameraCount;n++)e.leftToRightVector3(t.cameras[n].position),e.leftToRightEuler(t.cameras[n].rotation)}},y.prototype.leftToRightVpd=function(t){if("right"!==t.metadata.coordinateSystem){t.metadata.coordinateSystem="right";for(var e=new m,n=0;n<t.bones.length;n++)e.leftToRightVector3(t.bones[n].translation),e.leftToRightQuaternion(t.bones[n].quaternion)}};var v={CharsetEncoder:p,Parser:y};function g(t){return g="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},g(t)}function b(){return b="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=O(t)););return t}(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(arguments.length<3?t:n):i.value}},b.apply(this,arguments)}function _(t){return function(t){if(Array.isArray(t))return x(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return x(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?x(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function x(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function w(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function S(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,M(r.key),r)}}function T(t,e,n){return e&&S(t.prototype,e),n&&S(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function M(t){var e=function(t,e){if("object"!=g(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=g(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==g(e)?e:e+""}function E(t,e,n){return e=O(e),function(t,e){if(e&&("object"===g(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,A()?Reflect.construct(e,n||[],O(t).constructor):e.apply(t,n))}function A(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(A=function(){return!!t})()}function O(t){return O=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},O(t)}function P(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&R(t,e)}function R(t,e){return R=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},R(t,e)}var k=function(t){function e(t){var n;return w(this,e),(n=E(this,e,[t])).loader=new r.Y9S(n.manager),n.parser=null,n.meshBuilder=new L(n.manager),n.animationBuilder=new B,n}return P(e,t),T(e,[{key:"setAnimationPath",value:function(t){return this.animationPath=t,this}},{key:"load",value:function(t,e,n,i){var o,a=this.meshBuilder.setCrossOrigin(this.crossOrigin);o=""!==this.resourcePath?this.resourcePath:""!==this.path?this.path:r.r6x.extractUrlBase(t);var s=this._extractExtension(t).toLowerCase();"pmd"===s||"pmx"===s?this["pmd"===s?"loadPMD":"loadPMX"](t,(function(t){e(a.build(t,o,n,i))}),n,i):i&&i(new Error("THREE.MMDLoader: Unknown model file extension ."+s+"."))}},{key:"loadAnimation",value:function(t,e,n,r,i){var o=this.animationBuilder;this.loadVMD(t,(function(t){n(e.isCamera?o.buildCameraAnimation(t):o.build(t,e))}),r,i)}},{key:"loadWithAnimation",value:function(t,e,n,r,i){var o=this;this.load(t,(function(t){o.loadAnimation(e,t,(function(e){n({mesh:t,animation:e})}),r,i)}),r,i)}},{key:"loadPMD",value:function(t,e,n,r){var i=this._getParser();this.loader.setMimeType(void 0).setPath(this.path).setResponseType("arraybuffer").setRequestHeader(this.requestHeader).setWithCredentials(this.withCredentials).load(t,(function(t){try{e(i.parsePmd(t,!0))}catch(t){r&&r(t)}}),n,r)}},{key:"loadPMX",value:function(t,e,n,r){var i=this._getParser();this.loader.setMimeType(void 0).setPath(this.path).setResponseType("arraybuffer").setRequestHeader(this.requestHeader).setWithCredentials(this.withCredentials).load(t,(function(t){try{e(i.parsePmx(t,!0))}catch(t){r&&r(t)}}),n,r)}},{key:"loadVMD",value:function(t,e,n,r){var i=Array.isArray(t)?t:[t],o=[],a=i.length,s=this._getParser();this.loader.setMimeType(void 0).setPath(this.animationPath).setResponseType("arraybuffer").setRequestHeader(this.requestHeader).setWithCredentials(this.withCredentials);for(var u=0,c=i.length;u<c;u++)this.loader.load(i[u],(function(t){try{o.push(s.parseVmd(t,!0)),o.length===a&&e(s.mergeVmds(o))}catch(t){r&&r(t)}}),n,r)}},{key:"loadVPD",value:function(t,e,n,r,i){var o=this._getParser();this.loader.setMimeType(e?void 0:"text/plain; charset=shift_jis").setPath(this.animationPath).setResponseType("text").setRequestHeader(this.requestHeader).setWithCredentials(this.withCredentials).load(t,(function(t){try{n(o.parseVpd(t,!0))}catch(t){i&&i(t)}}),r,i)}},{key:"_extractExtension",value:function(t){var e=t.lastIndexOf(".");return e<0?"":t.slice(e+1)}},{key:"_getParser",value:function(){return null===this.parser&&(this.parser=new v.Parser),this.parser}}])}(r.aHM),C=["data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAL0lEQVRYR+3QQREAAAzCsOFfNJPBJ1XQS9r2hsUAAQIECBAgQIAAAQIECBAgsBZ4MUx/ofm2I/kAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAN0lEQVRYR+3WQREAMBACsZ5/bWiiMvgEBTt5cW37hjsBBAgQIECAwFwgyfYPCCBAgAABAgTWAh8aBHZBl14e8wAAAABJRU5ErkJggg==","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAOUlEQVRYR+3WMREAMAwDsYY/yoDI7MLwIiP40+RJklfcCCBAgAABAgTqArfb/QMCCBAgQIAAgbbAB3z/e0F3js2cAAAAAElFTkSuQmCC","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAN0lEQVRYR+3WQREAMBACsZ5/B5ilMvgEBTt5cW37hjsBBAgQIECAwFwgyfYPCCBAgAABAgTWAh81dWyx0gFwKAAAAABJRU5ErkJggg==","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAOklEQVRYR+3WoREAMAwDsWb/UQtCy9wxTOQJ/oQ8SXKKGwEECBAgQIBAXeDt7f4BAQQIECBAgEBb4AOz8Hzx7WLY4wAAAABJRU5ErkJggg==","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABPUlEQVRYR+1XwW7CMAy1+f9fZOMysSEOEweEOPRNdm3HbdOyIhAcklPrOs/PLy9RygBALxzcCDQFmgJNgaZAU6Ap0BR4PwX8gsRMVLssMRH5HcpzJEaWL7EVg9F1IHRlyqQohgVr4FGUlUcMJSjcUlDw0zvjeun70cLWmneoyf7NgBTQSniBTQQSuJAZsOnnaczjIMb5hCiuHKxokCrJfVnrctyZL0PkJAJe1HMil4nxeyi3Ypfn1kX51jpPvo/JeCNC4PhVdHdJw2XjBR8brF8PEIhNVn12AgP7uHsTBguBn53MUZCqv7Lp07Pn5k1Ro+uWmUNn7D+M57rtk7aG0Vo73xyF/fbFf0bPJjDXngnGocDTdFhygZjwUQrMNrDcmZlQT50VJ/g/UwNyHpu778+yW+/ksOz/BFo54P4AsUXMfRq7XWsAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAACMElEQVRYR+2Xv4pTQRTGf2dubhLdICiii2KnYKHVolhauKWPoGAnNr6BD6CvIVaihYuI2i1ia0BY0MZGRHQXjZj/mSPnnskfNWiWZUlzJ5k7M2cm833nO5Mziej2DWWJRUoCpQKlAntSQCqgw39/iUWAGmh37jrRnVsKlgpiqmkoGVABA7E57fvY+pJDdgKqF6HzFCSADkDq+F6AHABtQ+UMVE5D7zXod7fFNhTEckTbj5XQgHzNN+5tQvc5NG7C6BNkp6D3EmpXHDR+dQAjFLchW3VS9rlw3JBh+B7ys5Cf9z0GW1C/7P32AyBAOAz1q4jGliIH3YPuBnSfQX4OGreTIgEYQb/pBDtPnEQ4CivXYPAWBk13oHrB54yA9QuSn2H4AcKRpEILDt0BUzj+RLR1V5EqjD66NPRBVpLcQwjHoHYJOhsQv6U4mnzmrIXJCFr4LDwm/xBUoboG9XX4cc9VKdYoSA2yk5NQLJaKDUjTBoveG3Z2TElTxwjNK4M3LEZgUdDdruvcXzKBpStgp2NPiWi3ks9ZXxIoFVi+AvHLdc9TqtjL3/aYjpPlrzOcEnK62Szhimdd7xX232zFDTgtxezOu3WNMRLjiKgjtOhHVMd1loynVHvOgjuIIJMaELEqhJAV/RCSLbWTcfPFakFgFlALTRRvx+ok6Hlp/Q+v3fmx90bMyUzaEAhmM3KvHlXTL5DxnbGf/1M8RNNACLL5MNtPxP/mypJAqcDSFfgFhpYqWUzhTEAAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAL0lEQVRYR+3QQREAAAzCsOFfNJPBJ1XQS9r2hsUAAQIECBAgQIAAAQIECBAgsBZ4MUx/ofm2I/kAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAL0lEQVRYR+3QQREAAAzCsOFfNJPBJ1XQS9r2hsUAAQIECBAgQIAAAQIECBAgsBZ4MUx/ofm2I/kAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAL0lEQVRYR+3QQREAAAzCsOFfNJPBJ1XQS9r2hsUAAQIECBAgQIAAAQIECBAgsBZ4MUx/ofm2I/kAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAL0lEQVRYR+3QQREAAAzCsOFfNJPBJ1XQS9r2hsUAAQIECBAgQIAAAQIECBAgsBZ4MUx/ofm2I/kAAAAASUVORK5CYII="],N=[r.IE4,r.k6Q,r.kTp,r.CVz,r.Riy],L=function(){return T((function t(e){w(this,t),this.crossOrigin="anonymous",this.geometryBuilder=new j,this.materialBuilder=new I(e)}),[{key:"setCrossOrigin",value:function(t){return this.crossOrigin=t,this}},{key:"build",value:function(t,e,n,i){var o=this.geometryBuilder.build(t),a=this.materialBuilder.setCrossOrigin(this.crossOrigin).setResourcePath(e).build(t,o,n,i),s=new r.I46(o,a),u=new r.EAD(function(t){var e=t.geometry,n=[];if(e&&void 0!==e.bones){for(var i=0,o=e.bones.length;i<o;i++){var a=e.bones[i],s=new r.$Kf;n.push(s),s.name=a.name,s.position.fromArray(a.pos),s.quaternion.fromArray(a.rotq),void 0!==a.scl&&s.scale.fromArray(a.scl)}for(var u=0,c=e.bones.length;u<c;u++){var l=e.bones[u];-1!==l.parent&&null!==l.parent&&void 0!==n[l.parent]?n[l.parent].add(n[u]):t.add(n[u])}}return t.updateMatrixWorld(!0),n}(s));return s.bind(u),s}}])}(),j=function(){return T((function t(){w(this,t)}),[{key:"build",value:function(t){for(var e=[],n=[],i=[],o=[],a=[],s=[],u=[],c=[],l=[],f=[],h=[],p=[],d=[],m=[],y=0,v={},g=0;g<t.metadata.vertexCount;g++){for(var b=t.vertices[g],_=0,x=b.position.length;_<x;_++)e.push(b.position[_]);for(var w=0,S=b.normal.length;w<S;w++)i.push(b.normal[w]);for(var T=0,M=b.uv.length;T<M;T++)n.push(b.uv[T]);for(var E=0;E<4;E++)u.push(b.skinIndices.length-1>=E?b.skinIndices[E]:0);for(var A=0;A<4;A++)c.push(b.skinWeights.length-1>=A?b.skinWeights[A]:0)}for(var O=0;O<t.metadata.faceCount;O++)for(var P=t.faces[O],R=0,k=P.indices.length;R<k;R++)o.push(P.indices[R]);for(var C=0;C<t.metadata.materialCount;C++){var N=t.materials[C];a.push({offset:3*y,count:3*N.faceCount}),y+=N.faceCount}for(var L=0;L<t.metadata.rigidBodyCount;L++){var j=t.rigidBodies[L],I=v[j.boneIndex];I=void 0===I?j.type:Math.max(j.type,I),v[j.boneIndex]=I}for(var B=0;B<t.metadata.boneCount;B++){var U=t.bones[B],D={index:B,transformationClass:U.transformationClass,parent:U.parentIndex,name:U.name,pos:U.position.slice(0,3),rotq:[0,0,0,1],scl:[1,1,1],rigidBodyType:void 0!==v[B]?v[B]:-1};-1!==D.parent&&(D.pos[0]-=t.bones[D.parent].position[0],D.pos[1]-=t.bones[D.parent].position[1],D.pos[2]-=t.bones[D.parent].position[2]),s.push(D)}if("pmd"===t.metadata.format)for(var F=0;F<t.metadata.ikCount;F++){for(var z=t.iks[F],V={target:z.target,effector:z.effector,iteration:z.iteration,maxAngle:4*z.maxAngle,links:[]},G=0,H=z.links.length;G<H;G++){var W={};W.index=z.links[G].index,W.enabled=!0,t.bones[W.index].name.indexOf("ひざ")>=0&&(W.limitation=new r.Pq0(1,0,0)),V.links.push(W)}h.push(V)}else for(var q=0;q<t.metadata.boneCount;q++){var X=t.bones[q].ik;if(void 0!==X){for(var Y={target:q,effector:X.effector,iteration:X.iteration,maxAngle:X.maxAngle,links:[]},J=0,Z=X.links.length;J<Z;J++){var K={};if(K.index=X.links[J].index,K.enabled=!0,1===X.links[J].angleLimitation){var Q=X.links[J].lowerLimitationAngle,$=X.links[J].upperLimitationAngle,tt=-$[0],et=-$[1];$[0]=-Q[0],$[1]=-Q[1],Q[0]=tt,Q[1]=et,K.rotationMin=(new r.Pq0).fromArray(Q),K.rotationMax=(new r.Pq0).fromArray($)}Y.links.push(K)}h.push(Y),s[q].ik=Y}}if("pmx"===t.metadata.format){for(var nt={},rt=0;rt<t.metadata.boneCount;rt++){var it=t.bones[rt],ot=it.grant;if(void 0!==ot){var at={index:rt,parentIndex:ot.parentIndex,ratio:ot.ratio,isLocal:ot.isLocal,affectRotation:ot.affectRotation,affectPosition:ot.affectPosition,transformationClass:it.transformationClass};nt[rt]={parent:null,children:[],param:at,visited:!1}}}var st={parent:null,children:[],param:null,visited:!1};for(var ut in nt){var ct=nt[ut],lt=nt[ct.parentIndex]||st;ct.parent=lt,lt.children.push(ct)}!function t(e){e.param&&(p.push(e.param),s[e.param.index].grant=e.param),e.visited=!0;for(var n=0,r=e.children.length;n<r;n++){var i=e.children[n];i.visited||t(i)}}(st)}function ft(e,n,r){for(var i=0;i<n.elementCount;i++){var o,a=n.elements[i];o="pmd"===t.metadata.format?t.morphs[0].elements[a.index].index:a.index,e.array[3*o+0]+=a.position[0]*r,e.array[3*o+1]+=a.position[1]*r,e.array[3*o+2]+=a.position[2]*r}}for(var ht=0;ht<t.metadata.morphCount;ht++){var pt=t.morphs[ht],dt={name:pt.name},mt=new r.qtW(3*t.metadata.vertexCount,3);mt.name=pt.name;for(var yt=0;yt<3*t.metadata.vertexCount;yt++)mt.array[yt]=e[yt];if("pmd"===t.metadata.format)0!==ht&&ft(mt,pt,1);else if(0===pt.type)for(var vt=0;vt<pt.elementCount;vt++){var gt=t.morphs[pt.elements[vt].index],bt=pt.elements[vt].ratio;1===gt.type&&ft(mt,gt,bt)}else 1===pt.type?ft(mt,pt,1):2===pt.type||3===pt.type||4===pt.type||5===pt.type||6===pt.type||7===pt.type||pt.type;l.push(dt),f.push(mt)}for(var _t=0;_t<t.metadata.rigidBodyCount;_t++){var xt=t.rigidBodies[_t],wt={};for(var St in xt)wt[St]=xt[St];if("pmx"===t.metadata.format&&-1!==wt.boneIndex){var Tt=t.bones[wt.boneIndex];wt.position[0]-=Tt.position[0],wt.position[1]-=Tt.position[1],wt.position[2]-=Tt.position[2]}d.push(wt)}for(var Mt=0;Mt<t.metadata.constraintCount;Mt++){var Et=t.constraints[Mt],At={};for(var Ot in Et)At[Ot]=Et[Ot];var Pt=d[At.rigidBodyIndex1],Rt=d[At.rigidBodyIndex2];0!==Pt.type&&2===Rt.type&&-1!==Pt.boneIndex&&-1!==Rt.boneIndex&&t.bones[Rt.boneIndex].parentIndex===Pt.boneIndex&&(Rt.type=1),m.push(At)}var kt=new r.LoY;kt.setAttribute("position",new r.qtW(e,3)),kt.setAttribute("normal",new r.qtW(i,3)),kt.setAttribute("uv",new r.qtW(n,2)),kt.setAttribute("skinIndex",new r.A$4(u,4)),kt.setAttribute("skinWeight",new r.qtW(c,4)),kt.setIndex(o);for(var Ct=0,Nt=a.length;Ct<Nt;Ct++)kt.addGroup(a[Ct].offset,a[Ct].count,Ct);return kt.bones=s,kt.morphTargets=l,kt.morphAttributes.position=f,kt.morphTargetsRelative=!1,kt.userData.MMD={bones:s,iks:h,grants:p,rigidBodies:d,constraints:m,format:t.metadata.format},kt.computeBoundingSphere(),kt}}])}(),I=function(){return T((function t(e){w(this,t),this.manager=e,this.textureLoader=new r.Tap(this.manager),this.tgaLoader=null,this.crossOrigin="anonymous",this.resourcePath=void 0}),[{key:"setCrossOrigin",value:function(t){return this.crossOrigin=t,this}},{key:"setResourcePath",value:function(t){return this.resourcePath=t,this}},{key:"build",value:function(t,e){var n=[],i={};this.textureLoader.setCrossOrigin(this.crossOrigin);for(var o=0;o<t.metadata.materialCount;o++){var a,s,u=t.materials[o],c={userData:{MMD:{}}};if(void 0!==u.name&&(c.name=u.name),c.diffuse=(new r.Q1f).setRGB(u.diffuse[0],u.diffuse[1],u.diffuse[2],r.er$),c.opacity=u.diffuse[3],c.specular=(a=new r.Q1f).setRGB.apply(a,_(u.specular).concat([r.er$])),c.shininess=u.shininess,c.emissive=(s=new r.Q1f).setRGB.apply(s,_(u.ambient).concat([r.er$])),c.transparent=1!==c.opacity,c.fog=!0,c.blending=r.bCz,c.blendSrc=r.ie2,c.blendDst=r.OuU,c.blendSrcAlpha=r.ie2,c.blendDstAlpha=r.hdd,"pmx"!==t.metadata.format||1&~u.flag?c.side=1===c.opacity?r.hB5:r.$EB:c.side=r.$EB,"pmd"===t.metadata.format){if(u.fileName){var l=u.fileName.split("*");if(c.map=this._loadTexture(l[0],i),l.length>1){var f=l[1].slice(-4).toLowerCase();c.matcap=this._loadTexture(l[1],i),c.matcapCombine=".sph"===f?r.caT:r.XrR}}var h=-1===u.toonIndex?"toon00.bmp":t.toonTextures[u.toonIndex].fileName;c.gradientMap=this._loadTexture(h,i,{isToonTexture:!0,isDefaultToonTexture:this._isDefaultToonTexture(h)}),c.userData.outlineParameters={thickness:1===u.edgeFlag?.003:0,color:[0,0,0],alpha:1,visible:1===u.edgeFlag}}else{-1!==u.textureIndex&&(c.map=this._loadTexture(t.textures[u.textureIndex],i),c.userData.MMD.mapFileName=t.textures[u.textureIndex]),-1===u.envTextureIndex||1!==u.envFlag&&2!=u.envFlag||(c.matcap=this._loadTexture(t.textures[u.envTextureIndex],i),c.userData.MMD.matcapFileName=t.textures[u.envTextureIndex],c.matcapCombine=1===u.envFlag?r.caT:r.XrR);var p=void 0,d=void 0;-1===u.toonIndex||0!==u.toonFlag?(p="toon"+("0"+(u.toonIndex+1)).slice(-2)+".bmp",d=!0):(p=t.textures[u.toonIndex],d=!1),c.gradientMap=this._loadTexture(p,i,{isToonTexture:!0,isDefaultToonTexture:d}),c.userData.outlineParameters={thickness:u.edgeSize/300,color:u.edgeColor.slice(0,3),alpha:u.edgeColor[3],visible:!!(16&u.flag)&&u.edgeSize>0}}void 0!==c.map&&(c.transparent||this._checkImageTransparency(c.map,e,o),c.emissive.multiplyScalar(.2)),n.push(new D(c))}if("pmx"===t.metadata.format)for(var m=function(t,e){for(var n=0,r=t.length;n<r;n++){var i=t[n];if(-1!==i.index){var o=e[i.index];o.opacity!==i.diffuse[3]&&(o.transparent=!0)}}},y=0,v=t.morphs.length;y<v;y++){var g=t.morphs[y],b=g.elements;if(0===g.type)for(var x=0,w=b.length;x<w;x++){var S=t.morphs[b[x].index];8===S.type&&m(S.elements,n)}else 8===g.type&&m(b,n)}return n}},{key:"_getTGALoader",value:function(){if(null===this.tgaLoader){if(void 0===h)throw new Error("THREE.MMDLoader: Import TGALoader");this.tgaLoader=new h(this.manager)}return this.tgaLoader}},{key:"_isDefaultToonTexture",value:function(t){return 10===t.length&&/toon(10|0[0-9])\.bmp/.test(t)}},{key:"_loadTexture",value:function(t,e,n,i,o){var a,s=this;if(!0===(n=n||{}).isDefaultToonTexture){var u;try{u=parseInt(t.match(/toon([0-9]{2})\.bmp$/)[1])}catch(e){console.warn("THREE.MMDLoader: "+t+" seems like a not right default texture path. Using toon00.bmp instead."),u=0}a=C[u]}else a=this.resourcePath+t;if(void 0!==e[a])return e[a];var c=this.manager.getHandler(a);null===c&&(c=".tga"===t.slice(-4).toLowerCase()?this._getTGALoader():this.textureLoader);var l=c.load(a,(function(t){!0===n.isToonTexture&&(t.image=s._getRotatedImage(t.image),t.magFilter=r.hxR,t.minFilter=r.hxR),t.flipY=!1,t.wrapS=r.GJx,t.wrapT=r.GJx,t.colorSpace=r.er$;for(var e=0;e<l.readyCallbacks.length;e++)l.readyCallbacks[e](l);delete l.readyCallbacks}),i,o);return l.readyCallbacks=[],e[a]=l,l}},{key:"_getRotatedImage",value:function(t){var e=document.createElement("canvas"),n=e.getContext("2d"),r=t.width,i=t.height;return e.width=r,e.height=i,n.clearRect(0,0,r,i),n.translate(r/2,i/2),n.rotate(.5*Math.PI),n.translate(-r/2,-i/2),n.drawImage(t,0,0),n.getImageData(0,0,r,i)}},{key:"_checkImageTransparency",value:function(t,e,n){t.readyCallbacks.push((function(r){function i(t,e){var n=t.width,r=t.height,i=Math.round(e.x*n)%n,o=Math.round(e.y*r)%r;i<0&&(i+=n),o<0&&(o+=r);var a=o*n+i;return t.data[4*a+3]}if(!0!==r.isCompressedTexture){var o=void 0!==r.image.data?r.image:function(t){var e=document.createElement("canvas");e.width=t.width,e.height=t.height;var n=e.getContext("2d");return n.drawImage(t,0,0),n.getImageData(0,0,e.width,e.height)}(r.image),a=e.groups[n];(function(t,e,n){var r=t.width,o=t.height;if(t.data.length/(r*o)!=4)return!1;for(var a=0;a<n.length;a+=3){for(var s={x:0,y:0},u=0;u<3;u++){var c=n[3*a+u],l={x:e[2*c+0],y:e[2*c+1]};if(i(t,l)<253)return!0;s.x+=l.x,s.y+=l.y}if(s.x/=3,s.y/=3,i(t,s)<253)return!0}return!1})(o,e.attributes.uv.array,e.index.array.slice(a.start,a.start+a.count))&&(t.transparent=!0)}else N.includes(r.format)?t.transparent=!1:t.transparent=!0}))}}])}(),B=function(){return T((function t(){w(this,t)}),[{key:"build",value:function(t,e){for(var n=this.buildSkeletalAnimation(t,e).tracks,i=this.buildMorphAnimation(t,e).tracks,o=0,a=i.length;o<a;o++)n.push(i[o]);return new r.tz3("",-1,n)}},{key:"buildSkeletalAnimation",value:function(t,e){function n(t,e,n){t.push(e[n+0]/127),t.push(e[n+8]/127),t.push(e[n+4]/127),t.push(e[n+12]/127)}for(var i=[],o={},a=e.skeleton.bones,s={},u=0,c=a.length;u<c;u++)s[a[u].name]=!0;for(var l=0;l<t.metadata.motionCount;l++){var f=t.motions[l],h=f.boneName;void 0!==s[h]&&(o[h]=o[h]||[],o[h].push(f))}for(var p in o){var d=o[p];d.sort((function(t,e){return t.frameNum-e.frameNum}));for(var m=[],y=[],v=[],g=[],b=[],_=e.skeleton.getBoneByName(p).position.toArray(),x=0,w=d.length;x<w;x++){var S=d[x].frameNum/30,T=d[x].position,M=d[x].rotation,E=d[x].interpolation;m.push(S);for(var A=0;A<3;A++)y.push(_[A]+T[A]);for(var O=0;O<4;O++)v.push(M[O]);for(var P=0;P<3;P++)n(g,E,P);n(b,E,3)}var R=".bones["+p+"]";i.push(this._createTrack(R+".position",r.RiT,m,y,g)),i.push(this._createTrack(R+".quaternion",r.MBL,m,v,b))}return new r.tz3("",-1,i)}},{key:"buildMorphAnimation",value:function(t,e){for(var n=[],i={},o=e.morphTargetDictionary,a=0;a<t.metadata.morphCount;a++){var s=t.morphs[a],u=s.morphName;void 0!==o[u]&&(i[u]=i[u]||[],i[u].push(s))}for(var c in i){var l=i[c];l.sort((function(t,e){return t.frameNum-e.frameNum}));for(var f=[],h=[],p=0,d=l.length;p<d;p++)f.push(l[p].frameNum/30),h.push(l[p].weight);n.push(new r.Hit(".morphTargetInfluences["+o[c]+"]",f,h))}return new r.tz3("",-1,n)}},{key:"buildCameraAnimation",value:function(t){function e(t,e){t.push(e.x),t.push(e.y),t.push(e.z)}function n(t,e,n){t.push(e[4*n+0]/127),t.push(e[4*n+1]/127),t.push(e[4*n+2]/127),t.push(e[4*n+3]/127)}var i=void 0===t.cameras?[]:t.cameras.slice();i.sort((function(t,e){return t.frameNum-e.frameNum}));for(var o,a,s=[],u=[],c=[],l=[],f=[],h=[],p=[],d=[],m=[],y=new r.PTz,v=new r.O9p,g=new r.Pq0,b=new r.Pq0,_=0,x=i.length;_<x;_++){var w=i[_],S=w.frameNum/30,T=w.position,M=w.rotation,E=w.distance,A=w.fov,O=w.interpolation;s.push(S),g.set(0,0,-E),b.set(T[0],T[1],T[2]),v.set(-M[0],-M[1],-M[2]),y.setFromEuler(v),g.add(b),g.applyQuaternion(y),e(u,b),(o=c).push((a=y).x),o.push(a.y),o.push(a.z),o.push(a.w),e(l,g),f.push(A);for(var P=0;P<3;P++)n(h,O,P);n(p,O,3);for(var R=0;R<3;R++)n(d,O,4);n(m,O,5)}var k=[];return k.push(this._createTrack("target.position",r.RiT,s,u,h)),k.push(this._createTrack(".quaternion",r.MBL,s,c,p)),k.push(this._createTrack(".position",r.RiT,s,l,d)),k.push(this._createTrack(".fov",r.Hit,s,f,m)),new r.tz3("",-1,k)}},{key:"_createTrack",value:function(t,e,n,r,i){if(n.length>2){n=n.slice(),r=r.slice(),i=i.slice();for(var o=r.length/n.length,a=i.length/n.length,s=1,u=2,c=n.length;u<c;u++){for(var l=0;l<o;l++)if(r[s*o+l]!==r[(s-1)*o+l]||r[s*o+l]!==r[u*o+l]){s++;break}if(u>s){n[s]=n[u];for(var f=0;f<o;f++)r[s*o+f]=r[u*o+f];for(var h=0;h<a;h++)i[s*a+h]=i[u*a+h]}}n.length=s+1,r.length=(s+1)*o,i.length=(s+1)*a}var p=new e(t,n,r);return p.createInterpolant=function(t){return new U(this.times,this.values,this.getValueSize(),t,new Float32Array(i))},p}}])}(),U=function(t){function e(t,n,r,i,o){var a;return w(this,e),(a=E(this,e,[t,n,r,i])).interpolationParams=o,a}return P(e,t),T(e,[{key:"interpolate_",value:function(t,e,n,i){var o=this.resultBuffer,a=this.sampleValues,s=this.valueSize,u=this.interpolationParams,c=t*s,l=c-s,f=i-e<.05?0:(n-e)/(i-e);if(4===s){var h=u[4*t+0],p=u[4*t+1],d=u[4*t+2],m=u[4*t+3],y=this._calculate(h,p,d,m,f);r.PTz.slerpFlat(o,0,a,l,a,c,y)}else if(3===s)for(var v=0;v!==s;++v){var g=u[12*t+4*v+0],b=u[12*t+4*v+1],_=u[12*t+4*v+2],x=u[12*t+4*v+3],w=this._calculate(g,b,_,x,f);o[v]=a[l+v]*(1-w)+a[c+v]*w}else{var S=u[4*t+0],T=u[4*t+1],M=u[4*t+2],E=u[4*t+3],A=this._calculate(S,T,M,E,f);o[0]=a[l]*(1-A)+a[c]*A}return o}},{key:"_calculate",value:function(t,e,n,r,i){for(var o,a,s,u=.5,c=u,l=1-c,f=Math,h=0;h<15;h++){var p=(o=3*l*l*c)*t+(a=3*l*c*c)*e+(s=c*c*c)-i;if(f.abs(p)<1e-5)break;u/=2,l=1-(c+=p<0?u:-u)}return o*n+a*r+s}}])}(r.lGw),D=function(t){function e(t){var n;w(this,e),(n=E(this,e)).isMMDToonMaterial=!0,n.type="MMDToonMaterial",n._matcapCombine=r.XrR,n.emissiveIntensity=1,n.normalMapType=r.bI3,n.combine=r.caT,n.wireframeLinecap="round",n.wireframeLinejoin="round",n.flatShading=!1,n.lights=!0,n.vertexShader=i.vertexShader,n.fragmentShader=i.fragmentShader,n.defines=Object.assign({},i.defines),Object.defineProperty(n,"matcapCombine",{get:function(){return this._matcapCombine},set:function(t){switch(this._matcapCombine=t,t){case r.caT:this.defines.MATCAP_BLENDING_MULTIPLY=!0,delete this.defines.MATCAP_BLENDING_ADD;break;default:case r.XrR:this.defines.MATCAP_BLENDING_ADD=!0,delete this.defines.MATCAP_BLENDING_MULTIPLY}}}),n.uniforms=r.LlO.clone(i.uniforms);for(var o=function(){var t=s[a];Object.defineProperty(n,t,{get:function(){return this.uniforms[t].value},set:function(e){this.uniforms[t].value=e}})},a=0,s=["specular","opacity","diffuse","map","matcap","gradientMap","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveMap","bumpMap","bumpScale","normalMap","normalScale","displacemantBias","displacemantMap","displacemantScale","specularMap","alphaMap","reflectivity","refractionRatio"];a<s.length;a++)o();return n._shininess=30,Object.defineProperty(n,"shininess",{get:function(){return this._shininess},set:function(t){this._shininess=t,this.uniforms.shininess.value=Math.max(this._shininess,1e-4)}}),Object.defineProperty(n,"color",Object.getOwnPropertyDescriptor(n,"diffuse")),n.setValues(t),n}return P(e,t),T(e,[{key:"copy",value:function(t){return b(O(e.prototype),"copy",this).call(this,t),this.matcapCombine=t.matcapCombine,this.emissiveIntensity=t.emissiveIntensity,this.normalMapType=t.normalMapType,this.combine=t.combine,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this}}])}(r.BKk)},337:(t,e,n)=>{n.r(e),n.d(e,{AONode:()=>Iy,AfterImageNode:()=>TR,AmbientLightNode:()=>zN,AnalyticLightNode:()=>hy,AnamorphicNode:()=>jR,ArrayElementNode:()=>st,AssignNode:()=>mr,AttributeNode:()=>Br,BRDF_GGX:()=>uI,BRDF_Lambert:()=>Sj,BatchNode:()=>Hd,BitangentNode:()=>kM,BlendModeNode:()=>zA,Break:()=>pm,BufferAttributeNode:()=>od,BufferNode:()=>Bl,BumpMapNode:()=>nO,BypassNode:()=>Xr,CacheNode:()=>ci,CameraNode:()=>$f,CheckerNode:()=>sL,CodeNode:()=>Pa,ColorAdjustmentNode:()=>mO,ColorSpaceNode:()=>Wc,ComputeNode:()=>SC,CondNode:()=>nv,ConstNode:()=>me,ContextNode:()=>xi,Continue:()=>hm,ConvertNode:()=>gt,CubeTextureNode:()=>Wm,DFGApprox:()=>lI,D_GGX:()=>aI,DirectionalLightNode:()=>nN,DiscardNode:()=>kw,EPSILON:()=>Mu,EnvironmentNode:()=>Jv,EquirectUVNode:()=>I_,ExpressionNode:()=>il,F_Schlick:()=>wj,FogExp2Node:()=>eC,FogNode:()=>jk,FogRangeNode:()=>Wk,FrontFacingNode:()=>vb,FunctionCallNode:()=>WR,FunctionNode:()=>Ha,FunctionOverloadingNode:()=>Hw,GLSLNodeParser:()=>MU,GaussianBlurNode:()=>hR,HashNode:()=>pw,HemisphereLightNode:()=>KN,IESSpotLightNode:()=>CN,INFINITY:()=>Eu,If:()=>Mn,IndexNode:()=>Ci,InstanceNode:()=>gd,InstancedPointsNodeMaterial:()=>PL,JoinNode:()=>Ot,LightNode:()=>LC,LightingContextNode:()=>qy,LightingModel:()=>Di,LightingNode:()=>ey,LightsNode:()=>Ty,Line2NodeMaterial:()=>rj,LineBasicNodeMaterial:()=>BL,LineDashedNodeMaterial:()=>XL,LoopNode:()=>lm,MatcapUVNode:()=>eS,MaterialNode:()=>Qh,MaterialReferenceNode:()=>Mf,MathNode:()=>Tu,MaxMipLevelNode:()=>dl,MeshBasicNodeMaterial:()=>xj,MeshLambertNodeMaterial:()=>Hj,MeshNormalNodeMaterial:()=>pj,MeshPhongNodeMaterial:()=>eI,MeshPhysicalNodeMaterial:()=>tB,MeshSSSNodeMaterial:()=>dB,MeshStandardNodeMaterial:()=>GI,ModelNode:()=>gh,ModelViewProjectionNode:()=>Jp,MorphNode:()=>Mm,Node:()=>F,NodeAttribute:()=>no,NodeBuilder:()=>Cx,NodeCache:()=>ti,NodeCode:()=>Ao,NodeFrame:()=>Bx,NodeFunctionInput:()=>Ux.A,NodeKeywords:()=>Lo,NodeLoader:()=>bL,NodeMaterial:()=>Cb,NodeMaterialLoader:()=>XB,NodeObjectLoader:()=>rU,NodeShaderStage:()=>o,NodeType:()=>s,NodeUniform:()=>so,NodeUpdateType:()=>a,NodeUtils:()=>r,NodeVar:()=>po,NodeVarying:()=>xo,NormalMapNode:()=>kO,NormalNode:()=>jh,Object3DNode:()=>If,OperatorNode:()=>Xs,OscNode:()=>ES,OutputStructNode:()=>rw,PI:()=>Au,PI2:()=>Ou,PMREMNode:()=>Bv,PMREMUtils:()=>i,PackingNode:()=>DS,ParameterNode:()=>va,PassNode:()=>BP,PhongLightingModel:()=>Lj,PhysicalLightingModel:()=>CI,PointLightNode:()=>qC,PointUVNode:()=>jE,PointsNodeMaterial:()=>MB,PositionNode:()=>Lp,PosterizeNode:()=>zO,PropertyNode:()=>Ho,RangeNode:()=>pC,ReferenceNode:()=>df,ReflectVectorNode:()=>jm,ReflectorNode:()=>xM,RemapNode:()=>ZS,RendererReferenceNode:()=>oE,RotateNode:()=>vT,RotateUVNode:()=>sT,SceneNode:()=>WE,Schlick_to_F0:()=>pI,ScriptableNode:()=>Mk,ScriptableValueNode:()=>nk,SetNode:()=>Jt,ShaderNode:()=>mn,SkinningNode:()=>tm,SplitNode:()=>Ft,SpotLightNode:()=>hN,SpriteNodeMaterial:()=>IB,SpriteSheetUVNode:()=>AT,StackNode:()=>E_,StorageArrayElementNode:()=>UT,StorageBufferNode:()=>rA,TBNViewMatrix:()=>UM,TangentNode:()=>Pd,TempNode:()=>Q,TextureBicubicNode:()=>ME,TextureNode:()=>Ml,TextureStoreNode:()=>mA,TimerNode:()=>hS,ToneMappingNode:()=>lP,TriplanarTexturesNode:()=>YT,UVNode:()=>As,UniformGroupNode:()=>ss,UniformNode:()=>vs,UniformsNode:()=>Ql,UserDataNode:()=>AA,V_GGX_SmithCorrelated:()=>oI,VarNode:()=>Ji,VaryingNode:()=>Er,VertexColorNode:()=>JM,ViewportDepthNode:()=>Jg,ViewportDepthTextureNode:()=>Lg,ViewportNode:()=>sg,ViewportSharedTextureNode:()=>wP,ViewportTextureNode:()=>Tg,abs:()=>Zu,acos:()=>Yu,add:()=>Ys,addLightNode:()=>Ay,addNodeClass:()=>z,addNodeElement:()=>Ce,addNodeMaterial:()=>Nb,afterImage:()=>SR,all:()=>Pu,anamorphic:()=>LR,and:()=>ou,any:()=>Ru,append:()=>En,arrayBuffer:()=>rr,asin:()=>Xu,assign:()=>yr,atan:()=>Ju,atan2:()=>uc,attribute:()=>Ur,backgroundBlurriness:()=>qE,backgroundIntensity:()=>XE,batch:()=>Wd,bitAnd:()=>cu,bitNot:()=>lu,bitOr:()=>fu,bitXor:()=>hu,bitangentGeometry:()=>CM,bitangentLocal:()=>NM,bitangentView:()=>LM,bitangentWorld:()=>jM,bitcast:()=>sc,bmat2:()=>Xn,bmat3:()=>Kn,bmat4:()=>er,bool:()=>kn,buffer:()=>Ul,bufferAttribute:()=>ad,bumpMap:()=>rO,burn:()=>VA,bvec2:()=>jn,bvec3:()=>Dn,bvec4:()=>Gn,bypass:()=>Yr,cache:()=>li,call:()=>qR,cameraFar:()=>rh,cameraLogDepth:()=>ih,cameraNear:()=>nh,cameraNormalMatrix:()=>ah,cameraPosition:()=>uh,cameraProjectionMatrix:()=>th,cameraProjectionMatrixInverse:()=>eh,cameraViewMatrix:()=>oh,cameraWorldMatrix:()=>sh,cbrt:()=>Sc,ceil:()=>zu,checker:()=>uL,clamp:()=>Ec,clearcoat:()=>Zo,clearcoatRoughness:()=>Ko,code:()=>Ra,color:()=>An,colorSpaceToLinear:()=>Xc,colorToDirection:()=>zS,compute:()=>TC,cond:()=>rv,context:()=>wi,convert:()=>or,cos:()=>Wu,createNodeFromType:()=>V,createNodeMaterialFromType:()=>Lb,cross:()=>vc,cubeTexture:()=>qm,dFdx:()=>ec,dFdy:()=>nc,dashSize:()=>aa,defaultBuildStages:()=>c,defaultShaderStages:()=>u,degrees:()=>Nu,densityFog:()=>nC,depth:()=>Kg,depthPass:()=>FP,depthPixel:()=>$g,depthTexture:()=>Qg,difference:()=>mc,diffuseColor:()=>Xo,directionToColor:()=>FS,discard:()=>Nw,distance:()=>dc,div:()=>Ks,dodge:()=>GA,dot:()=>yc,dynamicBufferAttribute:()=>sd,element:()=>ir,equal:()=>$s,equals:()=>ku,equirectUV:()=>B_,exp:()=>Lu,exp2:()=>ju,expression:()=>ol,faceDirection:()=>bb,faceForward:()=>Rc,float:()=>On,floor:()=>Fu,fog:()=>Ik,fract:()=>Gu,frameGroup:()=>is,frameId:()=>yS,frontFacing:()=>gb,fwidth:()=>ac,gain:()=>yw,gapSize:()=>sa,gaussianBlur:()=>fR,getConstNodeType:()=>dn,getCurrentStack:()=>Tn,getDistanceAttenuation:()=>IC,getGeometryRoughness:()=>nI,getRoughness:()=>iI,global:()=>Sk,glsl:()=>Na,glslFn:()=>qa,greaterThan:()=>nu,greaterThanEqual:()=>iu,hash:()=>dw,hue:()=>gO,imat2:()=>Wn,imat3:()=>Jn,imat4:()=>$n,instance:()=>bd,instanceIndex:()=>Li,instancedBufferAttribute:()=>ud,instancedDynamicBufferAttribute:()=>cd,int:()=>Pn,inverseSqrt:()=>Du,iridescence:()=>ta,iridescenceIOR:()=>ea,iridescenceThickness:()=>na,ivec2:()=>Nn,ivec3:()=>Bn,ivec4:()=>zn,js:()=>ka,label:()=>Si,length:()=>Qu,lengthSq:()=>Tc,lessThan:()=>eu,lessThanEqual:()=>ru,lightTargetDirection:()=>jC,lightingContext:()=>Xy,lights:()=>My,lightsNode:()=>Ey,linearToColorSpace:()=>qc,linearTosRGB:()=>Yc,log:()=>Iu,log2:()=>Bu,loop:()=>fm,lumaCoeffs:()=>bO,luminance:()=>_O,mat2:()=>Hn,mat3:()=>Yn,mat4:()=>Qn,matcapUV:()=>nS,materialAlphaTest:()=>$h,materialClearcoat:()=>lp,materialClearcoatNormal:()=>hp,materialClearcoatRoughness:()=>fp,materialColor:()=>tp,materialEmissive:()=>np,materialIridescence:()=>yp,materialIridescenceIOR:()=>vp,materialIridescenceThickness:()=>gp,materialLineDashOffset:()=>Sp,materialLineDashSize:()=>_p,materialLineGapSize:()=>xp,materialLineScale:()=>bp,materialLineWidth:()=>wp,materialMetalness:()=>up,materialNormal:()=>cp,materialOpacity:()=>rp,materialPointWidth:()=>Tp,materialReference:()=>Ef,materialReflectivity:()=>ap,materialRotation:()=>pp,materialRoughness:()=>sp,materialSheen:()=>dp,materialSheenRoughness:()=>mp,materialShininess:()=>ep,materialSpecularColor:()=>ip,materialSpecularStrength:()=>op,max:()=>lc,maxMipLevel:()=>ml,metalness:()=>Jo,min:()=>cc,mix:()=>Mc,mod:()=>fc,modelDirection:()=>bh,modelNormalMatrix:()=>xh,modelPosition:()=>Sh,modelScale:()=>Th,modelViewMatrix:()=>_h,modelViewPosition:()=>Mh,modelViewProjection:()=>Zp,modelWorldMatrix:()=>wh,morphReference:()=>Em,mul:()=>Zs,mx_aastep:()=>YD,mx_cell_noise_float:()=>lF,mx_contrast:()=>rF,mx_fractal_noise_float:()=>fF,mx_fractal_noise_vec2:()=>hF,mx_fractal_noise_vec3:()=>pF,mx_fractal_noise_vec4:()=>dF,mx_hsvtorgb:()=>HD,mx_noise_float:()=>iF,mx_noise_vec3:()=>oF,mx_noise_vec4:()=>aF,mx_ramplr:()=>ZD,mx_ramptb:()=>KD,mx_rgbtohsv:()=>WD,mx_safepower:()=>nF,mx_splitlr:()=>$D,mx_splittb:()=>tF,mx_srgb_texture_to_lin_rec709:()=>XD,mx_transform_uv:()=>eF,mx_worley_noise_float:()=>sF,mx_worley_noise_vec2:()=>uF,mx_worley_noise_vec3:()=>cF,negate:()=>$u,nodeArray:()=>gn,nodeImmutable:()=>_n,nodeObject:()=>yn,nodeObjects:()=>vn,nodeProxy:()=>bn,normalGeometry:()=>Ih,normalLocal:()=>Bh,normalMap:()=>CO,normalView:()=>Uh,normalWorld:()=>Dh,normalize:()=>Vu,not:()=>su,objectDirection:()=>Bf,objectGroup:()=>as,objectNormalMatrix:()=>Df,objectPosition:()=>zf,objectScale:()=>Vf,objectViewMatrix:()=>Uf,objectViewPosition:()=>Gf,objectWorldMatrix:()=>Ff,oneMinus:()=>tc,or:()=>au,orthographicDepthToViewZ:()=>qg,oscSawtooth:()=>RS,oscSine:()=>AS,oscSquare:()=>OS,oscTriangle:()=>PS,output:()=>oa,outputStruct:()=>iw,overlay:()=>HA,overloadingFn:()=>qw,parabola:()=>mw,parallaxDirection:()=>DM,parallaxUV:()=>FM,parameter:()=>ga,pass:()=>UP,pcurve:()=>vw,perspectiveDepthToViewZ:()=>Yg,pmremTexture:()=>Iv,pointUV:()=>IE,pointWidth:()=>ua,positionGeometry:()=>jp,positionLocal:()=>Ip,positionView:()=>Dp,positionViewDirection:()=>Fp,positionWorld:()=>Bp,positionWorldDirection:()=>Up,posterize:()=>VO,pow:()=>gc,pow2:()=>bc,pow3:()=>_c,pow4:()=>xc,property:()=>Wo,radians:()=>Cu,range:()=>dC,rangeFog:()=>qk,reciprocal:()=>ic,reference:()=>mf,referenceBuffer:()=>yf,reflect:()=>pc,reflectVector:()=>Im,reflector:()=>_M,refract:()=>Oc,remainder:()=>Qs,remap:()=>KS,remapClamp:()=>QS,renderGroup:()=>os,rendererReference:()=>aE,rotate:()=>gT,rotateUV:()=>uT,roughness:()=>Yo,round:()=>rc,sRGBToLinear:()=>Jc,sampler:()=>Ol,saturate:()=>Ac,saturation:()=>yO,screen:()=>WA,scriptable:()=>Ek,scriptableValue:()=>rk,setCurrentStack:()=>Sn,shader:()=>xn,shaderStages:()=>l,sheen:()=>Qo,sheenRoughness:()=>$o,shiftLeft:()=>pu,shiftRight:()=>du,shininess:()=>ia,sign:()=>Ku,sin:()=>Hu,sinc:()=>gw,skinning:()=>em,smoothstep:()=>Pc,specularColor:()=>ra,split:()=>ar,spritesheetUV:()=>OT,sqrt:()=>Uu,stack:()=>A_,step:()=>hc,storage:()=>iA,storageObject:()=>oA,string:()=>nr,sub:()=>Js,tan:()=>qu,tangentGeometry:()=>Rd,tangentLocal:()=>kd,tangentView:()=>Cd,tangentWorld:()=>Nd,temp:()=>Zi,texture:()=>El,textureBicubic:()=>EE,textureLoad:()=>Al,textureStore:()=>vA,threshold:()=>xO,timerDelta:()=>mS,timerGlobal:()=>dS,timerLocal:()=>pS,toneMapping:()=>fP,transformDirection:()=>wc,transformedBitangentView:()=>IM,transformedBitangentWorld:()=>BM,transformedClearcoatNormalView:()=>Vh,transformedNormalView:()=>Fh,transformedNormalWorld:()=>zh,transformedTangentView:()=>Ld,transformedTangentWorld:()=>jd,triNoise3D:()=>Tw,triplanarTexture:()=>ZT,triplanarTextures:()=>JT,trunc:()=>oc,tslFn:()=>wn,uint:()=>Rn,umat2:()=>qn,umat3:()=>Zn,umat4:()=>tr,uniform:()=>gs,uniformGroup:()=>ns,uniforms:()=>$l,userData:()=>OA,uv:()=>Os,uvec2:()=>Ln,uvec3:()=>Un,uvec4:()=>Vn,varying:()=>Ar,varyingProperty:()=>qo,vec2:()=>Cn,vec3:()=>In,vec4:()=>Fn,vectorComponents:()=>f,vertexColor:()=>ZM,vertexIndex:()=>Ni,vibrance:()=>vO,viewZToOrthographicDepth:()=>Wg,viewZToPerspectiveDepth:()=>Xg,viewport:()=>lg,viewportBottomLeft:()=>hg,viewportBottomRight:()=>dg,viewportCoordinate:()=>ug,viewportDepthTexture:()=>jg,viewportMipTexture:()=>Eg,viewportResolution:()=>cg,viewportSharedTexture:()=>SP,viewportTexture:()=>Mg,viewportTopLeft:()=>fg,viewportTopRight:()=>pg,wgsl:()=>Ca,wgslFn:()=>Xa,xor:()=>uu});var r={};n.r(r),n.d(r,{arrayBufferToBase64:()=>M,base64ToArrayBuffer:()=>E,getCacheKey:()=>x,getNodeChildren:()=>w,getValueFromType:()=>T,getValueType:()=>S});var i={};n.r(i),n.d(i,{blur:()=>Mv,getDirection:()=>xv,textureCubeUV:()=>wv});var o={VERTEX:"vertex",FRAGMENT:"fragment"},a={NONE:"none",FRAME:"frame",RENDER:"render",OBJECT:"object"},s={BOOLEAN:"bool",INTEGER:"int",FLOAT:"float",VECTOR2:"vec2",VECTOR3:"vec3",VECTOR4:"vec4",MATRIX2:"mat2",MATRIX3:"mat3",MATRIX4:"mat4"},u=["fragment","vertex"],c=["setup","analyze","generate"],l=[].concat(u,["compute"]),f=["x","y","z","w"],h=n(554);function p(t,e,n){if(d())return Reflect.construct.apply(null,arguments);var r=[null];r.push.apply(r,e);var i=new(t.bind.apply(t,r));return n&&m(i,n.prototype),i}function d(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(d=function(){return!!t})()}function m(t,e){return m=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},m(t,e)}function y(t){return function(t){if(Array.isArray(t))return _(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||b(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function v(){v=function(){return e};var t,e={},n=Object.prototype,r=n.hasOwnProperty,i=Object.defineProperty||function(t,e,n){t[e]=n.value},o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",s=o.asyncIterator||"@@asyncIterator",u=o.toStringTag||"@@toStringTag";function c(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{c({},"")}catch(t){c=function(t,e,n){return t[e]=n}}function l(t,e,n,r){var o=e&&e.prototype instanceof b?e:b,a=Object.create(o.prototype),s=new C(r||[]);return i(a,"_invoke",{value:O(t,n,s)}),a}function f(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var h="suspendedStart",p="suspendedYield",d="executing",m="completed",y={};function b(){}function _(){}function x(){}var w={};c(w,a,(function(){return this}));var S=Object.getPrototypeOf,T=S&&S(S(N([])));T&&T!==n&&r.call(T,a)&&(w=T);var M=x.prototype=b.prototype=Object.create(w);function E(t){["next","throw","return"].forEach((function(e){c(t,e,(function(t){return this._invoke(e,t)}))}))}function A(t,e){function n(i,o,a,s){var u=f(t[i],t,o);if("throw"!==u.type){var c=u.arg,l=c.value;return l&&"object"==g(l)&&r.call(l,"__await")?e.resolve(l.__await).then((function(t){n("next",t,a,s)}),(function(t){n("throw",t,a,s)})):e.resolve(l).then((function(t){c.value=t,a(c)}),(function(t){return n("throw",t,a,s)}))}s(u.arg)}var o;i(this,"_invoke",{value:function(t,r){function i(){return new e((function(e,i){n(t,r,e,i)}))}return o=o?o.then(i,i):i()}})}function O(e,n,r){var i=h;return function(o,a){if(i===d)throw Error("Generator is already running");if(i===m){if("throw"===o)throw a;return{value:t,done:!0}}for(r.method=o,r.arg=a;;){var s=r.delegate;if(s){var u=P(s,r);if(u){if(u===y)continue;return u}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(i===h)throw i=m,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);i=d;var c=f(e,n,r);if("normal"===c.type){if(i=r.done?m:p,c.arg===y)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(i=m,r.method="throw",r.arg=c.arg)}}}function P(e,n){var r=n.method,i=e.iterator[r];if(i===t)return n.delegate=null,"throw"===r&&e.iterator.return&&(n.method="return",n.arg=t,P(e,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),y;var o=f(i,e.iterator,n.arg);if("throw"===o.type)return n.method="throw",n.arg=o.arg,n.delegate=null,y;var a=o.arg;return a?a.done?(n[e.resultName]=a.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,y):a:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,y)}function R(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function k(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function C(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(R,this),this.reset(!0)}function N(e){if(e||""===e){var n=e[a];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,o=function n(){for(;++i<e.length;)if(r.call(e,i))return n.value=e[i],n.done=!1,n;return n.value=t,n.done=!0,n};return o.next=o}}throw new TypeError(g(e)+" is not iterable")}return _.prototype=x,i(M,"constructor",{value:x,configurable:!0}),i(x,"constructor",{value:_,configurable:!0}),_.displayName=c(x,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===_||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,x):(t.__proto__=x,c(t,u,"GeneratorFunction")),t.prototype=Object.create(M),t},e.awrap=function(t){return{__await:t}},E(A.prototype),c(A.prototype,s,(function(){return this})),e.AsyncIterator=A,e.async=function(t,n,r,i,o){void 0===o&&(o=Promise);var a=new A(l(t,n,r,i),o);return e.isGeneratorFunction(n)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},E(M),c(M,u,"Generator"),c(M,a,(function(){return this})),c(M,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),n=[];for(var r in e)n.push(r);return n.reverse(),function t(){for(;n.length;){var r=n.pop();if(r in e)return t.value=r,t.done=!1,t}return t.done=!0,t}},e.values=N,C.prototype={constructor:C,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(k),!e)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function i(r,i){return s.type="throw",s.arg=e,n.next=r,i&&(n.method="next",n.arg=t),!!i}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],s=a.completion;if("root"===a.tryLoc)return i("end");if(a.tryLoc<=this.prev){var u=r.call(a,"catchLoc"),c=r.call(a,"finallyLoc");if(u&&c){if(this.prev<a.catchLoc)return i(a.catchLoc,!0);if(this.prev<a.finallyLoc)return i(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return i(a.catchLoc,!0)}else{if(!c)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return i(a.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=t,a.arg=e,o?(this.method="next",this.next=o.finallyLoc,y):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),y},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),k(n),y}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var i=r.arg;k(n)}return i}}throw Error("illegal catch attempt")},delegateYield:function(e,n,r){return this.delegate={iterator:N(e),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=t),y}},e}function g(t){return g="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},g(t)}function b(t,e){if(t){if("string"==typeof t)return _(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_(t,e):void 0}}function _(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function x(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n="{";!0===t.isNode&&(n+=t.id);var r,i=function(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=b(t))){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}(w(t));try{for(i.s();!(r=i.n()).done;){var o=r.value,a=o.property,s=o.childNode;n+=","+a.slice(0,-4)+":"+s.getCacheKey(e)}}catch(t){i.e(t)}finally{i.f()}return n+"}"}function w(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return v().mark((function n(){var r,i,o,a,s,u;return v().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:n.t0=v().keys(t);case 1:if((n.t1=n.t0()).done){n.next=35;break}if(!0!==(r=n.t1.value).startsWith("_")){n.next=5;break}return n.abrupt("continue",1);case 5:if(i=t[r],!0!==Array.isArray(i)){n.next=18;break}o=0;case 8:if(!(o<i.length)){n.next=16;break}if(!(a=i[o])||!(!0===a.isNode||e&&"function"==typeof a.toJSON)){n.next=13;break}return n.next=13,{property:r,index:o,childNode:a};case 13:o++,n.next=8;break;case 16:n.next=33;break;case 18:if(!i||!0!==i.isNode){n.next=23;break}return n.next=21,{property:r,childNode:i};case 21:n.next=33;break;case 23:if("object"!==g(i)){n.next=33;break}n.t2=v().keys(i);case 25:if((n.t3=n.t2()).done){n.next=33;break}if(s=n.t3.value,!(u=i[s])||!(!0===u.isNode||e&&"function"==typeof u.toJSON)){n.next=31;break}return n.next=31,{property:r,index:s,childNode:u};case 31:n.next=25;break;case 33:n.next=1;break;case 35:case"end":return n.stop()}}),n)}))()}function S(t){if(null==t)return null;var e=g(t);return!0===t.isNode?"node":"number"===e?"float":"boolean"===e?"bool":"string"===e?"string":"function"===e?"shader":!0===t.isVector2?"vec2":!0===t.isVector3?"vec3":!0===t.isVector4?"vec4":!0===t.isMatrix3?"mat3":!0===t.isMatrix4?"mat4":!0===t.isColor?"color":t instanceof ArrayBuffer?"ArrayBuffer":null}function T(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];var i=t?t.slice(-4):void 0;return 1===n.length&&("vec2"===i?n=[n[0],n[0]]:"vec3"===i?n=[n[0],n[0],n[0]]:"vec4"===i&&(n=[n[0],n[0],n[0],n[0]])),"color"===t?p(h.Q1f,y(n)):"vec2"===i?p(h.I9Y,y(n)):"vec3"===i?p(h.Pq0,y(n)):"vec4"===i?p(h.IUQ,y(n)):"mat3"===i?p(h.dwI,y(n)):"mat4"===i?p(h.kn4,y(n)):"bool"===t?n[0]||!1:"float"===t||"int"===t||"uint"===t?n[0]||0:"string"===t?n[0]||"":"ArrayBuffer"===t?E(n[0]):null}function M(t){for(var e="",n=new Uint8Array(t),r=0;r<n.length;r++)e+=String.fromCharCode(n[r]);return btoa(e)}function E(t){return Uint8Array.from(atob(t),(function(t){return t.charCodeAt(0)})).buffer}function A(t){return A="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},A(t)}function O(){O=function(){return e};var t,e={},n=Object.prototype,r=n.hasOwnProperty,i=Object.defineProperty||function(t,e,n){t[e]=n.value},o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",s=o.asyncIterator||"@@asyncIterator",u=o.toStringTag||"@@toStringTag";function c(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{c({},"")}catch(t){c=function(t,e,n){return t[e]=n}}function l(t,e,n,r){var o=e&&e.prototype instanceof v?e:v,a=Object.create(o.prototype),s=new C(r||[]);return i(a,"_invoke",{value:E(t,n,s)}),a}function f(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var h="suspendedStart",p="suspendedYield",d="executing",m="completed",y={};function v(){}function g(){}function b(){}var _={};c(_,a,(function(){return this}));var x=Object.getPrototypeOf,w=x&&x(x(N([])));w&&w!==n&&r.call(w,a)&&(_=w);var S=b.prototype=v.prototype=Object.create(_);function T(t){["next","throw","return"].forEach((function(e){c(t,e,(function(t){return this._invoke(e,t)}))}))}function M(t,e){function n(i,o,a,s){var u=f(t[i],t,o);if("throw"!==u.type){var c=u.arg,l=c.value;return l&&"object"==A(l)&&r.call(l,"__await")?e.resolve(l.__await).then((function(t){n("next",t,a,s)}),(function(t){n("throw",t,a,s)})):e.resolve(l).then((function(t){c.value=t,a(c)}),(function(t){return n("throw",t,a,s)}))}s(u.arg)}var o;i(this,"_invoke",{value:function(t,r){function i(){return new e((function(e,i){n(t,r,e,i)}))}return o=o?o.then(i,i):i()}})}function E(e,n,r){var i=h;return function(o,a){if(i===d)throw Error("Generator is already running");if(i===m){if("throw"===o)throw a;return{value:t,done:!0}}for(r.method=o,r.arg=a;;){var s=r.delegate;if(s){var u=P(s,r);if(u){if(u===y)continue;return u}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(i===h)throw i=m,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);i=d;var c=f(e,n,r);if("normal"===c.type){if(i=r.done?m:p,c.arg===y)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(i=m,r.method="throw",r.arg=c.arg)}}}function P(e,n){var r=n.method,i=e.iterator[r];if(i===t)return n.delegate=null,"throw"===r&&e.iterator.return&&(n.method="return",n.arg=t,P(e,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),y;var o=f(i,e.iterator,n.arg);if("throw"===o.type)return n.method="throw",n.arg=o.arg,n.delegate=null,y;var a=o.arg;return a?a.done?(n[e.resultName]=a.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,y):a:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,y)}function R(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function k(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function C(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(R,this),this.reset(!0)}function N(e){if(e||""===e){var n=e[a];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,o=function n(){for(;++i<e.length;)if(r.call(e,i))return n.value=e[i],n.done=!1,n;return n.value=t,n.done=!0,n};return o.next=o}}throw new TypeError(A(e)+" is not iterable")}return g.prototype=b,i(S,"constructor",{value:b,configurable:!0}),i(b,"constructor",{value:g,configurable:!0}),g.displayName=c(b,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===g||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,c(t,u,"GeneratorFunction")),t.prototype=Object.create(S),t},e.awrap=function(t){return{__await:t}},T(M.prototype),c(M.prototype,s,(function(){return this})),e.AsyncIterator=M,e.async=function(t,n,r,i,o){void 0===o&&(o=Promise);var a=new M(l(t,n,r,i),o);return e.isGeneratorFunction(n)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},T(S),c(S,u,"Generator"),c(S,a,(function(){return this})),c(S,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),n=[];for(var r in e)n.push(r);return n.reverse(),function t(){for(;n.length;){var r=n.pop();if(r in e)return t.value=r,t.done=!1,t}return t.done=!0,t}},e.values=N,C.prototype={constructor:C,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(k),!e)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function i(r,i){return s.type="throw",s.arg=e,n.next=r,i&&(n.method="next",n.arg=t),!!i}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],s=a.completion;if("root"===a.tryLoc)return i("end");if(a.tryLoc<=this.prev){var u=r.call(a,"catchLoc"),c=r.call(a,"finallyLoc");if(u&&c){if(this.prev<a.catchLoc)return i(a.catchLoc,!0);if(this.prev<a.finallyLoc)return i(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return i(a.catchLoc,!0)}else{if(!c)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return i(a.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=t,a.arg=e,o?(this.method="next",this.next=o.finallyLoc,y):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),y},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),k(n),y}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var i=r.arg;k(n)}return i}}throw Error("illegal catch attempt")},delegateYield:function(e,n,r){return this.delegate={iterator:N(e),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=t),y}},e}function P(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return R(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?R(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function R(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function k(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,C(r.key),r)}}function C(t){var e=function(t,e){if("object"!=A(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=A(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==A(e)?e:e+""}function N(t,e,n){return e=j(e),function(t,e){if(e&&("object"===A(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,L()?Reflect.construct(e,n||[],j(t).constructor):e.apply(t,n))}function L(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(L=function(){return!!t})()}function j(t){return j=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},j(t)}function I(t,e){return I=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},I(t,e)}var B=new Map,U=0,D=function(t){function e(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(t=N(this,e)).nodeType=n,t.updateType=a.NONE,t.updateBeforeType=a.NONE,t.uuid=h.cj9.generateUUID(),t.version=0,t._cacheKey=null,t._cacheKeyVersion=0,t.isNode=!0,Object.defineProperty(t,"id",{value:U++}),t}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&I(t,e)}(e,t),n=e,r=[{key:"needsUpdate",set:function(t){!0===t&&this.version++}},{key:"type",get:function(){return this.constructor.type}},{key:"onUpdate",value:function(t,e){return this.updateType=e,this.update=t.bind(this.getSelf()),this}},{key:"onFrameUpdate",value:function(t){return this.onUpdate(t,a.FRAME)}},{key:"onRenderUpdate",value:function(t){return this.onUpdate(t,a.RENDER)}},{key:"onObjectUpdate",value:function(t){return this.onUpdate(t,a.OBJECT)}},{key:"getSelf",value:function(){return this.self||this}},{key:"updateReference",value:function(){return this}},{key:"isGlobal",value:function(){return!1}},{key:"getChildren",value:O().mark((function t(){var e,n,r;return O().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e=P(w(this)),t.prev=1,e.s();case 3:if((n=e.n()).done){t.next=9;break}return r=n.value.childNode,t.next=7,r;case 7:t.next=3;break;case 9:t.next=14;break;case 11:t.prev=11,t.t0=t.catch(1),e.e(t.t0);case 14:return t.prev=14,e.f(),t.finish(14);case 17:case"end":return t.stop()}}),t,this,[[1,11,14,17]])}))},{key:"dispose",value:function(){this.dispatchEvent({type:"dispose"})}},{key:"traverse",value:function(t){t(this);var e,n=P(this.getChildren());try{for(n.s();!(e=n.n()).done;)e.value.traverse(t)}catch(t){n.e(t)}finally{n.f()}}},{key:"getCacheKey",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return!0!==(t=t||this.version!==this._cacheKeyVersion)&&null!==this._cacheKey||(this._cacheKey=x(this,t),this._cacheKeyVersion=this.version),this._cacheKey}},{key:"getHash",value:function(){return this.uuid}},{key:"getUpdateType",value:function(){return this.updateType}},{key:"getUpdateBeforeType",value:function(){return this.updateBeforeType}},{key:"getNodeType",value:function(t){var e=t.getNodeProperties(this);return e.outputNode?e.outputNode.getNodeType(t):this.nodeType}},{key:"getShared",value:function(t){var e=this.getHash(t);return t.getNodeFromHash(e)||this}},{key:"setup",value:function(t){var e,n=t.getNodeProperties(this),r=P(this.getChildren());try{for(r.s();!(e=r.n()).done;){var i=e.value;n["_node"+i.id]=i}}catch(t){r.e(t)}finally{r.f()}return null}},{key:"construct",value:function(t){return console.warn("THREE.Node: construct() is deprecated. Use setup() instead."),this.setup(t)}},{key:"increaseUsage",value:function(t){var e=t.getDataFromNode(this);return e.usageCount=void 0===e.usageCount?1:e.usageCount+1,e.usageCount}},{key:"analyze",value:function(t){if(1===this.increaseUsage(t))for(var e=t.getNodeProperties(this),n=0,r=Object.values(e);n<r.length;n++){var i=r[n];i&&!0===i.isNode&&i.build(t)}}},{key:"generate",value:function(t,e){var n=t.getNodeProperties(this).outputNode;if(n&&!0===n.isNode)return n.build(t,e)}},{key:"updateBefore",value:function(){console.warn("Abstract function.")}},{key:"update",value:function(){console.warn("Abstract function.")}},{key:"build",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=this.getShared(t);if(this!==n)return n.build(t,e);t.addNode(this),t.addChain(this);var r=null,i=t.getBuildStage();if("setup"===i){this.updateReference(t);var o=t.getNodeProperties(this);if(!0!==o.initialized||!1===t.context.tempRead){var a=t.stack.nodes.length;o.initialized=!0,o.outputNode=this.setup(t),null!==o.outputNode&&t.stack.nodes.length!==a&&(o.outputNode=t.stack);for(var s=0,u=Object.values(o);s<u.length;s++){var c=u[s];c&&!0===c.isNode&&c.build(t)}}}else if("analyze"===i)this.analyze(t);else if("generate"===i)if(1===this.generate.length){var l=this.getNodeType(t),f=t.getDataFromNode(this);void 0===(r=f.snippet)&&(r=this.generate(t)||"",f.snippet=r),r=t.format(r,l,e)}else r=this.generate(t,e)||"";return t.removeChain(this),r}},{key:"getSerializeChildren",value:function(){return w(this)}},{key:"serialize",value:function(t){var e,n={},r=P(this.getSerializeChildren());try{for(r.s();!(e=r.n()).done;){var i=e.value,o=i.property,a=i.index,s=i.childNode;void 0!==a?(void 0===n[o]&&(n[o]=Number.isInteger(a)?[]:{}),n[o][a]=s.toJSON(t.meta).uuid):n[o]=s.toJSON(t.meta).uuid}}catch(t){r.e(t)}finally{r.f()}Object.keys(n).length>0&&(t.inputNodes=n)}},{key:"deserialize",value:function(t){if(void 0!==t.inputNodes){var e=t.meta.nodes;for(var n in t.inputNodes)if(Array.isArray(t.inputNodes[n])){var r,i=[],o=P(t.inputNodes[n]);try{for(o.s();!(r=o.n()).done;){var a=r.value;i.push(e[a])}}catch(t){o.e(t)}finally{o.f()}this[n]=i}else if("object"===A(t.inputNodes[n])){var s={};for(var u in t.inputNodes[n]){var c=t.inputNodes[n][u];s[u]=e[c]}this[n]=s}else{var l=t.inputNodes[n];this[n]=e[l]}}}},{key:"toJSON",value:function(t){var e=this.uuid,n=this.type,r=void 0===t||"string"==typeof t;r&&(t={textures:{},images:{},nodes:{}});var i=t.nodes[e];function o(t){var e=[];for(var n in t){var r=t[n];delete r.metadata,e.push(r)}return e}if(void 0===i&&(i={uuid:e,type:n,meta:t,metadata:{version:4.6,type:"Node",generator:"Node.toJSON"}},!0!==r&&(t.nodes[i.uuid]=i),this.serialize(i),delete i.meta),r){var a=o(t.textures),s=o(t.images),u=o(t.nodes);a.length>0&&(i.textures=a),s.length>0&&(i.images=s),u.length>0&&(i.nodes=u)}return i}}],r&&k(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(h.Qev);const F=D;function z(t,e){if("function"!=typeof e||!t)throw new Error("Node class ".concat(t," is not a class"));B.has(t)?console.warn("Redefinition of node class ".concat(t)):(B.set(t,e),e.type=t)}function V(t){var e=B.get(t);if(void 0!==e)return new e}function G(t){return G="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},G(t)}function H(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,W(r.key),r)}}function W(t){var e=function(t,e){if("object"!=G(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=G(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==G(e)?e:e+""}function q(t,e,n){return e=J(e),function(t,e){if(e&&("object"===G(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,X()?Reflect.construct(e,n||[],J(t).constructor):e.apply(t,n))}function X(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(X=function(){return!!t})()}function Y(){return Y="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=J(t)););return t}(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(arguments.length<3?t:n):i.value}},Y.apply(this,arguments)}function J(t){return J=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},J(t)}function Z(t,e){return Z=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Z(t,e)}var K=function(t){function e(t){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=q(this,e,[t])).isTempNode=!0,n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Z(t,e)}(e,t),n=e,r=[{key:"hasDependencies",value:function(t){return t.getDataFromNode(this).usageCount>1}},{key:"build",value:function(t,n){if("generate"===t.getBuildStage()){var r=t.getVectorType(this.getNodeType(t,n)),i=t.getDataFromNode(this);if(!1!==t.context.tempRead&&void 0!==i.propertyName)return t.format(i.propertyName,r,n);if(!1!==t.context.tempWrite&&"void"!==r&&"void"!==n&&this.hasDependencies(t)){var o=Y(J(e.prototype),"build",this).call(this,t,r),a=t.getVarFromNode(this,null,r),s=t.getPropertyName(a);return t.addLineFlowCode("".concat(s," = ").concat(o)),i.snippet=o,i.propertyName=s,t.format(i.propertyName,r,n)}}return Y(J(e.prototype),"build",this).call(this,t,n)}}],r&&H(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(F);const Q=K;function $(t){return $="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},$(t)}function tt(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,et(r.key),r)}}function et(t){var e=function(t,e){if("object"!=$(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=$(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==$(e)?e:e+""}function nt(t,e,n){return e=it(e),function(t,e){if(e&&("object"===$(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,rt()?Reflect.construct(e,n||[],it(t).constructor):e.apply(t,n))}function rt(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(rt=function(){return!!t})()}function it(t){return it=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},it(t)}function ot(t,e){return ot=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},ot(t,e)}z("TempNode",K);var at=function(t){function e(t,n){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(r=nt(this,e)).node=t,r.indexNode=n,r.isArrayElementNode=!0,r}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&ot(t,e)}(e,t),n=e,(r=[{key:"getNodeType",value:function(t){return this.node.getNodeType(t)}},{key:"generate",value:function(t){var e=this.node.build(t),n=this.indexNode.build(t,"uint");return"".concat(e,"[ ").concat(n," ]")}}])&&tt(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(F);const st=at;function ut(t){return ut="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ut(t)}function ct(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function lt(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,ft(r.key),r)}}function ft(t){var e=function(t,e){if("object"!=ut(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=ut(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==ut(e)?e:e+""}function ht(t,e,n){return e=mt(e),function(t,e){if(e&&("object"===ut(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,pt()?Reflect.construct(e,n||[],mt(t).constructor):e.apply(t,n))}function pt(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(pt=function(){return!!t})()}function dt(){return dt="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=mt(t)););return t}(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(arguments.length<3?t:n):i.value}},dt.apply(this,arguments)}function mt(t){return mt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},mt(t)}function yt(t,e){return yt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},yt(t,e)}z("ArrayElementNode",at);var vt=function(t){function e(t,n){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(r=ht(this,e)).node=t,r.convertTo=n,r}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&yt(t,e)}(e,t),n=e,r=[{key:"getNodeType",value:function(t){var e,n=this.node.getNodeType(t),r=null,i=function(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return ct(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ct(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}(this.convertTo.split("|"));try{for(i.s();!(e=i.n()).done;){var o=e.value;null!==r&&t.getTypeLength(n)!==t.getTypeLength(o)||(r=o)}}catch(t){i.e(t)}finally{i.f()}return r}},{key:"serialize",value:function(t){dt(mt(e.prototype),"serialize",this).call(this,t),t.convertTo=this.convertTo}},{key:"deserialize",value:function(t){dt(mt(e.prototype),"deserialize",this).call(this,t),this.convertTo=t.convertTo}},{key:"generate",value:function(t,e){var n=this.node,r=this.getNodeType(t),i=n.build(t,r);return t.format(i,r,e)}}],r&&lt(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(F);const gt=vt;function bt(t){return bt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},bt(t)}function _t(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function xt(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,wt(r.key),r)}}function wt(t){var e=function(t,e){if("object"!=bt(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=bt(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==bt(e)?e:e+""}function St(t,e,n){return e=Mt(e),function(t,e){if(e&&("object"===bt(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,Tt()?Reflect.construct(e,n||[],Mt(t).constructor):e.apply(t,n))}function Tt(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(Tt=function(){return!!t})()}function Mt(t){return Mt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Mt(t)}function Et(t,e){return Et=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Et(t,e)}z("ConvertNode",vt);var At=function(t){function e(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(t=St(this,e,[r])).nodes=n,t}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Et(t,e)}(e,t),n=e,r=[{key:"getNodeType",value:function(t){return null!==this.nodeType?t.getVectorType(this.nodeType):t.getTypeFromLength(this.nodes.reduce((function(e,n){return e+t.getTypeLength(n.getNodeType(t))}),0))}},{key:"generate",value:function(t,e){var n,r=this.getNodeType(t),i=this.nodes,o=t.getComponentType(r),a=[],s=function(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return _t(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_t(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}(i);try{for(s.s();!(n=s.n()).done;){var u=n.value,c=u.build(t),l=t.getComponentType(u.getNodeType(t));l!==o&&(c=t.format(c,l,o)),a.push(c)}}catch(t){s.e(t)}finally{s.f()}var f="".concat(t.getType(r),"( ").concat(a.join(", ")," )");return t.format(f,r,e)}}],r&&xt(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(Q);const Ot=At;function Pt(t){return Pt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Pt(t)}function Rt(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function kt(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Ct(r.key),r)}}function Ct(t){var e=function(t,e){if("object"!=Pt(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=Pt(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Pt(e)?e:e+""}function Nt(t,e,n){return e=It(e),function(t,e){if(e&&("object"===Pt(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,Lt()?Reflect.construct(e,n||[],It(t).constructor):e.apply(t,n))}function Lt(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(Lt=function(){return!!t})()}function jt(){return jt="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=It(t)););return t}(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(arguments.length<3?t:n):i.value}},jt.apply(this,arguments)}function It(t){return It=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},It(t)}function Bt(t,e){return Bt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Bt(t,e)}z("JoinNode",At);var Ut=f.join(""),Dt=function(t){function e(t){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"x";return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=Nt(this,e)).node=t,n.components=r,n.isSplitNode=!0,n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Bt(t,e)}(e,t),n=e,r=[{key:"getVectorLength",value:function(){var t,e=this.components.length,n=function(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return Rt(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Rt(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}(this.components);try{for(n.s();!(t=n.n()).done;){var r=t.value;e=Math.max(f.indexOf(r)+1,e)}}catch(t){n.e(t)}finally{n.f()}return e}},{key:"getComponentType",value:function(t){return t.getComponentType(this.node.getNodeType(t))}},{key:"getNodeType",value:function(t){return t.getTypeFromLength(this.components.length,this.getComponentType(t))}},{key:"generate",value:function(t,e){var n=this.node,r=t.getTypeLength(n.getNodeType(t)),i=null;if(r>1){var o=null;this.getVectorLength()>=r&&(o=t.getTypeFromLength(this.getVectorLength(),this.getComponentType(t)));var a=n.build(t,o);i=this.components.length===r&&this.components===Ut.slice(0,this.components.length)?t.format(a,o,e):t.format("".concat(a,".").concat(this.components),this.getNodeType(t),e)}else i=n.build(t,e);return i}},{key:"serialize",value:function(t){jt(It(e.prototype),"serialize",this).call(this,t),t.components=this.components}},{key:"deserialize",value:function(t){jt(It(e.prototype),"deserialize",this).call(this,t),this.components=t.components}}],r&&kt(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(F);const Ft=Dt;function zt(t){return zt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},zt(t)}function Vt(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Gt(r.key),r)}}function Gt(t){var e=function(t,e){if("object"!=zt(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=zt(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==zt(e)?e:e+""}function Ht(t,e,n){return e=qt(e),function(t,e){if(e&&("object"===zt(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,Wt()?Reflect.construct(e,n||[],qt(t).constructor):e.apply(t,n))}function Wt(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(Wt=function(){return!!t})()}function qt(t){return qt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},qt(t)}function Xt(t,e){return Xt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Xt(t,e)}z("SplitNode",Dt);var Yt=function(t){function e(t,n,r){var i;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(i=Ht(this,e)).sourceNode=t,i.components=n,i.targetNode=r,i}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Xt(t,e)}(e,t),n=e,(r=[{key:"getNodeType",value:function(t){return this.sourceNode.getNodeType(t)}},{key:"generate",value:function(t){for(var e=this.sourceNode,n=this.components,r=this.targetNode,i=this.getNodeType(t),o=t.getTypeFromLength(n.length),a=r.build(t,o),s=e.build(t,i),u=t.getTypeLength(i),c=[],l=0;l<u;l++){var h=f[l];h===n[0]?(c.push(a),l+=n.length-1):c.push(s+"."+h)}return"".concat(t.getType(i),"( ").concat(c.join(", ")," )")}}])&&Vt(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(Q);const Jt=Yt;function Zt(t){return Zt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Zt(t)}function Kt(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function Qt(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,$t(r.key),r)}}function $t(t){var e=function(t,e){if("object"!=Zt(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=Zt(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Zt(e)?e:e+""}function te(t,e,n){return e=re(e),function(t,e){if(e&&("object"===Zt(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,ee()?Reflect.construct(e,n||[],re(t).constructor):e.apply(t,n))}function ee(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(ee=function(){return!!t})()}function ne(){return ne="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=re(t)););return t}(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(arguments.length<3?t:n):i.value}},ne.apply(this,arguments)}function re(t){return re=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},re(t)}function ie(t,e){return ie=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},ie(t,e)}z("SetNode",Yt);var oe=function(t){function e(t){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=te(this,e,[r])).isInputNode=!0,n.value=t,n.precision=null,n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&ie(t,e)}(e,t),n=e,(r=[{key:"getNodeType",value:function(){return null===this.nodeType?S(this.value):this.nodeType}},{key:"getInputType",value:function(t){return this.getNodeType(t)}},{key:"setPrecision",value:function(t){return this.precision=t,this}},{key:"serialize",value:function(t){ne(re(e.prototype),"serialize",this).call(this,t),t.value=this.value,this.value&&this.value.toArray&&(t.value=this.value.toArray()),t.valueType=S(this.value),t.nodeType=this.nodeType,"ArrayBuffer"===t.valueType&&(t.value=M(t.value)),t.precision=this.precision}},{key:"deserialize",value:function(t){var n;ne(re(e.prototype),"deserialize",this).call(this,t),this.nodeType=t.nodeType,this.value=Array.isArray(t.value)?T.apply(void 0,[t.valueType].concat(function(t){if(Array.isArray(t))return Kt(t)}(n=t.value)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(n)||function(t,e){if(t){if("string"==typeof t)return Kt(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Kt(t,e):void 0}}(n)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}())):t.value,this.precision=t.precision||null,this.value&&this.value.fromArray&&(this.value=this.value.fromArray(t.value))}},{key:"generate",value:function(){console.warn("Abstract function.")}}])&&Qt(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(F);const ae=oe;function se(t){return se="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},se(t)}function ue(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,ce(r.key),r)}}function ce(t){var e=function(t,e){if("object"!=se(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=se(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==se(e)?e:e+""}function le(t,e,n){return e=he(e),function(t,e){if(e&&("object"===se(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,fe()?Reflect.construct(e,n||[],he(t).constructor):e.apply(t,n))}function fe(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(fe=function(){return!!t})()}function he(t){return he=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},he(t)}function pe(t,e){return pe=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},pe(t,e)}z("InputNode",oe);var de=function(t){function e(t){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=le(this,e,[t,r])).isConstNode=!0,n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&pe(t,e)}(e,t),n=e,r=[{key:"generateConst",value:function(t){return t.generateConst(this.getNodeType(t),this.value)}},{key:"generate",value:function(t,e){var n=this.getNodeType(t);return t.format(this.generateConst(t),n,e)}}],r&&ue(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(ae);const me=de;function ye(t){return ye="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ye(t)}function ve(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function ge(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,_e(r.key),r)}}function be(t,e,n){return e&&ge(t.prototype,e),n&&ge(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function _e(t){var e=function(t,e){if("object"!=ye(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=ye(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==ye(e)?e:e+""}function xe(t,e,n){return e=Se(e),function(t,e){if(e&&("object"===ye(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,Ee()?Reflect.construct(e,n||[],Se(t).constructor):e.apply(t,n))}function we(){return we="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Se(t)););return t}(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(arguments.length<3?t:n):i.value}},we.apply(this,arguments)}function Se(t){return Se=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Se(t)}function Te(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Ae(t,e)}function Me(t,e,n){if(Ee())return Reflect.construct.apply(null,arguments);var r=[null];r.push.apply(r,e);var i=new(t.bind.apply(t,r));return n&&Ae(i,n.prototype),i}function Ee(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(Ee=function(){return!!t})()}function Ae(t,e){return Ae=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Ae(t,e)}function Oe(t){return function(t){if(Array.isArray(t))return Pe(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return Pe(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Pe(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Pe(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}z("ConstNode",de);var Re=null,ke=new Map;function Ce(t,e){if(ke.has(t))console.warn("Redefinition of node element ".concat(t));else{if("function"!=typeof e)throw new Error("Node element ".concat(t," is not a function"));ke.set(t,e)}}for(var Ne=function(t){return t.replace(/r|s/g,"x").replace(/g|t/g,"y").replace(/b|p/g,"z").replace(/a|q/g,"w")},Le={setup:function(t,e){var n=e.shift();return t.apply(void 0,[vn(n)].concat(Oe(e)))},get:function(t,e,n){if("string"==typeof e&&void 0===t[e]){if(!0!==t.isStackNode&&"assign"===e)return function(){for(var t,e=arguments.length,r=new Array(e),i=0;i<e;i++)r[i]=arguments[i];return(t=Re).assign.apply(t,[n].concat(r)),n};if(ke.has(e)){var r=ke.get(e);return t.isStackNode?function(){return n.add(r.apply(void 0,arguments))}:function(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];return r.apply(void 0,[n].concat(e))}}if("self"===e)return t;if(e.endsWith("Assign")&&ke.has(e.slice(0,e.length-6))){var i=ke.get(e.slice(0,e.length-6));return t.isStackNode?function(){return n.assign(arguments.length<=0?void 0:arguments[0],i.apply(void 0,arguments))}:function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return n.assign(i.apply(void 0,[n].concat(e)))}}if(!0===/^[xyzwrgbastpq]{1,4}$/.test(e))return e=Ne(e),yn(new Ft(n,e));if(!0===/^set[XYZWRGBASTPQ]{1,4}$/.test(e))return e=(e=Ne(e.slice(3).toLowerCase())).split("").sort().join(""),function(n){return yn(new Jt(t,e,n))};if("width"===e||"height"===e||"depth"===e)return"width"===e?e="x":"height"===e?e="y":"depth"===e&&(e="z"),yn(new Ft(t,e));if(!0===/^\d+$/.test(e))return yn(new st(n,new me(Number(e),"uint")))}return Reflect.get(t,e,n)},set:function(t,e,n,r){return"string"!=typeof e||void 0!==t[e]||!0!==/^[xyzwrgbastpq]{1,4}$/.test(e)&&"width"!==e&&"height"!==e&&"depth"!==e&&!0!==/^\d+$/.test(e)?Reflect.set(t,e,n,r):(r[e].assign(n),!0)}},je=new WeakMap,Ie=new WeakMap,Be=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;for(var n in t)t[n]=yn(t[n],e);return t},Ue=function(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=t.length,r=0;r<n;r++)t[r]=yn(t[r],e);return t},De=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,i=function(t){return yn(null!==r?Object.assign(t,r):t)};return null===e?function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return i(Me(t,Oe(gn(n))))}:null!==n?(n=yn(n),function(){for(var r=arguments.length,o=new Array(r),a=0;a<r;a++)o[a]=arguments[a];return i(Me(t,[e].concat(Oe(gn(o)),[n])))}):function(){for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return i(Me(t,[e].concat(Oe(gn(r)))))}},Fe=function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return yn(Me(t,Oe(gn(n))))},ze=function(t){function e(t,n){var r;return ve(this,e),(r=xe(this,e)).shaderNode=t,r.inputNodes=n,r}return Te(e,t),be(e,[{key:"getNodeType",value:function(t){var n=t.getNodeProperties(this).outputNode;return n?n.getNodeType(t):we(Se(e.prototype),"getNodeType",this).call(this,t)}},{key:"call",value:function(t){var e=this.shaderNode,n=this.inputNodes;if(e.layout){var r=Ie.get(t.constructor);void 0===r&&(r=new WeakMap,Ie.set(t.constructor,r));var i=r.get(e);return void 0===i&&(i=yn(t.buildFunctionNode(e)),r.set(e,i)),null!==t.currentFunctionNode&&t.currentFunctionNode.includes.push(i),yn(i.call(n))}var o=e.jsFunc,a=null!==n?o(n,t.stack,t):o(t.stack,t);return yn(a)}},{key:"setup",value:function(t){return t.addStack(),t.stack.outputNode=this.call(t),t.removeStack()}},{key:"generate",value:function(t,n){return null===t.getNodeProperties(this).outputNode?this.call(t).build(t,n):we(Se(e.prototype),"generate",this).call(this,t,n)}}])}(F),Ve=function(t){function e(t){var n;return ve(this,e),(n=xe(this,e)).jsFunc=t,n.layout=null,n}return Te(e,t),be(e,[{key:"isArrayInput",get:function(){return/^\((\s+)?\[/.test(this.jsFunc.toString())}},{key:"setLayout",value:function(t){return this.layout=t,this}},{key:"call",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return vn(t),yn(new ze(this,t))}},{key:"setup",value:function(){return this.call()}}])}(F),Ge=[.5,1.5,1/3,1e-6,1e6,Math.PI,2*Math.PI,1/Math.PI,2/Math.PI,1/(2*Math.PI),Math.PI/2],He=new Map,We=0,qe=[!1,!0];We<qe.length;We++){var Xe=qe[We];He.set(Xe,new me(Xe))}for(var Ye=new Map,Je=0,Ze=[0,1,2,3];Je<Ze.length;Je++){var Ke=Ze[Je];Ye.set(Ke,new me(Ke,"uint"))}for(var Qe=new Map(Oe(Ye).map((function(t){return new me(t.value,"int")}))),$e=0,tn=[-1,-2];$e<tn.length;$e++){var en=tn[$e];Qe.set(en,new me(en,"int"))}for(var nn=new Map(Oe(Qe).map((function(t){return new me(t.value)}))),rn=0,on=Ge;rn<on.length;rn++){var an=on[rn];nn.set(an,new me(an))}for(var sn=0,un=Ge;sn<un.length;sn++){var cn=un[sn];nn.set(-cn,new me(-cn))}var ln={bool:He,uint:Ye,ints:Qe,float:nn},fn=new Map([].concat(Oe(He),Oe(nn))),hn=function(t,e){return fn.has(t)?fn.get(t):!0===t.isNode?t:new me(t,e)},pn=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return function(){for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];if((0===r.length||!["bool","float","int","uint"].includes(t)&&r.every((function(t){return"object"!==ye(t)})))&&(r=[T.apply(void 0,[t].concat(Oe(r)))]),1===r.length&&null!==e&&e.has(r[0]))return yn(e.get(r[0]));if(1===r.length){var o=hn(r[0],t);return function(t){try{return t.getNodeType()}catch(t){return}}(o)===t?yn(o):yn(new gt(o,t))}var a=r.map((function(t){return hn(t)}));return yn(new Ot(a,t))}},dn=function(t){return null!=t?t.nodeType||t.convertTo||("string"==typeof t?t:null):null};function mn(t){return new Proxy(new Ve(t),Le)}var yn=function(t){return function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=S(t);if("node"===n){var r=je.get(t);return void 0===r&&(r=new Proxy(t,Le),je.set(t,r),je.set(r,r)),r}return null===e&&("float"===n||"boolean"===n)||n&&"shader"!==n&&"string"!==n?yn(hn(t,e)):"shader"===n?wn(t):t}(t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null)},vn=function(t){return new Be(t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null)},gn=function(t){return new Ue(t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null)},bn=function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return Me(De,e)},_n=function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return Me(Fe,e)},xn=function(t){return console.warn("TSL: shader() is deprecated. Use tslFn() instead."),new mn(t)},wn=function(t){var e=new mn(t),n=function(){for(var t,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return vn(r),t=r[0]&&r[0].isNode?[].concat(r):r[0],e.call(t)};return n.shaderNode=e,n.setLayout=function(t){return e.setLayout(t),n},n};z("ShaderNode",mn);var Sn=function(t){Re=t},Tn=function(){return Re},Mn=function(){var t;return(t=Re).if.apply(t,arguments)};function En(t){return Re&&Re.add(t),t}Ce("append",En);var An=new pn("color"),On=new pn("float",ln.float),Pn=new pn("int",ln.ints),Rn=new pn("uint",ln.uint),kn=new pn("bool",ln.bool),Cn=new pn("vec2"),Nn=new pn("ivec2"),Ln=new pn("uvec2"),jn=new pn("bvec2"),In=new pn("vec3"),Bn=new pn("ivec3"),Un=new pn("uvec3"),Dn=new pn("bvec3"),Fn=new pn("vec4"),zn=new pn("ivec4"),Vn=new pn("uvec4"),Gn=new pn("bvec4"),Hn=new pn("mat2"),Wn=new pn("imat2"),qn=new pn("umat2"),Xn=new pn("bmat2"),Yn=new pn("mat3"),Jn=new pn("imat3"),Zn=new pn("umat3"),Kn=new pn("bmat3"),Qn=new pn("mat4"),$n=new pn("imat4"),tr=new pn("umat4"),er=new pn("bmat4"),nr=function(){return yn(new me(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"","string"))},rr=function(t){return yn(new me(t,"ArrayBuffer"))};Ce("color",An),Ce("float",On),Ce("int",Pn),Ce("uint",Rn),Ce("bool",kn),Ce("vec2",Cn),Ce("ivec2",Nn),Ce("uvec2",Ln),Ce("bvec2",jn),Ce("vec3",In),Ce("ivec3",Bn),Ce("uvec3",Un),Ce("bvec3",Dn),Ce("vec4",Fn),Ce("ivec4",zn),Ce("uvec4",Vn),Ce("bvec4",Gn),Ce("mat2",Hn),Ce("imat2",Wn),Ce("umat2",qn),Ce("bmat2",Xn),Ce("mat3",Yn),Ce("imat3",Jn),Ce("umat3",Zn),Ce("bmat3",Kn),Ce("mat4",Qn),Ce("imat4",$n),Ce("umat4",tr),Ce("bmat4",er),Ce("string",nr),Ce("arrayBuffer",rr);var ir=bn(st),or=function(t,e){return yn(new gt(yn(t),e))},ar=function(t,e){return yn(new Ft(yn(t),e))};function sr(t){return sr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},sr(t)}function ur(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,cr(r.key),r)}}function cr(t){var e=function(t,e){if("object"!=sr(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=sr(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==sr(e)?e:e+""}function lr(t,e,n){return e=hr(e),function(t,e){if(e&&("object"===sr(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,fr()?Reflect.construct(e,n||[],hr(t).constructor):e.apply(t,n))}function fr(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(fr=function(){return!!t})()}function hr(t){return hr=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},hr(t)}function pr(t,e){return pr=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},pr(t,e)}Ce("element",ir),Ce("convert",or);var dr=function(t){function e(t,n){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(r=lr(this,e)).targetNode=t,r.sourceNode=n,r}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&pr(t,e)}(e,t),n=e,r=[{key:"hasDependencies",value:function(){return!1}},{key:"getNodeType",value:function(t,e){return"void"!==e?this.targetNode.getNodeType(t):"void"}},{key:"needsSplitAssign",value:function(t){var e=this.targetNode;if(!1===t.isAvailable("swizzleAssign")&&e.isSplitNode&&e.components.length>1){var n=t.getTypeLength(e.node.getNodeType(t));return f.join("").slice(0,n)!==e.components}return!1}},{key:"generate",value:function(t,e){var n,r=this.targetNode,i=this.sourceNode,o=this.needsSplitAssign(t),a=r.getNodeType(t),s=r.context({assign:!0}).build(t),u=i.build(t,a),c=i.getNodeType(t),l=t.getDataFromNode(this);if(!0===l.initialized)"void"!==e&&(n=s);else if(o){var f=t.getVarFromNode(this,null,a),h=t.getPropertyName(f);t.addLineFlowCode("".concat(h," = ").concat(u));for(var p=r.node.context({assign:!0}).build(t),d=0;d<r.components.length;d++){var m=r.components[d];t.addLineFlowCode("".concat(p,".").concat(m," = ").concat(h,"[ ").concat(d," ]"))}"void"!==e&&(n=s)}else n="".concat(s," = ").concat(u),"void"!==e&&"void"!==c||(t.addLineFlowCode(n),"void"!==e&&(n=s));return l.initialized=!0,t.format(n,a,e)}}],r&&ur(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(Q);const mr=dr;var yr=bn(dr);function vr(t){return vr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},vr(t)}function gr(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,br(r.key),r)}}function br(t){var e=function(t,e){if("object"!=vr(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=vr(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==vr(e)?e:e+""}function _r(t,e,n){return e=Sr(e),function(t,e){if(e&&("object"===vr(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,xr()?Reflect.construct(e,n||[],Sr(t).constructor):e.apply(t,n))}function xr(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(xr=function(){return!!t})()}function wr(){return wr="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Sr(t)););return t}(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(arguments.length<3?t:n):i.value}},wr.apply(this,arguments)}function Sr(t){return Sr=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Sr(t)}function Tr(t,e){return Tr=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Tr(t,e)}z("AssignNode",dr),Ce("assign",yr);var Mr=function(t){function e(t){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=_r(this,e)).node=t,n.name=r,n.isVaryingNode=!0,n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Tr(t,e)}(e,t),n=e,(r=[{key:"isGlobal",value:function(){return!0}},{key:"getHash",value:function(t){return this.name||wr(Sr(e.prototype),"getHash",this).call(this,t)}},{key:"getNodeType",value:function(t){return this.node.getNodeType(t)}},{key:"generate",value:function(t){var e=this.name,n=this.node,r=this.getNodeType(t),i=t.getVaryingFromNode(this,e,r);i.needsInterpolation||(i.needsInterpolation="fragment"===t.shaderStage);var a=t.getPropertyName(i,o.VERTEX);return t.flowNodeFromShaderStage(o.VERTEX,n,r,a),t.getPropertyName(i)}}])&&gr(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(F);const Er=Mr;var Ar=bn(Mr);function Or(t){return Or="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Or(t)}function Pr(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Rr(r.key),r)}}function Rr(t){var e=function(t,e){if("object"!=Or(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=Or(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Or(e)?e:e+""}function kr(t,e,n){return e=Lr(e),function(t,e){if(e&&("object"===Or(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,Cr()?Reflect.construct(e,n||[],Lr(t).constructor):e.apply(t,n))}function Cr(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(Cr=function(){return!!t})()}function Nr(){return Nr="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Lr(t)););return t}(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(arguments.length<3?t:n):i.value}},Nr.apply(this,arguments)}function Lr(t){return Lr=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Lr(t)}function jr(t,e){return jr=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},jr(t,e)}Ce("varying",Ar),z("VaryingNode",Mr);var Ir=function(t){function e(t){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=kr(this,e,[r]))._attributeName=t,n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&jr(t,e)}(e,t),n=e,(r=[{key:"isGlobal",value:function(){return!0}},{key:"getHash",value:function(t){return this.getAttributeName(t)}},{key:"getNodeType",value:function(t){var n=Nr(Lr(e.prototype),"getNodeType",this).call(this,t);if(null===n){var r=this.getAttributeName(t);if(t.hasGeometryAttribute(r)){var i=t.geometry.getAttribute(r);n=t.getTypeFromAttribute(i)}else n="float"}return n}},{key:"setAttributeName",value:function(t){return this._attributeName=t,this}},{key:"getAttributeName",value:function(){return this._attributeName}},{key:"generate",value:function(t){var e=this.getAttributeName(t),n=this.getNodeType(t);if(!0===t.hasGeometryAttribute(e)){var r=t.geometry.getAttribute(e),i=t.getTypeFromAttribute(r),o=t.getAttribute(e,i);return"vertex"===t.shaderStage?t.format(o.name,i,n):Ar(this).build(t,n)}return console.warn('AttributeNode: Vertex attribute "'.concat(e,'" not found on geometry.')),t.generateConst(n)}}])&&Pr(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(F);const Br=Ir;var Ur=function(t,e){return yn(new Ir(t,e))};function Dr(t){return Dr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Dr(t)}function Fr(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,zr(r.key),r)}}function zr(t){var e=function(t,e){if("object"!=Dr(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=Dr(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Dr(e)?e:e+""}function Vr(t,e,n){return e=Hr(e),function(t,e){if(e&&("object"===Dr(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,Gr()?Reflect.construct(e,n||[],Hr(t).constructor):e.apply(t,n))}function Gr(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(Gr=function(){return!!t})()}function Hr(t){return Hr=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Hr(t)}function Wr(t,e){return Wr=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Wr(t,e)}z("AttributeNode",Ir);var qr=function(t){function e(t,n){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(r=Vr(this,e)).isBypassNode=!0,r.outputNode=t,r.callNode=n,r}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Wr(t,e)}(e,t),n=e,(r=[{key:"getNodeType",value:function(t){return this.outputNode.getNodeType(t)}},{key:"generate",value:function(t){var e=this.callNode.build(t,"void");return""!==e&&t.addLineFlowCode(e),this.outputNode.build(t)}}])&&Fr(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(F);const Xr=qr;var Yr=bn(qr);function Jr(t){return Jr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Jr(t)}function Zr(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Kr(r.key),r)}}function Kr(t){var e=function(t,e){if("object"!=Jr(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=Jr(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Jr(e)?e:e+""}Ce("bypass",Yr),z("BypassNode",qr);var Qr=0,$r=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.id=Qr++,this.nodesData=new WeakMap},(e=[{key:"getNodeData",value:function(t){return this.nodesData.get(t)}},{key:"setNodeData",value:function(t,e){this.nodesData.set(t,e)}}])&&Zr(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();const ti=$r;function ei(t){return ei="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ei(t)}function ni(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,ri(r.key),r)}}function ri(t){var e=function(t,e){if("object"!=ei(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=ei(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==ei(e)?e:e+""}function ii(t,e,n){return e=ai(e),function(t,e){if(e&&("object"===ei(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,oi()?Reflect.construct(e,n||[],ai(t).constructor):e.apply(t,n))}function oi(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(oi=function(){return!!t})()}function ai(t){return ai=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},ai(t)}function si(t,e){return si=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},si(t,e)}var ui=function(t){function e(t){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new ti;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=ii(this,e)).isCacheNode=!0,n.node=t,n.cache=r,n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&si(t,e)}(e,t),n=e,r=[{key:"getNodeType",value:function(t){return this.node.getNodeType(t)}},{key:"build",value:function(t){var e,n=t.getCache(),r=this.cache||t.globalCache;t.setCache(r);for(var i=arguments.length,o=new Array(i>1?i-1:0),a=1;a<i;a++)o[a-1]=arguments[a];var s=(e=this.node).build.apply(e,[t].concat(o));return t.setCache(n),s}}],r&&ni(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(F);const ci=ui;var li=bn(ui);function fi(t){return fi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},fi(t)}function hi(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function pi(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?hi(Object(n),!0).forEach((function(e){var r,i,o;r=t,i=e,o=n[e],(i=mi(i))in r?Object.defineProperty(r,i,{value:o,enumerable:!0,configurable:!0,writable:!0}):r[i]=o})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):hi(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function di(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,mi(r.key),r)}}function mi(t){var e=function(t,e){if("object"!=fi(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=fi(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==fi(e)?e:e+""}function yi(t,e,n){return e=gi(e),function(t,e){if(e&&("object"===fi(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,vi()?Reflect.construct(e,n||[],gi(t).constructor):e.apply(t,n))}function vi(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(vi=function(){return!!t})()}function gi(t){return gi=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},gi(t)}function bi(t,e){return bi=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},bi(t,e)}Ce("cache",li),Ce("globalCache",(function(t){return li(t,null)})),z("CacheNode",ui);var _i=function(t){function e(t){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=yi(this,e)).isContextNode=!0,n.node=t,n.context=r,n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&bi(t,e)}(e,t),n=e,r=[{key:"getNodeType",value:function(t){return this.node.getNodeType(t)}},{key:"setup",value:function(t){var e=t.getContext();t.setContext(pi(pi({},t.context),this.context));var n=this.node.build(t);return t.setContext(e),n}},{key:"generate",value:function(t,e){var n=t.getContext();t.setContext(pi(pi({},t.context),this.context));var r=this.node.build(t,e);return t.setContext(n),r}}],r&&di(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(F);const xi=_i;var wi=bn(_i),Si=function(t,e){return wi(t,{label:e})};function Ti(t){return Ti="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ti(t)}function Mi(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Ei(r.key),r)}}function Ei(t){var e=function(t,e){if("object"!=Ti(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=Ti(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Ti(e)?e:e+""}function Ai(t,e,n){return e=Pi(e),function(t,e){if(e&&("object"===Ti(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,Oi()?Reflect.construct(e,n||[],Pi(t).constructor):e.apply(t,n))}function Oi(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(Oi=function(){return!!t})()}function Pi(t){return Pi=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Pi(t)}function Ri(t,e){return Ri=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Ri(t,e)}Ce("context",wi),Ce("label",Si),z("ContextNode",_i);var ki=function(t){function e(t){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=Ai(this,e,["uint"])).scope=t,n.isInstanceIndexNode=!0,n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Ri(t,e)}(e,t),n=e,(r=[{key:"generate",value:function(t){var n,r=this.getNodeType(t),i=this.scope;if(i===e.VERTEX)n=t.getVertexIndex();else{if(i!==e.INSTANCE)throw new Error("THREE.IndexNode: Unknown scope: "+i);n=t.getInstanceIndex()}return"vertex"===t.shaderStage||"compute"===t.shaderStage?n:Ar(this).build(t,r)}}])&&Mi(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(F);ki.VERTEX="vertex",ki.INSTANCE="instance";const Ci=ki;var Ni=_n(ki,ki.VERTEX),Li=_n(ki,ki.INSTANCE);function ji(t){return ji="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ji(t)}function Ii(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Bi(r.key),r)}}function Bi(t){var e=function(t,e){if("object"!=ji(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=ji(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==ji(e)?e:e+""}z("IndexNode",ki);var Ui=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)},(e=[{key:"start",value:function(){}},{key:"finish",value:function(){}},{key:"direct",value:function(){}},{key:"indirectDiffuse",value:function(){}},{key:"indirectSpecular",value:function(){}},{key:"ambientOcclusion",value:function(){}}])&&Ii(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();const Di=Ui;function Fi(t){return Fi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Fi(t)}function zi(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Vi(r.key),r)}}function Vi(t){var e=function(t,e){if("object"!=Fi(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=Fi(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Fi(e)?e:e+""}function Gi(t,e,n){return e=qi(e),function(t,e){if(e&&("object"===Fi(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,Hi()?Reflect.construct(e,n||[],qi(t).constructor):e.apply(t,n))}function Hi(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(Hi=function(){return!!t})()}function Wi(){return Wi="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=qi(t)););return t}(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(arguments.length<3?t:n):i.value}},Wi.apply(this,arguments)}function qi(t){return qi=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},qi(t)}function Xi(t,e){return Xi=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Xi(t,e)}var Yi=function(t){function e(t){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=Gi(this,e)).node=t,n.name=r,n.isVarNode=!0,n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Xi(t,e)}(e,t),n=e,(r=[{key:"isGlobal",value:function(){return!0}},{key:"getHash",value:function(t){return this.name||Wi(qi(e.prototype),"getHash",this).call(this,t)}},{key:"getNodeType",value:function(t){return this.node.getNodeType(t)}},{key:"generate",value:function(t){var e=this.node,n=this.name,r=t.getVarFromNode(this,n,t.getVectorType(this.getNodeType(t))),i=t.getPropertyName(r),o=e.build(t,r.type);return t.addLineFlowCode("".concat(i," = ").concat(o)),i}}])&&zi(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(F);const Ji=Yi;var Zi=bn(Yi);function Ki(t){return Ki="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ki(t)}function Qi(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,to(r.key),r)}}function $i(t,e,n){return e&&Qi(t.prototype,e),n&&Qi(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function to(t){var e=function(t,e){if("object"!=Ki(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=Ki(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Ki(e)?e:e+""}Ce("temp",Zi),Ce("toVar",(function(){return Zi.apply(void 0,arguments).append()})),z("VarNode",Yi);var eo=$i((function t(e,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.isNodeAttribute=!0,this.name=e,this.type=n,this.node=r}));const no=eo;function ro(t){return ro="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ro(t)}function io(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,oo(r.key),r)}}function oo(t){var e=function(t,e){if("object"!=ro(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=ro(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==ro(e)?e:e+""}var ao=function(){return t=function t(e,n,r){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.isNodeUniform=!0,this.name=e,this.type=n,this.node=r.getSelf(),this.needsUpdate=i},(e=[{key:"value",get:function(){return this.node.value},set:function(t){this.node.value=t}},{key:"id",get:function(){return this.node.id}},{key:"groupNode",get:function(){return this.node.groupNode}}])&&io(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();const so=ao;function uo(t){return uo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},uo(t)}function co(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,fo(r.key),r)}}function lo(t,e,n){return e&&co(t.prototype,e),n&&co(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function fo(t){var e=function(t,e){if("object"!=uo(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=uo(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==uo(e)?e:e+""}var ho=lo((function t(e,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.isNodeVar=!0,this.name=e,this.type=n}));const po=ho;function mo(t){return mo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},mo(t)}function yo(t,e,n){return e=go(e),function(t,e){if(e&&("object"===mo(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,vo()?Reflect.construct(e,n||[],go(t).constructor):e.apply(t,n))}function vo(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(vo=function(){return!!t})()}function go(t){return go=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},go(t)}function bo(t,e){return bo=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},bo(t,e)}var _o=function(t){function e(t,n){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(r=yo(this,e,[t,n])).needsInterpolation=!1,r.isNodeVarying=!0,r}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&bo(t,e)}(e,t),n=e,Object.defineProperty(n,"prototype",{writable:!1}),n;var n}(po);const xo=_o;function wo(t){return wo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},wo(t)}function So(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Mo(r.key),r)}}function To(t,e,n){return e&&So(t.prototype,e),n&&So(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function Mo(t){var e=function(t,e){if("object"!=wo(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=wo(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==wo(e)?e:e+""}var Eo=To((function t(e,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.name=e,this.type=n,this.code=r,Object.defineProperty(this,"isNodeCode",{value:!0})}));const Ao=Eo;function Oo(t){return Oo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Oo(t)}function Po(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return Ro(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Ro(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function Ro(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function ko(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Co(r.key),r)}}function Co(t){var e=function(t,e){if("object"!=Oo(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=Oo(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Oo(e)?e:e+""}var No=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.keywords=[],this.nodes=[],this.keywordsCallback={}},e=[{key:"getNode",value:function(t){var e=this.nodes[t];return void 0===e&&void 0!==this.keywordsCallback[t]&&(e=this.keywordsCallback[t](t),this.nodes[t]=e),e}},{key:"addKeyword",value:function(t,e){return this.keywords.push(t),this.keywordsCallback[t]=e,this}},{key:"parse",value:function(t){var e=this.keywords,n=new RegExp("\\b".concat(e.join("\\b|\\b"),"\\b"),"g"),r=t.match(n),i=[];if(null!==r){var o,a=Po(r);try{for(a.s();!(o=a.n()).done;){var s=o.value,u=this.getNode(s);void 0!==u&&-1===i.indexOf(u)&&i.push(u)}}catch(t){a.e(t)}finally{a.f()}}return i}},{key:"include",value:function(t,e){var n,r=Po(this.parse(e));try{for(r.s();!(n=r.n()).done;)n.value.build(t)}catch(t){r.e(t)}finally{r.f()}}}],e&&ko(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();const Lo=No;function jo(t){return jo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},jo(t)}function Io(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Bo(r.key),r)}}function Bo(t){var e=function(t,e){if("object"!=jo(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=jo(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==jo(e)?e:e+""}function Uo(t,e,n){return e=zo(e),function(t,e){if(e&&("object"===jo(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,Do()?Reflect.construct(e,n||[],zo(t).constructor):e.apply(t,n))}function Do(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(Do=function(){return!!t})()}function Fo(){return Fo="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=zo(t)););return t}(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(arguments.length<3?t:n):i.value}},Fo.apply(this,arguments)}function zo(t){return zo=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},zo(t)}function Vo(t,e){return Vo=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Vo(t,e)}var Go=function(t){function e(t){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=Uo(this,e,[t])).name=r,n.varying=i,n.isPropertyNode=!0,n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Vo(t,e)}(e,t),n=e,(r=[{key:"getHash",value:function(t){return this.name||Fo(zo(e.prototype),"getHash",this).call(this,t)}},{key:"isGlobal",value:function(){return!0}},{key:"generate",value:function(t){var e;return!0===this.varying?(e=t.getVaryingFromNode(this,this.name)).needsInterpolation=!0:e=t.getVarFromNode(this,this.name),t.getPropertyName(e)}}])&&Io(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(F);const Ho=Go;var Wo=function(t,e){return yn(new Go(t,e))},qo=function(t,e){return yn(new Go(t,e,!0))},Xo=_n(Go,"vec4","DiffuseColor"),Yo=_n(Go,"float","Roughness"),Jo=_n(Go,"float","Metalness"),Zo=_n(Go,"float","Clearcoat"),Ko=_n(Go,"float","ClearcoatRoughness"),Qo=_n(Go,"vec3","Sheen"),$o=_n(Go,"float","SheenRoughness"),ta=_n(Go,"float","Iridescence"),ea=_n(Go,"float","IridescenceIOR"),na=_n(Go,"float","IridescenceThickness"),ra=_n(Go,"color","SpecularColor"),ia=_n(Go,"float","Shininess"),oa=_n(Go,"vec4","Output"),aa=_n(Go,"float","dashSize"),sa=_n(Go,"float","gapSize"),ua=_n(Go,"float","pointWidth");function ca(t){return ca="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ca(t)}function la(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,fa(r.key),r)}}function fa(t){var e=function(t,e){if("object"!=ca(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=ca(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==ca(e)?e:e+""}function ha(t,e,n){return e=da(e),function(t,e){if(e&&("object"===ca(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,pa()?Reflect.construct(e,n||[],da(t).constructor):e.apply(t,n))}function pa(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(pa=function(){return!!t})()}function da(t){return da=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},da(t)}function ma(t,e){return ma=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},ma(t,e)}z("PropertyNode",Go);var ya=function(t){function e(t){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=ha(this,e,[t,r])).isParameterNode=!0,n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&ma(t,e)}(e,t),n=e,(r=[{key:"getHash",value:function(){return this.uuid}},{key:"generate",value:function(){return this.name}}])&&la(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(Ho);const va=ya;var ga=function(t,e){return yn(new ya(t,e))};function ba(t){return ba="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ba(t)}function _a(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function xa(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,wa(r.key),r)}}function wa(t){var e=function(t,e){if("object"!=ba(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=ba(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==ba(e)?e:e+""}function Sa(t,e,n){return e=Ea(e),function(t,e){if(e&&("object"===ba(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,Ta()?Reflect.construct(e,n||[],Ea(t).constructor):e.apply(t,n))}function Ta(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(Ta=function(){return!!t})()}function Ma(){return Ma="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Ea(t)););return t}(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(arguments.length<3?t:n):i.value}},Ma.apply(this,arguments)}function Ea(t){return Ea=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Ea(t)}function Aa(t,e){return Aa=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Aa(t,e)}z("ParameterNode",ya);var Oa=function(t){function e(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(t=Sa(this,e,["code"])).isCodeNode=!0,t.code=n,t.language=i,t.includes=r,t}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Aa(t,e)}(e,t),n=e,(r=[{key:"isGlobal",value:function(){return!0}},{key:"setIncludes",value:function(t){return this.includes=t,this}},{key:"getIncludes",value:function(){return this.includes}},{key:"generate",value:function(t){var e,n=function(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return _a(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_a(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}(this.getIncludes(t));try{for(n.s();!(e=n.n()).done;)e.value.build(t)}catch(t){n.e(t)}finally{n.f()}var r=t.getCodeFromNode(this,this.getNodeType(t));return r.code=this.code,r.code}},{key:"serialize",value:function(t){Ma(Ea(e.prototype),"serialize",this).call(this,t),t.code=this.code,t.language=this.language}},{key:"deserialize",value:function(t){Ma(Ea(e.prototype),"deserialize",this).call(this,t),this.code=t.code,this.language=t.language}}])&&xa(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(F);const Pa=Oa;var Ra=bn(Oa),ka=function(t,e){return Ra(t,e,"js")},Ca=function(t,e){return Ra(t,e,"wgsl")},Na=function(t,e){return Ra(t,e,"glsl")};function La(t){return La="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},La(t)}function ja(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function Ia(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Ba(r.key),r)}}function Ba(t){var e=function(t,e){if("object"!=La(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=La(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==La(e)?e:e+""}function Ua(t,e,n){return e=za(e),function(t,e){if(e&&("object"===La(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,Da()?Reflect.construct(e,n||[],za(t).constructor):e.apply(t,n))}function Da(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(Da=function(){return!!t})()}function Fa(){return Fa="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=za(t)););return t}(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(arguments.length<3?t:n):i.value}},Fa.apply(this,arguments)}function za(t){return za=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},za(t)}function Va(t,e){return Va=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Va(t,e)}z("CodeNode",Oa);var Ga=function(t){function e(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(t=Ua(this,e,[n,r,i])).keywords={},t}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Va(t,e)}(e,t),n=e,r=[{key:"getNodeType",value:function(t){return this.getNodeFunction(t).type}},{key:"getInputs",value:function(t){return this.getNodeFunction(t).inputs}},{key:"getNodeFunction",value:function(t){var e=t.getDataFromNode(this),n=e.nodeFunction;return void 0===n&&(n=t.parser.parseFunction(this.code),e.nodeFunction=n),n}},{key:"generate",value:function(t,n){Fa(za(e.prototype),"generate",this).call(this,t);var r=this.getNodeFunction(t),i=r.name,o=r.type,a=t.getCodeFromNode(this,o);""!==i&&(a.name=i);var s=t.getPropertyName(a),u=this.getNodeFunction(t).getCode(s),c=this.keywords,l=Object.keys(c);if(l.length>0){var f,h=function(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return ja(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ja(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}(l);try{for(h.s();!(f=h.n()).done;){var p=f.value,d=new RegExp("\\b".concat(p,"\\b"),"g"),m=c[p].build(t,"property");u=u.replace(d,m)}}catch(t){h.e(t)}finally{h.f()}}return a.code=u+"\n","property"===n?s:t.format("".concat(s,"()"),o,n)}}],r&&Ia(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(Pa);const Ha=Ga;var Wa=function(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",r=0;r<e.length;r++){var i=e[r];"function"==typeof i&&(e[r]=i.functionNode)}var o=yn(new Ga(t,e,n)),a=function(){return o.call.apply(o,arguments)};return a.functionNode=o,a},qa=function(t,e){return Wa(t,e,"glsl")},Xa=function(t,e){return Wa(t,e,"wgsl")};function Ya(t){return Ya="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ya(t)}function Ja(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Za(r.key),r)}}function Za(t){var e=function(t,e){if("object"!=Ya(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=Ya(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Ya(e)?e:e+""}function Ka(t,e,n){return e=$a(e),function(t,e){if(e&&("object"===Ya(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,Qa()?Reflect.construct(e,n||[],$a(t).constructor):e.apply(t,n))}function Qa(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(Qa=function(){return!!t})()}function $a(t){return $a=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},$a(t)}function ts(t,e){return ts=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},ts(t,e)}z("FunctionNode",Ga);var es=function(t){function e(t){var n,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=Ka(this,e,["string"])).name=t,n.version=0,n.shared=r,n.isUniformGroup=!0,n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&ts(t,e)}(e,t),n=e,(r=[{key:"needsUpdate",set:function(t){!0===t&&this.version++}}])&&Ja(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(F),ns=function(t){return new es(t)},rs=function(t){return new es(t,!0)},is=rs("frame"),os=rs("render"),as=ns("object");const ss=es;function us(t){return us="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},us(t)}function cs(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,ls(r.key),r)}}function ls(t){var e=function(t,e){if("object"!=us(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=us(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==us(e)?e:e+""}function fs(t,e,n){return e=ds(e),function(t,e){if(e&&("object"===us(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,hs()?Reflect.construct(e,n||[],ds(t).constructor):e.apply(t,n))}function hs(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(hs=function(){return!!t})()}function ps(){return ps="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=ds(t)););return t}(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(arguments.length<3?t:n):i.value}},ps.apply(this,arguments)}function ds(t){return ds=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},ds(t)}function ms(t,e){return ms=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},ms(t,e)}z("UniformGroupNode",es);var ys=function(t){function e(t){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=fs(this,e,[t,r])).isUniformNode=!0,n.groupNode=as,n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&ms(t,e)}(e,t),n=e,r=[{key:"setGroup",value:function(t){return this.groupNode=t,this}},{key:"getGroup",value:function(){return this.groupNode}},{key:"getUniformHash",value:function(t){return this.getHash(t)}},{key:"onUpdate",value:function(t,n){var r=this,i=this.getSelf();return t=t.bind(i),ps(ds(e.prototype),"onUpdate",this).call(this,(function(e){var n=t(e,i);void 0!==n&&(r.value=n)}),n)}},{key:"generate",value:function(t,e){var n=this.getNodeType(t),r=this.getUniformHash(t),i=t.getNodeFromHash(r);void 0===i&&(t.setHashNode(this,r),i=this);var o=i.getInputType(t),a=t.getUniformFromNode(i,o,t.shaderStage,t.context.label),s=t.getPropertyName(a);return void 0!==t.context.label&&delete t.context.label,t.format(s,n,e)}}],r&&cs(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(ae);const vs=ys;var gs=function(t,e){var n=dn(e||t),r=t&&!0===t.isNode?t.node&&t.node.value||t.value:t;return yn(new ys(r,n))};function bs(t){return bs="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},bs(t)}function _s(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,xs(r.key),r)}}function xs(t){var e=function(t,e){if("object"!=bs(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=bs(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==bs(e)?e:e+""}function ws(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(ws=function(){return!!t})()}function Ss(){return Ss="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Ts(t)););return t}(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(arguments.length<3?t:n):i.value}},Ss.apply(this,arguments)}function Ts(t){return Ts=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Ts(t)}function Ms(t,e){return Ms=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Ms(t,e)}z("UniformNode",ys);var Es=function(t){function e(){var t,n,r,i,o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=this,r=e,i=[null,"vec2"],r=Ts(r),t=function(t,e){if(e&&("object"===bs(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(n,ws()?Reflect.construct(r,i||[],Ts(n).constructor):r.apply(n,i))).isUVNode=!0,t.index=o,t}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Ms(t,e)}(e,t),n=e,(r=[{key:"getAttributeName",value:function(){var t=this.index;return"uv"+(t>0?t:"")}},{key:"serialize",value:function(t){Ss(Ts(e.prototype),"serialize",this).call(this,t),t.index=this.index}},{key:"deserialize",value:function(t){Ss(Ts(e.prototype),"deserialize",this).call(this,t),this.index=t.index}}])&&_s(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(Br);const As=Es;var Os=function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return yn(function(t,e,n){if(ws())return Reflect.construct.apply(null,arguments);var r=[null];r.push.apply(r,e);var i=new(t.bind.apply(t,r));return n&&Ms(i,n.prototype),i}(Es,e))};function Ps(t){return Ps="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ps(t)}function Rs(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,ks(r.key),r)}}function ks(t){var e=function(t,e){if("object"!=Ps(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=Ps(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Ps(e)?e:e+""}function Cs(t,e,n){return e=Ls(e),function(t,e){if(e&&("object"===Ps(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,Ns()?Reflect.construct(e,n||[],Ls(t).constructor):e.apply(t,n))}function Ns(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(Ns=function(){return!!t})()}function Ls(t){return Ls=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Ls(t)}function js(t,e){return js=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},js(t,e)}z("UVNode",Es);var Is=function(t){function e(t){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=Cs(this,e,["uvec2"])).isTextureSizeNode=!0,n.textureNode=t,n.levelNode=r,n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&js(t,e)}(e,t),n=e,r=[{key:"generate",value:function(t,e){var n=this.textureNode.build(t,"property"),r=this.levelNode.build(t,"int");return t.format("".concat(t.getMethod("textureDimensions"),"( ").concat(n,", ").concat(r," )"),this.getNodeType(t),e)}}],r&&Rs(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(F),Bs=bn(Is);function Us(t){return Us="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Us(t)}function Ds(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Fs(r.key),r)}}function Fs(t){var e=function(t,e){if("object"!=Us(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=Us(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Us(e)?e:e+""}function zs(t,e,n){return e=Hs(e),function(t,e){if(e&&("object"===Us(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,Vs()?Reflect.construct(e,n||[],Hs(t).constructor):e.apply(t,n))}function Vs(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(Vs=function(){return!!t})()}function Gs(){return Gs="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Hs(t)););return t}(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(arguments.length<3?t:n):i.value}},Gs.apply(this,arguments)}function Hs(t){return Hs=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Hs(t)}function Ws(t,e){return Ws=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Ws(t,e)}Ce("textureSize",Bs),z("TextureSizeNode",Is);var qs=function(t){function e(t,n,r){var i;if(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(i=zs(this,e)).op=t,(arguments.length<=3?0:arguments.length-3)>0){for(var o=r,a=0;a<(arguments.length<=3?0:arguments.length-3);a++)o=new e(t,o,a+3<3||arguments.length<=a+3?void 0:arguments[a+3]);r=o}return i.aNode=n,i.bNode=r,i}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Ws(t,e)}(e,t),n=e,r=[{key:"getNodeType",value:function(t,e){var n=this.op,r=this.aNode,i=this.bNode,o=r.getNodeType(t),a=void 0!==i?i.getNodeType(t):null;if("void"===o||"void"===a)return"void";if("%"===n)return o;if("~"===n||"&"===n||"|"===n||"^"===n||">>"===n||"<<"===n)return t.getIntegerType(o);if("!"===n||"=="===n||"&&"===n||"||"===n||"^^"===n)return"bool";if("<"===n||">"===n||"<="===n||">="===n){var s=e?t.getTypeLength(e):Math.max(t.getTypeLength(o),t.getTypeLength(a));return s>1?"bvec".concat(s):"bool"}return"float"===o&&t.isMatrix(a)?a:t.isMatrix(o)&&t.isVector(a)?t.getVectorFromMatrix(o):t.isVector(o)&&t.isMatrix(a)?t.getVectorFromMatrix(a):t.getTypeLength(a)>t.getTypeLength(o)?a:o}},{key:"generate",value:function(t,e){var n=this.op,r=this.aNode,i=this.bNode,o=this.getNodeType(t,e),a=null,s=null;"void"!==o?(a=r.getNodeType(t),s=void 0!==i?i.getNodeType(t):null,"<"===n||">"===n||"<="===n||">="===n||"=="===n?t.isVector(a)?s=a:a=s="float":">>"===n||"<<"===n?(a=o,s=t.changeComponentType(s,"uint")):t.isMatrix(a)&&t.isVector(s)?s=t.getVectorFromMatrix(a):a=t.isVector(a)&&t.isMatrix(s)?t.getVectorFromMatrix(s):s=o):a=s=o;var u=r.build(t,a),c=void 0!==i?i.build(t,s):null,l=t.getTypeLength(e),f=t.getFunctionOperator(n);return"void"!==e?"<"===n&&l>1?t.format("".concat(t.getMethod("lessThan"),"( ").concat(u,", ").concat(c," )"),o,e):"<="===n&&l>1?t.format("".concat(t.getMethod("lessThanEqual"),"( ").concat(u,", ").concat(c," )"),o,e):">"===n&&l>1?t.format("".concat(t.getMethod("greaterThan"),"( ").concat(u,", ").concat(c," )"),o,e):">="===n&&l>1?t.format("".concat(t.getMethod("greaterThanEqual"),"( ").concat(u,", ").concat(c," )"),o,e):"!"===n||"~"===n?t.format("(".concat(n).concat(u,")"),a,e):f?t.format("".concat(f,"( ").concat(u,", ").concat(c," )"),o,e):t.format("( ".concat(u," ").concat(n," ").concat(c," )"),o,e):"void"!==a?f?t.format("".concat(f,"( ").concat(u,", ").concat(c," )"),o,e):t.format("".concat(u," ").concat(n," ").concat(c),o,e):void 0}},{key:"serialize",value:function(t){Gs(Hs(e.prototype),"serialize",this).call(this,t),t.op=this.op}},{key:"deserialize",value:function(t){Gs(Hs(e.prototype),"deserialize",this).call(this,t),this.op=t.op}}],r&&Ds(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(Q);const Xs=qs;var Ys=bn(qs,"+"),Js=bn(qs,"-"),Zs=bn(qs,"*"),Ks=bn(qs,"/"),Qs=bn(qs,"%"),$s=bn(qs,"=="),tu=bn(qs,"!="),eu=bn(qs,"<"),nu=bn(qs,">"),ru=bn(qs,"<="),iu=bn(qs,">="),ou=bn(qs,"&&"),au=bn(qs,"||"),su=bn(qs,"!"),uu=bn(qs,"^^"),cu=bn(qs,"&"),lu=bn(qs,"~"),fu=bn(qs,"|"),hu=bn(qs,"^"),pu=bn(qs,"<<"),du=bn(qs,">>");function mu(t){return mu="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},mu(t)}function yu(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,vu(r.key),r)}}function vu(t){var e=function(t,e){if("object"!=mu(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=mu(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==mu(e)?e:e+""}function gu(t,e,n){return e=xu(e),function(t,e){if(e&&("object"===mu(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,bu()?Reflect.construct(e,n||[],xu(t).constructor):e.apply(t,n))}function bu(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(bu=function(){return!!t})()}function _u(){return _u="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=xu(t)););return t}(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(arguments.length<3?t:n):i.value}},_u.apply(this,arguments)}function xu(t){return xu=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},xu(t)}function wu(t,e){return wu=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},wu(t,e)}Ce("add",Ys),Ce("sub",Js),Ce("mul",Zs),Ce("div",Ks),Ce("remainder",Qs),Ce("equal",$s),Ce("notEqual",tu),Ce("lessThan",eu),Ce("greaterThan",nu),Ce("lessThanEqual",ru),Ce("greaterThanEqual",iu),Ce("and",ou),Ce("or",au),Ce("not",su),Ce("xor",uu),Ce("bitAnd",cu),Ce("bitNot",lu),Ce("bitOr",fu),Ce("bitXor",hu),Ce("shiftLeft",pu),Ce("shiftRight",du),z("OperatorNode",qs);var Su=function(t){function e(t,n){var r,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(r=gu(this,e)).method=t,r.aNode=n,r.bNode=i,r.cNode=o,r}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&wu(t,e)}(e,t),n=e,r=[{key:"getInputType",value:function(t){var e=this.aNode.getNodeType(t),n=this.bNode?this.bNode.getNodeType(t):null,r=this.cNode?this.cNode.getNodeType(t):null,i=t.isMatrix(e)?0:t.getTypeLength(e),o=t.isMatrix(n)?0:t.getTypeLength(n),a=t.isMatrix(r)?0:t.getTypeLength(r);return i>o&&i>a?e:o>a?n:a>i?r:e}},{key:"getNodeType",value:function(t){var n=this.method;return n===e.LENGTH||n===e.DISTANCE||n===e.DOT?"float":n===e.CROSS?"vec3":n===e.ALL?"bool":n===e.EQUALS?t.changeComponentType(this.aNode.getNodeType(t),"bool"):n===e.MOD?this.aNode.getNodeType(t):this.getInputType(t)}},{key:"generate",value:function(t,n){var r=this.method,i=this.getNodeType(t),o=this.getInputType(t),a=this.aNode,s=this.bNode,u=this.cNode,c=!0===t.renderer.isWebGLRenderer;if(r===e.TRANSFORM_DIRECTION){var l=a,f=s;t.isMatrix(l.getNodeType(t))?f=Fn(In(f),0):l=Fn(In(l),0);var h=Zs(l,f).xyz;return Vu(h).build(t,n)}if(r===e.NEGATE)return t.format("( - "+a.build(t,o)+" )",i,n);if(r===e.ONE_MINUS)return Js(1,a).build(t,n);if(r===e.RECIPROCAL)return Ks(1,a).build(t,n);if(r===e.DIFFERENCE)return Zu(Js(a,s)).build(t,n);var p=[];return r===e.CROSS||r===e.MOD?p.push(a.build(t,i),s.build(t,i)):r===e.STEP?p.push(a.build(t,1===t.getTypeLength(a.getNodeType(t))?"float":o),s.build(t,o)):c&&(r===e.MIN||r===e.MAX)||r===e.MOD?p.push(a.build(t,o),s.build(t,1===t.getTypeLength(s.getNodeType(t))?"float":o)):r===e.REFRACT?p.push(a.build(t,o),s.build(t,o),u.build(t,"float")):r===e.MIX?p.push(a.build(t,o),s.build(t,o),u.build(t,1===t.getTypeLength(u.getNodeType(t))?"float":o)):(p.push(a.build(t,o)),null!==s&&p.push(s.build(t,o)),null!==u&&p.push(u.build(t,o))),t.format("".concat(t.getMethod(r,i),"( ").concat(p.join(", ")," )"),i,n)}},{key:"serialize",value:function(t){_u(xu(e.prototype),"serialize",this).call(this,t),t.method=this.method}},{key:"deserialize",value:function(t){_u(xu(e.prototype),"deserialize",this).call(this,t),this.method=t.method}}],r&&yu(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(Q);Su.ALL="all",Su.ANY="any",Su.EQUALS="equals",Su.RADIANS="radians",Su.DEGREES="degrees",Su.EXP="exp",Su.EXP2="exp2",Su.LOG="log",Su.LOG2="log2",Su.SQRT="sqrt",Su.INVERSE_SQRT="inversesqrt",Su.FLOOR="floor",Su.CEIL="ceil",Su.NORMALIZE="normalize",Su.FRACT="fract",Su.SIN="sin",Su.COS="cos",Su.TAN="tan",Su.ASIN="asin",Su.ACOS="acos",Su.ATAN="atan",Su.ABS="abs",Su.SIGN="sign",Su.LENGTH="length",Su.NEGATE="negate",Su.ONE_MINUS="oneMinus",Su.DFDX="dFdx",Su.DFDY="dFdy",Su.ROUND="round",Su.RECIPROCAL="reciprocal",Su.TRUNC="trunc",Su.FWIDTH="fwidth",Su.BITCAST="bitcast",Su.ATAN2="atan2",Su.MIN="min",Su.MAX="max",Su.MOD="mod",Su.STEP="step",Su.REFLECT="reflect",Su.DISTANCE="distance",Su.DIFFERENCE="difference",Su.DOT="dot",Su.CROSS="cross",Su.POW="pow",Su.TRANSFORM_DIRECTION="transformDirection",Su.MIX="mix",Su.CLAMP="clamp",Su.REFRACT="refract",Su.SMOOTHSTEP="smoothstep",Su.FACEFORWARD="faceforward";const Tu=Su;var Mu=On(1e-6),Eu=On(1e6),Au=On(Math.PI),Ou=On(2*Math.PI),Pu=bn(Su,Su.ALL),Ru=bn(Su,Su.ANY),ku=bn(Su,Su.EQUALS),Cu=bn(Su,Su.RADIANS),Nu=bn(Su,Su.DEGREES),Lu=bn(Su,Su.EXP),ju=bn(Su,Su.EXP2),Iu=bn(Su,Su.LOG),Bu=bn(Su,Su.LOG2),Uu=bn(Su,Su.SQRT),Du=bn(Su,Su.INVERSE_SQRT),Fu=bn(Su,Su.FLOOR),zu=bn(Su,Su.CEIL),Vu=bn(Su,Su.NORMALIZE),Gu=bn(Su,Su.FRACT),Hu=bn(Su,Su.SIN),Wu=bn(Su,Su.COS),qu=bn(Su,Su.TAN),Xu=bn(Su,Su.ASIN),Yu=bn(Su,Su.ACOS),Ju=bn(Su,Su.ATAN),Zu=bn(Su,Su.ABS),Ku=bn(Su,Su.SIGN),Qu=bn(Su,Su.LENGTH),$u=bn(Su,Su.NEGATE),tc=bn(Su,Su.ONE_MINUS),ec=bn(Su,Su.DFDX),nc=bn(Su,Su.DFDY),rc=bn(Su,Su.ROUND),ic=bn(Su,Su.RECIPROCAL),oc=bn(Su,Su.TRUNC),ac=bn(Su,Su.FWIDTH),sc=bn(Su,Su.BITCAST),uc=bn(Su,Su.ATAN2),cc=bn(Su,Su.MIN),lc=bn(Su,Su.MAX),fc=bn(Su,Su.MOD),hc=bn(Su,Su.STEP),pc=bn(Su,Su.REFLECT),dc=bn(Su,Su.DISTANCE),mc=bn(Su,Su.DIFFERENCE),yc=bn(Su,Su.DOT),vc=bn(Su,Su.CROSS),gc=bn(Su,Su.POW),bc=bn(Su,Su.POW,2),_c=bn(Su,Su.POW,3),xc=bn(Su,Su.POW,4),wc=bn(Su,Su.TRANSFORM_DIRECTION),Sc=function(t){return Zs(Ku(t),gc(Zu(t),1/3))},Tc=function(t){return yc(t,t)},Mc=bn(Su,Su.MIX),Ec=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return yn(new Su(Su.CLAMP,yn(t),yn(e),yn(n)))},Ac=function(t){return Ec(t)},Oc=bn(Su,Su.REFRACT),Pc=bn(Su,Su.SMOOTHSTEP),Rc=bn(Su,Su.FACEFORWARD);function kc(t){return kc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},kc(t)}function Cc(t,e,n){return(e=Lc(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function Nc(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Lc(r.key),r)}}function Lc(t){var e=function(t,e){if("object"!=kc(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=kc(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==kc(e)?e:e+""}function jc(t,e,n){return e=Bc(e),function(t,e){if(e&&("object"===kc(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,Ic()?Reflect.construct(e,n||[],Bc(t).constructor):e.apply(t,n))}function Ic(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(Ic=function(){return!!t})()}function Bc(t){return Bc=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Bc(t)}function Uc(t,e){return Uc=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Uc(t,e)}Ce("all",Pu),Ce("any",Ru),Ce("equals",ku),Ce("radians",Cu),Ce("degrees",Nu),Ce("exp",Lu),Ce("exp2",ju),Ce("log",Iu),Ce("log2",Bu),Ce("sqrt",Uu),Ce("inverseSqrt",Du),Ce("floor",Fu),Ce("ceil",zu),Ce("normalize",Vu),Ce("fract",Gu),Ce("sin",Hu),Ce("cos",Wu),Ce("tan",qu),Ce("asin",Xu),Ce("acos",Yu),Ce("atan",Ju),Ce("abs",Zu),Ce("sign",Ku),Ce("length",Qu),Ce("lengthSq",Tc),Ce("negate",$u),Ce("oneMinus",tc),Ce("dFdx",ec),Ce("dFdy",nc),Ce("round",rc),Ce("reciprocal",ic),Ce("trunc",oc),Ce("fwidth",ac),Ce("atan2",uc),Ce("min",cc),Ce("max",lc),Ce("mod",fc),Ce("step",hc),Ce("reflect",pc),Ce("distance",dc),Ce("dot",yc),Ce("cross",vc),Ce("pow",gc),Ce("pow2",bc),Ce("pow3",_c),Ce("pow4",xc),Ce("transformDirection",wc),Ce("mix",(function(t,e,n){return Mc(e,n,t)})),Ce("clamp",Ec),Ce("refract",Oc),Ce("smoothstep",(function(t,e,n){return Pc(e,n,t)})),Ce("faceForward",Rc),Ce("difference",mc),Ce("saturate",Ac),Ce("cbrt",Sc),z("MathNode",Su);var Dc=wn((function(t){var e=t.value,n=e.rgb,r=n.mul(.9478672986).add(.0521327014).pow(2.4),i=n.mul(.0773993808),o=n.lessThanEqual(.04045),a=Mc(r,i,o);return Fn(a,e.a)})),Fc=wn((function(t){var e=t.value,n=e.rgb,r=n.pow(.41666).mul(1.055).sub(.055),i=n.mul(12.92),o=n.lessThanEqual(.0031308),a=Mc(r,i,o);return Fn(a,e.a)})),zc=function(t){var e=null;return t===h.Zr2?e="Linear":t===h.er$&&(e="sRGB"),e},Vc=function(t,e){return zc(t)+"To"+zc(e)},Gc=function(t){function e(t,n){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(r=jc(this,e,["vec4"])).method=t,r.node=n,r}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Uc(t,e)}(e,t),n=e,(r=[{key:"setup",value:function(){var t=this.method,n=this.node;return t===e.LINEAR_TO_LINEAR?n:Hc[t]({value:n})}}])&&Nc(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(Q);Gc.LINEAR_TO_LINEAR="LinearToLinear",Gc.LINEAR_TO_sRGB="LinearTosRGB",Gc.sRGB_TO_LINEAR="sRGBToLinear";var Hc=Cc(Cc({},Gc.LINEAR_TO_sRGB,Fc),Gc.sRGB_TO_LINEAR,Dc);const Wc=Gc;var qc=function(t,e){return yn(new Gc(Vc(h.Zr2,e),yn(t)))},Xc=function(t,e){return yn(new Gc(Vc(e,h.Zr2),yn(t)))},Yc=bn(Gc,Gc.LINEAR_TO_sRGB),Jc=bn(Gc,Gc.sRGB_TO_LINEAR);function Zc(t){return Zc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Zc(t)}function Kc(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Qc(r.key),r)}}function Qc(t){var e=function(t,e){if("object"!=Zc(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=Zc(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Zc(e)?e:e+""}function $c(t,e,n){return e=el(e),function(t,e){if(e&&("object"===Zc(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,tl()?Reflect.construct(e,n||[],el(t).constructor):e.apply(t,n))}function tl(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(tl=function(){return!!t})()}function el(t){return el=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},el(t)}function nl(t,e){return nl=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},nl(t,e)}Ce("linearTosRGB",Yc),Ce("sRGBToLinear",Jc),Ce("linearToColorSpace",qc),Ce("colorSpaceToLinear",Xc),z("ColorSpaceNode",Gc);var rl=function(t){function e(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"void";return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(t=$c(this,e,[r])).snippet=n,t}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&nl(t,e)}(e,t),n=e,r=[{key:"generate",value:function(t,e){var n=this.getNodeType(t),r=this.snippet;if("void"!==n)return t.format("( ".concat(r," )"),n,e);t.addLineFlowCode(r)}}],r&&Kc(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(F);const il=rl;var ol=bn(rl);function al(t){return al="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},al(t)}function sl(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,ul(r.key),r)}}function ul(t){var e=function(t,e){if("object"!=al(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=al(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==al(e)?e:e+""}function cl(t,e,n){return e=fl(e),function(t,e){if(e&&("object"===al(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,ll()?Reflect.construct(e,n||[],fl(t).constructor):e.apply(t,n))}function ll(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(ll=function(){return!!t})()}function fl(t){return fl=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},fl(t)}function hl(t,e){return hl=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},hl(t,e)}z("ExpressionNode",rl);var pl=function(t){function e(t){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=cl(this,e,[0])).textureNode=t,n.updateType=a.FRAME,n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&hl(t,e)}(e,t),n=e,(r=[{key:"texture",get:function(){return this.textureNode.value}},{key:"update",value:function(){var t=this.texture,e=t.images,n=e&&e.length>0?e[0]&&e[0].image||e[0]:t.image;if(n&&void 0!==n.width){var r=n.width,i=n.height;this.value=Math.log2(Math.max(r,i))}}}])&&sl(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(vs);const dl=pl;var ml=bn(pl);function yl(t){return yl="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},yl(t)}function vl(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,gl(r.key),r)}}function gl(t){var e=function(t,e){if("object"!=yl(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=yl(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==yl(e)?e:e+""}function bl(t,e,n){return e=wl(e),function(t,e){if(e&&("object"===yl(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,_l()?Reflect.construct(e,n||[],wl(t).constructor):e.apply(t,n))}function _l(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(_l=function(){return!!t})()}function xl(){return xl="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=wl(t)););return t}(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(arguments.length<3?t:n):i.value}},xl.apply(this,arguments)}function wl(t){return wl=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},wl(t)}function Sl(t,e){return Sl=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Sl(t,e)}z("MaxMipLevelNode",pl);var Tl=function(t){function e(t){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=bl(this,e,[t])).isTextureNode=!0,n.uvNode=r,n.levelNode=i,n.compareNode=null,n.depthNode=null,n.sampler=!0,n.updateMatrix=!1,n.updateType=a.NONE,n.referenceNode=null,n._value=t,n.setUpdateMatrix(null===r),n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Sl(t,e)}(e,t),n=e,r=[{key:"value",get:function(){return this.referenceNode?this.referenceNode.value:this._value},set:function(t){this.referenceNode?this.referenceNode.value=t:this._value=t}},{key:"getUniformHash",value:function(){return this.value.uuid}},{key:"getNodeType",value:function(){return!0===this.value.isDepthTexture?"float":"vec4"}},{key:"getInputType",value:function(){return"texture"}},{key:"getDefaultUV",value:function(){return Os(this.value.channel)}},{key:"updateReference",value:function(){return this.value}},{key:"getTransformedUV",value:function(t){var e=this.value;return gs(e.matrix).mul(In(t,1)).xy}},{key:"setUpdateMatrix",value:function(t){return this.updateMatrix=t,this.updateType=t?a.FRAME:a.NONE,this}},{key:"setupUV",value:function(t,e){var n=this.value;return!t.isFlipY()||!0!==n.isRenderTargetTexture&&!0!==n.isFramebufferTexture&&!0!==n.isDepthTexture||(e=e.setY(e.y.oneMinus())),e}},{key:"setup",value:function(t){var e=t.getNodeProperties(this),n=this.uvNode;null!==n&&!0!==t.context.forceUVContext||!t.context.getUV||(n=t.context.getUV(this)),n||(n=this.getDefaultUV()),!0===this.updateMatrix&&(n=this.getTransformedUV(n)),n=this.setupUV(t,n);var r=this.levelNode;null===r&&t.context.getTextureLevel&&(r=t.context.getTextureLevel(this)),e.uvNode=n,e.levelNode=r,e.compareNode=this.compareNode,e.depthNode=this.depthNode}},{key:"generateUV",value:function(t,e){return e.build(t,!0===this.sampler?"vec2":"ivec2")}},{key:"generateSnippet",value:function(t,e,n,r,i,o){var a=this.value;return r?t.generateTextureLevel(a,e,n,r,i):o?t.generateTextureCompare(a,e,n,o,i):!1===this.sampler?t.generateTextureLoad(a,e,n,i):t.generateTexture(a,e,n,i)}},{key:"generate",value:function(t,n){var r=t.getNodeProperties(this),i=this.value;if(!i||!0!==i.isTexture)throw new Error("TextureNode: Need a three.js texture.");var o=xl(wl(e.prototype),"generate",this).call(this,t,"property");if("sampler"===n)return o+"_sampler";if(t.isReference(n))return o;var a=t.getDataFromNode(this),s=a.propertyName;if(void 0===s){var u=r.uvNode,c=r.levelNode,l=r.compareNode,f=r.depthNode,h=this.generateUV(t,u),p=c?c.build(t,"float"):null,d=f?f.build(t,"int"):null,m=l?l.build(t,"float"):null,y=t.getVarFromNode(this);s=t.getPropertyName(y);var v=this.generateSnippet(t,o,h,p,d,m);t.addLineFlowCode("".concat(s," = ").concat(v)),!1!==t.context.tempWrite&&(a.snippet=v,a.propertyName=s)}var g=s,b=this.getNodeType(t);return t.needsColorSpaceToLinear(i)&&(g=Xc(ol(g,b),i.colorSpace).setup(t).build(t,b)),t.format(g,b,n)}},{key:"setSampler",value:function(t){return this.sampler=t,this}},{key:"getSampler",value:function(){return this.sampler}},{key:"uv",value:function(t){var e=this.clone();return e.uvNode=t,e.referenceNode=this,yn(e)}},{key:"blur",value:function(t){var e=this.clone();return e.levelNode=t.mul(ml(e)),e.referenceNode=this,yn(e)}},{key:"level",value:function(t){var e=this.clone();return e.levelNode=t,e.referenceNode=this,e}},{key:"size",value:function(t){return Bs(this,t)}},{key:"compare",value:function(t){var e=this.clone();return e.compareNode=yn(t),e.referenceNode=this,yn(e)}},{key:"depth",value:function(t){var e=this.clone();return e.depthNode=yn(t),e.referenceNode=this,yn(e)}},{key:"serialize",value:function(t){xl(wl(e.prototype),"serialize",this).call(this,t),t.value=this.value.toJSON(t.meta).uuid}},{key:"deserialize",value:function(t){xl(wl(e.prototype),"deserialize",this).call(this,t),this.value=t.meta.textures[t.value]}},{key:"update",value:function(){var t=this.value;!0===t.matrixAutoUpdate&&t.updateMatrix()}},{key:"clone",value:function(){var t=new this.constructor(this.value,this.uvNode,this.levelNode);return t.sampler=this.sampler,t}}],r&&vl(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(vs);const Ml=Tl;var El=bn(Tl),Al=function(){return El.apply(void 0,arguments).setSampler(!1)},Ol=function(t){return(!0===t.isNode?t:El(t)).convert("sampler")};function Pl(t){return Pl="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Pl(t)}function Rl(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,kl(r.key),r)}}function kl(t){var e=function(t,e){if("object"!=Pl(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=Pl(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Pl(e)?e:e+""}function Cl(t,e,n){return e=Ll(e),function(t,e){if(e&&("object"===Pl(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,Nl()?Reflect.construct(e,n||[],Ll(t).constructor):e.apply(t,n))}function Nl(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(Nl=function(){return!!t})()}function Ll(t){return Ll=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Ll(t)}function jl(t,e){return jl=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},jl(t,e)}Ce("texture",El),z("TextureNode",Tl);var Il=function(t){function e(t,n){var r,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(r=Cl(this,e,[t,n])).isBufferNode=!0,r.bufferType=n,r.bufferCount=i,r}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&jl(t,e)}(e,t),n=e,(r=[{key:"getInputType",value:function(){return"buffer"}}])&&Rl(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(vs);const Bl=Il;var Ul=function(t,e,n){return yn(new Il(t,e,n))};function Dl(t){return Dl="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Dl(t)}function Fl(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function zl(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Gl(r.key),r)}}function Vl(t,e,n){return e&&zl(t.prototype,e),n&&zl(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function Gl(t){var e=function(t,e){if("object"!=Dl(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=Dl(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Dl(e)?e:e+""}function Hl(t,e,n){return e=Xl(e),function(t,e){if(e&&("object"===Dl(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,Wl()?Reflect.construct(e,n||[],Xl(t).constructor):e.apply(t,n))}function Wl(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(Wl=function(){return!!t})()}function ql(){return ql="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Xl(t)););return t}(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(arguments.length<3?t:n):i.value}},ql.apply(this,arguments)}function Xl(t){return Xl=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Xl(t)}function Yl(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Jl(t,e)}function Jl(t,e){return Jl=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Jl(t,e)}z("BufferNode",Il);var Zl=function(t){function e(t,n){var r;return Fl(this,e),(r=Hl(this,e,[t,n])).isArrayBufferElementNode=!0,r}return Yl(e,t),Vl(e,[{key:"getNodeType",value:function(t){return this.node.getElementType(t)}},{key:"generate",value:function(t){var n=ql(Xl(e.prototype),"generate",this).call(this,t),r=this.getNodeType();return t.format(n,"vec4",r)}}])}(st),Kl=function(t){function e(t){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return Fl(this,e),(n=Hl(this,e,[null,"vec4"])).array=t,n.elementType=r,n._elementType=null,n._elementLength=0,n.updateType=a.RENDER,n.isArrayBufferNode=!0,n}return Yl(e,t),Vl(e,[{key:"getElementType",value:function(){return this.elementType||this._elementType}},{key:"getElementLength",value:function(){return this._elementLength}},{key:"update",value:function(){var t=this.array,e=this.value,n=this.getElementLength(),r=this.getElementType();if(1===n)for(var i=0;i<t.length;i++)e[4*i]=t[i];else if("color"===r)for(var o=0;o<t.length;o++){var a=4*o,s=t[o];e[a]=s.r,e[a+1]=s.g,e[a+2]=s.b||0}else for(var u=0;u<t.length;u++){var c=4*u,l=t[u];e[c]=l.x,e[c+1]=l.y,e[c+2]=l.z||0,e[c+3]=l.w||0}}},{key:"setup",value:function(t){var n=this.array.length;return this._elementType=null===this.elementType?S(this.array[0]):this.elementType,this._elementLength=t.getTypeLength(this._elementType),this.value=new Float32Array(4*n),this.bufferCount=n,ql(Xl(e.prototype),"setup",this).call(this,t)}},{key:"element",value:function(t){return yn(new Zl(this,yn(t)))}}])}(Bl);const Ql=Kl;var $l=function(t,e){return yn(new Kl(t,e))};function tf(t){return tf="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},tf(t)}function ef(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function nf(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,of(r.key),r)}}function rf(t,e,n){return e&&nf(t.prototype,e),n&&nf(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function of(t){var e=function(t,e){if("object"!=tf(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=tf(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==tf(e)?e:e+""}function af(t,e,n){return e=cf(e),function(t,e){if(e&&("object"===tf(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,sf()?Reflect.construct(e,n||[],cf(t).constructor):e.apply(t,n))}function sf(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(sf=function(){return!!t})()}function uf(){return uf="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=cf(t)););return t}(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(arguments.length<3?t:n):i.value}},uf.apply(this,arguments)}function cf(t){return cf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},cf(t)}function lf(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&ff(t,e)}function ff(t,e){return ff=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},ff(t,e)}z("UniformsNode",Kl);var hf=function(t){function e(t,n){var r;return ef(this,e),(r=af(this,e,[t,n])).referenceNode=t,r.isReferenceElementNode=!0,r}return lf(e,t),rf(e,[{key:"getNodeType",value:function(){return this.referenceNode.uniformType}},{key:"generate",value:function(t){var n=uf(cf(e.prototype),"generate",this).call(this,t),r=this.referenceNode.getNodeType(),i=this.getNodeType();return t.format(n,r,i)}}])}(st),pf=function(t){function e(t,n){var r,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return ef(this,e),(r=af(this,e)).property=t,r.uniformType=n,r.object=i,r.count=o,r.properties=t.split("."),r.reference=null,r.node=null,r.updateType=a.OBJECT,r}return lf(e,t),rf(e,[{key:"element",value:function(t){return yn(new hf(this,yn(t)))}},{key:"setNodeType",value:function(t){var e;e=null!==this.count?Ul(null,t,this.count):Array.isArray(this.getValueFromReference())?$l(null,t):"texture"===t?El(null):gs(null,t),this.node=e}},{key:"getNodeType",value:function(t){return this.node.getNodeType(t)}},{key:"getValueFromReference",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.reference,e=this.properties,n=t[e[0]],r=1;r<e.length;r++)n=n[e[r]];return n}},{key:"updateReference",value:function(t){return this.reference=null!==this.object?this.object:t.object,this.reference}},{key:"setup",value:function(){return this.updateValue(),this.node}},{key:"update",value:function(){this.updateValue()}},{key:"updateValue",value:function(){null===this.node&&this.setNodeType(this.uniformType);var t=this.getValueFromReference();Array.isArray(t)?this.node.array=t:this.node.value=t}}])}(F);const df=pf;var mf=function(t,e,n){return yn(new pf(t,e,n))},yf=function(t,e,n,r){return yn(new pf(t,e,r,n))};function vf(t){return vf="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},vf(t)}function gf(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,bf(r.key),r)}}function bf(t){var e=function(t,e){if("object"!=vf(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=vf(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==vf(e)?e:e+""}function _f(t,e,n){return e=wf(e),function(t,e){if(e&&("object"===vf(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,xf()?Reflect.construct(e,n||[],wf(t).constructor):e.apply(t,n))}function xf(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(xf=function(){return!!t})()}function wf(t){return wf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},wf(t)}function Sf(t,e){return Sf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Sf(t,e)}z("ReferenceNode",pf);var Tf=function(t){function e(t,n){var r,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(r=_f(this,e,[t,n,i])).material=i,r}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Sf(t,e)}(e,t),n=e,(r=[{key:"updateReference",value:function(t){return this.reference=null!==this.material?this.material:t.material,this.reference}}])&&gf(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(df);const Mf=Tf;var Ef=function(t,e,n){return yn(new Tf(t,e,n))};function Af(t){return Af="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Af(t)}function Of(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Pf(r.key),r)}}function Pf(t){var e=function(t,e){if("object"!=Af(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=Af(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Af(e)?e:e+""}function Rf(t,e,n){return e=Nf(e),function(t,e){if(e&&("object"===Af(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,kf()?Reflect.construct(e,n||[],Nf(t).constructor):e.apply(t,n))}function kf(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(kf=function(){return!!t})()}function Cf(){return Cf="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Nf(t)););return t}(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(arguments.length<3?t:n):i.value}},Cf.apply(this,arguments)}function Nf(t){return Nf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Nf(t)}function Lf(t,e){return Lf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Lf(t,e)}z("MaterialReferenceNode",Tf);var jf=function(t){function e(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e.VIEW_MATRIX,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(t=Rf(this,e)).scope=n,t.object3d=r,t.updateType=a.OBJECT,t._uniformNode=new vs(null),t}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Lf(t,e)}(e,t),n=e,(r=[{key:"getNodeType",value:function(){var t=this.scope;return t===e.WORLD_MATRIX||t===e.VIEW_MATRIX?"mat4":t===e.NORMAL_MATRIX?"mat3":t===e.POSITION||t===e.VIEW_POSITION||t===e.DIRECTION||t===e.SCALE?"vec3":void 0}},{key:"update",value:function(t){var n=this.object3d,r=this._uniformNode,i=this.scope;if(i===e.VIEW_MATRIX)r.value=n.modelViewMatrix;else if(i===e.NORMAL_MATRIX)r.value=n.normalMatrix;else if(i===e.WORLD_MATRIX)r.value=n.matrixWorld;else if(i===e.POSITION)r.value=r.value||new h.Pq0,r.value.setFromMatrixPosition(n.matrixWorld);else if(i===e.SCALE)r.value=r.value||new h.Pq0,r.value.setFromMatrixScale(n.matrixWorld);else if(i===e.DIRECTION)r.value=r.value||new h.Pq0,n.getWorldDirection(r.value);else if(i===e.VIEW_POSITION){var o=t.camera;r.value=r.value||new h.Pq0,r.value.setFromMatrixPosition(n.matrixWorld),r.value.applyMatrix4(o.matrixWorldInverse)}}},{key:"generate",value:function(t){var n=this.scope;return n===e.WORLD_MATRIX||n===e.VIEW_MATRIX?this._uniformNode.nodeType="mat4":n===e.NORMAL_MATRIX?this._uniformNode.nodeType="mat3":n!==e.POSITION&&n!==e.VIEW_POSITION&&n!==e.DIRECTION&&n!==e.SCALE||(this._uniformNode.nodeType="vec3"),this._uniformNode.build(t)}},{key:"serialize",value:function(t){Cf(Nf(e.prototype),"serialize",this).call(this,t),t.scope=this.scope}},{key:"deserialize",value:function(t){Cf(Nf(e.prototype),"deserialize",this).call(this,t),this.scope=t.scope}}])&&Of(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(F);jf.VIEW_MATRIX="viewMatrix",jf.NORMAL_MATRIX="normalMatrix",jf.WORLD_MATRIX="worldMatrix",jf.POSITION="position",jf.SCALE="scale",jf.VIEW_POSITION="viewPosition",jf.DIRECTION="direction";const If=jf;var Bf=bn(jf,jf.DIRECTION),Uf=bn(jf,jf.VIEW_MATRIX),Df=bn(jf,jf.NORMAL_MATRIX),Ff=bn(jf,jf.WORLD_MATRIX),zf=bn(jf,jf.POSITION),Vf=bn(jf,jf.SCALE),Gf=bn(jf,jf.VIEW_POSITION);function Hf(t){return Hf="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Hf(t)}function Wf(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,qf(r.key),r)}}function qf(t){var e=function(t,e){if("object"!=Hf(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=Hf(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Hf(e)?e:e+""}function Xf(t,e,n){return e=Zf(e),function(t,e){if(e&&("object"===Hf(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,Yf()?Reflect.construct(e,n||[],Zf(t).constructor):e.apply(t,n))}function Yf(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(Yf=function(){return!!t})()}function Jf(){return Jf="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Zf(t)););return t}(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(arguments.length<3?t:n):i.value}},Jf.apply(this,arguments)}function Zf(t){return Zf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Zf(t)}function Kf(t,e){return Kf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Kf(t,e)}z("Object3DNode",jf);var Qf=function(t){function e(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e.POSITION;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(t=Xf(this,e,[n])).updateType=a.RENDER,t}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Kf(t,e)}(e,t),n=e,(r=[{key:"getNodeType",value:function(t){var n=this.scope;return n===e.PROJECTION_MATRIX||n===e.PROJECTION_MATRIX_INVERSE?"mat4":n===e.NEAR||n===e.FAR||n===e.LOG_DEPTH?"float":Jf(Zf(e.prototype),"getNodeType",this).call(this,t)}},{key:"update",value:function(t){var n=t.camera,r=this._uniformNode,i=this.scope;i===e.VIEW_MATRIX?r.value=n.matrixWorldInverse:i===e.PROJECTION_MATRIX?r.value=n.projectionMatrix:i===e.PROJECTION_MATRIX_INVERSE?r.value=n.projectionMatrixInverse:i===e.NEAR?r.value=n.near:i===e.FAR?r.value=n.far:i===e.LOG_DEPTH?r.value=2/(Math.log(n.far+1)/Math.LN2):(this.object3d=n,Jf(Zf(e.prototype),"update",this).call(this,t))}},{key:"generate",value:function(t){var n=this.scope;return n===e.PROJECTION_MATRIX||n===e.PROJECTION_MATRIX_INVERSE?this._uniformNode.nodeType="mat4":n!==e.NEAR&&n!==e.FAR&&n!==e.LOG_DEPTH||(this._uniformNode.nodeType="float"),Jf(Zf(e.prototype),"generate",this).call(this,t)}}])&&Wf(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(If);Qf.PROJECTION_MATRIX="projectionMatrix",Qf.PROJECTION_MATRIX_INVERSE="projectionMatrixInverse",Qf.NEAR="near",Qf.FAR="far",Qf.LOG_DEPTH="logDepth";const $f=Qf;var th=_n(Qf,Qf.PROJECTION_MATRIX),eh=_n(Qf,Qf.PROJECTION_MATRIX_INVERSE),nh=_n(Qf,Qf.NEAR),rh=_n(Qf,Qf.FAR),ih=_n(Qf,Qf.LOG_DEPTH),oh=_n(Qf,Qf.VIEW_MATRIX),ah=_n(Qf,Qf.NORMAL_MATRIX),sh=_n(Qf,Qf.WORLD_MATRIX),uh=_n(Qf,Qf.POSITION);function ch(t){return ch="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ch(t)}function lh(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,fh(r.key),r)}}function fh(t){var e=function(t,e){if("object"!=ch(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=ch(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==ch(e)?e:e+""}function hh(t,e,n){return e=mh(e),function(t,e){if(e&&("object"===ch(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,ph()?Reflect.construct(e,n||[],mh(t).constructor):e.apply(t,n))}function ph(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(ph=function(){return!!t})()}function dh(){return dh="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=mh(t)););return t}(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(arguments.length<3?t:n):i.value}},dh.apply(this,arguments)}function mh(t){return mh=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},mh(t)}function yh(t,e){return yh=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},yh(t,e)}z("CameraNode",Qf);var vh=function(t){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e.VIEW_MATRIX;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),hh(this,e,[t])}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&yh(t,e)}(e,t),n=e,(r=[{key:"update",value:function(t){this.object3d=t.object,dh(mh(e.prototype),"update",this).call(this,t)}}])&&lh(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(If);const gh=vh;var bh=_n(vh,vh.DIRECTION),_h=_n(vh,vh.VIEW_MATRIX).label("modelViewMatrix").temp("ModelViewMatrix"),xh=_n(vh,vh.NORMAL_MATRIX),wh=_n(vh,vh.WORLD_MATRIX),Sh=_n(vh,vh.POSITION),Th=_n(vh,vh.SCALE),Mh=_n(vh,vh.VIEW_POSITION);function Eh(t){return Eh="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Eh(t)}function Ah(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Oh(r.key),r)}}function Oh(t){var e=function(t,e){if("object"!=Eh(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=Eh(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Eh(e)?e:e+""}function Ph(t,e,n){return e=Ch(e),function(t,e){if(e&&("object"===Eh(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,Rh()?Reflect.construct(e,n||[],Ch(t).constructor):e.apply(t,n))}function Rh(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(Rh=function(){return!!t})()}function kh(){return kh="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Ch(t)););return t}(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(arguments.length<3?t:n):i.value}},kh.apply(this,arguments)}function Ch(t){return Ch=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Ch(t)}function Nh(t,e){return Nh=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Nh(t,e)}z("ModelNode",vh);var Lh=function(t){function e(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e.LOCAL;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(t=Ph(this,e,["vec3"])).scope=n,t}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Nh(t,e)}(e,t),n=e,(r=[{key:"isGlobal",value:function(){return!0}},{key:"getHash",value:function(){return"normal-".concat(this.scope)}},{key:"generate",value:function(t){var n=this.scope,r=null;if(n===e.GEOMETRY)r=!1===t.hasGeometryAttribute("normal")?In(0,1,0):Ur("normal","vec3");else if(n===e.LOCAL)r=Ar(Ih);else if(n===e.VIEW){var i=xh.mul(Bh);r=Vu(Ar(i))}else if(n===e.WORLD){var o=Uh.transformDirection(oh);r=Vu(Ar(o))}return r.build(t,this.getNodeType(t))}},{key:"serialize",value:function(t){kh(Ch(e.prototype),"serialize",this).call(this,t),t.scope=this.scope}},{key:"deserialize",value:function(t){kh(Ch(e.prototype),"deserialize",this).call(this,t),this.scope=t.scope}}])&&Ah(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(F);Lh.GEOMETRY="geometry",Lh.LOCAL="local",Lh.VIEW="view",Lh.WORLD="world";const jh=Lh;var Ih=_n(Lh,Lh.GEOMETRY),Bh=_n(Lh,Lh.LOCAL).temp("Normal"),Uh=_n(Lh,Lh.VIEW),Dh=_n(Lh,Lh.WORLD),Fh=Wo("vec3","TransformedNormalView"),zh=Fh.transformDirection(oh).normalize(),Vh=Wo("vec3","TransformedClearcoatNormalView");function Gh(t){return Gh="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Gh(t)}function Hh(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Wh(r.key),r)}}function Wh(t){var e=function(t,e){if("object"!=Gh(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=Gh(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Gh(e)?e:e+""}function qh(t,e,n){return e=Yh(e),function(t,e){if(e&&("object"===Gh(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,Xh()?Reflect.construct(e,n||[],Yh(t).constructor):e.apply(t,n))}function Xh(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(Xh=function(){return!!t})()}function Yh(t){return Yh=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Yh(t)}function Jh(t,e){return Jh=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Jh(t,e)}z("NormalNode",Lh);var Zh=new Map,Kh=function(t){function e(t){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=qh(this,e)).scope=t,n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Jh(t,e)}(e,t),n=e,r=[{key:"getCache",value:function(t,e){var n=Zh.get(t);return void 0===n&&(n=Ef(t,e),Zh.set(t,n)),n}},{key:"getFloat",value:function(t){return this.getCache(t,"float")}},{key:"getColor",value:function(t){return this.getCache(t,"color")}},{key:"getTexture",value:function(t){return this.getCache("map"===t?"map":t+"Map","texture")}},{key:"setup",value:function(t){var n=t.context.material,r=this.scope,i=null;if(r===e.COLOR){var o=this.getColor(r);i=n.map&&!0===n.map.isTexture?o.mul(this.getTexture("map")):o}else if(r===e.OPACITY){var a=this.getFloat(r);i=n.alphaMap&&!0===n.alphaMap.isTexture?a.mul(this.getTexture("alpha")):a}else if(r===e.SPECULAR_STRENGTH)i=n.specularMap&&!0===n.specularMap.isTexture?this.getTexture(r).r:On(1);else if(r===e.ROUGHNESS){var s=this.getFloat(r);i=n.roughnessMap&&!0===n.roughnessMap.isTexture?s.mul(this.getTexture(r).g):s}else if(r===e.METALNESS){var u=this.getFloat(r);i=n.metalnessMap&&!0===n.metalnessMap.isTexture?u.mul(this.getTexture(r).b):u}else if(r===e.EMISSIVE){var c=this.getColor(r);i=n.emissiveMap&&!0===n.emissiveMap.isTexture?c.mul(this.getTexture(r)):c}else if(r===e.NORMAL)i=n.normalMap?this.getTexture("normal").normalMap(this.getCache("normalScale","vec2")):n.bumpMap?this.getTexture("bump").r.bumpMap(this.getFloat("bumpScale")):Uh;else if(r===e.CLEARCOAT){var l=this.getFloat(r);i=n.clearcoatMap&&!0===n.clearcoatMap.isTexture?l.mul(this.getTexture(r).r):l}else if(r===e.CLEARCOAT_ROUGHNESS){var f=this.getFloat(r);i=n.clearcoatRoughnessMap&&!0===n.clearcoatRoughnessMap.isTexture?f.mul(this.getTexture(r).r):f}else if(r===e.CLEARCOAT_NORMAL)i=n.clearcoatNormalMap?this.getTexture(r).normalMap(this.getCache(r+"Scale","vec2")):Uh;else if(r===e.SHEEN){var h=this.getColor("sheenColor").mul(this.getFloat("sheen"));i=n.sheenColorMap&&!0===n.sheenColorMap.isTexture?h.mul(this.getTexture("sheenColor").rgb):h}else if(r===e.SHEEN_ROUGHNESS){var p=this.getFloat(r);i=(i=n.sheenRoughnessMap&&!0===n.sheenRoughnessMap.isTexture?p.mul(this.getTexture(r).a):p).clamp(.07,1)}else if(r===e.IRIDESCENCE_THICKNESS){var d=mf("1","float",n.iridescenceThicknessRange);if(n.iridescenceThicknessMap){var m=mf("0","float",n.iridescenceThicknessRange);i=d.sub(m).mul(this.getTexture(r).g).add(m)}else i=d}else{var y=this.getNodeType(t);i=this.getCache(r,y)}return i}}],r&&Hh(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(F);Kh.ALPHA_TEST="alphaTest",Kh.COLOR="color",Kh.OPACITY="opacity",Kh.SHININESS="shininess",Kh.SPECULAR_COLOR="specular",Kh.SPECULAR_STRENGTH="specularStrength",Kh.REFLECTIVITY="reflectivity",Kh.ROUGHNESS="roughness",Kh.METALNESS="metalness",Kh.NORMAL="normal",Kh.CLEARCOAT="clearcoat",Kh.CLEARCOAT_ROUGHNESS="clearcoatRoughness",Kh.CLEARCOAT_NORMAL="clearcoatNormal",Kh.EMISSIVE="emissive",Kh.ROTATION="rotation",Kh.SHEEN="sheen",Kh.SHEEN_ROUGHNESS="sheenRoughness",Kh.IRIDESCENCE="iridescence",Kh.IRIDESCENCE_IOR="iridescenceIOR",Kh.IRIDESCENCE_THICKNESS="iridescenceThickness",Kh.LINE_SCALE="scale",Kh.LINE_DASH_SIZE="dashSize",Kh.LINE_GAP_SIZE="gapSize",Kh.LINE_WIDTH="linewidth",Kh.LINE_DASH_OFFSET="dashOffset",Kh.POINT_WIDTH="pointWidth";const Qh=Kh;var $h=_n(Kh,Kh.ALPHA_TEST),tp=_n(Kh,Kh.COLOR),ep=_n(Kh,Kh.SHININESS),np=_n(Kh,Kh.EMISSIVE),rp=_n(Kh,Kh.OPACITY),ip=_n(Kh,Kh.SPECULAR_COLOR),op=_n(Kh,Kh.SPECULAR_STRENGTH),ap=_n(Kh,Kh.REFLECTIVITY),sp=_n(Kh,Kh.ROUGHNESS),up=_n(Kh,Kh.METALNESS),cp=_n(Kh,Kh.NORMAL),lp=_n(Kh,Kh.CLEARCOAT),fp=_n(Kh,Kh.CLEARCOAT_ROUGHNESS),hp=_n(Kh,Kh.CLEARCOAT_NORMAL),pp=_n(Kh,Kh.ROTATION),dp=_n(Kh,Kh.SHEEN),mp=_n(Kh,Kh.SHEEN_ROUGHNESS),yp=_n(Kh,Kh.IRIDESCENCE),vp=_n(Kh,Kh.IRIDESCENCE_IOR),gp=_n(Kh,Kh.IRIDESCENCE_THICKNESS),bp=_n(Kh,Kh.LINE_SCALE),_p=_n(Kh,Kh.LINE_DASH_SIZE),xp=_n(Kh,Kh.LINE_GAP_SIZE),wp=_n(Kh,Kh.LINE_WIDTH),Sp=_n(Kh,Kh.LINE_DASH_OFFSET),Tp=_n(Kh,Kh.POINT_WIDTH);function Mp(t){return Mp="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Mp(t)}function Ep(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Ap(r.key),r)}}function Ap(t){var e=function(t,e){if("object"!=Mp(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=Mp(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Mp(e)?e:e+""}function Op(t,e,n){return e=kp(e),function(t,e){if(e&&("object"===Mp(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,Pp()?Reflect.construct(e,n||[],kp(t).constructor):e.apply(t,n))}function Pp(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(Pp=function(){return!!t})()}function Rp(){return Rp="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=kp(t)););return t}(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(arguments.length<3?t:n):i.value}},Rp.apply(this,arguments)}function kp(t){return kp=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},kp(t)}function Cp(t,e){return Cp=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Cp(t,e)}z("MaterialNode",Kh);var Np=function(t){function e(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e.LOCAL;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(t=Op(this,e,["vec3"])).scope=n,t}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Cp(t,e)}(e,t),n=e,(r=[{key:"isGlobal",value:function(){return!0}},{key:"getHash",value:function(){return"position-".concat(this.scope)}},{key:"generate",value:function(t){var n=this.scope,r=null;if(n===e.GEOMETRY)r=Ur("position","vec3");else if(n===e.LOCAL)r=Ar(jp);else if(n===e.WORLD){var i=wh.mul(Ip);r=Ar(i)}else if(n===e.VIEW){var o=_h.mul(Ip);r=Ar(o)}else if(n===e.VIEW_DIRECTION){var a=Dp.negate();r=Vu(Ar(a))}else if(n===e.WORLD_DIRECTION){var s=Ip.transformDirection(wh);r=Vu(Ar(s))}return r.build(t,this.getNodeType(t))}},{key:"serialize",value:function(t){Rp(kp(e.prototype),"serialize",this).call(this,t),t.scope=this.scope}},{key:"deserialize",value:function(t){Rp(kp(e.prototype),"deserialize",this).call(this,t),this.scope=t.scope}}])&&Ep(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(F);Np.GEOMETRY="geometry",Np.LOCAL="local",Np.WORLD="world",Np.WORLD_DIRECTION="worldDirection",Np.VIEW="view",Np.VIEW_DIRECTION="viewDirection";const Lp=Np;var jp=_n(Np,Np.GEOMETRY),Ip=_n(Np,Np.LOCAL).temp("Position"),Bp=_n(Np,Np.WORLD),Up=_n(Np,Np.WORLD_DIRECTION),Dp=_n(Np,Np.VIEW),Fp=_n(Np,Np.VIEW_DIRECTION);function zp(t){return zp="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},zp(t)}function Vp(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Gp(r.key),r)}}function Gp(t){var e=function(t,e){if("object"!=zp(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=zp(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==zp(e)?e:e+""}function Hp(t,e,n){return e=qp(e),function(t,e){if(e&&("object"===zp(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,Wp()?Reflect.construct(e,n||[],qp(t).constructor):e.apply(t,n))}function Wp(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(Wp=function(){return!!t})()}function qp(t){return qp=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},qp(t)}function Xp(t,e){return Xp=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Xp(t,e)}z("PositionNode",Np);var Yp=function(t){function e(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(t=Hp(this,e,["vec4"])).positionNode=n,t}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Xp(t,e)}(e,t),n=e,(r=[{key:"setup",value:function(t){if("fragment"===t.shaderStage)return Ar(t.context.mvp);var e=this.positionNode||Ip;return th.mul(_h).mul(e)}}])&&Vp(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(Q);const Jp=Yp;var Zp=bn(Yp);function Kp(t){return Kp="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Kp(t)}function Qp(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,$p(r.key),r)}}function $p(t){var e=function(t,e){if("object"!=Kp(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=Kp(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Kp(e)?e:e+""}function td(t,e,n){return e=nd(e),function(t,e){if(e&&("object"===Kp(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,ed()?Reflect.construct(e,n||[],nd(t).constructor):e.apply(t,n))}function ed(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(ed=function(){return!!t})()}function nd(t){return nd=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},nd(t)}function rd(t,e){return rd=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},rd(t,e)}z("ModelViewProjectionNode",Yp);var id=function(t){function e(t){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=td(this,e,[t,r])).isBufferNode=!0,n.bufferType=r,n.bufferStride=i,n.bufferOffset=o,n.usage=h.agE,n.instanced=!1,n.attribute=null,t&&!0===t.isBufferAttribute&&(n.attribute=t,n.usage=t.usage,n.instanced=t.isInstancedBufferAttribute),n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&rd(t,e)}(e,t),n=e,r=[{key:"getNodeType",value:function(t){return null===this.bufferType&&(this.bufferType=t.getTypeFromAttribute(this.attribute)),this.bufferType}},{key:"setup",value:function(t){if(null===this.attribute){var e=this.getNodeType(t),n=this.value,r=t.getTypeLength(e),i=this.bufferStride||r,o=this.bufferOffset,a=!0===n.isInterleavedBuffer?n:new h.eB$(n,i),s=new h.eHs(a,r,o);a.setUsage(this.usage),this.attribute=s,this.attribute.isInstancedBufferAttribute=this.instanced}}},{key:"generate",value:function(t){var e=this.getNodeType(t),n=t.getBufferAttributeFromNode(this,e),r=t.getPropertyName(n),i=null;return"vertex"===t.shaderStage||"compute"===t.shaderStage?(this.name=r,i=r):i=Ar(this).build(t,e),i}},{key:"getInputType",value:function(){return"bufferAttribute"}},{key:"setUsage",value:function(t){return this.usage=t,this}},{key:"setInstanced",value:function(t){return this.instanced=t,this}}],r&&Qp(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(ae);const od=id;var ad=function(t,e,n,r){return yn(new id(t,e,n,r))},sd=function(t,e,n,r){return ad(t,e,n,r).setUsage(h.Vnu)},ud=function(t,e,n,r){return ad(t,e,n,r).setInstanced(!0)},cd=function(t,e,n,r){return sd(t,e,n,r).setInstanced(!0)};function ld(t){return ld="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ld(t)}function fd(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,hd(r.key),r)}}function hd(t){var e=function(t,e){if("object"!=ld(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=ld(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==ld(e)?e:e+""}function pd(t,e,n){return e=md(e),function(t,e){if(e&&("object"===ld(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,dd()?Reflect.construct(e,n||[],md(t).constructor):e.apply(t,n))}function dd(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(dd=function(){return!!t})()}function md(t){return md=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},md(t)}function yd(t,e){return yd=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},yd(t,e)}Ce("toAttribute",(function(t){return ad(t.value)})),z("BufferAttributeNode",id);var vd=function(t){function e(t){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=pd(this,e,["void"])).instanceMesh=t,n.instanceMatrixNode=null,n.instanceColorNode=null,n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&yd(t,e)}(e,t),n=e,r=[{key:"setup",value:function(){var t=this.instanceMatrixNode,e=this.instanceMesh;if(null===t){var n=e.instanceMatrix,r=new h.LuO(n.array,16,1),i=n.usage===h.Vnu?cd:ud,o=[i(r,"vec4",16,0),i(r,"vec4",16,4),i(r,"vec4",16,8),i(r,"vec4",16,12)];t=Qn.apply(void 0,o),this.instanceMatrixNode=t}var a=e.instanceColor;if(a&&null===this.instanceColorNode){var s=new h.uWO(a.array,3),u=a.usage===h.Vnu?cd:ud;this.instanceColorNode=In(u(s,"vec3",3,0))}var c=t.mul(Ip).xyz,l=Yn(t[0].xyz,t[1].xyz,t[2].xyz),f=Bh.div(In(l[0].dot(l[0]),l[1].dot(l[1]),l[2].dot(l[2]))),p=l.mul(f).xyz;Ip.assign(c),Bh.assign(p),null!==this.instanceColorNode&&qo("vec3","vInstanceColor").assign(this.instanceColorNode)}}],r&&fd(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(F);const gd=vd;var bd=bn(vd);function _d(t){return _d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_d(t)}function xd(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,wd(r.key),r)}}function wd(t){var e=function(t,e){if("object"!=_d(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=_d(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==_d(e)?e:e+""}function Sd(t,e,n){return e=Ed(e),function(t,e){if(e&&("object"===_d(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,Td()?Reflect.construct(e,n||[],Ed(t).constructor):e.apply(t,n))}function Td(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(Td=function(){return!!t})()}function Md(){return Md="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Ed(t)););return t}(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(arguments.length<3?t:n):i.value}},Md.apply(this,arguments)}function Ed(t){return Ed=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Ed(t)}function Ad(t,e){return Ad=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Ad(t,e)}z("InstanceNode",vd);var Od=function(t){function e(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e.LOCAL;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(t=Sd(this,e)).scope=n,t}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Ad(t,e)}(e,t),n=e,(r=[{key:"getHash",value:function(){return"tangent-".concat(this.scope)}},{key:"getNodeType",value:function(){return this.scope===e.GEOMETRY?"vec4":"vec3"}},{key:"generate",value:function(t){var n=this.scope,r=null;if(n===e.GEOMETRY)r=Ur("tangent","vec4"),!1===t.geometry.hasAttribute("tangent")&&t.geometry.computeTangents();else if(n===e.LOCAL)r=Ar(Rd.xyz);else if(n===e.VIEW){var i=_h.mul(Fn(kd,0)).xyz;r=Vu(Ar(i))}else if(n===e.WORLD){var o=Cd.transformDirection(oh);r=Vu(Ar(o))}return r.build(t,this.getNodeType(t))}},{key:"serialize",value:function(t){Md(Ed(e.prototype),"serialize",this).call(this,t),t.scope=this.scope}},{key:"deserialize",value:function(t){Md(Ed(e.prototype),"deserialize",this).call(this,t),this.scope=t.scope}}])&&xd(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(F);Od.GEOMETRY="geometry",Od.LOCAL="local",Od.VIEW="view",Od.WORLD="world";const Pd=Od;var Rd=_n(Od,Od.GEOMETRY),kd=_n(Od,Od.LOCAL),Cd=_n(Od,Od.VIEW),Nd=_n(Od,Od.WORLD),Ld=Zi(Cd,"TransformedTangentView"),jd=Vu(Ld.transformDirection(oh));function Id(t){return Id="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Id(t)}function Bd(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Ud(r.key),r)}}function Ud(t){var e=function(t,e){if("object"!=Id(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=Id(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Id(e)?e:e+""}function Dd(t,e,n){return e=zd(e),function(t,e){if(e&&("object"===Id(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,Fd()?Reflect.construct(e,n||[],zd(t).constructor):e.apply(t,n))}function Fd(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(Fd=function(){return!!t})()}function zd(t){return zd=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},zd(t)}function Vd(t,e){return Vd=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Vd(t,e)}z("TangentNode",Od);var Gd=function(t){function e(t){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=Dd(this,e,["void"])).batchMesh=t,n.instanceColorNode=null,n.batchingIdNode=null,n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Vd(t,e)}(e,t),n=e,(r=[{key:"setup",value:function(t){null===this.batchingIdNode&&(this.batchingIdNode=Ur("batchId"));var e=this.batchMesh._matricesTexture,n=Bs(Al(e),0),r=On(Pn(this.batchingIdNode)).mul(4).toVar(),i=Pn(r.mod(n)),o=Pn(r).div(Pn(n)),a=Qn(Al(e,Nn(i,o)),Al(e,Nn(i.add(1),o)),Al(e,Nn(i.add(2),o)),Al(e,Nn(i.add(3),o))),s=Yn(a[0].xyz,a[1].xyz,a[2].xyz);Ip.assign(a.mul(Ip));var u=Bh.div(In(s[0].dot(s[0]),s[1].dot(s[1]),s[2].dot(s[2]))),c=s.mul(u).xyz;Bh.assign(c),t.hasGeometryAttribute("tangent")&&kd.mulAssign(s)}}])&&Bd(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(F);const Hd=Gd;var Wd=bn(Gd);function qd(t){return qd="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},qd(t)}function Xd(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Yd(r.key),r)}}function Yd(t){var e=function(t,e){if("object"!=qd(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=qd(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==qd(e)?e:e+""}function Jd(t,e,n){return e=Kd(e),function(t,e){if(e&&("object"===qd(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,Zd()?Reflect.construct(e,n||[],Kd(t).constructor):e.apply(t,n))}function Zd(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(Zd=function(){return!!t})()}function Kd(t){return Kd=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Kd(t)}function Qd(t,e){return Qd=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Qd(t,e)}z("batch",Gd);var $d=function(t){function e(t){var n,r,i,o,s=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=Jd(this,e,["void"])).skinnedMesh=t,n.useReference=s,n.updateType=a.OBJECT,n.skinIndexNode=Ur("skinIndex","uvec4"),n.skinWeightNode=Ur("skinWeight","vec4"),s?(r=mf("bindMatrix","mat4"),i=mf("bindMatrixInverse","mat4"),o=yf("skeleton.boneMatrices","mat4",t.skeleton.bones.length)):(r=gs(t.bindMatrix,"mat4"),i=gs(t.bindMatrixInverse,"mat4"),o=Ul(t.skeleton.boneMatrices,"mat4",t.skeleton.bones.length)),n.bindMatrixNode=r,n.bindMatrixInverseNode=i,n.boneMatricesNode=o,n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Qd(t,e)}(e,t),n=e,r=[{key:"setup",value:function(t){var e=this.skinIndexNode,n=this.skinWeightNode,r=this.bindMatrixNode,i=this.bindMatrixInverseNode,o=this.boneMatricesNode,a=o.element(e.x),s=o.element(e.y),u=o.element(e.z),c=o.element(e.w),l=r.mul(Ip),f=Ys(a.mul(n.x).mul(l),s.mul(n.y).mul(l),u.mul(n.z).mul(l),c.mul(n.w).mul(l)),h=i.mul(f).xyz,p=Ys(n.x.mul(a),n.y.mul(s),n.z.mul(u),n.w.mul(c)),d=(p=i.mul(p).mul(r)).transformDirection(Bh).xyz;Ip.assign(h),Bh.assign(d),t.hasGeometryAttribute("tangent")&&kd.assign(d)}},{key:"generate",value:function(t,e){if("void"!==e)return Ip.build(t,e)}},{key:"update",value:function(t){(this.useReference?t.object:this.skinnedMesh).skeleton.update()}}],r&&Xd(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(F);const tm=$d;var em=function(t){return yn(new $d(t))};function nm(t){return nm="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},nm(t)}function rm(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,im(r.key),r)}}function im(t){var e=function(t,e){if("object"!=nm(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=nm(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==nm(e)?e:e+""}function om(t,e,n){return e=sm(e),function(t,e){if(e&&("object"===nm(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,am()?Reflect.construct(e,n||[],sm(t).constructor):e.apply(t,n))}function am(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(am=function(){return!!t})()}function sm(t){return sm=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},sm(t)}function um(t,e){return um=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},um(t,e)}z("SkinningNode",$d);var cm=function(t){function e(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(t=om(this,e)).params=n,t}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&um(t,e)}(e,t),n=e,r=[{key:"getVarName",value:function(t){return String.fromCharCode("i".charCodeAt()+t)}},{key:"getProperties",value:function(t){var e=t.getNodeProperties(this);if(void 0!==e.stackNode)return e;for(var n={},r=0,i=this.params.length-1;r<i;r++){var o=this.params[r],a=!0!==o.isNode&&o.name||this.getVarName(r),s=!0!==o.isNode&&o.type||"int";n[a]=ol(a,s)}return e.returnsNode=this.params[this.params.length-1](n,t.addStack(),t),e.stackNode=t.removeStack(),e}},{key:"getNodeType",value:function(t){var e=this.getProperties(t).returnsNode;return e?e.getNodeType(t):"void"}},{key:"setup",value:function(t){this.getProperties(t)}},{key:"generate",value:function(t){for(var e=this.getProperties(t),n=this.params,r=e.stackNode,i=0,o=n.length-1;i<o;i++){var a=n[i],s=null,u=null,c=null,l=null,f=null,h=null;a.isNode?(l="int",c=this.getVarName(i),s="0",u=a.build(t,l),f="<"):(l=a.type||"int",c=a.name||this.getVarName(i),s=a.start,u=a.end,f=a.condition,h=a.update,"number"==typeof s?s=s.toString():s&&s.isNode&&(s=s.build(t,l)),"number"==typeof u?u=u.toString():u&&u.isNode&&(u=u.build(t,l)),void 0!==s&&void 0===u?(s+=" - 1",u="0",f=">="):void 0!==u&&void 0===s&&(s="0",f="<"),void 0===f&&(f=Number(s)>Number(u)?">=":"<"));var p={start:s,end:u,condition:f},d=p.start,m=p.end,y="",v="",g="";h||(h="int"===l||"uint"===l?f.includes("<")?"++":"--":f.includes("<")?"+= 1.":"-= 1."),y+=t.getVar(l,c)+" = "+d,v+=c+" "+f+" "+m,g+=c+" "+h;var b="for ( ".concat(y,"; ").concat(v,"; ").concat(g," )");t.addFlowCode((0===i?"\n":"")+t.tab+b+" {\n\n").addFlowTab()}var _=wi(r,{tempWrite:!1}).build(t,"void"),x=e.returnsNode?e.returnsNode.build(t):"";t.removeFlowTab().addFlowCode("\n"+t.tab+_);for(var w=0,S=this.params.length-1;w<S;w++)t.addFlowCode((0===w?"":t.tab)+"}\n\n").removeFlowTab();return t.addFlowTab(),x}}],r&&rm(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(F);const lm=cm;var fm=function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return yn(new cm(gn(e,"int"))).append()},hm=function(){return ol("continue").append()},pm=function(){return ol("break").append()};function dm(t){return dm="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},dm(t)}function mm(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,ym(r.key),r)}}function ym(t){var e=function(t,e){if("object"!=dm(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=dm(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==dm(e)?e:e+""}function vm(t,e,n){return e=bm(e),function(t,e){if(e&&("object"===dm(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,gm()?Reflect.construct(e,n||[],bm(t).constructor):e.apply(t,n))}function gm(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(gm=function(){return!!t})()}function bm(t){return bm=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},bm(t)}function _m(t,e){return _m=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},_m(t,e)}Ce("loop",(function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return Yr(t,fm.apply(void 0,n))})),z("LoopNode",cm);var xm=new WeakMap,wm=new h.IUQ,Sm=wn((function(t){var e=t.bufferMap,n=t.influence,r=t.stride,i=t.width,o=t.depth,a=t.offset,s=Pn(Ni).mul(r).add(a),u=s.div(i),c=s.sub(u.mul(i));return Al(e,Nn(c,u)).depth(o).mul(n)})),Tm=function(t){function e(t){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=vm(this,e,["void"])).mesh=t,n.morphBaseInfluence=gs(1),n.updateType=a.OBJECT,n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&_m(t,e)}(e,t),n=e,r=[{key:"setup",value:function(t){var e=this,n=t.geometry,r=void 0!==n.morphAttributes.position,i=void 0!==n.morphAttributes.normal,o=n.morphAttributes.position||n.morphAttributes.normal||n.morphAttributes.color,a=void 0!==o?o.length:0,s=function(t){var e=void 0!==t.morphAttributes.position,n=void 0!==t.morphAttributes.normal,r=void 0!==t.morphAttributes.color,i=t.morphAttributes.position||t.morphAttributes.normal||t.morphAttributes.color,o=void 0!==i?i.length:0,a=xm.get(t);if(void 0===a||a.count!==o){void 0!==a&&a.texture.dispose();var s=t.morphAttributes.position||[],u=t.morphAttributes.normal||[],c=t.morphAttributes.color||[],l=0;!0===e&&(l=1),!0===n&&(l=2),!0===r&&(l=3);var f=t.attributes.position.count*l,p=1,d=4096;f>d&&(p=Math.ceil(f/d),f=d);var m=new Float32Array(f*p*4*o),y=new h.rFo(m,f,p,o);y.type=h.RQf,y.needsUpdate=!0;for(var v=4*l,g=0;g<o;g++)for(var b=s[g],_=u[g],x=c[g],w=f*p*4*g,S=0;S<b.count;S++){var T=S*v;!0===e&&(wm.fromBufferAttribute(b,S),m[w+T+0]=wm.x,m[w+T+1]=wm.y,m[w+T+2]=wm.z,m[w+T+3]=0),!0===n&&(wm.fromBufferAttribute(_,S),m[w+T+4]=wm.x,m[w+T+5]=wm.y,m[w+T+6]=wm.z,m[w+T+7]=0),!0===r&&(wm.fromBufferAttribute(x,S),m[w+T+8]=wm.x,m[w+T+9]=wm.y,m[w+T+10]=wm.z,m[w+T+11]=4===x.itemSize?wm.w:1)}a={count:o,texture:y,stride:l,size:new h.I9Y(f,p)},xm.set(t,a),t.addEventListener("dispose",(function e(){y.dispose(),xm.delete(t),t.removeEventListener("dispose",e)}))}return a}(n),u=s.texture,c=s.stride,l=s.size;!0===r&&Ip.mulAssign(this.morphBaseInfluence),!0===i&&Bh.mulAssign(this.morphBaseInfluence);var f=Pn(l.width);fm(a,(function(t){var n=t.i,o=On(0).toVar();!0===e.mesh.isInstancedMesh&&null!==e.mesh.morphTexture&&void 0!==e.mesh.morphTexture?o.assign(Al(e.mesh.morphTexture,Nn(Pn(n).add(1),Pn(Li))).r):o.assign(mf("morphTargetInfluences","float").element(n).toVar()),!0===r&&Ip.addAssign(Sm({bufferMap:u,influence:o,stride:c,width:f,depth:n,offset:Pn(0)})),!0===i&&Bh.addAssign(Sm({bufferMap:u,influence:o,stride:c,width:f,depth:n,offset:Pn(1)}))}))}},{key:"update",value:function(){var t=this.morphBaseInfluence;this.mesh.geometry.morphTargetsRelative?t.value=1:t.value=1-this.mesh.morphTargetInfluences.reduce((function(t,e){return t+e}),0)}}],r&&mm(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(F);const Mm=Tm;var Em=bn(Tm);function Am(t){return Am="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Am(t)}function Om(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Pm(r.key),r)}}function Pm(t){var e=function(t,e){if("object"!=Am(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=Am(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Am(e)?e:e+""}function Rm(t,e,n){return e=Cm(e),function(t,e){if(e&&("object"===Am(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,km()?Reflect.construct(e,n||[],Cm(t).constructor):e.apply(t,n))}function km(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(km=function(){return!!t})()}function Cm(t){return Cm=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Cm(t)}function Nm(t,e){return Nm=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Nm(t,e)}z("MorphNode",Tm);var Lm=function(t){function e(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),Rm(this,e,["vec3"])}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Nm(t,e)}(e,t),n=e,(r=[{key:"getHash",value:function(){return"reflectVector"}},{key:"setup",value:function(){return Fp.negate().reflect(Fh).transformDirection(oh)}}])&&Om(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(F);const jm=Lm;var Im=_n(Lm);function Bm(t){return Bm="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Bm(t)}function Um(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Dm(r.key),r)}}function Dm(t){var e=function(t,e){if("object"!=Bm(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=Bm(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Bm(e)?e:e+""}function Fm(t,e,n){return e=Vm(e),function(t,e){if(e&&("object"===Bm(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,zm()?Reflect.construct(e,n||[],Vm(t).constructor):e.apply(t,n))}function zm(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(zm=function(){return!!t})()}function Vm(t){return Vm=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Vm(t)}function Gm(t,e){return Gm=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Gm(t,e)}z("ReflectVectorNode",Lm);var Hm=function(t){function e(t){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=Fm(this,e,[t,r,i])).isCubeTextureNode=!0,n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Gm(t,e)}(e,t),n=e,(r=[{key:"getInputType",value:function(){return"cubeTexture"}},{key:"getDefaultUV",value:function(){return Im}},{key:"setUpdateMatrix",value:function(){}},{key:"setupUV",value:function(t,e){var n=this.value;return t.renderer.coordinateSystem!==h.i7u&&n.isRenderTargetTexture?e:In(e.x.negate(),e.yz)}},{key:"generateUV",value:function(t,e){return e.build(t,"vec3")}}])&&Um(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(Ml);const Wm=Hm;var qm=bn(Hm);function Xm(t){return Xm="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Xm(t)}function Ym(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Jm(r.key),r)}}function Jm(t){var e=function(t,e){if("object"!=Xm(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=Xm(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Xm(e)?e:e+""}function Zm(t,e,n){return e=Qm(e),function(t,e){if(e&&("object"===Xm(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,Km()?Reflect.construct(e,n||[],Qm(t).constructor):e.apply(t,n))}function Km(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(Km=function(){return!!t})()}function Qm(t){return Qm=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Qm(t)}function $m(t,e){return $m=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},$m(t,e)}Ce("cubeTexture",qm),z("CubeTextureNode",Hm);var ty=function(t){function e(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),Zm(this,e,["vec3"])}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&$m(t,e)}(e,t),n=e,(r=[{key:"generate",value:function(){console.warn("Abstract function.")}}])&&Ym(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(F);const ey=ty;function ny(t){return ny="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ny(t)}function ry(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,iy(r.key),r)}}function iy(t){var e=function(t,e){if("object"!=ny(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=ny(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==ny(e)?e:e+""}function oy(t,e,n){return e=uy(e),function(t,e){if(e&&("object"===ny(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,ay()?Reflect.construct(e,n||[],uy(t).constructor):e.apply(t,n))}function ay(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(ay=function(){return!!t})()}function sy(){return sy="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=uy(t)););return t}(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(arguments.length<3?t:n):i.value}},sy.apply(this,arguments)}function uy(t){return uy=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},uy(t)}function cy(t,e){return cy=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},cy(t,e)}z("LightingNode",ty);var ly=null,fy=function(t){function e(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(t=oy(this,e)).updateType=a.FRAME,t.light=n,t.rtt=null,t.shadowNode=null,t.color=new h.Q1f,t._defaultColorNode=gs(t.color),t.colorNode=t._defaultColorNode,t.isAnalyticLightNode=!0,t}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&cy(t,e)}(e,t),n=e,r=[{key:"getCacheKey",value:function(){return sy(uy(e.prototype),"getCacheKey",this).call(this)+"-"+this.light.id+"-"+(this.light.castShadow?"1":"0")}},{key:"getHash",value:function(){return this.light.uuid}},{key:"setupShadow",value:function(t){var e=this.shadowNode;if(null===e){null===ly&&((ly=t.createNodeMaterial()).fragmentNode=Fn(0,0,0,1),ly.isShadowNodeMaterial=!0);var n=this.light.shadow,r=t.createRenderTarget(n.mapSize.width,n.mapSize.height),i=new h.VCu;i.minFilter=h.hxR,i.magFilter=h.hxR,i.image.width=n.mapSize.width,i.image.height=n.mapSize.height,i.compareFunction=h.vim,r.depthTexture=i,n.camera.updateProjectionMatrix();var o=mf("bias","float",n),s=mf("normalBias","float",n),u=gs(n.matrix).mul(Bp.add(Dh.mul(s))),c=(u=u.xyz.div(u.w)).x.greaterThanEqual(0).and(u.x.lessThanEqual(1)).and(u.y.greaterThanEqual(0)).and(u.y.lessThanEqual(1)).and(u.z.lessThanEqual(1)),l=u.z.add(o);t.renderer.coordinateSystem===h.i7u&&(l=l.mul(2).sub(1)),e=function(t,e,n){return El(t,e).compare(n)}(i,(u=In(u.x,u.y.oneMinus(),l)).xy,u.z);var f=El(r.texture,u);this.rtt=r,this.colorNode=this.colorNode.mul(c.mix(1,e.mix(f.a.mix(1,f),1))),this.shadowNode=e,this.updateBeforeType=a.RENDER}}},{key:"setup",value:function(t){this.light.castShadow?this.setupShadow(t):null!==this.shadowNode&&this.disposeShadow()}},{key:"updateShadow",value:function(t){var e=this.rtt,n=this.light,r=t.renderer,i=t.scene,o=i.overrideMaterial;i.overrideMaterial=ly,e.setSize(n.shadow.mapSize.width,n.shadow.mapSize.height),n.shadow.updateMatrices(n);var a=r.getRenderTarget(),s=r.getRenderObjectFunction();r.setRenderObjectFunction((function(t){if(!0===t.castShadow){for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];r.renderObject.apply(r,[t].concat(n))}})),r.setRenderTarget(e),r.render(i,n.shadow.camera),r.setRenderTarget(a),r.setRenderObjectFunction(s),i.overrideMaterial=o}},{key:"disposeShadow",value:function(){this.rtt.dispose(),this.shadowNode=null,this.rtt=null,this.colorNode=this._defaultColorNode}},{key:"updateBefore",value:function(t){this.light.castShadow&&this.updateShadow(t)}},{key:"update",value:function(){var t=this.light;this.color.copy(t.color).multiplyScalar(t.intensity)}}],r&&ry(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(ey);const hy=fy;function py(t){return py="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},py(t)}function dy(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return my(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?my(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function my(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function yy(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,vy(r.key),r)}}function vy(t){var e=function(t,e){if("object"!=py(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=py(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==py(e)?e:e+""}function gy(t,e,n){return e=_y(e),function(t,e){if(e&&("object"===py(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,by()?Reflect.construct(e,n||[],_y(t).constructor):e.apply(t,n))}function by(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(by=function(){return!!t})()}function _y(t){return _y=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},_y(t)}function xy(t,e){return xy=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},xy(t,e)}z("AnalyticLightNode",fy);var wy=new WeakMap,Sy=function(t){function e(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(t=gy(this,e,["vec3"])).totalDiffuseNode=In().temp("totalDiffuse"),t.totalSpecularNode=In().temp("totalSpecular"),t.outgoingLightNode=In().temp("outgoingLight"),t.lightNodes=n,t._hash=null,t}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&xy(t,e)}(e,t),n=e,r=[{key:"hasLight",get:function(){return this.lightNodes.length>0}},{key:"getHash",value:function(){if(null===this._hash){var t,e=[],n=dy(this.lightNodes);try{for(n.s();!(t=n.n()).done;){var r=t.value;e.push(r.getHash())}}catch(t){n.e(t)}finally{n.f()}this._hash="lights-"+e.join(",")}return this._hash}},{key:"setup",value:function(t){var e=t.context,n=e.lightingModel,r=this.outgoingLightNode;if(n){var i=this.lightNodes,o=this.totalDiffuseNode,a=this.totalSpecularNode;e.outgoingLight=r;var s=t.addStack();n.start(e,s,t);var u,c=dy(i);try{for(c.s();!(u=c.n()).done;)u.value.build(t)}catch(t){c.e(t)}finally{c.f()}n.indirectDiffuse(e,s,t),n.indirectSpecular(e,s,t),n.ambientOcclusion(e,s,t);var l=e.backdrop,f=e.backdropAlpha,h=e.reflectedLight,p=h.directDiffuse,d=h.directSpecular,m=h.indirectDiffuse,y=h.indirectSpecular,v=p.add(m);null!==l&&(v=In(null!==f?f.mix(v,l):l)),o.assign(v),a.assign(d.add(y)),r.assign(o.add(a)),n.finish(e,s,t),r=r.bypass(t.removeStack())}return r}},{key:"_getLightNodeById",value:function(t){var e,n=dy(this.lightNodes);try{for(n.s();!(e=n.n()).done;){var r=e.value;if(r.isAnalyticLightNode&&r.light.id===t)return r}}catch(t){n.e(t)}finally{n.f()}return null}},{key:"fromLights",value:function(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=[],r=dy(e=function(t){return t.sort((function(t,e){return t.id-e.id}))}(e));try{for(r.s();!(t=r.n()).done;){var i=t.value,o=this._getLightNodeById(i.id);if(null===o){var a=i.constructor,s=wy.has(a)?wy.get(a):hy;o=yn(new s(i))}n.push(o)}}catch(t){r.e(t)}finally{r.f()}return this.lightNodes=n,this._hash=null,this}}],r&&yy(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(F);const Ty=Sy;var My=function(t){return yn((new Sy).fromLights(t))},Ey=bn(Sy);function Ay(t,e){if(wy.has(t))console.warn("Redefinition of light node ".concat(e.type));else{if("function"!=typeof t)throw new Error("Light ".concat(t.name," is not a class"));if("function"!=typeof e||!e.type)throw new Error("Light node ".concat(e.type," is not a class"));wy.set(t,e)}}function Oy(t){return Oy="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Oy(t)}function Py(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Ry(r.key),r)}}function Ry(t){var e=function(t,e){if("object"!=Oy(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=Oy(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Oy(e)?e:e+""}function ky(t,e,n){return e=Ny(e),function(t,e){if(e&&("object"===Oy(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,Cy()?Reflect.construct(e,n||[],Ny(t).constructor):e.apply(t,n))}function Cy(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(Cy=function(){return!!t})()}function Ny(t){return Ny=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Ny(t)}function Ly(t,e){return Ly=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Ly(t,e)}var jy=function(t){function e(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(t=ky(this,e)).aoNode=n,t}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Ly(t,e)}(e,t),n=e,(r=[{key:"setup",value:function(t){var e=this.aoNode.x.sub(1).mul(1).add(1);t.context.ambientOcclusion.mulAssign(e)}}])&&Py(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(ey);const Iy=jy;function By(t){return By="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},By(t)}function Uy(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Dy(r.key),r)}}function Dy(t){var e=function(t,e){if("object"!=By(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=By(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==By(e)?e:e+""}function Fy(t,e,n){return e=Gy(e),function(t,e){if(e&&("object"===By(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,zy()?Reflect.construct(e,n||[],Gy(t).constructor):e.apply(t,n))}function zy(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(zy=function(){return!!t})()}function Vy(){return Vy="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Gy(t)););return t}(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(arguments.length<3?t:n):i.value}},Vy.apply(this,arguments)}function Gy(t){return Gy=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Gy(t)}function Hy(t,e){return Hy=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Hy(t,e)}z("AONode",jy);var Wy=function(t){function e(t){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=Fy(this,e,[t])).lightingModel=r,n.backdropNode=i,n.backdropAlphaNode=o,n._context=null,n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Hy(t,e)}(e,t),n=e,(r=[{key:"getContext",value:function(){var t=this.backdropNode,e=this.backdropAlphaNode,n={directDiffuse:In().temp("directDiffuse"),directSpecular:In().temp("directSpecular"),indirectDiffuse:In().temp("indirectDiffuse"),indirectSpecular:In().temp("indirectSpecular")};return{radiance:In().temp("radiance"),irradiance:In().temp("irradiance"),iblIrradiance:In().temp("iblIrradiance"),ambientOcclusion:On(1).temp("ambientOcclusion"),reflectedLight:n,backdrop:t,backdropAlpha:e}}},{key:"setup",value:function(t){return this.context=this._context||(this._context=this.getContext()),this.context.lightingModel=this.lightingModel||t.context.lightingModel,Vy(Gy(e.prototype),"setup",this).call(this,t)}}])&&Uy(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(xi);const qy=Wy;var Xy=bn(Wy);function Yy(t){return Yy="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Yy(t)}function Jy(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Zy(r.key),r)}}function Zy(t){var e=function(t,e){if("object"!=Yy(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=Yy(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Yy(e)?e:e+""}function Ky(t,e,n){return e=$y(e),function(t,e){if(e&&("object"===Yy(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,Qy()?Reflect.construct(e,n||[],$y(t).constructor):e.apply(t,n))}function Qy(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(Qy=function(){return!!t})()}function $y(t){return $y=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},$y(t)}function tv(t,e){return tv=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},tv(t,e)}Ce("lightingContext",Xy),z("LightingContextNode",Wy);var ev=function(t){function e(t,n){var r,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(r=Ky(this,e)).condNode=t,r.ifNode=n,r.elseNode=i,r}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&tv(t,e)}(e,t),n=e,r=[{key:"getNodeType",value:function(t){var e=this.ifNode.getNodeType(t);if(null!==this.elseNode){var n=this.elseNode.getNodeType(t);if(t.getTypeLength(n)>t.getTypeLength(e))return n}return e}},{key:"generate",value:function(t,e){var n=this.getNodeType(t),r={tempWrite:!1},i=t.getDataFromNode(this);if(void 0!==i.nodeProperty)return i.nodeProperty;var o=this.ifNode,a=this.elseNode,s="void"!==e,u=s?Wo(n).build(t):"";i.nodeProperty=u;var c=wi(this.condNode).build(t,"bool");t.addFlowCode("\n".concat(t.tab,"if ( ").concat(c," ) {\n\n")).addFlowTab();var l=wi(o,r).build(t,n);if(l&&(l=s?u+" = "+l+";":"return "+l+";"),t.removeFlowTab().addFlowCode(t.tab+"\t"+l+"\n\n"+t.tab+"}"),null!==a){t.addFlowCode(" else {\n\n").addFlowTab();var f=wi(a,r).build(t,n);f&&(f=s?u+" = "+f+";":"return "+f+";"),t.removeFlowTab().addFlowCode(t.tab+"\t"+f+"\n\n"+t.tab+"}\n\n")}else t.addFlowCode("\n\n");return t.format(u,n,e)}}],r&&Jy(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(F);const nv=ev;var rv=bn(ev);function iv(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,i,o,a,s=[],u=!0,c=!1;try{if(o=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=o.call(n)).done)&&(s.push(r.value),s.length!==e);u=!0);}catch(t){c=!0,i=t}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw i}}return s}}(t,e)||function(t,e){if(t){if("string"==typeof t)return ov(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ov(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ov(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}Ce("cond",rv),z("CondNode",ev);var av=On(1),sv=On(-2),uv=On(.8),cv=On(-1),lv=On(.4),fv=On(2),hv=On(.305),pv=On(3),dv=On(.21),mv=On(4),yv=On(4),vv=On(16),gv=wn((function(t){var e=iv(t,1)[0],n=In(Zu(e)).toVar(),r=On(-1).toVar();return Mn(n.x.greaterThan(n.z),(function(){Mn(n.x.greaterThan(n.y),(function(){r.assign(rv(e.x.greaterThan(0),0,3))})).else((function(){r.assign(rv(e.y.greaterThan(0),1,4))}))})).else((function(){Mn(n.z.greaterThan(n.y),(function(){r.assign(rv(e.z.greaterThan(0),2,5))})).else((function(){r.assign(rv(e.y.greaterThan(0),1,4))}))})),r})).setLayout({name:"getFace",type:"float",inputs:[{name:"direction",type:"vec3"}]}),bv=wn((function(t){var e=iv(t,2),n=e[0],r=e[1],i=Cn().toVar();return Mn(r.equal(0),(function(){i.assign(Cn(n.z,n.y).div(Zu(n.x)))})).elseif(r.equal(1),(function(){i.assign(Cn(n.x.negate(),n.z.negate()).div(Zu(n.y)))})).elseif(r.equal(2),(function(){i.assign(Cn(n.x.negate(),n.y).div(Zu(n.z)))})).elseif(r.equal(3),(function(){i.assign(Cn(n.z.negate(),n.y).div(Zu(n.x)))})).elseif(r.equal(4),(function(){i.assign(Cn(n.x.negate(),n.z).div(Zu(n.y)))})).else((function(){i.assign(Cn(n.x,n.y).div(Zu(n.z)))})),Zs(.5,i.add(1))})).setLayout({name:"getUV",type:"vec2",inputs:[{name:"direction",type:"vec3"},{name:"face",type:"float"}]}),_v=wn((function(t){var e=iv(t,1)[0],n=On(0).toVar();return Mn(e.greaterThanEqual(uv),(function(){n.assign(av.sub(e).mul(cv.sub(sv)).div(av.sub(uv)).add(sv))})).elseif(e.greaterThanEqual(lv),(function(){n.assign(uv.sub(e).mul(fv.sub(cv)).div(uv.sub(lv)).add(cv))})).elseif(e.greaterThanEqual(hv),(function(){n.assign(lv.sub(e).mul(pv.sub(fv)).div(lv.sub(hv)).add(fv))})).elseif(e.greaterThanEqual(dv),(function(){n.assign(hv.sub(e).mul(mv.sub(pv)).div(hv.sub(dv)).add(pv))})).else((function(){n.assign(On(-2).mul(Bu(Zs(1.16,e))))})),n})).setLayout({name:"roughnessToMip",type:"float",inputs:[{name:"roughness",type:"float"}]}),xv=wn((function(t){var e=iv(t,2),n=e[0],r=e[1],i=n.toVar();i.assign(Zs(2,i).sub(1));var o=In(i,1).toVar();return Mn(r.equal(0),(function(){o.assign(o.zyx)})).elseif(r.equal(1),(function(){o.assign(o.xzy),o.xz.mulAssign(-1)})).elseif(r.equal(2),(function(){o.x.mulAssign(-1)})).elseif(r.equal(3),(function(){o.assign(o.zyx),o.xz.mulAssign(-1)})).elseif(r.equal(4),(function(){o.assign(o.xzy),o.xy.mulAssign(-1)})).elseif(r.equal(5),(function(){o.z.mulAssign(-1)})),o})).setLayout({name:"getDirection",type:"vec3",inputs:[{name:"uv",type:"vec2"},{name:"face",type:"float"}]}),wv=wn((function(t){var e=iv(t,6),n=e[0],r=e[1],i=e[2],o=e[3],a=e[4],s=e[5],u=On(i),c=In(r),l=Ec(_v(u),sv,s),f=Gu(l),h=Fu(l),p=In(Sv(n,c,h,o,a,s)).toVar();return Mn(f.notEqual(0),(function(){var t=In(Sv(n,c,h.add(1),o,a,s)).toVar();p.assign(Mc(p,t,f))})),p})),Sv=wn((function(t){var e=iv(t,6),n=e[0],r=e[1],i=e[2],o=e[3],a=e[4],s=e[5],u=On(i).toVar(),c=In(r),l=On(gv(c)).toVar(),f=On(lc(yv.sub(u),0)).toVar();u.assign(lc(u,yv));var h=On(ju(u)).toVar(),p=Cn(bv(c,l).mul(h.sub(2)).add(1)).toVar();return Mn(l.greaterThan(2),(function(){p.y.addAssign(h),l.subAssign(3)})),p.x.addAssign(l.mul(h)),p.x.addAssign(f.mul(Zs(3,vv))),p.y.addAssign(Zs(4,ju(s).sub(h))),p.x.mulAssign(o),p.y.mulAssign(a),n.uv(p)})),Tv=wn((function(t){var e=t.envMap,n=t.mipInt,r=t.outputDirection,i=t.theta,o=t.axis,a=t.CUBEUV_TEXEL_WIDTH,s=t.CUBEUV_TEXEL_HEIGHT,u=t.CUBEUV_MAX_MIP,c=Wu(i),l=r.mul(c).add(o.cross(r).mul(Hu(i))).add(o.mul(o.dot(r).mul(c.oneMinus())));return Sv(e,l,n,a,s,u)})),Mv=wn((function(t){var e=t.n,n=t.latitudinal,r=t.poleAxis,i=t.outputDirection,o=t.weights,a=t.samples,s=t.dTheta,u=t.mipInt,c=t.envMap,l=t.CUBEUV_TEXEL_WIDTH,f=t.CUBEUV_TEXEL_HEIGHT,h=t.CUBEUV_MAX_MIP,p=In(rv(n,r,vc(r,i))).toVar();Mn(Pu(p.equals(In(0))),(function(){p.assign(In(i.z,0,i.x.negate()))})),p.assign(Vu(p));var d=In().toVar();return d.addAssign(o.element(Pn(0)).mul(Tv({theta:0,axis:p,outputDirection:i,mipInt:u,envMap:c,CUBEUV_TEXEL_WIDTH:l,CUBEUV_TEXEL_HEIGHT:f,CUBEUV_MAX_MIP:h}))),fm({start:Pn(1),end:e},(function(t){var e=t.i;Mn(e.greaterThanEqual(a),(function(){pm()}));var n=On(s.mul(On(e))).toVar();d.addAssign(o.element(e).mul(Tv({theta:n.mul(-1),axis:p,outputDirection:i,mipInt:u,envMap:c,CUBEUV_TEXEL_WIDTH:l,CUBEUV_TEXEL_HEIGHT:f,CUBEUV_MAX_MIP:h}))),d.addAssign(o.element(e).mul(Tv({theta:n,axis:p,outputDirection:i,mipInt:u,envMap:c,CUBEUV_TEXEL_WIDTH:l,CUBEUV_TEXEL_HEIGHT:f,CUBEUV_MAX_MIP:h})))})),Fn(d,1)}));function Ev(t){return Ev="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ev(t)}function Av(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Ov(r.key),r)}}function Ov(t){var e=function(t,e){if("object"!=Ev(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=Ev(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Ev(e)?e:e+""}function Pv(t,e,n){return e=kv(e),function(t,e){if(e&&("object"===Ev(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,Rv()?Reflect.construct(e,n||[],kv(t).constructor):e.apply(t,n))}function Rv(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(Rv=function(){return!!t})()}function kv(t){return kv=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},kv(t)}function Cv(t,e){return Cv=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Cv(t,e)}var Nv=null,Lv=new WeakMap,jv=function(t){function e(t){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=Pv(this,e,["vec3"]))._value=t,n._pmrem=null,n.uvNode=r,n.levelNode=i,n._generator=null,n._texture=El(null),n._width=gs(0),n._height=gs(0),n._maxMip=gs(0),n.updateBeforeType=a.RENDER,n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Cv(t,e)}(e,t),n=e,(r=[{key:"value",get:function(){return this._value},set:function(t){this._value=t,this._pmrem=null}},{key:"updateFromTexture",value:function(t){var e,n,r,i=(e=t.image.height,n=Math.log2(e)-2,r=1/e,{texelWidth:1/(3*Math.max(Math.pow(2,n),112)),texelHeight:r,maxMip:n});this._texture.value=t,this._width.value=i.texelWidth,this._height.value=i.texelHeight,this._maxMip.value=i.maxMip}},{key:"updateBefore",value:function(){var t=this._pmrem,e=t?t.pmremVersion:-1,n=this._value;e!==n.pmremVersion&&(t=!0===n.isPMREMTexture?n:function(t){var e=Lv.get(t);if((void 0!==e?e.pmremVersion:-1)!==t.pmremVersion){if(t.isCubeTexture){if(t.source.data.some((function(t){return void 0===t})))throw new Error("PMREMNode: Undefined texture in CubeTexture. Use onLoad callback or async loader");e=Nv.fromCubemap(t,e)}else{if(void 0===t.image)throw new Error("PMREMNode: Undefined image in Texture. Use onLoad callback or async loader");e=Nv.fromEquirectangular(t,e)}e.pmremVersion=t.pmremVersion,Lv.set(t,e)}return e.texture}(n),this._pmrem=t,this.updateFromTexture(t))}},{key:"setup",value:function(t){null===Nv&&(Nv=t.createPMREMGenerator()),this.updateBefore(t);var e=this.uvNode;null===e&&t.context.getUV&&(e=t.context.getUV(this));var n=this.value;t.renderer.coordinateSystem===h.TdN&&!0!==n.isPMREMTexture&&!0===n.isRenderTargetTexture&&(e=In(e.x.negate(),e.yz));var r=this.levelNode;return null===r&&t.context.getTextureLevel&&(r=t.context.getTextureLevel(this)),wv(this._texture,e,r,this._width,this._height,this._maxMip)}}])&&Av(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(Q),Iv=bn(jv);z("PMREMNode",jv);const Bv=jv;function Uv(t){return Uv="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Uv(t)}function Dv(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Fv(r.key),r)}}function Fv(t){var e=function(t,e){if("object"!=Uv(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=Uv(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Uv(e)?e:e+""}function zv(t,e,n){return e=Gv(e),function(t,e){if(e&&("object"===Uv(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,Vv()?Reflect.construct(e,n||[],Gv(t).constructor):e.apply(t,n))}function Vv(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(Vv=function(){return!!t})()}function Gv(t){return Gv=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Gv(t)}function Hv(t,e){return Hv=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Hv(t,e)}var Wv=new WeakMap,qv=function(t){function e(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(t=zv(this,e)).envNode=n,t}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Hv(t,e)}(e,t),n=e,(r=[{key:"setup",value:function(t){var e=this.envNode;if(e.isTextureNode){var n=Wv.get(e.value);void 0===n&&(n=Iv(e.value),Wv.set(e.value,n)),e=n}var r=t.material.envMap?mf("envMapIntensity","float",t.material):mf("environmentIntensity","float",t.scene),i=wi(e,Xv(Yo,Fh)).mul(r),o=wi(e,Yv(zh)).mul(Math.PI).mul(r),a=li(i);t.context.radiance.addAssign(a),t.context.iblIrradiance.addAssign(o);var s=t.context.lightingModel.clearcoatRadiance;if(s){var u=wi(e,Xv(Ko,Vh)).mul(r),c=li(u);s.addAssign(c)}}}])&&Dv(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(ey),Xv=function(t,e){var n=null;return{getUV:function(){return null===n&&(n=Fp.negate().reflect(e),n=(n=t.mul(t).mix(n,e).normalize()).transformDirection(oh)),n},getTextureLevel:function(){return t}}},Yv=function(t){return{getUV:function(){return t},getTextureLevel:function(){return On(1)}}};const Jv=qv;function Zv(t){return Zv="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Zv(t)}function Kv(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Qv(r.key),r)}}function Qv(t){var e=function(t,e){if("object"!=Zv(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=Zv(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Zv(e)?e:e+""}function $v(t,e,n){return e=ng(e),function(t,e){if(e&&("object"===Zv(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,tg()?Reflect.construct(e,n||[],ng(t).constructor):e.apply(t,n))}function tg(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(tg=function(){return!!t})()}function eg(){return eg="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=ng(t)););return t}(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(arguments.length<3?t:n):i.value}},eg.apply(this,arguments)}function ng(t){return ng=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},ng(t)}function rg(t,e){return rg=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},rg(t,e)}var ig,og;z("EnvironmentNode",qv);var ag=function(t){function e(t){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=$v(this,e)).scope=t,n.isViewportNode=!0,n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&rg(t,e)}(e,t),n=e,r=[{key:"getNodeType",value:function(){return this.scope===e.VIEWPORT?"vec4":"vec2"}},{key:"getUpdateType",value:function(){var t=a.NONE;return this.scope!==e.RESOLUTION&&this.scope!==e.VIEWPORT||(t=a.FRAME),this.updateType=t,t}},{key:"update",value:function(t){var n=t.renderer;this.scope===e.VIEWPORT?n.getViewport(og):n.getDrawingBufferSize(ig)}},{key:"setup",value:function(){var t=this.scope,n=null;if(t===e.RESOLUTION)n=gs(ig||(ig=new h.I9Y));else if(t===e.VIEWPORT)n=gs(og||(og=new h.IUQ));else{var r=(n=ug.div(cg)).x,i=n.y;/bottom/i.test(t)&&(i=i.oneMinus()),/right/i.test(t)&&(r=r.oneMinus()),n=Cn(r,i)}return n}},{key:"generate",value:function(t){if(this.scope===e.COORDINATE){var n=t.getFragCoord();if(t.isFlipY()){var r=t.getNodeProperties(cg).outputNode.build(t);n="".concat(t.getType("vec2"),"( ").concat(n,".x, ").concat(r,".y - ").concat(n,".y )")}return n}return eg(ng(e.prototype),"generate",this).call(this,t)}}],r&&Kv(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(F);ag.COORDINATE="coordinate",ag.RESOLUTION="resolution",ag.VIEWPORT="viewport",ag.TOP_LEFT="topLeft",ag.BOTTOM_LEFT="bottomLeft",ag.TOP_RIGHT="topRight",ag.BOTTOM_RIGHT="bottomRight";const sg=ag;var ug=_n(ag,ag.COORDINATE),cg=_n(ag,ag.RESOLUTION),lg=_n(ag,ag.VIEWPORT),fg=_n(ag,ag.TOP_LEFT),hg=_n(ag,ag.BOTTOM_LEFT),pg=_n(ag,ag.TOP_RIGHT),dg=_n(ag,ag.BOTTOM_RIGHT);function mg(t){return mg="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},mg(t)}function yg(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,vg(r.key),r)}}function vg(t){var e=function(t,e){if("object"!=mg(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=mg(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==mg(e)?e:e+""}function gg(t,e,n){return e=_g(e),function(t,e){if(e&&("object"===mg(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,bg()?Reflect.construct(e,n||[],_g(t).constructor):e.apply(t,n))}function bg(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(bg=function(){return!!t})()}function _g(t){return _g=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},_g(t)}function xg(t,e){return xg=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},xg(t,e)}z("ViewportNode",ag);var wg=new h.I9Y,Sg=function(t){function e(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:fg,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),null===i&&((i=new h.Pem).minFilter=h.$_I),(t=gg(this,e,[i,n,r])).generateMipmaps=!1,t.isOutputTextureNode=!0,t.updateBeforeType=a.FRAME,t}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&xg(t,e)}(e,t),n=e,(r=[{key:"updateBefore",value:function(t){var e=t.renderer;e.getDrawingBufferSize(wg);var n=this.value;n.image.width===wg.width&&n.image.height===wg.height||(n.image.width=wg.width,n.image.height=wg.height,n.needsUpdate=!0);var r=n.generateMipmaps;n.generateMipmaps=this.generateMipmaps,e.copyFramebufferToTexture(n),n.generateMipmaps=r}},{key:"clone",value:function(){return new this.constructor(this.uvNode,this.levelNode,this.value)}}])&&yg(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(Ml);const Tg=Sg;var Mg=bn(Sg),Eg=bn(Sg,null,null,{generateMipmaps:!0});function Ag(t){return Ag="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ag(t)}function Og(t,e,n){return e=Rg(e),function(t,e){if(e&&("object"===Ag(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,Pg()?Reflect.construct(e,n||[],Rg(t).constructor):e.apply(t,n))}function Pg(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(Pg=function(){return!!t})()}function Rg(t){return Rg=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Rg(t)}function kg(t,e){return kg=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},kg(t,e)}Ce("viewportTexture",Mg),Ce("viewportMipTexture",Eg),z("ViewportTextureNode",Sg);var Cg=null,Ng=function(t){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:fg,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),null===Cg&&(Cg=new h.VCu),Og(this,e,[t,n,Cg])}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&kg(t,e)}(e,t),n=e,Object.defineProperty(n,"prototype",{writable:!1}),n;var n}(Tg);const Lg=Ng;var jg=bn(Ng);function Ig(t){return Ig="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ig(t)}function Bg(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Ug(r.key),r)}}function Ug(t){var e=function(t,e){if("object"!=Ig(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=Ig(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Ig(e)?e:e+""}function Dg(t,e,n){return e=Vg(e),function(t,e){if(e&&("object"===Ig(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,Fg()?Reflect.construct(e,n||[],Vg(t).constructor):e.apply(t,n))}function Fg(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(Fg=function(){return!!t})()}function zg(){return zg="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Vg(t)););return t}(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(arguments.length<3?t:n):i.value}},zg.apply(this,arguments)}function Vg(t){return Vg=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Vg(t)}function Gg(t,e){return Gg=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Gg(t,e)}Ce("viewportDepthTexture",jg),z("ViewportDepthTextureNode",Ng);var Hg=function(t){function e(t){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=Dg(this,e,["float"])).scope=t,n.valueNode=r,n.isViewportDepthNode=!0,n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Gg(t,e)}(e,t),n=e,(r=[{key:"generate",value:function(t){return this.scope===e.DEPTH_PIXEL?t.getFragDepth():zg(Vg(e.prototype),"generate",this).call(this,t)}},{key:"setup",value:function(){var t=this.scope,n=null;if(t===e.DEPTH)n=Wg(Dp.z,nh,rh);else if(t===e.DEPTH_TEXTURE){var r=this.valueNode||jg(),i=Yg(r,nh,rh);n=Wg(i,nh,rh)}else t===e.DEPTH_PIXEL&&null!==this.valueNode&&(n=Zg().assign(this.valueNode));return n}}])&&Bg(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(F),Wg=function(t,e,n){return t.add(e).div(e.sub(n))},qg=function(t,e,n){return e.sub(n).mul(t).sub(e)},Xg=function(t,e,n){return e.add(t).mul(n).div(e.sub(n).mul(t))},Yg=function(t,e,n){return e.mul(n).div(n.sub(e).mul(t).sub(n))};Hg.DEPTH="depth",Hg.DEPTH_TEXTURE="depthTexture",Hg.DEPTH_PIXEL="depthPixel";const Jg=Hg;var Zg=bn(Hg,Hg.DEPTH_PIXEL),Kg=_n(Hg,Hg.DEPTH),Qg=bn(Hg,Hg.DEPTH_TEXTURE),$g=_n(Hg,Hg.DEPTH_PIXEL);function tb(t){return tb="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},tb(t)}function eb(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,nb(r.key),r)}}function nb(t){var e=function(t,e){if("object"!=tb(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=tb(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==tb(e)?e:e+""}function rb(t,e,n){return e=ab(e),function(t,e){if(e&&("object"===tb(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,ib()?Reflect.construct(e,n||[],ab(t).constructor):e.apply(t,n))}function ib(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(ib=function(){return!!t})()}function ob(){return ob="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=ab(t)););return t}(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(arguments.length<3?t:n):i.value}},ob.apply(this,arguments)}function ab(t){return ab=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},ab(t)}function sb(t,e){return sb=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},sb(t,e)}$g.assign=function(t){return Zg(t)},z("ViewportDepthNode",Hg);var ub=function(t){function e(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e.DEFAULT;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(t=rb(this,e)).scope=n,t}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&sb(t,e)}(e,t),n=e,(r=[{key:"setup",value:function(t){ob(ab(e.prototype),"setup",this).call(this,t);var n=t.clippingContext,r=n.localClipIntersection,i=n.localClippingCount,o=n.globalClippingCount+i,a=r?o-i:o;return this.scope===e.ALPHA_TO_COVERAGE?this.setupAlphaToCoverage(n.planes,o,a):this.setupDefault(n.planes,o,a)}},{key:"setupAlphaToCoverage",value:function(t,e,n){return wn((function(){var r,i=$l(t),o=Wo("float","distanceToPlane"),a=Wo("float","distanceToGradient"),s=Wo("float","clipOpacity");if(s.assign(1),fm(n,(function(t){var e=t.i;r=i.element(e),o.assign(Dp.dot(r.xyz).negate().add(r.w)),a.assign(o.fwidth().div(2)),s.mulAssign(Pc(a.negate(),a,o)),s.equal(0).discard()})),n<e){var u=Wo("float","unionclipOpacity");u.assign(1),fm({start:n,end:e},(function(t){var e=t.i;r=i.element(e),o.assign(Dp.dot(r.xyz).negate().add(r.w)),a.assign(o.fwidth().div(2)),u.mulAssign(Pc(a.negate(),a,o).oneMinus())})),s.mulAssign(u.oneMinus())}Xo.a.mulAssign(s),Xo.a.equal(0).discard()}))()}},{key:"setupDefault",value:function(t,e,n){return wn((function(){var r,i=$l(t);if(fm(n,(function(t){var e=t.i;r=i.element(e),Dp.dot(r.xyz).greaterThan(r.w).discard()})),n<e){var o=Wo("bool","clipped");o.assign(!0),fm({start:n,end:e},(function(t){var e=t.i;r=i.element(e),o.assign(Dp.dot(r.xyz).greaterThan(r.w).and(o))})),o.discard()}}))()}}])&&eb(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(F);function cb(t){return cb="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},cb(t)}function lb(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,fb(r.key),r)}}function fb(t){var e=function(t,e){if("object"!=cb(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=cb(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==cb(e)?e:e+""}function hb(t,e,n){return e=db(e),function(t,e){if(e&&("object"===cb(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,pb()?Reflect.construct(e,n||[],db(t).constructor):e.apply(t,n))}function pb(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(pb=function(){return!!t})()}function db(t){return db=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},db(t)}function mb(t,e){return mb=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},mb(t,e)}ub.ALPHA_TO_COVERAGE="alphaToCoverage",ub.DEFAULT="default";var yb=function(t){function e(){var t;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(t=hb(this,e,["bool"])).isFrontFacingNode=!0,t}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&mb(t,e)}(e,t),n=e,(r=[{key:"generate",value:function(t){return t.getFrontFacing()}}])&&lb(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(F);const vb=yb;var gb=_n(yb),bb=On(gb).mul(2).sub(1);function _b(t){return _b="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_b(t)}function xb(t,e){if(t){if("string"==typeof t)return wb(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?wb(t,e):void 0}}function wb(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function Sb(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Tb(r.key),r)}}function Tb(t){var e=function(t,e){if("object"!=_b(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=_b(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==_b(e)?e:e+""}function Mb(t,e,n){return e=Ob(e),function(t,e){if(e&&("object"===_b(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,Eb()?Reflect.construct(e,n||[],Ob(t).constructor):e.apply(t,n))}function Eb(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(Eb=function(){return!!t})()}function Ab(){return Ab="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Ob(t)););return t}(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(arguments.length<3?t:n):i.value}},Ab.apply(this,arguments)}function Ob(t){return Ob=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Ob(t)}function Pb(t,e){return Pb=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Pb(t,e)}z("FrontFacingNode",yb);var Rb=new Map,kb=function(t){function e(){var t;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(t=Mb(this,e)).isNodeMaterial=!0,t.type=t.constructor.type,t.forceSinglePass=!1,t.fog=!0,t.lights=!0,t.normals=!0,t.colorSpaced=!0,t.lightsNode=null,t.envNode=null,t.colorNode=null,t.normalNode=null,t.opacityNode=null,t.backdropNode=null,t.backdropAlphaNode=null,t.alphaTestNode=null,t.positionNode=null,t.depthNode=null,t.shadowNode=null,t.outputNode=null,t.fragmentNode=null,t.vertexNode=null,t}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Pb(t,e)}(e,t),n=e,r=[{key:"customProgramCacheKey",value:function(){return this.type+x(this)}},{key:"build",value:function(t){this.setup(t)}},{key:"setup",value:function(t){var e;t.addStack(),t.stack.outputNode=this.vertexNode||this.setupPosition(t),t.addFlow("vertex",t.removeStack()),t.addStack();var n=this.setupClipping(t);if(null===this.fragmentNode){!0===this.depthWrite&&this.setupDepth(t),!0===this.normals&&this.setupNormal(t),this.setupDiffuseColor(t),this.setupVariants(t);var r=this.setupLighting(t);null!==n&&t.stack.add(n);var i=Fn(r,Xo.a).max(0);e=this.setupOutput(t,i),oa.assign(e),null!==this.outputNode&&(e=this.outputNode)}else e=this.setupOutput(t,this.fragmentNode);t.stack.outputNode=e,t.addFlow("fragment",t.removeStack())}},{key:"setupClipping",value:function(t){var e=t.clippingContext,n=e.globalClippingCount,r=e.localClippingCount,i=null;return(n||r)&&(this.alphaToCoverage?i=yn(new ub(ub.ALPHA_TO_COVERAGE)):t.stack.add(yn(new ub))),i}},{key:"setupDepth",value:function(t){var e=t.renderer,n=this.depthNode;null===n&&!0===e.logarithmicDepthBuffer&&(n=Zp().w.add(1).log2().mul(ih).mul(.5)),null!==n&&$g.assign(n).append()}},{key:"setupPosition",value:function(t){var e,n=t.object,r=n.geometry;t.addStack(),(r.morphAttributes.position||r.morphAttributes.normal||r.morphAttributes.color)&&Em(n).append(),!0===n.isSkinnedMesh&&(e=n,yn(new $d(e,!0))).append(),n.isBatchedMesh&&Wd(n).append(),n.instanceMatrix&&!0===n.instanceMatrix.isInstancedBufferAttribute&&!0===t.isAvailable("instance")&&bd(n).append(),null!==this.positionNode&&Ip.assign(this.positionNode);var i=Zp();return t.context.vertex=t.removeStack(),t.context.mvp=i,i}},{key:"setupDiffuseColor",value:function(t){var e=t.object,n=t.geometry,r=this.colorNode?Fn(this.colorNode):tp;!0===this.vertexColors&&n.hasAttribute("color")&&(r=Fn(r.xyz.mul(Ur("color","vec3")),r.a)),e.instanceColor&&(r=qo("vec3","vInstanceColor").mul(r)),Xo.assign(r);var i=this.opacityNode?On(this.opacityNode):rp;if(Xo.a.assign(Xo.a.mul(i)),null!==this.alphaTestNode||this.alphaTest>0){var o=null!==this.alphaTestNode?On(this.alphaTestNode):$h;Xo.a.lessThanEqual(o).discard()}}},{key:"setupVariants",value:function(){}},{key:"setupNormal",value:function(){if(!0===this.flatShading){var t=Dp.dFdx().cross(Dp.dFdy()).normalize();Fh.assign(t.mul(bb))}else{var e=this.normalNode?In(this.normalNode):cp;Fh.assign(e.mul(bb))}}},{key:"getEnvNode",value:function(t){var e=null;return this.envNode?e=this.envNode:this.envMap?e=this.envMap.isCubeTexture?qm(this.envMap):El(this.envMap):t.environmentNode&&(e=t.environmentNode),e}},{key:"setupLights",value:function(t){var e=this.getEnvNode(t),n=[];e&&n.push(new Jv(e)),t.material.aoMap&&n.push(new Iy(El(t.material.aoMap)));var r,i=this.lightsNode||t.lightsNode;return n.length>0&&(i=Ey([].concat(function(t){if(Array.isArray(t))return wb(t)}(r=i.lightNodes)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(r)||xb(r)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),n))),i}},{key:"setupLightingModel",value:function(){}},{key:"setupLighting",value:function(t){var e=t.material,n=this.backdropNode,r=this.backdropAlphaNode,i=this.emissiveNode,o=!0===this.lights||null!==this.lightsNode?this.setupLights(t):null,a=Xo.rgb;if(o&&!1!==o.hasLight){var s=this.setupLightingModel(t);a=Xy(o,s,n,r)}else null!==n&&(a=In(null!==r?Mc(a,n,r):n));return(i&&!0===i.isNode||e.emissive&&!0===e.emissive.isColor)&&(a=a.add(In(i||np))),a}},{key:"setupOutput",value:function(t,e){var n=t.renderer;if(!0===this.fog){var r=t.fogNode;r&&(e=Fn(r.mix(e.rgb,r.colorNode),e.a))}var i=t.toneMappingNode;if(!0===this.toneMapped&&i&&(e=Fn(i.context({color:e.rgb}),e.a)),!0===this.colorSpaced){var o=n.currentColorSpace;o!==h.Zr2&&o!==h.jf0&&(e=e.linearToColorSpace(o))}return e}},{key:"setDefaultValues",value:function(t){for(var e in t){var n=t[e];void 0===this[e]&&(this[e]=n,n&&n.clone&&(this[e]=n.clone()))}Object.assign(this.defines,t.defines);var r=Object.getOwnPropertyDescriptors(t.constructor.prototype);for(var i in r)void 0===Object.getOwnPropertyDescriptor(this.constructor.prototype,i)&&void 0!==r[i].get&&Object.defineProperty(this.constructor.prototype,i,r[i])}},{key:"toJSON",value:function(t){var e=void 0===t||"string"==typeof t;e&&(t={textures:{},images:{},nodes:{}});var n=h.imn.prototype.toJSON.call(this,t),r=w(this);n.inputNodes={};var i,o=function(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=xb(t))){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}(r);try{for(o.s();!(i=o.n()).done;){var a=i.value,s=a.property,u=a.childNode;n.inputNodes[s]=u.toJSON(t).uuid}}catch(t){o.e(t)}finally{o.f()}function c(t){var e=[];for(var n in t){var r=t[n];delete r.metadata,e.push(r)}return e}if(e){var l=c(t.textures),f=c(t.images),p=c(t.nodes);l.length>0&&(n.textures=l),f.length>0&&(n.images=f),p.length>0&&(n.nodes=p)}return n}},{key:"copy",value:function(t){return this.lightsNode=t.lightsNode,this.envNode=t.envNode,this.colorNode=t.colorNode,this.normalNode=t.normalNode,this.opacityNode=t.opacityNode,this.backdropNode=t.backdropNode,this.backdropAlphaNode=t.backdropAlphaNode,this.alphaTestNode=t.alphaTestNode,this.positionNode=t.positionNode,this.depthNode=t.depthNode,this.shadowNode=t.shadowNode,this.outputNode=t.outputNode,this.fragmentNode=t.fragmentNode,this.vertexNode=t.vertexNode,Ab(Ob(e.prototype),"copy",this).call(this,t)}}],i=[{key:"fromMaterial",value:function(t){if(!0===t.isNodeMaterial)return t;var e=Lb(t.type.replace("Material","NodeMaterial"));if(void 0===e)throw new Error('NodeMaterial: Material "'.concat(t.type,'" is not compatible.'));for(var n in t)e[n]=t[n];return e}}],r&&Sb(n.prototype,r),i&&Sb(n,i),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r,i}(h.BKk);const Cb=kb;function Nb(t,e){if("function"!=typeof e||!t)throw new Error("Node material ".concat(t," is not a class"));Rb.has(t)?console.warn("Redefinition of node material ".concat(t)):(Rb.set(t,e),e.type=t)}function Lb(t){var e=Rb.get(t);if(void 0!==e)return new e}function jb(t,e,n){return e=Bb(e),function(t,e){if(e&&("object"===Fb(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,Ib()?Reflect.construct(e,n||[],Bb(t).constructor):e.apply(t,n))}function Ib(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(Ib=function(){return!!t})()}function Bb(t){return Bb=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Bb(t)}function Ub(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Db(t,e)}function Db(t,e){return Db=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Db(t,e)}function Fb(t){return Fb="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Fb(t)}function zb(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Vb(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Hb(r.key),r)}}function Gb(t,e,n){return e&&Vb(t.prototype,e),n&&Vb(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function Hb(t){var e=function(t,e){if("object"!=Fb(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=Fb(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Fb(e)?e:e+""}Nb("NodeMaterial",kb);var Wb=function(){return Gb((function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;zb(this,t),this.name=e,this.value=n,this.boundary=0,this.itemSize=0,this.offset=0}),[{key:"setValue",value:function(t){this.value=t}},{key:"getValue",value:function(){return this.value}}])}(),qb=function(t){function e(t){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return zb(this,e),(n=jb(this,e,[t,r])).isFloatUniform=!0,n.boundary=4,n.itemSize=1,n}return Ub(e,t),Gb(e)}(Wb),Xb=function(t){function e(t){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new h.I9Y;return zb(this,e),(n=jb(this,e,[t,r])).isVector2Uniform=!0,n.boundary=8,n.itemSize=2,n}return Ub(e,t),Gb(e)}(Wb),Yb=function(t){function e(t){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new h.Pq0;return zb(this,e),(n=jb(this,e,[t,r])).isVector3Uniform=!0,n.boundary=16,n.itemSize=3,n}return Ub(e,t),Gb(e)}(Wb),Jb=function(t){function e(t){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new h.IUQ;return zb(this,e),(n=jb(this,e,[t,r])).isVector4Uniform=!0,n.boundary=16,n.itemSize=4,n}return Ub(e,t),Gb(e)}(Wb),Zb=function(t){function e(t){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new h.Q1f;return zb(this,e),(n=jb(this,e,[t,r])).isColorUniform=!0,n.boundary=16,n.itemSize=3,n}return Ub(e,t),Gb(e)}(Wb),Kb=function(t){function e(t){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new h.dwI;return zb(this,e),(n=jb(this,e,[t,r])).isMatrix3Uniform=!0,n.boundary=48,n.itemSize=12,n}return Ub(e,t),Gb(e)}(Wb),Qb=function(t){function e(t){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new h.kn4;return zb(this,e),(n=jb(this,e,[t,r])).isMatrix4Uniform=!0,n.boundary=64,n.itemSize=16,n}return Ub(e,t),Gb(e)}(Wb);function $b(t){return $b="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},$b(t)}function t_(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function e_(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r_(r.key),r)}}function n_(t,e,n){return e&&e_(t.prototype,e),n&&e_(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function r_(t){var e=function(t,e){if("object"!=$b(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=$b(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==$b(e)?e:e+""}function i_(t,e,n){return e=a_(e),function(t,e){if(e&&("object"===$b(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,o_()?Reflect.construct(e,n||[],a_(t).constructor):e.apply(t,n))}function o_(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(o_=function(){return!!t})()}function a_(t){return a_=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},a_(t)}function s_(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&u_(t,e)}function u_(t,e){return u_=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},u_(t,e)}var c_=function(t){function e(t){var n;return t_(this,e),(n=i_(this,e,[t.name,t.value])).nodeUniform=t,n}return s_(e,t),n_(e,[{key:"getValue",value:function(){return this.nodeUniform.value}}])}(qb),l_=function(t){function e(t){var n;return t_(this,e),(n=i_(this,e,[t.name,t.value])).nodeUniform=t,n}return s_(e,t),n_(e,[{key:"getValue",value:function(){return this.nodeUniform.value}}])}(Xb),f_=function(t){function e(t){var n;return t_(this,e),(n=i_(this,e,[t.name,t.value])).nodeUniform=t,n}return s_(e,t),n_(e,[{key:"getValue",value:function(){return this.nodeUniform.value}}])}(Yb),h_=function(t){function e(t){var n;return t_(this,e),(n=i_(this,e,[t.name,t.value])).nodeUniform=t,n}return s_(e,t),n_(e,[{key:"getValue",value:function(){return this.nodeUniform.value}}])}(Jb),p_=function(t){function e(t){var n;return t_(this,e),(n=i_(this,e,[t.name,t.value])).nodeUniform=t,n}return s_(e,t),n_(e,[{key:"getValue",value:function(){return this.nodeUniform.value}}])}(Zb),d_=function(t){function e(t){var n;return t_(this,e),(n=i_(this,e,[t.name,t.value])).nodeUniform=t,n}return s_(e,t),n_(e,[{key:"getValue",value:function(){return this.nodeUniform.value}}])}(Kb),m_=function(t){function e(t){var n;return t_(this,e),(n=i_(this,e,[t.name,t.value])).nodeUniform=t,n}return s_(e,t),n_(e,[{key:"getValue",value:function(){return this.nodeUniform.value}}])}(Qb);function y_(t){return y_="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},y_(t)}function v_(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function g_(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,b_(r.key),r)}}function b_(t){var e=function(t,e){if("object"!=y_(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=y_(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==y_(e)?e:e+""}function __(t,e,n){return e=S_(e),function(t,e){if(e&&("object"===y_(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,x_()?Reflect.construct(e,n||[],S_(t).constructor):e.apply(t,n))}function x_(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(x_=function(){return!!t})()}function w_(){return w_="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=S_(t)););return t}(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(arguments.length<3?t:n):i.value}},w_.apply(this,arguments)}function S_(t){return S_=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},S_(t)}function T_(t,e){return T_=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},T_(t,e)}var M_=function(t){function e(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(t=__(this,e)).nodes=[],t.outputNode=null,t.parent=n,t._currentCond=null,t.isStackNode=!0,t}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&T_(t,e)}(e,t),n=e,r=[{key:"getNodeType",value:function(t){return this.outputNode?this.outputNode.getNodeType(t):"void"}},{key:"add",value:function(t){return this.nodes.push(t),this}},{key:"if",value:function(t,e){var n=new mn(e);return this._currentCond=rv(t,n),this.add(this._currentCond)}},{key:"elseif",value:function(t,e){var n=new mn(e),r=rv(t,n);return this._currentCond.elseNode=r,this._currentCond=r,this}},{key:"else",value:function(t){return this._currentCond.elseNode=new mn(t),this}},{key:"build",value:function(t){var n,r,i=Tn();Sn(this);var o,a=function(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return v_(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?v_(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}(this.nodes);try{for(a.s();!(o=a.n()).done;)o.value.build(t,"void")}catch(t){a.e(t)}finally{a.f()}Sn(i);for(var s=arguments.length,u=new Array(s>1?s-1:0),c=1;c<s;c++)u[c-1]=arguments[c];return this.outputNode?(n=this.outputNode).build.apply(n,[t].concat(u)):(r=w_(S_(e.prototype),"build",this)).call.apply(r,[this,t].concat(u))}}],r&&g_(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(F);const E_=M_;var A_=bn(M_);function O_(t){return O_="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},O_(t)}function P_(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,R_(r.key),r)}}function R_(t){var e=function(t,e){if("object"!=O_(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=O_(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==O_(e)?e:e+""}function k_(t,e,n){return e=N_(e),function(t,e){if(e&&("object"===O_(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,C_()?Reflect.construct(e,n||[],N_(t).constructor):e.apply(t,n))}function C_(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(C_=function(){return!!t})()}function N_(t){return N_=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},N_(t)}function L_(t,e){return L_=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},L_(t,e)}z("StackNode",M_);var j_=function(t){function e(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Up;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(t=k_(this,e,["vec2"])).dirNode=n,t}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&L_(t,e)}(e,t),n=e,(r=[{key:"setup",value:function(){var t=this.dirNode,e=t.z.atan2(t.x).mul(1/(2*Math.PI)).add(.5),n=t.y.clamp(-1,1).asin().mul(1/Math.PI).add(.5);return Cn(e,n)}}])&&P_(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(Q);const I_=j_;var B_=bn(j_);function U_(t){return U_="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},U_(t)}function D_(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,F_(r.key),r)}}function F_(t){var e=function(t,e){if("object"!=U_(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=U_(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==U_(e)?e:e+""}function z_(t,e,n){return e=G_(e),function(t,e){if(e&&("object"===U_(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,V_()?Reflect.construct(e,n||[],G_(t).constructor):e.apply(t,n))}function V_(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(V_=function(){return!!t})()}function G_(t){return G_=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},G_(t)}function H_(t,e){return H_=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},H_(t,e)}z("EquirectUVNode",j_);var W_=function(t){function e(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(t=z_(this,e,[n,r])).isCubeRenderTarget=!0,t}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&H_(t,e)}(e,t),n=e,(r=[{key:"fromEquirectangularTexture",value:function(t,e){var n=e.minFilter,r=e.generateMipmaps;e.generateMipmaps=!0,this.texture.type=e.type,this.texture.colorSpace=e.colorSpace,this.texture.generateMipmaps=e.generateMipmaps,this.texture.minFilter=e.minFilter,this.texture.magFilter=e.magFilter;var i=new h.iNn(5,5,5),o=B_(Up),a=Lb("MeshBasicNodeMaterial");a.colorNode=El(e,o,0),a.side=h.hsX,a.blending=h.XIg;var s=new h.eaF(i,a),u=new h.Z58;return u.add(s),e.minFilter===h.$_I&&(e.minFilter=h.k6q),new h.F1T(1,10,this).update(t,u),e.minFilter=n,e.currentGenerateMipmaps=r,s.geometry.dispose(),s.material.dispose(),this}}])&&D_(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(h.o6l);const q_=W_;var X_=n(476);function Y_(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function J_(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Y_(Object(n),!0).forEach((function(e){var r,i,o;r=t,i=e,o=n[e],(i=Q_(i))in r?Object.defineProperty(r,i,{value:o,enumerable:!0,configurable:!0,writable:!0}):r[i]=o})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Y_(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function Z_(t){return Z_="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Z_(t)}function K_(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Q_(r.key),r)}}function Q_(t){var e=function(t,e){if("object"!=Z_(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=Z_(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Z_(e)?e:e+""}var $_=[.125,.215,.35,.446,.526,.582],tx=20,ex=new h.qUd(-1,1,1,-1,0,1),nx=new h.ubm(90,1),rx=new h.Q1f,ix=null,ox=0,ax=0,sx=(1+Math.sqrt(5))/2,ux=1/sx,cx=[new h.Pq0(1,1,1),new h.Pq0(-1,1,1),new h.Pq0(1,1,-1),new h.Pq0(-1,1,-1),new h.Pq0(0,sx,ux),new h.Pq0(0,sx,-ux),new h.Pq0(ux,0,sx),new h.Pq0(-ux,0,sx),new h.Pq0(sx,ux,0),new h.Pq0(-sx,ux,0)],lx=[3,1,5,0,4,2],fx=xv(Os(),Ur("faceIndex")).normalize(),hx=In(fx.x,fx.y.negate(),fx.z),px=function(){return t=function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._lodMeshes=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._backgroundBox=null},e=[{key:"fromScene",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:100;ix=this._renderer.getRenderTarget(),ox=this._renderer.getActiveCubeFace(),ax=this._renderer.getActiveMipmapLevel(),this._setSize(256);var i=this._allocateTargets();return i.depthBuffer=!0,this._sceneToCubeUV(t,n,r,i),e>0&&this._blur(i,0,0,e),this._applyPMREM(i),this._cleanup(i),i}},{key:"fromEquirectangular",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this._fromTexture(t,e)}},{key:"fromCubemap",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this._fromTexture(t,e)}},{key:"compileCubemapShader",value:function(){null===this._cubemapMaterial&&(this._cubemapMaterial=vx(),this._compileMaterial(this._cubemapMaterial))}},{key:"compileEquirectangularShader",value:function(){null===this._equirectMaterial&&(this._equirectMaterial=gx(),this._compileMaterial(this._equirectMaterial))}},{key:"dispose",value:function(){this._dispose(),null!==this._cubemapMaterial&&this._cubemapMaterial.dispose(),null!==this._equirectMaterial&&this._equirectMaterial.dispose(),null!==this._backgroundBox&&(this._backgroundBox.geometry.dispose(),this._backgroundBox.material.dispose())}},{key:"_setSize",value:function(t){this._lodMax=Math.floor(Math.log2(t)),this._cubeSize=Math.pow(2,this._lodMax)}},{key:"_dispose",value:function(){null!==this._blurMaterial&&this._blurMaterial.dispose(),null!==this._pingPongRenderTarget&&this._pingPongRenderTarget.dispose();for(var t=0;t<this._lodPlanes.length;t++)this._lodPlanes[t].dispose()}},{key:"_cleanup",value:function(t){this._renderer.setRenderTarget(ix,ox,ax),t.scissorTest=!1,mx(t,0,0,t.width,t.height)}},{key:"_fromTexture",value:function(t,e){t.mapping===h.hy7||t.mapping===h.xFO?this._setSize(0===t.image.length?16:t.image[0].width||t.image[0].image.width):this._setSize(t.image.width/4),ix=this._renderer.getRenderTarget(),ox=this._renderer.getActiveCubeFace(),ax=this._renderer.getActiveMipmapLevel();var n=e||this._allocateTargets();return this._textureToCubeUV(t,n),this._applyPMREM(n),this._cleanup(n),n}},{key:"_allocateTargets",value:function(){var t=3*Math.max(this._cubeSize,112),e=4*this._cubeSize,n={magFilter:h.k6q,minFilter:h.k6q,generateMipmaps:!1,type:h.ix0,format:h.GWd,colorSpace:h.Zr2},r=dx(t,e,n);if(null===this._pingPongRenderTarget||this._pingPongRenderTarget.width!==t||this._pingPongRenderTarget.height!==e){null!==this._pingPongRenderTarget&&this._dispose(),this._pingPongRenderTarget=dx(t,e,n);var i=this._lodMax,o=function(t){for(var e=[],n=[],r=[],i=[],o=t,a=t-4+1+$_.length,s=0;s<a;s++){var u=Math.pow(2,o);n.push(u);var c=1/u;s>t-4?c=$_[s-t+4-1]:0===s&&(c=0),r.push(c);for(var l=1/(u-2),f=-l,p=1+l,d=[f,f,p,f,p,p,f,f,p,p,f,p],m=new Float32Array(108),y=new Float32Array(72),v=new Float32Array(36),g=0;g<6;g++){var b=g%3*2/3-1,_=g>2?0:-1,x=[b,_,0,b+2/3,_,0,b+2/3,_+1,0,b,_,0,b+2/3,_+1,0,b,_+1,0],w=lx[g];m.set(x,18*w),y.set(d,12*w);var S=[w,w,w,w,w,w];v.set(S,6*w)}var T=new h.LoY;T.setAttribute("position",new h.THS(m,3)),T.setAttribute("uv",new h.THS(y,2)),T.setAttribute("faceIndex",new h.THS(v,1)),e.push(T),i.push(new h.eaF(T,null)),o>4&&o--}return{lodPlanes:e,sizeLods:n,sigmas:r,lodMeshes:i}}(i);this._sizeLods=o.sizeLods,this._lodPlanes=o.lodPlanes,this._sigmas=o.sigmas,this._lodMeshes=o.lodMeshes,this._blurMaterial=function(t,e,n){var r=$l(new Array(tx).fill(0)),i=gs(new h.Pq0(0,1,0)),o=gs(0),a=On(tx),s=gs(0),u=gs(1),c=El(null),l=gs(0),f=On(1/e),p=On(1/n),d=On(t),m={n:a,latitudinal:s,weights:r,poleAxis:i,outputDirection:hx,dTheta:o,samples:u,envMap:c,mipInt:l,CUBEUV_TEXEL_WIDTH:f,CUBEUV_TEXEL_HEIGHT:p,CUBEUV_MAX_MIP:d},y=yx();return y.uniforms=m,y.fragmentNode=Mv(J_(J_({},m),{},{latitudinal:s.equal(1)})),y}(i,t,e)}return r}},{key:"_compileMaterial",value:function(t){var e=this._lodMeshes[0];e.material=t,this._renderer.compile(e,ex)}},{key:"_sceneToCubeUV",value:function(t,e,n,r){var i=nx;i.near=e,i.far=n;var o=[-1,1,-1,-1,-1,-1],a=[1,1,1,-1,-1,-1],s=this._renderer,u=s.autoClear,c=s.toneMapping;s.getClearColor(rx),s.toneMapping=h.y_p,s.autoClear=!1;var l=this._backgroundBox;if(null===l){var f=new h.V9B({name:"PMREM.Background",side:h.hsX,depthWrite:!1,depthTest:!1});l=new h.eaF(new h.iNn,f)}var p=!1,d=t.background;d?d.isColor&&(l.material.color.copy(d),t.background=null,p=!0):(l.material.color.copy(rx),p=!0),s.setRenderTarget(r),s.clear(),p&&s.render(l,i);for(var m=0;m<6;m++){var y=m%3;0===y?(i.up.set(0,o[m],0),i.lookAt(a[m],0,0)):1===y?(i.up.set(0,0,o[m]),i.lookAt(0,a[m],0)):(i.up.set(0,o[m],0),i.lookAt(0,0,a[m]));var v=this._cubeSize;mx(r,y*v,m>2?v:0,v,v),s.render(t,i)}s.toneMapping=c,s.autoClear=u,t.background=d}},{key:"_textureToCubeUV",value:function(t,e){var n=this._renderer,r=t.mapping===h.hy7||t.mapping===h.xFO;r?null===this._cubemapMaterial&&(this._cubemapMaterial=vx(t)):null===this._equirectMaterial&&(this._equirectMaterial=gx(t));var i=r?this._cubemapMaterial:this._equirectMaterial;i.fragmentNode.value=t;var o=this._lodMeshes[0];o.material=i;var a=this._cubeSize;mx(e,0,0,3*a,2*a),n.setRenderTarget(e),n.render(o,ex)}},{key:"_applyPMREM",value:function(t){var e=this._renderer,n=e.autoClear;e.autoClear=!1;for(var r=1;r<this._lodPlanes.length;r++){var i=Math.sqrt(this._sigmas[r]*this._sigmas[r]-this._sigmas[r-1]*this._sigmas[r-1]),o=cx[(r-1)%cx.length];this._blur(t,r-1,r,i,o)}e.autoClear=n}},{key:"_blur",value:function(t,e,n,r,i){var o=this._pingPongRenderTarget;this._halfBlur(t,o,e,n,r,"latitudinal",i),this._halfBlur(o,t,n,n,r,"longitudinal",i)}},{key:"_halfBlur",value:function(t,e,n,r,i,o,a){var s=this._renderer,u=this._blurMaterial;"latitudinal"!==o&&"longitudinal"!==o&&console.error("blur direction must be either latitudinal or longitudinal!");var c=this._lodMeshes[r];c.material=u;var l=u.uniforms,f=this._sizeLods[n]-1,h=isFinite(i)?Math.PI/(2*f):2*Math.PI/39,p=i/h,d=isFinite(i)?1+Math.floor(3*p):tx;d>tx&&console.warn("sigmaRadians, ".concat(i,", is too large and will clip, as it requested ").concat(d," samples when the maximum is set to ").concat(tx));for(var m=[],y=0,v=0;v<tx;++v){var g=v/p,b=Math.exp(-g*g/2);m.push(b),0===v?y+=b:v<d&&(y+=2*b)}for(var _=0;_<m.length;_++)m[_]=m[_]/y;t.texture.frame=(t.texture.frame||0)+1,l.envMap.value=t.texture,l.samples.value=d,l.weights.array=m,l.latitudinal.value="latitudinal"===o?1:0,a&&(l.poleAxis.value=a);var x=this._lodMax;l.dTheta.value=h,l.mipInt.value=x-n;var w=this._sizeLods[r];mx(e,3*w*(r>x-4?r-x+4:0),4*(this._cubeSize-w),3*w,2*w),s.setRenderTarget(e),s.render(c,ex)}}],e&&K_(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();function dx(t,e,n){var r=new h.O0B(t,e,n);return r.texture.mapping=h.Om,r.texture.name="PMREM.cubeUv",r.texture.isPMREMTexture=!0,r.scissorTest=!0,r}function mx(t,e,n,r,i){var o=t.height-i-n;t.viewport.set(e,o,r,i),t.scissor.set(e,o,r,i)}function yx(){var t=new Cb;return t.colorSpaced=!1,t.toneMapped=!1,t.depthTest=!1,t.depthWrite=!1,t.blending=h.XIg,t}function vx(t){var e=yx();return e.fragmentNode=qm(t,hx),e}function gx(t){var e=yx();return e.fragmentNode=El(t,B_(hx),0),e}const bx=px;function _x(t){return _x="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_x(t)}function xx(t){return function(t){if(Array.isArray(t))return Tx(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||Sx(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function wx(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=Sx(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function Sx(t,e){if(t){if("string"==typeof t)return Tx(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Tx(t,e):void 0}}function Tx(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function Mx(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Ex(r.key),r)}}function Ex(t){var e=function(t,e){if("object"!=_x(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=_x(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==_x(e)?e:e+""}var Ax=new X_.A,Ox=new Map([[2,"vec2"],[3,"vec3"],[4,"vec4"],[9,"mat3"],[16,"mat4"]]),Px=new Map([[Int8Array,"int"],[Int16Array,"int"],[Int32Array,"int"],[Uint8Array,"uint"],[Uint16Array,"uint"],[Uint32Array,"uint"],[Float32Array,"float"]]),Rx=function(t){return(t=Number(t))+(t%1?"":".0")},kx=function(){return t=function t(e,n,r){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.object=e,this.material=o||e&&e.material||null,this.geometry=e&&e.geometry||null,this.renderer=n,this.parser=r,this.scene=i,this.nodes=[],this.updateNodes=[],this.updateBeforeNodes=[],this.hashNodes={},this.lightsNode=null,this.environmentNode=null,this.fogNode=null,this.toneMappingNode=null,this.clippingContext=null,this.vertexShader=null,this.fragmentShader=null,this.computeShader=null,this.flowNodes={vertex:[],fragment:[],compute:[]},this.flowCode={vertex:"",fragment:"",compute:[]},this.uniforms={vertex:[],fragment:[],compute:[],index:0},this.structs={vertex:[],fragment:[],compute:[],index:0},this.bindings={vertex:[],fragment:[],compute:[]},this.bindingsOffset={vertex:0,fragment:0,compute:0},this.bindingsArray=null,this.attributes=[],this.bufferAttributes=[],this.varyings=[],this.codes={},this.vars={},this.flow={code:""},this.chaining=[],this.stack=A_(),this.stacks=[],this.tab="\t",this.currentFunctionNode=null,this.context={keywords:new Lo,material:this.material},this.cache=new ti,this.globalCache=this.cache,this.flowsData=new WeakMap,this.shaderStage=null,this.buildStage=null},e=[{key:"createRenderTarget",value:function(t,e,n){return new h.O0B(t,e,n)}},{key:"createCubeRenderTarget",value:function(t,e){return new q_(t,e)}},{key:"createPMREMGenerator",value:function(){return new bx(this.renderer)}},{key:"includes",value:function(t){return this.nodes.includes(t)}},{key:"_getSharedBindings",value:function(t){var e,n=[],r=wx(t);try{for(r.s();!(e=r.n()).done;){var i=e.value;if(!0===i.shared){var o=i.getNodes(),a=Ax.get(o);void 0===a&&(Ax.set(o,i),a=i),n.push(a)}else n.push(i)}}catch(t){r.e(t)}finally{r.f()}return n}},{key:"getBindings",value:function(){var t=this.bindingsArray;if(null===t){var e=this.bindings;this.bindingsArray=t=this._getSharedBindings(null!==this.material?[].concat(xx(e.vertex),xx(e.fragment)):e.compute)}return t}},{key:"setHashNode",value:function(t,e){this.hashNodes[e]=t}},{key:"addNode",value:function(t){!1===this.nodes.includes(t)&&(this.nodes.push(t),this.setHashNode(t,t.getHash(this)))}},{key:"buildUpdateNodes",value:function(){var t,e=wx(this.nodes);try{for(e.s();!(t=e.n()).done;){var n=t.value,r=n.getUpdateType(),i=n.getUpdateBeforeType();r!==a.NONE&&this.updateNodes.push(n.getSelf()),i!==a.NONE&&this.updateBeforeNodes.push(n)}}catch(t){e.e(t)}finally{e.f()}}},{key:"currentNode",get:function(){return this.chaining[this.chaining.length-1]}},{key:"addChain",value:function(t){this.chaining.push(t)}},{key:"removeChain",value:function(t){if(this.chaining.pop()!==t)throw new Error("NodeBuilder: Invalid node chaining!")}},{key:"getMethod",value:function(t){return t}},{key:"getNodeFromHash",value:function(t){return this.hashNodes[t]}},{key:"addFlow",value:function(t,e){return this.flowNodes[t].push(e),e}},{key:"setContext",value:function(t){this.context=t}},{key:"getContext",value:function(){return this.context}},{key:"setCache",value:function(t){this.cache=t}},{key:"getCache",value:function(){return this.cache}},{key:"isAvailable",value:function(){return!1}},{key:"getVertexIndex",value:function(){console.warn("Abstract function.")}},{key:"getInstanceIndex",value:function(){console.warn("Abstract function.")}},{key:"getFrontFacing",value:function(){console.warn("Abstract function.")}},{key:"getFragCoord",value:function(){console.warn("Abstract function.")}},{key:"isFlipY",value:function(){return!1}},{key:"generateTexture",value:function(){console.warn("Abstract function.")}},{key:"generateTextureLod",value:function(){console.warn("Abstract function.")}},{key:"generateConst",value:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(null===n&&("float"===t||"int"===t||"uint"===t?n=0:"bool"===t?n=!1:"color"===t?n=new h.Q1f:"vec2"===t?n=new h.I9Y:"vec3"===t?n=new h.Pq0:"vec4"===t&&(n=new h.IUQ)),"float"===t)return Rx(n);if("int"===t)return"".concat(Math.round(n));if("uint"===t)return n>=0?"".concat(Math.round(n),"u"):"0u";if("bool"===t)return n?"true":"false";if("color"===t)return"".concat(this.getType("vec3"),"( ").concat(Rx(n.r),", ").concat(Rx(n.g),", ").concat(Rx(n.b)," )");var r=this.getTypeLength(t),i=this.getComponentType(t),o=function(t){return e.generateConst(i,t)};if(2===r)return"".concat(this.getType(t),"( ").concat(o(n.x),", ").concat(o(n.y)," )");if(3===r)return"".concat(this.getType(t),"( ").concat(o(n.x),", ").concat(o(n.y),", ").concat(o(n.z)," )");if(4===r)return"".concat(this.getType(t),"( ").concat(o(n.x),", ").concat(o(n.y),", ").concat(o(n.z),", ").concat(o(n.w)," )");if(r>4&&n&&(n.isMatrix3||n.isMatrix4))return"".concat(this.getType(t),"( ").concat(n.elements.map(o).join(", ")," )");if(r>4)return"".concat(this.getType(t),"()");throw new Error("NodeBuilder: Type '".concat(t,"' not found in generate constant attempt."))}},{key:"getType",value:function(t){return"color"===t?"vec3":t}},{key:"generateMethod",value:function(t){return t}},{key:"hasGeometryAttribute",value:function(t){return this.geometry&&void 0!==this.geometry.getAttribute(t)}},{key:"getAttribute",value:function(t,e){var n,r=this.attributes,i=wx(r);try{for(i.s();!(n=i.n()).done;){var o=n.value;if(o.name===t)return o}}catch(t){i.e(t)}finally{i.f()}var a=new no(t,e);return r.push(a),a}},{key:"getPropertyName",value:function(t){return t.name}},{key:"isVector",value:function(t){return/vec\d/.test(t)}},{key:"isMatrix",value:function(t){return/mat\d/.test(t)}},{key:"isReference",value:function(t){return"void"===t||"property"===t||"sampler"===t||"texture"===t||"cubeTexture"===t||"storageTexture"===t}},{key:"needsColorSpaceToLinear",value:function(){return!1}},{key:"getComponentTypeFromTexture",value:function(t){var e=t.type;if(t.isDataTexture){if(e===h.Yuy)return"int";if(e===h.bkx)return"uint"}return"float"}},{key:"getComponentType",value:function(t){if("float"===(t=this.getVectorType(t))||"bool"===t||"int"===t||"uint"===t)return t;var e=/(b|i|u|)(vec|mat)([2-4])/.exec(t);return null===e?null:"b"===e[1]?"bool":"i"===e[1]?"int":"u"===e[1]?"uint":"float"}},{key:"getVectorType",value:function(t){return"color"===t?"vec3":"texture"===t||"cubeTexture"===t||"storageTexture"===t?"vec4":t}},{key:"getTypeFromLength",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"float";if(1===t)return e;var n=Ox.get(t);return("float"===e?"":e[0])+n}},{key:"getTypeFromArray",value:function(t){return Px.get(t.constructor)}},{key:"getTypeFromAttribute",value:function(t){var e=t;t.isInterleavedBufferAttribute&&(e=t.data);var n,r=e.array,i=t.itemSize,o=t.normalized;return t instanceof h.Oax||!0===o||(n=this.getTypeFromArray(r)),this.getTypeFromLength(i,n)}},{key:"getTypeLength",value:function(t){var e=this.getVectorType(t),n=/vec([2-4])/.exec(e);return null!==n?Number(n[1]):"float"===e||"bool"===e||"int"===e||"uint"===e?1:!0===/mat2/.test(t)?4:!0===/mat3/.test(t)?9:!0===/mat4/.test(t)?16:0}},{key:"getVectorFromMatrix",value:function(t){return t.replace("mat","vec")}},{key:"changeComponentType",value:function(t,e){return this.getTypeFromLength(this.getTypeLength(t),e)}},{key:"getIntegerType",value:function(t){var e=this.getComponentType(t);return"int"===e||"uint"===e?t:this.changeComponentType(t,"int")}},{key:"addStack",value:function(){return this.stack=A_(this.stack),this.stacks.push(Tn()||this.stack),Sn(this.stack),this.stack}},{key:"removeStack",value:function(){var t=this.stack;return this.stack=t.parent,Sn(this.stacks.pop()),t}},{key:"getDataFromNode",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.shaderStage,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=(n=null===n?t.isGlobal(this)?this.globalCache:this.cache:n).getNodeData(t);return void 0===r&&(r={},n.setNodeData(t,r)),void 0===r[e]&&(r[e]={}),r[e]}},{key:"getNodeProperties",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"any",n=this.getDataFromNode(t,e);return n.properties||(n.properties={outputNode:null})}},{key:"getBufferAttributeFromNode",value:function(t,e){var n=this.getDataFromNode(t),r=n.bufferAttribute;if(void 0===r){var i=this.uniforms.index++;r=new no("nodeAttribute"+i,e,t),this.bufferAttributes.push(r),n.bufferAttribute=r}return r}},{key:"getStructTypeFromNode",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.shaderStage,n=this.getDataFromNode(t,e);if(void 0===n.structType){var r=this.structs.index++;t.name="StructType".concat(r),this.structs[e].push(t),n.structType=t}return t}},{key:"getUniformFromNode",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.shaderStage,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,i=this.getDataFromNode(t,n,this.globalCache),o=i.uniform;if(void 0===o){var a=this.uniforms.index++;o=new so(r||"nodeUniform"+a,e,t),this.uniforms[n].push(o),i.uniform=o}return o}},{key:"getVarFromNode",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t.getNodeType(this),r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.shaderStage,i=this.getDataFromNode(t,r),o=i.variable;if(void 0===o){var a=this.vars[r]||(this.vars[r]=[]);null===e&&(e="nodeVar"+a.length),o=new po(e,n),a.push(o),i.variable=o}return o}},{key:"getVaryingFromNode",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t.getNodeType(this),r=this.getDataFromNode(t,"any"),i=r.varying;if(void 0===i){var o=this.varyings,a=o.length;null===e&&(e="nodeVarying"+a),i=new xo(e,n),o.push(i),r.varying=i}return i}},{key:"getCodeFromNode",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.shaderStage,r=this.getDataFromNode(t),i=r.code;if(void 0===i){var o=this.codes[n]||(this.codes[n]=[]),a=o.length;i=new Ao("nodeCode"+a,e),o.push(i),r.code=i}return i}},{key:"addLineFlowCode",value:function(t){return""===t||(t=this.tab+t,/;\s*$/.test(t)||(t+=";\n"),this.flow.code+=t),this}},{key:"addFlowCode",value:function(t){return this.flow.code+=t,this}},{key:"addFlowTab",value:function(){return this.tab+="\t",this}},{key:"removeFlowTab",value:function(){return this.tab=this.tab.slice(0,-1),this}},{key:"getFlowData",value:function(t){return this.flowsData.get(t)}},{key:"flowNode",value:function(t){var e=t.getNodeType(this),n=this.flowChildNode(t,e);return this.flowsData.set(t,n),n}},{key:"buildFunctionNode",value:function(t){var e=new Ha,n=this.currentFunctionNode;return this.currentFunctionNode=e,e.code=this.buildFunctionCode(t),this.currentFunctionNode=n,e}},{key:"flowShaderNode",value:function(t){var e,n=t.layout;if(t.isArrayInput){e=[];var r,i=wx(n.inputs);try{for(i.s();!(r=i.n()).done;){var o=r.value;e.push(new va(o.type,o.name))}}catch(t){i.e(t)}finally{i.f()}}else{e={};var a,s=wx(n.inputs);try{for(s.s();!(a=s.n()).done;){var u=a.value;e[u.name]=new va(u.type,u.name)}}catch(t){s.e(t)}finally{s.f()}}t.layout=null;var c=t.call(e),l=this.flowStagesNode(c,n.type);return t.layout=n,l}},{key:"flowStagesNode",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=this.flow,r=this.vars,i=this.buildStage,o={code:""};this.flow=o,this.vars={};var a,s=wx(c);try{for(s.s();!(a=s.n()).done;){var u=a.value;this.setBuildStage(u),o.result=t.build(this,e)}}catch(t){s.e(t)}finally{s.f()}return o.vars=this.getVars(this.shaderStage),this.flow=n,this.vars=r,this.setBuildStage(i),o}},{key:"getFunctionOperator",value:function(){return null}},{key:"flowChildNode",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=this.flow,r={code:""};return this.flow=r,r.result=t.build(this,e),this.flow=n,r}},{key:"flowNodeFromShaderStage",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,i=this.shaderStage;this.setShaderStage(t);var o=this.flowChildNode(e,n);return null!==r&&(o.code+="".concat(this.tab+r," = ").concat(o.result,";\n")),this.flowCode[t]=this.flowCode[t]+o.code,this.setShaderStage(i),o}},{key:"getAttributesArray",value:function(){return this.attributes.concat(this.bufferAttributes)}},{key:"getAttributes",value:function(){console.warn("Abstract function.")}},{key:"getVaryings",value:function(){console.warn("Abstract function.")}},{key:"getVar",value:function(t,e){return"".concat(this.getType(t)," ").concat(e)}},{key:"getVars",value:function(t){var e="",n=this.vars[t];if(void 0!==n){var r,i=wx(n);try{for(i.s();!(r=i.n()).done;){var o=r.value;e+="".concat(this.getVar(o.type,o.name),"; ")}}catch(t){i.e(t)}finally{i.f()}}return e}},{key:"getUniforms",value:function(){console.warn("Abstract function.")}},{key:"getCodes",value:function(t){var e=this.codes[t],n="";if(void 0!==e){var r,i=wx(e);try{for(i.s();!(r=i.n()).done;)n+=r.value.code+"\n"}catch(t){i.e(t)}finally{i.f()}}return n}},{key:"getHash",value:function(){return this.vertexShader+this.fragmentShader+this.computeShader}},{key:"setShaderStage",value:function(t){this.shaderStage=t}},{key:"getShaderStage",value:function(){return this.shaderStage}},{key:"setBuildStage",value:function(t){this.buildStage=t}},{key:"getBuildStage",value:function(){return this.buildStage}},{key:"buildCode",value:function(){console.warn("Abstract function.")}},{key:"build",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],e=this.object,n=this.material;t&&(null!==n?Cb.fromMaterial(n).build(this):this.addFlow("compute",e));var r,i=wx(c);try{for(i.s();!(r=i.n()).done;){var o=r.value;this.setBuildStage(o),this.context.vertex&&this.context.vertex.isNode&&this.flowNodeFromShaderStage("vertex",this.context.vertex);var a,s=wx(l);try{for(s.s();!(a=s.n()).done;){var u=a.value;this.setShaderStage(u);var f,h=wx(this.flowNodes[u]);try{for(h.s();!(f=h.n()).done;){var p=f.value;"generate"===o?this.flowNode(p):p.build(this)}}catch(t){h.e(t)}finally{h.f()}}}catch(t){s.e(t)}finally{s.f()}}}catch(t){i.e(t)}finally{i.f()}return this.setBuildStage(null),this.setShaderStage(null),this.buildCode(),this.buildUpdateNodes(),this}},{key:"getNodeUniform",value:function(t,e){if("float"===e)return new c_(t);if("vec2"===e)return new l_(t);if("vec3"===e)return new f_(t);if("vec4"===e)return new h_(t);if("color"===e)return new p_(t);if("mat3"===e)return new d_(t);if("mat4"===e)return new m_(t);throw new Error('Uniform "'.concat(e,'" not declared.'))}},{key:"createNodeMaterial",value:function(){return Lb(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"NodeMaterial")}},{key:"format",value:function(t,e,n){if((e=this.getVectorType(e))===(n=this.getVectorType(n))||null===n||this.isReference(n))return t;var r=this.getTypeLength(e),i=this.getTypeLength(n);return r>4||i>4||0===i?t:r===i?"".concat(this.getType(n),"( ").concat(t," )"):r>i?this.format("".concat(t,".").concat("xyz".slice(0,i)),this.getTypeFromLength(i,this.getComponentType(e)),n):4===i&&r>1?"".concat(this.getType(n),"( ").concat(this.format(t,e,"vec3"),", 1.0 )"):2===r?"".concat(this.getType(n),"( ").concat(this.format(t,e,"vec2"),", 0.0 )"):(1===r&&i>1&&e[0]!==n[0]&&(t="".concat(this.getType(this.getComponentType(n)),"( ").concat(t," )")),"".concat(this.getType(n),"( ").concat(t," )"))}},{key:"getSignature",value:function(){return"// Three.js r".concat(h.sPf," - NodeMaterial System\n")}}],e&&Mx(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();const Cx=kx;function Nx(t){return Nx="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Nx(t)}function Lx(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,jx(r.key),r)}}function jx(t){var e=function(t,e){if("object"!=Nx(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=Nx(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Nx(e)?e:e+""}var Ix=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.time=0,this.deltaTime=0,this.frameId=0,this.renderId=0,this.startTime=null,this.updateMap=new WeakMap,this.updateBeforeMap=new WeakMap,this.renderer=null,this.material=null,this.camera=null,this.object=null,this.scene=null},e=[{key:"_getMaps",value:function(t,e){var n=t.get(e);return void 0===n&&(n={renderMap:new WeakMap,frameMap:new WeakMap},t.set(e,n)),n}},{key:"updateBeforeNode",value:function(t){var e=t.getUpdateBeforeType(),n=t.updateReference(this);if(e===a.FRAME){var r=this._getMaps(this.updateBeforeMap,n).frameMap;r.get(n)!==this.frameId&&!1!==t.updateBefore(this)&&r.set(n,this.frameId)}else if(e===a.RENDER){var i=this._getMaps(this.updateBeforeMap,n).renderMap;i.get(n)!==this.renderId&&!1!==t.updateBefore(this)&&i.set(n,this.renderId)}else e===a.OBJECT&&t.updateBefore(this)}},{key:"updateNode",value:function(t){var e=t.getUpdateType(),n=t.updateReference(this);if(e===a.FRAME){var r=this._getMaps(this.updateMap,n).frameMap;r.get(n)!==this.frameId&&!1!==t.update(this)&&r.set(n,this.frameId)}else if(e===a.RENDER){var i=this._getMaps(this.updateMap,n).renderMap;i.get(n)!==this.renderId&&!1!==t.update(this)&&i.set(n,this.renderId)}else e===a.OBJECT&&t.update(this)}},{key:"update",value:function(){this.frameId++,void 0===this.lastTime&&(this.lastTime=performance.now()),this.deltaTime=(performance.now()-this.lastTime)/1e3,this.lastTime=performance.now(),this.time+=this.deltaTime}}],e&&Lx(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();const Bx=Ix;var Ux=n(1248);function Dx(t){return Dx="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Dx(t)}function Fx(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,zx(r.key),r)}}function zx(t){var e=function(t,e){if("object"!=Dx(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=Dx(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Dx(e)?e:e+""}function Vx(t,e,n){return e=Hx(e),function(t,e){if(e&&("object"===Dx(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,Gx()?Reflect.construct(e,n||[],Hx(t).constructor):e.apply(t,n))}function Gx(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(Gx=function(){return!!t})()}function Hx(t){return Hx=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Hx(t)}function Wx(t,e){return Wx=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Wx(t,e)}var qx=function(t){function e(t){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=Vx(this,e)).types=t,n.isStructTypeNode=!0,n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Wx(t,e)}(e,t),n=e,(r=[{key:"getMemberTypes",value:function(){return this.types}}])&&Fx(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(F);const Xx=qx;function Yx(t){return Yx="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Yx(t)}function Jx(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Zx(r.key),r)}}function Zx(t){var e=function(t,e){if("object"!=Yx(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=Yx(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Yx(e)?e:e+""}function Kx(t,e,n){return e=tw(e),function(t,e){if(e&&("object"===Yx(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,Qx()?Reflect.construct(e,n||[],tw(t).constructor):e.apply(t,n))}function Qx(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(Qx=function(){return!!t})()}function $x(){return $x="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=tw(t)););return t}(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(arguments.length<3?t:n):i.value}},$x.apply(this,arguments)}function tw(t){return tw=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},tw(t)}function ew(t,e){return ew=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},ew(t,e)}z("StructTypeNode",qx);var nw=function(t){function e(){var t;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(t=Kx(this,e)).isOutputStructNode=!0;for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return t.members=r,t}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&ew(t,e)}(e,t),n=e,r=[{key:"setup",value:function(t){$x(tw(e.prototype),"setup",this).call(this,t);for(var n=this.members,r=[],i=0;i<n.length;i++)r.push(n[i].getNodeType(t));this.nodeType=t.getStructTypeFromNode(new Xx(r)).name}},{key:"generate",value:function(t,e){var n=t.getVarFromNode(this);n.isOutputStructVar=!0;for(var r=t.getPropertyName(n),i=this.members,o=""!==r?r+".":"",a=0;a<i.length;a++){var s=i[a].build(t,e);t.addLineFlowCode("".concat(o,"m").concat(a," = ").concat(s))}return r}}],r&&Jx(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(F);const rw=nw;var iw=bn(nw);function ow(t){return ow="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ow(t)}function aw(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,sw(r.key),r)}}function sw(t){var e=function(t,e){if("object"!=ow(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=ow(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==ow(e)?e:e+""}function uw(t,e,n){return e=lw(e),function(t,e){if(e&&("object"===ow(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,cw()?Reflect.construct(e,n||[],lw(t).constructor):e.apply(t,n))}function cw(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(cw=function(){return!!t})()}function lw(t){return lw=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},lw(t)}function fw(t,e){return fw=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},fw(t,e)}z("OutputStructNode",nw);var hw=function(t){function e(t){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=uw(this,e)).seedNode=t,n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&fw(t,e)}(e,t),n=e,(r=[{key:"setup",value:function(){var t=this.seedNode.uint().mul(747796405).add(2891336453),e=t.shiftRight(t.shiftRight(28).add(4)).bitXor(t).mul(277803737);return e.shiftRight(22).bitXor(e).float().mul(1/Math.pow(2,32))}}])&&aw(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(F);const pw=hw;var dw=bn(hw);Ce("hash",dw),z("HashNode",hw);var mw=function(t,e){return gc(Zs(4,t.mul(Js(1,t))),e)},yw=function(t,e){return t.lessThan(.5)?mw(t.mul(2),e).div(2):Js(1,mw(Zs(Js(1,t),2),e).div(2))},vw=function(t,e,n){return gc(Ks(gc(t,e),Ys(gc(t,e),gc(Js(1,t),n))),1/e)},gw=function(t,e){return Hu(Au.mul(e.mul(t).sub(1))).div(Au.mul(e.mul(t).sub(1)))};function bw(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,i,o,a,s=[],u=!0,c=!1;try{if(o=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=o.call(n)).done)&&(s.push(r.value),s.length!==e);u=!0);}catch(t){c=!0,i=t}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw i}}return s}}(t,e)||function(t,e){if(t){if("string"==typeof t)return _w(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_w(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _w(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}Ce("parabola",mw),Ce("gain",yw),Ce("pcurve",vw),Ce("sinc",gw);var xw,ww=wn((function(t){return bw(t,1)[0].fract().sub(.5).abs()})),Sw=wn((function(t){var e=bw(t,1)[0];return In(ww(e.z.add(ww(e.y.mul(1)))),ww(e.z.add(ww(e.x.mul(1)))),ww(e.y.add(ww(e.x.mul(1)))))})),Tw=wn((function(t){var e=bw(t,3),n=e[0],r=e[1],i=e[2],o=In(n).toVar(),a=On(1.4).toVar(),s=On(0).toVar(),u=In(o).toVar();return fm({start:On(0),end:On(3),type:"float",condition:"<="},(function(){var t=In(Sw(u.mul(2))).toVar();o.addAssign(t.add(i.mul(On(.1).mul(r)))),u.mulAssign(1.8),a.mulAssign(1.5),o.mulAssign(1.2);var e=On(ww(o.z.add(ww(o.x.add(ww(o.y)))))).toVar();s.addAssign(e.div(a)),u.addAssign(.14)})),s}));function Mw(t){return Mw="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Mw(t)}function Ew(t,e,n){return e=Ow(e),function(t,e){if(e&&("object"===Mw(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,Aw()?Reflect.construct(e,n||[],Ow(t).constructor):e.apply(t,n))}function Aw(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(Aw=function(){return!!t})()}function Ow(t){return Ow=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Ow(t)}function Pw(t,e){return Pw=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Pw(t,e)}ww.setLayout({name:"tri",type:"float",inputs:[{name:"x",type:"float"}]}),Sw.setLayout({name:"tri3",type:"vec3",inputs:[{name:"p",type:"vec3"}]}),Tw.setLayout({name:"triNoise3D",type:"float",inputs:[{name:"p",type:"vec3"},{name:"spd",type:"float"},{name:"time",type:"float"}]});var Rw=function(t){function e(t){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),Ew(this,e,[t,xw=xw||ol("discard")])}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Pw(t,e)}(e,t),n=e,Object.defineProperty(n,"prototype",{writable:!1}),n;var n}(nv);const kw=Rw;var Cw=bn(Rw),Nw=function(t){return Cw(t).append()};function Lw(t){return Lw="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Lw(t)}function jw(t,e){if(t){if("string"==typeof t)return Iw(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Iw(t,e):void 0}}function Iw(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function Bw(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Uw(r.key),r)}}function Uw(t){var e=function(t,e){if("object"!=Lw(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=Lw(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Lw(e)?e:e+""}function Dw(t,e,n){return e=zw(e),function(t,e){if(e&&("object"===Lw(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,Fw()?Reflect.construct(e,n||[],zw(t).constructor):e.apply(t,n))}function Fw(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(Fw=function(){return!!t})()}function zw(t){return zw=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},zw(t)}function Vw(t,e){return Vw=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Vw(t,e)}Ce("discard",Nw),z("DiscardNode",Rw);var Gw=function(t){function e(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(t=Dw(this,e)).functionNodes=n;for(var r=arguments.length,i=new Array(r>1?r-1:0),o=1;o<r;o++)i[o-1]=arguments[o];return t.parametersNodes=i,t._candidateFnCall=null,t}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Vw(t,e)}(e,t),n=e,r=[{key:"getNodeType",value:function(){return this.functionNodes[0].shaderNode.layout.type}},{key:"setup",value:function(t){var e,n=this.parametersNodes,r=this._candidateFnCall;if(null===r){var i,o=null,a=-1,s=function(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=jw(t))){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}(this.functionNodes);try{for(s.s();!(i=s.n()).done;){var u=i.value,c=u.shaderNode.layout;if(null===c)throw new Error("FunctionOverloadingNode: FunctionNode must be a layout.");var l=c.inputs;if(n.length===l.length){for(var f=0,h=0;h<n.length;h++){var p=n[h],d=l[h];p.getNodeType(t)===d.type?f++:f=0}f>a&&(o=u,a=f)}}}catch(t){s.e(t)}finally{s.f()}this._candidateFnCall=r=o.apply(void 0,function(t){if(Array.isArray(t))return Iw(t)}(e=n)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(e)||jw(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}())}return r}}],r&&Bw(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(F);const Hw=Gw;var Ww=bn(Gw),qw=function(t){return function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return Ww.apply(void 0,[t].concat(n))}};function Xw(t){return Xw="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Xw(t)}function Yw(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Jw(r.key),r)}}function Jw(t){var e=function(t,e){if("object"!=Xw(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=Xw(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Xw(e)?e:e+""}function Zw(t,e,n){return e=Qw(e),function(t,e){if(e&&("object"===Xw(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,Kw()?Reflect.construct(e,n||[],Qw(t).constructor):e.apply(t,n))}function Kw(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(Kw=function(){return!!t})()}function Qw(t){return Qw=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Qw(t)}function $w(t,e){return $w=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},$w(t,e)}z("FunctionOverloadingNode",Gw);var tS=function(t){function e(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),Zw(this,e,["vec2"])}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&$w(t,e)}(e,t),n=e,(r=[{key:"setup",value:function(){var t=In(Fp.z,0,Fp.x.negate()).normalize(),e=Fp.cross(t);return Cn(t.dot(Fh),e.dot(Fh)).mul(.495).add(.5)}}])&&Yw(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(Q);const eS=tS;var nS=_n(tS);function rS(t){return rS="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},rS(t)}function iS(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,oS(r.key),r)}}function oS(t){var e=function(t,e){if("object"!=rS(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=rS(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==rS(e)?e:e+""}function aS(t,e,n){return e=cS(e),function(t,e){if(e&&("object"===rS(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,sS()?Reflect.construct(e,n||[],cS(t).constructor):e.apply(t,n))}function sS(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(sS=function(){return!!t})()}function uS(){return uS="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=cS(t)););return t}(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(arguments.length<3?t:n):i.value}},uS.apply(this,arguments)}function cS(t){return cS=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},cS(t)}function lS(t,e){return lS=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},lS(t,e)}z("MatcapUVNode",tS);var fS=function(t){function e(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e.LOCAL,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(t=aS(this,e,[i])).scope=n,t.scale=r,t.updateType=a.FRAME,t}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&lS(t,e)}(e,t),n=e,(r=[{key:"update",value:function(t){var n=this.scope,r=this.scale;n===e.LOCAL?this.value+=t.deltaTime*r:n===e.DELTA?this.value=t.deltaTime*r:n===e.FRAME?this.value=t.frameId:this.value=t.time*r}},{key:"serialize",value:function(t){uS(cS(e.prototype),"serialize",this).call(this,t),t.scope=this.scope,t.scale=this.scale}},{key:"deserialize",value:function(t){uS(cS(e.prototype),"deserialize",this).call(this,t),this.scope=t.scope,this.scale=t.scale}}])&&iS(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(vs);fS.LOCAL="local",fS.GLOBAL="global",fS.DELTA="delta",fS.FRAME="frame";const hS=fS;var pS=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return yn(new fS(fS.LOCAL,t,e))},dS=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return yn(new fS(fS.GLOBAL,t,e))},mS=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return yn(new fS(fS.DELTA,t,e))},yS=_n(fS,fS.FRAME).uint();function vS(t){return vS="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},vS(t)}function gS(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,bS(r.key),r)}}function bS(t){var e=function(t,e){if("object"!=vS(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=vS(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==vS(e)?e:e+""}function _S(t,e,n){return e=SS(e),function(t,e){if(e&&("object"===vS(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,xS()?Reflect.construct(e,n||[],SS(t).constructor):e.apply(t,n))}function xS(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(xS=function(){return!!t})()}function wS(){return wS="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=SS(t)););return t}(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(arguments.length<3?t:n):i.value}},wS.apply(this,arguments)}function SS(t){return SS=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},SS(t)}function TS(t,e){return TS=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},TS(t,e)}z("TimerNode",fS);var MS=function(t){function e(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e.SINE,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:pS();return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(t=_S(this,e)).method=n,t.timeNode=r,t}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&TS(t,e)}(e,t),n=e,(r=[{key:"getNodeType",value:function(t){return this.timeNode.getNodeType(t)}},{key:"setup",value:function(){var t=this.method,n=yn(this.timeNode),r=null;return t===e.SINE?r=n.add(.75).mul(2*Math.PI).sin().mul(.5).add(.5):t===e.SQUARE?r=n.fract().round():t===e.TRIANGLE?r=n.add(.5).fract().mul(2).sub(1).abs():t===e.SAWTOOTH&&(r=n.fract()),r}},{key:"serialize",value:function(t){wS(SS(e.prototype),"serialize",this).call(this,t),t.method=this.method}},{key:"deserialize",value:function(t){wS(SS(e.prototype),"deserialize",this).call(this,t),this.method=t.method}}])&&gS(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(F);MS.SINE="sine",MS.SQUARE="square",MS.TRIANGLE="triangle",MS.SAWTOOTH="sawtooth";const ES=MS;var AS=bn(MS,MS.SINE),OS=bn(MS,MS.SQUARE),PS=bn(MS,MS.TRIANGLE),RS=bn(MS,MS.SAWTOOTH);function kS(t){return kS="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},kS(t)}function CS(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,NS(r.key),r)}}function NS(t){var e=function(t,e){if("object"!=kS(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=kS(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==kS(e)?e:e+""}function LS(t,e,n){return e=IS(e),function(t,e){if(e&&("object"===kS(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,jS()?Reflect.construct(e,n||[],IS(t).constructor):e.apply(t,n))}function jS(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(jS=function(){return!!t})()}function IS(t){return IS=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},IS(t)}function BS(t,e){return BS=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},BS(t,e)}z("OscNode",MS);var US=function(t){function e(t,n){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(r=LS(this,e)).scope=t,r.node=n,r}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&BS(t,e)}(e,t),n=e,(r=[{key:"getNodeType",value:function(t){return this.node.getNodeType(t)}},{key:"setup",value:function(){var t=this.scope,n=this.node,r=null;return t===e.DIRECTION_TO_COLOR?r=n.mul(.5).add(.5):t===e.COLOR_TO_DIRECTION&&(r=n.mul(2).sub(1)),r}}])&&CS(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(Q);US.DIRECTION_TO_COLOR="directionToColor",US.COLOR_TO_DIRECTION="colorToDirection";const DS=US;var FS=bn(US,US.DIRECTION_TO_COLOR),zS=bn(US,US.COLOR_TO_DIRECTION);function VS(t){return VS="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},VS(t)}function GS(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,HS(r.key),r)}}function HS(t){var e=function(t,e){if("object"!=VS(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=VS(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==VS(e)?e:e+""}function WS(t,e,n){return e=XS(e),function(t,e){if(e&&("object"===VS(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,qS()?Reflect.construct(e,n||[],XS(t).constructor):e.apply(t,n))}function qS(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(qS=function(){return!!t})()}function XS(t){return XS=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},XS(t)}function YS(t,e){return YS=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},YS(t,e)}Ce("directionToColor",FS),Ce("colorToDirection",zS),z("PackingNode",US);var JS=function(t){function e(t,n,r){var i,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:On(0),a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:On(1);return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(i=WS(this,e)).node=t,i.inLowNode=n,i.inHighNode=r,i.outLowNode=o,i.outHighNode=a,i.doClamp=!0,i}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&YS(t,e)}(e,t),n=e,(r=[{key:"setup",value:function(){var t=this.node,e=this.inLowNode,n=this.inHighNode,r=this.outLowNode,i=this.outHighNode,o=this.doClamp,a=t.sub(e).div(n.sub(e));return!0===o&&(a=a.clamp()),a.mul(i.sub(r)).add(r)}}])&&GS(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(F);const ZS=JS;var KS=bn(JS,null,null,{doClamp:!1}),QS=bn(JS);function $S(t){return $S="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},$S(t)}function tT(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,eT(r.key),r)}}function eT(t){var e=function(t,e){if("object"!=$S(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=$S(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==$S(e)?e:e+""}function nT(t,e,n){return e=iT(e),function(t,e){if(e&&("object"===$S(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,rT()?Reflect.construct(e,n||[],iT(t).constructor):e.apply(t,n))}function rT(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(rT=function(){return!!t})()}function iT(t){return iT=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},iT(t)}function oT(t,e){return oT=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},oT(t,e)}Ce("remap",KS),Ce("remapClamp",QS),z("RemapNode",JS);var aT=function(t){function e(t,n){var r,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Cn(.5);return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(r=nT(this,e,["vec2"])).uvNode=t,r.rotationNode=n,r.centerNode=i,r}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&oT(t,e)}(e,t),n=e,(r=[{key:"setup",value:function(){var t=this.uvNode,e=this.rotationNode,n=this.centerNode;return t.sub(n).rotate(e).add(n)}}])&&tT(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(Q);const sT=aT;var uT=bn(aT);function cT(t){return cT="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},cT(t)}function lT(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,fT(r.key),r)}}function fT(t){var e=function(t,e){if("object"!=cT(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=cT(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==cT(e)?e:e+""}function hT(t,e,n){return e=dT(e),function(t,e){if(e&&("object"===cT(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,pT()?Reflect.construct(e,n||[],dT(t).constructor):e.apply(t,n))}function pT(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(pT=function(){return!!t})()}function dT(t){return dT=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},dT(t)}function mT(t,e){return mT=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},mT(t,e)}Ce("rotateUV",uT),z("RotateUVNode",aT);var yT=function(t){function e(t,n){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(r=hT(this,e)).positionNode=t,r.rotationNode=n,r}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&mT(t,e)}(e,t),n=e,(r=[{key:"getNodeType",value:function(t){return this.positionNode.getNodeType(t)}},{key:"setup",value:function(t){var e=this.rotationNode,n=this.positionNode;if("vec2"===this.getNodeType(t)){var r=e.cos(),i=e.sin();return Hn(r,i,i.negate(),r).mul(n)}var o=e,a=Qn(Fn(1,0,0,0),Fn(0,Wu(o.x),Hu(o.x).negate(),0),Fn(0,Hu(o.x),Wu(o.x),0),Fn(0,0,0,1)),s=Qn(Fn(Wu(o.y),0,Hu(o.y),0),Fn(0,1,0,0),Fn(Hu(o.y).negate(),0,Wu(o.y),0),Fn(0,0,0,1)),u=Qn(Fn(Wu(o.z),Hu(o.z).negate(),0,0),Fn(Hu(o.z),Wu(o.z),0,0),Fn(0,0,1,0),Fn(0,0,0,1));return a.mul(s).mul(u).mul(Fn(n,1)).xyz}}])&&lT(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(Q);const vT=yT;var gT=bn(yT);function bT(t){return bT="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},bT(t)}function _T(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,xT(r.key),r)}}function xT(t){var e=function(t,e){if("object"!=bT(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=bT(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==bT(e)?e:e+""}function wT(t,e,n){return e=TT(e),function(t,e){if(e&&("object"===bT(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,ST()?Reflect.construct(e,n||[],TT(t).constructor):e.apply(t,n))}function ST(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(ST=function(){return!!t})()}function TT(t){return TT=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},TT(t)}function MT(t,e){return MT=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},MT(t,e)}Ce("rotate",gT),z("RotateNode",yT);var ET=function(t){function e(t){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Os(),i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:On(0);return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=wT(this,e,["vec2"])).countNode=t,n.uvNode=r,n.frameNode=i,n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&MT(t,e)}(e,t),n=e,(r=[{key:"setup",value:function(){var t=this.frameNode,e=this.uvNode,n=this.countNode,r=n.width,i=n.height,o=t.mod(r.mul(i)).floor(),a=o.mod(r),s=i.sub(o.add(1).div(r).ceil()),u=n.reciprocal(),c=Cn(a,s);return e.add(c).mul(u)}}])&&_T(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(F);const AT=ET;var OT=bn(ET);function PT(t){return PT="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},PT(t)}function RT(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,kT(r.key),r)}}function kT(t){var e=function(t,e){if("object"!=PT(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=PT(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==PT(e)?e:e+""}function CT(t,e,n){return e=jT(e),function(t,e){if(e&&("object"===PT(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,NT()?Reflect.construct(e,n||[],jT(t).constructor):e.apply(t,n))}function NT(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(NT=function(){return!!t})()}function LT(){return LT="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=jT(t)););return t}(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(arguments.length<3?t:n):i.value}},LT.apply(this,arguments)}function jT(t){return jT=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},jT(t)}function IT(t,e){return IT=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},IT(t,e)}z("SpriteSheetUVNode",ET);var BT=function(t){function e(t,n){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(r=CT(this,e,[t,n])).isStorageArrayElementNode=!0,r}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&IT(t,e)}(e,t),n=e,r=[{key:"storageBufferNode",get:function(){return this.node},set:function(t){this.node=t}},{key:"setup",value:function(t){return!1===t.isAvailable("storageBuffer")&&(this.node.instanceIndex||!0!==this.node.bufferObject||t.setupPBO(this.node)),LT(jT(e.prototype),"setup",this).call(this,t)}},{key:"generate",value:function(t,n){var r,i=t.context.assign;if(!1===t.isAvailable("storageBuffer")){var o=this.node;r=o.instanceIndex||!0!==this.node.bufferObject||!0===i?o.build(t):t.generatePBO(this)}else r=LT(jT(e.prototype),"generate",this).call(this,t);if(!0!==i){var a=this.getNodeType(t);r=t.format(r,a,n)}return r}}],r&&RT(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(st);const UT=BT;var DT=bn(BT);function FT(t){return FT="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},FT(t)}function zT(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,VT(r.key),r)}}function VT(t){var e=function(t,e){if("object"!=FT(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=FT(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==FT(e)?e:e+""}function GT(t,e,n){return e=WT(e),function(t,e){if(e&&("object"===FT(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,HT()?Reflect.construct(e,n||[],WT(t).constructor):e.apply(t,n))}function HT(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(HT=function(){return!!t})()}function WT(t){return WT=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},WT(t)}function qT(t,e){return qT=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},qT(t,e)}Ce("storageElement",DT),z("StorageArrayElementNode",BT);var XT=function(t){function e(t){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:On(1),a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Ip,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:Bh;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=GT(this,e,["vec4"])).textureXNode=t,n.textureYNode=r,n.textureZNode=i,n.scaleNode=o,n.positionNode=a,n.normalNode=s,n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&qT(t,e)}(e,t),n=e,(r=[{key:"setup",value:function(){var t=this.textureXNode,e=this.textureYNode,n=this.textureZNode,r=this.scaleNode,i=this.positionNode,o=this.normalNode.abs().normalize();o=o.div(o.dot(In(1)));var a=i.yz.mul(r),s=i.zx.mul(r),u=i.xy.mul(r),c=t.value,l=null!==e?e.value:c,f=null!==n?n.value:c,h=El(c,a).mul(o.x),p=El(l,s).mul(o.y),d=El(f,u).mul(o.z);return Ys(h,p,d)}}])&&zT(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(F);const YT=XT;var JT=bn(XT),ZT=function(){return JT.apply(void 0,arguments)};function KT(t){return KT="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},KT(t)}function QT(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,$T(r.key),r)}}function $T(t){var e=function(t,e){if("object"!=KT(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=KT(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==KT(e)?e:e+""}function tM(t,e,n){return e=rM(e),function(t,e){if(e&&("object"===KT(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,eM()?Reflect.construct(e,n||[],rM(t).constructor):e.apply(t,n))}function eM(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(eM=function(){return!!t})()}function nM(){return nM="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=rM(t)););return t}(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(arguments.length<3?t:n):i.value}},nM.apply(this,arguments)}function rM(t){return rM=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},rM(t)}function iM(t,e){return iM=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},iM(t,e)}Ce("triplanarTexture",ZT),z("TriplanarTexturesNode",XT);var oM=new h.Zcv,aM=new h.Pq0,sM=new h.Pq0,uM=new h.Pq0,cM=new h.kn4,lM=new h.Pq0(0,0,-1),fM=new h.IUQ,hM=new h.Pq0,pM=new h.Pq0,dM=new h.IUQ,mM=new h.I9Y,yM=new h.O0B,vM=Cn(fg.x.oneMinus(),fg.y),gM=!1,bM=function(t){function e(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),t=tM(this,e,[yM.texture,vM]);var r=n.target,i=void 0===r?new h.B69:r,o=n.resolution,s=void 0===o?1:o,u=n.generateMipmaps,c=void 0!==u&&u,l=n.bounces,f=void 0===l||l;return t.target=i,t.resolution=s,t.generateMipmaps=c,t.bounces=f,t.updateBeforeType=f?a.RENDER:a.FRAME,t.virtualCameras=new WeakMap,t.renderTargets=new WeakMap,t}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&iM(t,e)}(e,t),n=e,r=[{key:"_updateResolution",value:function(t,e){var n=this.resolution;e.getDrawingBufferSize(mM),t.setSize(Math.round(mM.width*n),Math.round(mM.height*n))}},{key:"setup",value:function(t){return this._updateResolution(yM,t.renderer),nM(rM(e.prototype),"setup",this).call(this,t)}},{key:"getTextureNode",value:function(){return this.textureNode}},{key:"getVirtualCamera",value:function(t){var e=this.virtualCameras.get(t);return void 0===e&&(e=t.clone(),this.virtualCameras.set(t,e)),e}},{key:"getRenderTarget",value:function(t){var e=this.renderTargets.get(t);return void 0===e&&(e=new h.O0B(0,0,{type:h.ix0}),!0===this.generateMipmaps&&(e.texture.minFilter=h.NZq,e.texture.generateMipmaps=!0),this.renderTargets.set(t,e)),e}},{key:"updateBefore",value:function(t){if(!1===this.bounces&&gM)return!1;gM=!0;var e=t.scene,n=t.camera,r=t.renderer,i=t.material,o=this.target,a=this.getVirtualCamera(n),s=this.getRenderTarget(a);if(r.getDrawingBufferSize(mM),this._updateResolution(s,r),sM.setFromMatrixPosition(o.matrixWorld),uM.setFromMatrixPosition(n.matrixWorld),cM.extractRotation(o.matrixWorld),aM.set(0,0,1),aM.applyMatrix4(cM),hM.subVectors(sM,uM),!(hM.dot(aM)>0)){hM.reflect(aM).negate(),hM.add(sM),cM.extractRotation(n.matrixWorld),lM.set(0,0,-1),lM.applyMatrix4(cM),lM.add(uM),pM.subVectors(sM,lM),pM.reflect(aM).negate(),pM.add(sM),a.coordinateSystem=n.coordinateSystem,a.position.copy(hM),a.up.set(0,1,0),a.up.applyMatrix4(cM),a.up.reflect(aM),a.lookAt(pM),a.near=n.near,a.far=n.far,a.updateMatrixWorld(),a.projectionMatrix.copy(n.projectionMatrix),oM.setFromNormalAndCoplanarPoint(aM,sM),oM.applyMatrix4(a.matrixWorldInverse),fM.set(oM.normal.x,oM.normal.y,oM.normal.z,oM.constant);var u=a.projectionMatrix;dM.x=(Math.sign(fM.x)+u.elements[8])/u.elements[0],dM.y=(Math.sign(fM.y)+u.elements[9])/u.elements[5],dM.z=-1,dM.w=(1+u.elements[10])/u.elements[14],fM.multiplyScalar(1/fM.dot(dM)),u.elements[2]=fM.x,u.elements[6]=fM.y,u.elements[10]=fM.z-0,u.elements[14]=fM.w,this.value=s.texture,i.visible=!1;var c=r.getRenderTarget();r.setRenderTarget(s),r.render(e,a),r.setRenderTarget(c),i.visible=!0,gM=!1}}}],r&&QT(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(Ml),_M=function(t){return yn(new bM(t))};const xM=bM;function wM(t){return wM="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},wM(t)}function SM(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,TM(r.key),r)}}function TM(t){var e=function(t,e){if("object"!=wM(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=wM(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==wM(e)?e:e+""}function MM(t,e,n){return e=OM(e),function(t,e){if(e&&("object"===wM(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,EM()?Reflect.construct(e,n||[],OM(t).constructor):e.apply(t,n))}function EM(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(EM=function(){return!!t})()}function AM(){return AM="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=OM(t)););return t}(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(arguments.length<3?t:n):i.value}},AM.apply(this,arguments)}function OM(t){return OM=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},OM(t)}function PM(t,e){return PM=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},PM(t,e)}var RM=function(t){function e(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e.LOCAL;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(t=MM(this,e,["vec3"])).scope=n,t}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&PM(t,e)}(e,t),n=e,(r=[{key:"getHash",value:function(){return"bitangent-".concat(this.scope)}},{key:"generate",value:function(t){var n,r=this.scope;r===e.GEOMETRY?n=Ih.cross(Rd):r===e.LOCAL?n=Bh.cross(kd):r===e.VIEW?n=Uh.cross(Cd):r===e.WORLD&&(n=Dh.cross(Nd));var i=n.mul(Rd.w).xyz;return Vu(Ar(i)).build(t,this.getNodeType(t))}},{key:"serialize",value:function(t){AM(OM(e.prototype),"serialize",this).call(this,t),t.scope=this.scope}},{key:"deserialize",value:function(t){AM(OM(e.prototype),"deserialize",this).call(this,t),this.scope=t.scope}}])&&SM(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(F);RM.GEOMETRY="geometry",RM.LOCAL="local",RM.VIEW="view",RM.WORLD="world";const kM=RM;var CM=_n(RM,RM.GEOMETRY),NM=_n(RM,RM.LOCAL),LM=_n(RM,RM.VIEW),jM=_n(RM,RM.WORLD),IM=Vu(Fh.cross(Ld).mul(Rd.w)),BM=Vu(IM.transformDirection(oh));z("BitangentNode",RM);var UM=Yn(Cd,LM,Uh),DM=Fp.mul(UM),FM=function(t,e){return t.sub(DM.mul(e))};function zM(t){return zM="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},zM(t)}function VM(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,GM(r.key),r)}}function GM(t){var e=function(t,e){if("object"!=zM(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=zM(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==zM(e)?e:e+""}function HM(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(HM=function(){return!!t})()}function WM(){return WM="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=qM(t)););return t}(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(arguments.length<3?t:n):i.value}},WM.apply(this,arguments)}function qM(t){return qM=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},qM(t)}function XM(t,e){return XM=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},XM(t,e)}var YM=function(t){function e(){var t,n,r,i,o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=this,r=e,i=[null,"vec4"],r=qM(r),t=function(t,e){if(e&&("object"===zM(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(n,HM()?Reflect.construct(r,i||[],qM(n).constructor):r.apply(n,i))).isVertexColorNode=!0,t.index=o,t}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&XM(t,e)}(e,t),n=e,(r=[{key:"getAttributeName",value:function(){var t=this.index;return"color"+(t>0?t:"")}},{key:"generate",value:function(t){var n=this.getAttributeName(t);return!0===t.hasGeometryAttribute(n)?WM(qM(e.prototype),"generate",this).call(this,t):t.generateConst(this.nodeType,new h.IUQ(1,1,1,1))}},{key:"serialize",value:function(t){WM(qM(e.prototype),"serialize",this).call(this,t),t.index=this.index}},{key:"deserialize",value:function(t){WM(qM(e.prototype),"deserialize",this).call(this,t),this.index=t.index}}])&&VM(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(Br);const JM=YM;var ZM=function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return yn(function(t,e,n){if(HM())return Reflect.construct.apply(null,arguments);var r=[null];r.push.apply(r,e);var i=new(t.bind.apply(t,r));return n&&XM(i,n.prototype),i}(YM,e))};function KM(t){return KM="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},KM(t)}function QM(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,$M(r.key),r)}}function $M(t){var e=function(t,e){if("object"!=KM(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=KM(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==KM(e)?e:e+""}function tE(t,e,n){return e=nE(e),function(t,e){if(e&&("object"===KM(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,eE()?Reflect.construct(e,n||[],nE(t).constructor):e.apply(t,n))}function eE(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(eE=function(){return!!t})()}function nE(t){return nE=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},nE(t)}function rE(t,e){return rE=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},rE(t,e)}z("VertexColorNode",YM);var iE=function(t){function e(t,n){var r,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(r=tE(this,e,[t,n,i])).renderer=i,r}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&rE(t,e)}(e,t),n=e,(r=[{key:"updateReference",value:function(t){return this.reference=null!==this.renderer?this.renderer:t.renderer,this.reference}}])&&QM(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(df);const oE=iE;var aE=function(t,e,n){return yn(new iE(t,e,n))};function sE(t){return sE="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},sE(t)}function uE(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,cE(r.key),r)}}function cE(t){var e=function(t,e){if("object"!=sE(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=sE(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==sE(e)?e:e+""}function lE(t,e,n){return e=hE(e),function(t,e){if(e&&("object"===sE(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,fE()?Reflect.construct(e,n||[],hE(t).constructor):e.apply(t,n))}function fE(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(fE=function(){return!!t})()}function hE(t){return hE=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},hE(t)}function pE(t,e){return pE=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},pE(t,e)}z("RendererReferenceNode",iE);var dE=1/6,mE=function(t){return Zs(dE,Zs(t,Zs(t,t.negate().add(3)).sub(3)).add(1))},yE=function(t){return Zs(dE,Zs(t,Zs(t,Zs(3,t).sub(6))).add(4))},vE=function(t){return Zs(dE,Zs(t,Zs(t,Zs(-3,t).add(3)).add(3)).add(1))},gE=function(t){return Zs(dE,gc(t,3))},bE=function(t){return mE(t).add(yE(t))},_E=function(t){return vE(t).add(gE(t))},xE=function(t){return Ys(-1,yE(t).div(mE(t).add(yE(t))))},wE=function(t){return Ys(1,gE(t).div(vE(t).add(gE(t))))},SE=function(t,e,n){var r=t.uvNode,i=Zs(r,e.zw).add(.5),o=Fu(i),a=Gu(i),s=bE(a.x),u=_E(a.x),c=xE(a.x),l=wE(a.x),f=xE(a.y),h=wE(a.y),p=Cn(o.x.add(c),o.y.add(f)).sub(.5).mul(e.xy),d=Cn(o.x.add(l),o.y.add(f)).sub(.5).mul(e.xy),m=Cn(o.x.add(c),o.y.add(h)).sub(.5).mul(e.xy),y=Cn(o.x.add(l),o.y.add(h)).sub(.5).mul(e.xy),v=bE(a.y).mul(Ys(s.mul(t.uv(p).level(n)),u.mul(t.uv(d).level(n)))),g=_E(a.y).mul(Ys(s.mul(t.uv(m).level(n)),u.mul(t.uv(y).level(n))));return v.add(g)},TE=function(t){function e(t){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:On(3);return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=lE(this,e,["vec4"])).textureNode=t,n.blurNode=r,n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&pE(t,e)}(e,t),n=e,(r=[{key:"setup",value:function(){return t=this.textureNode,e=this.blurNode,n=Cn(t.size(Pn(e))),r=Cn(t.size(Pn(e.add(1)))),i=Ks(1,n),o=Ks(1,r),a=SE(t,Fn(i,n),Fu(e)),s=SE(t,Fn(o,r),zu(e)),Gu(e).mix(a,s);var t,e,n,r,i,o,a,s}}])&&uE(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(Q);const ME=TE;var EE=bn(TE);function AE(t){return AE="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},AE(t)}function OE(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,PE(r.key),r)}}function PE(t){var e=function(t,e){if("object"!=AE(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=AE(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==AE(e)?e:e+""}function RE(t,e,n){return e=CE(e),function(t,e){if(e&&("object"===AE(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,kE()?Reflect.construct(e,n||[],CE(t).constructor):e.apply(t,n))}function kE(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(kE=function(){return!!t})()}function CE(t){return CE=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},CE(t)}function NE(t,e){return NE=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},NE(t,e)}Ce("bicubic",EE),z("TextureBicubicNode",TE);var LE=function(t){function e(){var t;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(t=RE(this,e,["vec2"])).isPointUVNode=!0,t}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&NE(t,e)}(e,t),n=e,(r=[{key:"generate",value:function(){return"vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y )"}}])&&OE(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(F);const jE=LE;var IE=_n(LE);function BE(t){return BE="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},BE(t)}function UE(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,DE(r.key),r)}}function DE(t){var e=function(t,e){if("object"!=BE(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=BE(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==BE(e)?e:e+""}function FE(t,e,n){return e=VE(e),function(t,e){if(e&&("object"===BE(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,zE()?Reflect.construct(e,n||[],VE(t).constructor):e.apply(t,n))}function zE(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(zE=function(){return!!t})()}function VE(t){return VE=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},VE(t)}function GE(t,e){return GE=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},GE(t,e)}z("PointUVNode",LE);var HE=function(t){function e(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e.BACKGROUND_BLURRINESS,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(t=FE(this,e)).scope=n,t.scene=r,t}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&GE(t,e)}(e,t),n=e,r=[{key:"setup",value:function(t){var n,r=this.scope,i=null!==this.scene?this.scene:t.scene;return r===e.BACKGROUND_BLURRINESS?n=mf("backgroundBlurriness","float",i):r===e.BACKGROUND_INTENSITY?n=mf("backgroundIntensity","float",i):console.error("THREE.SceneNode: Unknown scope:",r),n}}],r&&UE(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(F);HE.BACKGROUND_BLURRINESS="backgroundBlurriness",HE.BACKGROUND_INTENSITY="backgroundIntensity";const WE=HE;var qE=_n(HE,HE.BACKGROUND_BLURRINESS),XE=_n(HE,HE.BACKGROUND_INTENSITY);function YE(t){return YE="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},YE(t)}function JE(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,ZE(r.key),r)}}function ZE(t){var e=function(t,e){if("object"!=YE(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=YE(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==YE(e)?e:e+""}function KE(t,e,n){return e=tA(e),function(t,e){if(e&&("object"===YE(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,QE()?Reflect.construct(e,n||[],tA(t).constructor):e.apply(t,n))}function QE(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(QE=function(){return!!t})()}function $E(){return $E="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=tA(t)););return t}(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(arguments.length<3?t:n):i.value}},$E.apply(this,arguments)}function tA(t){return tA=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},tA(t)}function eA(t,e){return eA=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},eA(t,e)}z("SceneNode",HE);var nA=function(t){function e(t,n){var r,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(r=KE(this,e,[t,n,i])).isStorageBufferNode=!0,r.bufferObject=!1,r._attribute=null,r._varying=null,r}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&eA(t,e)}(e,t),n=e,r=[{key:"getInputType",value:function(){return"storageBuffer"}},{key:"element",value:function(t){return DT(this,t)}},{key:"setBufferObject",value:function(t){return this.bufferObject=t,this}},{key:"generate",value:function(t){if(t.isAvailable("storageBuffer"))return $E(tA(e.prototype),"generate",this).call(this,t);var n=this.getNodeType(t);null===this._attribute&&(this._attribute=ad(this.value),this._varying=Ar(this._attribute));var r=this._varying.build(t,n);return t.registerTransform(r,this._attribute),r}}],r&&JE(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(Bl);const rA=nA;var iA=function(t,e,n){return yn(new nA(t,e,n))},oA=function(t,e,n){return yn(new nA(t,e,n).setBufferObject(!0))};function aA(t){return aA="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},aA(t)}function sA(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,uA(r.key),r)}}function uA(t){var e=function(t,e){if("object"!=aA(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=aA(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==aA(e)?e:e+""}function cA(t,e,n){return e=hA(e),function(t,e){if(e&&("object"===aA(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,lA()?Reflect.construct(e,n||[],hA(t).constructor):e.apply(t,n))}function lA(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(lA=function(){return!!t})()}function fA(){return fA="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=hA(t)););return t}(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(arguments.length<3?t:n):i.value}},fA.apply(this,arguments)}function hA(t){return hA=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},hA(t)}function pA(t,e){return pA=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},pA(t,e)}z("StorageBufferNode",nA);var dA=function(t){function e(t,n){var r,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(r=cA(this,e,[t,n])).storeNode=i,r.isStoreTextureNode=!0,r}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&pA(t,e)}(e,t),n=e,r=[{key:"getInputType",value:function(){return"storageTexture"}},{key:"setup",value:function(t){fA(hA(e.prototype),"setup",this).call(this,t),t.getNodeProperties(this).storeNode=this.storeNode}},{key:"generate",value:function(t,n){return null!==this.storeNode?this.generateStore(t):fA(hA(e.prototype),"generate",this).call(this,t,n)}},{key:"generateStore",value:function(t){var n=t.getNodeProperties(this),r=n.uvNode,i=n.storeNode,o=fA(hA(e.prototype),"generate",this).call(this,t,"property"),a=r.build(t,"uvec2"),s=i.build(t,"vec4"),u=t.generateTextureStore(t,o,a,s);t.addLineFlowCode(u)}}],r&&sA(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(Ml);const mA=dA;var yA=bn(dA),vA=function(t,e,n){var r=yA(t,e,n);return null!==n&&r.append(),r};function gA(t){return gA="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},gA(t)}function bA(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,_A(r.key),r)}}function _A(t){var e=function(t,e){if("object"!=gA(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=gA(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==gA(e)?e:e+""}function xA(t,e,n){return e=TA(e),function(t,e){if(e&&("object"===gA(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,wA()?Reflect.construct(e,n||[],TA(t).constructor):e.apply(t,n))}function wA(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(wA=function(){return!!t})()}function SA(){return SA="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=TA(t)););return t}(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(arguments.length<3?t:n):i.value}},SA.apply(this,arguments)}function TA(t){return TA=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},TA(t)}function MA(t,e){return MA=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},MA(t,e)}z("TextureStoreNode",dA);var EA=function(t){function e(t,n){var r,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(r=xA(this,e,[t,n,i])).userData=i,r}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&MA(t,e)}(e,t),n=e,(r=[{key:"update",value:function(t){this.reference=null!==this.userData?this.userData:t.object.userData,SA(TA(e.prototype),"update",this).call(this,t)}}])&&bA(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(df);const AA=EA;var OA=function(t,e,n){return yn(new EA(t,e,n))};function PA(t){return PA="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},PA(t)}function RA(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,kA(r.key),r)}}function kA(t){var e=function(t,e){if("object"!=PA(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=PA(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==PA(e)?e:e+""}function CA(t,e,n){return e=LA(e),function(t,e){if(e&&("object"===PA(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,NA()?Reflect.construct(e,n||[],LA(t).constructor):e.apply(t,n))}function NA(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(NA=function(){return!!t})()}function LA(t){return LA=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},LA(t)}function jA(t,e){return jA=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},jA(t,e)}z("UserDataNode",EA);var IA=wn((function(t){var e=t.base,n=t.blend,r=function(t){return n[t].lessThan(Mu).cond(n[t],e[t].oneMinus().div(n[t]).oneMinus().max(0))};return In(r("x"),r("y"),r("z"))})).setLayout({name:"burnColor",type:"vec3",inputs:[{name:"base",type:"vec3"},{name:"blend",type:"vec3"}]}),BA=wn((function(t){var e=t.base,n=t.blend,r=function(t){return n[t].equal(1).cond(n[t],e[t].div(n[t].oneMinus()).max(0))};return In(r("x"),r("y"),r("z"))})).setLayout({name:"dodgeColor",type:"vec3",inputs:[{name:"base",type:"vec3"},{name:"blend",type:"vec3"}]}),UA=wn((function(t){var e=t.base,n=t.blend,r=function(t){return e[t].oneMinus().mul(n[t].oneMinus()).oneMinus()};return In(r("x"),r("y"),r("z"))})).setLayout({name:"screenColor",type:"vec3",inputs:[{name:"base",type:"vec3"},{name:"blend",type:"vec3"}]}),DA=wn((function(t){var e=t.base,n=t.blend,r=function(t){return e[t].lessThan(.5).cond(e[t].mul(n[t],2),e[t].oneMinus().mul(n[t].oneMinus()).oneMinus())};return In(r("x"),r("y"),r("z"))})).setLayout({name:"overlayColor",type:"vec3",inputs:[{name:"base",type:"vec3"},{name:"blend",type:"vec3"}]}),FA=function(t){function e(t,n,r){var i;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(i=CA(this,e)).blendMode=t,i.baseNode=n,i.blendNode=r,i}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&jA(t,e)}(e,t),n=e,(r=[{key:"setup",value:function(){var t=this.blendMode,n={base:this.baseNode,blend:this.blendNode},r=null;return t===e.BURN?r=IA(n):t===e.DODGE?r=BA(n):t===e.SCREEN?r=UA(n):t===e.OVERLAY&&(r=DA(n)),r}}])&&RA(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(Q);FA.BURN="burn",FA.DODGE="dodge",FA.SCREEN="screen",FA.OVERLAY="overlay";const zA=FA;var VA=bn(FA,FA.BURN),GA=bn(FA,FA.DODGE),HA=bn(FA,FA.OVERLAY),WA=bn(FA,FA.SCREEN);function qA(t){return qA="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},qA(t)}function XA(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,YA(r.key),r)}}function YA(t){var e=function(t,e){if("object"!=qA(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=qA(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==qA(e)?e:e+""}function JA(t,e,n){return e=KA(e),function(t,e){if(e&&("object"===qA(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,ZA()?Reflect.construct(e,n||[],KA(t).constructor):e.apply(t,n))}function ZA(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(ZA=function(){return!!t})()}function KA(t){return KA=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},KA(t)}function QA(t,e){return QA=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},QA(t,e)}Ce("burn",VA),Ce("dodge",GA),Ce("overlay",HA),Ce("screen",WA),z("BlendModeNode",FA);var $A=wn((function(t){var e=t.textureNode,n=t.bumpScale,r=e;if(!0!==r.isTextureNode&&r.traverse((function(t){!0===t.isTextureNode&&(r=t)})),!0!==r.isTextureNode)throw new Error("THREE.TSL: dHdxy_fwd() requires a TextureNode.");var i=On(e),o=r.uvNode||Os(),a=function(t){return e.cache().context({getUV:function(){return t},forceUVContext:!0})};return Cn(On(a(o.add(o.dFdx()))).sub(i),On(a(o.add(o.dFdy()))).sub(i)).mul(n)})),tO=wn((function(t){var e=t.surf_pos,n=t.surf_norm,r=t.dHdxy,i=e.dFdx().normalize(),o=n,a=e.dFdy().normalize().cross(o),s=o.cross(i),u=i.dot(a).mul(bb),c=u.sign().mul(r.x.mul(a).add(r.y.mul(s)));return u.abs().mul(n).sub(c).normalize()})),eO=function(t){function e(t){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=JA(this,e,["vec3"])).textureNode=t,n.scaleNode=r,n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&QA(t,e)}(e,t),n=e,(r=[{key:"setup",value:function(){var t=null!==this.scaleNode?this.scaleNode:1,e=$A({textureNode:this.textureNode,bumpScale:t});return tO({surf_pos:Dp,surf_norm:Uh,dHdxy:e})}}])&&XA(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(Q);const nO=eO;var rO=bn(eO);function iO(t){return iO="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},iO(t)}function oO(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,aO(r.key),r)}}function aO(t){var e=function(t,e){if("object"!=iO(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=iO(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==iO(e)?e:e+""}function sO(t,e,n){return e=cO(e),function(t,e){if(e&&("object"===iO(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,uO()?Reflect.construct(e,n||[],cO(t).constructor):e.apply(t,n))}function uO(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(uO=function(){return!!t})()}function cO(t){return cO=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},cO(t)}function lO(t,e){return lO=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},lO(t,e)}Ce("bumpMap",rO),z("BumpMapNode",eO);var fO=wn((function(t){var e=t.color;return t.adjustment.mix(_O(e.rgb),e.rgb)})),hO=wn((function(t){var e=t.color,n=t.adjustment,r=Ys(e.r,e.g,e.b).div(3),i=e.r.max(e.g.max(e.b)),o=i.sub(r).mul(n).mul(-3);return Mc(e.rgb,i,o)})),pO=wn((function(t){var e=t.color,n=t.adjustment,r=In(.57735,.57735,.57735),i=n.cos();return In(e.rgb.mul(i).add(r.cross(e.rgb).mul(n.sin()).add(r.mul(yc(r,e.rgb).mul(i.oneMinus())))))})),dO=function(t){function e(t,n){var r,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:On(1);return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(r=sO(this,e,["vec3"])).method=t,r.colorNode=n,r.adjustmentNode=i,r}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&lO(t,e)}(e,t),n=e,(r=[{key:"setup",value:function(){var t=this.method,n={color:this.colorNode,adjustment:this.adjustmentNode},r=null;return t===e.SATURATION?r=fO(n):t===e.VIBRANCE?r=hO(n):t===e.HUE?r=pO(n):console.error("".concat(this.type,': Method "').concat(this.method,'" not supported!')),r}}])&&oO(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(Q);dO.SATURATION="saturation",dO.VIBRANCE="vibrance",dO.HUE="hue";const mO=dO;var yO=bn(dO,dO.SATURATION),vO=bn(dO,dO.VIBRANCE),gO=bn(dO,dO.HUE),bO=In(.2125,.7154,.0721),_O=function(t){return yc(t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:bO)},xO=function(t,e){return Mc(In(0),t,_O(t).sub(e).max(0))};function wO(t){return wO="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},wO(t)}function SO(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,TO(r.key),r)}}function TO(t){var e=function(t,e){if("object"!=wO(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=wO(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==wO(e)?e:e+""}function MO(t,e,n){return e=AO(e),function(t,e){if(e&&("object"===wO(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,EO()?Reflect.construct(e,n||[],AO(t).constructor):e.apply(t,n))}function EO(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(EO=function(){return!!t})()}function AO(t){return AO=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},AO(t)}function OO(t,e){return OO=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},OO(t,e)}Ce("saturation",yO),Ce("vibrance",vO),Ce("hue",gO),Ce("threshold",xO),z("ColorAdjustmentNode",dO);var PO=wn((function(t){var e=t.eye_pos,n=t.surf_norm,r=t.mapN,i=t.uv,o=e.dFdx(),a=e.dFdy(),s=i.dFdx(),u=i.dFdy(),c=n,l=a.cross(c),f=c.cross(o),h=l.mul(s.x).add(f.mul(u.x)),p=l.mul(s.y).add(f.mul(u.y)),d=h.dot(h).max(p.dot(p)),m=bb.mul(d.inverseSqrt());return Ys(h.mul(r.x,m),p.mul(r.y,m),c.mul(r.z)).normalize()})),RO=function(t){function e(t){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=MO(this,e,["vec3"])).node=t,n.scaleNode=r,n.normalMapType=h.bI3,n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&OO(t,e)}(e,t),n=e,r=[{key:"setup",value:function(t){var e=this.normalMapType,n=this.scaleNode,r=this.node.mul(2).sub(1);null!==n&&(r=In(r.xy.mul(n),r.z));var i=null;return e===h.vyJ?i=xh.mul(r).normalize():e===h.bI3&&(i=!0===t.hasGeometryAttribute("tangent")?UM.mul(r).normalize():PO({eye_pos:Dp,surf_norm:Uh,mapN:r,uv:Os()})),i}}],r&&SO(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(Q);const kO=RO;var CO=bn(RO);function NO(t){return NO="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},NO(t)}function LO(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,jO(r.key),r)}}function jO(t){var e=function(t,e){if("object"!=NO(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=NO(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==NO(e)?e:e+""}function IO(t,e,n){return e=UO(e),function(t,e){if(e&&("object"===NO(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,BO()?Reflect.construct(e,n||[],UO(t).constructor):e.apply(t,n))}function BO(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(BO=function(){return!!t})()}function UO(t){return UO=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},UO(t)}function DO(t,e){return DO=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},DO(t,e)}Ce("normalMap",CO),z("NormalMapNode",RO);var FO=function(t){function e(t,n){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(r=IO(this,e)).sourceNode=t,r.stepsNode=n,r}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&DO(t,e)}(e,t),n=e,(r=[{key:"setup",value:function(){var t=this.sourceNode,e=this.stepsNode;return t.mul(e).floor().div(e)}}])&&LO(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(Q);const zO=FO;var VO=bn(FO);function GO(t){return GO="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},GO(t)}function HO(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,KO(r.key),r)}}function WO(t,e,n){return e=YO(e),function(t,e){if(e&&("object"===GO(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,qO()?Reflect.construct(e,n||[],YO(t).constructor):e.apply(t,n))}function qO(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(qO=function(){return!!t})()}function XO(){return XO="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=YO(t)););return t}(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(arguments.length<3?t:n):i.value}},XO.apply(this,arguments)}function YO(t){return YO=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},YO(t)}function JO(t,e){return JO=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},JO(t,e)}function ZO(t,e,n){return(e=KO(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function KO(t){var e=function(t,e){if("object"!=GO(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=GO(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==GO(e)?e:e+""}function QO(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}Ce("posterize",VO),z("PosterizeNode",FO);var $O=wn((function(t){var e=t.color,n=t.exposure;return e.mul(n).clamp()})),tP=wn((function(t){var e=t.color,n=t.exposure;return(e=e.mul(n)).div(e.add(1)).clamp()})),eP=wn((function(t){var e=t.color,n=t.exposure,r=(e=(e=e.mul(n)).sub(.004).max(0)).mul(e.mul(6.2).add(.5)),i=e.mul(e.mul(6.2).add(1.7)).add(.06);return r.div(i).pow(2.2)})),nP=wn((function(t){var e=t.color,n=e.mul(e.add(.0245786)).sub(90537e-9),r=e.mul(e.add(.432951).mul(.983729)).add(.238081);return n.div(r)})),rP=wn((function(t){var e=t.color,n=t.exposure,r=Yn(.59719,.35458,.04823,.076,.90834,.01566,.0284,.13383,.83777),i=Yn(1.60475,-.53108,-.07367,-.10208,1.10813,-.00605,-.00327,-.07276,1.07602);return e=e.mul(n).div(.6),e=r.mul(e),e=nP({color:e}),(e=i.mul(e)).clamp()})),iP=Yn(In(1.6605,-.1246,-.0182),In(-.5876,1.1329,-.1006),In(-.0728,-.0083,1.1187)),oP=Yn(In(.6274,.0691,.0164),In(.3293,.9195,.088),In(.0433,.0113,.8956)),aP=wn((function(t){var e,n,r=(e=t,n=1,function(t){if(Array.isArray(t))return t}(e)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,i,o,a,s=[],u=!0,c=!1;try{if(o=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=o.call(n)).done)&&(s.push(r.value),s.length!==e);u=!0);}catch(t){c=!0,i=t}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw i}}return s}}(e,n)||function(t,e){if(t){if("string"==typeof t)return QO(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?QO(t,e):void 0}}(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}())[0],i=In(r).toVar(),o=In(i.mul(i)).toVar(),a=In(o.mul(o)).toVar();return On(15.5).mul(a.mul(o)).sub(Zs(40.14,a.mul(i))).add(Zs(31.96,a).sub(Zs(6.868,o.mul(i))).add(Zs(.4298,o).add(Zs(.1191,i).sub(.00232))))})),sP=wn((function(t){var e=t.color,n=t.exposure,r=In(e).toVar(),i=Yn(In(.856627153315983,.137318972929847,.11189821299995),In(.0951212405381588,.761241990602591,.0767994186031903),In(.0482516061458583,.101439036467562,.811302368396859)),o=Yn(In(1.1271005818144368,-.1413297634984383,-.14132976349843826),In(-.11060664309660323,1.157823702216272,-.11060664309660294),In(-.016493938717834573,-.016493938717834257,1.2519364065950405)),a=On(-12.47393),s=On(4.026069);return r.mulAssign(n),r.assign(oP.mul(r)),r.assign(i.mul(r)),r.assign(lc(r,1e-10)),r.assign(Bu(r)),r.assign(r.sub(a).div(s.sub(a))),r.assign(Ec(r,0,1)),r.assign(aP(r)),r.assign(o.mul(r)),r.assign(gc(lc(In(0),r),In(2.2))),r.assign(iP.mul(r)),r.assign(Ec(r,0,1)),r})),uP=ZO(ZO(ZO(ZO(ZO({},h.kyO,$O),h.Mjd,tP),h.nNL,eP),h.FV,rP),h.LAk,sP),cP=function(t){function e(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:h.y_p,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:hP,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(t=WO(this,e,["vec3"])).toneMapping=n,t.exposureNode=r,t.colorNode=i,t}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&JO(t,e)}(e,t),n=e,r=[{key:"getCacheKey",value:function(){var t=XO(YO(e.prototype),"getCacheKey",this).call(this);return"{toneMapping:"+this.toneMapping+",nodes:"+t+"}"}},{key:"setup",value:function(t){var e=this.colorNode||t.context.color,n=this.toneMapping;if(n===h.y_p)return e;var r={exposure:this.exposureNode,color:e},i=uP[n],o=null;return i?o=i(r):(console.error("ToneMappingNode: Unsupported Tone Mapping configuration.",n),o=e),o}}],r&&HO(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(Q);const lP=cP;var fP=function(t,e,n){return yn(new cP(t,yn(e),yn(n)))},hP=aE("toneMappingExposure","float");function pP(t){return pP="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},pP(t)}function dP(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,mP(r.key),r)}}function mP(t){var e=function(t,e){if("object"!=pP(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=pP(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==pP(e)?e:e+""}function yP(t,e,n){return e=gP(e),function(t,e){if(e&&("object"===pP(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,vP()?Reflect.construct(e,n||[],gP(t).constructor):e.apply(t,n))}function vP(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(vP=function(){return!!t})()}function gP(t){return gP=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},gP(t)}function bP(t,e){return bP=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},bP(t,e)}Ce("toneMapping",(function(t,e,n){return fP(e,n,t)})),z("ToneMappingNode",cP);var _P=null,xP=function(t){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:fg,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),null===_P&&(_P=new h.Pem),yP(this,e,[t,n,_P])}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&bP(t,e)}(e,t),n=e,(r=[{key:"updateReference",value:function(){return this}}])&&dP(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(Tg);const wP=xP;var SP=bn(xP);function TP(t){return TP="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},TP(t)}function MP(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function EP(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,OP(r.key),r)}}function AP(t,e,n){return e&&EP(t.prototype,e),n&&EP(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function OP(t){var e=function(t,e){if("object"!=TP(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=TP(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==TP(e)?e:e+""}function PP(t,e,n){return e=CP(e),function(t,e){if(e&&("object"===TP(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,RP()?Reflect.construct(e,n||[],CP(t).constructor):e.apply(t,n))}function RP(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(RP=function(){return!!t})()}function kP(){return kP="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=CP(t)););return t}(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(arguments.length<3?t:n):i.value}},kP.apply(this,arguments)}function CP(t){return CP=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},CP(t)}function NP(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&LP(t,e)}function LP(t,e){return LP=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},LP(t,e)}Ce("viewportSharedTexture",SP),z("ViewportSharedTextureNode",xP);var jP=function(t){function e(t,n){var r;return MP(this,e),(r=PP(this,e,[n])).passNode=t,r.setUpdateMatrix(!1),r}return NP(e,t),AP(e,[{key:"setup",value:function(t){return this.passNode.build(t),kP(CP(e.prototype),"setup",this).call(this,t)}},{key:"clone",value:function(){return new this.constructor(this.passNode,this.value)}}])}(Ml),IP=function(t){function e(t,n,r){var i;MP(this,e),(i=PP(this,e,["vec4"])).scope=t,i.scene=n,i.camera=r,i._pixelRatio=1,i._width=1,i._height=1;var o=new h.VCu;o.isRenderTargetTexture=!0,o.name="PostProcessingDepth";var s=new h.O0B(i._width*i._pixelRatio,i._height*i._pixelRatio,{type:h.ix0});return s.texture.name="PostProcessing",s.depthTexture=o,i.renderTarget=s,i.updateBeforeType=a.FRAME,i._textureNode=yn(new jP(i,s.texture)),i._depthTextureNode=yn(new jP(i,o)),i._depthNode=null,i._viewZNode=null,i._cameraNear=gs(0),i._cameraFar=gs(0),i.isPassNode=!0,i}return NP(e,t),AP(e,[{key:"isGlobal",value:function(){return!0}},{key:"getTextureNode",value:function(){return this._textureNode}},{key:"getTextureDepthNode",value:function(){return this._depthTextureNode}},{key:"getViewZNode",value:function(){if(null===this._viewZNode){var t=this._cameraNear,e=this._cameraFar;this._viewZNode=Yg(this._depthTextureNode,t,e)}return this._viewZNode}},{key:"getDepthNode",value:function(){if(null===this._depthNode){var t=this._cameraNear,e=this._cameraFar;this._depthNode=Wg(this.getViewZNode(),t,e)}return this._depthNode}},{key:"setup",value:function(){return this.scope===e.COLOR?this.getTextureNode():this.getDepthNode()}},{key:"updateBefore",value:function(t){var e=t.renderer,n=this.scene,r=this.camera;this._pixelRatio=e.getPixelRatio();var i=e.getSize(new h.I9Y);this.setSize(i.width,i.height);var o=e.toneMapping,a=e.toneMappingNode,s=e.getRenderTarget();this._cameraNear.value=r.near,this._cameraFar.value=r.far,e.toneMapping=h.y_p,e.toneMappingNode=null,e.setRenderTarget(this.renderTarget),e.render(n,r),e.toneMapping=o,e.toneMappingNode=a,e.setRenderTarget(s)}},{key:"setSize",value:function(t,e){this._width=t,this._height=e;var n=this._width*this._pixelRatio,r=this._height*this._pixelRatio;this.renderTarget.setSize(n,r)}},{key:"setPixelRatio",value:function(t){this._pixelRatio=t,this.setSize(this._width,this._height)}},{key:"dispose",value:function(){this.renderTarget.dispose()}}])}(Q);IP.COLOR="color",IP.DEPTH="depth";const BP=IP;var UP=function(t,e){return yn(new IP(IP.COLOR,t,e))},DP=function(t,e){return yn(new jP(t,e))},FP=function(t,e){return yn(new IP(IP.DEPTH,t,e))};function zP(t){return zP="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},zP(t)}function VP(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,HP(r.key),r)}}function GP(t,e,n){return e&&VP(t.prototype,e),n&&VP(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function HP(t){var e=function(t,e){if("object"!=zP(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=zP(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==zP(e)?e:e+""}function WP(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function qP(t,e,n){return e=YP(e),function(t,e){if(e&&("object"===zP(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,XP()?Reflect.construct(e,n||[],YP(t).constructor):e.apply(t,n))}function XP(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(XP=function(){return!!t})()}function YP(t){return YP=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},YP(t)}function JP(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&ZP(t,e)}function ZP(t,e){return ZP=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},ZP(t,e)}z("PassNode",IP);var KP=new h.qUd(-1,1,1,-1,0,1),QP=function(t){function e(){var t,n=arguments.length>0&&void 0!==arguments[0]&&arguments[0];WP(this,e);var r=!1===n?[0,-1,0,1,2,1]:[0,2,0,0,2,0];return(t=qP(this,e)).setAttribute("position",new h.qtW([-1,3,0,-1,-1,0,3,-1,0],3)),t.setAttribute("uv",new h.qtW(r,2)),t}return JP(e,t),GP(e)}(h.LoY),$P=new QP;const tR=function(t){function e(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return WP(this,e),(t=qP(this,e,[$P,n])).camera=KP,t}return JP(e,t),GP(e,[{key:"renderAsync",value:function(t){return t.renderAsync(this,KP)}},{key:"render",value:function(t){t.render(this,KP)}}])}(h.eaF);function eR(t){return eR="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},eR(t)}function nR(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,rR(r.key),r)}}function rR(t){var e=function(t,e){if("object"!=eR(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=eR(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==eR(e)?e:e+""}function iR(t,e,n){return e=aR(e),function(t,e){if(e&&("object"===eR(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,oR()?Reflect.construct(e,n||[],aR(t).constructor):e.apply(t,n))}function oR(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(oR=function(){return!!t})()}function aR(t){return aR=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},aR(t)}function sR(t,e){return sR=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},sR(t,e)}var uR=new tR,cR=new tR,lR=function(t){function e(t){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=iR(this,e,["vec4"])).textureNode=t,n.sigma=r,n.directionNode=Cn(1),n._invSize=gs(new h.I9Y),n._passDirection=gs(new h.I9Y),n._horizontalRT=new h.O0B,n._horizontalRT.texture.name="GaussianBlurNode.horizontal",n._verticalRT=new h.O0B,n._verticalRT.texture.name="GaussianBlurNode.vertical",n._textureNode=DP(n,n._verticalRT.texture),n.updateBeforeType=a.RENDER,n.resolution=new h.I9Y(1,1),n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&sR(t,e)}(e,t),n=e,r=[{key:"setSize",value:function(t,e){t=Math.max(Math.round(t*this.resolution.x),1),e=Math.max(Math.round(e*this.resolution.y),1),this._invSize.value.set(1/t,1/e),this._horizontalRT.setSize(t,e),this._verticalRT.setSize(t,e)}},{key:"updateBefore",value:function(t){var e=t.renderer,n=this.textureNode,r=n.value,i=e.getRenderTarget(),o=n.value;uR.material=this._material,cR.material=this._material,this.setSize(r.image.width,r.image.height);var a=r.type;this._horizontalRT.texture.type=a,this._verticalRT.texture.type=a,e.setRenderTarget(this._horizontalRT),this._passDirection.value.set(1,0),uR.render(e),n.value=this._horizontalRT.texture,e.setRenderTarget(this._verticalRT),this._passDirection.value.set(0,1),cR.render(e),e.setRenderTarget(i),n.value=o}},{key:"getTextureNode",value:function(){return this._textureNode}},{key:"setup",value:function(t){var e=this,n=this.textureNode;if(!0!==n.isTextureNode)return console.error("GaussianBlurNode requires a TextureNode."),Fn();var r=n.uvNode||Os(),i=function(t){return n.cache().context({getUV:function(){return t},forceUVContext:!0})},o=wn((function(){for(var t=3+2*e.sigma,n=e._getCoefficients(t),o=e._invSize,a=Cn(e.directionNode).mul(e._passDirection),s=On(n[0]).toVar(),u=Fn(i(r).mul(s)).toVar(),c=1;c<t;c++){var l=On(c),f=On(n[c]),h=Cn(a.mul(o.mul(l))).toVar(),p=Fn(i(r.add(h))),d=Fn(i(r.sub(h)));u.addAssign(p.add(d).mul(f)),s.addAssign(Zs(2,f))}return u.div(s)}));return(this._material||(this._material=t.createNodeMaterial())).fragmentNode=o(),t.getNodeProperties(this).textureNode=n,this._textureNode}},{key:"_getCoefficients",value:function(t){for(var e=[],n=0;n<t;n++)e.push(.39894*Math.exp(-.5*n*n/(t*t))/t);return e}}],r&&nR(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(Q),fR=function(t,e){return yn(new lR(yn(t),e))};Ce("gaussianBlur",fR);const hR=lR;function pR(t){return pR="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},pR(t)}function dR(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function mR(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,yR(r.key),r)}}function yR(t){var e=function(t,e){if("object"!=pR(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=pR(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==pR(e)?e:e+""}function vR(t,e,n){return e=bR(e),function(t,e){if(e&&("object"===pR(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,gR()?Reflect.construct(e,n||[],bR(t).constructor):e.apply(t,n))}function gR(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(gR=function(){return!!t})()}function bR(t){return bR=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},bR(t)}function _R(t,e){return _R=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},_R(t,e)}var xR=new tR,wR=function(t){function e(t){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.96;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=vR(this,e,[t])).textureNode=t,n.textureNodeOld=El(),n.damp=gs(r),n._compRT=new h.O0B,n._compRT.texture.name="AfterImageNode.comp",n._oldRT=new h.O0B,n._oldRT.texture.name="AfterImageNode.old",n._textureNode=DP(n,n._compRT.texture),n.updateBeforeType=a.RENDER,n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&_R(t,e)}(e,t),n=e,r=[{key:"getTextureNode",value:function(){return this._textureNode}},{key:"setSize",value:function(t,e){this._compRT.setSize(t,e),this._oldRT.setSize(t,e)}},{key:"updateBefore",value:function(t){var e=t.renderer,n=this.textureNode,r=n.value,i=r.type;this._compRT.texture.type=i,this._oldRT.texture.type=i;var o=e.getRenderTarget(),a=n.value;this.textureNodeOld.value=this._oldRT.texture,e.setRenderTarget(this._compRT),xR.render(e);var s=this._oldRT;this._oldRT=this._compRT,this._compRT=s,this.setSize(r.image.width,r.image.height),e.setRenderTarget(o),n.value=a}},{key:"setup",value:function(t){var e=this,n=this.textureNode,r=this.textureNodeOld;if(!0!==n.isTextureNode)return console.error("AfterImageNode requires a TextureNode."),Fn();var i=n.uvNode||Os();r.uvNode=i;var o=wn((function(t){var e,n,r=(n=2,function(t){if(Array.isArray(t))return t}(e=t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,i,o,a,s=[],u=!0,c=!1;try{if(o=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=o.call(n)).done)&&(s.push(r.value),s.length!==e);u=!0);}catch(t){c=!0,i=t}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw i}}return s}}(e,n)||function(t,e){if(t){if("string"==typeof t)return dR(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?dR(t,e):void 0}}(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),i=r[0],o=r[1],a=On(o).toVar(),s=Fn(i).toVar();return lc(Ku(s.sub(a)),0)})),a=wn((function(){var t=Fn(r),a=Fn(function(t){return n.cache().context({getUV:function(){return t},forceUVContext:!0})}(i));return t.mulAssign(e.damp.mul(o(t,.1))),lc(a,t)})),s=this._materialComposed||(this._materialComposed=t.createNodeMaterial());return s.fragmentNode=a(),xR.material=s,t.getNodeProperties(this).textureNode=n,this._textureNode}}],r&&mR(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(Q),SR=function(t,e){return yn(new wR(yn(t),e))};Ce("afterImage",SR);const TR=wR;function MR(t){return MR="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},MR(t)}function ER(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,AR(r.key),r)}}function AR(t){var e=function(t,e){if("object"!=MR(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=MR(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==MR(e)?e:e+""}function OR(t,e,n){return e=RR(e),function(t,e){if(e&&("object"===MR(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,PR()?Reflect.construct(e,n||[],RR(t).constructor):e.apply(t,n))}function PR(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(PR=function(){return!!t})()}function RR(t){return RR=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},RR(t)}function kR(t,e){return kR=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},kR(t,e)}var CR=new tR,NR=function(t){function e(t,n,r,i){var o;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(o=OR(this,e,["vec4"])).textureNode=t,o.tresholdNode=n,o.scaleNode=r,o.colorNode=In(.1,0,1),o.samples=i,o.resolution=new h.I9Y(1,1),o._renderTarget=new h.O0B,o._renderTarget.texture.name="anamorphic",o._invSize=gs(new h.I9Y),o._textureNode=DP(o,o._renderTarget.texture),o.updateBeforeType=a.RENDER,o}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&kR(t,e)}(e,t),n=e,r=[{key:"getTextureNode",value:function(){return this._textureNode}},{key:"setSize",value:function(t,e){this._invSize.value.set(1/t,1/e),t=Math.max(Math.round(t*this.resolution.x),1),e=Math.max(Math.round(e*this.resolution.y),1),this._renderTarget.setSize(t,e)}},{key:"updateBefore",value:function(t){var e=t.renderer,n=this.textureNode,r=n.value;this._renderTarget.texture.type=r.type;var i=e.getRenderTarget(),o=n.value;CR.material=this._material,this.setSize(r.image.width,r.image.height),e.setRenderTarget(this._renderTarget),CR.render(e),e.setRenderTarget(i),n.value=o}},{key:"setup",value:function(t){var e=this,n=this.textureNode;if(!0!==n.isTextureNode)return console.error("AnamorphNode requires a TextureNode."),Fn();var r=n.uvNode||Os(),i=wn((function(){var t=e.samples,i=Math.floor(t/2),o=In(0).toVar();return fm({start:-i,end:i},(function(t){var a=t.i,s=On(a).abs().div(i).oneMinus(),u=function(t){return n.cache().context({getUV:function(){return t},forceUVContext:!0})}(Cn(r.x.add(e._invSize.x.mul(a).mul(e.scaleNode)),r.y)),c=xO(u,e.tresholdNode).mul(s);o.addAssign(c)})),o.mul(e.colorNode)}));return(this._material||(this._material=t.createNodeMaterial())).fragmentNode=i(),t.getNodeProperties(this).textureNode=n,this._textureNode}}],r&&ER(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(Q),LR=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.9,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:32;return yn(new NR(yn(t),yn(e),yn(n),r))};Ce("anamorphic",LR);const jR=NR;function IR(t){return IR="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},IR(t)}function BR(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function UR(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,DR(r.key),r)}}function DR(t){var e=function(t,e){if("object"!=IR(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=IR(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==IR(e)?e:e+""}function FR(t,e,n){return e=VR(e),function(t,e){if(e&&("object"===IR(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,zR()?Reflect.construct(e,n||[],VR(t).constructor):e.apply(t,n))}function zR(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(zR=function(){return!!t})()}function VR(t){return VR=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},VR(t)}function GR(t,e){return GR=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},GR(t,e)}var HR=function(t){function e(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(t=FR(this,e)).functionNode=n,t.parameters=r,t}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&GR(t,e)}(e,t),n=e,(r=[{key:"setParameters",value:function(t){return this.parameters=t,this}},{key:"getParameters",value:function(){return this.parameters}},{key:"getNodeType",value:function(t){return this.functionNode.getNodeType(t)}},{key:"generate",value:function(t){var e=[],n=this.functionNode,r=n.getInputs(t),i=this.parameters;if(Array.isArray(i))for(var o=0;o<i.length;o++){var a=r[o],s=i[o];e.push(s.build(t,a.type))}else{var u,c=function(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return BR(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?BR(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}(r);try{for(c.s();!(u=c.n()).done;){var l=u.value,f=i[l.name];if(void 0===f)throw new Error("FunctionCallNode: Input '".concat(l.name,"' not found in FunctionNode."));e.push(f.build(t,l.type))}}catch(t){c.e(t)}finally{c.f()}}var h=n.build(t,"property");return"".concat(h,"( ").concat(e.join(", ")," )")}}])&&UR(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(Q);const WR=HR;var qR=function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return n=n.length>1||n[0]&&!0===n[0].isNode?gn(n):vn(n[0]),yn(new HR(yn(t),n))};function XR(t){return XR="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},XR(t)}function YR(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,JR(r.key),r)}}function JR(t){var e=function(t,e){if("object"!=XR(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=XR(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==XR(e)?e:e+""}function ZR(t,e,n){return e=$R(e),function(t,e){if(e&&("object"===XR(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,KR()?Reflect.construct(e,n||[],$R(t).constructor):e.apply(t,n))}function KR(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(KR=function(){return!!t})()}function QR(){return QR="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=$R(t)););return t}(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(arguments.length<3?t:n):i.value}},QR.apply(this,arguments)}function $R(t){return $R=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},$R(t)}function tk(t,e){return tk=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},tk(t,e)}Ce("call",qR),z("FunctionCallNode",HR);var ek=function(t){function e(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(t=ZR(this,e))._value=n,t._cache=null,t.inputType=null,t.outpuType=null,t.events=new h.Qev,t.isScriptableValueNode=!0,t}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&tk(t,e)}(e,t),n=e,(r=[{key:"isScriptableOutputNode",get:function(){return null!==this.outputType}},{key:"value",get:function(){return this._value},set:function(t){this._value!==t&&(this._cache&&"URL"===this.inputType&&this.value.value instanceof ArrayBuffer&&(URL.revokeObjectURL(this._cache),this._cache=null),this._value=t,this.events.dispatchEvent({type:"change"}),this.refresh())}},{key:"refresh",value:function(){this.events.dispatchEvent({type:"refresh"})}},{key:"getValue",value:function(){var t=this.value;if(t&&null===this._cache&&"URL"===this.inputType&&t.value instanceof ArrayBuffer)this._cache=URL.createObjectURL(new Blob([t.value]));else if(t&&null!==t.value&&void 0!==t.value&&(("URL"===this.inputType||"String"===this.inputType)&&"string"==typeof t.value||"Number"===this.inputType&&"number"==typeof t.value||"Vector2"===this.inputType&&t.value.isVector2||"Vector3"===this.inputType&&t.value.isVector3||"Vector4"===this.inputType&&t.value.isVector4||"Color"===this.inputType&&t.value.isColor||"Matrix3"===this.inputType&&t.value.isMatrix3||"Matrix4"===this.inputType&&t.value.isMatrix4))return t.value;return this._cache||t}},{key:"getNodeType",value:function(t){return this.value&&this.value.isNode?this.value.getNodeType(t):"float"}},{key:"setup",value:function(){return this.value&&this.value.isNode?this.value:On()}},{key:"serialize",value:function(t){QR($R(e.prototype),"serialize",this).call(this,t),null!==this.value?"ArrayBuffer"===this.inputType?t.value=M(this.value):t.value=this.value?this.value.toJSON(t.meta).uuid:null:t.value=null,t.inputType=this.inputType,t.outputType=this.outputType}},{key:"deserialize",value:function(t){QR($R(e.prototype),"deserialize",this).call(this,t);var n=null;null!==t.value&&(n="ArrayBuffer"===t.inputType?E(t.value):"Texture"===t.inputType?t.meta.textures[t.value]:t.meta.nodes[t.value]||null),this.value=n,this.inputType=t.inputType,this.outputType=t.outputType}}])&&YR(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(F);const nk=ek;var rk=bn(ek);function ik(t){return ik="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ik(t)}function ok(){ok=function(){return e};var t,e={},n=Object.prototype,r=n.hasOwnProperty,i=Object.defineProperty||function(t,e,n){t[e]=n.value},o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",s=o.asyncIterator||"@@asyncIterator",u=o.toStringTag||"@@toStringTag";function c(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{c({},"")}catch(t){c=function(t,e,n){return t[e]=n}}function l(t,e,n,r){var o=e&&e.prototype instanceof v?e:v,a=Object.create(o.prototype),s=new R(r||[]);return i(a,"_invoke",{value:E(t,n,s)}),a}function f(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var h="suspendedStart",p="suspendedYield",d="executing",m="completed",y={};function v(){}function g(){}function b(){}var _={};c(_,a,(function(){return this}));var x=Object.getPrototypeOf,w=x&&x(x(k([])));w&&w!==n&&r.call(w,a)&&(_=w);var S=b.prototype=v.prototype=Object.create(_);function T(t){["next","throw","return"].forEach((function(e){c(t,e,(function(t){return this._invoke(e,t)}))}))}function M(t,e){function n(i,o,a,s){var u=f(t[i],t,o);if("throw"!==u.type){var c=u.arg,l=c.value;return l&&"object"==ik(l)&&r.call(l,"__await")?e.resolve(l.__await).then((function(t){n("next",t,a,s)}),(function(t){n("throw",t,a,s)})):e.resolve(l).then((function(t){c.value=t,a(c)}),(function(t){return n("throw",t,a,s)}))}s(u.arg)}var o;i(this,"_invoke",{value:function(t,r){function i(){return new e((function(e,i){n(t,r,e,i)}))}return o=o?o.then(i,i):i()}})}function E(e,n,r){var i=h;return function(o,a){if(i===d)throw Error("Generator is already running");if(i===m){if("throw"===o)throw a;return{value:t,done:!0}}for(r.method=o,r.arg=a;;){var s=r.delegate;if(s){var u=A(s,r);if(u){if(u===y)continue;return u}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(i===h)throw i=m,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);i=d;var c=f(e,n,r);if("normal"===c.type){if(i=r.done?m:p,c.arg===y)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(i=m,r.method="throw",r.arg=c.arg)}}}function A(e,n){var r=n.method,i=e.iterator[r];if(i===t)return n.delegate=null,"throw"===r&&e.iterator.return&&(n.method="return",n.arg=t,A(e,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),y;var o=f(i,e.iterator,n.arg);if("throw"===o.type)return n.method="throw",n.arg=o.arg,n.delegate=null,y;var a=o.arg;return a?a.done?(n[e.resultName]=a.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,y):a:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,y)}function O(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function P(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function R(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(O,this),this.reset(!0)}function k(e){if(e||""===e){var n=e[a];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,o=function n(){for(;++i<e.length;)if(r.call(e,i))return n.value=e[i],n.done=!1,n;return n.value=t,n.done=!0,n};return o.next=o}}throw new TypeError(ik(e)+" is not iterable")}return g.prototype=b,i(S,"constructor",{value:b,configurable:!0}),i(b,"constructor",{value:g,configurable:!0}),g.displayName=c(b,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===g||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,c(t,u,"GeneratorFunction")),t.prototype=Object.create(S),t},e.awrap=function(t){return{__await:t}},T(M.prototype),c(M.prototype,s,(function(){return this})),e.AsyncIterator=M,e.async=function(t,n,r,i,o){void 0===o&&(o=Promise);var a=new M(l(t,n,r,i),o);return e.isGeneratorFunction(n)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},T(S),c(S,u,"Generator"),c(S,a,(function(){return this})),c(S,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),n=[];for(var r in e)n.push(r);return n.reverse(),function t(){for(;n.length;){var r=n.pop();if(r in e)return t.value=r,t.done=!1,t}return t.done=!0,t}},e.values=k,R.prototype={constructor:R,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(P),!e)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function i(r,i){return s.type="throw",s.arg=e,n.next=r,i&&(n.method="next",n.arg=t),!!i}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],s=a.completion;if("root"===a.tryLoc)return i("end");if(a.tryLoc<=this.prev){var u=r.call(a,"catchLoc"),c=r.call(a,"finallyLoc");if(u&&c){if(this.prev<a.catchLoc)return i(a.catchLoc,!0);if(this.prev<a.finallyLoc)return i(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return i(a.catchLoc,!0)}else{if(!c)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return i(a.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=t,a.arg=e,o?(this.method="next",this.next=o.finallyLoc,y):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),y},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),P(n),y}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var i=r.arg;P(n)}return i}}throw Error("illegal catch attempt")},delegateYield:function(e,n,r){return this.delegate={iterator:k(e),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=t),y}},e}function ak(t,e,n,r,i,o,a){try{var s=t[o](a),u=s.value}catch(t){return void n(t)}s.done?e(u):Promise.resolve(u).then(r,i)}function sk(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return uk(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?uk(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function uk(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function ck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function lk(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,hk(r.key),r)}}function fk(t,e,n){return e&&lk(t.prototype,e),n&&lk(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function hk(t){var e=function(t,e){if("object"!=ik(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=ik(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==ik(e)?e:e+""}function pk(t,e,n){return e=_k(e),function(t,e){if(e&&("object"===ik(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,gk()?Reflect.construct(e,n||[],_k(t).constructor):e.apply(t,n))}function dk(){return dk="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=_k(t)););return t}(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(arguments.length<3?t:n):i.value}},dk.apply(this,arguments)}function mk(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&bk(t,e)}function yk(t){var e="function"==typeof Map?new Map:void 0;return yk=function(t){if(null===t||!function(t){try{return-1!==Function.toString.call(t).indexOf("[native code]")}catch(e){return"function"==typeof t}}(t))return t;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,n)}function n(){return vk(t,arguments,_k(this).constructor)}return n.prototype=Object.create(t.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),bk(n,t)},yk(t)}function vk(t,e,n){if(gk())return Reflect.construct.apply(null,arguments);var r=[null];r.push.apply(r,e);var i=new(t.bind.apply(t,r));return n&&bk(i,n.prototype),i}function gk(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(gk=function(){return!!t})()}function bk(t,e){return bk=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},bk(t,e)}function _k(t){return _k=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},_k(t)}Ce("scriptableValue",rk),z("ScriptableValueNode",ek);var xk=function(t){function e(){return ck(this,e),pk(this,e,arguments)}return mk(e,t),fk(e,[{key:"get",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this.has(t))return dk(_k(e.prototype),"get",this).call(this,t);if(null!==n){for(var r=arguments.length,i=new Array(r>2?r-2:0),o=2;o<r;o++)i[o-2]=arguments[o];var a=n.apply(void 0,i);return this.set(t,a),a}}}])}(yk(Map)),wk=function(){return fk((function t(e){ck(this,t),this.scriptableNode=e}),[{key:"parameters",get:function(){return this.scriptableNode.parameters}},{key:"layout",get:function(){return this.scriptableNode.getLayout()}},{key:"getInputLayout",value:function(t){return this.scriptableNode.getInputLayout(t)}},{key:"get",value:function(t){var e=this.parameters[t];return e?e.getValue():null}}])}(),Sk=new xk,Tk=function(t){function e(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return ck(this,e),(t=pk(this,e)).codeNode=n,t.parameters=r,t._local=new xk,t._output=rk(),t._outputs={},t._source=t.source,t._method=null,t._object=null,t._value=null,t._needsOutputUpdate=!0,t.onRefresh=t.onRefresh.bind(t),t.isScriptableNode=!0,t}return mk(e,t),fk(e,[{key:"source",get:function(){return this.codeNode?this.codeNode.code:""}},{key:"setLocal",value:function(t,e){return this._local.set(t,e)}},{key:"getLocal",value:function(t){return this._local.get(t)}},{key:"onRefresh",value:function(){this._refresh()}},{key:"getInputLayout",value:function(t){var e,n=sk(this.getLayout());try{for(n.s();!(e=n.n()).done;){var r=e.value;if(r.inputType&&(r.id===t||r.name===t))return r}}catch(t){n.e(t)}finally{n.f()}}},{key:"getOutputLayout",value:function(t){var e,n=sk(this.getLayout());try{for(n.s();!(e=n.n()).done;){var r=e.value;if(r.outputType&&(r.id===t||r.name===t))return r}}catch(t){n.e(t)}finally{n.f()}}},{key:"setOutput",value:function(t,e){var n=this._outputs;return void 0===n[t]?n[t]=rk(e):n[t].value=e,this}},{key:"getOutput",value:function(t){return this._outputs[t]}},{key:"getParameter",value:function(t){return this.parameters[t]}},{key:"setParameter",value:function(t,e){var n=this.parameters;return e&&e.isScriptableNode?(this.deleteParameter(t),n[t]=e,n[t].getDefaultOutput().events.addEventListener("refresh",this.onRefresh)):e&&e.isScriptableValueNode?(this.deleteParameter(t),n[t]=e,n[t].events.addEventListener("refresh",this.onRefresh)):void 0===n[t]?(n[t]=rk(e),n[t].events.addEventListener("refresh",this.onRefresh)):n[t].value=e,this}},{key:"getValue",value:function(){return this.getDefaultOutput().getValue()}},{key:"deleteParameter",value:function(t){var e=this.parameters[t];return e&&(e.isScriptableNode&&(e=e.getDefaultOutput()),e.events.removeEventListener("refresh",this.onRefresh)),this}},{key:"clearParameters",value:function(){for(var t=0,e=Object.keys(this.parameters);t<e.length;t++){var n=e[t];this.deleteParameter(n)}return this.needsUpdate=!0,this}},{key:"call",value:function(t){var e=this.getObject()[t];if("function"==typeof e){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];return e.apply(void 0,r)}}},{key:"callAsync",value:(n=ok().mark((function t(e){var n,r,i,o,a,s=arguments;return ok().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=this.getObject(),"function"!=typeof(r=n[e])){t.next=12;break}for(i=s.length,o=new Array(i>1?i-1:0),a=1;a<i;a++)o[a-1]=s[a];if("AsyncFunction"!==r.constructor.name){t.next=10;break}return t.next=7,r.apply(void 0,o);case 7:t.t0=t.sent,t.next=11;break;case 10:t.t0=r.apply(void 0,o);case 11:return t.abrupt("return",t.t0);case 12:case"end":return t.stop()}}),t,this)})),r=function(){var t=this,e=arguments;return new Promise((function(r,i){var o=n.apply(t,e);function a(t){ak(o,r,i,a,s,"next",t)}function s(t){ak(o,r,i,a,s,"throw",t)}a(void 0)}))},function(t){return r.apply(this,arguments)})},{key:"getNodeType",value:function(t){return this.getDefaultOutputNode().getNodeType(t)}},{key:"refresh",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;null!==t?this.getOutput(t).refresh():this._refresh()}},{key:"getObject",value:function(){var t=this;if(this.needsUpdate&&this.dispose(),null!==this._object)return this._object;var e=new wk(this),n=Sk.get("THREE"),r=Sk.get("TSL"),i=this.getMethod(this.codeNode),o=[e,this._local,Sk,function(){return t.refresh()},function(e,n){return t.setOutput(e,n)},n,r];this._object=i.apply(void 0,o);var a=this._object.layout;if(a&&(!1===a.cache&&this._local.clear(),this._output.outputType=a.outputType||null,Array.isArray(a.elements))){var s,u=sk(a.elements);try{for(u.s();!(s=u.n()).done;){var c=s.value,l=c.id||c.name;c.inputType&&(void 0===this.getParameter(l)&&this.setParameter(l,null),this.getParameter(l).inputType=c.inputType),c.outputType&&(void 0===this.getOutput(l)&&this.setOutput(l,null),this.getOutput(l).outputType=c.outputType)}}catch(t){u.e(t)}finally{u.f()}}return this._object}},{key:"deserialize",value:function(t){for(var n in dk(_k(e.prototype),"deserialize",this).call(this,t),this.parameters){var r=this.parameters[n];r.isScriptableNode&&(r=r.getDefaultOutput()),r.events.addEventListener("refresh",this.onRefresh)}}},{key:"getLayout",value:function(){return this.getObject().layout}},{key:"getDefaultOutputNode",value:function(){var t=this.getDefaultOutput().value;return t&&t.isNode?t:On()}},{key:"getDefaultOutput",value:function(){return this._exec()._output}},{key:"getMethod",value:function(){if(this.needsUpdate&&this.dispose(),null!==this._method)return this._method;var t=["layout","init","main","dispose"].join(", "),e="\nreturn { ...output, "+t+" };",n="var "+t+"; var output = {};\n"+this.codeNode.code+e;return this._method=vk(Function,["parameters","local","global","refresh","setOutput","THREE","TSL"].concat([n])),this._method}},{key:"dispose",value:function(){null!==this._method&&(this._object&&"function"==typeof this._object.dispose&&this._object.dispose(),this._method=null,this._object=null,this._source=null,this._value=null,this._needsOutputUpdate=!0,this._output.value=null,this._outputs={})}},{key:"setup",value:function(){return this.getDefaultOutputNode()}},{key:"needsUpdate",get:function(){return this.source!==this._source},set:function(t){!0===t&&this.dispose()}},{key:"_exec",value:function(){return null===this.codeNode||(!0===this._needsOutputUpdate&&(this._value=this.call("main"),this._needsOutputUpdate=!1),this._output.value=this._value),this}},{key:"_refresh",value:function(){this.needsUpdate=!0,this._exec(),this._output.refresh()}}]);var n,r}(F);const Mk=Tk;var Ek=bn(Tk);function Ak(t){return Ak="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ak(t)}function Ok(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Pk(r.key),r)}}function Pk(t){var e=function(t,e){if("object"!=Ak(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=Ak(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Ak(e)?e:e+""}function Rk(t,e,n){return e=Ck(e),function(t,e){if(e&&("object"===Ak(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,kk()?Reflect.construct(e,n||[],Ck(t).constructor):e.apply(t,n))}function kk(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(kk=function(){return!!t})()}function Ck(t){return Ck=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Ck(t)}function Nk(t,e){return Nk=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Nk(t,e)}Ce("scriptable",Ek),z("ScriptableNode",Tk);var Lk=function(t){function e(t,n){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(r=Rk(this,e,["float"])).isFogNode=!0,r.colorNode=t,r.factorNode=n,r}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Nk(t,e)}(e,t),n=e,(r=[{key:"getViewZNode",value:function(t){var e,n=t.context.getViewZ;return void 0!==n&&(e=n(this)),(e||Dp.z).negate()}},{key:"setup",value:function(){return this.factorNode}}])&&Ok(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(F);const jk=Lk;var Ik=bn(Lk);function Bk(t){return Bk="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Bk(t)}function Uk(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Dk(r.key),r)}}function Dk(t){var e=function(t,e){if("object"!=Bk(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=Bk(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Bk(e)?e:e+""}function Fk(t,e,n){return e=Vk(e),function(t,e){if(e&&("object"===Bk(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,zk()?Reflect.construct(e,n||[],Vk(t).constructor):e.apply(t,n))}function zk(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(zk=function(){return!!t})()}function Vk(t){return Vk=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Vk(t)}function Gk(t,e){return Gk=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Gk(t,e)}Ce("fog",Ik),z("FogNode",Lk);var Hk=function(t){function e(t,n,r){var i;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(i=Fk(this,e,[t])).isFogRangeNode=!0,i.nearNode=n,i.farNode=r,i}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Gk(t,e)}(e,t),n=e,(r=[{key:"setup",value:function(t){var e=this.getViewZNode(t);return Pc(this.nearNode,this.farNode,e)}}])&&Uk(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(jk);const Wk=Hk;var qk=bn(Hk);function Xk(t){return Xk="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Xk(t)}function Yk(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Jk(r.key),r)}}function Jk(t){var e=function(t,e){if("object"!=Xk(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=Xk(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Xk(e)?e:e+""}function Zk(t,e,n){return e=Qk(e),function(t,e){if(e&&("object"===Xk(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,Kk()?Reflect.construct(e,n||[],Qk(t).constructor):e.apply(t,n))}function Kk(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(Kk=function(){return!!t})()}function Qk(t){return Qk=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Qk(t)}function $k(t,e){return $k=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},$k(t,e)}Ce("rangeFog",qk),z("FogRangeNode",Hk);var tC=function(t){function e(t,n){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(r=Zk(this,e,[t])).isFogExp2Node=!0,r.densityNode=n,r}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&$k(t,e)}(e,t),n=e,(r=[{key:"setup",value:function(t){var e=this.getViewZNode(t),n=this.densityNode;return n.mul(n,e,e).negate().exp().oneMinus()}}])&&Yk(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(jk);const eC=tC;var nC=bn(tC);function rC(t){return rC="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},rC(t)}function iC(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,oC(r.key),r)}}function oC(t){var e=function(t,e){if("object"!=rC(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=rC(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==rC(e)?e:e+""}function aC(t,e,n){return e=uC(e),function(t,e){if(e&&("object"===rC(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,sC()?Reflect.construct(e,n||[],uC(t).constructor):e.apply(t,n))}function sC(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(sC=function(){return!!t})()}function uC(t){return uC=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},uC(t)}function cC(t,e){return cC=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},cC(t,e)}Ce("densityFog",nC),z("FogExp2Node",tC);var lC=null,fC=null,hC=function(t){function e(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:On(),r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:On();return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(t=aC(this,e)).minNode=n,t.maxNode=r,t}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&cC(t,e)}(e,t),n=e,r=[{key:"getVectorLength",value:function(t){var e=t.getTypeLength(S(this.minNode.value)),n=t.getTypeLength(S(this.maxNode.value));return e>n?e:n}},{key:"getNodeType",value:function(t){return!0===t.object.isInstancedMesh?t.getTypeFromLength(this.getVectorLength(t)):"float"}},{key:"setup",value:function(t){var e=t.object,n=null;if(!0===e.isInstancedMesh){var r=this.minNode.value,i=this.maxNode.value,o=t.getTypeLength(S(r)),a=t.getTypeLength(S(i));lC=lC||new h.IUQ,fC=fC||new h.IUQ,lC.setScalar(0),fC.setScalar(0),1===o?lC.setScalar(r):r.isColor?lC.set(r.r,r.g,r.b):lC.set(r.x,r.y,r.z||0,r.w||0),1===a?fC.setScalar(i):i.isColor?fC.set(i.r,i.g,i.b):fC.set(i.x,i.y,i.z||0,i.w||0);for(var s=4*e.count,u=new Float32Array(s),c=0;c<s;c++){var l=c%4,f=lC.getComponent(l),p=fC.getComponent(l);u[c]=h.cj9.lerp(f,p,Math.random())}var d=this.getNodeType(t);n=Ul(u,"vec4",e.count).element(Li).convert(d)}else n=On(0);return n}}],r&&iC(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(F);const pC=hC;var dC=bn(hC);function mC(t){return mC="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},mC(t)}function yC(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,vC(r.key),r)}}function vC(t){var e=function(t,e){if("object"!=mC(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=mC(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==mC(e)?e:e+""}function gC(t,e,n){return e=_C(e),function(t,e){if(e&&("object"===mC(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,bC()?Reflect.construct(e,n||[],_C(t).constructor):e.apply(t,n))}function bC(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(bC=function(){return!!t})()}function _C(t){return _C=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},_C(t)}function xC(t,e){return xC=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},xC(t,e)}z("RangeNode",hC);var wC=function(t){function e(t,n){var r,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[64];return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(r=gC(this,e,["void"])).isComputeNode=!0,r.computeNode=t,r.count=n,r.workgroupSize=i,r.dispatchCount=0,r.version=1,r.updateBeforeType=a.OBJECT,r.updateDispatchCount(),r}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&xC(t,e)}(e,t),n=e,(r=[{key:"dispose",value:function(){this.dispatchEvent({type:"dispose"})}},{key:"needsUpdate",set:function(t){!0===t&&this.version++}},{key:"updateDispatchCount",value:function(){for(var t=this.count,e=this.workgroupSize,n=e[0],r=1;r<e.length;r++)n*=e[r];this.dispatchCount=Math.ceil(t/n)}},{key:"onInit",value:function(){}},{key:"updateBefore",value:function(t){t.renderer.compute(this)}},{key:"generate",value:function(t){if("compute"===t.shaderStage){var e=this.computeNode.build(t,"void");""!==e&&t.addLineFlowCode(e)}}}])&&yC(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(F);const SC=wC;var TC=function(t,e,n){return yn(new wC(yn(t),e,n))};function MC(t){return MC="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},MC(t)}function EC(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,AC(r.key),r)}}function AC(t){var e=function(t,e){if("object"!=MC(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=MC(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==MC(e)?e:e+""}function OC(t,e,n){return e=kC(e),function(t,e){if(e&&("object"===MC(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,PC()?Reflect.construct(e,n||[],kC(t).constructor):e.apply(t,n))}function PC(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(PC=function(){return!!t})()}function RC(){return RC="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=kC(t)););return t}(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(arguments.length<3?t:n):i.value}},RC.apply(this,arguments)}function kC(t){return kC=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},kC(t)}function CC(t,e){return CC=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},CC(t,e)}Ce("compute",TC),z("ComputeNode",wC);var NC=function(t){function e(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e.TARGET_DIRECTION,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(t=OC(this,e)).scope=n,t.light=r,t}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&CC(t,e)}(e,t),n=e,r=[{key:"setup",value:function(){var t=this.scope,n=this.light,r=null;return t===e.TARGET_DIRECTION&&(r=oh.transformDirection(zf(n).sub(zf(n.target)))),r}},{key:"serialize",value:function(t){RC(kC(e.prototype),"serialize",this).call(this,t),t.scope=this.scope}},{key:"deserialize",value:function(t){RC(kC(e.prototype),"deserialize",this).call(this,t),this.scope=t.scope}}],r&&EC(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(F);NC.TARGET_DIRECTION="targetDirection";const LC=NC;var jC=bn(NC,NC.TARGET_DIRECTION);z("LightNode",NC);var IC=wn((function(t){var e=t.lightDistance,n=t.cutoffDistance,r=t.decayExponent,i=e.pow(r).max(.01).reciprocal();return n.greaterThan(0).cond(i.mul(e.div(n).pow4().oneMinus().clamp().pow2()),i)}));function BC(t){return BC="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},BC(t)}function UC(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,DC(r.key),r)}}function DC(t){var e=function(t,e){if("object"!=BC(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=BC(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==BC(e)?e:e+""}function FC(t,e,n){return e=GC(e),function(t,e){if(e&&("object"===BC(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,zC()?Reflect.construct(e,n||[],GC(t).constructor):e.apply(t,n))}function zC(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(zC=function(){return!!t})()}function VC(){return VC="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=GC(t)););return t}(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(arguments.length<3?t:n):i.value}},VC.apply(this,arguments)}function GC(t){return GC=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},GC(t)}function HC(t,e){return HC=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},HC(t,e)}var WC=function(t){function e(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(t=FC(this,e,[n])).cutoffDistanceNode=gs(0),t.decayExponentNode=gs(0),t}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&HC(t,e)}(e,t),n=e,(r=[{key:"update",value:function(t){var n=this.light;VC(GC(e.prototype),"update",this).call(this,t),this.cutoffDistanceNode.value=n.distance,this.decayExponentNode.value=n.decay}},{key:"setup",value:function(t){var e=this.colorNode,n=this.cutoffDistanceNode,r=this.decayExponentNode,i=this.light,o=t.context.lightingModel,a=Gf(i).sub(Dp),s=a.normalize(),u=a.length(),c=IC({lightDistance:u,cutoffDistance:n,decayExponent:r}),l=e.mul(c),f=t.context.reflectedLight;o.direct({lightDirection:s,lightColor:l,reflectedLight:f},t.stack,t)}}])&&UC(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(hy);const qC=WC;function XC(t){return XC="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},XC(t)}function YC(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,JC(r.key),r)}}function JC(t){var e=function(t,e){if("object"!=XC(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=XC(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==XC(e)?e:e+""}function ZC(t,e,n){return e=$C(e),function(t,e){if(e&&("object"===XC(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,KC()?Reflect.construct(e,n||[],$C(t).constructor):e.apply(t,n))}function KC(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(KC=function(){return!!t})()}function QC(){return QC="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=$C(t)););return t}(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(arguments.length<3?t:n):i.value}},QC.apply(this,arguments)}function $C(t){return $C=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},$C(t)}function tN(t,e){return tN=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},tN(t,e)}z("PointLightNode",WC),Ay(h.HiM,WC);var eN=function(t){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),ZC(this,e,[t])}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&tN(t,e)}(e,t),n=e,(r=[{key:"setup",value:function(t){QC($C(e.prototype),"setup",this).call(this,t);var n=t.context.lightingModel,r=this.colorNode,i=jC(this.light),o=t.context.reflectedLight;n.direct({lightDirection:i,lightColor:r,reflectedLight:o},t.stack,t)}}])&&YC(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(hy);const nN=eN;function rN(t){return rN="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},rN(t)}function iN(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,oN(r.key),r)}}function oN(t){var e=function(t,e){if("object"!=rN(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=rN(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==rN(e)?e:e+""}function aN(t,e,n){return e=cN(e),function(t,e){if(e&&("object"===rN(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,sN()?Reflect.construct(e,n||[],cN(t).constructor):e.apply(t,n))}function sN(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(sN=function(){return!!t})()}function uN(){return uN="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=cN(t)););return t}(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(arguments.length<3?t:n):i.value}},uN.apply(this,arguments)}function cN(t){return cN=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},cN(t)}function lN(t,e){return lN=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},lN(t,e)}z("DirectionalLightNode",eN),Ay(h.ZyN,eN);var fN=function(t){function e(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(t=aN(this,e,[n])).coneCosNode=gs(0),t.penumbraCosNode=gs(0),t.cutoffDistanceNode=gs(0),t.decayExponentNode=gs(0),t}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&lN(t,e)}(e,t),n=e,(r=[{key:"update",value:function(t){uN(cN(e.prototype),"update",this).call(this,t);var n=this.light;this.coneCosNode.value=Math.cos(n.angle),this.penumbraCosNode.value=Math.cos(n.angle*(1-n.penumbra)),this.cutoffDistanceNode.value=n.distance,this.decayExponentNode.value=n.decay}},{key:"getSpotAttenuation",value:function(t){var e=this.coneCosNode,n=this.penumbraCosNode;return Pc(e,n,t)}},{key:"setup",value:function(t){uN(cN(e.prototype),"setup",this).call(this,t);var n=t.context.lightingModel,r=this.colorNode,i=this.cutoffDistanceNode,o=this.decayExponentNode,a=this.light,s=Gf(a).sub(Dp),u=s.normalize(),c=u.dot(jC(a)),l=this.getSpotAttenuation(c),f=s.length(),h=IC({lightDistance:f,cutoffDistance:i,decayExponent:o}),p=r.mul(l).mul(h),d=t.context.reflectedLight;n.direct({lightDirection:u,lightColor:p,reflectedLight:d},t.stack,t)}}])&&iN(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(hy);const hN=fN;function pN(t){return pN="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},pN(t)}function dN(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,mN(r.key),r)}}function mN(t){var e=function(t,e){if("object"!=pN(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=pN(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==pN(e)?e:e+""}function yN(t,e,n){return e=bN(e),function(t,e){if(e&&("object"===pN(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,vN()?Reflect.construct(e,n||[],bN(t).constructor):e.apply(t,n))}function vN(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(vN=function(){return!!t})()}function gN(){return gN="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=bN(t)););return t}(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(arguments.length<3?t:n):i.value}},gN.apply(this,arguments)}function bN(t){return bN=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},bN(t)}function _N(t,e){return _N=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},_N(t,e)}z("SpotLightNode",fN),Ay(h.nCl,fN);var xN=function(t){function e(t,n,r,i,o,a){var s;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(s=yN(this,e,[t,n,r,i,o,a])).iesMap=null,s}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&_N(t,e)}(e,t),n=e,(r=[{key:"copy",value:function(t,n){return gN(bN(e.prototype),"copy",this).call(this,t,n),this.iesMap=t.iesMap,this}}])&&dN(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(h.nCl);const wN=xN;function SN(t){return SN="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},SN(t)}function TN(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,MN(r.key),r)}}function MN(t){var e=function(t,e){if("object"!=SN(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=SN(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==SN(e)?e:e+""}function EN(t,e,n){return e=PN(e),function(t,e){if(e&&("object"===SN(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,AN()?Reflect.construct(e,n||[],PN(t).constructor):e.apply(t,n))}function AN(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(AN=function(){return!!t})()}function ON(){return ON="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=PN(t)););return t}(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(arguments.length<3?t:n):i.value}},ON.apply(this,arguments)}function PN(t){return PN=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},PN(t)}function RN(t,e){return RN=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},RN(t,e)}var kN=function(t){function e(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),EN(this,e,arguments)}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&RN(t,e)}(e,t),n=e,(r=[{key:"getSpotAttenuation",value:function(t){var n=this.light.iesMap,r=null;if(n&&!0===n.isTexture){var i=t.acos().mul(1/Math.PI);r=El(n,Cn(i,0),0).r}else r=ON(PN(e.prototype),"getSpotAttenuation",this).call(this,t);return r}}])&&TN(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(hN);const CN=kN;function NN(t){return NN="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},NN(t)}function LN(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,jN(r.key),r)}}function jN(t){var e=function(t,e){if("object"!=NN(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=NN(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==NN(e)?e:e+""}function IN(t,e,n){return e=UN(e),function(t,e){if(e&&("object"===NN(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,BN()?Reflect.construct(e,n||[],UN(t).constructor):e.apply(t,n))}function BN(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(BN=function(){return!!t})()}function UN(t){return UN=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},UN(t)}function DN(t,e){return DN=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},DN(t,e)}z("IESSpotLightNode",kN),Ay(wN,kN);var FN=function(t){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),IN(this,e,[t])}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&DN(t,e)}(e,t),n=e,(r=[{key:"setup",value:function(t){t.context.irradiance.addAssign(this.colorNode)}}])&&LN(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(hy);const zN=FN;function VN(t){return VN="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},VN(t)}function GN(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,HN(r.key),r)}}function HN(t){var e=function(t,e){if("object"!=VN(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=VN(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==VN(e)?e:e+""}function WN(t,e,n){return e=YN(e),function(t,e){if(e&&("object"===VN(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,qN()?Reflect.construct(e,n||[],YN(t).constructor):e.apply(t,n))}function qN(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(qN=function(){return!!t})()}function XN(){return XN="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=YN(t)););return t}(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(arguments.length<3?t:n):i.value}},XN.apply(this,arguments)}function YN(t){return YN=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},YN(t)}function JN(t,e){return JN=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},JN(t,e)}z("AmbientLightNode",FN),Ay(h.$p8,FN);var ZN=function(t){function e(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(t=WN(this,e,[n])).lightPositionNode=zf(n),t.lightDirectionNode=t.lightPositionNode.normalize(),t.groundColorNode=gs(new h.Q1f),t}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&JN(t,e)}(e,t),n=e,(r=[{key:"update",value:function(t){var n=this.light;XN(YN(e.prototype),"update",this).call(this,t),this.lightPositionNode.object3d=n,this.groundColorNode.value.copy(n.groundColor).multiplyScalar(n.intensity)}},{key:"setup",value:function(t){var e=this.colorNode,n=this.groundColorNode,r=this.lightDirectionNode,i=Uh.dot(r).mul(.5).add(.5),o=Mc(n,e,i);t.context.irradiance.addAssign(o)}}])&&GN(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(hy);const KN=ZN;function QN(t){return QN="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},QN(t)}function $N(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,tL(r.key),r)}}function tL(t){var e=function(t,e){if("object"!=QN(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=QN(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==QN(e)?e:e+""}function eL(t,e,n){return e=rL(e),function(t,e){if(e&&("object"===QN(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,nL()?Reflect.construct(e,n||[],rL(t).constructor):e.apply(t,n))}function nL(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(nL=function(){return!!t})()}function rL(t){return rL=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},rL(t)}function iL(t,e){return iL=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},iL(t,e)}z("HemisphereLightNode",ZN),Ay(h.dth,ZN);var oL=wn((function(t){var e=t.uv.mul(2),n=e.x.floor(),r=e.y.floor();return n.add(r).mod(2).sign()})),aL=function(t){function e(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Os();return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(t=eL(this,e,["float"])).uvNode=n,t}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&iL(t,e)}(e,t),n=e,(r=[{key:"setup",value:function(){return oL({uv:this.uvNode})}}])&&$N(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(Q);const sL=aL;var uL=bn(aL);function cL(t){return cL="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},cL(t)}function lL(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return fL(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?fL(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function fL(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function hL(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,pL(r.key),r)}}function pL(t){var e=function(t,e){if("object"!=cL(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=cL(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==cL(e)?e:e+""}function dL(t,e,n){return e=yL(e),function(t,e){if(e&&("object"===cL(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,mL()?Reflect.construct(e,n||[],yL(t).constructor):e.apply(t,n))}function mL(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(mL=function(){return!!t})()}function yL(t){return yL=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},yL(t)}function vL(t,e){return vL=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},vL(t,e)}Ce("checker",uL),z("CheckerNode",aL);var gL=function(t){function e(t){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=dL(this,e,[t])).textures={},n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&vL(t,e)}(e,t),n=e,(r=[{key:"load",value:function(t,e,n,r){var i=this,o=new h.Y9S(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(t,(function(n){try{e(i.parse(JSON.parse(n)))}catch(e){r?r(e):console.error(e),i.manager.itemError(t)}}),n,r)}},{key:"parseNodes",value:function(t){var e={};if(void 0!==t){var n,r=lL(t);try{for(r.s();!(n=r.n()).done;){var i=n.value,o=i.uuid,a=i.type;e[o]=yn(V(a)),e[o].uuid=o}}catch(t){r.e(t)}finally{r.f()}var s,u={nodes:e,textures:this.textures},c=lL(t);try{for(c.s();!(s=c.n()).done;){var l=s.value;l.meta=u,e[l.uuid].deserialize(l),delete l.meta}}catch(t){c.e(t)}finally{c.f()}}return e}},{key:"parse",value:function(t){var e=yn(V(t.type));e.uuid=t.uuid;var n={nodes:this.parseNodes(t.nodes),textures:this.textures};return t.meta=n,e.deserialize(t),delete t.meta,e}},{key:"setTextures",value:function(t){return this.textures=t,this}}])&&hL(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(h.aHM);const bL=gL;function _L(t){return _L="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_L(t)}function xL(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,wL(r.key),r)}}function wL(t){var e=function(t,e){if("object"!=_L(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=_L(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==_L(e)?e:e+""}function SL(t,e,n){return e=ML(e),function(t,e){if(e&&("object"===_L(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,TL()?Reflect.construct(e,n||[],ML(t).constructor):e.apply(t,n))}function TL(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(TL=function(){return!!t})()}function ML(t){return ML=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},ML(t)}function EL(t,e){return EL=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},EL(t,e)}var AL=new h.BH$,OL=function(t){function e(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(t=SL(this,e)).normals=!1,t.lights=!1,t.useAlphaToCoverage=!0,t.useColor=n.vertexColors,t.pointWidth=1,t.pointColorNode=null,t.setDefaultValues(AL),t.setupShaders(),t.setValues(n),t}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&EL(t,e)}(e,t),n=e,(r=[{key:"setupShaders",value:function(){var t=this,e=this.alphaToCoverage,n=this.useColor;this.vertexNode=wn((function(){Ar(Cn(),"vUv").assign(Os());var t=Ur("instancePosition"),e=Wo("vec4","mvPos");e.assign(_h.mul(Fn(t,1)));var n=lg.z.div(lg.w),r=th.mul(e),i=Wo("vec2","offset");return i.assign(jp.xy),i.assign(i.mul(Tp)),i.assign(i.div(lg.z)),i.y.assign(i.y.mul(n)),i.assign(i.mul(r.w)),r.assign(r.add(Fn(i,0,0))),r}))(),this.fragmentNode=wn((function(){var r=Ar(Cn(),"vUv"),i=Wo("float","alpha");i.assign(1);var o,a=r.x,s=r.y,u=a.mul(a).add(s.mul(s));if(e){var c=Wo("float","dlen");c.assign(u.fwidth()),i.assign(Pc(c.oneMinus(),c.add(1),u).oneMinus())}else u.greaterThan(1).discard();return o=t.pointColorNode?t.pointColorNode:n?Ur("instanceColor").mul(tp):tp,Fn(o,i)}))(),this.needsUpdate=!0}},{key:"alphaToCoverage",get:function(){return this.useAlphaToCoverage},set:function(t){this.useAlphaToCoverage!==t&&(this.useAlphaToCoverage=t,this.setupShaders())}}])&&xL(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(Cb);const PL=OL;function RL(t){return RL="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},RL(t)}function kL(t,e,n){return e=NL(e),function(t,e){if(e&&("object"===RL(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,CL()?Reflect.construct(e,n||[],NL(t).constructor):e.apply(t,n))}function CL(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(CL=function(){return!!t})()}function NL(t){return NL=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},NL(t)}function LL(t,e){return LL=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},LL(t,e)}Nb("InstancedPointsNodeMaterial",OL);var jL=new h.mrM,IL=function(t){function e(t){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=kL(this,e)).isLineBasicNodeMaterial=!0,n.lights=!1,n.normals=!1,n.setDefaultValues(jL),n.setValues(t),n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&LL(t,e)}(e,t),n=e,Object.defineProperty(n,"prototype",{writable:!1}),n;var n}(Cb);const BL=IL;function UL(t){return UL="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},UL(t)}function DL(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,FL(r.key),r)}}function FL(t){var e=function(t,e){if("object"!=UL(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=UL(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==UL(e)?e:e+""}function zL(t,e,n){return e=GL(e),function(t,e){if(e&&("object"===UL(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,VL()?Reflect.construct(e,n||[],GL(t).constructor):e.apply(t,n))}function VL(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(VL=function(){return!!t})()}function GL(t){return GL=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},GL(t)}function HL(t,e){return HL=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},HL(t,e)}Nb("LineBasicNodeMaterial",IL);var WL=new h.Fvt,qL=function(t){function e(t){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=zL(this,e)).isLineDashedNodeMaterial=!0,n.lights=!1,n.normals=!1,n.setDefaultValues(WL),n.offsetNode=null,n.dashScaleNode=null,n.dashSizeNode=null,n.gapSizeNode=null,n.setValues(t),n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&HL(t,e)}(e,t),n=e,(r=[{key:"setupVariants",value:function(){var t=this.offsetNode,e=this.dashScaleNode?On(this.dashScaleNode):bp,n=this.dashSizeNode?On(this.dashSizeNode):_p,r=this.dashSizeNode?On(this.dashGapNode):xp;aa.assign(n),sa.assign(r);var i=Ar(Ur("lineDistance").mul(e));(t?i.add(t):i).mod(aa.add(sa)).greaterThan(aa).discard()}}])&&DL(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(Cb);const XL=qL;function YL(t){return YL="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},YL(t)}function JL(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,ZL(r.key),r)}}function ZL(t){var e=function(t,e){if("object"!=YL(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=YL(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==YL(e)?e:e+""}function KL(t,e,n){return e=$L(e),function(t,e){if(e&&("object"===YL(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,QL()?Reflect.construct(e,n||[],$L(t).constructor):e.apply(t,n))}function QL(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(QL=function(){return!!t})()}function $L(t){return $L=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},$L(t)}function tj(t,e){return tj=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},tj(t,e)}Nb("LineDashedNodeMaterial",qL);var ej=new h.Fvt,nj=function(t){function e(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(t=KL(this,e)).normals=!1,t.lights=!1,t.setDefaultValues(ej),t.useAlphaToCoverage=!0,t.useColor=n.vertexColors,t.useDash=n.dashed,t.useWorldUnits=!1,t.dashOffset=0,t.lineWidth=1,t.lineColorNode=null,t.offsetNode=null,t.dashScaleNode=null,t.dashSizeNode=null,t.gapSizeNode=null,t.setupShaders(),t.setValues(n),t}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&tj(t,e)}(e,t),n=e,(r=[{key:"setupShaders",value:function(){var t=this,e=this.alphaToCoverage,n=this.useColor,r=this.dashed,i=this.worldUnits,o=wn((function(t){var e=t.start,n=t.end,r=th.element(2).element(2),i=th.element(3).element(2).mul(-.5).div(r).sub(e.z).div(n.z.sub(e.z));return Fn(Mc(e.xyz,n.xyz,i),n.w)}));this.vertexNode=wn((function(){qo("vec2","vUv").assign(Os());var t=Ur("instanceStart"),e=Ur("instanceEnd"),n=Wo("vec4","start"),a=Wo("vec4","end");n.assign(_h.mul(Fn(t,1))),a.assign(_h.mul(Fn(e,1))),i&&(qo("vec3","worldStart").assign(n.xyz),qo("vec3","worldEnd").assign(a.xyz));var s=lg.z.div(lg.w),u=th.element(2).element(3).equal(-1);Mn(u,(function(){Mn(n.z.lessThan(0).and(a.z.greaterThan(0)),(function(){a.assign(o({start:n,end:a}))})).elseif(a.z.lessThan(0).and(n.z.greaterThanEqual(0)),(function(){n.assign(o({start:a,end:n}))}))}));var c=th.mul(n),l=th.mul(a),f=c.xyz.div(c.w),h=l.xyz.div(l.w),p=h.xy.sub(f.xy).temp();p.x.assign(p.x.mul(s)),p.assign(p.normalize());var d=Zi(Fn());if(i){var m=a.xyz.sub(n.xyz).normalize(),y=Mc(n.xyz,a.xyz,.5).normalize(),v=m.cross(y).normalize(),g=m.cross(v),b=qo("vec4","worldPos");b.assign(jp.y.lessThan(.5).cond(n,a));var _=wp.mul(.5);b.addAssign(Fn(jp.x.lessThan(0).cond(v.mul(_),v.mul(_).negate()),0)),r||(b.addAssign(Fn(jp.y.lessThan(.5).cond(m.mul(_).negate(),m.mul(_)),0)),b.addAssign(Fn(g.mul(_),0)),Mn(jp.y.greaterThan(1).or(jp.y.lessThan(0)),(function(){b.subAssign(Fn(g.mul(2).mul(_),0))}))),d.assign(th.mul(b));var x=Zi(In());x.assign(jp.y.lessThan(.5).cond(f,h)),d.z.assign(x.z.mul(d.w))}else{var w=Wo("vec2","offset");w.assign(Cn(p.y,p.x.negate())),p.x.assign(p.x.div(s)),w.x.assign(w.x.div(s)),w.assign(jp.x.lessThan(0).cond(w.negate(),w)),Mn(jp.y.lessThan(0),(function(){w.assign(w.sub(p))})).elseif(jp.y.greaterThan(1),(function(){w.assign(w.add(p))})),w.assign(w.mul(wp)),w.assign(w.div(lg.w)),d.assign(jp.y.lessThan(.5).cond(c,l)),w.assign(w.mul(d.w)),d.assign(d.add(Fn(w,0,0)))}return d}))();var a=wn((function(t){var e=t.p1,n=t.p2,r=t.p3,i=t.p4,o=e.sub(r),a=i.sub(r),s=n.sub(e),u=o.dot(a),c=a.dot(s),l=o.dot(s),f=a.dot(a),h=s.dot(s).mul(f).sub(c.mul(c)),p=u.mul(c).sub(l.mul(f)).div(h).clamp(),d=u.add(c.mul(p)).div(f).clamp();return Cn(p,d)}));this.fragmentNode=wn((function(){var o=qo("vec2","vUv");if(r){var s=t.offsetNode?On(t.offsetNodeNode):Sp,u=t.dashScaleNode?On(t.dashScaleNode):bp,c=t.dashSizeNode?On(t.dashSizeNode):_p,l=t.dashSizeNode?On(t.dashGapNode):xp;aa.assign(c),sa.assign(l);var f=Ur("instanceDistanceStart"),h=Ur("instanceDistanceEnd"),p=jp.y.lessThan(.5).cond(u.mul(f),bp.mul(h)),d=Ar(p.add(Sp)),m=s?d.add(s):d;o.y.lessThan(-1).or(o.y.greaterThan(1)).discard(),m.mod(aa.add(sa)).greaterThan(aa).discard()}var y,v=Wo("float","alpha");if(v.assign(1),i){var g=qo("vec3","worldStart"),b=qo("vec3","worldEnd"),_=qo("vec4","worldPos").xyz.normalize().mul(1e5),x=b.sub(g),w=a({p1:g,p2:b,p3:In(0,0,0),p4:_}),S=g.add(x.mul(w.x)),T=_.mul(w.y),M=S.sub(T).length().div(wp);if(!r)if(e){var E=M.fwidth();v.assign(Pc(E.negate().add(.5),E.add(.5),M).oneMinus())}else M.greaterThan(.5).discard()}else if(e){var A=o.x,O=o.y.greaterThan(0).cond(o.y.sub(1),o.y.add(1)),P=A.mul(A).add(O.mul(O)),R=Wo("float","dlen");R.assign(P.fwidth()),Mn(o.y.abs().greaterThan(1),(function(){v.assign(Pc(R.oneMinus(),R.add(1),P).oneMinus())}))}else Mn(o.y.abs().greaterThan(1),(function(){var t=o.x,e=o.y.greaterThan(0).cond(o.y.sub(1),o.y.add(1));t.mul(t).add(e.mul(e)).greaterThan(1).discard()}));if(t.lineColorNode)y=t.lineColorNode;else if(n){var k=Ur("instanceColorStart"),C=Ur("instanceColorEnd");y=jp.y.lessThan(.5).cond(k,C).mul(tp)}else y=tp;return Fn(y,v)}))(),this.needsUpdate=!0}},{key:"worldUnits",get:function(){return this.useWorldUnits},set:function(t){this.useWorldUnits!==t&&(this.useWorldUnits=t,this.setupShaders())}},{key:"dashed",get:function(){return this.useDash},set:function(t){this.useDash!==t&&(this.useDash=t,this.setupShaders())}},{key:"alphaToCoverage",get:function(){return this.useAlphaToCoverage},set:function(t){this.useAlphaToCoverage!==t&&(this.useAlphaToCoverage=t,this.setupShaders())}}])&&JL(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(Cb);const rj=nj;function ij(t){return ij="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ij(t)}function oj(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,aj(r.key),r)}}function aj(t){var e=function(t,e){if("object"!=ij(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=ij(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==ij(e)?e:e+""}function sj(t,e,n){return e=cj(e),function(t,e){if(e&&("object"===ij(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,uj()?Reflect.construct(e,n||[],cj(t).constructor):e.apply(t,n))}function uj(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(uj=function(){return!!t})()}function cj(t){return cj=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},cj(t)}function lj(t,e){return lj=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},lj(t,e)}Nb("Line2NodeMaterial",nj);var fj=new h.qBx,hj=function(t){function e(t){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=sj(this,e)).isMeshNormalNodeMaterial=!0,n.colorSpaced=!1,n.setDefaultValues(fj),n.setValues(t),n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&lj(t,e)}(e,t),n=e,(r=[{key:"setupDiffuseColor",value:function(){var t=this.opacityNode?On(this.opacityNode):rp;Xo.assign(Fn(FS(Fh),t))}}])&&oj(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(Cb);const pj=hj;function dj(t){return dj="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},dj(t)}function mj(t,e,n){return e=vj(e),function(t,e){if(e&&("object"===dj(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,yj()?Reflect.construct(e,n||[],vj(t).constructor):e.apply(t,n))}function yj(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(yj=function(){return!!t})()}function vj(t){return vj=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},vj(t)}function gj(t,e){return gj=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},gj(t,e)}Nb("MeshNormalNodeMaterial",hj);var bj=new h.V9B,_j=function(t){function e(t){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=mj(this,e)).isMeshBasicNodeMaterial=!0,n.lights=!1,n.setDefaultValues(bj),n.setValues(t),n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&gj(t,e)}(e,t),n=e,Object.defineProperty(n,"prototype",{writable:!1}),n;var n}(Cb);const xj=_j;Nb("MeshBasicNodeMaterial",_j);const wj=wn((function(t){var e=t.f0,n=t.f90,r=t.dotVH,i=r.mul(-5.55473).sub(6.98316).mul(r).exp2();return e.mul(i.oneMinus()).add(n.mul(i))})),Sj=wn((function(t){return t.diffuseColor.mul(1/Math.PI)}));function Tj(t){return Tj="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Tj(t)}function Mj(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Ej(r.key),r)}}function Ej(t){var e=function(t,e){if("object"!=Tj(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=Tj(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Tj(e)?e:e+""}function Aj(t,e,n){return e=Pj(e),function(t,e){if(e&&("object"===Tj(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,Oj()?Reflect.construct(e,n||[],Pj(t).constructor):e.apply(t,n))}function Oj(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(Oj=function(){return!!t})()}function Pj(t){return Pj=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Pj(t)}function Rj(t,e){return Rj=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Rj(t,e)}var kj=wn((function(t){var e=t.dotNH;return ia.mul(.5/Math.PI).add(1).mul(e.pow(ia))})),Cj=wn((function(t){var e=t.lightDirection.add(Fp).normalize(),n=Fh.dot(e).clamp(),r=Fp.dot(e).clamp(),i=wj({f0:ra,f90:1,dotVH:r}),o=On(.25),a=kj({dotNH:n});return i.mul(o).mul(a)})),Nj=function(t){function e(){var t,n=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(t=Aj(this,e)).specular=n,t}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Rj(t,e)}(e,t),n=e,(r=[{key:"direct",value:function(t){var e=t.lightDirection,n=t.lightColor,r=t.reflectedLight,i=Fh.dot(e).clamp().mul(n);r.directDiffuse.addAssign(i.mul(Sj({diffuseColor:Xo.rgb}))),!0===this.specular&&r.directSpecular.addAssign(i.mul(Cj({lightDirection:e})).mul(op))}},{key:"indirectDiffuse",value:function(t){var e=t.irradiance;t.reflectedLight.indirectDiffuse.addAssign(e.mul(Sj({diffuseColor:Xo})))}}])&&Mj(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(Di);const Lj=Nj;function jj(t){return jj="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},jj(t)}function Ij(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Bj(r.key),r)}}function Bj(t){var e=function(t,e){if("object"!=jj(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=jj(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==jj(e)?e:e+""}function Uj(t,e,n){return e=Fj(e),function(t,e){if(e&&("object"===jj(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,Dj()?Reflect.construct(e,n||[],Fj(t).constructor):e.apply(t,n))}function Dj(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(Dj=function(){return!!t})()}function Fj(t){return Fj=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Fj(t)}function zj(t,e){return zj=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},zj(t,e)}var Vj=new h.G_z,Gj=function(t){function e(t){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=Uj(this,e)).isMeshLambertNodeMaterial=!0,n.lights=!0,n.setDefaultValues(Vj),n.setValues(t),n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&zj(t,e)}(e,t),n=e,(r=[{key:"setupLightingModel",value:function(){return new Lj(!1)}}])&&Ij(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(Cb);const Hj=Gj;function Wj(t){return Wj="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Wj(t)}function qj(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Xj(r.key),r)}}function Xj(t){var e=function(t,e){if("object"!=Wj(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=Wj(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Wj(e)?e:e+""}function Yj(t,e,n){return e=Kj(e),function(t,e){if(e&&("object"===Wj(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,Jj()?Reflect.construct(e,n||[],Kj(t).constructor):e.apply(t,n))}function Jj(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(Jj=function(){return!!t})()}function Zj(){return Zj="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Kj(t)););return t}(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(arguments.length<3?t:n):i.value}},Zj.apply(this,arguments)}function Kj(t){return Kj=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Kj(t)}function Qj(t,e){return Qj=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Qj(t,e)}Nb("MeshLambertNodeMaterial",Gj);var $j=new h.tXL,tI=function(t){function e(t){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=Yj(this,e)).isMeshPhongNodeMaterial=!0,n.lights=!0,n.shininessNode=null,n.specularNode=null,n.setDefaultValues($j),n.setValues(t),n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Qj(t,e)}(e,t),n=e,(r=[{key:"setupLightingModel",value:function(){return new Lj}},{key:"setupVariants",value:function(){var t=(this.shininessNode?On(this.shininessNode):ep).max(1e-4);ia.assign(t);var e=this.specularNode||ip;ra.assign(e)}},{key:"copy",value:function(t){return this.shininessNode=t.shininessNode,this.specularNode=t.specularNode,Zj(Kj(e.prototype),"copy",this).call(this,t)}}])&&qj(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(Cb);const eI=tI;Nb("MeshPhongNodeMaterial",tI);const nI=wn((function(){var t=Ih.dFdx().abs().max(Ih.dFdy().abs());return t.x.max(t.y).max(t.z)}));var rI=wn((function(t){var e=t.roughness,n=nI(),r=e.max(.0525);return(r=r.add(n)).min(1)}));const iI=rI,oI=wn((function(t){var e=t.alpha,n=t.dotNL,r=t.dotNV,i=e.pow2(),o=n.mul(i.add(i.oneMinus().mul(r.pow2())).sqrt()),a=r.mul(i.add(i.oneMinus().mul(n.pow2())).sqrt());return Ks(.5,o.add(a).max(Mu))})).setLayout({name:"V_GGX_SmithCorrelated",type:"float",inputs:[{name:"alpha",type:"float"},{name:"dotNL",type:"float"},{name:"dotNV",type:"float"}]}),aI=wn((function(t){var e=t.alpha,n=t.dotNH,r=e.pow2(),i=n.pow2().mul(r.oneMinus()).oneMinus();return r.div(i.pow2()).mul(1/Math.PI)})).setLayout({name:"D_GGX",type:"float",inputs:[{name:"alpha",type:"float"},{name:"dotNH",type:"float"}]});var sI=wn((function(t){var e=t.lightDirection,n=t.f0,r=t.f90,i=t.roughness,o=t.iridescenceFresnel,a=t.normalView||Fh,s=i.pow2(),u=e.add(Fp).normalize(),c=a.dot(e).clamp(),l=a.dot(Fp).clamp(),f=a.dot(u).clamp(),h=Fp.dot(u).clamp(),p=wj({f0:n,f90:r,dotVH:h});o&&(p=ta.mix(p,o));var d=oI({alpha:s,dotNL:c,dotNV:l}),m=aI({alpha:s,dotNH:f});return p.mul(d).mul(m)}));const uI=sI;var cI=wn((function(t){var e=t.roughness,n=t.dotNV,r=Fn(-1,-.0275,-.572,.022),i=Fn(1,.0425,1.04,-.04),o=e.mul(r).add(i),a=o.x.mul(o.x).min(n.mul(-9.28).exp2()).mul(o.x).add(o.y);return Cn(-1.04,1.04).mul(a).add(o.zw)})).setLayout({name:"DFGApprox",type:"vec2",inputs:[{name:"roughness",type:"float"},{name:"dotNV",type:"vec3"}]});const lI=cI;var fI=wn((function(t){var e=t.dotNV,n=t.specularColor,r=t.specularF90,i=t.roughness,o=lI({dotNV:e,roughness:i});return n.mul(o.x).add(r.mul(o.y))}));const hI=fI,pI=wn((function(t){var e=t.f,n=t.f90,r=t.dotVH.oneMinus().saturate(),i=r.mul(r),o=r.mul(i,i).clamp(0,.9999);return e.sub(In(n).mul(o)).div(o.oneMinus())})).setLayout({name:"Schlick_to_F0",type:"vec3",inputs:[{name:"f",type:"vec3"},{name:"f90",type:"float"},{name:"dotVH",type:"float"}]});var dI=wn((function(t){var e=t.roughness,n=t.dotNH,r=e.pow2(),i=On(1).div(r),o=n.pow2().oneMinus().max(.0078125);return On(2).add(i).mul(o.pow(i.mul(.5))).div(2*Math.PI)})).setLayout({name:"D_Charlie",type:"float",inputs:[{name:"roughness",type:"float"},{name:"dotNH",type:"float"}]}),mI=wn((function(t){var e=t.dotNV,n=t.dotNL;return On(1).div(On(4).mul(n.add(e).sub(n.mul(e))))})).setLayout({name:"V_Neubelt",type:"float",inputs:[{name:"dotNV",type:"float"},{name:"dotNL",type:"float"}]});const yI=wn((function(t){var e=t.lightDirection,n=e.add(Fp).normalize(),r=Fh.dot(e).clamp(),i=Fh.dot(Fp).clamp(),o=Fh.dot(n).clamp(),a=dI({roughness:$o,dotNH:o}),s=mI({dotNV:i,dotNL:r});return Qo.mul(a).mul(s)}));function vI(t){return vI="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},vI(t)}function gI(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,bI(r.key),r)}}function bI(t){var e=function(t,e){if("object"!=vI(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=vI(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==vI(e)?e:e+""}function _I(t,e,n){return e=wI(e),function(t,e){if(e&&("object"===vI(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,xI()?Reflect.construct(e,n||[],wI(t).constructor):e.apply(t,n))}function xI(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(xI=function(){return!!t})()}function wI(t){return wI=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},wI(t)}function SI(t,e){return SI=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},SI(t,e)}var TI=Yn(3.2404542,-.969266,.0556434,-1.5371385,1.8760108,-.2040259,-.4985314,.041556,1.0572252),MI=function(t,e){return t.sub(e).div(t.add(e)).pow2()},EI=function(t,e){var n=t.mul(2*Math.PI*1e-9),r=In(54856e-17,44201e-17,52481e-17),i=In(1681e3,1795300,2208400),o=In(43278e5,93046e5,66121e5),a=On(9747e-17*Math.sqrt(2*Math.PI*45282e5)).mul(n.mul(2239900).add(e.x).cos()).mul(n.pow2().mul(-45282e5).exp()),s=r.mul(o.mul(2*Math.PI).sqrt()).mul(i.mul(n).add(e).cos()).mul(n.pow2().negate().mul(o).exp());return s=In(s.x.add(a),s.y,s.z).div(1.0685e-7),TI.mul(s)},AI=wn((function(t){for(var e,n=t.outsideIOR,r=t.eta2,i=t.cosTheta1,o=t.thinFilmThickness,a=t.baseF0,s=Mc(n,r,Pc(0,.03,o)),u=n.div(s).pow2().mul(On(1).sub(i.pow2())),c=On(1).sub(u).sqrt(),l=MI(s,n),f=wj({f0:l,f90:1,dotVH:i}),h=f.oneMinus(),p=s.lessThan(n).cond(Math.PI,0),d=On(Math.PI).sub(p),m=(e=a.clamp(0,.9999).sqrt(),In(1).add(e).div(In(1).sub(e))),y=MI(m,s.vec3()),v=wj({f0:y,f90:1,dotVH:c}),g=In(m.x.lessThan(s).cond(Math.PI,0),m.y.lessThan(s).cond(Math.PI,0),m.z.lessThan(s).cond(Math.PI,0)),b=s.mul(o,c,2),_=In(d).add(g),x=f.mul(v).clamp(1e-5,.9999),w=x.sqrt(),S=h.pow2().mul(v).div(In(1).sub(x)),T=f.add(S),M=S.sub(h),E=1;E<=2;++E){M=M.mul(w);var A=EI(On(E).mul(b),On(E).mul(_)).mul(2);T=T.add(M.mul(A))}return T.max(In(0))})).setLayout({name:"evalIridescence",type:"vec3",inputs:[{name:"outsideIOR",type:"float"},{name:"eta2",type:"float"},{name:"cosTheta1",type:"float"},{name:"thinFilmThickness",type:"float"},{name:"baseF0",type:"vec3"}]}),OI=wn((function(t){var e=t.normal,n=t.viewDir,r=t.roughness,i=e.dot(n).saturate(),o=r.pow2(),a=rv(r.lessThan(.25),On(-339.2).mul(o).add(On(161.4).mul(r)).sub(25.9),On(-8.48).mul(o).add(On(14.3).mul(r)).sub(9.95)),s=rv(r.lessThan(.25),On(44).mul(o).sub(On(23.7).mul(r)).add(3.26),On(1.97).mul(o).sub(On(3.27).mul(r)).add(.72));return rv(r.lessThan(.25),0,On(.1).mul(r).sub(.025)).add(a.mul(i).add(s).exp()).mul(1/Math.PI).saturate()})),PI=In(.04),RI=In(1),kI=function(t){function e(){var t,n=arguments.length>0&&void 0!==arguments[0]&&arguments[0],r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(t=_I(this,e)).clearcoat=n,t.sheen=r,t.iridescence=i,t.clearcoatRadiance=null,t.clearcoatSpecularDirect=null,t.clearcoatSpecularIndirect=null,t.sheenSpecularDirect=null,t.sheenSpecularIndirect=null,t.iridescenceFresnel=null,t.iridescenceF0=null,t}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&SI(t,e)}(e,t),n=e,r=[{key:"start",value:function(){if(!0===this.clearcoat&&(this.clearcoatRadiance=In().temp("clearcoatRadiance"),this.clearcoatSpecularDirect=In().temp("clearcoatSpecularDirect"),this.clearcoatSpecularIndirect=In().temp("clearcoatSpecularIndirect")),!0===this.sheen&&(this.sheenSpecularDirect=In().temp("sheenSpecularDirect"),this.sheenSpecularIndirect=In().temp("sheenSpecularIndirect")),!0===this.iridescence){var t=Fh.dot(Fp).clamp();this.iridescenceFresnel=AI({outsideIOR:On(1),eta2:ea,cosTheta1:t,thinFilmThickness:na,baseF0:ra}),this.iridescenceF0=pI({f:this.iridescenceFresnel,f90:1,dotVH:t})}}},{key:"computeMultiscattering",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:On(1),r=Fh.dot(Fp).clamp(),i=lI({roughness:Yo,dotNV:r}),o=(this.iridescenceF0?ta.mix(ra,this.iridescenceF0):ra).mul(i.x).add(n.mul(i.y)),a=i.x.add(i.y).oneMinus(),s=ra.add(ra.oneMinus().mul(.047619)),u=o.mul(s).div(a.mul(s).oneMinus());t.addAssign(o),e.addAssign(u.mul(a))}},{key:"direct",value:function(t){var e=t.lightDirection,n=t.lightColor,r=t.reflectedLight,i=Fh.dot(e).clamp().mul(n);if(!0===this.sheen&&this.sheenSpecularDirect.addAssign(i.mul(yI({lightDirection:e}))),!0===this.clearcoat){var o=Vh.dot(e).clamp().mul(n);this.clearcoatSpecularDirect.addAssign(o.mul(uI({lightDirection:e,f0:PI,f90:RI,roughness:Ko,normalView:Vh})))}r.directDiffuse.addAssign(i.mul(Sj({diffuseColor:Xo.rgb}))),r.directSpecular.addAssign(i.mul(uI({lightDirection:e,f0:ra,f90:1,roughness:Yo,iridescence:this.iridescence,iridescenceFresnel:this.iridescenceFresnel})))}},{key:"indirectDiffuse",value:function(t){var e=t.irradiance;t.reflectedLight.indirectDiffuse.addAssign(e.mul(Sj({diffuseColor:Xo})))}},{key:"indirectSpecular",value:function(t){var e=t.radiance,n=t.iblIrradiance,r=t.reflectedLight;if(!0===this.sheen&&this.sheenSpecularIndirect.addAssign(n.mul(Qo,OI({normal:Fh,viewDir:Fp,roughness:$o}))),!0===this.clearcoat){var i=Vh.dot(Fp).clamp(),o=hI({dotNV:i,specularColor:PI,specularF90:RI,roughness:Ko});this.clearcoatSpecularIndirect.addAssign(this.clearcoatRadiance.mul(o))}var a=In().temp("singleScattering"),s=In().temp("multiScattering"),u=n.mul(1/Math.PI);this.computeMultiscattering(a,s);var c=a.add(s),l=Xo.mul(c.r.max(c.g).max(c.b).oneMinus());r.indirectSpecular.addAssign(e.mul(a)),r.indirectSpecular.addAssign(s.mul(u)),r.indirectDiffuse.addAssign(l.mul(u))}},{key:"ambientOcclusion",value:function(t){var e=t.ambientOcclusion,n=t.reflectedLight,r=Fh.dot(Fp).clamp().add(e),i=Yo.mul(-16).oneMinus().negate().exp2(),o=e.sub(r.pow(i).oneMinus()).clamp();!0===this.clearcoat&&this.clearcoatSpecularIndirect.mulAssign(e),!0===this.sheen&&this.sheenSpecularIndirect.mulAssign(e),n.indirectDiffuse.mulAssign(e),n.indirectSpecular.mulAssign(o)}},{key:"finish",value:function(t){var e=t.outgoingLight;if(!0===this.clearcoat){var n=Vh.dot(Fp).clamp(),r=wj({dotVH:n,f0:PI,f90:RI}),i=e.mul(Zo.mul(r).oneMinus()).add(this.clearcoatSpecularDirect.add(this.clearcoatSpecularIndirect).mul(Zo));e.assign(i)}if(!0===this.sheen){var o=Qo.r.max(Qo.g).max(Qo.b).mul(.157).oneMinus(),a=e.mul(o).add(this.sheenSpecularDirect,this.sheenSpecularIndirect);e.assign(a)}}}],r&&gI(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(Di);const CI=kI;function NI(t){return NI="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},NI(t)}function LI(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,jI(r.key),r)}}function jI(t){var e=function(t,e){if("object"!=NI(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=NI(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==NI(e)?e:e+""}function II(t,e,n){return e=DI(e),function(t,e){if(e&&("object"===NI(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,BI()?Reflect.construct(e,n||[],DI(t).constructor):e.apply(t,n))}function BI(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(BI=function(){return!!t})()}function UI(){return UI="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=DI(t)););return t}(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(arguments.length<3?t:n):i.value}},UI.apply(this,arguments)}function DI(t){return DI=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},DI(t)}function FI(t,e){return FI=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},FI(t,e)}var zI=new h._4j,VI=function(t){function e(t){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=II(this,e)).isMeshStandardNodeMaterial=!0,n.emissiveNode=null,n.metalnessNode=null,n.roughnessNode=null,n.setDefaultValues(zI),n.setValues(t),n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&FI(t,e)}(e,t),n=e,(r=[{key:"setupLightingModel",value:function(){return new CI}},{key:"setupVariants",value:function(){var t=this.metalnessNode?On(this.metalnessNode):up;Jo.assign(t);var e=this.roughnessNode?On(this.roughnessNode):sp;e=iI({roughness:e}),Yo.assign(e);var n=Mc(In(.04),Xo.rgb,t);ra.assign(n),Xo.assign(Fn(Xo.rgb.mul(t.oneMinus()),Xo.a))}},{key:"copy",value:function(t){return this.emissiveNode=t.emissiveNode,this.metalnessNode=t.metalnessNode,this.roughnessNode=t.roughnessNode,UI(DI(e.prototype),"copy",this).call(this,t)}}])&&LI(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(Cb);const GI=VI;function HI(t){return HI="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},HI(t)}function WI(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,qI(r.key),r)}}function qI(t){var e=function(t,e){if("object"!=HI(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=HI(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==HI(e)?e:e+""}function XI(t,e,n){return e=ZI(e),function(t,e){if(e&&("object"===HI(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,YI()?Reflect.construct(e,n||[],ZI(t).constructor):e.apply(t,n))}function YI(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(YI=function(){return!!t})()}function JI(){return JI="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=ZI(t)););return t}(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(arguments.length<3?t:n):i.value}},JI.apply(this,arguments)}function ZI(t){return ZI=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},ZI(t)}function KI(t,e){return KI=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},KI(t,e)}Nb("MeshStandardNodeMaterial",VI);var QI=new h.uSd,$I=function(t){function e(t){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=XI(this,e)).isMeshPhysicalNodeMaterial=!0,n.clearcoatNode=null,n.clearcoatRoughnessNode=null,n.clearcoatNormalNode=null,n.sheenNode=null,n.sheenRoughnessNode=null,n.iridescenceNode=null,n.iridescenceIORNode=null,n.iridescenceThicknessNode=null,n.specularIntensityNode=null,n.specularColorNode=null,n.transmissionNode=null,n.thicknessNode=null,n.attenuationDistanceNode=null,n.attenuationColorNode=null,n.setDefaultValues(QI),n.setValues(t),n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&KI(t,e)}(e,t),n=e,(r=[{key:"useClearcoat",get:function(){return this.clearcoat>0||null!==this.clearcoatNode}},{key:"useIridescence",get:function(){return this.iridescence>0||null!==this.iridescenceNode}},{key:"useSheen",get:function(){return this.sheen>0||null!==this.sheenNode}},{key:"setupLightingModel",value:function(){return new CI(this.useClearcoat,this.useSheen,this.useIridescence)}},{key:"setupVariants",value:function(t){if(JI(ZI(e.prototype),"setupVariants",this).call(this,t),this.useClearcoat){var n=this.clearcoatNode?On(this.clearcoatNode):lp,r=this.clearcoatRoughnessNode?On(this.clearcoatRoughnessNode):fp;Zo.assign(n),Ko.assign(r)}if(this.useSheen){var i=this.sheenNode?In(this.sheenNode):dp,o=this.sheenRoughnessNode?On(this.sheenRoughnessNode):mp;Qo.assign(i),$o.assign(o)}if(this.useIridescence){var a=this.iridescenceNode?On(this.iridescenceNode):yp,s=this.iridescenceIORNode?On(this.iridescenceIORNode):vp,u=this.iridescenceThicknessNode?On(this.iridescenceThicknessNode):gp;ta.assign(a),ea.assign(s),na.assign(u)}}},{key:"setupNormal",value:function(t){JI(ZI(e.prototype),"setupNormal",this).call(this,t);var n=this.clearcoatNormalNode?In(this.clearcoatNormalNode):hp;Vh.assign(n)}},{key:"copy",value:function(t){return this.clearcoatNode=t.clearcoatNode,this.clearcoatRoughnessNode=t.clearcoatRoughnessNode,this.clearcoatNormalNode=t.clearcoatNormalNode,this.sheenNode=t.sheenNode,this.sheenRoughnessNode=t.sheenRoughnessNode,this.iridescenceNode=t.iridescenceNode,this.iridescenceIORNode=t.iridescenceIORNode,this.iridescenceThicknessNode=t.iridescenceThicknessNode,this.specularIntensityNode=t.specularIntensityNode,this.specularColorNode=t.specularColorNode,this.transmissionNode=t.transmissionNode,this.thicknessNode=t.thicknessNode,this.attenuationDistanceNode=t.attenuationDistanceNode,this.attenuationColorNode=t.attenuationColorNode,JI(ZI(e.prototype),"copy",this).call(this,t)}}])&&WI(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(GI);const tB=$I;function eB(t){return eB="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},eB(t)}function nB(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function rB(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,oB(r.key),r)}}function iB(t,e,n){return e&&rB(t.prototype,e),n&&rB(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function oB(t){var e=function(t,e){if("object"!=eB(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=eB(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==eB(e)?e:e+""}function aB(t,e,n){return e=cB(e),function(t,e){if(e&&("object"===eB(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,sB()?Reflect.construct(e,n||[],cB(t).constructor):e.apply(t,n))}function sB(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(sB=function(){return!!t})()}function uB(){return uB="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=cB(t)););return t}(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(arguments.length<3?t:n):i.value}},uB.apply(this,arguments)}function cB(t){return cB=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},cB(t)}function lB(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&fB(t,e)}function fB(t,e){return fB=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},fB(t,e)}Nb("MeshPhysicalNodeMaterial",$I);var hB=function(t){function e(t,n,r,i){var o;return nB(this,e),(o=aB(this,e,[t,n,r])).useSSS=i,o}return lB(e,t),iB(e,[{key:"direct",value:function(t,n,r){var i=t.lightDirection,o=t.lightColor,a=t.reflectedLight;if(!0===this.useSSS){var s=r.material,u=s.thicknessColorNode,c=s.thicknessDistortionNode,l=s.thicknessAmbientNode,f=s.thicknessAttenuationNode,h=s.thicknessPowerNode,p=s.thicknessScaleNode,d=i.add(Fh.mul(c)).normalize(),m=On(Fp.dot(d.negate()).saturate().pow(h).mul(p)),y=In(m.add(l).mul(u));a.directDiffuse.addAssign(y.mul(f.mul(o)))}uB(cB(e.prototype),"direct",this).call(this,{lightDirection:i,lightColor:o,reflectedLight:a},n,r)}}])}(CI),pB=function(t){function e(t){var n;return nB(this,e),(n=aB(this,e,[t])).thicknessColorNode=null,n.thicknessDistortionNode=On(.1),n.thicknessAmbientNode=On(0),n.thicknessAttenuationNode=On(.1),n.thicknessPowerNode=On(2),n.thicknessScaleNode=On(10),n}return lB(e,t),iB(e,[{key:"useSSS",get:function(){return null!==this.thicknessColorNode}},{key:"setupLightingModel",value:function(){return new hB(this.useClearcoat,this.useSheen,this.useIridescence,this.useSSS)}},{key:"copy",value:function(t){return this.thicknessColorNode=t.thicknessColorNode,this.thicknessDistortionNode=t.thicknessDistortionNode,this.thicknessAmbientNode=t.thicknessAmbientNode,this.thicknessAttenuationNode=t.thicknessAttenuationNode,this.thicknessPowerNode=t.thicknessPowerNode,this.thicknessScaleNode=t.thicknessScaleNode,uB(cB(e.prototype),"copy",this).call(this,t)}}])}(tB);const dB=pB;function mB(t){return mB="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},mB(t)}function yB(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,vB(r.key),r)}}function vB(t){var e=function(t,e){if("object"!=mB(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=mB(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==mB(e)?e:e+""}function gB(t,e,n){return e=xB(e),function(t,e){if(e&&("object"===mB(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,bB()?Reflect.construct(e,n||[],xB(t).constructor):e.apply(t,n))}function bB(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(bB=function(){return!!t})()}function _B(){return _B="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=xB(t)););return t}(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(arguments.length<3?t:n):i.value}},_B.apply(this,arguments)}function xB(t){return xB=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},xB(t)}function wB(t,e){return wB=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},wB(t,e)}Nb("MeshSSSNodeMaterial",pB);var SB=new h.BH$,TB=function(t){function e(t){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=gB(this,e)).isPointsNodeMaterial=!0,n.lights=!1,n.normals=!1,n.transparent=!0,n.sizeNode=null,n.setDefaultValues(SB),n.setValues(t),n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&wB(t,e)}(e,t),n=e,(r=[{key:"copy",value:function(t){return this.sizeNode=t.sizeNode,_B(xB(e.prototype),"copy",this).call(this,t)}}])&&yB(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(Cb);const MB=TB;function EB(t){return EB="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},EB(t)}function AB(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,OB(r.key),r)}}function OB(t){var e=function(t,e){if("object"!=EB(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=EB(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==EB(e)?e:e+""}function PB(t,e,n){return e=CB(e),function(t,e){if(e&&("object"===EB(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,RB()?Reflect.construct(e,n||[],CB(t).constructor):e.apply(t,n))}function RB(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(RB=function(){return!!t})()}function kB(){return kB="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=CB(t)););return t}(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(arguments.length<3?t:n):i.value}},kB.apply(this,arguments)}function CB(t){return CB=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},CB(t)}function NB(t,e){return NB=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},NB(t,e)}Nb("PointsNodeMaterial",TB);var LB=new h.RoJ,jB=function(t){function e(t){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=PB(this,e)).isSpriteNodeMaterial=!0,n.lights=!1,n.normals=!1,n.positionNode=null,n.rotationNode=null,n.scaleNode=null,n.setDefaultValues(LB),n.setValues(t),n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&NB(t,e)}(e,t),n=e,r=[{key:"setupPosition",value:function(t){var e=t.object,n=t.context,r=this.positionNode,i=this.rotationNode,o=this.scaleNode,a=Ip,s=_h.mul(In(r||0)),u=Cn(wh[0].xyz.length(),wh[1].xyz.length());null!==o&&(u=u.mul(o));var c=a.xy;e.center&&!0===e.center.isVector2&&(c=c.sub(gs(e.center).sub(.5))),c=c.mul(u);var l=On(i||pp),f=c.rotate(l);s=Fn(s.xy.add(f),s.zw);var h=th.mul(s);return n.vertex=a,h}},{key:"copy",value:function(t){return this.positionNode=t.positionNode,this.rotationNode=t.rotationNode,this.scaleNode=t.scaleNode,kB(CB(e.prototype),"copy",this).call(this,t)}}],r&&AB(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(Cb);const IB=jB;function BB(t){return BB="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},BB(t)}function UB(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,DB(r.key),r)}}function DB(t){var e=function(t,e){if("object"!=BB(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=BB(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==BB(e)?e:e+""}function FB(t,e,n){return e=GB(e),function(t,e){if(e&&("object"===BB(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,zB()?Reflect.construct(e,n||[],GB(t).constructor):e.apply(t,n))}function zB(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(zB=function(){return!!t})()}function VB(){return VB="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=GB(t)););return t}(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(arguments.length<3?t:n):i.value}},VB.apply(this,arguments)}function GB(t){return GB=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},GB(t)}function HB(t,e){return HB=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},HB(t,e)}Nb("SpriteNodeMaterial",jB);var WB=h.jut.createMaterialFromType;h.jut.createMaterialFromType=function(t){var e=Lb(t);return void 0!==e?e:WB.call(this,t)};var qB=function(t){function e(t){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=FB(this,e,[t])).nodes={},n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&HB(t,e)}(e,t),n=e,r=[{key:"parse",value:function(t){var n=VB(GB(e.prototype),"parse",this).call(this,t),r=this.nodes,i=t.inputNodes;for(var o in i){var a=i[o];n[o]=r[a]}return n}},{key:"setNodes",value:function(t){return this.nodes=t,this}}],r&&UB(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(h.jut);const XB=qB;function YB(t){return YB="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},YB(t)}function JB(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,ZB(r.key),r)}}function ZB(t){var e=function(t,e){if("object"!=YB(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=YB(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==YB(e)?e:e+""}function KB(t,e,n){return e=tU(e),function(t,e){if(e&&("object"===YB(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,QB()?Reflect.construct(e,n||[],tU(t).constructor):e.apply(t,n))}function QB(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(QB=function(){return!!t})()}function $B(){return $B="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=tU(t)););return t}(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(arguments.length<3?t:n):i.value}},$B.apply(this,arguments)}function tU(t){return tU=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},tU(t)}function eU(t,e){return eU=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},eU(t,e)}var nU=function(t){function e(t){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=KB(this,e,[t]))._nodesJSON=null,n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&eU(t,e)}(e,t),n=e,(r=[{key:"parse",value:function(t,n){this._nodesJSON=t.nodes;var r=$B(tU(e.prototype),"parse",this).call(this,t,n);return this._nodesJSON=null,r}},{key:"parseNodes",value:function(t,e){if(void 0!==t){var n=new bL;return n.setTextures(e),n.parseNodes(t)}return{}}},{key:"parseMaterials",value:function(t,e){var n={};if(void 0!==t){var r=this.parseNodes(this._nodesJSON,e),i=new XB;i.setTextures(e),i.setNodes(r);for(var o=0,a=t.length;o<a;o++){var s=t[o];n[s.uuid]=i.parse(s)}}return n}}])&&JB(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(h.XTe);const rU=nU;var iU=n(9729),oU=n(7830);function aU(t){return aU="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},aU(t)}function sU(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,uU(r.key),r)}}function uU(t){var e=function(t,e){if("object"!=aU(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=aU(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==aU(e)?e:e+""}function cU(t,e,n){return e=fU(e),function(t,e){if(e&&("object"===aU(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,lU()?Reflect.construct(e,n||[],fU(t).constructor):e.apply(t,n))}function lU(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(lU=function(){return!!t})()}function fU(t){return fU=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},fU(t)}function hU(t,e){return hU=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},hU(t,e)}var pU=/^\s*(highp|mediump|lowp)?\s*([a-z_0-9]+)\s*([a-z_0-9]+)?\s*\(([\s\S]*?)\)/i,dU=/[a-z_0-9]+/gi,mU=function(t){function e(t){var n;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var r=function(t){var e=(t=t.trim()).indexOf("#pragma main"),n=-1!==e?t.slice(e+12):t,r=n.match(pU);if(null!==r&&5===r.length){for(var i=r[4],o=[],a=null;null!==(a=dU.exec(i));)o.push(a);for(var s=[],u=0;u<o.length;){var c="const"===o[u][0];!0===c&&u++;var l=o[u][0];"in"===l||"out"===l||"inout"===l?u++:l="";var f=o[u++][0],h=Number.parseInt(o[u][0]);!1===Number.isNaN(h)?u++:h=null;var p=o[u++][0];s.push(new Ux.A(f,p,h,l,c))}var d=n.substring(r[0].length),m=void 0!==r[3]?r[3]:"";return{type:r[2],inputs:s,name:m,presicion:void 0!==r[1]?r[1]:"",inputsCode:i,blockCode:d,headerCode:-1!==e?t.slice(0,e):""}}throw new Error("FunctionNode: Function is not a GLSL code.")}(t),i=r.type,o=r.inputs,a=r.name,s=r.presicion,u=r.inputsCode,c=r.blockCode,l=r.headerCode;return(n=cU(this,e,[i,o,a,s])).inputsCode=u,n.blockCode=c,n.headerCode=l,n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&hU(t,e)}(e,t),n=e,r=[{key:"getCode",value:function(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.name,n=this.blockCode;if(""!==n){var r=this.type,i=this.inputsCode,o=this.headerCode,a=this.presicion,s="".concat(r," ").concat(e," ( ").concat(i.trim()," )");""!==a&&(s="".concat(a," ").concat(s)),t=o+s+n}else t="";return t}}],r&&sU(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(oU.A);const yU=mU;function vU(t){return vU="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},vU(t)}function gU(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,bU(r.key),r)}}function bU(t){var e=function(t,e){if("object"!=vU(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=vU(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==vU(e)?e:e+""}function _U(t,e,n){return e=wU(e),function(t,e){if(e&&("object"===vU(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,xU()?Reflect.construct(e,n||[],wU(t).constructor):e.apply(t,n))}function xU(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(xU=function(){return!!t})()}function wU(t){return wU=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},wU(t)}function SU(t,e){return SU=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},SU(t,e)}var TU=function(t){function e(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),_U(this,e,arguments)}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&SU(t,e)}(e,t),n=e,(r=[{key:"parseFunction",value:function(t){return new yU(t)}}])&&gU(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(iU.A);const MU=TU;function EU(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,i,o,a,s=[],u=!0,c=!1;try{if(o=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=o.call(n)).done)&&(s.push(r.value),s.length!==e);u=!0);}catch(t){c=!0,i=t}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw i}}return s}}(t,e)||function(t,e){if(t){if("string"==typeof t)return AU(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?AU(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function AU(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var OU=wn((function(t){var e=EU(t,3),n=e[0],r=e[1],i=e[2],o=On(i).toVar(),a=On(r).toVar(),s=kn(n).toVar();return rv(s,a,o)})),PU=wn((function(t){var e=EU(t,2),n=e[0],r=e[1],i=kn(r).toVar(),o=On(n).toVar();return rv(i,o.negate(),o)})),RU=wn((function(t){var e=EU(t,1)[0],n=On(e).toVar();return Pn(Fu(n))})),kU=wn((function(t){var e=EU(t,2),n=e[0],r=e[1],i=On(n).toVar();return r.assign(RU(i)),i.sub(On(r))})),CU=wn((function(t){var e=EU(t,6),n=e[0],r=e[1],i=e[2],o=e[3],a=e[4],s=e[5],u=On(s).toVar(),c=On(a).toVar(),l=On(o).toVar(),f=On(i).toVar(),h=On(r).toVar(),p=On(n).toVar(),d=On(Js(1,c)).toVar();return Js(1,u).mul(p.mul(d).add(h.mul(c))).add(u.mul(f.mul(d).add(l.mul(c))))})),NU=wn((function(t){var e=EU(t,6),n=e[0],r=e[1],i=e[2],o=e[3],a=e[4],s=e[5],u=On(s).toVar(),c=On(a).toVar(),l=In(o).toVar(),f=In(i).toVar(),h=In(r).toVar(),p=In(n).toVar(),d=On(Js(1,c)).toVar();return Js(1,u).mul(p.mul(d).add(h.mul(c))).add(u.mul(f.mul(d).add(l.mul(c))))})),LU=qw([CU,NU]),jU=wn((function(t){var e=EU(t,11),n=e[0],r=e[1],i=e[2],o=e[3],a=e[4],s=e[5],u=e[6],c=e[7],l=e[8],f=e[9],h=e[10],p=On(h).toVar(),d=On(f).toVar(),m=On(l).toVar(),y=On(c).toVar(),v=On(u).toVar(),g=On(s).toVar(),b=On(a).toVar(),_=On(o).toVar(),x=On(i).toVar(),w=On(r).toVar(),S=On(n).toVar(),T=On(Js(1,m)).toVar(),M=On(Js(1,d)).toVar();return On(Js(1,p)).toVar().mul(M.mul(S.mul(T).add(w.mul(m))).add(d.mul(x.mul(T).add(_.mul(m))))).add(p.mul(M.mul(b.mul(T).add(g.mul(m))).add(d.mul(v.mul(T).add(y.mul(m))))))})),IU=wn((function(t){var e=EU(t,11),n=e[0],r=e[1],i=e[2],o=e[3],a=e[4],s=e[5],u=e[6],c=e[7],l=e[8],f=e[9],h=e[10],p=On(h).toVar(),d=On(f).toVar(),m=On(l).toVar(),y=In(c).toVar(),v=In(u).toVar(),g=In(s).toVar(),b=In(a).toVar(),_=In(o).toVar(),x=In(i).toVar(),w=In(r).toVar(),S=In(n).toVar(),T=On(Js(1,m)).toVar(),M=On(Js(1,d)).toVar();return On(Js(1,p)).toVar().mul(M.mul(S.mul(T).add(w.mul(m))).add(d.mul(x.mul(T).add(_.mul(m))))).add(p.mul(M.mul(b.mul(T).add(g.mul(m))).add(d.mul(v.mul(T).add(y.mul(m))))))})),BU=qw([jU,IU]),UU=wn((function(t){var e=EU(t,3),n=e[0],r=e[1],i=e[2],o=On(i).toVar(),a=On(r).toVar(),s=Rn(n).toVar(),u=Rn(s.bitAnd(Rn(7))).toVar(),c=On(OU(u.lessThan(Rn(4)),a,o)).toVar(),l=On(Zs(2,OU(u.lessThan(Rn(4)),o,a))).toVar();return PU(c,kn(u.bitAnd(Rn(1)))).add(PU(l,kn(u.bitAnd(Rn(2)))))})),DU=wn((function(t){var e=EU(t,4),n=e[0],r=e[1],i=e[2],o=e[3],a=On(o).toVar(),s=On(i).toVar(),u=On(r).toVar(),c=Rn(n).toVar(),l=Rn(c.bitAnd(Rn(15))).toVar(),f=On(OU(l.lessThan(Rn(8)),u,s)).toVar(),h=On(OU(l.lessThan(Rn(4)),s,OU(l.equal(Rn(12)).or(l.equal(Rn(14))),u,a))).toVar();return PU(f,kn(l.bitAnd(Rn(1)))).add(PU(h,kn(l.bitAnd(Rn(2)))))})),FU=qw([UU,DU]),zU=wn((function(t){var e=EU(t,3),n=e[0],r=e[1],i=e[2],o=On(i).toVar(),a=On(r).toVar(),s=Un(n).toVar();return In(FU(s.x,a,o),FU(s.y,a,o),FU(s.z,a,o))})),VU=wn((function(t){var e=EU(t,4),n=e[0],r=e[1],i=e[2],o=e[3],a=On(o).toVar(),s=On(i).toVar(),u=On(r).toVar(),c=Un(n).toVar();return In(FU(c.x,u,s,a),FU(c.y,u,s,a),FU(c.z,u,s,a))})),GU=qw([zU,VU]),HU=wn((function(t){var e=EU(t,1)[0],n=On(e).toVar();return Zs(.6616,n)})),WU=wn((function(t){var e=EU(t,1)[0],n=On(e).toVar();return Zs(.982,n)})),qU=wn((function(t){var e=EU(t,1)[0],n=In(e).toVar();return Zs(.6616,n)})),XU=qw([HU,qU]),YU=wn((function(t){var e=EU(t,1)[0],n=In(e).toVar();return Zs(.982,n)})),JU=qw([WU,YU]),ZU=wn((function(t){var e=EU(t,2),n=e[0],r=e[1],i=Pn(r).toVar(),o=Rn(n).toVar();return o.shiftLeft(i).bitOr(o.shiftRight(Pn(32).sub(i)))})),KU=wn((function(t){var e=EU(t,3),n=e[0],r=e[1],i=e[2];n.subAssign(i),n.bitXorAssign(ZU(i,Pn(4))),i.addAssign(r),r.subAssign(n),r.bitXorAssign(ZU(n,Pn(6))),n.addAssign(i),i.subAssign(r),i.bitXorAssign(ZU(r,Pn(8))),r.addAssign(n),n.subAssign(i),n.bitXorAssign(ZU(i,Pn(16))),i.addAssign(r),r.subAssign(n),r.bitXorAssign(ZU(n,Pn(19))),n.addAssign(i),i.subAssign(r),i.bitXorAssign(ZU(r,Pn(4))),r.addAssign(n)})),QU=wn((function(t){var e=EU(t,3),n=e[0],r=e[1],i=e[2],o=Rn(i).toVar(),a=Rn(r).toVar(),s=Rn(n).toVar();return o.bitXorAssign(a),o.subAssign(ZU(a,Pn(14))),s.bitXorAssign(o),s.subAssign(ZU(o,Pn(11))),a.bitXorAssign(s),a.subAssign(ZU(s,Pn(25))),o.bitXorAssign(a),o.subAssign(ZU(a,Pn(16))),s.bitXorAssign(o),s.subAssign(ZU(o,Pn(4))),a.bitXorAssign(s),a.subAssign(ZU(s,Pn(14))),o.bitXorAssign(a),o.subAssign(ZU(a,Pn(24))),o})),$U=wn((function(t){var e=EU(t,1)[0],n=Rn(e).toVar();return On(n).div(On(Rn(Pn(4294967295))))})),tD=wn((function(t){var e=EU(t,1)[0],n=On(e).toVar();return n.mul(n.mul(n.mul(n.mul(n.mul(6).sub(15)).add(10))))})),eD=wn((function(t){var e=EU(t,1)[0],n=Pn(e).toVar(),r=Rn(Rn(1)).toVar(),i=Rn(Rn(Pn(3735928559)).add(r.shiftLeft(Rn(2)).add(Rn(13)))).toVar();return QU(i.add(Rn(n)),i,i)})),nD=wn((function(t){var e=EU(t,2),n=e[0],r=e[1],i=Pn(r).toVar(),o=Pn(n).toVar(),a=Rn(Rn(2)).toVar(),s=Rn().toVar(),u=Rn().toVar(),c=Rn().toVar();return s.assign(u.assign(c.assign(Rn(Pn(3735928559)).add(a.shiftLeft(Rn(2)).add(Rn(13)))))),s.addAssign(Rn(o)),u.addAssign(Rn(i)),QU(s,u,c)})),rD=wn((function(t){var e=EU(t,3),n=e[0],r=e[1],i=e[2],o=Pn(i).toVar(),a=Pn(r).toVar(),s=Pn(n).toVar(),u=Rn(Rn(3)).toVar(),c=Rn().toVar(),l=Rn().toVar(),f=Rn().toVar();return c.assign(l.assign(f.assign(Rn(Pn(3735928559)).add(u.shiftLeft(Rn(2)).add(Rn(13)))))),c.addAssign(Rn(s)),l.addAssign(Rn(a)),f.addAssign(Rn(o)),QU(c,l,f)})),iD=wn((function(t){var e=EU(t,4),n=e[0],r=e[1],i=e[2],o=e[3],a=Pn(o).toVar(),s=Pn(i).toVar(),u=Pn(r).toVar(),c=Pn(n).toVar(),l=Rn(Rn(4)).toVar(),f=Rn().toVar(),h=Rn().toVar(),p=Rn().toVar();return f.assign(h.assign(p.assign(Rn(Pn(3735928559)).add(l.shiftLeft(Rn(2)).add(Rn(13)))))),f.addAssign(Rn(c)),h.addAssign(Rn(u)),p.addAssign(Rn(s)),KU(f,h,p),f.addAssign(Rn(a)),QU(f,h,p)})),oD=wn((function(t){var e=EU(t,5),n=e[0],r=e[1],i=e[2],o=e[3],a=e[4],s=Pn(a).toVar(),u=Pn(o).toVar(),c=Pn(i).toVar(),l=Pn(r).toVar(),f=Pn(n).toVar(),h=Rn(Rn(5)).toVar(),p=Rn().toVar(),d=Rn().toVar(),m=Rn().toVar();return p.assign(d.assign(m.assign(Rn(Pn(3735928559)).add(h.shiftLeft(Rn(2)).add(Rn(13)))))),p.addAssign(Rn(f)),d.addAssign(Rn(l)),m.addAssign(Rn(c)),KU(p,d,m),p.addAssign(Rn(u)),d.addAssign(Rn(s)),QU(p,d,m)})),aD=qw([eD,nD,rD,iD,oD]),sD=wn((function(t){var e=EU(t,2),n=e[0],r=e[1],i=Pn(r).toVar(),o=Pn(n).toVar(),a=Rn(aD(o,i)).toVar(),s=Un().toVar();return s.x.assign(a.bitAnd(Pn(255))),s.y.assign(a.shiftRight(Pn(8)).bitAnd(Pn(255))),s.z.assign(a.shiftRight(Pn(16)).bitAnd(Pn(255))),s})),uD=wn((function(t){var e=EU(t,3),n=e[0],r=e[1],i=e[2],o=Pn(i).toVar(),a=Pn(r).toVar(),s=Pn(n).toVar(),u=Rn(aD(s,a,o)).toVar(),c=Un().toVar();return c.x.assign(u.bitAnd(Pn(255))),c.y.assign(u.shiftRight(Pn(8)).bitAnd(Pn(255))),c.z.assign(u.shiftRight(Pn(16)).bitAnd(Pn(255))),c})),cD=qw([sD,uD]),lD=wn((function(t){var e=EU(t,1)[0],n=Cn(e).toVar(),r=Pn().toVar(),i=Pn().toVar(),o=On(kU(n.x,r)).toVar(),a=On(kU(n.y,i)).toVar(),s=On(tD(o)).toVar(),u=On(tD(a)).toVar(),c=On(LU(FU(aD(r,i),o,a),FU(aD(r.add(Pn(1)),i),o.sub(1),a),FU(aD(r,i.add(Pn(1))),o,a.sub(1)),FU(aD(r.add(Pn(1)),i.add(Pn(1))),o.sub(1),a.sub(1)),s,u)).toVar();return XU(c)})),fD=wn((function(t){var e=EU(t,1)[0],n=In(e).toVar(),r=Pn().toVar(),i=Pn().toVar(),o=Pn().toVar(),a=On(kU(n.x,r)).toVar(),s=On(kU(n.y,i)).toVar(),u=On(kU(n.z,o)).toVar(),c=On(tD(a)).toVar(),l=On(tD(s)).toVar(),f=On(tD(u)).toVar(),h=On(BU(FU(aD(r,i,o),a,s,u),FU(aD(r.add(Pn(1)),i,o),a.sub(1),s,u),FU(aD(r,i.add(Pn(1)),o),a,s.sub(1),u),FU(aD(r.add(Pn(1)),i.add(Pn(1)),o),a.sub(1),s.sub(1),u),FU(aD(r,i,o.add(Pn(1))),a,s,u.sub(1)),FU(aD(r.add(Pn(1)),i,o.add(Pn(1))),a.sub(1),s,u.sub(1)),FU(aD(r,i.add(Pn(1)),o.add(Pn(1))),a,s.sub(1),u.sub(1)),FU(aD(r.add(Pn(1)),i.add(Pn(1)),o.add(Pn(1))),a.sub(1),s.sub(1),u.sub(1)),c,l,f)).toVar();return JU(h)})),hD=qw([lD,fD]),pD=wn((function(t){var e=EU(t,1)[0],n=Cn(e).toVar(),r=Pn().toVar(),i=Pn().toVar(),o=On(kU(n.x,r)).toVar(),a=On(kU(n.y,i)).toVar(),s=On(tD(o)).toVar(),u=On(tD(a)).toVar(),c=In(LU(GU(cD(r,i),o,a),GU(cD(r.add(Pn(1)),i),o.sub(1),a),GU(cD(r,i.add(Pn(1))),o,a.sub(1)),GU(cD(r.add(Pn(1)),i.add(Pn(1))),o.sub(1),a.sub(1)),s,u)).toVar();return XU(c)})),dD=wn((function(t){var e=EU(t,1)[0],n=In(e).toVar(),r=Pn().toVar(),i=Pn().toVar(),o=Pn().toVar(),a=On(kU(n.x,r)).toVar(),s=On(kU(n.y,i)).toVar(),u=On(kU(n.z,o)).toVar(),c=On(tD(a)).toVar(),l=On(tD(s)).toVar(),f=On(tD(u)).toVar(),h=In(BU(GU(cD(r,i,o),a,s,u),GU(cD(r.add(Pn(1)),i,o),a.sub(1),s,u),GU(cD(r,i.add(Pn(1)),o),a,s.sub(1),u),GU(cD(r.add(Pn(1)),i.add(Pn(1)),o),a.sub(1),s.sub(1),u),GU(cD(r,i,o.add(Pn(1))),a,s,u.sub(1)),GU(cD(r.add(Pn(1)),i,o.add(Pn(1))),a.sub(1),s,u.sub(1)),GU(cD(r,i.add(Pn(1)),o.add(Pn(1))),a,s.sub(1),u.sub(1)),GU(cD(r.add(Pn(1)),i.add(Pn(1)),o.add(Pn(1))),a.sub(1),s.sub(1),u.sub(1)),c,l,f)).toVar();return JU(h)})),mD=qw([pD,dD]),yD=wn((function(t){var e=EU(t,1)[0],n=On(e).toVar(),r=Pn(RU(n)).toVar();return $U(aD(r))})),vD=wn((function(t){var e=EU(t,1)[0],n=Cn(e).toVar(),r=Pn(RU(n.x)).toVar(),i=Pn(RU(n.y)).toVar();return $U(aD(r,i))})),gD=wn((function(t){var e=EU(t,1)[0],n=In(e).toVar(),r=Pn(RU(n.x)).toVar(),i=Pn(RU(n.y)).toVar(),o=Pn(RU(n.z)).toVar();return $U(aD(r,i,o))})),bD=wn((function(t){var e=EU(t,1)[0],n=Fn(e).toVar(),r=Pn(RU(n.x)).toVar(),i=Pn(RU(n.y)).toVar(),o=Pn(RU(n.z)).toVar(),a=Pn(RU(n.w)).toVar();return $U(aD(r,i,o,a))})),_D=qw([yD,vD,gD,bD]),xD=wn((function(t){var e=EU(t,1)[0],n=On(e).toVar(),r=Pn(RU(n)).toVar();return In($U(aD(r,Pn(0))),$U(aD(r,Pn(1))),$U(aD(r,Pn(2))))})),wD=wn((function(t){var e=EU(t,1)[0],n=Cn(e).toVar(),r=Pn(RU(n.x)).toVar(),i=Pn(RU(n.y)).toVar();return In($U(aD(r,i,Pn(0))),$U(aD(r,i,Pn(1))),$U(aD(r,i,Pn(2))))})),SD=wn((function(t){var e=EU(t,1)[0],n=In(e).toVar(),r=Pn(RU(n.x)).toVar(),i=Pn(RU(n.y)).toVar(),o=Pn(RU(n.z)).toVar();return In($U(aD(r,i,o,Pn(0))),$U(aD(r,i,o,Pn(1))),$U(aD(r,i,o,Pn(2))))})),TD=wn((function(t){var e=EU(t,1)[0],n=Fn(e).toVar(),r=Pn(RU(n.x)).toVar(),i=Pn(RU(n.y)).toVar(),o=Pn(RU(n.z)).toVar(),a=Pn(RU(n.w)).toVar();return In($U(aD(r,i,o,a,Pn(0))),$U(aD(r,i,o,a,Pn(1))),$U(aD(r,i,o,a,Pn(2))))})),MD=qw([xD,wD,SD,TD]),ED=wn((function(t){var e=EU(t,4),n=e[0],r=e[1],i=e[2],o=e[3],a=On(o).toVar(),s=On(i).toVar(),u=Pn(r).toVar(),c=In(n).toVar(),l=On(0).toVar(),f=On(1).toVar();return fm({start:Pn(0),end:u},(function(t){t.i,l.addAssign(f.mul(hD(c))),f.mulAssign(a),c.mulAssign(s)})),l})),AD=wn((function(t){var e=EU(t,4),n=e[0],r=e[1],i=e[2],o=e[3],a=On(o).toVar(),s=On(i).toVar(),u=Pn(r).toVar(),c=In(n).toVar(),l=In(0).toVar(),f=On(1).toVar();return fm({start:Pn(0),end:u},(function(t){t.i,l.addAssign(f.mul(mD(c))),f.mulAssign(a),c.mulAssign(s)})),l})),OD=wn((function(t){var e=EU(t,4),n=e[0],r=e[1],i=e[2],o=e[3],a=On(o).toVar(),s=On(i).toVar(),u=Pn(r).toVar(),c=In(n).toVar();return Cn(ED(c,u,s,a),ED(c.add(In(Pn(19),Pn(193),Pn(17))),u,s,a))})),PD=wn((function(t){var e=EU(t,4),n=e[0],r=e[1],i=e[2],o=e[3],a=On(o).toVar(),s=On(i).toVar(),u=Pn(r).toVar(),c=In(n).toVar(),l=In(AD(c,u,s,a)).toVar(),f=On(ED(c.add(In(Pn(19),Pn(193),Pn(17))),u,s,a)).toVar();return Fn(l,f)})),RD=wn((function(t){var e=EU(t,7),n=e[0],r=e[1],i=e[2],o=e[3],a=e[4],s=e[5],u=e[6],c=Pn(u).toVar(),l=On(s).toVar(),f=Pn(a).toVar(),h=Pn(o).toVar(),p=Pn(i).toVar(),d=Pn(r).toVar(),m=Cn(n).toVar(),y=In(MD(Cn(d.add(h),p.add(f)))).toVar(),v=Cn(y.x,y.y).toVar();v.subAssign(.5),v.mulAssign(l),v.addAssign(.5);var g=Cn(Cn(On(d),On(p)).add(v)).toVar(),b=Cn(g.sub(m)).toVar();return Mn(c.equal(Pn(2)),(function(){return Zu(b.x).add(Zu(b.y))})),Mn(c.equal(Pn(3)),(function(){return lc(Zu(b.x),Zu(b.y))})),yc(b,b)})),kD=wn((function(t){var e=EU(t,9),n=e[0],r=e[1],i=e[2],o=e[3],a=e[4],s=e[5],u=e[6],c=e[7],l=e[8],f=Pn(l).toVar(),h=On(c).toVar(),p=Pn(u).toVar(),d=Pn(s).toVar(),m=Pn(a).toVar(),y=Pn(o).toVar(),v=Pn(i).toVar(),g=Pn(r).toVar(),b=In(n).toVar(),_=In(MD(In(g.add(m),v.add(d),y.add(p)))).toVar();_.subAssign(.5),_.mulAssign(h),_.addAssign(.5);var x=In(In(On(g),On(v),On(y)).add(_)).toVar(),w=In(x.sub(b)).toVar();return Mn(f.equal(Pn(2)),(function(){return Zu(w.x).add(Zu(w.y).add(Zu(w.z)))})),Mn(f.equal(Pn(3)),(function(){return lc(lc(Zu(w.x),Zu(w.y)),Zu(w.z))})),yc(w,w)})),CD=qw([RD,kD]),ND=wn((function(t){var e=EU(t,3),n=e[0],r=e[1],i=e[2],o=Pn(i).toVar(),a=On(r).toVar(),s=Cn(n).toVar(),u=Pn().toVar(),c=Pn().toVar(),l=Cn(kU(s.x,u),kU(s.y,c)).toVar(),f=On(1e6).toVar();return fm({start:-1,end:Pn(1),name:"x",condition:"<="},(function(t){var e=t.x;fm({start:-1,end:Pn(1),name:"y",condition:"<="},(function(t){var n=t.y,r=On(CD(l,e,n,u,c,a,o)).toVar();f.assign(cc(f,r))}))})),Mn(o.equal(Pn(0)),(function(){f.assign(Uu(f))})),f})),LD=wn((function(t){var e=EU(t,3),n=e[0],r=e[1],i=e[2],o=Pn(i).toVar(),a=On(r).toVar(),s=Cn(n).toVar(),u=Pn().toVar(),c=Pn().toVar(),l=Cn(kU(s.x,u),kU(s.y,c)).toVar(),f=Cn(1e6,1e6).toVar();return fm({start:-1,end:Pn(1),name:"x",condition:"<="},(function(t){var e=t.x;fm({start:-1,end:Pn(1),name:"y",condition:"<="},(function(t){var n=t.y,r=On(CD(l,e,n,u,c,a,o)).toVar();Mn(r.lessThan(f.x),(function(){f.y.assign(f.x),f.x.assign(r)})).elseif(r.lessThan(f.y),(function(){f.y.assign(r)}))}))})),Mn(o.equal(Pn(0)),(function(){f.assign(Uu(f))})),f})),jD=wn((function(t){var e=EU(t,3),n=e[0],r=e[1],i=e[2],o=Pn(i).toVar(),a=On(r).toVar(),s=Cn(n).toVar(),u=Pn().toVar(),c=Pn().toVar(),l=Cn(kU(s.x,u),kU(s.y,c)).toVar(),f=In(1e6,1e6,1e6).toVar();return fm({start:-1,end:Pn(1),name:"x",condition:"<="},(function(t){var e=t.x;fm({start:-1,end:Pn(1),name:"y",condition:"<="},(function(t){var n=t.y,r=On(CD(l,e,n,u,c,a,o)).toVar();Mn(r.lessThan(f.x),(function(){f.z.assign(f.y),f.y.assign(f.x),f.x.assign(r)})).elseif(r.lessThan(f.y),(function(){f.z.assign(f.y),f.y.assign(r)})).elseif(r.lessThan(f.z),(function(){f.z.assign(r)}))}))})),Mn(o.equal(Pn(0)),(function(){f.assign(Uu(f))})),f})),ID=wn((function(t){var e=EU(t,3),n=e[0],r=e[1],i=e[2],o=Pn(i).toVar(),a=On(r).toVar(),s=In(n).toVar(),u=Pn().toVar(),c=Pn().toVar(),l=Pn().toVar(),f=In(kU(s.x,u),kU(s.y,c),kU(s.z,l)).toVar(),h=On(1e6).toVar();return fm({start:-1,end:Pn(1),name:"x",condition:"<="},(function(t){var e=t.x;fm({start:-1,end:Pn(1),name:"y",condition:"<="},(function(t){var n=t.y;fm({start:-1,end:Pn(1),name:"z",condition:"<="},(function(t){var r=t.z,i=On(CD(f,e,n,r,u,c,l,a,o)).toVar();h.assign(cc(h,i))}))}))})),Mn(o.equal(Pn(0)),(function(){h.assign(Uu(h))})),h})),BD=qw([ND,ID]),UD=wn((function(t){var e=EU(t,3),n=e[0],r=e[1],i=e[2],o=Pn(i).toVar(),a=On(r).toVar(),s=In(n).toVar(),u=Pn().toVar(),c=Pn().toVar(),l=Pn().toVar(),f=In(kU(s.x,u),kU(s.y,c),kU(s.z,l)).toVar(),h=Cn(1e6,1e6).toVar();return fm({start:-1,end:Pn(1),name:"x",condition:"<="},(function(t){var e=t.x;fm({start:-1,end:Pn(1),name:"y",condition:"<="},(function(t){var n=t.y;fm({start:-1,end:Pn(1),name:"z",condition:"<="},(function(t){var r=t.z,i=On(CD(f,e,n,r,u,c,l,a,o)).toVar();Mn(i.lessThan(h.x),(function(){h.y.assign(h.x),h.x.assign(i)})).elseif(i.lessThan(h.y),(function(){h.y.assign(i)}))}))}))})),Mn(o.equal(Pn(0)),(function(){h.assign(Uu(h))})),h})),DD=qw([LD,UD]),FD=wn((function(t){var e=EU(t,3),n=e[0],r=e[1],i=e[2],o=Pn(i).toVar(),a=On(r).toVar(),s=In(n).toVar(),u=Pn().toVar(),c=Pn().toVar(),l=Pn().toVar(),f=In(kU(s.x,u),kU(s.y,c),kU(s.z,l)).toVar(),h=In(1e6,1e6,1e6).toVar();return fm({start:-1,end:Pn(1),name:"x",condition:"<="},(function(t){var e=t.x;fm({start:-1,end:Pn(1),name:"y",condition:"<="},(function(t){var n=t.y;fm({start:-1,end:Pn(1),name:"z",condition:"<="},(function(t){var r=t.z,i=On(CD(f,e,n,r,u,c,l,a,o)).toVar();Mn(i.lessThan(h.x),(function(){h.z.assign(h.y),h.y.assign(h.x),h.x.assign(i)})).elseif(i.lessThan(h.y),(function(){h.z.assign(h.y),h.y.assign(i)})).elseif(i.lessThan(h.z),(function(){h.z.assign(i)}))}))}))})),Mn(o.equal(Pn(0)),(function(){h.assign(Uu(h))})),h})),zD=qw([jD,FD]);function VD(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,i,o,a,s=[],u=!0,c=!1;try{if(o=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=o.call(n)).done)&&(s.push(r.value),s.length!==e);u=!0);}catch(t){c=!0,i=t}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw i}}return s}}(t,e)||function(t,e){if(t){if("string"==typeof t)return GD(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?GD(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function GD(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}OU.setLayout({name:"mx_select",type:"float",inputs:[{name:"b",type:"bool"},{name:"t",type:"float"},{name:"f",type:"float"}]}),PU.setLayout({name:"mx_negate_if",type:"float",inputs:[{name:"val",type:"float"},{name:"b",type:"bool"}]}),RU.setLayout({name:"mx_floor",type:"int",inputs:[{name:"x",type:"float"}]}),CU.setLayout({name:"mx_bilerp_0",type:"float",inputs:[{name:"v0",type:"float"},{name:"v1",type:"float"},{name:"v2",type:"float"},{name:"v3",type:"float"},{name:"s",type:"float"},{name:"t",type:"float"}]}),NU.setLayout({name:"mx_bilerp_1",type:"vec3",inputs:[{name:"v0",type:"vec3"},{name:"v1",type:"vec3"},{name:"v2",type:"vec3"},{name:"v3",type:"vec3"},{name:"s",type:"float"},{name:"t",type:"float"}]}),jU.setLayout({name:"mx_trilerp_0",type:"float",inputs:[{name:"v0",type:"float"},{name:"v1",type:"float"},{name:"v2",type:"float"},{name:"v3",type:"float"},{name:"v4",type:"float"},{name:"v5",type:"float"},{name:"v6",type:"float"},{name:"v7",type:"float"},{name:"s",type:"float"},{name:"t",type:"float"},{name:"r",type:"float"}]}),IU.setLayout({name:"mx_trilerp_1",type:"vec3",inputs:[{name:"v0",type:"vec3"},{name:"v1",type:"vec3"},{name:"v2",type:"vec3"},{name:"v3",type:"vec3"},{name:"v4",type:"vec3"},{name:"v5",type:"vec3"},{name:"v6",type:"vec3"},{name:"v7",type:"vec3"},{name:"s",type:"float"},{name:"t",type:"float"},{name:"r",type:"float"}]}),UU.setLayout({name:"mx_gradient_float_0",type:"float",inputs:[{name:"hash",type:"uint"},{name:"x",type:"float"},{name:"y",type:"float"}]}),DU.setLayout({name:"mx_gradient_float_1",type:"float",inputs:[{name:"hash",type:"uint"},{name:"x",type:"float"},{name:"y",type:"float"},{name:"z",type:"float"}]}),zU.setLayout({name:"mx_gradient_vec3_0",type:"vec3",inputs:[{name:"hash",type:"uvec3"},{name:"x",type:"float"},{name:"y",type:"float"}]}),VU.setLayout({name:"mx_gradient_vec3_1",type:"vec3",inputs:[{name:"hash",type:"uvec3"},{name:"x",type:"float"},{name:"y",type:"float"},{name:"z",type:"float"}]}),HU.setLayout({name:"mx_gradient_scale2d_0",type:"float",inputs:[{name:"v",type:"float"}]}),WU.setLayout({name:"mx_gradient_scale3d_0",type:"float",inputs:[{name:"v",type:"float"}]}),qU.setLayout({name:"mx_gradient_scale2d_1",type:"vec3",inputs:[{name:"v",type:"vec3"}]}),YU.setLayout({name:"mx_gradient_scale3d_1",type:"vec3",inputs:[{name:"v",type:"vec3"}]}),ZU.setLayout({name:"mx_rotl32",type:"uint",inputs:[{name:"x",type:"uint"},{name:"k",type:"int"}]}),QU.setLayout({name:"mx_bjfinal",type:"uint",inputs:[{name:"a",type:"uint"},{name:"b",type:"uint"},{name:"c",type:"uint"}]}),$U.setLayout({name:"mx_bits_to_01",type:"float",inputs:[{name:"bits",type:"uint"}]}),tD.setLayout({name:"mx_fade",type:"float",inputs:[{name:"t",type:"float"}]}),eD.setLayout({name:"mx_hash_int_0",type:"uint",inputs:[{name:"x",type:"int"}]}),nD.setLayout({name:"mx_hash_int_1",type:"uint",inputs:[{name:"x",type:"int"},{name:"y",type:"int"}]}),rD.setLayout({name:"mx_hash_int_2",type:"uint",inputs:[{name:"x",type:"int"},{name:"y",type:"int"},{name:"z",type:"int"}]}),iD.setLayout({name:"mx_hash_int_3",type:"uint",inputs:[{name:"x",type:"int"},{name:"y",type:"int"},{name:"z",type:"int"},{name:"xx",type:"int"}]}),oD.setLayout({name:"mx_hash_int_4",type:"uint",inputs:[{name:"x",type:"int"},{name:"y",type:"int"},{name:"z",type:"int"},{name:"xx",type:"int"},{name:"yy",type:"int"}]}),sD.setLayout({name:"mx_hash_vec3_0",type:"uvec3",inputs:[{name:"x",type:"int"},{name:"y",type:"int"}]}),uD.setLayout({name:"mx_hash_vec3_1",type:"uvec3",inputs:[{name:"x",type:"int"},{name:"y",type:"int"},{name:"z",type:"int"}]}),lD.setLayout({name:"mx_perlin_noise_float_0",type:"float",inputs:[{name:"p",type:"vec2"}]}),fD.setLayout({name:"mx_perlin_noise_float_1",type:"float",inputs:[{name:"p",type:"vec3"}]}),pD.setLayout({name:"mx_perlin_noise_vec3_0",type:"vec3",inputs:[{name:"p",type:"vec2"}]}),dD.setLayout({name:"mx_perlin_noise_vec3_1",type:"vec3",inputs:[{name:"p",type:"vec3"}]}),yD.setLayout({name:"mx_cell_noise_float_0",type:"float",inputs:[{name:"p",type:"float"}]}),vD.setLayout({name:"mx_cell_noise_float_1",type:"float",inputs:[{name:"p",type:"vec2"}]}),gD.setLayout({name:"mx_cell_noise_float_2",type:"float",inputs:[{name:"p",type:"vec3"}]}),bD.setLayout({name:"mx_cell_noise_float_3",type:"float",inputs:[{name:"p",type:"vec4"}]}),xD.setLayout({name:"mx_cell_noise_vec3_0",type:"vec3",inputs:[{name:"p",type:"float"}]}),wD.setLayout({name:"mx_cell_noise_vec3_1",type:"vec3",inputs:[{name:"p",type:"vec2"}]}),SD.setLayout({name:"mx_cell_noise_vec3_2",type:"vec3",inputs:[{name:"p",type:"vec3"}]}),TD.setLayout({name:"mx_cell_noise_vec3_3",type:"vec3",inputs:[{name:"p",type:"vec4"}]}),ED.setLayout({name:"mx_fractal_noise_float",type:"float",inputs:[{name:"p",type:"vec3"},{name:"octaves",type:"int"},{name:"lacunarity",type:"float"},{name:"diminish",type:"float"}]}),AD.setLayout({name:"mx_fractal_noise_vec3",type:"vec3",inputs:[{name:"p",type:"vec3"},{name:"octaves",type:"int"},{name:"lacunarity",type:"float"},{name:"diminish",type:"float"}]}),OD.setLayout({name:"mx_fractal_noise_vec2",type:"vec2",inputs:[{name:"p",type:"vec3"},{name:"octaves",type:"int"},{name:"lacunarity",type:"float"},{name:"diminish",type:"float"}]}),PD.setLayout({name:"mx_fractal_noise_vec4",type:"vec4",inputs:[{name:"p",type:"vec3"},{name:"octaves",type:"int"},{name:"lacunarity",type:"float"},{name:"diminish",type:"float"}]}),RD.setLayout({name:"mx_worley_distance_0",type:"float",inputs:[{name:"p",type:"vec2"},{name:"x",type:"int"},{name:"y",type:"int"},{name:"xoff",type:"int"},{name:"yoff",type:"int"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),kD.setLayout({name:"mx_worley_distance_1",type:"float",inputs:[{name:"p",type:"vec3"},{name:"x",type:"int"},{name:"y",type:"int"},{name:"z",type:"int"},{name:"xoff",type:"int"},{name:"yoff",type:"int"},{name:"zoff",type:"int"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),ND.setLayout({name:"mx_worley_noise_float_0",type:"float",inputs:[{name:"p",type:"vec2"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),LD.setLayout({name:"mx_worley_noise_vec2_0",type:"vec2",inputs:[{name:"p",type:"vec2"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),jD.setLayout({name:"mx_worley_noise_vec3_0",type:"vec3",inputs:[{name:"p",type:"vec2"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),ID.setLayout({name:"mx_worley_noise_float_1",type:"float",inputs:[{name:"p",type:"vec3"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),UD.setLayout({name:"mx_worley_noise_vec2_1",type:"vec2",inputs:[{name:"p",type:"vec3"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),FD.setLayout({name:"mx_worley_noise_vec3_1",type:"vec3",inputs:[{name:"p",type:"vec3"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]});var HD=wn((function(t){var e=VD(t,1)[0],n=In(e).toVar(),r=On(n.x).toVar(),i=On(n.y).toVar(),o=On(n.z).toVar();Mn(i.lessThan(1e-4),(function(){return In(o,o,o)})).else((function(){r.assign(Zs(6,r.sub(Fu(r))));var t=Pn(oc(r)).toVar(),e=On(r.sub(On(t))).toVar(),n=On(o.mul(Js(1,i))).toVar(),a=On(o.mul(Js(1,i.mul(e)))).toVar(),s=On(o.mul(Js(1,i.mul(Js(1,e))))).toVar();return Mn(t.equal(Pn(0)),(function(){return In(o,s,n)})).elseif(t.equal(Pn(1)),(function(){return In(a,o,n)})).elseif(t.equal(Pn(2)),(function(){return In(n,o,s)})).elseif(t.equal(Pn(3)),(function(){return In(n,a,o)})).elseif(t.equal(Pn(4)),(function(){return In(s,n,o)})),In(o,n,a)}))})),WD=wn((function(t){var e=VD(t,1)[0],n=In(e).toVar(),r=On(n.x).toVar(),i=On(n.y).toVar(),o=On(n.z).toVar(),a=On(cc(r,cc(i,o))).toVar(),s=On(lc(r,lc(i,o))).toVar(),u=On(s.sub(a)).toVar(),c=On().toVar(),l=On().toVar(),f=On().toVar();return f.assign(s),Mn(s.greaterThan(0),(function(){l.assign(u.div(s))})).else((function(){l.assign(0)})),Mn(l.lessThanEqual(0),(function(){c.assign(0)})).else((function(){Mn(r.greaterThanEqual(s),(function(){c.assign(i.sub(o).div(u))})).elseif(i.greaterThanEqual(s),(function(){c.assign(Ys(2,o.sub(r).div(u)))})).else((function(){c.assign(Ys(4,r.sub(i).div(u)))})),c.mulAssign(1/6),Mn(c.lessThan(0),(function(){c.addAssign(1)}))})),In(c,l,f)}));function qD(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}HD.setLayout({name:"mx_hsvtorgb",type:"vec3",inputs:[{name:"hsv",type:"vec3"}]}),WD.setLayout({name:"mx_rgbtohsv",type:"vec3",inputs:[{name:"c",type:"vec3"}]});var XD=wn((function(t){var e,n,r=(e=t,n=1,function(t){if(Array.isArray(t))return t}(e)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,i,o,a,s=[],u=!0,c=!1;try{if(o=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=o.call(n)).done)&&(s.push(r.value),s.length!==e);u=!0);}catch(t){c=!0,i=t}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw i}}return s}}(e,n)||function(t,e){if(t){if("string"==typeof t)return qD(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?qD(t,e):void 0}}(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}())[0],i=In(r).toVar(),o=Dn(nu(i,In(.04045))).toVar(),a=In(i.div(12.92)).toVar(),s=In(gc(lc(i.add(In(.055)),In(0)).div(1.055),In(2.4))).toVar();return Mc(a,s,o)}));XD.setLayout({name:"mx_srgb_texture_to_lin_rec709",type:"vec3",inputs:[{name:"color",type:"vec3"}]});var YD=function(t,e){t=On(t),e=On(e);var n=Cn(e.dFdx(),e.dFdy()).length().mul(.7071067811865476);return Pc(t.sub(n),t.add(n),e)},JD=function(t,e,n,r){return Mc(t,e,n[r].clamp())},ZD=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Os();return JD(t,e,n,"x")},KD=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Os();return JD(t,e,n,"y")},QD=function(t,e,n,r,i){return Mc(t,e,YD(n,r[i]))},$D=function(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Os();return QD(t,e,n,r,"x")},tF=function(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Os();return QD(t,e,n,r,"y")},eF=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return(arguments.length>2&&void 0!==arguments[2]?arguments[2]:Os()).mul(t).add(e)},nF=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return(t=On(t)).abs().pow(e).mul(t.sign())},rF=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.5;return On(t).sub(n).mul(e).add(n)},iF=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Os(),e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return hD(t.convert("vec2|vec3")).mul(e).add(n)},oF=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Os(),e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return mD(t.convert("vec2|vec3")).mul(e).add(n)},aF=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Os(),e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return t=t.convert("vec2|vec3"),Fn(mD(t),hD(t.add(Cn(19,73)))).mul(e).add(n)},sF=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Os(),e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return BD(t.convert("vec2|vec3"),e,Pn(1))},uF=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Os(),e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return DD(t.convert("vec2|vec3"),e,Pn(1))},cF=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Os(),e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return zD(t.convert("vec2|vec3"),e,Pn(1))},lF=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Os();return _D(t.convert("vec2|vec3"))},fF=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Os(),e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;return ED(t,Pn(arguments.length>1&&void 0!==arguments[1]?arguments[1]:3),e,n).mul(r)},hF=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Os(),e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;return OD(t,Pn(arguments.length>1&&void 0!==arguments[1]?arguments[1]:3),e,n).mul(r)},pF=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Os(),e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;return AD(t,Pn(arguments.length>1&&void 0!==arguments[1]?arguments[1]:3),e,n).mul(r)},dF=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Os(),e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;return PD(t,Pn(arguments.length>1&&void 0!==arguments[1]?arguments[1]:3),e,n).mul(r)}},7830:(t,e,n)=>{function r(t){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r(t)}function i(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,o(r.key),r)}}function o(t){var e=function(t,e){if("object"!=r(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var i=n.call(t,"string");if("object"!=r(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==r(e)?e:e+""}n.d(e,{A:()=>s});var a=function(){return t=function t(e,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.type=e,this.inputs=n,this.name=r,this.presicion=i},(e=[{key:"getCode",value:function(){console.warn("Abstract function.")}}])&&i(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();a.isNodeFunction=!0;const s=a},1248:(t,e,n)=>{function r(t){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r(t)}function i(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,a(r.key),r)}}function o(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function a(t){var e=function(t,e){if("object"!=r(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var i=n.call(t,"string");if("object"!=r(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==r(e)?e:e+""}n.d(e,{A:()=>u});var s=o((function t(e,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",o=arguments.length>4&&void 0!==arguments[4]&&arguments[4];!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.type=e,this.name=n,this.count=r,this.qualifier=i,this.isConst=o}));s.isNodeFunctionInput=!0;const u=s},9729:(t,e,n)=>{function r(t){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r(t)}function i(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,o(r.key),r)}}function o(t){var e=function(t,e){if("object"!=r(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var i=n.call(t,"string");if("object"!=r(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==r(e)?e:e+""}n.d(e,{A:()=>a});const a=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)},(e=[{key:"parseFunction",value:function(){console.warn("Abstract function.")}}])&&i(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}()},4770:(t,e,n)=>{n.r(e),n.d(e,{Sky:()=>c});var r=n(554);function i(t){return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},i(t)}function o(t,e,n){return e=s(e),function(t,e){if(e&&("object"===i(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,a()?Reflect.construct(e,n||[],s(t).constructor):e.apply(t,n))}function a(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(a=function(){return!!t})()}function s(t){return s=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},s(t)}function u(t,e){return u=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},u(t,e)}var c=function(t){function e(){var t;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var n=e.SkyShader,i=new r.BKk({name:n.name,uniforms:r.LlO.clone(n.uniforms),vertexShader:n.vertexShader,fragmentShader:n.fragmentShader,side:r.hsX,depthWrite:!1});return(t=o(this,e,[new r.iNn(1,1,1),i])).isSky=!0,t}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&u(t,e)}(e,t),n=e,Object.defineProperty(n,"prototype",{writable:!1}),n;var n}(r.eaF);c.SkyShader={name:"SkyShader",uniforms:{turbidity:{value:2},rayleigh:{value:1},mieCoefficient:{value:.005},mieDirectionalG:{value:.8},sunPosition:{value:new r.Pq0},up:{value:new r.Pq0(0,1,0)}},vertexShader:"\n\t\tuniform vec3 sunPosition;\n\t\tuniform float rayleigh;\n\t\tuniform float turbidity;\n\t\tuniform float mieCoefficient;\n\t\tuniform vec3 up;\n\n\t\tvarying vec3 vWorldPosition;\n\t\tvarying vec3 vSunDirection;\n\t\tvarying float vSunfade;\n\t\tvarying vec3 vBetaR;\n\t\tvarying vec3 vBetaM;\n\t\tvarying float vSunE;\n\n\t\t// constants for atmospheric scattering\n\t\tconst float e = 2.71828182845904523536028747135266249775724709369995957;\n\t\tconst float pi = 3.141592653589793238462643383279502884197169;\n\n\t\t// wavelength of used primaries, according to preetham\n\t\tconst vec3 lambda = vec3( 680E-9, 550E-9, 450E-9 );\n\t\t// this pre-calcuation replaces older TotalRayleigh(vec3 lambda) function:\n\t\t// (8.0 * pow(pi, 3.0) * pow(pow(n, 2.0) - 1.0, 2.0) * (6.0 + 3.0 * pn)) / (3.0 * N * pow(lambda, vec3(4.0)) * (6.0 - 7.0 * pn))\n\t\tconst vec3 totalRayleigh = vec3( 5.804542996261093E-6, 1.3562911419845635E-5, 3.0265902468824876E-5 );\n\n\t\t// mie stuff\n\t\t// K coefficient for the primaries\n\t\tconst float v = 4.0;\n\t\tconst vec3 K = vec3( 0.686, 0.678, 0.666 );\n\t\t// MieConst = pi * pow( ( 2.0 * pi ) / lambda, vec3( v - 2.0 ) ) * K\n\t\tconst vec3 MieConst = vec3( 1.8399918514433978E14, 2.7798023919660528E14, 4.0790479543861094E14 );\n\n\t\t// earth shadow hack\n\t\t// cutoffAngle = pi / 1.95;\n\t\tconst float cutoffAngle = 1.6110731556870734;\n\t\tconst float steepness = 1.5;\n\t\tconst float EE = 1000.0;\n\n\t\tfloat sunIntensity( float zenithAngleCos ) {\n\t\t\tzenithAngleCos = clamp( zenithAngleCos, -1.0, 1.0 );\n\t\t\treturn EE * max( 0.0, 1.0 - pow( e, -( ( cutoffAngle - acos( zenithAngleCos ) ) / steepness ) ) );\n\t\t}\n\n\t\tvec3 totalMie( float T ) {\n\t\t\tfloat c = ( 0.2 * T ) * 10E-18;\n\t\t\treturn 0.434 * c * MieConst;\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvec4 worldPosition = modelMatrix * vec4( position, 1.0 );\n\t\t\tvWorldPosition = worldPosition.xyz;\n\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\tgl_Position.z = gl_Position.w; // set z to camera.far\n\n\t\t\tvSunDirection = normalize( sunPosition );\n\n\t\t\tvSunE = sunIntensity( dot( vSunDirection, up ) );\n\n\t\t\tvSunfade = 1.0 - clamp( 1.0 - exp( ( sunPosition.y / 450000.0 ) ), 0.0, 1.0 );\n\n\t\t\tfloat rayleighCoefficient = rayleigh - ( 1.0 * ( 1.0 - vSunfade ) );\n\n\t\t\t// extinction (absorbtion + out scattering)\n\t\t\t// rayleigh coefficients\n\t\t\tvBetaR = totalRayleigh * rayleighCoefficient;\n\n\t\t\t// mie coefficients\n\t\t\tvBetaM = totalMie( turbidity ) * mieCoefficient;\n\n\t\t}",fragmentShader:"\n\t\tvarying vec3 vWorldPosition;\n\t\tvarying vec3 vSunDirection;\n\t\tvarying float vSunfade;\n\t\tvarying vec3 vBetaR;\n\t\tvarying vec3 vBetaM;\n\t\tvarying float vSunE;\n\n\t\tuniform float mieDirectionalG;\n\t\tuniform vec3 up;\n\n\t\t// constants for atmospheric scattering\n\t\tconst float pi = 3.141592653589793238462643383279502884197169;\n\n\t\tconst float n = 1.0003; // refractive index of air\n\t\tconst float N = 2.545E25; // number of molecules per unit volume for air at 288.15K and 1013mb (sea level -45 celsius)\n\n\t\t// optical length at zenith for molecules\n\t\tconst float rayleighZenithLength = 8.4E3;\n\t\tconst float mieZenithLength = 1.25E3;\n\t\t// 66 arc seconds -> degrees, and the cosine of that\n\t\tconst float sunAngularDiameterCos = 0.999956676946448443553574619906976478926848692873900859324;\n\n\t\t// 3.0 / ( 16.0 * pi )\n\t\tconst float THREE_OVER_SIXTEENPI = 0.05968310365946075;\n\t\t// 1.0 / ( 4.0 * pi )\n\t\tconst float ONE_OVER_FOURPI = 0.07957747154594767;\n\n\t\tfloat rayleighPhase( float cosTheta ) {\n\t\t\treturn THREE_OVER_SIXTEENPI * ( 1.0 + pow( cosTheta, 2.0 ) );\n\t\t}\n\n\t\tfloat hgPhase( float cosTheta, float g ) {\n\t\t\tfloat g2 = pow( g, 2.0 );\n\t\t\tfloat inverse = 1.0 / pow( 1.0 - 2.0 * g * cosTheta + g2, 1.5 );\n\t\t\treturn ONE_OVER_FOURPI * ( ( 1.0 - g2 ) * inverse );\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvec3 direction = normalize( vWorldPosition - cameraPosition );\n\n\t\t\t// optical length\n\t\t\t// cutoff angle at 90 to avoid singularity in next formula.\n\t\t\tfloat zenithAngle = acos( max( 0.0, dot( up, direction ) ) );\n\t\t\tfloat inverse = 1.0 / ( cos( zenithAngle ) + 0.15 * pow( 93.885 - ( ( zenithAngle * 180.0 ) / pi ), -1.253 ) );\n\t\t\tfloat sR = rayleighZenithLength * inverse;\n\t\t\tfloat sM = mieZenithLength * inverse;\n\n\t\t\t// combined extinction factor\n\t\t\tvec3 Fex = exp( -( vBetaR * sR + vBetaM * sM ) );\n\n\t\t\t// in scattering\n\t\t\tfloat cosTheta = dot( direction, vSunDirection );\n\n\t\t\tfloat rPhase = rayleighPhase( cosTheta * 0.5 + 0.5 );\n\t\t\tvec3 betaRTheta = vBetaR * rPhase;\n\n\t\t\tfloat mPhase = hgPhase( cosTheta, mieDirectionalG );\n\t\t\tvec3 betaMTheta = vBetaM * mPhase;\n\n\t\t\tvec3 Lin = pow( vSunE * ( ( betaRTheta + betaMTheta ) / ( vBetaR + vBetaM ) ) * ( 1.0 - Fex ), vec3( 1.5 ) );\n\t\t\tLin *= mix( vec3( 1.0 ), pow( vSunE * ( ( betaRTheta + betaMTheta ) / ( vBetaR + vBetaM ) ) * Fex, vec3( 1.0 / 2.0 ) ), clamp( pow( 1.0 - dot( up, vSunDirection ), 5.0 ), 0.0, 1.0 ) );\n\n\t\t\t// nightsky\n\t\t\tfloat theta = acos( direction.y ); // elevation --\x3e y-axis, [-pi/2, pi/2]\n\t\t\tfloat phi = atan( direction.z, direction.x ); // azimuth --\x3e x-axis [-pi/2, pi/2]\n\t\t\tvec2 uv = vec2( phi, theta ) / vec2( 2.0 * pi, pi ) + vec2( 0.5, 0.0 );\n\t\t\tvec3 L0 = vec3( 0.1 ) * Fex;\n\n\t\t\t// composition + solar disc\n\t\t\tfloat sundisk = smoothstep( sunAngularDiameterCos, sunAngularDiameterCos + 0.00002, cosTheta );\n\t\t\tL0 += ( vSunE * 19000.0 * Fex ) * sundisk;\n\n\t\t\tvec3 texColor = ( Lin + L0 ) * 0.04 + vec3( 0.0, 0.0003, 0.00075 );\n\n\t\t\tvec3 retColor = pow( texColor, vec3( 1.0 / ( 1.2 + ( 1.2 * vSunfade ) ) ) );\n\n\t\t\tgl_FragColor = vec4( retColor, 1.0 );\n\n\t\t\t#include <tonemapping_fragment>\n\t\t\t#include <colorspace_fragment>\n\n\t\t}"}},6945:(t,e,n)=>{n.d(e,{A:()=>p});var r=n(1256),i=n(554);function o(t){return o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},o(t)}function a(){a=function(){return e};var t,e={},n=Object.prototype,r=n.hasOwnProperty,i=Object.defineProperty||function(t,e,n){t[e]=n.value},s="function"==typeof Symbol?Symbol:{},u=s.iterator||"@@iterator",c=s.asyncIterator||"@@asyncIterator",l=s.toStringTag||"@@toStringTag";function f(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{f({},"")}catch(t){f=function(t,e,n){return t[e]=n}}function h(t,e,n,r){var o=e&&e.prototype instanceof b?e:b,a=Object.create(o.prototype),s=new C(r||[]);return i(a,"_invoke",{value:O(t,n,s)}),a}function p(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}e.wrap=h;var d="suspendedStart",m="suspendedYield",y="executing",v="completed",g={};function b(){}function _(){}function x(){}var w={};f(w,u,(function(){return this}));var S=Object.getPrototypeOf,T=S&&S(S(N([])));T&&T!==n&&r.call(T,u)&&(w=T);var M=x.prototype=b.prototype=Object.create(w);function E(t){["next","throw","return"].forEach((function(e){f(t,e,(function(t){return this._invoke(e,t)}))}))}function A(t,e){function n(i,a,s,u){var c=p(t[i],t,a);if("throw"!==c.type){var l=c.arg,f=l.value;return f&&"object"==o(f)&&r.call(f,"__await")?e.resolve(f.__await).then((function(t){n("next",t,s,u)}),(function(t){n("throw",t,s,u)})):e.resolve(f).then((function(t){l.value=t,s(l)}),(function(t){return n("throw",t,s,u)}))}u(c.arg)}var a;i(this,"_invoke",{value:function(t,r){function i(){return new e((function(e,i){n(t,r,e,i)}))}return a=a?a.then(i,i):i()}})}function O(e,n,r){var i=d;return function(o,a){if(i===y)throw Error("Generator is already running");if(i===v){if("throw"===o)throw a;return{value:t,done:!0}}for(r.method=o,r.arg=a;;){var s=r.delegate;if(s){var u=P(s,r);if(u){if(u===g)continue;return u}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(i===d)throw i=v,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);i=y;var c=p(e,n,r);if("normal"===c.type){if(i=r.done?v:m,c.arg===g)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(i=v,r.method="throw",r.arg=c.arg)}}}function P(e,n){var r=n.method,i=e.iterator[r];if(i===t)return n.delegate=null,"throw"===r&&e.iterator.return&&(n.method="return",n.arg=t,P(e,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),g;var o=p(i,e.iterator,n.arg);if("throw"===o.type)return n.method="throw",n.arg=o.arg,n.delegate=null,g;var a=o.arg;return a?a.done?(n[e.resultName]=a.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,g):a:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,g)}function R(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function k(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function C(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(R,this),this.reset(!0)}function N(e){if(e||""===e){var n=e[u];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,a=function n(){for(;++i<e.length;)if(r.call(e,i))return n.value=e[i],n.done=!1,n;return n.value=t,n.done=!0,n};return a.next=a}}throw new TypeError(o(e)+" is not iterable")}return _.prototype=x,i(M,"constructor",{value:x,configurable:!0}),i(x,"constructor",{value:_,configurable:!0}),_.displayName=f(x,l,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===_||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,x):(t.__proto__=x,f(t,l,"GeneratorFunction")),t.prototype=Object.create(M),t},e.awrap=function(t){return{__await:t}},E(A.prototype),f(A.prototype,c,(function(){return this})),e.AsyncIterator=A,e.async=function(t,n,r,i,o){void 0===o&&(o=Promise);var a=new A(h(t,n,r,i),o);return e.isGeneratorFunction(n)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},E(M),f(M,l,"Generator"),f(M,u,(function(){return this})),f(M,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),n=[];for(var r in e)n.push(r);return n.reverse(),function t(){for(;n.length;){var r=n.pop();if(r in e)return t.value=r,t.done=!1,t}return t.done=!0,t}},e.values=N,C.prototype={constructor:C,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(k),!e)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function i(r,i){return s.type="throw",s.arg=e,n.next=r,i&&(n.method="next",n.arg=t),!!i}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],s=a.completion;if("root"===a.tryLoc)return i("end");if(a.tryLoc<=this.prev){var u=r.call(a,"catchLoc"),c=r.call(a,"finallyLoc");if(u&&c){if(this.prev<a.catchLoc)return i(a.catchLoc,!0);if(this.prev<a.finallyLoc)return i(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return i(a.catchLoc,!0)}else{if(!c)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return i(a.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=t,a.arg=e,o?(this.method="next",this.next=o.finallyLoc,g):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),g},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),k(n),g}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var i=r.arg;k(n)}return i}}throw Error("illegal catch attempt")},delegateYield:function(e,n,r){return this.delegate={iterator:N(e),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=t),g}},e}function s(t,e,n,r,i,o,a){try{var s=t[o](a),u=s.value}catch(t){return void n(t)}s.done?e(u):Promise.resolve(u).then(r,i)}function u(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,c(r.key),r)}}function c(t){var e=function(t,e){if("object"!=o(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=o(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==o(e)?e:e+""}var l=null,f=null,h=null;const p=function(){return t=function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.parameters=Object.assign({},e),this.data=new WeakMap,this.renderer=null,this.domElement=null},e=[{key:"init",value:(n=a().mark((function t(e){return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this.renderer=e;case 1:case"end":return t.stop()}}),t,this)})),o=function(){var t=this,e=arguments;return new Promise((function(r,i){var o=n.apply(t,e);function a(t){s(o,r,i,a,u,"next",t)}function u(t){s(o,r,i,a,u,"throw",t)}a(void 0)}))},function(t){return o.apply(this,arguments)})},{key:"begin",value:function(t){}},{key:"finish",value:function(t){}},{key:"draw",value:function(t,e){}},{key:"createProgram",value:function(t){}},{key:"destroyProgram",value:function(t){}},{key:"createBindings",value:function(t){}},{key:"updateBindings",value:function(t){}},{key:"createRenderPipeline",value:function(t){}},{key:"createComputePipeline",value:function(t,e){}},{key:"destroyPipeline",value:function(t){}},{key:"needsRenderUpdate",value:function(t){}},{key:"getRenderCacheKey",value:function(t){}},{key:"createNodeBuilder",value:function(t){}},{key:"createSampler",value:function(t){}},{key:"createDefaultTexture",value:function(t){}},{key:"createTexture",value:function(t){}},{key:"copyTextureToBuffer",value:function(t,e,n,r,i){}},{key:"createAttribute",value:function(t){}},{key:"createIndexAttribute",value:function(t){}},{key:"updateAttribute",value:function(t){}},{key:"destroyAttribute",value:function(t){}},{key:"getContext",value:function(){}},{key:"updateSize",value:function(){}},{key:"resolveTimestampAsync",value:function(t,e){}},{key:"hasFeatureAsync",value:function(t){}},{key:"hasFeature",value:function(t){}},{key:"getInstanceCount",value:function(t){var e=t.object,n=t.geometry;return n.isInstancedBufferGeometry?n.instanceCount:e.isInstancedMesh?e.count:1}},{key:"getDrawingBufferSize",value:function(){return l=l||new i.I9Y,this.renderer.getDrawingBufferSize(l)}},{key:"getScissor",value:function(){return f=f||new i.IUQ,this.renderer.getScissor(f)}},{key:"setScissorTest",value:function(t){}},{key:"getClearColor",value:function(){var t=this.renderer;return h=h||new r.A,t.getClearColor(h),h.getRGB(h,this.renderer.currentColorSpace),h}},{key:"getDomElement",value:function(){var t=this.domElement;return null===t&&("setAttribute"in(t=void 0!==this.parameters.canvas?this.parameters.canvas:(0,i.lPF)())&&t.setAttribute("data-engine","three.js r".concat(i.sPf," webgpu")),this.domElement=t),t}},{key:"set",value:function(t,e){this.data.set(t,e)}},{key:"get",value:function(t){var e=this.data.get(t);return void 0===e&&(e={},this.data.set(t,e)),e}},{key:"has",value:function(t){return this.data.has(t)}},{key:"delete",value:function(t){this.data.delete(t)}}],e&&u(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,n,o}()},6068:(t,e,n)=>{function r(t){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r(t)}function i(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,o(r.key),r)}}function o(t){var e=function(t,e){if("object"!=r(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var i=n.call(t,"string");if("object"!=r(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==r(e)?e:e+""}n.d(e,{A:()=>a});const a=function(){return t=function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.name=e,this.visibility=0},(e=[{key:"setVisibility",value:function(t){this.visibility|=t}},{key:"clone",value:function(){return Object.assign(new this.constructor,this)}}])&&i(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}()},2718:(t,e,n)=>{n.d(e,{A:()=>h});var r=n(6068),i=n(4408);function o(t){return o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},o(t)}function a(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,s(r.key),r)}}function s(t){var e=function(t,e){if("object"!=o(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=o(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==o(e)?e:e+""}function u(t,e,n){return e=l(e),function(t,e){if(e&&("object"===o(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,c()?Reflect.construct(e,n||[],l(t).constructor):e.apply(t,n))}function c(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(c=function(){return!!t})()}function l(t){return l=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},l(t)}function f(t,e){return f=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},f(t,e)}const h=function(t){function e(t){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=u(this,e,[t])).isBuffer=!0,n.bytesPerElement=Float32Array.BYTES_PER_ELEMENT,n._buffer=r,n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&f(t,e)}(e,t),n=e,(r=[{key:"byteLength",get:function(){return(t=this._buffer.byteLength)+(i.HA-t%i.HA)%i.HA;var t}},{key:"buffer",get:function(){return this._buffer}},{key:"update",value:function(){return!0}}])&&a(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(r.A)},476:(t,e,n)=>{function r(t){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r(t)}function i(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,o(r.key),r)}}function o(t){var e=function(t,e){if("object"!=r(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var i=n.call(t,"string");if("object"!=r(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==r(e)?e:e+""}function a(){return a="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=s(t)););return t}(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(arguments.length<3?t:n):i.value}},a.apply(this,arguments)}function s(t){return s=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},s(t)}n.d(e,{A:()=>u});var u=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.weakMap=new WeakMap}return e=t,(n=[{key:"get",value:function(e){if(Array.isArray(e)){for(var n=this.weakMap,r=0;r<e.length;r++)if(void 0===(n=n.get(e[r])))return;return n.get(e[e.length-1])}return a(s(t.prototype),"get",this).call(this,e)}},{key:"set",value:function(e,n){if(Array.isArray(e)){for(var r=this.weakMap,i=0;i<e.length;i++){var o=e[i];!1===r.has(o)&&r.set(o,new WeakMap),r=r.get(o)}return r.set(e[e.length-1],n)}return a(s(t.prototype),"set",this).call(this,e,n)}},{key:"delete",value:function(e){if(Array.isArray(e)){for(var n=this.weakMap,r=0;r<e.length;r++)if(void 0===(n=n.get(e[r])))return!1;return n.delete(e[e.length-1])}return a(s(t.prototype),"delete",this).call(this,e)}},{key:"dispose",value:function(){this.weakMap.clear()}}])&&i(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,n}()},1256:(t,e,n)=>{function r(t){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r(t)}function i(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,o(r.key),r)}}function o(t){var e=function(t,e){if("object"!=r(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var i=n.call(t,"string");if("object"!=r(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==r(e)?e:e+""}function a(t,e,n){return e=c(e),function(t,e){if(e&&("object"===r(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,s()?Reflect.construct(e,n||[],c(t).constructor):e.apply(t,n))}function s(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(s=function(){return!!t})()}function u(){return u="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=c(t)););return t}(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(arguments.length<3?t:n):i.value}},u.apply(this,arguments)}function c(t){return c=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},c(t)}function l(t,e){return l=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},l(t,e)}n.d(e,{A:()=>f});const f=function(t){function e(t,n,r){var i,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(i=a(this,e,[t,n,r])).a=o,i}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&l(t,e)}(e,t),n=e,r=[{key:"set",value:function(t,n,r){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return this.a=i,u(c(e.prototype),"set",this).call(this,t,n,r)}},{key:"copy",value:function(t){return void 0!==t.a&&(this.a=t.a),u(c(e.prototype),"copy",this).call(this,t)}},{key:"clone",value:function(){return new this.constructor(this.r,this.g,this.b,this.a)}}],r&&i(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(n(554).Q1f)},4408:(t,e,n)=>{n.d(e,{HA:()=>i,eI:()=>a,jQ:()=>r,sD:()=>o});var r={VERTEX:1,INDEX:2,STORAGE:4},i=16,o=211,a=212},9042:(t,e,n)=>{function r(t){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r(t)}function i(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,o(r.key),r)}}function o(t){var e=function(t,e){if("object"!=r(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var i=n.call(t,"string");if("object"!=r(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==r(e)?e:e+""}n.d(e,{A:()=>cn});const a=function(){return t=function t(e,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.nodes=e,this.info=n,this.animationLoop=null,this.requestId=null,this._init()},(e=[{key:"_init",value:function(){var t=this;!function e(n,r){t.requestId=self.requestAnimationFrame(e),!0===t.info.autoReset&&t.info.reset(),t.nodes.nodeFrame.update(),t.info.frame=t.nodes.nodeFrame.frameId,null!==t.animationLoop&&t.animationLoop(n,r)}()}},{key:"dispose",value:function(){self.cancelAnimationFrame(this.requestId),this.requestId=null}},{key:"setAnimationLoop",value:function(t){this.animationLoop=t}}])&&i(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();var s=n(476),u=n(554);function c(t){return c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},c(t)}function l(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,f(r.key),r)}}function f(t){var e=function(t,e){if("object"!=c(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=c(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==c(e)?e:e+""}var h=new u.Zcv,p=new u.dwI,d=0;const m=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.version=++d,this.globalClippingCount=0,this.localClippingCount=0,this.localClippingEnabled=!1,this.localClipIntersection=!1,this.planes=[],this.parentVersion=0},(e=[{key:"projectPlanes",value:function(t,e){for(var n=t.length,r=this.planes,i=0;i<n;i++){h.copy(t[i]).applyMatrix4(this.viewMatrix,p);var o=r[e+i],a=h.normal;o.x=-a.x,o.y=-a.y,o.z=-a.z,o.w=h.constant}}},{key:"updateGlobal",value:function(t,e){var n=t.clippingPlanes;this.viewMatrix=e.matrixWorldInverse,p.getNormalMatrix(this.viewMatrix);var r=!1;if(Array.isArray(n)&&0!==n.length){var i=n.length;if(i!==this.globalClippingCount){for(var o=[],a=0;a<i;a++)o.push(new u.IUQ);this.globalClippingCount=i,this.planes=o,r=!0}this.projectPlanes(n,0)}else 0!==this.globalClippingCount&&(this.globalClippingCount=0,this.planes=[],r=!0);t.localClippingEnabled!==this.localClippingEnabled&&(this.localClippingEnabled=t.localClippingEnabled,r=!0),r&&(this.version=d++)}},{key:"update",value:function(t,e){var n=!1;if(this!==t&&t.version!==this.parentVersion&&(this.globalClippingCount=e.isShadowNodeMaterial?0:t.globalClippingCount,this.localClippingEnabled=t.localClippingEnabled,this.planes=Array.from(t.planes),this.parentVersion=t.version,this.viewMatrix=t.viewMatrix,n=!0),this.localClippingEnabled){var r=e.clippingPlanes;if(Array.isArray(r)&&0!==r.length){var i=r.length,o=this.planes,a=this.globalClippingCount;if(n||i!==this.localClippingCount){o.length=a+i;for(var s=0;s<i;s++)o[a+s]=new u.IUQ;this.localClippingCount=i,n=!0}this.projectPlanes(r,a)}else 0!==this.localClippingCount&&(this.localClippingCount=0,n=!0);this.localClipIntersection!==e.clipIntersection&&(this.localClipIntersection=e.clipIntersection,n=!0)}n&&(this.version=d++)}}])&&l(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();function y(t){return y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},y(t)}function v(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function g(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,b(r.key),r)}}function b(t){var e=function(t,e){if("object"!=y(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=y(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==y(e)?e:e+""}var _=0,x=function(){return t=function t(e,n,r,i,o,a,s,u,c){var l=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._nodes=e,this._geometries=n,this.id=_++,this.renderer=r,this.object=i,this.material=o,this.scene=a,this.camera=s,this.lightsNode=u,this.context=c,this.geometry=i.geometry,this.version=o.version,this.attributes=null,this.pipeline=null,this.vertexBuffers=null,this.updateClipping(c.clippingContext),this.clippingContextVersion=this.clippingContext.version,this.initialNodesCacheKey=this.getNodesCacheKey(),this.initialCacheKey=this.getCacheKey(),this._nodeBuilderState=null,this._bindings=null,this.onDispose=null,this.isRenderObject=!0,this.onMaterialDispose=function(){l.dispose()},this.material.addEventListener("dispose",this.onMaterialDispose)},(e=[{key:"updateClipping",value:function(t){var e=this.material,n=this.clippingContext;Array.isArray(e.clippingPlanes)?(n!==t&&n||(n=new m,this.clippingContext=n),n.update(t,e)):this.clippingContext!==t&&(this.clippingContext=t)}},{key:"clippingNeedsUpdate",get:function(){return this.clippingContext.version!==this.clippingContextVersion&&(this.clippingContextVersion=this.clippingContext.version,!0)}},{key:"getNodeBuilderState",value:function(){return this._nodeBuilderState||(this._nodeBuilderState=this._nodes.getForRender(this))}},{key:"getBindings",value:function(){return this._bindings||(this._bindings=this.getNodeBuilderState().createBindings())}},{key:"getIndex",value:function(){return this._geometries.getIndex(this)}},{key:"getChainArray",value:function(){return[this.object,this.material,this.context,this.lightsNode]}},{key:"getAttributes",value:function(){if(null!==this.attributes)return this.attributes;var t,e=this.getNodeBuilderState().nodeAttributes,n=this.geometry,r=[],i=new Set,o=function(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return v(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?v(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}(e);try{for(o.s();!(t=o.n()).done;){var a=t.value,s=a.node&&a.node.attribute?a.node.attribute:n.getAttribute(a.name);if(void 0!==s){r.push(s);var u=s.isInterleavedBufferAttribute?s.data:s;i.add(u)}}}catch(t){o.e(t)}finally{o.f()}return this.attributes=r,this.vertexBuffers=Array.from(i.values()),r}},{key:"getVertexBuffers",value:function(){return null===this.vertexBuffers&&this.getAttributes(),this.vertexBuffers}},{key:"getMaterialCacheKey",value:function(){var t=this.object,e=this.material,n=e.customProgramCacheKey();for(var r in e)if(!/^(is[A-Z]|_)|^(visible|version|uuid|name|opacity|userData)$/.test(r)){var i=e[r];if(null!==i){var o=y(i);"number"===o?i=0!==i?"1":"0":"object"===o&&(i="{}")}n+=i+","}return n+=this.clippingContextVersion+",",t.skeleton&&(n+=t.skeleton.bones.length+","),t.morphTargetInfluences&&(n+=t.morphTargetInfluences.length+","),n}},{key:"needsUpdate",get:function(){return this.initialNodesCacheKey!==this.getNodesCacheKey()||this.clippingNeedsUpdate}},{key:"getNodesCacheKey",value:function(){return this._nodes.getCacheKey(this.scene,this.lightsNode)}},{key:"getCacheKey",value:function(){return this.getMaterialCacheKey()+","+this.getNodesCacheKey()}},{key:"dispose",value:function(){this.material.removeEventListener("dispose",this.onMaterialDispose),this.onDispose()}}])&&g(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();function w(t){return w="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},w(t)}function S(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,T(r.key),r)}}function T(t){var e=function(t,e){if("object"!=w(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=w(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==w(e)?e:e+""}const M=function(){return t=function t(e,n,r,i,o,a){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.renderer=e,this.nodes=n,this.geometries=r,this.pipelines=i,this.bindings=o,this.info=a,this.chainMaps={}},e=[{key:"get",value:function(t,e,n,r,i,o,a){var s=this.getChainMap(a),u=[t,e,o,i],c=s.get(u);return void 0===c?(c=this.createRenderObject(this.nodes,this.geometries,this.renderer,t,e,n,r,i,o,a),s.set(u,c)):(c.updateClipping(o.clippingContext),(c.version!==e.version||c.needsUpdate)&&(c.initialCacheKey!==c.getCacheKey()?(c.dispose(),c=this.get(t,e,n,r,i,o,a)):c.version=e.version)),c}},{key:"getChainMap",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"default";return this.chainMaps[t]||(this.chainMaps[t]=new s.A)}},{key:"dispose",value:function(){this.chainMaps={}}},{key:"createRenderObject",value:function(t,e,n,r,i,o,a,s,u,c){var l=this,f=this.getChainMap(c),h=new x(t,e,n,r,i,o,a,s,u);return h.onDispose=function(){l.pipelines.delete(h),l.bindings.delete(h),l.nodes.delete(h),f.delete(h.getChainArray())},h}}],e&&S(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();function E(t){return E="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},E(t)}function A(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,O(r.key),r)}}function O(t){var e=function(t,e){if("object"!=E(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=E(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==E(e)?e:e+""}const P=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.data=new WeakMap},(e=[{key:"get",value:function(t){var e=this.data.get(t);return void 0===e&&(e={},this.data.set(t,e)),e}},{key:"delete",value:function(t){var e;return this.data.has(t)&&(e=this.data.get(t),this.data.delete(t)),e}},{key:"has",value:function(t){return this.data.has(t)}},{key:"dispose",value:function(){this.data=new WeakMap}}])&&A(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();var R=n(4408);function k(t){return k="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},k(t)}function C(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,N(r.key),r)}}function N(t){var e=function(t,e){if("object"!=k(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=k(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==k(e)?e:e+""}function L(t,e,n){return e=B(e),function(t,e){if(e&&("object"===k(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,j()?Reflect.construct(e,n||[],B(t).constructor):e.apply(t,n))}function j(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(j=function(){return!!t})()}function I(){return I="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=B(t)););return t}(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(arguments.length<3?t:n):i.value}},I.apply(this,arguments)}function B(t){return B=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},B(t)}function U(t,e){return U=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},U(t,e)}const D=function(t){function e(t){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=L(this,e)).backend=t,n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&U(t,e)}(e,t),n=e,(r=[{key:"delete",value:function(t){void 0!==I(B(e.prototype),"delete",this).call(this,t)&&this.backend.destroyAttribute(t)}},{key:"update",value:function(t,e){var n=this.get(t);if(void 0===n.version)e===R.jQ.VERTEX?this.backend.createAttribute(t):e===R.jQ.INDEX?this.backend.createIndexAttribute(t):e===R.jQ.STORAGE&&this.backend.createStorageAttribute(t),n.version=this._getBufferAttribute(t).version;else{var r=this._getBufferAttribute(t);(n.version<r.version||r.usage===u.Vnu)&&(this.backend.updateAttribute(t),n.version=r.version)}}},{key:"_getBufferAttribute",value:function(t){return t.isInterleavedBufferAttribute&&(t=t.data),t}}])&&C(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(P);function F(t){return F="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},F(t)}function z(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return V(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?V(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function V(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function G(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,H(r.key),r)}}function H(t){var e=function(t,e){if("object"!=F(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=F(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==F(e)?e:e+""}function W(t,e,n){return e=Y(e),function(t,e){if(e&&("object"===F(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,q()?Reflect.construct(e,n||[],Y(t).constructor):e.apply(t,n))}function q(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(q=function(){return!!t})()}function X(){return X="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Y(t)););return t}(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(arguments.length<3?t:n):i.value}},X.apply(this,arguments)}function Y(t){return Y=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Y(t)}function J(t,e){return J=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},J(t,e)}function Z(t){return null!==t.index?t.index.version:t.attributes.position.version}function K(t){var e=[],n=t.index,r=t.attributes.position;if(null!==n)for(var i=n.array,o=0,a=i.length;o<a;o+=3){var s=i[o+0],c=i[o+1],l=i[o+2];e.push(s,c,c,l,l,s)}else for(var f=0,h=r.array.length/3-1;f<h;f+=3){var p=f+0,d=f+1,m=f+2;e.push(p,d,d,m,m,p)}var y=new(function(t){for(var e=t.length-1;e>=0;--e)if(t[e]>=65535)return!0;return!1}(e)?u.MW4:u.A$4)(e,1);return y.version=Z(t),y}const Q=function(t){function e(t,n){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(r=W(this,e)).attributes=t,r.info=n,r.wireframes=new WeakMap,r.attributeCall=new WeakMap,r}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&J(t,e)}(e,t),n=e,(r=[{key:"has",value:function(t){var n=t.geometry;return X(Y(e.prototype),"has",this).call(this,n)&&!0===this.get(n).initialized}},{key:"updateForRender",value:function(t){!1===this.has(t)&&this.initGeometry(t),this.updateAttributes(t)}},{key:"initGeometry",value:function(t){var e=this,n=t.geometry;this.get(n).initialized=!0,this.info.memory.geometries++,n.addEventListener("dispose",(function r(){e.info.memory.geometries--;var i=n.index,o=t.getAttributes();null!==i&&e.attributes.delete(i);var a,s=z(o);try{for(s.s();!(a=s.n()).done;){var u=a.value;e.attributes.delete(u)}}catch(t){s.e(t)}finally{s.f()}var c=e.wireframes.get(n);void 0!==c&&e.attributes.delete(c),n.removeEventListener("dispose",r)}))}},{key:"updateAttributes",value:function(t){var e,n=z(t.getAttributes());try{for(n.s();!(e=n.n()).done;){var r=e.value;this.updateAttribute(r,R.jQ.VERTEX)}}catch(t){n.e(t)}finally{n.f()}var i=this.getIndex(t);null!==i&&this.updateAttribute(i,R.jQ.INDEX)}},{key:"updateAttribute",value:function(t,e){var n=this.info.render.calls;this.attributeCall.get(t)!==n&&(this.attributes.update(t,e),this.attributeCall.set(t,n))}},{key:"getIndex",value:function(t){var e=t.geometry,n=t.material,r=e.index;if(!0===n.wireframe){var i=this.wireframes,o=i.get(e);void 0===o?(o=K(e),i.set(e,o)):o.version!==Z(e)&&(this.attributes.delete(o),o=K(e),i.set(e,o)),r=o}return r}}])&&G(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(P);function $(t){return $="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},$(t)}function tt(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,et(r.key),r)}}function et(t){var e=function(t,e){if("object"!=$(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=$(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==$(e)?e:e+""}const nt=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.autoReset=!0,this.frame=0,this.calls=0,this.render={calls:0,drawCalls:0,triangles:0,points:0,lines:0,timestamp:0},this.compute={calls:0,computeCalls:0,timestamp:0},this.memory={geometries:0,textures:0}},(e=[{key:"update",value:function(t,e,n){this.render.drawCalls++,t.isMesh||t.isSprite?this.render.triangles+=n*(e/3):t.isPoints?this.render.points+=n*e:t.isLineSegments?this.render.lines+=n*(e/2):t.isLine?this.render.lines+=n*(e-1):console.error("THREE.WebGPUInfo: Unknown object type.")}},{key:"updateTimestamp",value:function(t,e){this[t].timestamp+=e}},{key:"reset",value:function(){this.render.drawCalls=0,this.compute.computeCalls=0,this.render.triangles=0,this.render.points=0,this.render.lines=0,this.render.timestamp=0,this.compute.timestamp=0}},{key:"dispose",value:function(){this.reset(),this.calls=0,this.render.calls=0,this.compute.calls=0,this.render.timestamp=0,this.compute.timestamp=0,this.memory.geometries=0,this.memory.textures=0}}])&&tt(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();function rt(t){return rt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},rt(t)}function it(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,at(r.key),r)}}function ot(t,e,n){return e&&it(t.prototype,e),n&&it(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function at(t){var e=function(t,e){if("object"!=rt(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=rt(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==rt(e)?e:e+""}const st=ot((function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.cacheKey=e,this.usedTimes=0}));function ut(t){return ut="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ut(t)}function ct(t,e,n){return e=ft(e),function(t,e){if(e&&("object"===ut(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,lt()?Reflect.construct(e,n||[],ft(t).constructor):e.apply(t,n))}function lt(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(lt=function(){return!!t})()}function ft(t){return ft=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},ft(t)}function ht(t,e){return ht=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},ht(t,e)}const pt=function(t){function e(t,n,r){var i;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(i=ct(this,e,[t])).vertexProgram=n,i.fragmentProgram=r,i}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&ht(t,e)}(e,t),n=e,Object.defineProperty(n,"prototype",{writable:!1}),n;var n}(st);function dt(t){return dt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},dt(t)}function mt(t,e,n){return e=vt(e),function(t,e){if(e&&("object"===dt(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,yt()?Reflect.construct(e,n||[],vt(t).constructor):e.apply(t,n))}function yt(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(yt=function(){return!!t})()}function vt(t){return vt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},vt(t)}function gt(t,e){return gt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},gt(t,e)}const bt=function(t){function e(t,n){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(r=mt(this,e,[t])).computeProgram=n,r.isComputePipeline=!0,r}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&gt(t,e)}(e,t),n=e,Object.defineProperty(n,"prototype",{writable:!1}),n;var n}(st);function _t(t){return _t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_t(t)}function xt(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,St(r.key),r)}}function wt(t,e,n){return e&&xt(t.prototype,e),n&&xt(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function St(t){var e=function(t,e){if("object"!=_t(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=_t(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==_t(e)?e:e+""}var Tt=0;const Mt=wt((function t(e,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.id=Tt++,this.code=e,this.stage=n,this.transforms=r,this.attributes=i,this.usedTimes=0}));function Et(t){return Et="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Et(t)}function At(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Ot(r.key),r)}}function Ot(t){var e=function(t,e){if("object"!=Et(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=Et(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Et(e)?e:e+""}function Pt(t,e,n){return e=Ct(e),function(t,e){if(e&&("object"===Et(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,Rt()?Reflect.construct(e,n||[],Ct(t).constructor):e.apply(t,n))}function Rt(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(Rt=function(){return!!t})()}function kt(){return kt="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Ct(t)););return t}(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(arguments.length<3?t:n):i.value}},kt.apply(this,arguments)}function Ct(t){return Ct=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Ct(t)}function Nt(t,e){return Nt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Nt(t,e)}const Lt=function(t){function e(t,n){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(r=Pt(this,e)).backend=t,r.nodes=n,r.bindings=null,r.caches=new Map,r.programs={vertex:new Map,fragment:new Map,compute:new Map},r}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Nt(t,e)}(e,t),n=e,r=[{key:"getForCompute",value:function(t,e){var n=this.backend,r=this.get(t);if(this._needsComputeUpdate(t)){var i=r.pipeline;i&&(i.usedTimes--,i.computeProgram.usedTimes--);var o=this.nodes.getForCompute(t),a=this.programs.compute.get(o.computeShader);void 0===a&&(i&&0===i.computeProgram.usedTimes&&this._releaseProgram(i.computeProgram),a=new Mt(o.computeShader,"compute",o.transforms,o.nodeAttributes),this.programs.compute.set(o.computeShader,a),n.createProgram(a));var s=this._getComputeCacheKey(t,a),u=this.caches.get(s);void 0===u&&(i&&0===i.usedTimes&&this._releasePipeline(t),u=this._getComputePipeline(t,a,s,e)),u.usedTimes++,a.usedTimes++,r.version=t.version,r.pipeline=u}return r.pipeline}},{key:"getForRender",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=this.backend,r=this.get(t);if(this._needsRenderUpdate(t)){var i=r.pipeline;i&&(i.usedTimes--,i.vertexProgram.usedTimes--,i.fragmentProgram.usedTimes--);var o=t.getNodeBuilderState(),a=this.programs.vertex.get(o.vertexShader);void 0===a&&(i&&0===i.vertexProgram.usedTimes&&this._releaseProgram(i.vertexProgram),a=new Mt(o.vertexShader,"vertex"),this.programs.vertex.set(o.vertexShader,a),n.createProgram(a));var s=this.programs.fragment.get(o.fragmentShader);void 0===s&&(i&&0===i.fragmentProgram.usedTimes&&this._releaseProgram(i.fragmentProgram),s=new Mt(o.fragmentShader,"fragment"),this.programs.fragment.set(o.fragmentShader,s),n.createProgram(s));var u=this._getRenderCacheKey(t,a,s),c=this.caches.get(u);void 0===c?(i&&0===i.usedTimes&&this._releasePipeline(i),c=this._getRenderPipeline(t,a,s,u,e)):t.pipeline=c,c.usedTimes++,a.usedTimes++,s.usedTimes++,r.pipeline=c}return r.pipeline}},{key:"delete",value:function(t){var n=this.get(t).pipeline;n&&(n.usedTimes--,0===n.usedTimes&&this._releasePipeline(n),n.isComputePipeline?(n.computeProgram.usedTimes--,0===n.computeProgram.usedTimes&&this._releaseProgram(n.computeProgram)):(n.fragmentProgram.usedTimes--,n.vertexProgram.usedTimes--,0===n.vertexProgram.usedTimes&&this._releaseProgram(n.vertexProgram),0===n.fragmentProgram.usedTimes&&this._releaseProgram(n.fragmentProgram))),kt(Ct(e.prototype),"delete",this).call(this,t)}},{key:"dispose",value:function(){kt(Ct(e.prototype),"dispose",this).call(this),this.caches=new Map,this.programs={vertex:new Map,fragment:new Map,compute:new Map}}},{key:"updateForRender",value:function(t){this.getForRender(t)}},{key:"_getComputePipeline",value:function(t,e,n,r){n=n||this._getComputeCacheKey(t,e);var i=this.caches.get(n);return void 0===i&&(i=new bt(n,e),this.caches.set(n,i),this.backend.createComputePipeline(i,r)),i}},{key:"_getRenderPipeline",value:function(t,e,n,r,i){r=r||this._getRenderCacheKey(t,e,n);var o=this.caches.get(r);return void 0===o&&(o=new pt(r,e,n),this.caches.set(r,o),t.pipeline=o,this.backend.createRenderPipeline(t,i)),o}},{key:"_getComputeCacheKey",value:function(t,e){return t.id+","+e.id}},{key:"_getRenderCacheKey",value:function(t,e,n){return e.id+","+n.id+","+this.backend.getRenderCacheKey(t)}},{key:"_releasePipeline",value:function(t){this.caches.delete(t.cacheKey)}},{key:"_releaseProgram",value:function(t){var e=t.code,n=t.stage;this.programs[n].delete(e)}},{key:"_needsComputeUpdate",value:function(t){var e=this.get(t);return void 0===e.pipeline||e.version!==t.version}},{key:"_needsRenderUpdate",value:function(t){return void 0===this.get(t).pipeline||this.backend.needsRenderUpdate(t)}}],r&&At(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(P);function jt(t){return jt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},jt(t)}function It(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return Bt(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Bt(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function Bt(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function Ut(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Dt(r.key),r)}}function Dt(t){var e=function(t,e){if("object"!=jt(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=jt(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==jt(e)?e:e+""}function Ft(t,e,n){return e=Vt(e),function(t,e){if(e&&("object"===jt(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,zt()?Reflect.construct(e,n||[],Vt(t).constructor):e.apply(t,n))}function zt(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(zt=function(){return!!t})()}function Vt(t){return Vt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Vt(t)}function Gt(t,e){return Gt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Gt(t,e)}const Ht=function(t){function e(t,n,r,i,o,a){var s;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(s=Ft(this,e)).backend=t,s.textures=r,s.pipelines=o,s.attributes=i,s.nodes=n,s.info=a,s.pipelines.bindings=s,s}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Gt(t,e)}(e,t),n=e,(r=[{key:"getForRender",value:function(t){var e=t.getBindings(),n=this.get(t);return n.bindings!==e&&(n.bindings=e,this._init(e),this.backend.createBindings(e)),n.bindings}},{key:"getForCompute",value:function(t){var e=this.get(t);if(void 0===e.bindings){var n=this.nodes.getForCompute(t).bindings;e.bindings=n,this._init(n),this.backend.createBindings(n)}return e.bindings}},{key:"updateForCompute",value:function(t){this._update(t,this.getForCompute(t))}},{key:"updateForRender",value:function(t){this._update(t,this.getForRender(t))}},{key:"_init",value:function(t){var e,n=It(t);try{for(n.s();!(e=n.n()).done;){var r=e.value;if(r.isSampledTexture)this.textures.updateTexture(r.texture);else if(r.isStorageBuffer){var i=r.attribute;this.attributes.update(i,R.jQ.STORAGE)}}}catch(t){n.e(t)}finally{n.f()}}},{key:"_update",value:function(t,e){var n,r=this.backend,i=!1,o=It(e);try{for(o.s();!(n=o.n()).done;){var a=n.value;if(!a.isNodeUniformsGroup||this.nodes.updateGroup(a))if(a.isUniformBuffer)a.update()&&r.updateBinding(a);else if(a.isSampledTexture){var s=a.texture;if(a.needsBindingsUpdate&&(i=!0),a.update()&&this.textures.updateTexture(a.texture),!0===s.isStorageTexture){var u=this.get(s);!0===a.store?u.needsMipmap=!0:!0===s.generateMipmaps&&this.textures.needsMipmaps(s)&&!0===u.needsMipmap&&(this.backend.generateMipmaps(s),u.needsMipmap=!1)}}}}catch(t){o.e(t)}finally{o.f()}if(!0===i){var c=this.pipelines.getForRender(t);this.backend.updateBindings(e,c)}}}])&&Ut(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(P);var Wt=n(337);function qt(t){return qt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},qt(t)}function Xt(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Yt(r.key),r)}}function Yt(t){var e=function(t,e){if("object"!=qt(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=qt(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==qt(e)?e:e+""}function Jt(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.material.id!==e.material.id?t.material.id-e.material.id:t.z!==e.z?t.z-e.z:t.id-e.id}function Zt(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.z!==e.z?e.z-t.z:t.id-e.id}const Kt=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.renderItems=[],this.renderItemsIndex=0,this.opaque=[],this.transparent=[],this.lightsNode=new Wt.LightsNode([]),this.lightsArray=[],this.occlusionQueryCount=0},(e=[{key:"begin",value:function(){return this.renderItemsIndex=0,this.opaque.length=0,this.transparent.length=0,this.lightsArray.length=0,this.occlusionQueryCount=0,this}},{key:"getNextRenderItem",value:function(t,e,n,r,i,o){var a=this.renderItems[this.renderItemsIndex];return void 0===a?(a={id:t.id,object:t,geometry:e,material:n,groupOrder:r,renderOrder:t.renderOrder,z:i,group:o},this.renderItems[this.renderItemsIndex]=a):(a.id=t.id,a.object=t,a.geometry=e,a.material=n,a.groupOrder=r,a.renderOrder=t.renderOrder,a.z=i,a.group=o),this.renderItemsIndex++,a}},{key:"push",value:function(t,e,n,r,i,o){var a=this.getNextRenderItem(t,e,n,r,i,o);!0===t.occlusionTest&&this.occlusionQueryCount++,(!0===n.transparent?this.transparent:this.opaque).push(a)}},{key:"unshift",value:function(t,e,n,r,i,o){var a=this.getNextRenderItem(t,e,n,r,i,o);(!0===n.transparent?this.transparent:this.opaque).unshift(a)}},{key:"pushLight",value:function(t){this.lightsArray.push(t)}},{key:"getLightsNode",value:function(){return this.lightsNode.fromLights(this.lightsArray)}},{key:"sort",value:function(t,e){this.opaque.length>1&&this.opaque.sort(t||Jt),this.transparent.length>1&&this.transparent.sort(e||Zt)}},{key:"finish",value:function(){this.lightsNode.fromLights(this.lightsArray);for(var t=this.renderItemsIndex,e=this.renderItems.length;t<e;t++){var n=this.renderItems[t];if(null===n.id)break;n.id=null,n.object=null,n.geometry=null,n.material=null,n.groupOrder=null,n.renderOrder=null,n.z=null,n.group=null}}}])&&Xt(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();function Qt(t){return Qt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Qt(t)}function $t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,te(r.key),r)}}function te(t){var e=function(t,e){if("object"!=Qt(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=Qt(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Qt(e)?e:e+""}const ee=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.lists=new s.A},(e=[{key:"get",value:function(t,e){var n=this.lists,r=[t,e],i=n.get(r);return void 0===i&&(i=new Kt,n.set(r,i)),i}},{key:"dispose",value:function(){this.lists=new s.A}}])&&$t(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();function ne(t){return ne="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ne(t)}function re(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,oe(r.key),r)}}function ie(t,e,n){return e&&re(t.prototype,e),n&&re(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function oe(t){var e=function(t,e){if("object"!=ne(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=ne(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==ne(e)?e:e+""}var ae=0;const se=ie((function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.id=ae++,this.color=!0,this.clearColor=!0,this.clearColorValue={r:0,g:0,b:0,a:1},this.depth=!0,this.clearDepth=!0,this.clearDepthValue=1,this.stencil=!1,this.clearStencil=!0,this.clearStencilValue=1,this.viewport=!1,this.viewportValue=new u.IUQ,this.scissor=!1,this.scissorValue=new u.IUQ,this.textures=null,this.depthTexture=null,this.activeCubeFace=0,this.sampleCount=1,this.width=0,this.height=0,this.isRenderContext=!0}));function ue(t){return ue="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ue(t)}function ce(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,le(r.key),r)}}function le(t){var e=function(t,e){if("object"!=ue(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=ue(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==ue(e)?e:e+""}const fe=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.chainMaps={}},e=[{key:"get",value:function(t,e){var n,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=[t,e];if(null===r)n="default";else{var o=r.texture.format,a=r.count;n="".concat(a,":").concat(o,":").concat(r.samples,":").concat(r.depthBuffer,":").concat(r.stencilBuffer)}var s=this.getChainMap(n),u=s.get(i);return void 0===u&&(u=new se,s.set(i,u)),null!==r&&(u.sampleCount=0===r.samples?1:r.samples),u}},{key:"getChainMap",value:function(t){return this.chainMaps[t]||(this.chainMaps[t]=new s.A)}},{key:"dispose",value:function(){this.chainMaps={}}}],e&&ce(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();function he(t){return he="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},he(t)}function pe(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function de(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,me(r.key),r)}}function me(t){var e=function(t,e){if("object"!=he(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=he(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==he(e)?e:e+""}function ye(t,e,n){return e=ge(e),function(t,e){if(e&&("object"===he(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,ve()?Reflect.construct(e,n||[],ge(t).constructor):e.apply(t,n))}function ve(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(ve=function(){return!!t})()}function ge(t){return ge=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},ge(t)}function be(t,e){return be=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},be(t,e)}var _e=new u.Pq0;const xe=function(t){function e(t,n,r){var i;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(i=ye(this,e)).renderer=t,i.backend=n,i.info=r,i}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&be(t,e)}(e,t),n=e,r=[{key:"updateRenderTarget",value:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=this.get(t),i=0===t.samples?1:t.samples,o=r.depthTextureMips||(r.depthTextureMips={}),a=t.texture,s=t.textures,c=this.getSize(a),l=c.width>>n,f=c.height>>n,h=t.depthTexture||o[n],p=!1;void 0===h&&((h=new u.VCu).format=t.stencilBuffer?u.dcC:u.zdS,h.type=t.stencilBuffer?u.V3x:u.bkx,h.image.width=l,h.image.height=f,o[n]=h),r.width===c.width&&c.height===r.height||(p=!0,h.needsUpdate=!0,h.image.width=l,h.image.height=f),r.width=c.width,r.height=c.height,r.textures=s,r.depthTexture=h,r.depth=t.depthBuffer,r.stencil=t.stencilBuffer,r.renderTarget=t,r.sampleCount!==i&&(p=!0,h.needsUpdate=!0,r.sampleCount=i);for(var d={sampleCount:i},m=0;m<s.length;m++){var y=s[m];p&&(y.needsUpdate=!0),this.updateTexture(y,d)}this.updateTexture(h,d),!0!==r.initialized&&(r.initialized=!0,t.addEventListener("dispose",(function n(){if(t.removeEventListener("dispose",n),void 0!==s)for(var r=0;r<s.length;r++)e._destroyTexture(s[r]);else e._destroyTexture(a);e._destroyTexture(h)})))}},{key:"updateTexture",value:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=this.get(t);if(!0!==r.initialized||r.version!==t.version){var i=t.isRenderTargetTexture||t.isDepthTexture||t.isFramebufferTexture,o=this.backend;if(i&&!0===r.initialized&&(o.destroySampler(t),o.destroyTexture(t)),t.isFramebufferTexture){var a=this.renderer.getRenderTarget();t.type=a?a.texture.type:u.OUM}var s=this.getSize(t),c=s.width,l=s.height,f=s.depth;if(n.width=c,n.height=l,n.depth=f,n.needsMipmaps=this.needsMipmaps(t),n.levels=n.needsMipmaps?this.getMipLevels(t,c,l):1,i||!0===t.isStorageTexture)o.createSampler(t),o.createTexture(t,n);else if(!0!==r.initialized&&o.createSampler(t),t.version>0){var h=t.image;if(void 0===h)console.warn("THREE.Renderer: Texture marked for update but image is undefined.");else if(!1===h.complete)console.warn("THREE.Renderer: Texture marked for update but image is incomplete.");else{if(t.images){var p,d=[],m=function(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return pe(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?pe(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}(t.images);try{for(m.s();!(p=m.n()).done;){var y=p.value;d.push(y)}}catch(t){m.e(t)}finally{m.f()}n.images=d}else n.image=h;void 0!==r.isDefaultTexture&&!0!==r.isDefaultTexture||(o.createTexture(t,n),r.isDefaultTexture=!1),!0===t.source.dataReady&&o.updateTexture(t,n),n.needsMipmaps&&0===t.mipmaps.length&&o.generateMipmaps(t)}}else o.createDefaultTexture(t),r.isDefaultTexture=!0;!0!==r.initialized&&(r.initialized=!0,this.info.memory.textures++,t.addEventListener("dispose",(function n(){t.removeEventListener("dispose",n),e._destroyTexture(t),e.info.memory.textures--}))),r.version=t.version}}},{key:"getSize",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:_e,n=t.images?t.images[0]:t.image;return n?(void 0!==n.image&&(n=n.image),e.width=n.width,e.height=n.height,e.depth=t.isCubeTexture?6:n.depth||1):e.width=e.height=e.depth=1,e}},{key:"getMipLevels",value:function(t,e,n){return t.isCompressedTexture?t.mipmaps.length:Math.floor(Math.log2(Math.max(e,n)))+1}},{key:"needsMipmaps",value:function(t){return!!this.isEnvironmentTexture(t)||!0===t.isCompressedTexture||t.minFilter!==u.hxR&&t.minFilter!==u.k6q}},{key:"isEnvironmentTexture",value:function(t){var e=t.mapping;return e===u.wfO||e===u.uV5||e===u.hy7||e===u.xFO}},{key:"_destroyTexture",value:function(t){this.backend.destroySampler(t),this.backend.destroyTexture(t),this.delete(t)}}],r&&de(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(P);var we=n(1256);function Se(t){return Se="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Se(t)}function Te(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Me(r.key),r)}}function Me(t){var e=function(t,e){if("object"!=Se(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=Se(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Se(e)?e:e+""}function Ee(t,e,n){return e=Oe(e),function(t,e){if(e&&("object"===Se(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,Ae()?Reflect.construct(e,n||[],Oe(t).constructor):e.apply(t,n))}function Ae(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(Ae=function(){return!!t})()}function Oe(t){return Oe=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Oe(t)}function Pe(t,e){return Pe=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Pe(t,e)}var Re=new we.A;const ke=function(t){function e(t,n){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(r=Ee(this,e)).renderer=t,r.nodes=n,r}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Pe(t,e)}(e,t),n=e,(r=[{key:"update",value:function(t,e,n){var r=this.renderer,i=this.nodes.getBackgroundNode(t)||t.background,o=!1;if(null===i)r._clearColor.getRGB(Re,this.renderer.currentColorSpace),Re.a=r._clearColor.a;else if(!0===i.isColor)i.getRGB(Re,this.renderer.currentColorSpace),Re.a=1,o=!0;else if(!0===i.isNode){var a=this.get(t),s=i;Re.copy(r._clearColor);var c=a.backgroundMesh;if(void 0===c){var l=(0,Wt.context)((0,Wt.vec4)(s).mul(Wt.backgroundIntensity),{getUV:function(){return Wt.normalWorld},getTextureLevel:function(){return Wt.backgroundBlurriness}}),f=(0,Wt.modelViewProjection)();f=f.setZ(f.w);var h=new Wt.NodeMaterial;h.side=u.hsX,h.depthTest=!1,h.depthWrite=!1,h.fog=!1,h.vertexNode=f,h.fragmentNode=l,a.backgroundMeshNode=l,a.backgroundMesh=c=new u.eaF(new u.Gu$(1,32,32),h),c.frustumCulled=!1,c.onBeforeRender=function(t,e,n){this.matrixWorld.copyPosition(n.matrixWorld)}}var p=s.getCacheKey();a.backgroundCacheKey!==p&&(a.backgroundMeshNode.node=(0,Wt.vec4)(s).mul(Wt.backgroundIntensity),c.material.needsUpdate=!0,a.backgroundCacheKey=p),e.unshift(c,c.geometry,c.material,0,0,null)}else console.error("THREE.Renderer: Unsupported background configuration.",i);if(!0===r.autoClear||!0===o){Re.multiplyScalar(Re.a);var d=n.clearColorValue;d.r=Re.r,d.g=Re.g,d.b=Re.b,d.a=Re.a,n.depthClearValue=r._clearDepth,n.stencilClearValue=r._clearStencil,n.clearColor=!0===r.autoClearColor,n.clearDepth=!0===r.autoClearDepth,n.clearStencil=!0===r.autoClearStencil}else n.clearColor=!1,n.clearDepth=!1,n.clearStencil=!1}}])&&Te(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(P);function Ce(t){return Ce="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ce(t)}function Ne(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function Le(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,je(r.key),r)}}function je(t){var e=function(t,e){if("object"!=Ce(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=Ce(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Ce(e)?e:e+""}const Ie=function(){return t=function t(e,n,r,i,o,a,s){var u=arguments.length>7&&void 0!==arguments[7]?arguments[7]:[];!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.vertexShader=e,this.fragmentShader=n,this.computeShader=r,this.transforms=u,this.nodeAttributes=i,this.bindings=o,this.updateNodes=a,this.updateBeforeNodes=s,this.usedTimes=0},(e=[{key:"createBindings",value:function(){var t,e=[],n=function(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return Ne(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Ne(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}(this.bindings);try{for(n.s();!(t=n.n()).done;){var r=t.value,i=r;!0!==r.shared&&(i=r.clone()),e.push(i)}}catch(t){n.e(t)}finally{n.f()}return e}}])&&Le(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();function Be(t){return Be="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Be(t)}function Ue(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return De(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?De(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function De(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function Fe(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,ze(r.key),r)}}function ze(t){var e=function(t,e){if("object"!=Be(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=Be(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Be(e)?e:e+""}function Ve(t,e,n){return e=We(e),function(t,e){if(e&&("object"===Be(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,Ge()?Reflect.construct(e,n||[],We(t).constructor):e.apply(t,n))}function Ge(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(Ge=function(){return!!t})()}function He(){return He="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=We(t)););return t}(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(arguments.length<3?t:n):i.value}},He.apply(this,arguments)}function We(t){return We=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},We(t)}function qe(t,e){return qe=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},qe(t,e)}const Xe=function(t){function e(t,n){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(r=Ve(this,e)).renderer=t,r.backend=n,r.nodeFrame=new Wt.NodeFrame,r.nodeBuilderCache=new Map,r.callHashCache=new s.A,r.groupsData=new s.A,r}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&qe(t,e)}(e,t),n=e,r=[{key:"updateGroup",value:function(t){var e=t.groupNode,n=e.name;if(n===Wt.objectGroup.name)return!0;if(n===Wt.renderGroup.name){var r=this.get(t),i=this.nodeFrame.renderId;return r.renderId!==i&&(r.renderId=i,!0)}if(n===Wt.frameGroup.name){var o=this.get(t),a=this.nodeFrame.frameId;return o.frameId!==a&&(o.frameId=a,!0)}var s=[e,t],u=this.groupsData.get(s);return void 0===u&&this.groupsData.set(s,u={}),u.version!==e.version&&(u.version=e.version,!0)}},{key:"getForRenderCacheKey",value:function(t){return t.initialCacheKey}},{key:"getForRender",value:function(t){var e=this.get(t),n=e.nodeBuilderState;if(void 0===n){var r=this.nodeBuilderCache,i=this.getForRenderCacheKey(t);if(void 0===(n=r.get(i))){var o=this.backend.createNodeBuilder(t.object,this.renderer,t.scene);o.material=t.material,o.context.material=t.material,o.lightsNode=t.lightsNode,o.environmentNode=this.getEnvironmentNode(t.scene),o.fogNode=this.getFogNode(t.scene),o.toneMappingNode=this.getToneMappingNode(),o.clippingContext=t.clippingContext,o.build(),n=this._createNodeBuilderState(o),r.set(i,n)}n.usedTimes++,e.nodeBuilderState=n}return n}},{key:"delete",value:function(t){if(t.isRenderObject){var n=this.get(t).nodeBuilderState;n.usedTimes--,0===n.usedTimes&&this.nodeBuilderCache.delete(this.getForRenderCacheKey(t))}return He(We(e.prototype),"delete",this).call(this,t)}},{key:"getForCompute",value:function(t){var e=this.get(t),n=e.nodeBuilderState;if(void 0===n){var r=this.backend.createNodeBuilder(t,this.renderer);r.build(),n=this._createNodeBuilderState(r),e.nodeBuilderState=n}return n}},{key:"_createNodeBuilderState",value:function(t){return new Ie(t.vertexShader,t.fragmentShader,t.computeShader,t.getAttributesArray(),t.getBindings(),t.updateNodes,t.updateBeforeNodes,t.transforms)}},{key:"getEnvironmentNode",value:function(t){return t.environmentNode||this.get(t).environmentNode||null}},{key:"getBackgroundNode",value:function(t){return t.backgroundNode||this.get(t).backgroundNode||null}},{key:"getFogNode",value:function(t){return t.fogNode||this.get(t).fogNode||null}},{key:"getToneMappingNode",value:function(){return!1===this.isToneMappingState?null:this.renderer.toneMappingNode||this.get(this.renderer).toneMappingNode||null}},{key:"getCacheKey",value:function(t,e){var n=[t,e],r=this.renderer.info.calls,i=this.callHashCache.get(n);if(void 0===i||i.callId!==r){var o=this.getEnvironmentNode(t),a=this.getFogNode(t),s=this.getToneMappingNode(),u=[];e&&u.push(e.getCacheKey()),o&&u.push(o.getCacheKey()),a&&u.push(a.getCacheKey()),s&&u.push(s.getCacheKey()),i={callId:r,cacheKey:u.join(",")},this.callHashCache.set(n,i)}return i.cacheKey}},{key:"updateScene",value:function(t){this.updateEnvironment(t),this.updateFog(t),this.updateBackground(t),this.updateToneMapping()}},{key:"isToneMappingState",get:function(){var t=this.renderer.getRenderTarget();return!t||!t.isCubeRenderTarget}},{key:"updateToneMapping",value:function(){var t=this.renderer,e=this.get(t),n=t.toneMapping;if(this.isToneMappingState&&n!==u.y_p){if(e.toneMapping!==n){var r=e.rendererToneMappingNode||(0,Wt.toneMapping)(n);r.toneMapping=n,e.rendererToneMappingNode=r,e.toneMappingNode=r,e.toneMapping=n}}else delete e.toneMappingNode,delete e.toneMapping}},{key:"updateBackground",value:function(t){var e=this.get(t),n=t.background;if(n){if(e.background!==n){var r=null;!0===n.isCubeTexture||n.mapping===u.wfO||n.mapping===u.uV5?r=(0,Wt.pmremTexture)(n,Wt.normalWorld):!0===n.isTexture?r=(0,Wt.texture)(n,Wt.viewportBottomLeft).setUpdateMatrix(!0):!0!==n.isColor&&console.error("WebGPUNodes: Unsupported background configuration.",n),e.backgroundNode=r,e.background=n}}else e.backgroundNode&&(delete e.backgroundNode,delete e.background)}},{key:"updateFog",value:function(t){var e=this.get(t),n=t.fog;if(n){if(e.fog!==n){var r=null;n.isFogExp2?r=(0,Wt.densityFog)((0,Wt.reference)("color","color",n),(0,Wt.reference)("density","float",n)):n.isFog?r=(0,Wt.rangeFog)((0,Wt.reference)("color","color",n),(0,Wt.reference)("near","float",n),(0,Wt.reference)("far","float",n)):console.error("WebGPUNodes: Unsupported fog configuration.",n),e.fogNode=r,e.fog=n}}else delete e.fogNode,delete e.fog}},{key:"updateEnvironment",value:function(t){var e=this.get(t),n=t.environment;if(n){if(e.environment!==n){var r=null;!0===n.isCubeTexture?r=(0,Wt.cubeTexture)(n):!0===n.isTexture?r=(0,Wt.texture)(n):console.error("Nodes: Unsupported environment configuration.",n),e.environmentNode=r,e.environment=n}}else e.environmentNode&&(delete e.environmentNode,delete e.environment)}},{key:"getNodeFrame",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.renderer,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,o=this.nodeFrame;return o.renderer=t,o.scene=e,o.object=n,o.camera=r,o.material=i,o}},{key:"getNodeFrameForRender",value:function(t){return this.getNodeFrame(t.renderer,t.scene,t.object,t.camera,t.material)}},{key:"updateBefore",value:function(t){var e,n=this.getNodeFrameForRender(t),r=Ue(t.getNodeBuilderState().updateBeforeNodes);try{for(r.s();!(e=r.n()).done;){var i=e.value;n.updateBeforeNode(i)}}catch(t){r.e(t)}finally{r.f()}}},{key:"updateForCompute",value:function(t){var e,n=this.getNodeFrame(),r=Ue(this.getForCompute(t).updateNodes);try{for(r.s();!(e=r.n()).done;){var i=e.value;n.updateNode(i)}}catch(t){r.e(t)}finally{r.f()}}},{key:"updateForRender",value:function(t){var e,n=this.getNodeFrameForRender(t),r=Ue(t.getNodeBuilderState().updateNodes);try{for(r.s();!(e=r.n()).done;){var i=e.value;n.updateNode(i)}}catch(t){r.e(t)}finally{r.f()}}},{key:"dispose",value:function(){He(We(e.prototype),"dispose",this).call(this),this.nodeFrame=new Wt.NodeFrame,this.nodeBuilderCache=new Map}}],r&&Fe(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(P);function Ye(t){return Ye="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ye(t)}function Je(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return Ze(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Ze(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function Ze(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function Ke(){Ke=function(){return e};var t,e={},n=Object.prototype,r=n.hasOwnProperty,i=Object.defineProperty||function(t,e,n){t[e]=n.value},o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",s=o.asyncIterator||"@@asyncIterator",u=o.toStringTag||"@@toStringTag";function c(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{c({},"")}catch(t){c=function(t,e,n){return t[e]=n}}function l(t,e,n,r){var o=e&&e.prototype instanceof v?e:v,a=Object.create(o.prototype),s=new R(r||[]);return i(a,"_invoke",{value:E(t,n,s)}),a}function f(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var h="suspendedStart",p="suspendedYield",d="executing",m="completed",y={};function v(){}function g(){}function b(){}var _={};c(_,a,(function(){return this}));var x=Object.getPrototypeOf,w=x&&x(x(k([])));w&&w!==n&&r.call(w,a)&&(_=w);var S=b.prototype=v.prototype=Object.create(_);function T(t){["next","throw","return"].forEach((function(e){c(t,e,(function(t){return this._invoke(e,t)}))}))}function M(t,e){function n(i,o,a,s){var u=f(t[i],t,o);if("throw"!==u.type){var c=u.arg,l=c.value;return l&&"object"==Ye(l)&&r.call(l,"__await")?e.resolve(l.__await).then((function(t){n("next",t,a,s)}),(function(t){n("throw",t,a,s)})):e.resolve(l).then((function(t){c.value=t,a(c)}),(function(t){return n("throw",t,a,s)}))}s(u.arg)}var o;i(this,"_invoke",{value:function(t,r){function i(){return new e((function(e,i){n(t,r,e,i)}))}return o=o?o.then(i,i):i()}})}function E(e,n,r){var i=h;return function(o,a){if(i===d)throw Error("Generator is already running");if(i===m){if("throw"===o)throw a;return{value:t,done:!0}}for(r.method=o,r.arg=a;;){var s=r.delegate;if(s){var u=A(s,r);if(u){if(u===y)continue;return u}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(i===h)throw i=m,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);i=d;var c=f(e,n,r);if("normal"===c.type){if(i=r.done?m:p,c.arg===y)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(i=m,r.method="throw",r.arg=c.arg)}}}function A(e,n){var r=n.method,i=e.iterator[r];if(i===t)return n.delegate=null,"throw"===r&&e.iterator.return&&(n.method="return",n.arg=t,A(e,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),y;var o=f(i,e.iterator,n.arg);if("throw"===o.type)return n.method="throw",n.arg=o.arg,n.delegate=null,y;var a=o.arg;return a?a.done?(n[e.resultName]=a.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,y):a:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,y)}function O(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function P(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function R(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(O,this),this.reset(!0)}function k(e){if(e||""===e){var n=e[a];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,o=function n(){for(;++i<e.length;)if(r.call(e,i))return n.value=e[i],n.done=!1,n;return n.value=t,n.done=!0,n};return o.next=o}}throw new TypeError(Ye(e)+" is not iterable")}return g.prototype=b,i(S,"constructor",{value:b,configurable:!0}),i(b,"constructor",{value:g,configurable:!0}),g.displayName=c(b,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===g||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,c(t,u,"GeneratorFunction")),t.prototype=Object.create(S),t},e.awrap=function(t){return{__await:t}},T(M.prototype),c(M.prototype,s,(function(){return this})),e.AsyncIterator=M,e.async=function(t,n,r,i,o){void 0===o&&(o=Promise);var a=new M(l(t,n,r,i),o);return e.isGeneratorFunction(n)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},T(S),c(S,u,"Generator"),c(S,a,(function(){return this})),c(S,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),n=[];for(var r in e)n.push(r);return n.reverse(),function t(){for(;n.length;){var r=n.pop();if(r in e)return t.value=r,t.done=!1,t}return t.done=!0,t}},e.values=k,R.prototype={constructor:R,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(P),!e)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function i(r,i){return s.type="throw",s.arg=e,n.next=r,i&&(n.method="next",n.arg=t),!!i}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],s=a.completion;if("root"===a.tryLoc)return i("end");if(a.tryLoc<=this.prev){var u=r.call(a,"catchLoc"),c=r.call(a,"finallyLoc");if(u&&c){if(this.prev<a.catchLoc)return i(a.catchLoc,!0);if(this.prev<a.finallyLoc)return i(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return i(a.catchLoc,!0)}else{if(!c)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return i(a.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=t,a.arg=e,o?(this.method="next",this.next=o.finallyLoc,y):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),y},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),P(n),y}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var i=r.arg;P(n)}return i}}throw Error("illegal catch attempt")},delegateYield:function(e,n,r){return this.delegate={iterator:k(e),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=t),y}},e}function Qe(t,e,n,r,i,o,a){try{var s=t[o](a),u=s.value}catch(t){return void n(t)}s.done?e(u):Promise.resolve(u).then(r,i)}function $e(t){return function(){var e=this,n=arguments;return new Promise((function(r,i){var o=t.apply(e,n);function a(t){Qe(o,r,i,a,s,"next",t)}function s(t){Qe(o,r,i,a,s,"throw",t)}a(void 0)}))}}function tn(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,en(r.key),r)}}function en(t){var e=function(t,e){if("object"!=Ye(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=Ye(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Ye(e)?e:e+""}var nn=new u.Z58,rn=new u.I9Y,on=new u.IUQ,an=new u.PPD,sn=new u.kn4,un=new u.Pq0;const cn=function(){return t=function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.isRenderer=!0;var r=n.logarithmicDepthBuffer,i=void 0!==r&&r,o=n.alpha,a=void 0===o||o;this.domElement=e.getDomElement(),this.backend=e,this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.alpha=a,this.logarithmicDepthBuffer=i,this.outputColorSpace=u.er$,this.toneMapping=u.y_p,this.toneMappingExposure=1,this.sortObjects=!0,this.depth=!0,this.stencil=!1,this.clippingPlanes=[],this.info=new nt,this._pixelRatio=1,this._width=this.domElement.width,this._height=this.domElement.height,this._viewport=new u.IUQ(0,0,this._width,this._height),this._scissor=new u.IUQ(0,0,this._width,this._height),this._scissorTest=!1,this._attributes=null,this._geometries=null,this._nodes=null,this._animation=null,this._bindings=null,this._objects=null,this._pipelines=null,this._renderLists=null,this._renderContexts=null,this._textures=null,this._background=null,this._currentRenderContext=null,this._opaqueSort=null,this._transparentSort=null;var s=!0===this.alpha?0:1;this._clearColor=new we.A(0,0,0,s),this._clearDepth=1,this._clearStencil=0,this._renderTarget=null,this._activeCubeFace=0,this._activeMipmapLevel=0,this._renderObjectFunction=null,this._currentRenderObjectFunction=null,this._handleObjectFunction=this._renderObjectDirect,this._initialized=!1,this._initPromise=null,this._compilationPromises=null,this.shadowMap={enabled:!1,type:null},this.xr={enabled:!1}},e=[{key:"init",value:(l=$e(Ke().mark((function t(){var e=this;return Ke().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this._initialized){t.next=2;break}throw new Error("Renderer: Backend has already been initialized.");case 2:if(null===this._initPromise){t.next=4;break}return t.abrupt("return",this._initPromise);case 4:return this._initPromise=new Promise(function(){var t=$e(Ke().mark((function t(n,r){var i;return Ke().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=e.backend,t.prev=1,t.next=4,i.init(e);case 4:t.next=10;break;case 6:return t.prev=6,t.t0=t.catch(1),r(t.t0),t.abrupt("return");case 10:e._nodes=new Xe(e,i),e._animation=new a(e._nodes,e.info),e._attributes=new D(i),e._background=new ke(e,e._nodes),e._geometries=new Q(e._attributes,e.info),e._textures=new xe(e,i,e.info),e._pipelines=new Lt(i,e._nodes),e._bindings=new Ht(i,e._nodes,e._textures,e._attributes,e._pipelines,e.info),e._objects=new M(e,e._nodes,e._geometries,e._pipelines,e._bindings,e.info),e._renderLists=new ee,e._renderContexts=new fe,e._initialized=!0,n();case 23:case"end":return t.stop()}}),t,null,[[1,6]])})));return function(e,n){return t.apply(this,arguments)}}()),t.abrupt("return",this._initPromise);case 6:case"end":return t.stop()}}),t,this)}))),function(){return l.apply(this,arguments)})},{key:"coordinateSystem",get:function(){return this.backend.coordinateSystem}},{key:"compileAsync",value:(c=$e(Ke().mark((function t(e,n){var r,i,o,a,s,u,c,l,f,h,p,d,y,v,g,b,_=arguments;return Ke().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=_.length>2&&void 0!==_[2]?_[2]:null,!1!==this._initialized){t.next=4;break}return t.next=4,this.init();case 4:return i=this._nodes.nodeFrame,o=i.renderId,a=this._currentRenderContext,s=this._currentRenderObjectFunction,u=this._compilationPromises,c=!0===e.isScene?e:nn,null===r&&(r=e),l=this._renderTarget,f=this._renderContexts.get(r,n,l),h=this._activeMipmapLevel,p=[],this._currentRenderContext=f,this._currentRenderObjectFunction=this.renderObject,this._handleObjectFunction=this._createObjectPipeline,this._compilationPromises=p,i.renderId++,i.update(),f.depth=this.depth,f.stencil=this.stencil,f.clippingContext||(f.clippingContext=new m),f.clippingContext.updateGlobal(this,n),c.onBeforeRender(this,e,n,l),(d=this._renderLists.get(e,n)).begin(),this._projectObject(e,n,0,d),r!==e&&r.traverseVisible((function(t){t.isLight&&t.layers.test(n.layers)&&d.pushLight(t)})),d.finish(),null!==l?(this._textures.updateRenderTarget(l,h),y=this._textures.get(l),f.textures=y.textures,f.depthTexture=y.depthTexture):(f.textures=null,f.depthTexture=null),this._nodes.updateScene(c),this._background.update(c,d,f),v=d.opaque,g=d.transparent,b=d.lightsNode,v.length>0&&this._renderObjects(v,n,c,b),g.length>0&&this._renderObjects(g,n,c,b),i.renderId=o,this._currentRenderContext=a,this._currentRenderObjectFunction=s,this._compilationPromises=u,this._handleObjectFunction=this._renderObjectDirect,t.next=46,Promise.all(p);case 46:case"end":return t.stop()}}),t,this)}))),function(t,e){return c.apply(this,arguments)})},{key:"renderAsync",value:(s=$e(Ke().mark((function t(e,n){var r;return Ke().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!1!==this._initialized){t.next=3;break}return t.next=3,this.init();case 3:return r=this._renderScene(e,n),t.next=6,this.backend.resolveTimestampAsync(r,"render");case 6:case"end":return t.stop()}}),t,this)}))),function(t,e){return s.apply(this,arguments)})},{key:"render",value:function(t,e){if(!1===this._initialized)return console.warn("THREE.Renderer: .render() called before the backend is initialized. Try using .renderAsync() instead."),this.renderAsync(t,e);this._renderScene(t,e)}},{key:"_renderScene",value:function(t,e){var n=this._nodes.nodeFrame,r=n.renderId,i=this._currentRenderContext,o=this._currentRenderObjectFunction,a=!0===t.isScene?t:nn,s=this._renderTarget,u=this._renderContexts.get(t,e,s),c=this._activeCubeFace,l=this._activeMipmapLevel;this._currentRenderContext=u,this._currentRenderObjectFunction=this._renderObjectFunction||this.renderObject,this.info.calls++,this.info.render.calls++,n.renderId=this.info.calls;var f=this.coordinateSystem;e.coordinateSystem!==f&&(e.coordinateSystem=f,e.updateProjectionMatrix()),!0===t.matrixWorldAutoUpdate&&t.updateMatrixWorld(),null===e.parent&&!0===e.matrixWorldAutoUpdate&&e.updateMatrixWorld();var h=this._viewport,p=this._scissor,d=this._pixelRatio;null!==s&&(h=s.viewport,p=s.scissor,d=1),this.getDrawingBufferSize(rn),on.set(0,0,rn.width,rn.height);var y=void 0===h.minDepth?0:h.minDepth,v=void 0===h.maxDepth?1:h.maxDepth;u.viewportValue.copy(h).multiplyScalar(d).floor(),u.viewportValue.width>>=l,u.viewportValue.height>>=l,u.viewportValue.minDepth=y,u.viewportValue.maxDepth=v,u.viewport=!1===u.viewportValue.equals(on),u.scissorValue.copy(p).multiplyScalar(d).floor(),u.scissor=this._scissorTest&&!1===u.scissorValue.equals(on),u.scissorValue.width>>=l,u.scissorValue.height>>=l,u.clippingContext||(u.clippingContext=new m),u.clippingContext.updateGlobal(this,e),a.onBeforeRender(this,t,e,s),sn.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),an.setFromProjectionMatrix(sn,f);var g=this._renderLists.get(t,e);if(g.begin(),this._projectObject(t,e,0,g),g.finish(),!0===this.sortObjects&&g.sort(this._opaqueSort,this._transparentSort),null!==s){this._textures.updateRenderTarget(s,l);var b=this._textures.get(s);u.textures=b.textures,u.depthTexture=b.depthTexture,u.width=b.width,u.height=b.height,u.renderTarget=s,u.depth=s.depthBuffer,u.stencil=s.stencilBuffer}else u.textures=null,u.depthTexture=null,u.width=this.domElement.width,u.height=this.domElement.height,u.depth=this.depth,u.stencil=this.stencil;u.width>>=l,u.height>>=l,u.activeCubeFace=c,u.activeMipmapLevel=l,u.occlusionQueryCount=g.occlusionQueryCount,this._nodes.updateScene(a),this._background.update(a,g,u),this.backend.beginRender(u);var _=g.opaque,x=g.transparent,w=g.lightsNode;return _.length>0&&this._renderObjects(_,e,a,w),x.length>0&&this._renderObjects(x,e,a,w),this.backend.finishRender(u),n.renderId=r,this._currentRenderContext=i,this._currentRenderObjectFunction=o,a.onAfterRender(this,t,e,s),u}},{key:"getMaxAnisotropy",value:function(){return this.backend.getMaxAnisotropy()}},{key:"getActiveCubeFace",value:function(){return this._activeCubeFace}},{key:"getActiveMipmapLevel",value:function(){return this._activeMipmapLevel}},{key:"setAnimationLoop",value:(o=$e(Ke().mark((function t(e){return Ke().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!1!==this._initialized){t.next=3;break}return t.next=3,this.init();case 3:this._animation.setAnimationLoop(e);case 4:case"end":return t.stop()}}),t,this)}))),function(t){return o.apply(this,arguments)})},{key:"getArrayBuffer",value:function(t){return console.warn("THREE.Renderer: getArrayBuffer() is deprecated. Use getArrayBufferAsync() instead."),this.getArrayBufferAsync(t)}},{key:"getArrayBufferAsync",value:(i=$e(Ke().mark((function t(e){return Ke().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.backend.getArrayBufferAsync(e);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t,this)}))),function(t){return i.apply(this,arguments)})},{key:"getContext",value:function(){return this.backend.getContext()}},{key:"getPixelRatio",value:function(){return this._pixelRatio}},{key:"getDrawingBufferSize",value:function(t){return t.set(this._width*this._pixelRatio,this._height*this._pixelRatio).floor()}},{key:"getSize",value:function(t){return t.set(this._width,this._height)}},{key:"setPixelRatio",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this._pixelRatio=t,this.setSize(this._width,this._height,!1)}},{key:"setDrawingBufferSize",value:function(t,e,n){this._width=t,this._height=e,this._pixelRatio=n,this.domElement.width=Math.floor(t*n),this.domElement.height=Math.floor(e*n),this.setViewport(0,0,t,e),this._initialized&&this.backend.updateSize()}},{key:"setSize",value:function(t,e){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._width=t,this._height=e,this.domElement.width=Math.floor(t*this._pixelRatio),this.domElement.height=Math.floor(e*this._pixelRatio),!0===n&&(this.domElement.style.width=t+"px",this.domElement.style.height=e+"px"),this.setViewport(0,0,t,e),this._initialized&&this.backend.updateSize()}},{key:"setOpaqueSort",value:function(t){this._opaqueSort=t}},{key:"setTransparentSort",value:function(t){this._transparentSort=t}},{key:"getScissor",value:function(t){var e=this._scissor;return t.x=e.x,t.y=e.y,t.width=e.width,t.height=e.height,t}},{key:"setScissor",value:function(t,e,n,r){var i=this._scissor;t.isVector4?i.copy(t):i.set(t,e,n,r)}},{key:"getScissorTest",value:function(){return this._scissorTest}},{key:"setScissorTest",value:function(t){this._scissorTest=t,this.backend.setScissorTest(t)}},{key:"getViewport",value:function(t){return t.copy(this._viewport)}},{key:"setViewport",value:function(t,e,n,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,a=this._viewport;t.isVector4?a.copy(t):a.set(t,e,n,r),a.minDepth=i,a.maxDepth=o}},{key:"getClearColor",value:function(t){return t.copy(this._clearColor)}},{key:"setClearColor",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;this._clearColor.set(t),this._clearColor.a=e}},{key:"getClearAlpha",value:function(){return this._clearColor.a}},{key:"setClearAlpha",value:function(t){this._clearColor.a=t}},{key:"getClearDepth",value:function(){return this._clearDepth}},{key:"setClearDepth",value:function(t){this._clearDepth=t}},{key:"getClearStencil",value:function(){return this._clearStencil}},{key:"setClearStencil",value:function(t){this._clearStencil=t}},{key:"isOccluded",value:function(t){var e=this._currentRenderContext;return e&&this.backend.isOccluded(e,t)}},{key:"clear",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(!1===this._initialized)return console.warn("THREE.Renderer: .clear() called before the backend is initialized. Try using .clearAsync() instead."),this.clearAsync(t,e,n);var r=null,i=this._renderTarget;null!==i&&(this._textures.updateRenderTarget(i),r=this._textures.get(i)),this.backend.clear(t,e,n,r)}},{key:"clearColor",value:function(){return this.clear(!0,!1,!1)}},{key:"clearDepth",value:function(){return this.clear(!1,!0,!1)}},{key:"clearStencil",value:function(){return this.clear(!1,!1,!0)}},{key:"clearAsync",value:(r=$e(Ke().mark((function t(){var e,n,r,i=arguments;return Ke().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=!(i.length>0&&void 0!==i[0])||i[0],n=!(i.length>1&&void 0!==i[1])||i[1],r=!(i.length>2&&void 0!==i[2])||i[2],!1!==this._initialized){t.next=6;break}return t.next=6,this.init();case 6:this.clear(e,n,r);case 7:case"end":return t.stop()}}),t,this)}))),function(){return r.apply(this,arguments)})},{key:"clearColorAsync",value:function(){return this.clearAsync(!0,!1,!1)}},{key:"clearDepthAsync",value:function(){return this.clearAsync(!1,!0,!1)}},{key:"clearStencilAsync",value:function(){return this.clearAsync(!1,!1,!0)}},{key:"currentColorSpace",get:function(){var t=this._renderTarget;if(null!==t){var e=t.texture;return(Array.isArray(e)?e[0]:e).colorSpace}return this.outputColorSpace}},{key:"dispose",value:function(){this.info.dispose(),this._animation.dispose(),this._objects.dispose(),this._pipelines.dispose(),this._nodes.dispose(),this._bindings.dispose(),this._renderLists.dispose(),this._renderContexts.dispose(),this._textures.dispose(),this.setRenderTarget(null),this.setAnimationLoop(null)}},{key:"setRenderTarget",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this._renderTarget=t,this._activeCubeFace=e,this._activeMipmapLevel=n}},{key:"getRenderTarget",value:function(){return this._renderTarget}},{key:"setRenderObjectFunction",value:function(t){this._renderObjectFunction=t}},{key:"getRenderObjectFunction",value:function(){return this._renderObjectFunction}},{key:"computeAsync",value:(n=$e(Ke().mark((function t(e){var n,r,i,o,a,s,u,c,l,f,h=this;return Ke().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!1!==this._initialized){t.next=3;break}return t.next=3,this.init();case 3:if(n=this._nodes.nodeFrame,r=n.renderId,this.info.calls++,this.info.compute.calls++,this.info.compute.computeCalls++,n.renderId=this.info.calls,i=this.backend,o=this._pipelines,a=this._bindings,s=this._nodes,void 0!==(u=Array.isArray(e)?e:[e])[0]&&!0===u[0].isComputeNode){t.next=16;break}throw new Error("THREE.Renderer: .compute() expects a ComputeNode.");case 16:i.beginCompute(e),c=Je(u),t.prev=18,f=Ke().mark((function t(){var n,r,u,c;return Ke().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=l.value,!1===o.has(n)&&(r=function t(){n.removeEventListener("dispose",t),o.delete(n),a.delete(n),s.delete(n)},n.addEventListener("dispose",r),n.onInit({renderer:h})),s.updateForCompute(n),a.updateForCompute(n),u=a.getForCompute(n),c=o.getForCompute(n,u),i.compute(e,n,u,c);case 7:case"end":return t.stop()}}),t)})),c.s();case 21:if((l=c.n()).done){t.next=25;break}return t.delegateYield(f(),"t0",23);case 23:t.next=21;break;case 25:t.next=30;break;case 27:t.prev=27,t.t1=t.catch(18),c.e(t.t1);case 30:return t.prev=30,c.f(),t.finish(30);case 33:return i.finishCompute(e),t.next=36,this.backend.resolveTimestampAsync(e,"compute");case 36:n.renderId=r;case 37:case"end":return t.stop()}}),t,this,[[18,27,30,33]])}))),function(t){return n.apply(this,arguments)})},{key:"hasFeatureAsync",value:function(t){return this.backend.hasFeatureAsync(t)}},{key:"hasFeature",value:function(t){return this.backend.hasFeature(t)}},{key:"copyFramebufferToTexture",value:function(t){var e=this._currentRenderContext;this._textures.updateTexture(t),this.backend.copyFramebufferToTexture(t,e)}},{key:"copyTextureToTexture",value:function(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this._textures.updateTexture(e),this._textures.updateTexture(n),this.backend.copyTextureToTexture(t,e,n,r)}},{key:"readRenderTargetPixelsAsync",value:function(t,e,n,r,i){return this.backend.copyTextureToBuffer(t.texture,e,n,r,i)}},{key:"_projectObject",value:function(t,e,n,r){if(!1!==t.visible){if(t.layers.test(e.layers))if(t.isGroup)n=t.renderOrder;else if(t.isLOD)!0===t.autoUpdate&&t.update(e);else if(t.isLight)r.pushLight(t);else if(t.isSprite){if(!t.frustumCulled||an.intersectsSprite(t)){!0===this.sortObjects&&un.setFromMatrixPosition(t.matrixWorld).applyMatrix4(sn);var i=t.geometry,o=t.material;o.visible&&r.push(t,i,o,n,un.z,null)}}else if(t.isLineLoop)console.error("THREE.Renderer: Objects of type THREE.LineLoop are not supported. Please use THREE.Line or THREE.LineSegments.");else if((t.isMesh||t.isLine||t.isPoints)&&(!t.frustumCulled||an.intersectsObject(t))){var a=t.geometry,s=t.material;if(!0===this.sortObjects&&(null===a.boundingSphere&&a.computeBoundingSphere(),un.copy(a.boundingSphere.center).applyMatrix4(t.matrixWorld).applyMatrix4(sn)),Array.isArray(s))for(var u=a.groups,c=0,l=u.length;c<l;c++){var f=u[c],h=s[f.materialIndex];h&&h.visible&&r.push(t,a,h,n,un.z,f)}else s.visible&&r.push(t,a,s,n,un.z,null)}for(var p=t.children,d=0,m=p.length;d<m;d++)this._projectObject(p[d],e,n,r)}}},{key:"_renderObjects",value:function(t,e,n,r){for(var i=0,o=t.length;i<o;i++){var a=t[i],s=a.object,u=a.geometry,c=a.material,l=a.group;if(e.isArrayCamera)for(var f=e.cameras,h=0,p=f.length;h<p;h++){var d=f[h];if(s.layers.test(d.layers)){var m=d.viewport,y=void 0===m.minDepth?0:m.minDepth,v=void 0===m.maxDepth?1:m.maxDepth,g=this._currentRenderContext.viewportValue;g.copy(m).multiplyScalar(this._pixelRatio).floor(),g.minDepth=y,g.maxDepth=v,this.backend.updateViewport(this._currentRenderContext),this._currentRenderObjectFunction(s,n,d,u,c,l,r)}}else this._currentRenderObjectFunction(s,n,e,u,c,l,r)}}},{key:"renderObject",value:function(t,e,n,r,i,o,a){var s,c;if(t.onBeforeRender(this,e,n,r,i,o),i.onBeforeRender(this,e,n,r,i,o),null!==e.overrideMaterial){var l=e.overrideMaterial;i.positionNode&&i.positionNode.isNode&&(s=l.positionNode,l.positionNode=i.positionNode),l.isShadowNodeMaterial&&(l.side=null===i.shadowSide?i.side:i.shadowSide,i.shadowNode&&i.shadowNode.isNode&&(c=l.fragmentNode,l.fragmentNode=i.shadowNode),this.localClippingEnabled&&(i.clipShadows?(l.clippingPlanes!==i.clippingPlanes&&(l.clippingPlanes=i.clippingPlanes,l.needsUpdate=!0),l.clipIntersection!==i.clipIntersection&&(l.clipIntersection=i.clipIntersection)):Array.isArray(l.clippingPlanes)&&(l.clippingPlanes=null,l.needsUpdate=!0))),i=l}!0===i.transparent&&i.side===u.$EB&&!1===i.forceSinglePass?(i.side=u.hsX,this._handleObjectFunction(t,i,e,n,a,"backSide"),i.side=u.hB5,this._handleObjectFunction(t,i,e,n,a),i.side=u.$EB):this._handleObjectFunction(t,i,e,n,a),void 0!==s&&(e.overrideMaterial.positionNode=s),void 0!==c&&(e.overrideMaterial.fragmentNode=c),t.onAfterRender(this,e,n,r,i,o)}},{key:"_renderObjectDirect",value:function(t,e,n,r,i,o){var a=this._objects.get(t,e,n,r,i,this._currentRenderContext,o);this._nodes.updateBefore(a),t.modelViewMatrix.multiplyMatrices(r.matrixWorldInverse,t.matrixWorld),t.normalMatrix.getNormalMatrix(t.modelViewMatrix),this._nodes.updateForRender(a),this._geometries.updateForRender(a),this._bindings.updateForRender(a),this._pipelines.updateForRender(a),this.backend.draw(a,this.info)}},{key:"_createObjectPipeline",value:function(t,e,n,r,i,o){var a=this._objects.get(t,e,n,r,i,this._currentRenderContext,o);this._nodes.updateBefore(a),this._nodes.updateForRender(a),this._geometries.updateForRender(a),this._bindings.updateForRender(a),this._pipelines.getForRender(a,this._compilationPromises)}},{key:"compute",get:function(){return this.computeAsync}},{key:"compile",get:function(){return this.compileAsync}}],e&&tn(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,n,r,i,o,s,c,l}()},6617:(t,e,n)=>{function r(t){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r(t)}function i(t,e,n){return e=a(e),function(t,e){if(e&&("object"===r(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,o()?Reflect.construct(e,n||[],a(t).constructor):e.apply(t,n))}function o(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(o=function(){return!!t})()}function a(t){return a=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},a(t)}function s(t,e){return s=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},s(t,e)}n.r(e),n.d(e,{default:()=>u});const u=function(t){function e(t,n){var r,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Float32Array;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),!1===ArrayBuffer.isView(t)&&(t=new o(t*n)),(r=i(this,e,[t,n])).isStorageInstancedBufferAttribute=!0,r}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&s(t,e)}(e,t),n=e,Object.defineProperty(n,"prototype",{writable:!1}),n;var n}(n(554).uWO)},3367:(t,e,n)=>{function r(t){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r(t)}function i(t,e,n){return e=a(e),function(t,e){if(e&&("object"===r(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,o()?Reflect.construct(e,n||[],a(t).constructor):e.apply(t,n))}function o(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(o=function(){return!!t})()}function a(t){return a=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},a(t)}function s(t,e){return s=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},s(t,e)}n.d(e,{A:()=>u});const u=function(t){function e(t){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=i(this,e,[t,r])).isUniformBuffer=!0,n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&s(t,e)}(e,t),n=e,Object.defineProperty(n,"prototype",{writable:!1}),n;var n}(n(2718).A)},7006:(t,e,n)=>{n.d(e,{t:()=>T,q:()=>S});var r=n(6068);function i(t){return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},i(t)}function o(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,a(r.key),r)}}function a(t){var e=function(t,e){if("object"!=i(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=i(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==i(e)?e:e+""}function s(t,e,n){return e=c(e),function(t,e){if(e&&("object"===i(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,u()?Reflect.construct(e,n||[],c(t).constructor):e.apply(t,n))}function u(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(u=function(){return!!t})()}function c(t){return c=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},c(t)}function l(t,e){return l=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},l(t,e)}var f=0;function h(t){return h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},h(t)}function p(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function d(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,y(r.key),r)}}function m(t,e,n){return e&&d(t.prototype,e),n&&d(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function y(t){var e=function(t,e){if("object"!=h(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=h(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==h(e)?e:e+""}function v(t,e,n){return e=_(e),function(t,e){if(e&&("object"===h(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,g()?Reflect.construct(e,n||[],_(t).constructor):e.apply(t,n))}function g(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(g=function(){return!!t})()}function b(){return b="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=_(t)););return t}(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(arguments.length<3?t:n):i.value}},b.apply(this,arguments)}function _(t){return _=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},_(t)}function x(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&w(t,e)}function w(t,e){return w=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},w(t,e)}var S=function(t){function e(t,n){var r;return p(this,e),(r=v(this,e,[t,n?n.value:null])).textureNode=n,r}return x(e,t),m(e,[{key:"needsBindingsUpdate",get:function(){return this.textureNode.value!==this.texture||b(_(e.prototype),"needsBindingsUpdate",this)}},{key:"update",value:function(){var t=this.textureNode;return this.texture!==t.value?(this.texture=t.value,!0):b(_(e.prototype),"update",this).call(this)}}])}(function(t){function e(t,n){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(r=s(this,e,[t])).id=f++,r.texture=n,r.version=n?n.version:0,r.store=!1,r.isSampledTexture=!0,r}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&l(t,e)}(e,t),n=e,(r=[{key:"needsBindingsUpdate",get:function(){var t=this.texture,e=this.version;return!!t.isVideoTexture||e!==t.version}},{key:"update",value:function(){var t=this.texture;return this.version!==t.version&&(this.version=t.version,!0)}}])&&o(n.prototype,r),i&&o(n,i),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r,i}(r.A)),T=function(t){function e(t,n){var r;return p(this,e),(r=v(this,e,[t,n])).isSampledCubeTexture=!0,r}return x(e,t),m(e)}(S)},8233:(t,e,n)=>{n.d(e,{A:()=>h});var r=n(3367);function i(t){return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},i(t)}function o(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,a(r.key),r)}}function a(t){var e=function(t,e){if("object"!=i(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=i(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==i(e)?e:e+""}function s(t,e,n){return e=c(e),function(t,e){if(e&&("object"===i(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,u()?Reflect.construct(e,n||[],c(t).constructor):e.apply(t,n))}function u(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(u=function(){return!!t})()}function c(t){return c=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},c(t)}function l(t,e){return l=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},l(t,e)}var f=0;const h=function(t){function e(t){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=s(this,e,["UniformBuffer_"+f++,t?t.value:null])).nodeUniform=t,n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&l(t,e)}(e,t),n=e,(r=[{key:"buffer",get:function(){return this.nodeUniform.value}}])&&o(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(r.A)},4804:(t,e,n)=>{n.d(e,{A:()=>S});var r=n(3367),i=n(4408);function o(t){return o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},o(t)}function a(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function s(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,u(r.key),r)}}function u(t){var e=function(t,e){if("object"!=o(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=o(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==o(e)?e:e+""}function c(t,e,n){return e=f(e),function(t,e){if(e&&("object"===o(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,l()?Reflect.construct(e,n||[],f(t).constructor):e.apply(t,n))}function l(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(l=function(){return!!t})()}function f(t){return f=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},f(t)}function h(t,e){return h=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},h(t,e)}var p=function(t){function e(t){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=c(this,e,[t])).isUniformsGroup=!0,n.uniforms=[],n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&h(t,e)}(e,t),n=e,(r=[{key:"addUniform",value:function(t){return this.uniforms.push(t),this}},{key:"removeUniform",value:function(t){var e=this.uniforms.indexOf(t);return-1!==e&&this.uniforms.splice(e,1),this}},{key:"buffer",get:function(){var t=this._buffer;if(null===t){var e=this.byteLength;t=new Float32Array(new ArrayBuffer(e)),this._buffer=t}return t}},{key:"byteLength",get:function(){for(var t=0,e=0,n=this.uniforms.length;e<n;e++){var r=this.uniforms[e],o=r.boundary,a=r.itemSize,s=t%i.HA,u=i.HA-s;0!==s&&u-o<0?t+=i.HA-s:s%o!=0&&(t+=s%o),r.offset=t/this.bytesPerElement,t+=a*this.bytesPerElement}return Math.ceil(t/i.HA)*i.HA}},{key:"update",value:function(){var t,e=!1,n=function(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return a(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?a(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,u=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return s=t.done,t},e:function(t){u=!0,o=t},f:function(){try{s||null==n.return||n.return()}finally{if(u)throw o}}}}(this.uniforms);try{for(n.s();!(t=n.n()).done;){var r=t.value;!0===this.updateByType(r)&&(e=!0)}}catch(t){n.e(t)}finally{n.f()}return e}},{key:"updateByType",value:function(t){return t.isFloatUniform?this.updateNumber(t):t.isVector2Uniform?this.updateVector2(t):t.isVector3Uniform?this.updateVector3(t):t.isVector4Uniform?this.updateVector4(t):t.isColorUniform?this.updateColor(t):t.isMatrix3Uniform?this.updateMatrix3(t):t.isMatrix4Uniform?this.updateMatrix4(t):void console.error("THREE.WebGPUUniformsGroup: Unsupported uniform type.",t)}},{key:"updateNumber",value:function(t){var e=!1,n=this.buffer,r=t.getValue(),i=t.offset;return n[i]!==r&&(n[i]=r,e=!0),e}},{key:"updateVector2",value:function(t){var e=!1,n=this.buffer,r=t.getValue(),i=t.offset;return n[i+0]===r.x&&n[i+1]===r.y||(n[i+0]=r.x,n[i+1]=r.y,e=!0),e}},{key:"updateVector3",value:function(t){var e=!1,n=this.buffer,r=t.getValue(),i=t.offset;return n[i+0]===r.x&&n[i+1]===r.y&&n[i+2]===r.z||(n[i+0]=r.x,n[i+1]=r.y,n[i+2]=r.z,e=!0),e}},{key:"updateVector4",value:function(t){var e=!1,n=this.buffer,r=t.getValue(),i=t.offset;return n[i+0]===r.x&&n[i+1]===r.y&&n[i+2]===r.z&&n[i+4]===r.w||(n[i+0]=r.x,n[i+1]=r.y,n[i+2]=r.z,n[i+3]=r.w,e=!0),e}},{key:"updateColor",value:function(t){var e=!1,n=this.buffer,r=t.getValue(),i=t.offset;return n[i+0]===r.r&&n[i+1]===r.g&&n[i+2]===r.b||(n[i+0]=r.r,n[i+1]=r.g,n[i+2]=r.b,e=!0),e}},{key:"updateMatrix3",value:function(t){var e=!1,n=this.buffer,r=t.getValue().elements,i=t.offset;return n[i+0]===r[0]&&n[i+1]===r[1]&&n[i+2]===r[2]&&n[i+4]===r[3]&&n[i+5]===r[4]&&n[i+6]===r[5]&&n[i+8]===r[6]&&n[i+9]===r[7]&&n[i+10]===r[8]||(n[i+0]=r[0],n[i+1]=r[1],n[i+2]=r[2],n[i+4]=r[3],n[i+5]=r[4],n[i+6]=r[5],n[i+8]=r[6],n[i+9]=r[7],n[i+10]=r[8],e=!0),e}},{key:"updateMatrix4",value:function(t){var e=!1,n=this.buffer,r=t.getValue().elements,i=t.offset;return!1===function(t,e,n){for(var r=0,i=e.length;r<i;r++)if(t[n+r]!==e[r])return!1;return!0}(n,r,i)&&(n.set(r,i),e=!0),e}}])&&s(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(r.A);function d(t){return d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},d(t)}function m(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function y(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,v(r.key),r)}}function v(t){var e=function(t,e){if("object"!=d(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=d(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==d(e)?e:e+""}function g(t,e,n){return e=_(e),function(t,e){if(e&&("object"===d(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,b()?Reflect.construct(e,n||[],_(t).constructor):e.apply(t,n))}function b(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(b=function(){return!!t})()}function _(t){return _=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},_(t)}function x(t,e){return x=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},x(t,e)}var w=0;const S=function(t){function e(t,n){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(r=g(this,e,[t])).id=w++,r.groupNode=n,r.isNodeUniformsGroup=!0,r}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&x(t,e)}(e,t),n=e,(r=[{key:"shared",get:function(){return this.groupNode.shared}},{key:"getNodes",value:function(){var t,e=[],n=function(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return m(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?m(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}(this.uniforms);try{for(n.s();!(t=n.n()).done;){var r=t.value.nodeUniform.node;if(!r)throw new Error("NodeUniformsGroup: Uniform has no node.");e.push(r)}}catch(t){n.e(t)}finally{n.f()}return e}}])&&y(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(p)},8124:(t,e,n)=>{n.d(e,{A:()=>Rt});var r=n(554),i=n(337),o=n(8233),a=n(4804),s=n(7006);function u(t){return u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},u(t)}function c(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return l(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?l(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function l(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function f(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,g(r.key),r)}}function h(t,e,n){return e=m(e),function(t,e){if(e&&("object"===u(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,p()?Reflect.construct(e,n||[],m(t).constructor):e.apply(t,n))}function p(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(p=function(){return!!t})()}function d(){return d="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=m(t)););return t}(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(arguments.length<3?t:n):i.value}},d.apply(this,arguments)}function m(t){return m=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},m(t)}function y(t,e){return y=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},y(t,e)}function v(t,e,n){return(e=g(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function g(t){var e=function(t,e){if("object"!=u(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=u(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==u(e)?e:e+""}var b=v(v(v({},i.MathNode.ATAN2,"atan"),"textureDimensions","textureSize"),"equals","equal"),_={low:"lowp",medium:"mediump",high:"highp"},x={instance:!0,swizzleAssign:!0},w="\nprecision highp float;\nprecision highp int;\nprecision mediump sampler2DArray;\nprecision lowp sampler2DShadow;\n";const S=function(t){function e(t,n){var r,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(r=h(this,e,[t,n,new i.GLSLNodeParser,o])).uniformGroups={},r.transforms=[],r}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&y(t,e)}(e,t),n=e,u=[{key:"getMethod",value:function(t){return b[t]||t}},{key:"getPropertyName",value:function(t,n){return t.isOutputStructVar?"":d(m(e.prototype),"getPropertyName",this).call(this,t,n)}},{key:"buildFunctionCode",value:function(t){var e,n=t.layout,r=this.flowShaderNode(t),i=[],o=c(n.inputs);try{for(o.s();!(e=o.n()).done;){var a=e.value;i.push(this.getType(a.type)+" "+a.name)}}catch(t){o.e(t)}finally{o.f()}return"".concat(this.getType(n.type)," ").concat(n.name,"( ").concat(i.join(", ")," ) {\n\n\t").concat(r.vars,"\n\n").concat(r.code,"\n\treturn ").concat(r.result,";\n\n}")}},{key:"setupPBO",value:function(t){var e=t.value;if(void 0===e.pbo){var n=e.array,o=e.count*e.itemSize,a=e.itemSize,s=r.VT0;2===a?s=r.paN:3===a?s=r.HIg:4===a&&(s=r.GWd);var u=Math.pow(2,Math.ceil(Math.log2(Math.sqrt(o/a)))),c=Math.ceil(o/a/u);u*c*a<o&&c++;var l=new Float32Array(u*c*a);l.set(n,0),e.array=l;var f=new r.GYF(e.array,u,c,s,r.RQf);f.needsUpdate=!0,f.isPBOTexture=!0;var h=new i.UniformNode(f);h.setPrecision("high"),e.pboNode=h,e.pbo=h.value,this.getUniformFromNode(e.pboNode,"texture",this.shaderStage,this.context.label)}}},{key:"generatePBO",value:function(t){var e=t.node,n=t.indexNode,r=e.value;this.renderer.backend.has(r)&&(this.renderer.backend.get(r).pbo=r.pbo);var o=this.getUniformFromNode(r.pboNode,"texture",this.shaderStage,this.context.label),a=this.getPropertyName(o);n.increaseUsage(this);var s=n.build(this,"uint"),u=this.getDataFromNode(t),c=u.propertyName;if(void 0===c){var l=this.getVarFromNode(t);c=this.getPropertyName(l);var f=this.getDataFromNode(e),h=f.propertySizeName;void 0===h&&(h=c+"Size",this.getVarFromNode(e,h,"uint"),this.addLineFlowCode("".concat(h," = uint( textureSize( ").concat(a,", 0 ).x )")),f.propertySizeName=h);var p=r.itemSize,d="."+i.vectorComponents.join("").slice(0,p),m="ivec2(".concat(s," % ").concat(h,", ").concat(s," / ").concat(h,")"),y=this.generateTextureLoad(null,a,m,null,"0");this.addLineFlowCode("".concat(c," = ").concat(y+d)),u.propertyName=c}return c}},{key:"generateTextureLoad",value:function(t,e,n,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"0";return r?"texelFetch( ".concat(e,", ivec3( ").concat(n,", ").concat(r," ), ").concat(i," )"):"texelFetch( ".concat(e,", ").concat(n,", ").concat(i," )")}},{key:"generateTexture",value:function(t,e,n,r){return t.isDepthTexture?"texture( ".concat(e,", ").concat(n," ).x"):(r&&(n="vec3( ".concat(n,", ").concat(r," )")),"texture( ".concat(e,", ").concat(n," )"))}},{key:"generateTextureLevel",value:function(t,e,n,r){return"textureLod( ".concat(e,", ").concat(n,", ").concat(r," )")}},{key:"generateTextureCompare",value:function(t,e,n,r,i){var o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:this.shaderStage;if("fragment"===o)return"texture( ".concat(e,", vec3( ").concat(n,", ").concat(r," ) )");console.error("WebGPURenderer: THREE.DepthTexture.compareFunction() does not support ".concat(o," shader."))}},{key:"getVars",value:function(t){var e=[],n=this.vars[t];if(void 0!==n){var r,i=c(n);try{for(i.s();!(r=i.n()).done;){var o=r.value;o.isOutputStructVar||e.push("".concat(this.getVar(o.type,o.name),";"))}}catch(t){i.e(t)}finally{i.f()}}return e.join("\n\t")}},{key:"getUniforms",value:function(t){var e,n=[],r={},i=c(this.uniforms[t]);try{for(i.s();!(e=i.n()).done;){var o=e.value,a=null,s=!1;if("texture"===o.type){var u=o.node.value;a=u.compareFunction?"sampler2DShadow ".concat(o.name,";"):!0===u.isDataArrayTexture?"sampler2DArray ".concat(o.name,";"):"sampler2D ".concat(o.name,";")}else if("cubeTexture"===o.type)a="samplerCube ".concat(o.name,";");else if("buffer"===o.type){var l=o.node,f=this.getType(l.bufferType),h=l.bufferCount,p=h>0?h:"";a="".concat(l.name," {\n\t").concat(f," ").concat(o.name,"[").concat(p,"];\n};\n")}else{var d=this.getVectorType(o.type);a="".concat(d," ").concat(o.name,";"),s=!0}var m=o.node.precision;if(null!==m&&(a=_[m]+" "+a),s){a="\t"+a;var y=o.groupNode.name;(r[y]||(r[y]=[])).push(a)}else a="uniform "+a,n.push(a)}}catch(t){i.e(t)}finally{i.f()}var v="";for(var g in r){var b=r[g];v+=this._getGLSLUniformStruct(t+"_"+g,b.join("\n"))+"\n"}return v+n.join("\n")}},{key:"getTypeFromAttribute",value:function(t){var n=d(m(e.prototype),"getTypeFromAttribute",this).call(this,t);if(/^[iu]/.test(n)&&t.gpuType!==r.Yuy){var i=t;t.isInterleavedBufferAttribute&&(i=t.data);var o=i.array;0==(o instanceof Uint32Array||o instanceof Int32Array||o instanceof Uint16Array||o instanceof Int16Array)&&(n=n.slice(1))}return n}},{key:"getAttributes",value:function(t){var e="";if("vertex"===t||"compute"===t){var n,r=0,i=c(this.getAttributesArray());try{for(i.s();!(n=i.n()).done;){var o=n.value;e+="layout( location = ".concat(r++," ) in ").concat(o.type," ").concat(o.name,";\n")}}catch(t){i.e(t)}finally{i.f()}}return e}},{key:"getStructMembers",value:function(t){for(var e=[],n=t.getMemberTypes(),r=0;r<n.length;r++){var i=n[r];e.push("layout( location = ".concat(r," ) out ").concat(i," m").concat(r,";"))}return e.join("\n")}},{key:"getStructs",value:function(t){var e=[],n=this.structs[t];if(0===n.length)return"layout( location = 0 ) out vec4 fragColor;\n";for(var r=0,i=n.length;r<i;r++){var o=n[r],a="\n";a+=this.getStructMembers(o),a+="\n",e.push(a)}return e.join("\n\n")}},{key:"getVaryings",value:function(t){var e="",n=this.varyings;if("vertex"===t||"compute"===t){var r,i=c(n);try{for(i.s();!(r=i.n()).done;){var o=r.value;"compute"===t&&(o.needsInterpolation=!0);var a=o.type;e+="".concat("int"===a||"uint"===a?"flat ":"").concat(o.needsInterpolation?"out":"/*out*/"," ").concat(a," ").concat(o.name,";\n")}}catch(t){i.e(t)}finally{i.f()}}else if("fragment"===t){var s,u=c(n);try{for(u.s();!(s=u.n()).done;){var l=s.value;if(l.needsInterpolation){var f=l.type;e+="".concat("int"===f||"uint"===f?"flat ":"","in ").concat(f," ").concat(l.name,";\n")}}}catch(t){u.e(t)}finally{u.f()}}return e}},{key:"getVertexIndex",value:function(){return"uint( gl_VertexID )"}},{key:"getInstanceIndex",value:function(){return"uint( gl_InstanceID )"}},{key:"getFrontFacing",value:function(){return"gl_FrontFacing"}},{key:"getFragCoord",value:function(){return"gl_FragCoord"}},{key:"getFragDepth",value:function(){return"gl_FragDepth"}},{key:"isAvailable",value:function(t){return!0===x[t]}},{key:"isFlipY",value:function(){return!0}},{key:"registerTransform",value:function(t,e){this.transforms.push({varyingName:t,attributeNode:e})}},{key:"getTransforms",value:function(){for(var t=this.transforms,e="",n=0;n<t.length;n++){var r=t[n],i=this.getPropertyName(r.attributeNode);e+="".concat(r.varyingName," = ").concat(i,";\n\t")}return e}},{key:"_getGLSLUniformStruct",value:function(t,e){return"\nlayout( std140 ) uniform ".concat(t," {\n").concat(e,"\n};")}},{key:"_getGLSLVertexCode",value:function(t){return"#version 300 es\n\n".concat(this.getSignature(),"\n\n// precision\n").concat(w,"\n\n// uniforms\n").concat(t.uniforms,"\n\n// varyings\n").concat(t.varyings,"\n\n// attributes\n").concat(t.attributes,"\n\n// codes\n").concat(t.codes,"\n\nvoid main() {\n\n\t// vars\n\t").concat(t.vars,"\n\n\t// transforms\n\t").concat(t.transforms,"\n\n\t// flow\n\t").concat(t.flow,"\n\n\tgl_PointSize = 1.0;\n\n}\n")}},{key:"_getGLSLFragmentCode",value:function(t){return"#version 300 es\n\n".concat(this.getSignature(),"\n\n// precision\n").concat(w,"\n\n// uniforms\n").concat(t.uniforms,"\n\n// varyings\n").concat(t.varyings,"\n\n// codes\n").concat(t.codes,"\n\n").concat(t.structs,"\n\nvoid main() {\n\n\t// vars\n\t").concat(t.vars,"\n\n\t// flow\n\t").concat(t.flow,"\n\n}\n")}},{key:"buildCode",value:function(){var t=null!==this.material?{fragment:{},vertex:{}}:{compute:{}};for(var e in t){var n="// code\n\n";n+=this.flowCode[e];var r,i=this.flowNodes[e],o=i[i.length-1],a=c(i);try{for(a.s();!(r=a.n()).done;){var s=r.value,u=this.getFlowData(s),l=s.name;l&&(n.length>0&&(n+="\n"),n+="\t// flow -> ".concat(l,"\n\t")),n+="".concat(u.code,"\n\t"),s===o&&"compute"!==e&&(n+="// result\n\t","vertex"===e?(n+="gl_Position = ",n+="".concat(u.result,";")):"fragment"===e&&(s.outputNode.isOutputStructNode||(n+="fragColor = ",n+="".concat(u.result,";"))))}}catch(t){a.e(t)}finally{a.f()}var f=t[e];f.uniforms=this.getUniforms(e),f.attributes=this.getAttributes(e),f.varyings=this.getVaryings(e),f.vars=this.getVars(e),f.structs=this.getStructs(e),f.codes=this.getCodes(e),f.transforms=this.getTransforms(e),f.flow=n}null!==this.material?(this.vertexShader=this._getGLSLVertexCode(t.vertex),this.fragmentShader=this._getGLSLFragmentCode(t.fragment)):this.computeShader=this._getGLSLVertexCode(t.compute)}},{key:"getUniformFromNode",value:function(t,n,r){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,u=d(m(e.prototype),"getUniformFromNode",this).call(this,t,n,r,i),c=this.getDataFromNode(t,r,this.globalCache),l=c.uniformGPU;if(void 0===l){if("texture"===n)l=new s.q(u.name,u.node),this.bindings[r].push(l);else if("cubeTexture"===n)l=new s.t(u.name,u.node),this.bindings[r].push(l);else if("buffer"===n){t.name="NodeBuffer_".concat(t.id),u.name="buffer".concat(t.id);var f=new o.A(t);f.name=t.name,this.bindings[r].push(f),l=f}else{var h=t.groupNode,p=h.name,y=this.uniformGroups[r]||(this.uniformGroups[r]={}),v=y[p];void 0===v&&(v=new a.A(r+"_"+p,h),y[p]=v,this.bindings[r].push(v)),l=this.getNodeUniform(u,n),v.addUniform(l)}c.uniformGPU=l}return u}}],u&&f(n.prototype,u),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,u}(i.NodeBuilder);var T=n(6945);function M(){M=function(){return e};var t,e={},n=Object.prototype,r=n.hasOwnProperty,i=Object.defineProperty||function(t,e,n){t[e]=n.value},o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",s=o.asyncIterator||"@@asyncIterator",u=o.toStringTag||"@@toStringTag";function c(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{c({},"")}catch(t){c=function(t,e,n){return t[e]=n}}function l(t,e,n,r){var o=e&&e.prototype instanceof v?e:v,a=Object.create(o.prototype),s=new C(r||[]);return i(a,"_invoke",{value:O(t,n,s)}),a}function f(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var h="suspendedStart",p="suspendedYield",d="executing",m="completed",y={};function v(){}function g(){}function b(){}var _={};c(_,a,(function(){return this}));var x=Object.getPrototypeOf,w=x&&x(x(N([])));w&&w!==n&&r.call(w,a)&&(_=w);var S=b.prototype=v.prototype=Object.create(_);function T(t){["next","throw","return"].forEach((function(e){c(t,e,(function(t){return this._invoke(e,t)}))}))}function E(t,e){function n(i,o,a,s){var u=f(t[i],t,o);if("throw"!==u.type){var c=u.arg,l=c.value;return l&&"object"==A(l)&&r.call(l,"__await")?e.resolve(l.__await).then((function(t){n("next",t,a,s)}),(function(t){n("throw",t,a,s)})):e.resolve(l).then((function(t){c.value=t,a(c)}),(function(t){return n("throw",t,a,s)}))}s(u.arg)}var o;i(this,"_invoke",{value:function(t,r){function i(){return new e((function(e,i){n(t,r,e,i)}))}return o=o?o.then(i,i):i()}})}function O(e,n,r){var i=h;return function(o,a){if(i===d)throw Error("Generator is already running");if(i===m){if("throw"===o)throw a;return{value:t,done:!0}}for(r.method=o,r.arg=a;;){var s=r.delegate;if(s){var u=P(s,r);if(u){if(u===y)continue;return u}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(i===h)throw i=m,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);i=d;var c=f(e,n,r);if("normal"===c.type){if(i=r.done?m:p,c.arg===y)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(i=m,r.method="throw",r.arg=c.arg)}}}function P(e,n){var r=n.method,i=e.iterator[r];if(i===t)return n.delegate=null,"throw"===r&&e.iterator.return&&(n.method="return",n.arg=t,P(e,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),y;var o=f(i,e.iterator,n.arg);if("throw"===o.type)return n.method="throw",n.arg=o.arg,n.delegate=null,y;var a=o.arg;return a?a.done?(n[e.resultName]=a.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,y):a:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,y)}function R(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function k(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function C(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(R,this),this.reset(!0)}function N(e){if(e||""===e){var n=e[a];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,o=function n(){for(;++i<e.length;)if(r.call(e,i))return n.value=e[i],n.done=!1,n;return n.value=t,n.done=!0,n};return o.next=o}}throw new TypeError(A(e)+" is not iterable")}return g.prototype=b,i(S,"constructor",{value:b,configurable:!0}),i(b,"constructor",{value:g,configurable:!0}),g.displayName=c(b,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===g||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,c(t,u,"GeneratorFunction")),t.prototype=Object.create(S),t},e.awrap=function(t){return{__await:t}},T(E.prototype),c(E.prototype,s,(function(){return this})),e.AsyncIterator=E,e.async=function(t,n,r,i,o){void 0===o&&(o=Promise);var a=new E(l(t,n,r,i),o);return e.isGeneratorFunction(n)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},T(S),c(S,u,"Generator"),c(S,a,(function(){return this})),c(S,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),n=[];for(var r in e)n.push(r);return n.reverse(),function t(){for(;n.length;){var r=n.pop();if(r in e)return t.value=r,t.done=!1,t}return t.done=!0,t}},e.values=N,C.prototype={constructor:C,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(k),!e)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function i(r,i){return s.type="throw",s.arg=e,n.next=r,i&&(n.method="next",n.arg=t),!!i}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],s=a.completion;if("root"===a.tryLoc)return i("end");if(a.tryLoc<=this.prev){var u=r.call(a,"catchLoc"),c=r.call(a,"finallyLoc");if(u&&c){if(this.prev<a.catchLoc)return i(a.catchLoc,!0);if(this.prev<a.finallyLoc)return i(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return i(a.catchLoc,!0)}else{if(!c)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return i(a.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=t,a.arg=e,o?(this.method="next",this.next=o.finallyLoc,y):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),y},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),k(n),y}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var i=r.arg;k(n)}return i}}throw Error("illegal catch attempt")},delegateYield:function(e,n,r){return this.delegate={iterator:N(e),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=t),y}},e}function E(t,e,n,r,i,o,a){try{var s=t[o](a),u=s.value}catch(t){return void n(t)}s.done?e(u):Promise.resolve(u).then(r,i)}function A(t){return A="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},A(t)}function O(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function P(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,k(r.key),r)}}function R(t,e,n){return e&&P(t.prototype,e),n&&P(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function k(t){var e=function(t,e){if("object"!=A(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=A(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==A(e)?e:e+""}var C=0,N=function(){return R((function t(e,n){O(this,t),this.buffers=[e.bufferGPU,n],this.type=e.type,this.bufferType=e.bufferType,this.pbo=e.pbo,this.byteLength=e.byteLength,this.bytesPerElement=e.BYTES_PER_ELEMENT,this.version=e.version,this.isInteger=e.isInteger,this.activeBufferIndex=0,this.baseId=e.id}),[{key:"id",get:function(){return"".concat(this.baseId,"|").concat(this.activeBufferIndex)}},{key:"bufferGPU",get:function(){return this.buffers[this.activeBufferIndex]}},{key:"transformBuffer",get:function(){return this.buffers[1^this.activeBufferIndex]}},{key:"switchBuffers",value:function(){this.activeBufferIndex^=1}}])}();const L=function(){return R((function t(e){O(this,t),this.backend=e}),[{key:"createAttribute",value:function(t,e){var n,i=this.backend,o=i.gl,a=t.array,s=t.usage||o.STATIC_DRAW,u=t.isInterleavedBufferAttribute?t.data:t,c=i.get(u),l=c.bufferGPU;if(void 0===l&&(l=this._createBuffer(o,e,a,s),c.bufferGPU=l,c.bufferType=e,c.version=u.version),a instanceof Float32Array)n=o.FLOAT;else if(a instanceof Uint16Array)n=t.isFloat16BufferAttribute?o.HALF_FLOAT:o.UNSIGNED_SHORT;else if(a instanceof Int16Array)n=o.SHORT;else if(a instanceof Uint32Array)n=o.UNSIGNED_INT;else if(a instanceof Int32Array)n=o.INT;else if(a instanceof Int8Array)n=o.BYTE;else if(a instanceof Uint8Array)n=o.UNSIGNED_BYTE;else{if(!(a instanceof Uint8ClampedArray))throw new Error("THREE.WebGLBackend: Unsupported buffer data format: "+a);n=o.UNSIGNED_BYTE}var f={bufferGPU:l,bufferType:e,type:n,byteLength:a.byteLength,bytesPerElement:a.BYTES_PER_ELEMENT,version:t.version,pbo:t.pbo,isInteger:n===o.INT||n===o.UNSIGNED_INT||n===o.UNSIGNED_SHORT||t.gpuType===r.Yuy,id:C++};if(t.isStorageBufferAttribute||t.isStorageInstancedBufferAttribute){var h=this._createBuffer(o,e,a,s);f=new N(f,h)}i.set(t,f)}},{key:"updateAttribute",value:function(t){var e=this.backend,n=e.gl,r=t.array,i=t.isInterleavedBufferAttribute?t.data:t,o=e.get(i),a=o.bufferType,s=t.isInterleavedBufferAttribute?t.data.updateRanges:t.updateRanges;if(n.bindBuffer(a,o.bufferGPU),0===s.length)n.bufferSubData(a,0,r);else{for(var u=0,c=s.length;u<c;u++){var l=s[u];n.bufferSubData(a,l.start*r.BYTES_PER_ELEMENT,r,l.start,l.count)}i.clearUpdateRanges()}n.bindBuffer(a,null),o.version=i.version}},{key:"destroyAttribute",value:function(t){var e=this.backend,n=e.gl;t.isInterleavedBufferAttribute&&e.delete(t.data);var r=e.get(t);n.deleteBuffer(r.bufferGPU),e.delete(t)}},{key:"getArrayBufferAsync",value:(t=M().mark((function t(e){var n,r,i,o,a,s,u,c,l;return M().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=this.backend,r=n.gl,i=e.isInterleavedBufferAttribute?e.data:e,o=n.get(i),a=o.bufferGPU,s=e.array,u=s.byteLength,r.bindBuffer(r.COPY_READ_BUFFER,a),c=r.createBuffer(),r.bindBuffer(r.COPY_WRITE_BUFFER,c),r.bufferData(r.COPY_WRITE_BUFFER,u,r.STREAM_READ),r.copyBufferSubData(r.COPY_READ_BUFFER,r.COPY_WRITE_BUFFER,0,0,u),t.next=13,n.utils._clientWaitAsync();case 13:return l=new e.array.constructor(s.length),r.getBufferSubData(r.COPY_WRITE_BUFFER,0,l),r.deleteBuffer(c),t.abrupt("return",l.buffer);case 17:case"end":return t.stop()}}),t,this)})),e=function(){var e=this,n=arguments;return new Promise((function(r,i){var o=t.apply(e,n);function a(t){E(o,r,i,a,s,"next",t)}function s(t){E(o,r,i,a,s,"throw",t)}a(void 0)}))},function(t){return e.apply(this,arguments)})},{key:"_createBuffer",value:function(t,e,n,r){var i=t.createBuffer();return t.bindBuffer(e,i),t.bufferData(e,n,r),t.bindBuffer(e,null),i}}]);var t,e}();function j(t){return j="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},j(t)}function I(t,e,n){return(e=U(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function B(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,U(r.key),r)}}function U(t){var e=function(t,e){if("object"!=j(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=j(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==j(e)?e:e+""}var D,F,z=!1;const V=function(){return t=function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.backend=e,this.gl=this.backend.gl,this.enabled={},this.currentFlipSided=null,this.currentCullFace=null,this.currentProgram=null,this.currentBlendingEnabled=!1,this.currentBlending=null,this.currentBlendSrc=null,this.currentBlendDst=null,this.currentBlendSrcAlpha=null,this.currentBlendDstAlpha=null,this.currentPremultipledAlpha=null,this.currentPolygonOffsetFactor=null,this.currentPolygonOffsetUnits=null,this.currentColorMask=null,this.currentDepthFunc=null,this.currentDepthMask=null,this.currentStencilFunc=null,this.currentStencilRef=null,this.currentStencilFuncMask=null,this.currentStencilFail=null,this.currentStencilZFail=null,this.currentStencilZPass=null,this.currentStencilMask=null,this.currentLineWidth=null,this.currentBoundFramebuffers={},this.currentDrawbuffers=new WeakMap,this.maxTextures=this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS),this.currentTextureSlot=null,this.currentBoundTextures={},!1===z&&(this._init(this.gl),z=!0)},(e=[{key:"_init",value:function(t){var e;D=I(I(I({},r.gO9,t.FUNC_ADD),r.FXf,t.FUNC_SUBTRACT),r.nST,t.FUNC_REVERSE_SUBTRACT),I(I(I(I(I(I(I(I(I(I(e={},r.ojh,t.ZERO),r.qad,t.ONE),r.f4X,t.SRC_COLOR),r.ie2,t.SRC_ALPHA),r.hgQ,t.SRC_ALPHA_SATURATE),r.wn6,t.DST_COLOR),r.hdd,t.DST_ALPHA),r.LiQ,t.ONE_MINUS_SRC_COLOR),r.OuU,t.ONE_MINUS_SRC_ALPHA),r.aEY,t.ONE_MINUS_DST_COLOR),F=I(e,r.Nt7,t.ONE_MINUS_DST_ALPHA)}},{key:"enable",value:function(t){var e=this.enabled;!0!==e[t]&&(this.gl.enable(t),e[t]=!0)}},{key:"disable",value:function(t){var e=this.enabled;!1!==e[t]&&(this.gl.disable(t),e[t]=!1)}},{key:"setFlipSided",value:function(t){if(this.currentFlipSided!==t){var e=this.gl;t?e.frontFace(e.CW):e.frontFace(e.CCW),this.currentFlipSided=t}}},{key:"setCullFace",value:function(t){var e=this.gl;t!==r.WNZ?(this.enable(e.CULL_FACE),t!==this.currentCullFace&&(t===r.Vb5?e.cullFace(e.BACK):t===r.Jnc?e.cullFace(e.FRONT):e.cullFace(e.FRONT_AND_BACK))):this.disable(e.CULL_FACE),this.currentCullFace=t}},{key:"setLineWidth",value:function(t){var e=this.currentLineWidth,n=this.gl;t!==e&&(n.lineWidth(t),this.currentLineWidth=t)}},{key:"setBlending",value:function(t,e,n,i,o,a,s,u){var c=this.gl;if(t!==r.XIg){if(!1===this.currentBlendingEnabled&&(this.enable(c.BLEND),this.currentBlendingEnabled=!0),t===r.bCz)o=o||e,a=a||n,s=s||i,e===this.currentBlendEquation&&o===this.currentBlendEquationAlpha||(c.blendEquationSeparate(D[e],D[o]),this.currentBlendEquation=e,this.currentBlendEquationAlpha=o),n===this.currentBlendSrc&&i===this.currentBlendDst&&a===this.currentBlendSrcAlpha&&s===this.currentBlendDstAlpha||(c.blendFuncSeparate(F[n],F[i],F[a],F[s]),this.currentBlendSrc=n,this.currentBlendDst=i,this.currentBlendSrcAlpha=a,this.currentBlendDstAlpha=s),this.currentBlending=t,this.currentPremultipledAlpha=!1;else if(t!==this.currentBlending||u!==this.currentPremultipledAlpha){if(this.currentBlendEquation===r.gO9&&this.currentBlendEquationAlpha===r.gO9||(c.blendEquation(c.FUNC_ADD),this.currentBlendEquation=r.gO9,this.currentBlendEquationAlpha=r.gO9),u)switch(t){case r.NTi:c.blendFuncSeparate(c.ONE,c.ONE_MINUS_SRC_ALPHA,c.ONE,c.ONE_MINUS_SRC_ALPHA);break;case r.EZo:c.blendFunc(c.ONE,c.ONE);break;case r.Kwu:c.blendFuncSeparate(c.ZERO,c.ONE_MINUS_SRC_COLOR,c.ZERO,c.ONE);break;case r.EdD:c.blendFuncSeparate(c.ZERO,c.SRC_COLOR,c.ZERO,c.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}else switch(t){case r.NTi:c.blendFuncSeparate(c.SRC_ALPHA,c.ONE_MINUS_SRC_ALPHA,c.ONE,c.ONE_MINUS_SRC_ALPHA);break;case r.EZo:c.blendFunc(c.SRC_ALPHA,c.ONE);break;case r.Kwu:c.blendFuncSeparate(c.ZERO,c.ONE_MINUS_SRC_COLOR,c.ZERO,c.ONE);break;case r.EdD:c.blendFunc(c.ZERO,c.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}this.currentBlendSrc=null,this.currentBlendDst=null,this.currentBlendSrcAlpha=null,this.currentBlendDstAlpha=null,this.currentBlending=t,this.currentPremultipledAlpha=u}}else!0===this.currentBlendingEnabled&&(this.disable(c.BLEND),this.currentBlendingEnabled=!1)}},{key:"setColorMask",value:function(t){this.currentColorMask!==t&&(this.gl.colorMask(t,t,t,t),this.currentColorMask=t)}},{key:"setDepthTest",value:function(t){var e=this.gl;t?this.enable(e.DEPTH_TEST):this.disable(e.DEPTH_TEST)}},{key:"setDepthMask",value:function(t){this.currentDepthMask!==t&&(this.gl.depthMask(t),this.currentDepthMask=t)}},{key:"setDepthFunc",value:function(t){if(this.currentDepthFunc!==t){var e=this.gl;switch(t){case r.eHc:e.depthFunc(e.NEVER);break;case r.lGu:e.depthFunc(e.ALWAYS);break;case r.brA:e.depthFunc(e.LESS);break;case r.xSv:e.depthFunc(e.LEQUAL);break;case r.U3G:e.depthFunc(e.EQUAL);break;case r.Gwm:e.depthFunc(e.GEQUAL);break;case r.K52:e.depthFunc(e.GREATER);break;case r.bw0:e.depthFunc(e.NOTEQUAL);break;default:e.depthFunc(e.LEQUAL)}this.currentDepthFunc=t}}},{key:"setStencilTest",value:function(t){var e=this.gl;t?this.enable(e.STENCIL_TEST):this.disable(e.STENCIL_TEST)}},{key:"setStencilMask",value:function(t){this.currentStencilMask!==t&&(this.gl.stencilMask(t),this.currentStencilMask=t)}},{key:"setStencilFunc",value:function(t,e,n){this.currentStencilFunc===t&&this.currentStencilRef===e&&this.currentStencilFuncMask===n||(this.gl.stencilFunc(t,e,n),this.currentStencilFunc=t,this.currentStencilRef=e,this.currentStencilFuncMask=n)}},{key:"setStencilOp",value:function(t,e,n){this.currentStencilFail===t&&this.currentStencilZFail===e&&this.currentStencilZPass===n||(this.gl.stencilOp(t,e,n),this.currentStencilFail=t,this.currentStencilZFail=e,this.currentStencilZPass=n)}},{key:"setMaterial",value:function(t,e){var n=this.gl;t.side===r.$EB?this.disable(n.CULL_FACE):this.enable(n.CULL_FACE);var i=t.side===r.hsX;e&&(i=!i),this.setFlipSided(i),t.blending===r.NTi&&!1===t.transparent?this.setBlending(r.XIg):this.setBlending(t.blending,t.blendEquation,t.blendSrc,t.blendDst,t.blendEquationAlpha,t.blendSrcAlpha,t.blendDstAlpha,t.premultipliedAlpha),this.setDepthFunc(t.depthFunc),this.setDepthTest(t.depthTest),this.setDepthMask(t.depthWrite),this.setColorMask(t.colorWrite);var o=t.stencilWrite;this.setStencilTest(o),o&&(this.setStencilMask(t.stencilWriteMask),this.setStencilFunc(t.stencilFunc,t.stencilRef,t.stencilFuncMask),this.setStencilOp(t.stencilFail,t.stencilZFail,t.stencilZPass)),this.setPolygonOffset(t.polygonOffset,t.polygonOffsetFactor,t.polygonOffsetUnits),!0===t.alphaToCoverage?this.enable(n.SAMPLE_ALPHA_TO_COVERAGE):this.disable(n.SAMPLE_ALPHA_TO_COVERAGE)}},{key:"setPolygonOffset",value:function(t,e,n){var r=this.gl;t?(this.enable(r.POLYGON_OFFSET_FILL),this.currentPolygonOffsetFactor===e&&this.currentPolygonOffsetUnits===n||(r.polygonOffset(e,n),this.currentPolygonOffsetFactor=e,this.currentPolygonOffsetUnits=n)):this.disable(r.POLYGON_OFFSET_FILL)}},{key:"useProgram",value:function(t){return this.currentProgram!==t&&(this.gl.useProgram(t),this.currentProgram=t,!0)}},{key:"bindFramebuffer",value:function(t,e){var n=this.gl,r=this.currentBoundFramebuffers;return r[t]!==e&&(n.bindFramebuffer(t,e),r[t]=e,t===n.DRAW_FRAMEBUFFER&&(r[n.FRAMEBUFFER]=e),t===n.FRAMEBUFFER&&(r[n.DRAW_FRAMEBUFFER]=e),!0)}},{key:"drawBuffers",value:function(t,e){var n=this.gl,r=[],i=!1;if(null!==t.textures){void 0===(r=this.currentDrawbuffers.get(e))&&(r=[],this.currentDrawbuffers.set(e,r));var o=t.textures;if(r.length!==o.length||r[0]!==n.COLOR_ATTACHMENT0){for(var a=0,s=o.length;a<s;a++)r[a]=n.COLOR_ATTACHMENT0+a;r.length=o.length,i=!0}}else r[0]!==n.BACK&&(r[0]=n.BACK,i=!0);i&&n.drawBuffers(r)}},{key:"activeTexture",value:function(t){var e=this.gl,n=this.currentTextureSlot,r=this.maxTextures;void 0===t&&(t=e.TEXTURE0+r-1),n!==t&&(e.activeTexture(t),this.currentTextureSlot=t)}},{key:"bindTexture",value:function(t,e,n){var r=this.gl,i=this.currentTextureSlot,o=this.currentBoundTextures,a=this.maxTextures;void 0===n&&(n=null===i?r.TEXTURE0+a-1:i);var s=o[n];void 0===s&&(s={type:void 0,texture:void 0},o[n]=s),s.type===t&&s.texture===e||(i!==n&&(r.activeTexture(n),this.currentTextureSlot=n),r.bindTexture(t,e),s.type=t,s.texture=e)}},{key:"unbindTexture",value:function(){var t=this.gl,e=this.currentTextureSlot,n=this.currentBoundTextures[e];void 0!==n&&void 0!==n.type&&(t.bindTexture(n.type,null),n.type=void 0,n.texture=void 0)}}])&&B(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();function G(t){return G="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},G(t)}function H(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,W(r.key),r)}}function W(t){var e=function(t,e){if("object"!=G(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=G(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==G(e)?e:e+""}const q=function(){return t=function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.backend=e,this.gl=this.backend.gl,this.extensions=e.extensions},e=[{key:"convert",value:function(t){var e,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:r.jf0,i=this.gl,o=this.extensions;if(t===r.OUM)return i.UNSIGNED_BYTE;if(t===r.Wew)return i.UNSIGNED_SHORT_4_4_4_4;if(t===r.gJ2)return i.UNSIGNED_SHORT_5_5_5_1;if(t===r.Dmk)return i.UNSIGNED_INT_5_9_9_9_REV;if(t===r.tJf)return i.BYTE;if(t===r.fBL)return i.SHORT;if(t===r.cHt)return i.UNSIGNED_SHORT;if(t===r.Yuy)return i.INT;if(t===r.bkx)return i.UNSIGNED_INT;if(t===r.RQf)return i.FLOAT;if(t===r.ix0)return i.HALF_FLOAT;if(t===r.wrO)return i.ALPHA;if(t===r.HIg)return i.RGB;if(t===r.GWd)return i.RGBA;if(t===r.Kzv)return i.LUMINANCE;if(t===r.CMB)return i.LUMINANCE_ALPHA;if(t===r.zdS)return i.DEPTH_COMPONENT;if(t===r.dcC)return i.DEPTH_STENCIL;if(t===r.VT0)return i.RED;if(t===r.ZQM)return i.RED_INTEGER;if(t===r.paN)return i.RG;if(t===r.TkQ)return i.RG_INTEGER;if(t===r.c90)return i.RGBA_INTEGER;if(t===r.IE4||t===r.Nz6||t===r.jR7||t===r.BXX)if(n===r.er$){if(null===(e=o.get("WEBGL_compressed_texture_s3tc_srgb")))return null;if(t===r.IE4)return e.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(t===r.Nz6)return e.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(t===r.jR7)return e.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(t===r.BXX)return e.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(null===(e=o.get("WEBGL_compressed_texture_s3tc")))return null;if(t===r.IE4)return e.COMPRESSED_RGB_S3TC_DXT1_EXT;if(t===r.Nz6)return e.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(t===r.jR7)return e.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(t===r.BXX)return e.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(t===r.k6Q||t===r.kTp||t===r.HXV||t===r.pBf){if(null===(e=o.get("WEBGL_compressed_texture_pvrtc")))return null;if(t===r.k6Q)return e.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(t===r.kTp)return e.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(t===r.HXV)return e.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(t===r.pBf)return e.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(t===r.CVz)return null!==(e=o.get("WEBGL_compressed_texture_etc1"))?e.COMPRESSED_RGB_ETC1_WEBGL:null;if(t===r.Riy||t===r.KDk){if(null===(e=o.get("WEBGL_compressed_texture_etc")))return null;if(t===r.Riy)return n===r.er$?e.COMPRESSED_SRGB8_ETC2:e.COMPRESSED_RGB8_ETC2;if(t===r.KDk)return n===r.er$?e.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:e.COMPRESSED_RGBA8_ETC2_EAC}if(t===r.qa3||t===r.B_h||t===r.czI||t===r.rSH||t===r.Qrf||t===r.psI||t===r.a5J||t===r._QJ||t===r.uB5||t===r.lyL||t===r.bC7||t===r.y3Z||t===r.ojs||t===r.S$4){if(null===(e=o.get("WEBGL_compressed_texture_astc")))return null;if(t===r.qa3)return n===r.er$?e.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:e.COMPRESSED_RGBA_ASTC_4x4_KHR;if(t===r.B_h)return n===r.er$?e.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:e.COMPRESSED_RGBA_ASTC_5x4_KHR;if(t===r.czI)return n===r.er$?e.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:e.COMPRESSED_RGBA_ASTC_5x5_KHR;if(t===r.rSH)return n===r.er$?e.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:e.COMPRESSED_RGBA_ASTC_6x5_KHR;if(t===r.Qrf)return n===r.er$?e.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:e.COMPRESSED_RGBA_ASTC_6x6_KHR;if(t===r.psI)return n===r.er$?e.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:e.COMPRESSED_RGBA_ASTC_8x5_KHR;if(t===r.a5J)return n===r.er$?e.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:e.COMPRESSED_RGBA_ASTC_8x6_KHR;if(t===r._QJ)return n===r.er$?e.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:e.COMPRESSED_RGBA_ASTC_8x8_KHR;if(t===r.uB5)return n===r.er$?e.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:e.COMPRESSED_RGBA_ASTC_10x5_KHR;if(t===r.lyL)return n===r.er$?e.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:e.COMPRESSED_RGBA_ASTC_10x6_KHR;if(t===r.bC7)return n===r.er$?e.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:e.COMPRESSED_RGBA_ASTC_10x8_KHR;if(t===r.y3Z)return n===r.er$?e.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:e.COMPRESSED_RGBA_ASTC_10x10_KHR;if(t===r.ojs)return n===r.er$?e.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:e.COMPRESSED_RGBA_ASTC_12x10_KHR;if(t===r.S$4)return n===r.er$?e.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:e.COMPRESSED_RGBA_ASTC_12x12_KHR}if(t===r.Fn){if(null===(e=o.get("EXT_texture_compression_bptc")))return null;if(t===r.Fn)return n===r.er$?e.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:e.COMPRESSED_RGBA_BPTC_UNORM_EXT}if(t===r.Kef||t===r.XG_||t===r.HO_||t===r.CWW){if(null===(e=o.get("EXT_texture_compression_rgtc")))return null;if(t===r.Fn)return e.COMPRESSED_RED_RGTC1_EXT;if(t===r.XG_)return e.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(t===r.HO_)return e.COMPRESSED_RED_GREEN_RGTC2_EXT;if(t===r.CWW)return e.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}return t===r.V3x?i.UNSIGNED_INT_24_8:void 0!==i[t]?i[t]:null}},{key:"_clientWaitAsync",value:function(){var t=this.gl,e=t.fenceSync(t.SYNC_GPU_COMMANDS_COMPLETE,0);return t.flush(),new Promise((function(n,r){!function i(){var o=t.clientWaitSync(e,t.SYNC_FLUSH_COMMANDS_BIT,0);if(o===t.WAIT_FAILED)return t.deleteSync(e),void r();o!==t.TIMEOUT_EXPIRED?(t.deleteSync(e),n()):requestAnimationFrame(i)}()}))}}],e&&H(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();function X(t){return X="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},X(t)}function Y(){Y=function(){return e};var t,e={},n=Object.prototype,r=n.hasOwnProperty,i=Object.defineProperty||function(t,e,n){t[e]=n.value},o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",s=o.asyncIterator||"@@asyncIterator",u=o.toStringTag||"@@toStringTag";function c(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{c({},"")}catch(t){c=function(t,e,n){return t[e]=n}}function l(t,e,n,r){var o=e&&e.prototype instanceof v?e:v,a=Object.create(o.prototype),s=new R(r||[]);return i(a,"_invoke",{value:E(t,n,s)}),a}function f(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var h="suspendedStart",p="suspendedYield",d="executing",m="completed",y={};function v(){}function g(){}function b(){}var _={};c(_,a,(function(){return this}));var x=Object.getPrototypeOf,w=x&&x(x(k([])));w&&w!==n&&r.call(w,a)&&(_=w);var S=b.prototype=v.prototype=Object.create(_);function T(t){["next","throw","return"].forEach((function(e){c(t,e,(function(t){return this._invoke(e,t)}))}))}function M(t,e){function n(i,o,a,s){var u=f(t[i],t,o);if("throw"!==u.type){var c=u.arg,l=c.value;return l&&"object"==X(l)&&r.call(l,"__await")?e.resolve(l.__await).then((function(t){n("next",t,a,s)}),(function(t){n("throw",t,a,s)})):e.resolve(l).then((function(t){c.value=t,a(c)}),(function(t){return n("throw",t,a,s)}))}s(u.arg)}var o;i(this,"_invoke",{value:function(t,r){function i(){return new e((function(e,i){n(t,r,e,i)}))}return o=o?o.then(i,i):i()}})}function E(e,n,r){var i=h;return function(o,a){if(i===d)throw Error("Generator is already running");if(i===m){if("throw"===o)throw a;return{value:t,done:!0}}for(r.method=o,r.arg=a;;){var s=r.delegate;if(s){var u=A(s,r);if(u){if(u===y)continue;return u}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(i===h)throw i=m,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);i=d;var c=f(e,n,r);if("normal"===c.type){if(i=r.done?m:p,c.arg===y)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(i=m,r.method="throw",r.arg=c.arg)}}}function A(e,n){var r=n.method,i=e.iterator[r];if(i===t)return n.delegate=null,"throw"===r&&e.iterator.return&&(n.method="return",n.arg=t,A(e,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),y;var o=f(i,e.iterator,n.arg);if("throw"===o.type)return n.method="throw",n.arg=o.arg,n.delegate=null,y;var a=o.arg;return a?a.done?(n[e.resultName]=a.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,y):a:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,y)}function O(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function P(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function R(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(O,this),this.reset(!0)}function k(e){if(e||""===e){var n=e[a];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,o=function n(){for(;++i<e.length;)if(r.call(e,i))return n.value=e[i],n.done=!1,n;return n.value=t,n.done=!0,n};return o.next=o}}throw new TypeError(X(e)+" is not iterable")}return g.prototype=b,i(S,"constructor",{value:b,configurable:!0}),i(b,"constructor",{value:g,configurable:!0}),g.displayName=c(b,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===g||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,c(t,u,"GeneratorFunction")),t.prototype=Object.create(S),t},e.awrap=function(t){return{__await:t}},T(M.prototype),c(M.prototype,s,(function(){return this})),e.AsyncIterator=M,e.async=function(t,n,r,i,o){void 0===o&&(o=Promise);var a=new M(l(t,n,r,i),o);return e.isGeneratorFunction(n)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},T(S),c(S,u,"Generator"),c(S,a,(function(){return this})),c(S,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),n=[];for(var r in e)n.push(r);return n.reverse(),function t(){for(;n.length;){var r=n.pop();if(r in e)return t.value=r,t.done=!1,t}return t.done=!0,t}},e.values=k,R.prototype={constructor:R,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(P),!e)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function i(r,i){return s.type="throw",s.arg=e,n.next=r,i&&(n.method="next",n.arg=t),!!i}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],s=a.completion;if("root"===a.tryLoc)return i("end");if(a.tryLoc<=this.prev){var u=r.call(a,"catchLoc"),c=r.call(a,"finallyLoc");if(u&&c){if(this.prev<a.catchLoc)return i(a.catchLoc,!0);if(this.prev<a.finallyLoc)return i(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return i(a.catchLoc,!0)}else{if(!c)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return i(a.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=t,a.arg=e,o?(this.method="next",this.next=o.finallyLoc,y):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),y},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),P(n),y}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var i=r.arg;P(n)}return i}}throw Error("illegal catch attempt")},delegateYield:function(e,n,r){return this.delegate={iterator:k(e),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=t),y}},e}function J(t,e,n,r,i,o,a){try{var s=t[o](a),u=s.value}catch(t){return void n(t)}s.done?e(u):Promise.resolve(u).then(r,i)}function Z(t,e,n){return(e=Q(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function K(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Q(r.key),r)}}function Q(t){var e=function(t,e){if("object"!=X(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=X(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==X(e)?e:e+""}var $,tt,et,nt=!1;const rt=function(){return t=function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.backend=e,this.gl=e.gl,this.extensions=e.extensions,this.defaultTextures={},!1===nt&&(this._init(this.gl),nt=!0)},e=[{key:"_init",value:function(t){$=Z(Z(Z({},r.GJx,t.REPEAT),r.ghU,t.CLAMP_TO_EDGE),r.kTW,t.MIRRORED_REPEAT),tt=Z(Z(Z(Z(Z(Z({},r.hxR,t.NEAREST),r.pHI,t.NEAREST_MIPMAP_NEAREST),r.Cfg,t.NEAREST_MIPMAP_LINEAR),r.k6q,t.LINEAR),r.kRr,t.LINEAR_MIPMAP_NEAREST),r.$_I,t.LINEAR_MIPMAP_LINEAR),et=Z(Z(Z(Z(Z(Z(Z(Z({},r.amv,t.NEVER),r.FFZ,t.ALWAYS),r.vim,t.LESS),r.TiK,t.LEQUAL),r.kO0,t.EQUAL),r.gWB,t.GEQUAL),r.eoi,t.GREATER),r.jzd,t.NOTEQUAL)}},{key:"filterFallback",value:function(t){var e=this.gl;return t===r.hxR||t===r.pHI||t===r.Cfg?e.NEAREST:e.LINEAR}},{key:"getGLTextureType",value:function(t){var e=this.gl;return!0===t.isCubeTexture?e.TEXTURE_CUBE_MAP:!0===t.isDataArrayTexture?e.TEXTURE_2D_ARRAY:e.TEXTURE_2D}},{key:"getInternalFormat",value:function(t,e,n,i){var o=arguments.length>4&&void 0!==arguments[4]&&arguments[4],a=this.gl,s=this.extensions;if(null!==t){if(void 0!==a[t])return a[t];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+t+"'")}var u=e;return e===a.RED&&(n===a.FLOAT&&(u=a.R32F),n===a.HALF_FLOAT&&(u=a.R16F),n===a.UNSIGNED_BYTE&&(u=a.R8)),e===a.RED_INTEGER&&(n===a.UNSIGNED_BYTE&&(u=a.R8UI),n===a.UNSIGNED_SHORT&&(u=a.R16UI),n===a.UNSIGNED_INT&&(u=a.R32UI),n===a.BYTE&&(u=a.R8I),n===a.SHORT&&(u=a.R16I),n===a.INT&&(u=a.R32I)),e===a.RG&&(n===a.FLOAT&&(u=a.RG32F),n===a.HALF_FLOAT&&(u=a.RG16F),n===a.UNSIGNED_BYTE&&(u=a.RG8)),e===a.RGB&&(n===a.FLOAT&&(u=a.RGB32F),n===a.HALF_FLOAT&&(u=a.RGB16F),n===a.UNSIGNED_BYTE&&(u=a.RGB8),n===a.UNSIGNED_SHORT_5_6_5&&(u=a.RGB565),n===a.UNSIGNED_SHORT_5_5_5_1&&(u=a.RGB5_A1),n===a.UNSIGNED_SHORT_4_4_4_4&&(u=a.RGB4),n===a.UNSIGNED_INT_5_9_9_9_REV&&(u=a.RGB9_E5)),e===a.RGBA&&(n===a.FLOAT&&(u=a.RGBA32F),n===a.HALF_FLOAT&&(u=a.RGBA16F),n===a.UNSIGNED_BYTE&&(u=i===r.er$&&!1===o?a.SRGB8_ALPHA8:a.RGBA8),n===a.UNSIGNED_SHORT_4_4_4_4&&(u=a.RGBA4),n===a.UNSIGNED_SHORT_5_5_5_1&&(u=a.RGB5_A1)),e===a.DEPTH_COMPONENT&&(n===a.UNSIGNED_INT&&(u=a.DEPTH24_STENCIL8),n===a.FLOAT&&(u=a.DEPTH_COMPONENT32F)),e===a.DEPTH_STENCIL&&n===a.UNSIGNED_INT_24_8&&(u=a.DEPTH24_STENCIL8),u!==a.R16F&&u!==a.R32F&&u!==a.RG16F&&u!==a.RG32F&&u!==a.RGBA16F&&u!==a.RGBA32F||s.get("EXT_color_buffer_float"),u}},{key:"setTextureParameters",value:function(t,e){var n=this.gl,i=this.extensions,o=this.backend,a=o.get(e).currentAnisotropy;n.texParameteri(t,n.TEXTURE_WRAP_S,$[e.wrapS]),n.texParameteri(t,n.TEXTURE_WRAP_T,$[e.wrapT]),t!==n.TEXTURE_3D&&t!==n.TEXTURE_2D_ARRAY||n.texParameteri(t,n.TEXTURE_WRAP_R,$[e.wrapR]),n.texParameteri(t,n.TEXTURE_MAG_FILTER,tt[e.magFilter]);var s=e.isVideoTexture||e.minFilter!==r.k6q?e.minFilter:r.$_I;if(n.texParameteri(t,n.TEXTURE_MIN_FILTER,tt[s]),e.compareFunction&&(n.texParameteri(t,n.TEXTURE_COMPARE_MODE,n.COMPARE_REF_TO_TEXTURE),n.texParameteri(t,n.TEXTURE_COMPARE_FUNC,et[e.compareFunction])),!0===i.has("EXT_texture_filter_anisotropic")){if(e.magFilter===r.hxR)return;if(e.minFilter!==r.Cfg&&e.minFilter!==r.$_I)return;if(e.type===r.RQf&&!1===i.has("OES_texture_float_linear"))return;if(e.anisotropy>1||a!==e.anisotropy){var u=i.get("EXT_texture_filter_anisotropic");n.texParameterf(t,u.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(e.anisotropy,o.getMaxAnisotropy())),o.get(e).currentAnisotropy=e.anisotropy}}}},{key:"createDefaultTexture",value:function(t){var e=this.gl,n=this.backend,r=this.defaultTextures,i=this.getGLTextureType(t),o=r[i];void 0===o&&(o=e.createTexture(),n.state.bindTexture(i,o),e.texParameteri(i,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(i,e.TEXTURE_MAG_FILTER,e.NEAREST),r[i]=o),n.set(t,{textureGPU:o,glTextureType:i,isDefault:!0})}},{key:"createTexture",value:function(t,e){var n=this.gl,r=this.backend,i=e.levels,o=e.width,a=e.height,s=e.depth,u=r.utils.convert(t.format,t.colorSpace),c=r.utils.convert(t.type),l=this.getInternalFormat(t.internalFormat,u,c,t.colorSpace,t.isVideoTexture),f=n.createTexture(),h=this.getGLTextureType(t);r.state.bindTexture(h,f),n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,t.flipY),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.premultiplyAlpha),n.pixelStorei(n.UNPACK_ALIGNMENT,t.unpackAlignment),n.pixelStorei(n.UNPACK_COLORSPACE_CONVERSION_WEBGL,n.NONE),this.setTextureParameters(h,t),t.isDataArrayTexture?n.texStorage3D(n.TEXTURE_2D_ARRAY,i,l,o,a,s):t.isVideoTexture||n.texStorage2D(h,i,l,o,a),r.set(t,{textureGPU:f,glTextureType:h,glFormat:u,glType:c,glInternalFormat:l})}},{key:"copyBufferToTexture",value:function(t,e){var n=this.gl,r=this.backend,i=r.get(e),o=i.textureGPU,a=i.glTextureType,s=i.glFormat,u=i.glType,c=e.source.data,l=c.width,f=c.height;n.bindBuffer(n.PIXEL_UNPACK_BUFFER,t),r.state.bindTexture(a,o),n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,!1),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),n.texSubImage2D(a,0,0,0,l,f,s,u,0),n.bindBuffer(n.PIXEL_UNPACK_BUFFER,null),r.state.unbindTexture()}},{key:"updateTexture",value:function(t,e){var n=this.gl,r=e.width,i=e.height,o=this.backend.get(t),a=o.textureGPU,s=o.glTextureType,u=o.glFormat,c=o.glType,l=o.glInternalFormat;if(!t.isRenderTargetTexture&&void 0!==a){var f=function(t){return t.isDataTexture?t.image.data:t instanceof ImageBitmap||t instanceof OffscreenCanvas||t instanceof HTMLImageElement||t instanceof HTMLCanvasElement?t:t.data};if(this.backend.state.bindTexture(s,a),t.isCompressedTexture)for(var h=t.mipmaps,p=0;p<h.length;p++){var d=h[p];if(t.isCompressedArrayTexture){var m=e.image;t.format!==n.RGBA?null!==u?n.compressedTexSubImage3D(n.TEXTURE_2D_ARRAY,p,0,0,0,d.width,d.height,m.depth,u,d.data,0,0):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):n.texSubImage3D(n.TEXTURE_2D_ARRAY,p,0,0,0,d.width,d.height,m.depth,u,c,d.data)}else null!==u?n.compressedTexSubImage2D(n.TEXTURE_2D,p,0,0,d.width,d.height,u,d.data):console.warn("Unsupported compressed texture format")}else if(t.isCubeTexture)for(var y=e.images,v=0;v<6;v++){var g=f(y[v]);n.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+v,0,0,0,r,i,u,c,g)}else if(t.isDataArrayTexture){var b=e.image;n.texSubImage3D(n.TEXTURE_2D_ARRAY,0,0,0,0,b.width,b.height,b.depth,u,c,b.data)}else if(t.isVideoTexture)t.update(),n.texImage2D(s,0,l,u,c,e.image);else{var _=f(e.image);n.texSubImage2D(s,0,0,0,r,i,u,c,_)}}}},{key:"generateMipmaps",value:function(t){var e=this.gl,n=this.backend,r=n.get(t),i=r.textureGPU,o=r.glTextureType;n.state.bindTexture(o,i),e.generateMipmap(o)}},{key:"deallocateRenderBuffers",value:function(t){var e=this.gl,n=this.backend;if(t){var r=n.get(t);if(r.renderBufferStorageSetup=void 0,r.framebuffer&&(e.deleteFramebuffer(r.framebuffer),r.framebuffer=void 0),r.depthRenderbuffer&&(e.deleteRenderbuffer(r.depthRenderbuffer),r.depthRenderbuffer=void 0),r.stencilRenderbuffer&&(e.deleteRenderbuffer(r.stencilRenderbuffer),r.stencilRenderbuffer=void 0),r.msaaFrameBuffer&&(e.deleteFramebuffer(r.msaaFrameBuffer),r.msaaFrameBuffer=void 0),r.msaaRenderbuffers){for(var i=0;i<r.msaaRenderbuffers.length;i++)e.deleteRenderbuffer(r.msaaRenderbuffers[i]);r.msaaRenderbuffers=void 0}}}},{key:"destroyTexture",value:function(t){var e=this.gl,n=this.backend,r=n.get(t),i=r.textureGPU,o=r.renderTarget;this.deallocateRenderBuffers(o),e.deleteTexture(i),n.delete(t)}},{key:"copyTextureToTexture",value:function(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=this.gl,o=this.backend,a=this.backend.state,s=e.image.width,u=e.image.height,c=o.get(n),l=c.textureGPU,f=c.glTextureType,h=c.glType,p=c.glFormat;a.bindTexture(f,l),i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,n.flipY),i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n.premultiplyAlpha),i.pixelStorei(i.UNPACK_ALIGNMENT,n.unpackAlignment),e.isDataTexture?i.texSubImage2D(i.TEXTURE_2D,r,t.x,t.y,s,u,p,h,e.image.data):e.isCompressedTexture?i.compressedTexSubImage2D(i.TEXTURE_2D,r,t.x,t.y,e.mipmaps[0].width,e.mipmaps[0].height,p,e.mipmaps[0].data):i.texSubImage2D(i.TEXTURE_2D,r,t.x,t.y,p,h,e.image),0===r&&n.generateMipmaps&&i.generateMipmap(i.TEXTURE_2D),a.unbindTexture()}},{key:"copyFramebufferToTexture",value:function(t,e){var n=this.gl,r=this.backend.state,i=this.backend.get(t).textureGPU,o=t.image.width,a=t.image.height;if(t.isDepthTexture){var s=n.DEPTH_BUFFER_BIT;e.stencil&&(s|=n.STENCIL_BUFFER_BIT);var u=n.createFramebuffer();r.bindFramebuffer(n.DRAW_FRAMEBUFFER,u),n.framebufferTexture2D(n.DRAW_FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.TEXTURE_2D,i,0),n.blitFramebuffer(0,0,o,a,0,0,o,a,s,n.NEAREST),n.deleteFramebuffer(u)}else r.bindTexture(n.TEXTURE_2D,i),n.copyTexSubImage2D(n.TEXTURE_2D,0,0,0,0,0,o,a),r.unbindTexture();t.generateMipmaps&&this.generateMipmaps(t),this.backend._setFramebuffer(e)}},{key:"setupRenderBufferStorage",value:function(t,e){var n=this.gl,r=e.renderTarget,i=r.samples,o=r.depthTexture,a=r.depthBuffer,s=r.stencilBuffer,u=r.width,c=r.height;if(n.bindRenderbuffer(n.RENDERBUFFER,t),a&&!s){var l=n.DEPTH_COMPONENT24;i>0?(o&&o.isDepthTexture&&o.type===n.FLOAT&&(l=n.DEPTH_COMPONENT32F),n.renderbufferStorageMultisample(n.RENDERBUFFER,i,l,u,c)):n.renderbufferStorage(n.RENDERBUFFER,l,u,c),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.RENDERBUFFER,t)}else a&&s&&(i>0?n.renderbufferStorageMultisample(n.RENDERBUFFER,i,n.DEPTH24_STENCIL8,u,c):n.renderbufferStorage(n.RENDERBUFFER,n.DEPTH_STENCIL,u,c),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.RENDERBUFFER,t))}},{key:"copyTextureToBuffer",value:(n=Y().mark((function t(e,n,r,i,o){var a,s,u,c,l,f,h,p,d,m,y,v,g;return Y().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=this.backend,s=this.gl,u=this.backend.get(e),c=u.textureGPU,l=u.glFormat,f=u.glType,h=s.createFramebuffer(),s.bindFramebuffer(s.READ_FRAMEBUFFER,h),s.framebufferTexture2D(s.READ_FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,c,0),p=this._getTypedArrayType(f),d=this._getBytesPerTexel(l),y=(m=i*o)*d,v=s.createBuffer(),s.bindBuffer(s.PIXEL_PACK_BUFFER,v),s.bufferData(s.PIXEL_PACK_BUFFER,y,s.STREAM_READ),s.readPixels(n,r,i,o,l,f,0),s.bindBuffer(s.PIXEL_PACK_BUFFER,null),t.next=16,a.utils._clientWaitAsync();case 16:return g=new p(m),s.bindBuffer(s.PIXEL_PACK_BUFFER,v),s.getBufferSubData(s.PIXEL_PACK_BUFFER,0,g),s.bindBuffer(s.PIXEL_PACK_BUFFER,null),s.deleteFramebuffer(h),t.abrupt("return",g);case 22:case"end":return t.stop()}}),t,this)})),i=function(){var t=this,e=arguments;return new Promise((function(r,i){var o=n.apply(t,e);function a(t){J(o,r,i,a,s,"next",t)}function s(t){J(o,r,i,a,s,"throw",t)}a(void 0)}))},function(t,e,n,r,o){return i.apply(this,arguments)})},{key:"_getTypedArrayType",value:function(t){var e=this.gl;if(t===e.UNSIGNED_BYTE)return Uint8Array;if(t===e.UNSIGNED_SHORT_4_4_4_4)return Uint16Array;if(t===e.UNSIGNED_SHORT_5_5_5_1)return Uint16Array;if(t===e.UNSIGNED_SHORT_5_6_5)return Uint16Array;if(t===e.UNSIGNED_SHORT)return Uint16Array;if(t===e.UNSIGNED_INT)return Uint32Array;if(t===e.FLOAT)return Float32Array;throw new Error("Unsupported WebGL type: ".concat(t))}},{key:"_getBytesPerTexel",value:function(t){var e=this.gl;return t===e.RGBA?4:t===e.RGB?3:t===e.ALPHA?1:void 0}}],e&&K(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,n,i}();function it(t){return it="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},it(t)}function ot(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,at(r.key),r)}}function at(t){var e=function(t,e){if("object"!=it(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=it(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==it(e)?e:e+""}const st=function(){return t=function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.backend=e,this.gl=this.backend.gl,this.availableExtensions=this.gl.getSupportedExtensions(),this.extensions={}},(e=[{key:"get",value:function(t){var e=this.extensions[t];return void 0===e&&(e=this.gl.getExtension(t)),e}},{key:"has",value:function(t){return this.availableExtensions.includes(t)}}])&&ot(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();function ut(t){return ut="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ut(t)}function ct(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,lt(r.key),r)}}function lt(t){var e=function(t,e){if("object"!=ut(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=ut(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==ut(e)?e:e+""}const ft=function(){return t=function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.backend=e,this.maxAnisotropy=null},(e=[{key:"getMaxAnisotropy",value:function(){if(null!==this.maxAnisotropy)return this.maxAnisotropy;var t=this.backend.gl,e=this.backend.extensions;if(!0===e.has("EXT_texture_filter_anisotropic")){var n=e.get("EXT_texture_filter_anisotropic");this.maxAnisotropy=t.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else this.maxAnisotropy=0;return this.maxAnisotropy}}])&&ct(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();var ht={WEBGL_compressed_texture_astc:"texture-compression-astc",WEBGL_compressed_texture_etc:"texture-compression-etc2",WEBGL_compressed_texture_etc1:"texture-compression-etc1",WEBGL_compressed_texture_pvrtc:"texture-compression-pvrtc",WEBKIT_WEBGL_compressed_texture_pvrtc:"texture-compression-pvrtc",WEBGL_compressed_texture_s3tc:"texture-compression-bc",EXT_texture_compression_bptc:"texture-compression-bptc",EXT_disjoint_timer_query_webgl2:"timestamp-query"};function pt(t){return pt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},pt(t)}function dt(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,mt(r.key),r)}}function mt(t){var e=function(t,e){if("object"!=pt(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=pt(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==pt(e)?e:e+""}var yt=function(){return t=function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.gl=e.gl,this.extensions=e.extensions,this.info=e.renderer.info,this.mode=null,this.index=0,this.type=null,this.object=null},(e=[{key:"render",value:function(t,e){var n=this.gl,r=this.mode,i=this.object,o=this.type,a=this.info;0!==this.index?n.drawElements(r,e,o,t):n.drawArrays(r,t,e),a.update(i,e,r,1)}},{key:"renderInstances",value:function(t,e,n){var r=this.gl,i=this.mode,o=this.type,a=this.index,s=this.object,u=this.info;0!==n&&(0!==a?r.drawElementsInstanced(i,e,o,t,n):r.drawArraysInstanced(i,t,e,n),u.update(s,e,i,n))}},{key:"renderMultiDraw",value:function(t,e,n){var r=this.extensions,i=this.mode,o=this.object,a=this.info;if(0!==n){var s=r.get("WEBGL_multi_draw");if(null===s)for(var u=0;u<n;u++)this.render(t[u],e[u]);else{0!==this.index?s.multiDrawElementsWEBGL(i,e,0,this.type,t,0,n):s.multiDrawArraysWEBGL(i,t,0,e,0,n);for(var c=0,l=0;l<n;l++)c+=e[l];a.update(o,c,i,1)}}}},{key:"renderMultiDrawInstances",value:function(t,e,n,r){var i=this.extensions,o=this.mode,a=this.object,s=this.info;if(0!==n){var u=i.get("WEBGL_multi_draw");if(null===u)for(var c=0;c<n;c++)this.renderInstances(t[c],e[c],r[c]);else{0!==this.index?u.multiDrawElementsInstancedWEBGL(o,e,0,this.type,t,0,r,0,n):u.multiDrawArraysInstancedWEBGL(o,t,0,e,0,r,0,n);for(var l=0,f=0;f<n;f++)l+=e[f];s.update(a,l,o,r)}}}}])&&dt(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();function vt(t){return vt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},vt(t)}function gt(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return bt(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?bt(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function bt(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function _t(){_t=function(){return e};var t,e={},n=Object.prototype,r=n.hasOwnProperty,i=Object.defineProperty||function(t,e,n){t[e]=n.value},o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",s=o.asyncIterator||"@@asyncIterator",u=o.toStringTag||"@@toStringTag";function c(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{c({},"")}catch(t){c=function(t,e,n){return t[e]=n}}function l(t,e,n,r){var o=e&&e.prototype instanceof v?e:v,a=Object.create(o.prototype),s=new R(r||[]);return i(a,"_invoke",{value:E(t,n,s)}),a}function f(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var h="suspendedStart",p="suspendedYield",d="executing",m="completed",y={};function v(){}function g(){}function b(){}var _={};c(_,a,(function(){return this}));var x=Object.getPrototypeOf,w=x&&x(x(k([])));w&&w!==n&&r.call(w,a)&&(_=w);var S=b.prototype=v.prototype=Object.create(_);function T(t){["next","throw","return"].forEach((function(e){c(t,e,(function(t){return this._invoke(e,t)}))}))}function M(t,e){function n(i,o,a,s){var u=f(t[i],t,o);if("throw"!==u.type){var c=u.arg,l=c.value;return l&&"object"==vt(l)&&r.call(l,"__await")?e.resolve(l.__await).then((function(t){n("next",t,a,s)}),(function(t){n("throw",t,a,s)})):e.resolve(l).then((function(t){c.value=t,a(c)}),(function(t){return n("throw",t,a,s)}))}s(u.arg)}var o;i(this,"_invoke",{value:function(t,r){function i(){return new e((function(e,i){n(t,r,e,i)}))}return o=o?o.then(i,i):i()}})}function E(e,n,r){var i=h;return function(o,a){if(i===d)throw Error("Generator is already running");if(i===m){if("throw"===o)throw a;return{value:t,done:!0}}for(r.method=o,r.arg=a;;){var s=r.delegate;if(s){var u=A(s,r);if(u){if(u===y)continue;return u}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(i===h)throw i=m,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);i=d;var c=f(e,n,r);if("normal"===c.type){if(i=r.done?m:p,c.arg===y)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(i=m,r.method="throw",r.arg=c.arg)}}}function A(e,n){var r=n.method,i=e.iterator[r];if(i===t)return n.delegate=null,"throw"===r&&e.iterator.return&&(n.method="return",n.arg=t,A(e,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),y;var o=f(i,e.iterator,n.arg);if("throw"===o.type)return n.method="throw",n.arg=o.arg,n.delegate=null,y;var a=o.arg;return a?a.done?(n[e.resultName]=a.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,y):a:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,y)}function O(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function P(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function R(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(O,this),this.reset(!0)}function k(e){if(e||""===e){var n=e[a];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,o=function n(){for(;++i<e.length;)if(r.call(e,i))return n.value=e[i],n.done=!1,n;return n.value=t,n.done=!0,n};return o.next=o}}throw new TypeError(vt(e)+" is not iterable")}return g.prototype=b,i(S,"constructor",{value:b,configurable:!0}),i(b,"constructor",{value:g,configurable:!0}),g.displayName=c(b,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===g||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,c(t,u,"GeneratorFunction")),t.prototype=Object.create(S),t},e.awrap=function(t){return{__await:t}},T(M.prototype),c(M.prototype,s,(function(){return this})),e.AsyncIterator=M,e.async=function(t,n,r,i,o){void 0===o&&(o=Promise);var a=new M(l(t,n,r,i),o);return e.isGeneratorFunction(n)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},T(S),c(S,u,"Generator"),c(S,a,(function(){return this})),c(S,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),n=[];for(var r in e)n.push(r);return n.reverse(),function t(){for(;n.length;){var r=n.pop();if(r in e)return t.value=r,t.done=!1,t}return t.done=!0,t}},e.values=k,R.prototype={constructor:R,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(P),!e)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function i(r,i){return s.type="throw",s.arg=e,n.next=r,i&&(n.method="next",n.arg=t),!!i}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],s=a.completion;if("root"===a.tryLoc)return i("end");if(a.tryLoc<=this.prev){var u=r.call(a,"catchLoc"),c=r.call(a,"finallyLoc");if(u&&c){if(this.prev<a.catchLoc)return i(a.catchLoc,!0);if(this.prev<a.finallyLoc)return i(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return i(a.catchLoc,!0)}else{if(!c)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return i(a.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=t,a.arg=e,o?(this.method="next",this.next=o.finallyLoc,y):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),y},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),P(n),y}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var i=r.arg;P(n)}return i}}throw Error("illegal catch attempt")},delegateYield:function(e,n,r){return this.delegate={iterator:k(e),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=t),y}},e}function xt(t,e,n,r,i,o,a){try{var s=t[o](a),u=s.value}catch(t){return void n(t)}s.done?e(u):Promise.resolve(u).then(r,i)}function wt(t){return function(){var e=this,n=arguments;return new Promise((function(r,i){var o=t.apply(e,n);function a(t){xt(o,r,i,a,s,"next",t)}function s(t){xt(o,r,i,a,s,"throw",t)}a(void 0)}))}}function St(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Tt(r.key),r)}}function Tt(t){var e=function(t,e){if("object"!=vt(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=vt(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==vt(e)?e:e+""}function Mt(t,e,n){return e=Ot(e),function(t,e){if(e&&("object"===vt(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,Et()?Reflect.construct(e,n||[],Ot(t).constructor):e.apply(t,n))}function Et(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(Et=function(){return!!t})()}function At(){return At="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Ot(t)););return t}(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(arguments.length<3?t:n):i.value}},At.apply(this,arguments)}function Ot(t){return Ot=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Ot(t)}function Pt(t,e){return Pt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Pt(t,e)}const Rt=function(t){function e(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(t=Mt(this,e,[n])).isWebGLBackend=!0,t}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Pt(t,e)}(e,t),n=e,i=[{key:"init",value:function(t){At(Ot(e.prototype),"init",this).call(this,t);var n=this.parameters,r=void 0!==n.context?n.context:t.domElement.getContext("webgl2");this.gl=r,this.extensions=new st(this),this.capabilities=new ft(this),this.attributeUtils=new L(this),this.textureUtils=new rt(this),this.bufferRenderer=new yt(this),this.state=new V(this),this.utils=new q(this),this.vaoCache={},this.transformFeedbackCache={},this.discard=!1,this.trackTimestamp=!0===n.trackTimestamp,this.extensions.get("EXT_color_buffer_float"),this.disjoint=this.extensions.get("EXT_disjoint_timer_query_webgl2"),this.parallel=this.extensions.get("KHR_parallel_shader_compile"),this._currentContext=null}},{key:"coordinateSystem",get:function(){return r.TdN}},{key:"getArrayBufferAsync",value:(s=wt(_t().mark((function t(e){return _t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.attributeUtils.getArrayBufferAsync(e);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t,this)}))),function(t){return s.apply(this,arguments)})},{key:"initTimestampQuery",value:function(t){if(this.disjoint&&this.trackTimestamp){var e=this.get(t);if(this.queryRunning)return e.queryQueue||(e.queryQueue=[]),void e.queryQueue.push(t);e.activeQuery&&(this.gl.endQuery(this.disjoint.TIME_ELAPSED_EXT),e.activeQuery=null),e.activeQuery=this.gl.createQuery(),null!==e.activeQuery&&(this.gl.beginQuery(this.disjoint.TIME_ELAPSED_EXT,e.activeQuery),this.queryRunning=!0)}}},{key:"prepareTimestampBuffer",value:function(t){if(this.disjoint&&this.trackTimestamp){var e=this.get(t);if(e.activeQuery&&(this.gl.endQuery(this.disjoint.TIME_ELAPSED_EXT),e.gpuQueries||(e.gpuQueries=[]),e.gpuQueries.push({query:e.activeQuery}),e.activeQuery=null,this.queryRunning=!1,e.queryQueue&&e.queryQueue.length>0)){var n=e.queryQueue.shift();this.initTimestampQuery(n)}}}},{key:"resolveTimestampAsync",value:(a=wt(_t().mark((function t(e){var n,r,i,o,a,s,u,c,l=arguments;return _t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=l.length>1&&void 0!==l[1]?l[1]:"render",this.disjoint&&this.trackTimestamp){t.next=3;break}return t.abrupt("return");case 3:for((r=this.get(e)).gpuQueries||(r.gpuQueries=[]),i=0;i<r.gpuQueries.length;i++)o=r.gpuQueries[i],a=this.gl.getQueryParameter(o.query,this.gl.QUERY_RESULT_AVAILABLE),s=this.gl.getParameter(this.disjoint.GPU_DISJOINT_EXT),a&&!s&&(u=this.gl.getQueryParameter(o.query,this.gl.QUERY_RESULT),c=Number(u)/1e6,this.gl.deleteQuery(o.query),r.gpuQueries.splice(i,1),i--,this.renderer.info.updateTimestamp(n,c));case 6:case"end":return t.stop()}}),t,this)}))),function(t){return a.apply(this,arguments)})},{key:"getContext",value:function(){return this.gl}},{key:"beginRender",value:function(t){var e=this.gl,n=this.get(t);if(this.initTimestampQuery(t),n.previousContext=this._currentContext,this._currentContext=t,this._setFramebuffer(t),this.clear(t.clearColor,t.clearDepth,t.clearStencil,t,!1),t.viewport?this.updateViewport(t):e.viewport(0,0,e.drawingBufferWidth,e.drawingBufferHeight),t.scissor){var r=t.scissorValue,i=r.x,o=r.y,a=r.width,s=r.height;e.scissor(i,o,a,s)}var u=t.occlusionQueryCount;u>0&&(n.currentOcclusionQueries=n.occlusionQueries,n.currentOcclusionQueryObjects=n.occlusionQueryObjects,n.lastOcclusionObject=null,n.occlusionQueries=new Array(u),n.occlusionQueryObjects=new Array(u),n.occlusionQueryIndex=0)}},{key:"finishRender",value:function(t){var e=this.gl,n=this.state,r=this.get(t).previousContext,i=t.textures;if(null!==i)for(var o=0;o<i.length;o++){var a=i[o];a.generateMipmaps&&this.generateMipmaps(a)}if(this._currentContext=r,null!==t.textures&&t.renderTarget){var s=this.get(t.renderTarget),u=t.renderTarget.samples,c=s.framebuffer,l=e.COLOR_BUFFER_BIT;if(u>0){var f=s.msaaFrameBuffer,h=t.textures;n.bindFramebuffer(e.READ_FRAMEBUFFER,f),n.bindFramebuffer(e.DRAW_FRAMEBUFFER,c);for(var p=0;p<h.length;p++)e.blitFramebuffer(0,0,t.width,t.height,0,0,t.width,t.height,l,e.NEAREST),e.invalidateFramebuffer(e.READ_FRAMEBUFFER,s.invalidationArray)}}if(null!==r)if(this._setFramebuffer(r),r.viewport)this.updateViewport(r);else{var d=this.gl;d.viewport(0,0,d.drawingBufferWidth,d.drawingBufferHeight)}var m=t.occlusionQueryCount;if(m>0){if(m>this.get(t).occlusionQueryIndex){var y=this.gl;y.endQuery(y.ANY_SAMPLES_PASSED)}this.resolveOccludedAsync(t)}this.prepareTimestampBuffer(t)}},{key:"resolveOccludedAsync",value:function(t){var e=this.get(t),n=e.currentOcclusionQueries,r=e.currentOcclusionQueryObjects;if(n&&r){var i=new WeakSet,o=this.gl;e.currentOcclusionQueryObjects=null,e.currentOcclusionQueries=null,function t(){for(var a=0,s=0;s<n.length;s++){var u=n[s];null!==u&&o.getQueryParameter(u,o.QUERY_RESULT_AVAILABLE)&&(o.getQueryParameter(u,o.QUERY_RESULT)>0&&i.add(r[s]),n[s]=null,o.deleteQuery(u),a++)}a<n.length?requestAnimationFrame(t):e.occluded=i}()}}},{key:"isOccluded",value:function(t,e){var n=this.get(t);return n.occluded&&n.occluded.has(e)}},{key:"updateViewport",value:function(t){var e=this.gl,n=t.viewportValue,r=n.x,i=n.y,o=n.width,a=n.height;e.viewport(r,i,o,a)}},{key:"setScissorTest",value:function(t){var e=this.gl;t?e.enable(e.SCISSOR_TEST):e.disable(e.SCISSOR_TEST)}},{key:"clear",value:function(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,i=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],o=this.gl;null===r&&(r={textures:null,clearColorValue:this.getClearColor()});var a=0;if(t&&(a|=o.COLOR_BUFFER_BIT),e&&(a|=o.DEPTH_BUFFER_BIT),n&&(a|=o.STENCIL_BUFFER_BIT),0!==a){var s=r.clearColorValue||this.getClearColor();if(e&&this.state.setDepthMask(!0),null===r.textures)o.clearColor(s.r,s.g,s.b,s.a),o.clear(a);else{if(i&&this._setFramebuffer(r),t)for(var u=0;u<r.textures.length;u++)o.clearBufferfv(o.COLOR,u,[s.r,s.g,s.b,s.a]);e&&n?o.clearBufferfi(o.DEPTH_STENCIL,0,1,0):e?o.clearBufferfv(o.DEPTH,0,[1]):n&&o.clearBufferiv(o.STENCIL,0,[0])}}}},{key:"beginCompute",value:function(t){var e=this.gl;e.bindFramebuffer(e.FRAMEBUFFER,null),this.initTimestampQuery(t)}},{key:"compute",value:function(t,e,n,r){var i=this.gl;this.discard||(i.enable(i.RASTERIZER_DISCARD),this.discard=!0);var o=this.get(r),a=o.programGPU,s=o.transformBuffers,u=o.attributes,c=this._getVaoKey(null,u),l=this.vaoCache[c];void 0===l?this._createVao(null,u):i.bindVertexArray(l),i.useProgram(a),this._bindUniforms(n);var f=this._getTransformFeedback(s);i.bindTransformFeedback(i.TRANSFORM_FEEDBACK,f),i.beginTransformFeedback(i.POINTS),u[0].isStorageInstancedBufferAttribute?i.drawArraysInstanced(i.POINTS,0,1,e.count):i.drawArrays(i.POINTS,0,e.count),i.endTransformFeedback(),i.bindTransformFeedback(i.TRANSFORM_FEEDBACK,null);for(var h=0;h<s.length;h++){var p=s[h];p.pbo&&this.textureUtils.copyBufferToTexture(p.transformBuffer,p.pbo),p.switchBuffers()}}},{key:"finishCompute",value:function(t){var e=this.gl;this.discard=!1,e.disable(e.RASTERIZER_DISCARD),this.prepareTimestampBuffer(t)}},{key:"draw",value:function(t,e){var n=t.pipeline,r=t.material,i=t.context,o=this.get(n).programGPU,a=this.gl,s=this.state,u=this.get(i);this._bindUniforms(t.getBindings()),s.setMaterial(r),a.useProgram(o);var c=t.staticVao;if(void 0===c){var l=this._getVaoKey(t.getIndex(),t.getAttributes());if(void 0===(c=this.vaoCache[l])){var f=this._createVao(t.getIndex(),t.getAttributes());c=f.vaoGPU,f.staticVao&&(t.staticVao=c)}}a.bindVertexArray(c);var h=t.getIndex(),p=t.object,d=t.geometry,m=d.drawRange,y=m.start,v=u.lastOcclusionObject;if(v!==p&&void 0!==v){if(null!==v&&!0===v.occlusionTest&&(a.endQuery(a.ANY_SAMPLES_PASSED),u.occlusionQueryIndex++),!0===p.occlusionTest){var g=a.createQuery();a.beginQuery(a.ANY_SAMPLES_PASSED,g),u.occlusionQueries[u.occlusionQueryIndex]=g,u.occlusionQueryObjects[u.occlusionQueryIndex]=p}u.lastOcclusionObject=p}var b,_=this.bufferRenderer;if(p.isPoints?_.mode=a.POINTS:p.isLineSegments?_.mode=a.LINES:p.isLine?_.mode=a.LINE_STRIP:p.isLineLoop?_.mode=a.LINE_LOOP:!0===r.wireframe?(s.setLineWidth(r.wireframeLinewidth*this.renderer.getPixelRatio()),_.mode=a.LINES):_.mode=a.TRIANGLES,_.object=p,null!==h){var x=this.get(h),w=m.count!==1/0?m.count:h.count;_.index=h.count,_.type=x.type,b=w}else _.index=0,b=m.count!==1/0?m.count:d.attributes.position.count;var S=this.getInstanceCount(t);p.isBatchedMesh?S>1?(void 0===p._multiDrawInstances&&(p._multiDrawInstances=new Int32Array(p._maxGeometryCount)),p._multiDrawInstances.fill(S),_.renderMultiDrawInstances(p._multiDrawStarts,p._multiDrawCounts,p._multiDrawCount,p._multiDrawInstances)):_.renderMultiDraw(p._multiDrawStarts,p._multiDrawCounts,p._multiDrawCount):S>1?_.renderInstances(y,b,S):_.render(y,b),a.bindVertexArray(null)}},{key:"needsRenderUpdate",value:function(){return!1}},{key:"getRenderCacheKey",value:function(t){return t.id}},{key:"createDefaultTexture",value:function(t){this.textureUtils.createDefaultTexture(t)}},{key:"createTexture",value:function(t,e){this.textureUtils.createTexture(t,e)}},{key:"updateTexture",value:function(t,e){this.textureUtils.updateTexture(t,e)}},{key:"generateMipmaps",value:function(t){this.textureUtils.generateMipmaps(t)}},{key:"destroyTexture",value:function(t){this.textureUtils.destroyTexture(t)}},{key:"copyTextureToBuffer",value:function(t,e,n,r,i){return this.textureUtils.copyTextureToBuffer(t,e,n,r,i)}},{key:"createSampler",value:function(){}},{key:"destroySampler",value:function(){}},{key:"createNodeBuilder",value:function(t,e){return new S(t,e,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}},{key:"createProgram",value:function(t){var e=this.gl,n=t.stage,r=t.code,i="fragment"===n?e.createShader(e.FRAGMENT_SHADER):e.createShader(e.VERTEX_SHADER);e.shaderSource(i,r),e.compileShader(i),this.set(t,{shaderGPU:i})}},{key:"destroyProgram",value:function(){console.warn("Abstract class.")}},{key:"createRenderPipeline",value:function(t,e){var n=this,r=this.gl,i=t.pipeline,o=i.fragmentProgram,a=i.vertexProgram,s=r.createProgram(),u=this.get(o).shaderGPU,c=this.get(a).shaderGPU;if(r.attachShader(s,u),r.attachShader(s,c),r.linkProgram(s),this.set(i,{programGPU:s,fragmentShader:u,vertexShader:c}),null!==e&&this.parallel){var l=new Promise((function(e){var o=n.parallel;!function a(){r.getProgramParameter(s,o.COMPLETION_STATUS_KHR)?(n._completeCompile(t,i),e()):requestAnimationFrame(a)}()}));e.push(l)}else this._completeCompile(t,i)}},{key:"_completeCompile",value:function(t,e){var n=this.gl,r=this.get(e),i=r.programGPU,o=r.fragmentShader,a=r.vertexShader;!1===n.getProgramParameter(i,n.LINK_STATUS)&&(console.error("THREE.WebGLBackend:",n.getProgramInfoLog(i)),console.error("THREE.WebGLBackend:",n.getShaderInfoLog(o)),console.error("THREE.WebGLBackend:",n.getShaderInfoLog(a))),n.useProgram(i),this._setupBindings(t.getBindings(),i),this.set(e,{programGPU:i})}},{key:"createComputePipeline",value:function(t,e){var n=this.gl,r={stage:"fragment",code:"#version 300 es\nprecision highp float;\nvoid main() {}"};this.createProgram(r);for(var i=t.computeProgram,o=n.createProgram(),a=this.get(r).shaderGPU,s=this.get(i).shaderGPU,u=i.transforms,c=[],l=[],f=0;f<u.length;f++){var h=u[f];c.push(h.varyingName),l.push(h.attributeNode)}n.attachShader(o,a),n.attachShader(o,s),n.transformFeedbackVaryings(o,c,n.SEPARATE_ATTRIBS),n.linkProgram(o),!1===n.getProgramParameter(o,n.LINK_STATUS)&&(console.error("THREE.WebGLBackend:",n.getProgramInfoLog(o)),console.error("THREE.WebGLBackend:",n.getShaderInfoLog(a)),console.error("THREE.WebGLBackend:",n.getShaderInfoLog(s))),n.useProgram(o),this.createBindings(e),this._setupBindings(e,o);for(var p=i.attributes,d=[],m=[],y=0;y<p.length;y++){var v=p[y].node.attribute;d.push(v),this.has(v)||this.attributeUtils.createAttribute(v,n.ARRAY_BUFFER)}for(var g=0;g<l.length;g++){var b=l[g].attribute;this.has(b)||this.attributeUtils.createAttribute(b,n.ARRAY_BUFFER);var _=this.get(b);m.push(_)}this.set(t,{programGPU:o,transformBuffers:m,attributes:d})}},{key:"createBindings",value:function(t){this.updateBindings(t)}},{key:"updateBindings",value:function(t){var e,n=this.gl,r=0,i=0,o=gt(t);try{for(o.s();!(e=o.n()).done;){var a=e.value;if(a.isUniformsGroup||a.isUniformBuffer){var s=n.createBuffer(),u=a.buffer;n.bindBuffer(n.UNIFORM_BUFFER,s),n.bufferData(n.UNIFORM_BUFFER,u,n.DYNAMIC_DRAW),n.bindBufferBase(n.UNIFORM_BUFFER,r,s),this.set(a,{index:r++,bufferGPU:s})}else if(a.isSampledTexture){var c=this.get(a.texture),l=c.textureGPU,f=c.glTextureType;this.set(a,{index:i++,textureGPU:l,glTextureType:f})}}}catch(t){o.e(t)}finally{o.f()}}},{key:"updateBinding",value:function(t){var e=this.gl;if(t.isUniformsGroup||t.isUniformBuffer){var n=this.get(t).bufferGPU,r=t.buffer;e.bindBuffer(e.UNIFORM_BUFFER,n),e.bufferData(e.UNIFORM_BUFFER,r,e.DYNAMIC_DRAW)}}},{key:"createIndexAttribute",value:function(t){var e=this.gl;this.attributeUtils.createAttribute(t,e.ELEMENT_ARRAY_BUFFER)}},{key:"createAttribute",value:function(t){if(!this.has(t)){var e=this.gl;this.attributeUtils.createAttribute(t,e.ARRAY_BUFFER)}}},{key:"createStorageAttribute",value:function(t){}},{key:"updateAttribute",value:function(t){this.attributeUtils.updateAttribute(t)}},{key:"destroyAttribute",value:function(t){this.attributeUtils.destroyAttribute(t)}},{key:"updateSize",value:function(){}},{key:"hasFeatureAsync",value:(o=wt(_t().mark((function t(e){return _t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.hasFeature(e));case 1:case"end":return t.stop()}}),t,this)}))),function(t){return o.apply(this,arguments)})},{key:"hasFeature",value:function(t){for(var e=Object.keys(ht).filter((function(e){return ht[e]===t})),n=this.extensions,r=0;r<e.length;r++)if(n.has(e[r]))return!0;return!1}},{key:"getMaxAnisotropy",value:function(){return this.capabilities.getMaxAnisotropy()}},{key:"copyTextureToTexture",value:function(t,e,n,r){this.textureUtils.copyTextureToTexture(t,e,n,r)}},{key:"copyFramebufferToTexture",value:function(t,e){this.textureUtils.copyFramebufferToTexture(t,e)}},{key:"_setFramebuffer",value:function(t){var e=this.gl,n=this.state,r=null;if(null!==t.textures){var i,o=t.renderTarget,a=this.get(o),s=o.samples,u=o.depthBuffer,c=o.stencilBuffer,l=this.renderer._activeCubeFace,f=!0===o.isWebGLCubeRenderTarget,h=a.msaaFrameBuffer,p=a.depthRenderbuffer;if(f?(void 0===a.cubeFramebuffers&&(a.cubeFramebuffers=[]),i=a.cubeFramebuffers[l]):i=a.framebuffer,void 0===i){i=e.createFramebuffer(),n.bindFramebuffer(e.FRAMEBUFFER,i);var d=t.textures;if(f){a.cubeFramebuffers[l]=i;var m=this.get(d[0]).textureGPU;e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_CUBE_MAP_POSITIVE_X+l,m,0)}else{for(var y=0;y<d.length;y++){var v=d[y],g=this.get(v);g.renderTarget=t.renderTarget;var b=e.COLOR_ATTACHMENT0+y;e.framebufferTexture2D(e.FRAMEBUFFER,b,e.TEXTURE_2D,g.textureGPU,0)}a.framebuffer=i,n.drawBuffers(t,i)}if(null!==t.depthTexture){var _=this.get(t.depthTexture),x=c?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT;e.framebufferTexture2D(e.FRAMEBUFFER,x,e.TEXTURE_2D,_.textureGPU,0)}}if(s>0){if(void 0===h){var w=[];h=e.createFramebuffer(),n.bindFramebuffer(e.FRAMEBUFFER,h);for(var S=[],T=t.textures,M=0;M<T.length;M++){if(S[M]=e.createRenderbuffer(),e.bindRenderbuffer(e.RENDERBUFFER,S[M]),w.push(e.COLOR_ATTACHMENT0+M),u){var E=c?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT;w.push(E)}var A=t.textures[M],O=this.get(A);e.renderbufferStorageMultisample(e.RENDERBUFFER,s,O.glInternalFormat,t.width,t.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+M,e.RENDERBUFFER,S[M])}if(a.msaaFrameBuffer=h,a.msaaRenderbuffers=S,void 0===p){p=e.createRenderbuffer(),this.textureUtils.setupRenderBufferStorage(p,t),a.depthRenderbuffer=p;var P=c?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT;w.push(P)}a.invalidationArray=w}r=a.msaaFrameBuffer}else r=i}n.bindFramebuffer(e.FRAMEBUFFER,r)}},{key:"_getVaoKey",value:function(t,e){var n=[];null!==t&&(n+=":"+this.get(t).id);for(var r=0;r<e.length;r++)n+=":"+this.get(e[r]).id;return n}},{key:"_createVao",value:function(t,e){var n=this.gl,r=n.createVertexArray(),i="",o=!0;if(n.bindVertexArray(r),null!==t){var a=this.get(t);n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,a.bufferGPU),i+=":"+a.id}for(var s=0;s<e.length;s++){var u=e[s],c=this.get(u);i+=":"+c.id,n.bindBuffer(n.ARRAY_BUFFER,c.bufferGPU),n.enableVertexAttribArray(s),(u.isStorageBufferAttribute||u.isStorageInstancedBufferAttribute)&&(o=!1);var l=void 0,f=void 0;!0===u.isInterleavedBufferAttribute?(l=u.data.stride*c.bytesPerElement,f=u.offset*c.bytesPerElement):(l=0,f=0),c.isInteger?n.vertexAttribIPointer(s,u.itemSize,c.type,l,f):n.vertexAttribPointer(s,u.itemSize,c.type,u.normalized,l,f),u.isInstancedBufferAttribute&&!u.isInterleavedBufferAttribute?n.vertexAttribDivisor(s,u.meshPerAttribute):u.isInterleavedBufferAttribute&&u.data.isInstancedInterleavedBuffer&&n.vertexAttribDivisor(s,u.data.meshPerAttribute)}return n.bindBuffer(n.ARRAY_BUFFER,null),this.vaoCache[i]=r,{vaoGPU:r,staticVao:o}}},{key:"_getTransformFeedback",value:function(t){for(var e="",n=0;n<t.length;n++)e+=":"+t[n].id;var r=this.transformFeedbackCache[e];if(void 0!==r)return r;var i=this.gl;r=i.createTransformFeedback(),i.bindTransformFeedback(i.TRANSFORM_FEEDBACK,r);for(var o=0;o<t.length;o++){var a=t[o];i.bindBufferBase(i.TRANSFORM_FEEDBACK_BUFFER,o,a.transformBuffer)}return i.bindTransformFeedback(i.TRANSFORM_FEEDBACK,null),this.transformFeedbackCache[e]=r,r}},{key:"_setupBindings",value:function(t,e){var n,r=this.gl,i=gt(t);try{for(i.s();!(n=i.n()).done;){var o=n.value,a=this.get(o).index;if(o.isUniformsGroup||o.isUniformBuffer){var s=r.getUniformBlockIndex(e,o.name);r.uniformBlockBinding(e,s,a)}else if(o.isSampledTexture){var u=r.getUniformLocation(e,o.name);r.uniform1i(u,a)}}}catch(t){i.e(t)}finally{i.f()}}},{key:"_bindUniforms",value:function(t){var e,n=this.gl,r=this.state,i=gt(t);try{for(i.s();!(e=i.n()).done;){var o=e.value,a=this.get(o),s=a.index;o.isUniformsGroup||o.isUniformBuffer?n.bindBufferBase(n.UNIFORM_BUFFER,s,a.bufferGPU):o.isSampledTexture&&r.bindTexture(a.glTextureType,a.textureGPU,n.TEXTURE0+s)}}catch(t){i.e(t)}finally{i.f()}}}],i&&St(n.prototype,i),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,i,o,a,s}(T.A)},6548:(t,e,n)=>{n.a(t,(async(t,r)=>{try{n.d(e,{A:()=>L});var i=n(554),o=n(1367),a=n(7623),s=n(6945),u=n(1879),c=n(697),l=n(2246),f=n(3765),h=n(7047),p=n(4323),d=t([p]);function m(t){return m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},m(t)}function y(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=v(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function v(t,e){if(t){if("string"==typeof t)return g(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?g(t,e):void 0}}function g(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function b(){b=function(){return e};var t,e={},n=Object.prototype,r=n.hasOwnProperty,i=Object.defineProperty||function(t,e,n){t[e]=n.value},o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",s=o.asyncIterator||"@@asyncIterator",u=o.toStringTag||"@@toStringTag";function c(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{c({},"")}catch(t){c=function(t,e,n){return t[e]=n}}function l(t,e,n,r){var o=e&&e.prototype instanceof g?e:g,a=Object.create(o.prototype),s=new C(r||[]);return i(a,"_invoke",{value:O(t,n,s)}),a}function f(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var h="suspendedStart",p="suspendedYield",d="executing",y="completed",v={};function g(){}function _(){}function x(){}var w={};c(w,a,(function(){return this}));var S=Object.getPrototypeOf,T=S&&S(S(N([])));T&&T!==n&&r.call(T,a)&&(w=T);var M=x.prototype=g.prototype=Object.create(w);function E(t){["next","throw","return"].forEach((function(e){c(t,e,(function(t){return this._invoke(e,t)}))}))}function A(t,e){function n(i,o,a,s){var u=f(t[i],t,o);if("throw"!==u.type){var c=u.arg,l=c.value;return l&&"object"==m(l)&&r.call(l,"__await")?e.resolve(l.__await).then((function(t){n("next",t,a,s)}),(function(t){n("throw",t,a,s)})):e.resolve(l).then((function(t){c.value=t,a(c)}),(function(t){return n("throw",t,a,s)}))}s(u.arg)}var o;i(this,"_invoke",{value:function(t,r){function i(){return new e((function(e,i){n(t,r,e,i)}))}return o=o?o.then(i,i):i()}})}function O(e,n,r){var i=h;return function(o,a){if(i===d)throw Error("Generator is already running");if(i===y){if("throw"===o)throw a;return{value:t,done:!0}}for(r.method=o,r.arg=a;;){var s=r.delegate;if(s){var u=P(s,r);if(u){if(u===v)continue;return u}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(i===h)throw i=y,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);i=d;var c=f(e,n,r);if("normal"===c.type){if(i=r.done?y:p,c.arg===v)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(i=y,r.method="throw",r.arg=c.arg)}}}function P(e,n){var r=n.method,i=e.iterator[r];if(i===t)return n.delegate=null,"throw"===r&&e.iterator.return&&(n.method="return",n.arg=t,P(e,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),v;var o=f(i,e.iterator,n.arg);if("throw"===o.type)return n.method="throw",n.arg=o.arg,n.delegate=null,v;var a=o.arg;return a?a.done?(n[e.resultName]=a.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,v):a:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,v)}function R(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function k(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function C(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(R,this),this.reset(!0)}function N(e){if(e||""===e){var n=e[a];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,o=function n(){for(;++i<e.length;)if(r.call(e,i))return n.value=e[i],n.done=!1,n;return n.value=t,n.done=!0,n};return o.next=o}}throw new TypeError(m(e)+" is not iterable")}return _.prototype=x,i(M,"constructor",{value:x,configurable:!0}),i(x,"constructor",{value:_,configurable:!0}),_.displayName=c(x,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===_||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,x):(t.__proto__=x,c(t,u,"GeneratorFunction")),t.prototype=Object.create(M),t},e.awrap=function(t){return{__await:t}},E(A.prototype),c(A.prototype,s,(function(){return this})),e.AsyncIterator=A,e.async=function(t,n,r,i,o){void 0===o&&(o=Promise);var a=new A(l(t,n,r,i),o);return e.isGeneratorFunction(n)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},E(M),c(M,u,"Generator"),c(M,a,(function(){return this})),c(M,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),n=[];for(var r in e)n.push(r);return n.reverse(),function t(){for(;n.length;){var r=n.pop();if(r in e)return t.value=r,t.done=!1,t}return t.done=!0,t}},e.values=N,C.prototype={constructor:C,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(k),!e)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function i(r,i){return s.type="throw",s.arg=e,n.next=r,i&&(n.method="next",n.arg=t),!!i}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],s=a.completion;if("root"===a.tryLoc)return i("end");if(a.tryLoc<=this.prev){var u=r.call(a,"catchLoc"),c=r.call(a,"finallyLoc");if(u&&c){if(this.prev<a.catchLoc)return i(a.catchLoc,!0);if(this.prev<a.finallyLoc)return i(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return i(a.catchLoc,!0)}else{if(!c)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return i(a.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=t,a.arg=e,o?(this.method="next",this.next=o.finallyLoc,v):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),k(n),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var i=r.arg;k(n)}return i}}throw Error("illegal catch attempt")},delegateYield:function(e,n,r){return this.delegate={iterator:N(e),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=t),v}},e}function _(t,e,n,r,i,o,a){try{var s=t[o](a),u=s.value}catch(t){return void n(t)}s.done?e(u):Promise.resolve(u).then(r,i)}function x(t){return function(){var e=this,n=arguments;return new Promise((function(r,i){var o=t.apply(e,n);function a(t){_(o,r,i,a,s,"next",t)}function s(t){_(o,r,i,a,s,"throw",t)}a(void 0)}))}}function w(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function S(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,T(r.key),r)}}function T(t){var e=M(t,"string");return"symbol"==m(e)?e:e+""}function M(t,e){if("object"!=m(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e||"default");if("object"!=m(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}function E(t,e){if(e&&("object"===m(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return A(t)}function A(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function O(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(O=function(){return!!t})()}function P(){return P="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var r=R(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(arguments.length<3?t:n):i.value}},P.apply(this,arguments)}function R(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=k(t)););return t}function k(t){return k=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},k(t)}function C(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&N(t,e)}function N(t,e){return N=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},N(t,e)}p=(d.then?(await d)():d)[0];const L=function(t){function e(){var t,n,r,i,o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return w(this,e),n=this,i=[o],r=k(r=e),(t=E(n,O()?Reflect.construct(r,i||[],k(n).constructor):r.apply(n,i))).isWebGPUBackend=!0,t.parameters.alpha=void 0===o.alpha||o.alpha,t.parameters.antialias=!0===o.antialias,!0===t.parameters.antialias?t.parameters.sampleCount=void 0===o.sampleCount?4:o.sampleCount:t.parameters.sampleCount=1,t.parameters.requiredLimits=void 0===o.requiredLimits?{}:o.requiredLimits,t.trackTimestamp=!0===o.trackTimestamp,t.adapter=null,t.device=null,t.context=null,t.colorBuffer=null,t.defaultRenderPassdescriptor=null,t.utils=new u.A(t),t.attributeUtils=new c.A(t),t.bindingUtils=new l.A(t),t.pipelineUtils=new f.A(t),t.textureUtils=new h.A(t),t.occludedResolveCache=new Map,t}return C(e,t),n=e,r=[{key:"init",value:(g=x(b().mark((function t(n){var r,i,a,s,u,c,l,f,h,p,d,m;return b().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,P(k(e.prototype),"init",this).call(this,n);case 2:return r=this.parameters,i={powerPreference:r.powerPreference},t.next=6,navigator.gpu.requestAdapter(i);case 6:if(null!==(a=t.sent)){t.next=9;break}throw new Error("WebGPUBackend: Unable to create WebGPU adapter.");case 9:for(s=Object.values(o.oc),u=[],c=0,l=s;c<l.length;c++)f=l[c],a.features.has(f)&&u.push(f);return h={requiredFeatures:u,requiredLimits:r.requiredLimits},t.next=15,a.requestDevice(h);case 15:p=t.sent,d=void 0!==r.context?r.context:n.domElement.getContext("webgpu"),this.adapter=a,this.device=p,this.context=d,m=r.alpha?"premultiplied":"opaque",this.context.configure({device:this.device,format:o.LG.BGRA8Unorm,usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_SRC,alphaMode:m}),this.updateSize();case 23:case"end":return t.stop()}}),t,this)}))),function(t){return g.apply(this,arguments)})},{key:"coordinateSystem",get:function(){return i.i7u}},{key:"getArrayBufferAsync",value:(v=x(b().mark((function t(e){return b().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.attributeUtils.getArrayBufferAsync(e);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t,this)}))),function(t){return v.apply(this,arguments)})},{key:"getContext",value:function(){return this.context}},{key:"_getDefaultRenderPassDescriptor",value:function(){var t=this.defaultRenderPassdescriptor,e=this.parameters.antialias;if(null===t){var n=this.renderer,r=(t={colorAttachments:[{view:null}],depthStencilAttachment:{view:this.textureUtils.getDepthBuffer(n.depth,n.stencil).createView()}}).colorAttachments[0];!0===e?r.view=this.colorBuffer.createView():r.resolveTarget=void 0,this.defaultRenderPassdescriptor=t}var i=t.colorAttachments[0];return!0===e?i.resolveTarget=this.context.getCurrentTexture().createView():i.view=this.context.getCurrentTexture().createView(),t}},{key:"_getRenderPassDescriptor",value:function(t){var e=t.renderTarget,n=this.get(e),r=n.descriptors;void 0===r&&(r=[],n.descriptors=r),n.width===e.width&&n.height===e.height&&n.activeMipmapLevel===e.activeMipmapLevel&&n.samples===e.samples||(r.length=0);var i=r[t.activeCubeFace];if(void 0===i){for(var a=t.textures,s=[],u=0;u<a.length;u++){var c=this.get(a[u]),l=c.texture.createView({baseMipLevel:t.activeMipmapLevel,mipLevelCount:1,baseArrayLayer:t.activeCubeFace,dimension:o.D2.TwoD}),f=void 0,h=void 0;void 0!==c.msaaTexture?(f=c.msaaTexture.createView(),h=l):(f=l,h=void 0),s.push({view:f,resolveTarget:h,loadOp:o.mP.Load,storeOp:o.pY.Store})}i={colorAttachments:s,depthStencilAttachment:{view:this.get(t.depthTexture).texture.createView()}},r[t.activeCubeFace]=i,n.width=e.width,n.height=e.height,n.samples=e.samples,n.activeMipmapLevel=e.activeMipmapLevel}return i}},{key:"beginRender",value:function(t){var e,n,r=this.get(t),i=this.device,a=t.occlusionQueryCount;a>0&&(r.currentOcclusionQuerySet&&r.currentOcclusionQuerySet.destroy(),r.currentOcclusionQueryBuffer&&r.currentOcclusionQueryBuffer.destroy(),r.currentOcclusionQuerySet=r.occlusionQuerySet,r.currentOcclusionQueryBuffer=r.occlusionQueryBuffer,r.currentOcclusionQueryObjects=r.occlusionQueryObjects,e=i.createQuerySet({type:"occlusion",count:a}),r.occlusionQuerySet=e,r.occlusionQueryIndex=0,r.occlusionQueryObjects=new Array(a),r.lastOcclusionObject=null),n=null===t.textures?this._getDefaultRenderPassDescriptor():this._getRenderPassDescriptor(t),this.initTimestampQuery(t,n),n.occlusionQuerySet=e;var s=n.depthStencilAttachment;if(null!==t.textures)for(var u=n.colorAttachments,c=0;c<u.length;c++){var l=u[c];t.clearColor?(l.clearValue=t.clearColorValue,l.loadOp=o.mP.Clear,l.storeOp=o.pY.Store):(l.loadOp=o.mP.Load,l.storeOp=o.pY.Store)}else{var f=n.colorAttachments[0];t.clearColor?(f.clearValue=t.clearColorValue,f.loadOp=o.mP.Clear,f.storeOp=o.pY.Store):(f.loadOp=o.mP.Load,f.storeOp=o.pY.Store)}t.depth&&(t.clearDepth?(s.depthClearValue=t.clearDepthValue,s.depthLoadOp=o.mP.Clear,s.depthStoreOp=o.pY.Store):(s.depthLoadOp=o.mP.Load,s.depthStoreOp=o.pY.Store)),t.stencil&&(t.clearStencil?(s.stencilClearValue=t.clearStencilValue,s.stencilLoadOp=o.mP.Clear,s.stencilStoreOp=o.pY.Store):(s.stencilLoadOp=o.mP.Load,s.stencilStoreOp=o.pY.Store));var h=i.createCommandEncoder({label:"renderContext_"+t.id}),p=h.beginRenderPass(n);if(r.descriptor=n,r.encoder=h,r.currentPass=p,r.currentSets={attributes:{}},t.viewport&&this.updateViewport(t),t.scissor){var d=t.scissorValue,m=d.x,y=d.y,v=d.width,g=d.height;p.setScissorRect(m,t.height-g-y,v,g)}}},{key:"finishRender",value:function(t){var e=this.get(t),n=t.occlusionQueryCount;if(n>e.occlusionQueryIndex&&e.currentPass.endOcclusionQuery(),e.currentPass.end(),n>0){var r=8*n,i=this.occludedResolveCache.get(r);void 0===i&&(i=this.device.createBuffer({size:r,usage:GPUBufferUsage.QUERY_RESOLVE|GPUBufferUsage.COPY_SRC}),this.occludedResolveCache.set(r,i));var o=this.device.createBuffer({size:r,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ});e.encoder.resolveQuerySet(e.occlusionQuerySet,0,n,i,0),e.encoder.copyBufferToBuffer(i,0,o,0,r),e.occlusionQueryBuffer=o,this.resolveOccludedAsync(t)}if(this.prepareTimestampBuffer(t,e.encoder),this.device.queue.submit([e.encoder.finish()]),null!==t.textures)for(var a=t.textures,s=0;s<a.length;s++){var u=a[s];!0===u.generateMipmaps&&this.textureUtils.generateMipmaps(u)}}},{key:"isOccluded",value:function(t,e){var n=this.get(t);return n.occluded&&n.occluded.has(e)}},{key:"resolveOccludedAsync",value:(m=x(b().mark((function t(e){var n,r,i,o,a,s,u;return b().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=this.get(e),r=n.currentOcclusionQueryBuffer,i=n.currentOcclusionQueryObjects,!r||!i){t.next=13;break}return o=new WeakSet,n.currentOcclusionQueryObjects=null,n.currentOcclusionQueryBuffer=null,t.next=8,r.mapAsync(GPUMapMode.READ);case 8:for(a=r.getMappedRange(),s=new BigUint64Array(a),u=0;u<i.length;u++)0n!==s[u]&&o.add(i[u]);r.destroy(),n.occluded=o;case 13:case"end":return t.stop()}}),t,this)}))),function(t){return m.apply(this,arguments)})},{key:"updateViewport",value:function(t){var e=this.get(t).currentPass,n=t.viewportValue,r=n.x,i=n.y,o=n.width,a=n.height,s=n.minDepth,u=n.maxDepth;e.setViewport(r,t.height-a-i,o,a,s,u)}},{key:"clear",value:function(t,e,n){var r,i,a,s,u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,c=this.device,l=this.renderer,f=[];if(t){var h=this.getClearColor();i={r:h.r,g:h.g,b:h.b,a:h.a}}if(null===u){a=l.depth,s=l.stencil;var p=this._getDefaultRenderPassDescriptor();if(t){var d=(f=p.colorAttachments)[0];d.clearValue=i,d.loadOp=o.mP.Clear,d.storeOp=o.pY.Store}(a||s)&&(r=p.depthStencilAttachment)}else{if(a=u.depth,s=u.stencil,t){var m,v=y(u.textures);try{for(v.s();!(m=v.n()).done;){var g=m.value,b=this.get(g),_=b.texture.createView(),x=void 0,w=void 0;void 0!==b.msaaTexture?(x=b.msaaTexture.createView(),w=_):(x=_,w=void 0),f.push({view:x,resolveTarget:w,clearValue:i,loadOp:o.mP.Clear,storeOp:o.pY.Store})}}catch(t){v.e(t)}finally{v.f()}}(a||s)&&(r={view:this.get(u.depthTexture).texture.createView()})}a&&(e?(r.depthLoadOp=o.mP.Clear,r.depthClearValue=l.getClearDepth(),r.depthStoreOp=o.pY.Store):(r.depthLoadOp=o.mP.Load,r.depthStoreOp=o.pY.Store)),s&&(n?(r.stencilLoadOp=o.mP.Clear,r.stencilClearValue=l.getClearStencil(),r.stencilStoreOp=o.pY.Store):(r.stencilLoadOp=o.mP.Load,r.stencilStoreOp=o.pY.Store));var S=c.createCommandEncoder({});S.beginRenderPass({colorAttachments:f,depthStencilAttachment:r}).end(),c.queue.submit([S.finish()])}},{key:"beginCompute",value:function(t){var e=this.get(t),n={};this.initTimestampQuery(t,n),e.cmdEncoderGPU=this.device.createCommandEncoder(),e.passEncoderGPU=e.cmdEncoderGPU.beginComputePass(n)}},{key:"compute",value:function(t,e,n,r){var i=this.get(t).passEncoderGPU,o=this.get(r).pipeline;i.setPipeline(o);var a=this.get(n).group;i.setBindGroup(0,a),i.dispatchWorkgroups(e.dispatchCount)}},{key:"finishCompute",value:function(t){var e=this.get(t);e.passEncoderGPU.end(),this.prepareTimestampBuffer(t,e.cmdEncoderGPU),this.device.queue.submit([e.cmdEncoderGPU.finish()])}},{key:"draw",value:function(t,e){var n=t.object,r=t.geometry,i=t.context,a=t.pipeline,s=this.get(t.getBindings()),u=this.get(i),c=this.get(a).pipeline,l=u.currentSets,f=u.currentPass;l.pipeline!==c&&(f.setPipeline(c),l.pipeline=c);var h=s.group;f.setBindGroup(0,h);var p=t.getIndex(),d=null!==p;if(!0===d&&l.index!==p){var m=this.get(p).buffer,y=p.array instanceof Uint16Array?o.m4.Uint16:o.m4.Uint32;f.setIndexBuffer(m,y),l.index=p}for(var v=t.getVertexBuffers(),g=0,b=v.length;g<b;g++){var _=v[g];if(l.attributes[g]!==_){var x=this.get(_).buffer;f.setVertexBuffer(g,x),l.attributes[g]=_}}if(void 0!==u.occlusionQuerySet){var w=u.lastOcclusionObject;w!==n&&(null!==w&&!0===w.occlusionTest&&(f.endOcclusionQuery(),u.occlusionQueryIndex++),!0===n.occlusionTest&&(f.beginOcclusionQuery(u.occlusionQueryIndex),u.occlusionQueryObjects[u.occlusionQueryIndex]=n),u.lastOcclusionObject=n)}var S=r.drawRange,T=S.start,M=this.getInstanceCount(t);if(0!==M)if(!0===d){var E=S.count!==1/0?S.count:p.count;f.drawIndexed(E,M,T,0,0),e.update(n,E,M)}else{var A=r.attributes.position,O=S.count!==1/0?S.count:A.count;f.draw(O,M,T,0),e.update(n,O,M)}}},{key:"needsRenderUpdate",value:function(t){var e=this.get(t),n=t.object,r=t.material,i=this.utils,o=i.getSampleCount(t.context),a=i.getCurrentColorSpace(t.context),s=i.getCurrentColorFormat(t.context),u=i.getCurrentDepthStencilFormat(t.context),c=i.getPrimitiveTopology(n,r),l=!1;return e.material===r&&e.materialVersion===r.version&&e.transparent===r.transparent&&e.blending===r.blending&&e.premultipliedAlpha===r.premultipliedAlpha&&e.blendSrc===r.blendSrc&&e.blendDst===r.blendDst&&e.blendEquation===r.blendEquation&&e.blendSrcAlpha===r.blendSrcAlpha&&e.blendDstAlpha===r.blendDstAlpha&&e.blendEquationAlpha===r.blendEquationAlpha&&e.colorWrite===r.colorWrite&&e.depthWrite===r.depthWrite&&e.depthTest===r.depthTest&&e.depthFunc===r.depthFunc&&e.stencilWrite===r.stencilWrite&&e.stencilFunc===r.stencilFunc&&e.stencilFail===r.stencilFail&&e.stencilZFail===r.stencilZFail&&e.stencilZPass===r.stencilZPass&&e.stencilFuncMask===r.stencilFuncMask&&e.stencilWriteMask===r.stencilWriteMask&&e.side===r.side&&e.alphaToCoverage===r.alphaToCoverage&&e.sampleCount===o&&e.colorSpace===a&&e.colorFormat===s&&e.depthStencilFormat===u&&e.primitiveTopology===c&&e.clippingContextVersion===t.clippingContextVersion||(e.material=r,e.materialVersion=r.version,e.transparent=r.transparent,e.blending=r.blending,e.premultipliedAlpha=r.premultipliedAlpha,e.blendSrc=r.blendSrc,e.blendDst=r.blendDst,e.blendEquation=r.blendEquation,e.blendSrcAlpha=r.blendSrcAlpha,e.blendDstAlpha=r.blendDstAlpha,e.blendEquationAlpha=r.blendEquationAlpha,e.colorWrite=r.colorWrite,e.depthWrite=r.depthWrite,e.depthTest=r.depthTest,e.depthFunc=r.depthFunc,e.stencilWrite=r.stencilWrite,e.stencilFunc=r.stencilFunc,e.stencilFail=r.stencilFail,e.stencilZFail=r.stencilZFail,e.stencilZPass=r.stencilZPass,e.stencilFuncMask=r.stencilFuncMask,e.stencilWriteMask=r.stencilWriteMask,e.side=r.side,e.alphaToCoverage=r.alphaToCoverage,e.sampleCount=o,e.colorSpace=a,e.colorFormat=s,e.depthStencilFormat=u,e.primitiveTopology=c,e.clippingContextVersion=t.clippingContextVersion,l=!0),l}},{key:"getRenderCacheKey",value:function(t){var e=t.object,n=t.material,r=this.utils,i=t.context;return[n.transparent,n.blending,n.premultipliedAlpha,n.blendSrc,n.blendDst,n.blendEquation,n.blendSrcAlpha,n.blendDstAlpha,n.blendEquationAlpha,n.colorWrite,n.depthWrite,n.depthTest,n.depthFunc,n.stencilWrite,n.stencilFunc,n.stencilFail,n.stencilZFail,n.stencilZPass,n.stencilFuncMask,n.stencilWriteMask,n.side,r.getSampleCount(i),r.getCurrentColorSpace(i),r.getCurrentColorFormat(i),r.getCurrentDepthStencilFormat(i),r.getPrimitiveTopology(e,n),t.clippingContextVersion].join()}},{key:"createSampler",value:function(t){this.textureUtils.createSampler(t)}},{key:"destroySampler",value:function(t){this.textureUtils.destroySampler(t)}},{key:"createDefaultTexture",value:function(t){this.textureUtils.createDefaultTexture(t)}},{key:"createTexture",value:function(t,e){this.textureUtils.createTexture(t,e)}},{key:"updateTexture",value:function(t,e){this.textureUtils.updateTexture(t,e)}},{key:"generateMipmaps",value:function(t){this.textureUtils.generateMipmaps(t)}},{key:"destroyTexture",value:function(t){this.textureUtils.destroyTexture(t)}},{key:"copyTextureToBuffer",value:function(t,e,n,r,i){return this.textureUtils.copyTextureToBuffer(t,e,n,r,i)}},{key:"initTimestampQuery",value:function(t,e){if(this.hasFeature(o.oc.TimestampQuery)&&this.trackTimestamp){var n=this.get(t);if(!n.timeStampQuerySet){var r=this.device.createQuerySet({type:"timestamp",count:2}),i={querySet:r,beginningOfPassWriteIndex:0,endOfPassWriteIndex:1};Object.assign(e,{timestampWrites:i}),n.timeStampQuerySet=r}}}},{key:"prepareTimestampBuffer",value:function(t,e){if(this.hasFeature(o.oc.TimestampQuery)&&this.trackTimestamp){var n=this.get(t),r=2*BigInt64Array.BYTES_PER_ELEMENT,i=this.device.createBuffer({size:r,usage:GPUBufferUsage.QUERY_RESOLVE|GPUBufferUsage.COPY_SRC}),a=this.device.createBuffer({size:r,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ});e.resolveQuerySet(n.timeStampQuerySet,0,2,i,0),e.copyBufferToBuffer(i,0,a,0,r),n.currentTimestampQueryBuffer=a}}},{key:"resolveTimestampAsync",value:(d=x(b().mark((function t(e){var n,r,i,a,s,u,c=arguments;return b().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=c.length>1&&void 0!==c[1]?c[1]:"render",this.hasFeature(o.oc.TimestampQuery)&&this.trackTimestamp){t.next=3;break}return t.abrupt("return");case 3:if(r=this.get(e),void 0!==(i=r.currentTimestampQueryBuffer)){t.next=7;break}return t.abrupt("return");case 7:return a=i,t.prev=8,t.next=11,a.mapAsync(GPUMapMode.READ);case 11:s=new BigUint64Array(a.getMappedRange()),u=Number(s[1]-s[0])/1e6,this.renderer.info.updateTimestamp(n,u),t.next=19;break;case 16:t.prev=16,t.t0=t.catch(8),console.error("Error mapping buffer: ".concat(t.t0));case 19:return t.prev=19,a.unmap(),t.finish(19);case 22:case"end":return t.stop()}}),t,this,[[8,16,19,22]])}))),function(t){return d.apply(this,arguments)})},{key:"createNodeBuilder",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return new a.A(t,e,n)}},{key:"createProgram",value:function(t){this.get(t).module={module:this.device.createShaderModule({code:t.code,label:t.stage}),entryPoint:"main"}}},{key:"destroyProgram",value:function(t){this.delete(t)}},{key:"createRenderPipeline",value:function(t,e){this.pipelineUtils.createRenderPipeline(t,e)}},{key:"createComputePipeline",value:function(t,e){this.pipelineUtils.createComputePipeline(t,e)}},{key:"createBindings",value:function(t){this.bindingUtils.createBindings(t)}},{key:"updateBindings",value:function(t){this.bindingUtils.createBindings(t)}},{key:"updateBinding",value:function(t){this.bindingUtils.updateBinding(t)}},{key:"createIndexAttribute",value:function(t){this.attributeUtils.createAttribute(t,GPUBufferUsage.INDEX|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST)}},{key:"createAttribute",value:function(t){this.attributeUtils.createAttribute(t,GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST)}},{key:"createStorageAttribute",value:function(t){this.attributeUtils.createAttribute(t,GPUBufferUsage.STORAGE|GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST)}},{key:"updateAttribute",value:function(t){this.attributeUtils.updateAttribute(t)}},{key:"destroyAttribute",value:function(t){this.attributeUtils.destroyAttribute(t)}},{key:"updateSize",value:function(){this.colorBuffer=this.textureUtils.getColorBuffer(),this.defaultRenderPassdescriptor=null}},{key:"getMaxAnisotropy",value:function(){return 16}},{key:"hasFeatureAsync",value:(s=x(b().mark((function t(e){var n;return b().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.t0=this.adapter,t.t0){t.next=5;break}return t.next=4,p.A.getStaticAdapter();case 4:t.t0=t.sent;case 5:return n=t.t0,t.abrupt("return",n.features.has(e));case 7:case"end":return t.stop()}}),t,this)}))),function(t){return s.apply(this,arguments)})},{key:"hasFeature",value:function(t){return this.adapter?this.adapter.features.has(t):(console.warn("WebGPUBackend: WebGPU adapter has not been initialized yet. Please use hasFeatureAsync instead"),!1)}},{key:"copyTextureToTexture",value:function(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=this.device.createCommandEncoder({label:"copyTextureToTexture_"+e.id+"_"+n.id}),o=this.get(e).texture,a=this.get(n).texture;i.copyTextureToTexture({texture:o,mipLevel:r,origin:{x:0,y:0,z:0}},{texture:a,mipLevel:r,origin:{x:t.x,y:t.y,z:t.z}},[e.image.width,e.image.height]),this.device.queue.submit([i.finish()])}},{key:"copyFramebufferToTexture",value:function(t,e){var n,r=this.get(e),i=r.encoder,a=r.descriptor;n=e.renderTarget?t.isDepthTexture?this.get(e.depthTexture).texture:this.get(e.textures[0]).texture:t.isDepthTexture?this.textureUtils.getDepthBuffer(e.depth,e.stencil):this.context.getCurrentTexture();var s=this.get(t).texture;n.format===s.format?(r.currentPass.end(),i.copyTextureToTexture({texture:n,origin:{x:0,y:0,z:0}},{texture:s},[t.image.width,t.image.height]),t.generateMipmaps&&this.textureUtils.generateMipmaps(t),a.colorAttachments[0].loadOp=o.mP.Load,e.depth&&(a.depthStencilAttachment.depthLoadOp=o.mP.Load),e.stencil&&(a.depthStencilAttachment.stencilLoadOp=o.mP.Load),r.currentPass=i.beginRenderPass(a),r.currentSets={attributes:{}}):console.error("WebGPUBackend: copyFramebufferToTexture: Source and destination formats do not match.",n.format,s.format)}}],r&&S(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r,s,d,m,v,g}(s.A);r()}catch(j){r(j)}}))},6137:(t,e,n)=>{n.a(t,(async(t,r)=>{try{n.r(e),n.d(e,{default:()=>v});var i=n(4323),o=n(9042),a=n(8124),s=n(6548),u=t([i,s]);function c(t){return c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},c(t)}function l(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function f(t,e){if(e&&("object"===c(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return h(t)}function h(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function p(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(p=function(){return!!t})()}function d(t){return d=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},d(t)}function m(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&y(t,e)}function y(t,e){return y=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},y(t,e)}[i,s]=u.then?(await u)():u;const v=function(t){function e(){var t,n,r,o,u,c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return l(this,e),c.forceWebGL?n=a.A:i.A.isAvailable()?n=s.A:(n=a.A,console.warn("THREE.WebGPURenderer: WebGPU is not available, running under WebGL2 backend.")),r=this,u=[new n(c),c],o=d(o=e),(t=f(r,p()?Reflect.construct(o,u||[],d(r).constructor):o.apply(r,u))).isWebGPURenderer=!0,t}return m(e,t),n=e,Object.defineProperty(n,"prototype",{writable:!1}),n;var n}(o.A);r()}catch(g){r(g)}}))},7623:(t,e,n)=>{n.d(e,{A:()=>_t});var r=n(554),i=n(4804);function o(t){return o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},o(t)}function a(t,e,n){return e=u(e),function(t,e){if(e&&("object"===o(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,s()?Reflect.construct(e,n||[],u(t).constructor):e.apply(t,n))}function s(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(s=function(){return!!t})()}function u(t){return u=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},u(t)}function c(t,e){return c=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},c(t,e)}function l(t){return l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},l(t)}function f(t,e,n){return e=p(e),function(t,e){if(e&&("object"===l(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,h()?Reflect.construct(e,n||[],p(t).constructor):e.apply(t,n))}function h(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(h=function(){return!!t})()}function p(t){return p=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},p(t)}function d(t,e){return d=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},d(t,e)}const m=function(t){function e(t,n){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(r=f(this,e,[t,n?n.value:null])).textureNode=n,r}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&d(t,e)}(e,t),n=e,Object.defineProperty(n,"prototype",{writable:!1}),n;var n}(function(t){function e(t,n){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(r=a(this,e,[t])).texture=n,r.version=n?n.version:0,r.isSampler=!0,r}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&c(t,e)}(e,t),n=e,Object.defineProperty(n,"prototype",{writable:!1}),n;var n}(n(6068).A));var y=n(7006),v=n(8233);function g(t){return g="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},g(t)}function b(t,e,n){return e=x(e),function(t,e){if(e&&("object"===g(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,_()?Reflect.construct(e,n||[],x(t).constructor):e.apply(t,n))}function _(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(_=function(){return!!t})()}function x(t){return x=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},x(t)}function w(t,e){return w=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},w(t,e)}var S=function(t){function e(t,n){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(r=b(this,e,[t,n?n.array:null])).attribute=n,r.isStorageBuffer=!0,r}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&w(t,e)}(e,t),n=e,Object.defineProperty(n,"prototype",{writable:!1}),n;var n}(n(2718).A);function T(t){return T="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},T(t)}function M(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,E(r.key),r)}}function E(t){var e=function(t,e){if("object"!=T(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=T(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==T(e)?e:e+""}function A(t,e,n){return e=P(e),function(t,e){if(e&&("object"===T(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,O()?Reflect.construct(e,n||[],P(t).constructor):e.apply(t,n))}function O(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(O=function(){return!!t})()}function P(t){return P=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},P(t)}function R(t,e){return R=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},R(t,e)}var k=0;const C=function(t){function e(t){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=A(this,e,["StorageBuffer_"+k++,t?t.value:null])).nodeUniform=t,n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&R(t,e)}(e,t),n=e,(r=[{key:"buffer",get:function(){return this.nodeUniform.value}}])&&M(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(S);var N=n(337),L=n(7047),j=n(9729),I=n(7830),B=n(1248);function U(t){return U="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},U(t)}function D(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,F(r.key),r)}}function F(t){var e=function(t,e){if("object"!=U(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=U(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==U(e)?e:e+""}function z(t,e,n){return e=G(e),function(t,e){if(e&&("object"===U(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,V()?Reflect.construct(e,n||[],G(t).constructor):e.apply(t,n))}function V(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(V=function(){return!!t})()}function G(t){return G=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},G(t)}function H(t,e){return H=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},H(t,e)}var W=/^[fn]*\s*([a-z_0-9]+)?\s*\(([\s\S]*?)\)\s*[\-\>]*\s*([a-z_0-9]+)?/i,q=/[a-z_0-9]+|<(.*?)>+/gi,X={f32:"float"};const Y=function(t){function e(t){var n;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var r=function(t){var e=(t=t.trim()).match(W);if(null!==e&&4===e.length){for(var n=e[2],r=[],i=null;null!==(i=q.exec(n));)r.push(i);for(var o=[],a=0;a<r.length;){var s=r[a++][0],u=r[a++][0];u=X[u]||u,a<r.length&&!0===r[a][0].startsWith("<")&&a++,o.push(new B.A(u,s))}var c=t.substring(e[0].length),l=void 0!==e[1]?e[1]:"";return{type:e[3]||"void",inputs:o,name:l,inputsCode:n,blockCode:c}}throw new Error("FunctionNode: Function is not a WGSL code.")}(t),i=r.type,o=r.inputs,a=r.name,s=r.inputsCode,u=r.blockCode;return(n=z(this,e,[i,o,a])).inputsCode=s,n.blockCode=u,n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&H(t,e)}(e,t),n=e,r=[{key:"getCode",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.name,e="void"!==this.type?"-> "+this.type:"";return"fn ".concat(t," ( ").concat(this.inputsCode.trim()," ) ").concat(e)+this.blockCode}}],r&&D(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(I.A);function J(t){return J="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},J(t)}function Z(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,K(r.key),r)}}function K(t){var e=function(t,e){if("object"!=J(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=J(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==J(e)?e:e+""}function Q(t,e,n){return e=tt(e),function(t,e){if(e&&("object"===J(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,$()?Reflect.construct(e,n||[],tt(t).constructor):e.apply(t,n))}function $(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return($=function(){return!!t})()}function tt(t){return tt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},tt(t)}function et(t,e){return et=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},et(t,e)}const nt=function(t){function e(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),Q(this,e,arguments)}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&et(t,e)}(e,t),n=e,(r=[{key:"parseFunction",value:function(t){return new Y(t)}}])&&Z(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(j.A);function rt(t){return rt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},rt(t)}function it(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return ot(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ot(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function ot(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function at(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,st(r.key),r)}}function st(t){var e=function(t,e){if("object"!=rt(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=rt(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==rt(e)?e:e+""}function ut(t,e,n){return e=ft(e),function(t,e){if(e&&("object"===rt(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,ct()?Reflect.construct(e,n||[],ft(t).constructor):e.apply(t,n))}function ct(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(ct=function(){return!!t})()}function lt(){return lt="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=ft(t)););return t}(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(arguments.length<3?t:n):i.value}},lt.apply(this,arguments)}function ft(t){return ft=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},ft(t)}function ht(t,e){return ht=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},ht(t,e)}var pt=self.GPUShaderStage,dt={vertex:pt?pt.VERTEX:1,fragment:pt?pt.FRAGMENT:2,compute:pt?pt.COMPUTE:4},mt={instance:!0,storageBuffer:!0},yt={"^^":"threejs_xor"},vt={float:"f32",int:"i32",uint:"u32",bool:"bool",color:"vec3<f32>",vec2:"vec2<f32>",ivec2:"vec2<i32>",uvec2:"vec2<u32>",bvec2:"vec2<bool>",vec3:"vec3<f32>",ivec3:"vec3<i32>",uvec3:"vec3<u32>",bvec3:"vec3<bool>",vec4:"vec4<f32>",ivec4:"vec4<i32>",uvec4:"vec4<u32>",bvec4:"vec4<bool>",mat2:"mat2x2<f32>",imat2:"mat2x2<i32>",umat2:"mat2x2<u32>",bmat2:"mat2x2<bool>",mat3:"mat3x3<f32>",imat3:"mat3x3<i32>",umat3:"mat3x3<u32>",bmat3:"mat3x3<bool>",mat4:"mat4x4<f32>",imat4:"mat4x4<i32>",umat4:"mat4x4<u32>",bmat4:"mat4x4<bool>"},gt={dFdx:"dpdx",dFdy:"- dpdy",mod_float:"threejs_mod_float",mod_vec2:"threejs_mod_vec2",mod_vec3:"threejs_mod_vec3",mod_vec4:"threejs_mod_vec4",equals_bool:"threejs_equals_bool",equals_bvec2:"threejs_equals_bvec2",equals_bvec3:"threejs_equals_bvec3",equals_bvec4:"threejs_equals_bvec4",lessThanEqual:"threejs_lessThanEqual",greaterThan:"threejs_greaterThan",inversesqrt:"inverseSqrt",bitcast:"bitcast<f32>"},bt={threejs_xor:new N.CodeNode("\nfn threejs_xor( a : bool, b : bool ) -> bool {\n\n\treturn ( a || b ) && !( a && b );\n\n}\n"),lessThanEqual:new N.CodeNode("\nfn threejs_lessThanEqual( a : vec3<f32>, b : vec3<f32> ) -> vec3<bool> {\n\n\treturn vec3<bool>( a.x <= b.x, a.y <= b.y, a.z <= b.z );\n\n}\n"),greaterThan:new N.CodeNode("\nfn threejs_greaterThan( a : vec3<f32>, b : vec3<f32> ) -> vec3<bool> {\n\n\treturn vec3<bool>( a.x > b.x, a.y > b.y, a.z > b.z );\n\n}\n"),mod_float:new N.CodeNode("fn threejs_mod_float( x : f32, y : f32 ) -> f32 { return x - y * floor( x / y ); }"),mod_vec2:new N.CodeNode("fn threejs_mod_vec2( x : vec2f, y : vec2f ) -> vec2f { return x - y * floor( x / y ); }"),mod_vec3:new N.CodeNode("fn threejs_mod_vec3( x : vec3f, y : vec3f ) -> vec3f { return x - y * floor( x / y ); }"),mod_vec4:new N.CodeNode("fn threejs_mod_vec4( x : vec4f, y : vec4f ) -> vec4f { return x - y * floor( x / y ); }"),equals_bool:new N.CodeNode("fn threejs_equals_bool( a : bool, b : bool ) -> bool { return a == b; }"),equals_bvec2:new N.CodeNode("fn threejs_equals_bvec2( a : vec2f, b : vec2f ) -> vec2<bool> { return vec2<bool>( a.x == b.x, a.y == b.y ); }"),equals_bvec3:new N.CodeNode("fn threejs_equals_bvec3( a : vec3f, b : vec3f ) -> vec3<bool> { return vec3<bool>( a.x == b.x, a.y == b.y, a.z == b.z ); }"),equals_bvec4:new N.CodeNode("fn threejs_equals_bvec4( a : vec4f, b : vec4f ) -> vec4<bool> { return vec4<bool>( a.x == b.x, a.y == b.y, a.z == b.z, a.w == b.w ); }"),repeatWrapping:new N.CodeNode("\nfn threejs_repeatWrapping( uv : vec2<f32>, dimension : vec2<u32> ) -> vec2<u32> {\n\n\tlet uvScaled = vec2<u32>( uv * vec2<f32>( dimension ) );\n\n\treturn ( ( uvScaled % dimension ) + dimension ) % dimension;\n\n}\n")};const _t=function(t){function e(t,n){var r,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(r=ut(this,e,[t,n,new nt,i])).uniformGroups={},r.builtins={},r}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&ht(t,e)}(e,t),n=e,o=[{key:"needsColorSpaceToLinear",value:function(t){return!0===t.isVideoTexture&&t.colorSpace!==r.jf0}},{key:"_generateTextureSample",value:function(t,e,n,r){return"fragment"===(arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.shaderStage)?r?"textureSample( ".concat(e,", ").concat(e,"_sampler, ").concat(n,", ").concat(r," )"):"textureSample( ".concat(e,", ").concat(e,"_sampler, ").concat(n," )"):this.generateTextureLod(t,e,n)}},{key:"_generateVideoSample",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.shaderStage;if("fragment"===n)return"textureSampleBaseClampToEdge( ".concat(t,", ").concat(t,"_sampler, vec2<f32>( ").concat(e,".x, 1.0 - ").concat(e,".y ) )");console.error("WebGPURenderer: THREE.VideoTexture does not support ".concat(n," shader."))}},{key:"_generateTextureSampleLevel",value:function(t,e,n,r,i){return"fragment"===(arguments.length>5&&void 0!==arguments[5]?arguments[5]:this.shaderStage)&&!1===this.isUnfilterable(t)?"textureSampleLevel( ".concat(e,", ").concat(e,"_sampler, ").concat(n,", ").concat(r," )"):this.generateTextureLod(t,e,n,r)}},{key:"generateTextureLod",value:function(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"0";this._include("repeatWrapping");var i="textureDimensions( ".concat(e,", 0 )");return"textureLoad( ".concat(e,", threejs_repeatWrapping( ").concat(n,", ").concat(i," ), i32( ").concat(r," ) )")}},{key:"generateTextureLoad",value:function(t,e,n,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"0u";return r?"textureLoad( ".concat(e,", ").concat(n,", ").concat(r,", ").concat(i," )"):"textureLoad( ".concat(e,", ").concat(n,", ").concat(i," )")}},{key:"generateTextureStore",value:function(t,e,n,r){return"textureStore( ".concat(e,", ").concat(n,", ").concat(r," )")}},{key:"isUnfilterable",value:function(t){return"float"!==this.getComponentTypeFromTexture(t)||!0===t.isDataTexture&&t.type===r.RQf}},{key:"generateTexture",value:function(t,e,n,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.shaderStage;return!0===t.isVideoTexture?this._generateVideoSample(e,n,i):this.isUnfilterable(t)?this.generateTextureLod(t,e,n,"0",r,i):this._generateTextureSample(t,e,n,r,i)}},{key:"generateTextureCompare",value:function(t,e,n,r,i){var o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:this.shaderStage;if("fragment"===o)return"textureSampleCompare( ".concat(e,", ").concat(e,"_sampler, ").concat(n,", ").concat(r," )");console.error("WebGPURenderer: THREE.DepthTexture.compareFunction() does not support ".concat(o," shader."))}},{key:"generateTextureLevel",value:function(t,e,n,r,i){var o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:this.shaderStage;return!0===t.isVideoTexture?this._generateVideoSample(e,n,o):this._generateTextureSampleLevel(t,e,n,r,i,o)}},{key:"getPropertyName",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.shaderStage;if(!0===t.isNodeVarying&&!0===t.needsInterpolation){if("vertex"===n)return"varyings.".concat(t.name)}else if(!0===t.isNodeUniform){var r=t.name,i=t.type;return"texture"===i||"cubeTexture"===i||"storageTexture"===i?r:"buffer"===i||"storageBuffer"===i?"NodeBuffer_".concat(t.id,".").concat(r):t.groupNode.name+"."+r}return lt(ft(e.prototype),"getPropertyName",this).call(this,t)}},{key:"_getUniformGroupCount",value:function(t){return Object.keys(this.uniforms[t]).length}},{key:"getFunctionOperator",value:function(t){var e=yt[t];return void 0!==e?(this._include(e),e):null}},{key:"getUniformFromNode",value:function(t,n,r){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=lt(ft(e.prototype),"getUniformFromNode",this).call(this,t,n,r,o),s=this.getDataFromNode(t,r,this.globalCache);if(void 0===s.uniformGPU){var u,c=this.bindings[r];if("texture"===n||"cubeTexture"===n||"storageTexture"===n){var l=null;if("texture"===n||"storageTexture"===n?l=new y.q(a.name,a.node):"cubeTexture"===n&&(l=new y.t(a.name,a.node)),l.store=!0===t.isStoreTextureNode,l.setVisibility(dt[r]),"fragment"===r&&!1===this.isUnfilterable(t.value)&&!1===l.store){var f=new m("".concat(a.name,"_sampler"),a.node);f.setVisibility(dt[r]),c.push(f,l),u=[f,l]}else c.push(l),u=[l]}else if("buffer"===n||"storageBuffer"===n){var h=new("storageBuffer"===n?C:v.A)(t);h.setVisibility(dt[r]),c.push(h),u=h}else{var p=t.groupNode,d=p.name,g=this.uniformGroups[r]||(this.uniformGroups[r]={}),b=g[d];void 0===b&&((b=new i.A(d,p)).setVisibility(dt[r]),g[d]=b,c.push(b)),u=this.getNodeUniform(a,n),b.addUniform(u)}s.uniformGPU=u,"vertex"===r&&(this.bindingsOffset.fragment=c.length)}return a}},{key:"isReference",value:function(t){return lt(ft(e.prototype),"isReference",this).call(this,t)||"texture_2d"===t||"texture_cube"===t||"texture_depth_2d"===t||"texture_storage_2d"===t}},{key:"getBuiltin",value:function(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.shaderStage,i=this.builtins[r]||(this.builtins[r]=new Map);return!1===i.has(t)&&i.set(t,{name:t,property:e,type:n}),e}},{key:"getVertexIndex",value:function(){return"vertex"===this.shaderStage?this.getBuiltin("vertex_index","vertexIndex","u32","attribute"):"vertexIndex"}},{key:"buildFunctionCode",value:function(t){var e,n=t.layout,r=this.flowShaderNode(t),i=[],o=it(n.inputs);try{for(o.s();!(e=o.n()).done;){var a=e.value;i.push(a.name+" : "+this.getType(a.type))}}catch(t){o.e(t)}finally{o.f()}return"fn ".concat(n.name,"( ").concat(i.join(", ")," ) -> ").concat(this.getType(n.type)," {\n").concat(r.vars,"\n").concat(r.code,"\n\treturn ").concat(r.result,";\n\n}")}},{key:"getInstanceIndex",value:function(){return"vertex"===this.shaderStage?this.getBuiltin("instance_index","instanceIndex","u32","attribute"):"instanceIndex"}},{key:"getFrontFacing",value:function(){return this.getBuiltin("front_facing","isFront","bool")}},{key:"getFragCoord",value:function(){return this.getBuiltin("position","fragCoord","vec4<f32>")+".xy"}},{key:"getFragDepth",value:function(){return"output."+this.getBuiltin("frag_depth","depth","f32","output")}},{key:"isFlipY",value:function(){return!1}},{key:"getBuiltins",value:function(t){var e=[],n=this.builtins[t];if(void 0!==n){var r,i=it(n.values());try{for(i.s();!(r=i.n()).done;){var o=r.value,a=o.name,s=o.property,u=o.type;e.push("@builtin( ".concat(a," ) ").concat(s," : ").concat(u))}}catch(t){i.e(t)}finally{i.f()}}return e.join(",\n\t")}},{key:"getAttributes",value:function(t){var e=[];if("compute"===t&&this.getBuiltin("global_invocation_id","id","vec3<u32>","attribute"),"vertex"===t||"compute"===t){var n=this.getBuiltins("attribute");n&&e.push(n);for(var r=this.getAttributesArray(),i=0,o=r.length;i<o;i++){var a=r[i],s=a.name,u=this.getType(a.type);e.push("@location( ".concat(i," ) ").concat(s," : ").concat(u))}}return e.join(",\n\t")}},{key:"getStructMembers",value:function(t){for(var e=[],n=t.getMemberTypes(),r=0;r<n.length;r++){var i=n[r];e.push("\t@location( ".concat(r," ) m").concat(r," : ").concat(i,"<f32>"))}return e.join(",\n")}},{key:"getStructs",value:function(t){for(var e=[],n=this.structs[t],r=0,i=n.length;r<i;r++){var o=n[r],a=o.name,s="struct ".concat(a," {\n");s+=this.getStructMembers(o),s+="\n}",e.push(s)}return e.join("\n\n")}},{key:"getVar",value:function(t,e){return"var ".concat(e," : ").concat(this.getType(t))}},{key:"getVars",value:function(t){var e=[],n=this.vars[t];if(void 0!==n){var r,i=it(n);try{for(i.s();!(r=i.n()).done;){var o=r.value;e.push("\t".concat(this.getVar(o.type,o.name),";"))}}catch(t){i.e(t)}finally{i.f()}}return"\n".concat(e.join("\n"),"\n")}},{key:"getVaryings",value:function(t){var e=[];if("vertex"===t&&this.getBuiltin("position","Vertex","vec4<f32>","vertex"),"vertex"===t||"fragment"===t)for(var n=this.varyings,r=this.vars[t],i=0;i<n.length;i++){var o=n[i];if(o.needsInterpolation){var a="@location( ".concat(i," )");/^(int|uint|ivec|uvec)/.test(o.type)&&(a+=" @interpolate( flat )"),e.push("".concat(a," ").concat(o.name," : ").concat(this.getType(o.type)))}else"vertex"===t&&!1===r.includes(o)&&r.push(o)}var s=this.getBuiltins(t);s&&e.push(s);var u=e.join(",\n\t");return"vertex"===t?this._getWGSLStruct("VaryingsStruct","\t"+u):u}},{key:"getUniforms",value:function(t){var e,n=this.uniforms[t],r=[],i=[],o=[],a={},s=this.bindingsOffset[t],u=it(n);try{for(u.s();!(e=u.n()).done;){var c=e.value;if("texture"===c.type||"cubeTexture"===c.type||"storageTexture"===c.type){var l=c.node.value;"fragment"===t&&!1===this.isUnfilterable(l)&&!0!==c.node.isStoreTextureNode&&(!0===l.isDepthTexture&&null!==l.compareFunction?r.push("@binding( ".concat(s++," ) @group( 0 ) var ").concat(c.name,"_sampler : sampler_comparison;")):r.push("@binding( ".concat(s++," ) @group( 0 ) var ").concat(c.name,"_sampler : sampler;")));var f=void 0;if(!0===l.isCubeTexture)f="texture_cube<f32>";else if(!0===l.isDataArrayTexture)f="texture_2d_array<f32>";else if(!0===l.isDepthTexture)f="texture_depth_2d";else if(!0===l.isVideoTexture)f="texture_external";else if(!0===c.node.isStoreTextureNode){var h=(0,L.g)(l);f="texture_storage_2d<".concat(h,", write>")}else{var p=this.getComponentTypeFromTexture(l).charAt(0);f="texture_2d<".concat(p,"32>")}r.push("@binding( ".concat(s++," ) @group( 0 ) var ").concat(c.name," : ").concat(f,";"))}else if("buffer"===c.type||"storageBuffer"===c.type){var d=c.node,m=this.getType(d.bufferType),y=d.bufferCount,v=y>0?", "+y:"",g="\t".concat(c.name," : array< ").concat(m).concat(v," >\n"),b=d.isStorageBufferNode?"storage,read_write":"uniform";i.push(this._getWGSLStructBinding("NodeBuffer_"+d.id,g,b,s++))}else{var _=this.getType(this.getVectorType(c.type)),x=c.groupNode.name;(a[x]||(a[x]={index:s++,snippets:[]})).snippets.push("\t".concat(c.name," : ").concat(_))}}}catch(t){u.e(t)}finally{u.f()}for(var w in a){var S=a[w];o.push(this._getWGSLStructBinding(w,S.snippets.join(",\n"),"uniform",S.index))}var T=r.join("\n");return(T+=i.join("\n"))+o.join("\n")}},{key:"buildCode",value:function(){var t=null!==this.material?{fragment:{},vertex:{}}:{compute:{}};for(var e in t){var n=t[e];n.uniforms=this.getUniforms(e),n.attributes=this.getAttributes(e),n.varyings=this.getVaryings(e),n.structs=this.getStructs(e),n.vars=this.getVars(e),n.codes=this.getCodes(e);var r="// code\n\n";r+=this.flowCode[e];var i,o=this.flowNodes[e],a=o[o.length-1],s=a.outputNode,u=void 0!==s&&!0===s.isOutputStructNode,c=it(o);try{for(c.s();!(i=c.n()).done;){var l=i.value,f=this.getFlowData(l),h=l.name;if(h&&(r.length>0&&(r+="\n"),r+="\t// flow -> ".concat(h,"\n\t")),r+="".concat(f.code,"\n\t"),l===a&&"compute"!==e)if(r+="// result\n\n\t","vertex"===e)r+="varyings.Vertex = ".concat(f.result,";");else if("fragment"===e)if(u)n.returnType=s.nodeType,r+="return ".concat(f.result,";");else{var p="\t@location(0) color: vec4<f32>",d=this.getBuiltins("output");d&&(p+=",\n\t"+d),n.returnType="OutputStruct",n.structs+=this._getWGSLStruct("OutputStruct",p),n.structs+="\nvar<private> output : OutputStruct;\n\n",r+="output.color = ".concat(f.result,";\n\n\treturn output;")}}}catch(t){c.e(t)}finally{c.f()}n.flow=r}null!==this.material?(this.vertexShader=this._getWGSLVertexCode(t.vertex),this.fragmentShader=this._getWGSLFragmentCode(t.fragment)):this.computeShader=this._getWGSLComputeCode(t.compute,(this.object.workgroupSize||[64]).join(", "))}},{key:"getMethod",value:function(t){var e,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return null!==n&&(e=this._getWGSLMethod(t+"_"+n)),void 0===e&&(e=this._getWGSLMethod(t)),e||t}},{key:"getType",value:function(t){return vt[t]||t}},{key:"isAvailable",value:function(t){return!0===mt[t]}},{key:"_getWGSLMethod",value:function(t){return void 0!==bt[t]&&this._include(t),gt[t]}},{key:"_include",value:function(t){var e=bt[t];return e.build(this),null!==this.currentFunctionNode&&this.currentFunctionNode.includes.push(e),e}},{key:"_getWGSLVertexCode",value:function(t){return"".concat(this.getSignature(),"\n\n// uniforms\n").concat(t.uniforms,"\n\n// varyings\n").concat(t.varyings,"\nvar<private> varyings : VaryingsStruct;\n\n// codes\n").concat(t.codes,"\n\n@vertex\nfn main( ").concat(t.attributes," ) -> VaryingsStruct {\n\n\t// vars\n\t").concat(t.vars,"\n\n\t// flow\n\t").concat(t.flow,"\n\n\treturn varyings;\n\n}\n")}},{key:"_getWGSLFragmentCode",value:function(t){return"".concat(this.getSignature(),"\n\n// uniforms\n").concat(t.uniforms,"\n\n// structs\n").concat(t.structs,"\n\n// codes\n").concat(t.codes,"\n\n@fragment\nfn main( ").concat(t.varyings," ) -> ").concat(t.returnType," {\n\n\t// vars\n\t").concat(t.vars,"\n\n\t// flow\n\t").concat(t.flow,"\n\n}\n")}},{key:"_getWGSLComputeCode",value:function(t,e){return"".concat(this.getSignature(),"\n// system\nvar<private> instanceIndex : u32;\n\n// uniforms\n").concat(t.uniforms,"\n\n// codes\n").concat(t.codes,"\n\n@compute @workgroup_size( ").concat(e," )\nfn main( ").concat(t.attributes," ) {\n\n\t// system\n\tinstanceIndex = id.x;\n\n\t// vars\n\t").concat(t.vars,"\n\n\t// flow\n\t").concat(t.flow,"\n\n}\n")}},{key:"_getWGSLStruct",value:function(t,e){return"\nstruct ".concat(t," {\n").concat(e,"\n};")}},{key:"_getWGSLStructBinding",value:function(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,o=t+"Struct",a=this._getWGSLStruct(o,e);return"".concat(a,"\n@binding( ").concat(r," ) @group( ").concat(i," )\nvar<").concat(n,"> ").concat(t," : ").concat(o,";")}}],o&&at(n.prototype,o),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,o}(N.NodeBuilder)},697:(t,e,n)=>{n.d(e,{A:()=>p});var r=n(554),i=n(1367);function o(t){return o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},o(t)}function a(){a=function(){return e};var t,e={},n=Object.prototype,r=n.hasOwnProperty,i=Object.defineProperty||function(t,e,n){t[e]=n.value},s="function"==typeof Symbol?Symbol:{},u=s.iterator||"@@iterator",c=s.asyncIterator||"@@asyncIterator",l=s.toStringTag||"@@toStringTag";function f(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{f({},"")}catch(t){f=function(t,e,n){return t[e]=n}}function h(t,e,n,r){var o=e&&e.prototype instanceof b?e:b,a=Object.create(o.prototype),s=new C(r||[]);return i(a,"_invoke",{value:O(t,n,s)}),a}function p(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}e.wrap=h;var d="suspendedStart",m="suspendedYield",y="executing",v="completed",g={};function b(){}function _(){}function x(){}var w={};f(w,u,(function(){return this}));var S=Object.getPrototypeOf,T=S&&S(S(N([])));T&&T!==n&&r.call(T,u)&&(w=T);var M=x.prototype=b.prototype=Object.create(w);function E(t){["next","throw","return"].forEach((function(e){f(t,e,(function(t){return this._invoke(e,t)}))}))}function A(t,e){function n(i,a,s,u){var c=p(t[i],t,a);if("throw"!==c.type){var l=c.arg,f=l.value;return f&&"object"==o(f)&&r.call(f,"__await")?e.resolve(f.__await).then((function(t){n("next",t,s,u)}),(function(t){n("throw",t,s,u)})):e.resolve(f).then((function(t){l.value=t,s(l)}),(function(t){return n("throw",t,s,u)}))}u(c.arg)}var a;i(this,"_invoke",{value:function(t,r){function i(){return new e((function(e,i){n(t,r,e,i)}))}return a=a?a.then(i,i):i()}})}function O(e,n,r){var i=d;return function(o,a){if(i===y)throw Error("Generator is already running");if(i===v){if("throw"===o)throw a;return{value:t,done:!0}}for(r.method=o,r.arg=a;;){var s=r.delegate;if(s){var u=P(s,r);if(u){if(u===g)continue;return u}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(i===d)throw i=v,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);i=y;var c=p(e,n,r);if("normal"===c.type){if(i=r.done?v:m,c.arg===g)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(i=v,r.method="throw",r.arg=c.arg)}}}function P(e,n){var r=n.method,i=e.iterator[r];if(i===t)return n.delegate=null,"throw"===r&&e.iterator.return&&(n.method="return",n.arg=t,P(e,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),g;var o=p(i,e.iterator,n.arg);if("throw"===o.type)return n.method="throw",n.arg=o.arg,n.delegate=null,g;var a=o.arg;return a?a.done?(n[e.resultName]=a.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,g):a:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,g)}function R(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function k(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function C(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(R,this),this.reset(!0)}function N(e){if(e||""===e){var n=e[u];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,a=function n(){for(;++i<e.length;)if(r.call(e,i))return n.value=e[i],n.done=!1,n;return n.value=t,n.done=!0,n};return a.next=a}}throw new TypeError(o(e)+" is not iterable")}return _.prototype=x,i(M,"constructor",{value:x,configurable:!0}),i(x,"constructor",{value:_,configurable:!0}),_.displayName=f(x,l,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===_||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,x):(t.__proto__=x,f(t,l,"GeneratorFunction")),t.prototype=Object.create(M),t},e.awrap=function(t){return{__await:t}},E(A.prototype),f(A.prototype,c,(function(){return this})),e.AsyncIterator=A,e.async=function(t,n,r,i,o){void 0===o&&(o=Promise);var a=new A(h(t,n,r,i),o);return e.isGeneratorFunction(n)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},E(M),f(M,l,"Generator"),f(M,u,(function(){return this})),f(M,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),n=[];for(var r in e)n.push(r);return n.reverse(),function t(){for(;n.length;){var r=n.pop();if(r in e)return t.value=r,t.done=!1,t}return t.done=!0,t}},e.values=N,C.prototype={constructor:C,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(k),!e)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function i(r,i){return s.type="throw",s.arg=e,n.next=r,i&&(n.method="next",n.arg=t),!!i}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],s=a.completion;if("root"===a.tryLoc)return i("end");if(a.tryLoc<=this.prev){var u=r.call(a,"catchLoc"),c=r.call(a,"finallyLoc");if(u&&c){if(this.prev<a.catchLoc)return i(a.catchLoc,!0);if(this.prev<a.finallyLoc)return i(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return i(a.catchLoc,!0)}else{if(!c)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return i(a.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=t,a.arg=e,o?(this.method="next",this.next=o.finallyLoc,g):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),g},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),k(n),g}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var i=r.arg;k(n)}return i}}throw Error("illegal catch attempt")},delegateYield:function(e,n,r){return this.delegate={iterator:N(e),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=t),g}},e}function s(t,e,n,r,i,o,a){try{var s=t[o](a),u=s.value}catch(t){return void n(t)}s.done?e(u):Promise.resolve(u).then(r,i)}function u(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,c(r.key),r)}}function c(t){var e=function(t,e){if("object"!=o(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=o(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==o(e)?e:e+""}var l=new Map([[Int8Array,["sint8","snorm8"]],[Uint8Array,["uint8","unorm8"]],[Int16Array,["sint16","snorm16"]],[Uint16Array,["uint16","unorm16"]],[Int32Array,["sint32","snorm32"]],[Uint32Array,["uint32","unorm32"]],[Float32Array,["float32"]]]),f=new Map([[r.Oax,["float16"]]]),h=new Map([[Int32Array,"sint32"],[Int16Array,"sint32"],[Uint32Array,"uint32"],[Uint16Array,"uint32"],[Float32Array,"float32"]]);const p=function(){return t=function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.backend=e},e=[{key:"createAttribute",value:function(t,e){var n=this._getBufferAttribute(t),r=this.backend,i=r.get(n),o=i.buffer;if(void 0===o){var a=r.device,s=n.array;if(!1===t.normalized&&(s.constructor===Int16Array||s.constructor===Uint16Array)){for(var u=new Uint32Array(s.length),c=0;c<s.length;c++)u[c]=s[c];s=u}if(n.array=s,(n.isStorageBufferAttribute||n.isStorageInstancedBufferAttribute)&&3===n.itemSize){n.itemSize=4,s=new s.constructor(4*n.count);for(var l=0;l<n.count;l++)s.set(n.array.subarray(3*l,3*l+3),4*l)}var f=s.byteLength+(4-s.byteLength%4)%4;o=a.createBuffer({label:n.name,size:f,usage:e,mappedAtCreation:!0}),new s.constructor(o.getMappedRange()).set(s),o.unmap(),i.buffer=o}}},{key:"updateAttribute",value:function(t){var e=this._getBufferAttribute(t),n=this.backend,r=n.device,i=n.get(e).buffer,o=e.array,a=e.updateRanges;if(0===a.length)r.queue.writeBuffer(i,0,o,0);else{for(var s=0,u=a.length;s<u;s++){var c=a[s];r.queue.writeBuffer(i,0,o,c.start*o.BYTES_PER_ELEMENT,c.count*o.BYTES_PER_ELEMENT)}e.clearUpdateRanges()}}},{key:"createShaderVertexBuffers",value:function(t){for(var e=t.getAttributes(),n=new Map,r=0;r<e.length;r++){var o=e[r],a=o.array.BYTES_PER_ELEMENT,s=this._getBufferAttribute(o),u=n.get(s);if(void 0===u){var c=void 0,l=void 0;!0===o.isInterleavedBufferAttribute?(c=o.data.stride*a,l=o.data.isInstancedInterleavedBuffer?i.Qe.Instance:i.Qe.Vertex):(c=o.itemSize*a,l=o.isInstancedBufferAttribute?i.Qe.Instance:i.Qe.Vertex),!1!==o.normalized||o.array.constructor!==Int16Array&&o.array.constructor!==Uint16Array||(c=4),u={arrayStride:c,attributes:[],stepMode:l},n.set(s,u)}var f=this._getVertexFormat(o),h=!0===o.isInterleavedBufferAttribute?o.offset*a:0;u.attributes.push({shaderLocation:r,offset:h,format:f})}return Array.from(n.values())}},{key:"destroyAttribute",value:function(t){var e=this.backend;e.get(this._getBufferAttribute(t)).buffer.destroy(),e.delete(t)}},{key:"getArrayBufferAsync",value:(n=a().mark((function t(e){var n,r,i,o,s,u,c,l,f,h;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=this.backend,r=n.device,i=n.get(this._getBufferAttribute(e)),o=i.buffer,s=o.size,u=i.readBuffer,c=!0,void 0===u&&(u=r.createBuffer({label:e.name,size:s,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ}),c=!1,i.readBuffer=u),(l=r.createCommandEncoder({})).copyBufferToBuffer(o,0,u,0,s),c&&u.unmap(),f=l.finish(),r.queue.submit([f]),t.next=15,u.mapAsync(GPUMapMode.READ);case 15:return h=u.getMappedRange(),t.abrupt("return",h);case 17:case"end":return t.stop()}}),t,this)})),r=function(){var t=this,e=arguments;return new Promise((function(r,i){var o=n.apply(t,e);function a(t){s(o,r,i,a,u,"next",t)}function u(t){s(o,r,i,a,u,"throw",t)}a(void 0)}))},function(t){return r.apply(this,arguments)})},{key:"_getVertexFormat",value:function(t){var e,n=t.itemSize,r=t.normalized,i=t.array.constructor,o=t.constructor;if(1==n)e=h.get(i);else{var a=(f.get(o)||l.get(i))[r?1:0];if(a){var s=i.BYTES_PER_ELEMENT*n,u=4*Math.floor((s+3)/4)/i.BYTES_PER_ELEMENT;if(u%1)throw new Error("THREE.WebGPUAttributeUtils: Bad vertex format item size.");e="".concat(a,"x").concat(u)}}return e||console.error("THREE.WebGPUAttributeUtils: Vertex format not supported yet."),e}},{key:"_getBufferAttribute",value:function(t){return t.isInterleavedBufferAttribute&&(t=t.data),t}}],e&&u(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,n,r}()},2246:(t,e,n)=>{n.d(e,{A:()=>l});var r=n(1367),i=n(554);function o(t){return o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},o(t)}function a(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return s(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?s(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,u=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){u=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(u)throw o}}}}function s(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function u(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,c(r.key),r)}}function c(t){var e=function(t,e){if("object"!=o(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=o(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==o(e)?e:e+""}const l=function(){return t=function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.backend=e},(e=[{key:"createBindingsLayout",value:function(t){var e,n=this.backend.device,o=[],s=0,u=a(t);try{for(u.s();!(e=u.n()).done;){var c=e.value,l={binding:s++,visibility:c.visibility};if(c.isUniformBuffer||c.isStorageBuffer){var f={};c.isStorageBuffer&&(f.type=r.Sm.Storage),l.buffer=f}else if(c.isSampler){var h={};c.texture.isDepthTexture&&null!==c.texture.compareFunction&&(h.type="comparison"),l.sampler=h}else if(c.isSampledTexture&&c.texture.isVideoTexture)l.externalTexture={};else if(c.isSampledTexture&&c.store){var p=this.backend.get(c.texture).texture.format;l.storageTexture={format:p}}else if(c.isSampledTexture){var d={};if(c.texture.isDepthTexture)d.sampleType=r.Ek.Depth;else if(c.texture.isDataTexture){var m=c.texture.type;m===i.Yuy?d.sampleType=r.Ek.SInt:m===i.bkx?d.sampleType=r.Ek.UInt:m===i.RQf&&(d.sampleType=r.Ek.UnfilterableFloat)}c.isSampledCubeTexture?d.viewDimension=r.D2.Cube:c.texture.isDataArrayTexture&&(d.viewDimension=r.D2.TwoDArray),l.texture=d}else console.error('WebGPUBindingUtils: Unsupported binding "'.concat(c,'".'));o.push(l)}}catch(t){u.e(t)}finally{u.f()}return n.createBindGroupLayout({entries:o})}},{key:"createBindings",value:function(t){var e=this.backend.get(t),n=this.createBindingsLayout(t),r=this.createBindGroup(t,n);e.layout=n,e.group=r,e.bindings=t}},{key:"updateBinding",value:function(t){var e=this.backend,n=e.device,r=t.buffer,i=e.get(t).buffer;n.queue.writeBuffer(i,0,r,0)}},{key:"createBindGroup",value:function(t,e){var n,i=this.backend,o=i.device,s=0,u=[],c=a(t);try{for(c.s();!(n=c.n()).done;){var l=n.value;if(l.isUniformBuffer){var f=i.get(l);if(void 0===f.buffer){var h=l.byteLength,p=GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST,d=o.createBuffer({label:"bindingBuffer_"+l.name,size:h,usage:p});f.buffer=d}u.push({binding:s,resource:{buffer:f.buffer}})}else if(l.isStorageBuffer){var m=i.get(l);if(void 0===m.buffer){var y=l.attribute;m.buffer=i.get(y).buffer}u.push({binding:s,resource:{buffer:m.buffer}})}else if(l.isSampler){var v=i.get(l.texture);u.push({binding:s,resource:v.sampler})}else if(l.isSampledTexture){var g,b=i.get(l.texture);g=l.isSampledCubeTexture?r.D2.Cube:l.texture.isDataArrayTexture?r.D2.TwoDArray:r.D2.TwoD;var _=void 0;if(void 0!==b.externalTexture)_=o.importExternalTexture({source:b.externalTexture});else{var x=r.QJ.All;_=b.texture.createView({aspect:x,dimension:g,mipLevelCount:l.store?1:b.mipLevelCount})}u.push({binding:s,resource:_})}s++}}catch(t){c.e(t)}finally{c.f()}return o.createBindGroup({layout:e,entries:u})}}])&&u(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}()},1367:(t,e,n)=>{n.d(e,{D2:()=>_,Ek:()=>g,K7:()=>u,LG:()=>l,ML:()=>i,Ml:()=>b,QJ:()=>x,Qe:()=>w,Sm:()=>v,a4:()=>h,g_:()=>m,m4:()=>c,m8:()=>f,mP:()=>a,n1:()=>s,nU:()=>r,oc:()=>S,pY:()=>o,tn:()=>p,uA:()=>y,zx:()=>d});var r={PointList:"point-list",LineList:"line-list",LineStrip:"line-strip",TriangleList:"triangle-list",TriangleStrip:"triangle-strip"},i={Never:"never",Less:"less",Equal:"equal",LessEqual:"less-equal",Greater:"greater",NotEqual:"not-equal",GreaterEqual:"greater-equal",Always:"always"},o={Store:"store",Discard:"discard"},a={Load:"load",Clear:"clear"},s={CCW:"ccw",CW:"cw"},u={None:"none",Front:"front",Back:"back"},c={Uint16:"uint16",Uint32:"uint32"},l={R8Unorm:"r8unorm",R8Snorm:"r8snorm",R8Uint:"r8uint",R8Sint:"r8sint",R16Uint:"r16uint",R16Sint:"r16sint",R16Float:"r16float",RG8Unorm:"rg8unorm",RG8Snorm:"rg8snorm",RG8Uint:"rg8uint",RG8Sint:"rg8sint",R32Uint:"r32uint",R32Sint:"r32sint",R32Float:"r32float",RG16Uint:"rg16uint",RG16Sint:"rg16sint",RG16Float:"rg16float",RGBA8Unorm:"rgba8unorm",RGBA8UnormSRGB:"rgba8unorm-srgb",RGBA8Snorm:"rgba8snorm",RGBA8Uint:"rgba8uint",RGBA8Sint:"rgba8sint",BGRA8Unorm:"bgra8unorm",BGRA8UnormSRGB:"bgra8unorm-srgb",RGB9E5UFloat:"rgb9e5ufloat",RGB10A2Unorm:"rgb10a2unorm",RG11B10uFloat:"rgb10a2unorm",RG32Uint:"rg32uint",RG32Sint:"rg32sint",RG32Float:"rg32float",RGBA16Uint:"rgba16uint",RGBA16Sint:"rgba16sint",RGBA16Float:"rgba16float",RGBA32Uint:"rgba32uint",RGBA32Sint:"rgba32sint",RGBA32Float:"rgba32float",Stencil8:"stencil8",Depth16Unorm:"depth16unorm",Depth24Plus:"depth24plus",Depth24PlusStencil8:"depth24plus-stencil8",Depth32Float:"depth32float",Depth32FloatStencil8:"depth32float-stencil8",BC1RGBAUnorm:"bc1-rgba-unorm",BC1RGBAUnormSRGB:"bc1-rgba-unorm-srgb",BC2RGBAUnorm:"bc2-rgba-unorm",BC2RGBAUnormSRGB:"bc2-rgba-unorm-srgb",BC3RGBAUnorm:"bc3-rgba-unorm",BC3RGBAUnormSRGB:"bc3-rgba-unorm-srgb",BC4RUnorm:"bc4-r-unorm",BC4RSnorm:"bc4-r-snorm",BC5RGUnorm:"bc5-rg-unorm",BC5RGSnorm:"bc5-rg-snorm",BC6HRGBUFloat:"bc6h-rgb-ufloat",BC6HRGBFloat:"bc6h-rgb-float",BC7RGBAUnorm:"bc7-rgba-unorm",BC7RGBAUnormSRGB:"bc7-rgba-srgb",ETC2RGB8Unorm:"etc2-rgb8unorm",ETC2RGB8UnormSRGB:"etc2-rgb8unorm-srgb",ETC2RGB8A1Unorm:"etc2-rgb8a1unorm",ETC2RGB8A1UnormSRGB:"etc2-rgb8a1unorm-srgb",ETC2RGBA8Unorm:"etc2-rgba8unorm",ETC2RGBA8UnormSRGB:"etc2-rgba8unorm-srgb",EACR11Unorm:"eac-r11unorm",EACR11Snorm:"eac-r11snorm",EACRG11Unorm:"eac-rg11unorm",EACRG11Snorm:"eac-rg11snorm",ASTC4x4Unorm:"astc-4x4-unorm",ASTC4x4UnormSRGB:"astc-4x4-unorm-srgb",ASTC5x4Unorm:"astc-5x4-unorm",ASTC5x4UnormSRGB:"astc-5x4-unorm-srgb",ASTC5x5Unorm:"astc-5x5-unorm",ASTC5x5UnormSRGB:"astc-5x5-unorm-srgb",ASTC6x5Unorm:"astc-6x5-unorm",ASTC6x5UnormSRGB:"astc-6x5-unorm-srgb",ASTC6x6Unorm:"astc-6x6-unorm",ASTC6x6UnormSRGB:"astc-6x6-unorm-srgb",ASTC8x5Unorm:"astc-8x5-unorm",ASTC8x5UnormSRGB:"astc-8x5-unorm-srgb",ASTC8x6Unorm:"astc-8x6-unorm",ASTC8x6UnormSRGB:"astc-8x6-unorm-srgb",ASTC8x8Unorm:"astc-8x8-unorm",ASTC8x8UnormSRGB:"astc-8x8-unorm-srgb",ASTC10x5Unorm:"astc-10x5-unorm",ASTC10x5UnormSRGB:"astc-10x5-unorm-srgb",ASTC10x6Unorm:"astc-10x6-unorm",ASTC10x6UnormSRGB:"astc-10x6-unorm-srgb",ASTC10x8Unorm:"astc-10x8-unorm",ASTC10x8UnormSRGB:"astc-10x8-unorm-srgb",ASTC10x10Unorm:"astc-10x10-unorm",ASTC10x10UnormSRGB:"astc-10x10-unorm-srgb",ASTC12x10Unorm:"astc-12x10-unorm",ASTC12x10UnormSRGB:"astc-12x10-unorm-srgb",ASTC12x12Unorm:"astc-12x12-unorm",ASTC12x12UnormSRGB:"astc-12x12-unorm-srgb"},f={ClampToEdge:"clamp-to-edge",Repeat:"repeat",MirrorRepeat:"mirror-repeat"},h={Linear:"linear",Nearest:"nearest"},p={Zero:"zero",One:"one",Src:"src",OneMinusSrc:"one-minus-src",SrcAlpha:"src-alpha",OneMinusSrcAlpha:"one-minus-src-alpha",Dst:"dst",OneMinusDstColor:"one-minus-dst",DstAlpha:"dst-alpha",OneMinusDstAlpha:"one-minus-dst-alpha",SrcAlphaSaturated:"src-alpha-saturated",Constant:"constant",OneMinusConstant:"one-minus-constant"},d={Add:"add",Subtract:"subtract",ReverseSubtract:"reverse-subtract",Min:"min",Max:"max"},m={None:0,Red:1,Green:2,Blue:4,Alpha:8,All:15},y={Keep:"keep",Zero:"zero",Replace:"replace",Invert:"invert",IncrementClamp:"increment-clamp",DecrementClamp:"decrement-clamp",IncrementWrap:"increment-wrap",DecrementWrap:"decrement-wrap"},v={Uniform:"uniform",Storage:"storage",ReadOnlyStorage:"read-only-storage"},g={Float:"float",UnfilterableFloat:"unfilterable-float",Depth:"depth",SInt:"sint",UInt:"uint"},b={OneD:"1d",TwoD:"2d",ThreeD:"3d"},_={OneD:"1d",TwoD:"2d",TwoDArray:"2d-array",Cube:"cube",CubeArray:"cube-array",ThreeD:"3d"},x={All:"all",StencilOnly:"stencil-only",DepthOnly:"depth-only"},w={Vertex:"vertex",Instance:"instance"},S={DepthClipControl:"depth-clip-control",Depth32FloatStencil8:"depth32float-stencil8",TextureCompressionBC:"texture-compression-bc",TextureCompressionETC2:"texture-compression-etc2",TextureCompressionASTC:"texture-compression-astc",TimestampQuery:"timestamp-query",IndirectFirstInstance:"indirect-first-instance",ShaderF16:"shader-f16",RG11B10UFloat:"rg11b10ufloat-renderable",BGRA8UNormStorage:"bgra8unorm-storage",Float32Filterable:"float32-filterable"}},3765:(t,e,n)=>{n.d(e,{A:()=>c});var r=n(4408),i=n(1367),o=n(554);function a(t){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},a(t)}function s(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,u(r.key),r)}}function u(t){var e=function(t,e){if("object"!=a(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=a(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==a(e)?e:e+""}const c=function(){return t=function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.backend=e},(e=[{key:"createRenderPipeline",value:function(t,e){var n,r=t.object,i=t.material,a=t.geometry,s=t.pipeline,u=s.vertexProgram,c=s.fragmentProgram,l=this.backend,f=l.device,h=l.utils,p=l.get(s),d=l.get(t.getBindings()),m=l.attributeUtils.createShaderVertexBuffers(t);!0===i.transparent&&i.blending!==o.XIg&&(n=this._getBlending(i));var y={};!0===i.stencilWrite&&(y={compare:this._getStencilCompare(i),failOp:this._getStencilOperation(i.stencilFail),depthFailOp:this._getStencilOperation(i.stencilZFail),passOp:this._getStencilOperation(i.stencilZPass)});var v=this._getColorWriteMask(i),g=[];if(null!==t.context.textures)for(var b=t.context.textures,_=0;_<b.length;_++){var x=h.getTextureFormatGPU(b[_]);g.push({format:x,blend:n,writeMask:v})}else{var w=h.getCurrentColorFormat(t.context);g.push({format:w,blend:n,writeMask:v})}var S=l.get(u).module,T=l.get(c).module,M=this._getPrimitiveState(r,a,i),E=this._getDepthCompare(i),A=h.getCurrentDepthStencilFormat(t.context),O=h.getSampleCount(t.context);O>1&&2===(O=Math.pow(2,Math.floor(Math.log2(O))))&&(O=4);var P={vertex:Object.assign({},S,{buffers:m}),fragment:Object.assign({},T,{targets:g}),primitive:M,depthStencil:{format:A,depthWriteEnabled:i.depthWrite,depthCompare:E,stencilFront:y,stencilBack:{},stencilReadMask:i.stencilFuncMask,stencilWriteMask:i.stencilWriteMask},multisample:{count:O,alphaToCoverageEnabled:i.alphaToCoverage},layout:f.createPipelineLayout({bindGroupLayouts:[d.layout]})};if(null===e)p.pipeline=f.createRenderPipeline(P);else{var R=new Promise((function(t){f.createRenderPipelineAsync(P).then((function(e){p.pipeline=e,t()}))}));e.push(R)}}},{key:"createComputePipeline",value:function(t,e){var n=this.backend,r=n.device,i=n.get(t.computeProgram).module,o=n.get(t),a=n.get(e);o.pipeline=r.createComputePipeline({compute:i,layout:r.createPipelineLayout({bindGroupLayouts:[a.layout]})})}},{key:"_getBlending",value:function(t){var e,n,r=t.blending;if(r===o.bCz){var a=null!==t.blendSrcAlpha?t.blendSrcAlpha:i.tn.One,s=null!==t.blendDstAlpha?t.blendDstAlpha:i.tn.Zero,u=null!==t.blendEquationAlpha?t.blendEquationAlpha:i.tn.Add;e={srcFactor:this._getBlendFactor(t.blendSrc),dstFactor:this._getBlendFactor(t.blendDst),operation:this._getBlendOperation(t.blendEquation)},n={srcFactor:this._getBlendFactor(a),dstFactor:this._getBlendFactor(s),operation:this._getBlendOperation(u)}}else{var c=function(t,r,o,a){e={srcFactor:t,dstFactor:r,operation:i.zx.Add},n={srcFactor:o,dstFactor:a,operation:i.zx.Add}};if(t.premultipliedAlpha)switch(r){case o.NTi:c(i.tn.SrcAlpha,i.tn.OneMinusSrcAlpha,i.tn.One,i.tn.OneMinusSrcAlpha);break;case o.EZo:c(i.tn.SrcAlpha,i.tn.One,i.tn.One,i.tn.One);break;case o.Kwu:c(i.tn.Zero,i.tn.OneMinusSrc,i.tn.Zero,i.tn.One);break;case o.EdD:c(i.tn.Zero,i.tn.Src,i.tn.Zero,i.tn.SrcAlpha)}else switch(r){case o.NTi:c(i.tn.SrcAlpha,i.tn.OneMinusSrcAlpha,i.tn.One,i.tn.OneMinusSrcAlpha);break;case o.EZo:c(i.tn.SrcAlpha,i.tn.One,i.tn.SrcAlpha,i.tn.One);break;case o.Kwu:c(i.tn.Zero,i.tn.OneMinusSrc,i.tn.Zero,i.tn.One);break;case o.EdD:c(i.tn.Zero,i.tn.Src,i.tn.Zero,i.tn.Src)}}if(void 0!==e&&void 0!==n)return{color:e,alpha:n};console.error("THREE.WebGPURenderer: Invalid blending: ",r)}},{key:"_getBlendFactor",value:function(t){var e;switch(t){case o.ojh:e=i.tn.Zero;break;case o.qad:e=i.tn.One;break;case o.f4X:e=i.tn.Src;break;case o.LiQ:e=i.tn.OneMinusSrc;break;case o.ie2:e=i.tn.SrcAlpha;break;case o.OuU:e=i.tn.OneMinusSrcAlpha;break;case o.wn6:e=i.tn.Dst;break;case o.aEY:e=i.tn.OneMinusDstColor;break;case o.hdd:e=i.tn.DstAlpha;break;case o.Nt7:e=i.tn.OneMinusDstAlpha;break;case o.hgQ:e=i.tn.SrcAlphaSaturated;break;case r.sD:e=i.tn.Constant;break;case r.eI:e=i.tn.OneMinusConstant;break;default:console.error("THREE.WebGPURenderer: Blend factor not supported.",t)}return e}},{key:"_getStencilCompare",value:function(t){var e,n=t.stencilFunc;switch(n){case o.HPb:e=i.ML.Never;break;case o.sKt:e=i.ML.Always;break;case o.kYr:e=i.ML.Less;break;case o.CR7:e=i.ML.LessEqual;break;case o.jsO:e=i.ML.Equal;break;case o.TMh:e=i.ML.GreaterEqual;break;case o.RcT:e=i.ML.Greater;break;case o.klZ:e=i.ML.NotEqual;break;default:console.error("THREE.WebGPURenderer: Invalid stencil function.",n)}return e}},{key:"_getStencilOperation",value:function(t){var e;switch(t){case o.VVr:e=i.uA.Keep;break;case o.kqe:e=i.uA.Zero;break;case o.kG0:e=i.uA.Replace;break;case o.oVO:e=i.uA.Invert;break;case o.HLH:e=i.uA.IncrementClamp;break;case o.ROr:e=i.uA.DecrementClamp;break;case o.Ru$:e=i.uA.IncrementWrap;break;case o.fJr:e=i.uA.DecrementWrap;break;default:console.error("THREE.WebGPURenderer: Invalid stencil operation.",e)}return e}},{key:"_getBlendOperation",value:function(t){var e;switch(t){case o.gO9:e=i.zx.Add;break;case o.FXf:e=i.zx.Subtract;break;case o.nST:e=i.zx.ReverseSubtract;break;case o.znC:e=i.zx.Min;break;case o.$ei:e=i.zx.Max;break;default:console.error("THREE.WebGPUPipelineUtils: Blend equation not supported.",t)}return e}},{key:"_getPrimitiveState",value:function(t,e,n){var r={},a=this.backend.utils;switch(r.topology=a.getPrimitiveTopology(t,n),null!==e.index&&!0===t.isLine&&!0!==t.isLineSegments&&(r.stripIndexFormat=e.index.array instanceof Uint16Array?i.m4.Uint16:i.m4.Uint32),n.side){case o.hB5:r.frontFace=i.n1.CCW,r.cullMode=i.K7.Back;break;case o.hsX:r.frontFace=i.n1.CCW,r.cullMode=i.K7.Front;break;case o.$EB:r.frontFace=i.n1.CCW,r.cullMode=i.K7.None;break;default:console.error("THREE.WebGPUPipelineUtils: Unknown material.side value.",n.side)}return r}},{key:"_getColorWriteMask",value:function(t){return!0===t.colorWrite?i.g_.All:i.g_.None}},{key:"_getDepthCompare",value:function(t){var e;if(!1===t.depthTest)e=i.ML.Always;else{var n=t.depthFunc;switch(n){case o.eHc:e=i.ML.Never;break;case o.lGu:e=i.ML.Always;break;case o.brA:e=i.ML.Less;break;case o.xSv:e=i.ML.LessEqual;break;case o.U3G:e=i.ML.Equal;break;case o.Gwm:e=i.ML.GreaterEqual;break;case o.K52:e=i.ML.Greater;break;case o.bw0:e=i.ML.NotEqual;break;default:console.error("THREE.WebGPUPipelineUtils: Invalid depth function.",n)}}return e}}])&&s(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}()},7047:(t,e,n)=>{n.d(e,{A:()=>g,g:()=>v});var r=n(1367),i=n(554);function o(t){return o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},o(t)}function a(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,s(r.key),r)}}function s(t){var e=function(t,e){if("object"!=o(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=o(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==o(e)?e:e+""}const u=function(){return t=function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.device=e,this.mipmapSampler=e.createSampler({minFilter:r.a4.Linear}),this.flipYSampler=e.createSampler({minFilter:r.a4.Nearest}),this.transferPipelines={},this.flipYPipelines={},this.mipmapVertexShaderModule=e.createShaderModule({label:"mipmapVertex",code:"\nstruct VarysStruct {\n\t@builtin( position ) Position: vec4<f32>,\n\t@location( 0 ) vTex : vec2<f32>\n};\n\n@vertex\nfn main( @builtin( vertex_index ) vertexIndex : u32 ) -> VarysStruct {\n\n\tvar Varys : VarysStruct;\n\n\tvar pos = array< vec2<f32>, 4 >(\n\t\tvec2<f32>( -1.0,  1.0 ),\n\t\tvec2<f32>(  1.0,  1.0 ),\n\t\tvec2<f32>( -1.0, -1.0 ),\n\t\tvec2<f32>(  1.0, -1.0 )\n\t);\n\n\tvar tex = array< vec2<f32>, 4 >(\n\t\tvec2<f32>( 0.0, 0.0 ),\n\t\tvec2<f32>( 1.0, 0.0 ),\n\t\tvec2<f32>( 0.0, 1.0 ),\n\t\tvec2<f32>( 1.0, 1.0 )\n\t);\n\n\tVarys.vTex = tex[ vertexIndex ];\n\tVarys.Position = vec4<f32>( pos[ vertexIndex ], 0.0, 1.0 );\n\n\treturn Varys;\n\n}\n"}),this.mipmapFragmentShaderModule=e.createShaderModule({label:"mipmapFragment",code:"\n@group( 0 ) @binding( 0 )\nvar imgSampler : sampler;\n\n@group( 0 ) @binding( 1 )\nvar img : texture_2d<f32>;\n\n@fragment\nfn main( @location( 0 ) vTex : vec2<f32> ) -> @location( 0 ) vec4<f32> {\n\n\treturn textureSample( img, imgSampler, vTex );\n\n}\n"}),this.flipYFragmentShaderModule=e.createShaderModule({label:"flipYFragment",code:"\n@group( 0 ) @binding( 0 )\nvar imgSampler : sampler;\n\n@group( 0 ) @binding( 1 )\nvar img : texture_2d<f32>;\n\n@fragment\nfn main( @location( 0 ) vTex : vec2<f32> ) -> @location( 0 ) vec4<f32> {\n\n\treturn textureSample( img, imgSampler, vec2( vTex.x, 1.0 - vTex.y ) );\n\n}\n"})},e=[{key:"getTransferPipeline",value:function(t){var e=this.transferPipelines[t];return void 0===e&&(e=this.device.createRenderPipeline({vertex:{module:this.mipmapVertexShaderModule,entryPoint:"main"},fragment:{module:this.mipmapFragmentShaderModule,entryPoint:"main",targets:[{format:t}]},primitive:{topology:r.nU.TriangleStrip,stripIndexFormat:r.m4.Uint32},layout:"auto"}),this.transferPipelines[t]=e),e}},{key:"getFlipYPipeline",value:function(t){var e=this.flipYPipelines[t];return void 0===e&&(e=this.device.createRenderPipeline({vertex:{module:this.mipmapVertexShaderModule,entryPoint:"main"},fragment:{module:this.flipYFragmentShaderModule,entryPoint:"main",targets:[{format:t}]},primitive:{topology:r.nU.TriangleStrip,stripIndexFormat:r.m4.Uint32},layout:"auto"}),this.flipYPipelines[t]=e),e}},{key:"flipY",value:function(t,e){var n=this,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=e.format,a=e.size,s=a.width,u=a.height,c=this.getTransferPipeline(o),l=this.getFlipYPipeline(o),f=this.device.createTexture({size:{width:s,height:u,depthOrArrayLayers:1},format:o,usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.TEXTURE_BINDING}),h=t.createView({baseMipLevel:0,mipLevelCount:1,dimension:r.D2.TwoD,baseArrayLayer:i}),p=f.createView({baseMipLevel:0,mipLevelCount:1,dimension:r.D2.TwoD,baseArrayLayer:0}),d=this.device.createCommandEncoder({}),m=function(t,e,i){var o=t.getBindGroupLayout(0),a=n.device.createBindGroup({layout:o,entries:[{binding:0,resource:n.flipYSampler},{binding:1,resource:e}]}),s=d.beginRenderPass({colorAttachments:[{view:i,loadOp:r.mP.Clear,storeOp:r.pY.Store,clearValue:[0,0,0,0]}]});s.setPipeline(t),s.setBindGroup(0,a),s.draw(4,1,0,0),s.end()};m(c,h,p),m(l,p,h),this.device.queue.submit([d.finish()]),f.destroy()}},{key:"generateMipmaps",value:function(t,e){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=this.getTransferPipeline(e.format),o=this.device.createCommandEncoder({}),a=i.getBindGroupLayout(0),s=t.createView({baseMipLevel:0,mipLevelCount:1,dimension:r.D2.TwoD,baseArrayLayer:n}),u=1;u<e.mipLevelCount;u++){var c=this.device.createBindGroup({layout:a,entries:[{binding:0,resource:this.mipmapSampler},{binding:1,resource:s}]}),l=t.createView({baseMipLevel:u,mipLevelCount:1,dimension:r.D2.TwoD,baseArrayLayer:n}),f=o.beginRenderPass({colorAttachments:[{view:l,loadOp:r.mP.Clear,storeOp:r.pY.Store,clearValue:[0,0,0,0]}]});f.setPipeline(i),f.setBindGroup(0,c),f.draw(4,1,0,0),f.end(),s=l}this.device.queue.submit([o.finish()])}}],e&&a(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();function c(t){return c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},c(t)}function l(){l=function(){return e};var t,e={},n=Object.prototype,r=n.hasOwnProperty,i=Object.defineProperty||function(t,e,n){t[e]=n.value},o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",s=o.asyncIterator||"@@asyncIterator",u=o.toStringTag||"@@toStringTag";function f(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{f({},"")}catch(t){f=function(t,e,n){return t[e]=n}}function h(t,e,n,r){var o=e&&e.prototype instanceof b?e:b,a=Object.create(o.prototype),s=new C(r||[]);return i(a,"_invoke",{value:O(t,n,s)}),a}function p(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}e.wrap=h;var d="suspendedStart",m="suspendedYield",y="executing",v="completed",g={};function b(){}function _(){}function x(){}var w={};f(w,a,(function(){return this}));var S=Object.getPrototypeOf,T=S&&S(S(N([])));T&&T!==n&&r.call(T,a)&&(w=T);var M=x.prototype=b.prototype=Object.create(w);function E(t){["next","throw","return"].forEach((function(e){f(t,e,(function(t){return this._invoke(e,t)}))}))}function A(t,e){function n(i,o,a,s){var u=p(t[i],t,o);if("throw"!==u.type){var l=u.arg,f=l.value;return f&&"object"==c(f)&&r.call(f,"__await")?e.resolve(f.__await).then((function(t){n("next",t,a,s)}),(function(t){n("throw",t,a,s)})):e.resolve(f).then((function(t){l.value=t,a(l)}),(function(t){return n("throw",t,a,s)}))}s(u.arg)}var o;i(this,"_invoke",{value:function(t,r){function i(){return new e((function(e,i){n(t,r,e,i)}))}return o=o?o.then(i,i):i()}})}function O(e,n,r){var i=d;return function(o,a){if(i===y)throw Error("Generator is already running");if(i===v){if("throw"===o)throw a;return{value:t,done:!0}}for(r.method=o,r.arg=a;;){var s=r.delegate;if(s){var u=P(s,r);if(u){if(u===g)continue;return u}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(i===d)throw i=v,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);i=y;var c=p(e,n,r);if("normal"===c.type){if(i=r.done?v:m,c.arg===g)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(i=v,r.method="throw",r.arg=c.arg)}}}function P(e,n){var r=n.method,i=e.iterator[r];if(i===t)return n.delegate=null,"throw"===r&&e.iterator.return&&(n.method="return",n.arg=t,P(e,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),g;var o=p(i,e.iterator,n.arg);if("throw"===o.type)return n.method="throw",n.arg=o.arg,n.delegate=null,g;var a=o.arg;return a?a.done?(n[e.resultName]=a.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,g):a:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,g)}function R(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function k(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function C(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(R,this),this.reset(!0)}function N(e){if(e||""===e){var n=e[a];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,o=function n(){for(;++i<e.length;)if(r.call(e,i))return n.value=e[i],n.done=!1,n;return n.value=t,n.done=!0,n};return o.next=o}}throw new TypeError(c(e)+" is not iterable")}return _.prototype=x,i(M,"constructor",{value:x,configurable:!0}),i(x,"constructor",{value:_,configurable:!0}),_.displayName=f(x,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===_||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,x):(t.__proto__=x,f(t,u,"GeneratorFunction")),t.prototype=Object.create(M),t},e.awrap=function(t){return{__await:t}},E(A.prototype),f(A.prototype,s,(function(){return this})),e.AsyncIterator=A,e.async=function(t,n,r,i,o){void 0===o&&(o=Promise);var a=new A(h(t,n,r,i),o);return e.isGeneratorFunction(n)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},E(M),f(M,u,"Generator"),f(M,a,(function(){return this})),f(M,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),n=[];for(var r in e)n.push(r);return n.reverse(),function t(){for(;n.length;){var r=n.pop();if(r in e)return t.value=r,t.done=!1,t}return t.done=!0,t}},e.values=N,C.prototype={constructor:C,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(k),!e)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function i(r,i){return s.type="throw",s.arg=e,n.next=r,i&&(n.method="next",n.arg=t),!!i}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],s=a.completion;if("root"===a.tryLoc)return i("end");if(a.tryLoc<=this.prev){var u=r.call(a,"catchLoc"),c=r.call(a,"finallyLoc");if(u&&c){if(this.prev<a.catchLoc)return i(a.catchLoc,!0);if(this.prev<a.finallyLoc)return i(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return i(a.catchLoc,!0)}else{if(!c)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return i(a.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=t,a.arg=e,o?(this.method="next",this.next=o.finallyLoc,g):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),g},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),k(n),g}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var i=r.arg;k(n)}return i}}throw Error("illegal catch attempt")},delegateYield:function(e,n,r){return this.delegate={iterator:N(e),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=t),g}},e}function f(t,e,n,r,i,o,a){try{var s=t[o](a),u=s.value}catch(t){return void n(t)}s.done?e(u):Promise.resolve(u).then(r,i)}function h(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,d(r.key),r)}}function p(t,e,n){return(e=d(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function d(t){var e=function(t,e){if("object"!=c(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=c(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==c(e)?e:e+""}var m=p(p(p(p(p(p(p(p({},i.amv,"never"),i.vim,"less"),i.kO0,"equal"),i.TiK,"less-equal"),i.eoi,"greater"),i.gWB,"greater-equal"),i.FFZ,"always"),i.jzd,"not-equal"),y=[0,1,3,2,4,5];function v(t){var e,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o=t.format,a=t.type,s=t.colorSpace;if(!0===t.isFramebufferTexture&&t.type===i.OUM)e=r.LG.BGRA8Unorm;else if(!0===t.isCompressedTexture)switch(o){case i.Nz6:e=s===i.er$?r.LG.BC1RGBAUnormSRGB:r.LG.BC1RGBAUnorm;break;case i.jR7:e=s===i.er$?r.LG.BC2RGBAUnormSRGB:r.LG.BC2RGBAUnorm;break;case i.BXX:e=s===i.er$?r.LG.BC3RGBAUnormSRGB:r.LG.BC3RGBAUnorm;break;case i.Riy:e=s===i.er$?r.LG.ETC2RGB8UnormSRGB:r.LG.ETC2RGB8Unorm;break;case i.KDk:e=s===i.er$?r.LG.ETC2RGBA8UnormSRGB:r.LG.ETC2RGBA8Unorm;break;case i.qa3:e=s===i.er$?r.LG.ASTC4x4UnormSRGB:r.LG.ASTC4x4Unorm;break;case i.B_h:e=s===i.er$?r.LG.ASTC5x4UnormSRGB:r.LG.ASTC5x4Unorm;break;case i.czI:e=s===i.er$?r.LG.ASTC5x5UnormSRGB:r.LG.ASTC5x5Unorm;break;case i.rSH:e=s===i.er$?r.LG.ASTC6x5UnormSRGB:r.LG.ASTC6x5Unorm;break;case i.Qrf:e=s===i.er$?r.LG.ASTC6x6UnormSRGB:r.LG.ASTC6x6Unorm;break;case i.psI:e=s===i.er$?r.LG.ASTC8x5UnormSRGB:r.LG.ASTC8x5Unorm;break;case i.a5J:e=s===i.er$?r.LG.ASTC8x6UnormSRGB:r.LG.ASTC8x6Unorm;break;case i._QJ:e=s===i.er$?r.LG.ASTC8x8UnormSRGB:r.LG.ASTC8x8Unorm;break;case i.uB5:e=s===i.er$?r.LG.ASTC10x5UnormSRGB:r.LG.ASTC10x5Unorm;break;case i.lyL:e=s===i.er$?r.LG.ASTC10x6UnormSRGB:r.LG.ASTC10x6Unorm;break;case i.bC7:e=s===i.er$?r.LG.ASTC10x8UnormSRGB:r.LG.ASTC10x8Unorm;break;case i.y3Z:e=s===i.er$?r.LG.ASTC10x10UnormSRGB:r.LG.ASTC10x10Unorm;break;case i.ojs:e=s===i.er$?r.LG.ASTC12x10UnormSRGB:r.LG.ASTC12x10Unorm;break;case i.S$4:e=s===i.er$?r.LG.ASTC12x12UnormSRGB:r.LG.ASTC12x12Unorm;break;default:console.error("WebGPURenderer: Unsupported texture format.",o)}else switch(o){case i.GWd:switch(a){case i.OUM:e=s===i.er$?r.LG.RGBA8UnormSRGB:r.LG.RGBA8Unorm;break;case i.ix0:e=r.LG.RGBA16Float;break;case i.RQf:e=r.LG.RGBA32Float;break;default:console.error("WebGPURenderer: Unsupported texture type with RGBAFormat.",a)}break;case i.HIg:a===i.Dmk?e=r.LG.RGB9E5UFloat:console.error("WebGPURenderer: Unsupported texture type with RGBFormat.",a);break;case i.VT0:switch(a){case i.OUM:e=r.LG.R8Unorm;break;case i.ix0:e=r.LG.R16Float;break;case i.RQf:e=r.LG.R32Float;break;default:console.error("WebGPURenderer: Unsupported texture type with RedFormat.",a)}break;case i.paN:switch(a){case i.OUM:e=r.LG.RG8Unorm;break;case i.ix0:e=r.LG.RG16Float;break;case i.RQf:e=r.LG.RG32Float;break;default:console.error("WebGPURenderer: Unsupported texture type with RGFormat.",a)}break;case i.zdS:switch(a){case i.cHt:e=r.LG.Depth16Unorm;break;case i.bkx:e=r.LG.Depth24Plus;break;case i.RQf:e=r.LG.Depth32Float;break;default:console.error("WebGPURenderer: Unsupported texture type with DepthFormat.",a)}break;case i.dcC:switch(a){case i.V3x:e=r.LG.Depth24PlusStencil8;break;case i.RQf:n&&!1===n.features.has(r.oc.Depth32FloatStencil8)&&console.error('WebGPURenderer: Depth textures with DepthStencilFormat + FloatType can only be used with the "depth32float-stencil8" GPU feature.'),e=r.LG.Depth32FloatStencil8;break;default:console.error("WebGPURenderer: Unsupported texture type with DepthStencilFormat.",a)}break;case i.ZQM:switch(a){case i.Yuy:e=r.LG.R32Sint;break;case i.bkx:e=r.LG.R32Uint;break;default:console.error("WebGPURenderer: Unsupported texture type with RedIntegerFormat.",a)}break;case i.TkQ:switch(a){case i.Yuy:e=r.LG.RG32Sint;break;case i.bkx:e=r.LG.RG32Uint;break;default:console.error("WebGPURenderer: Unsupported texture type with RGIntegerFormat.",a)}break;case i.c90:switch(a){case i.Yuy:e=r.LG.RGBA32Sint;break;case i.bkx:e=r.LG.RGBA32Uint;break;default:console.error("WebGPURenderer: Unsupported texture type with RGBAIntegerFormat.",a)}break;default:console.error("WebGPURenderer: Unsupported texture format.",o)}return e}const g=function(){return t=function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.backend=e,this._passUtils=null,this.defaultTexture={},this.defaultCubeTexture={},this.colorBuffer=null,this.depthTexture=new i.VCu,this.depthTexture.name="depthBuffer"},e=[{key:"createSampler",value:function(t){var e=this.backend,n=e.device,r=e.get(t),i={addressModeU:this._convertAddressMode(t.wrapS),addressModeV:this._convertAddressMode(t.wrapT),addressModeW:this._convertAddressMode(t.wrapR),magFilter:this._convertFilterMode(t.magFilter),minFilter:this._convertFilterMode(t.minFilter),mipmapFilter:this._convertFilterMode(t.minFilter),maxAnisotropy:t.anisotropy};t.isDepthTexture&&null!==t.compareFunction&&(i.compare=m[t.compareFunction]),r.sampler=n.createSampler(i)}},{key:"createDefaultTexture",value:function(t){var e,n=v(t);e=t.isCubeTexture?this._getDefaultCubeTextureGPU(n):this._getDefaultTextureGPU(n),this.backend.get(t).texture=e}},{key:"createTexture",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=this.backend,r=n.get(t);if(r.initialized)throw new Error("WebGPUTextureUtils: Texture already initialized.");void 0===e.needsMipmaps&&(e.needsMipmaps=!1),void 0===e.levels&&(e.levels=1),void 0===e.depth&&(e.depth=1);var i=e.width,o=e.height,a=e.depth,s=e.levels,u=this._getDimension(t),c=t.internalFormat||e.format||v(t,n.device),l=void 0!==e.sampleCount?e.sampleCount:1;l>1&&2===(l=Math.pow(2,Math.floor(Math.log2(l))))&&(l=4);var f=t.isRenderTargetTexture?1:l,h=GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.COPY_SRC;!0===t.isStorageTexture&&(h|=GPUTextureUsage.STORAGE_BINDING),!0!==t.isCompressedTexture&&(h|=GPUTextureUsage.RENDER_ATTACHMENT);var p={label:t.name,size:{width:i,height:o,depthOrArrayLayers:a},mipLevelCount:s,sampleCount:f,dimension:u,format:c,usage:h};if(t.isVideoTexture){var d=t.source.data,m=new VideoFrame(d);p.size.width=m.displayWidth,p.size.height=m.displayHeight,m.close(),r.externalTexture=d}else{if(void 0===c)return console.warn("WebGPURenderer: Texture format not supported."),this.createDefaultTexture(t);r.texture=n.device.createTexture(p)}if(t.isRenderTargetTexture&&l>1){var y=Object.assign({},p);y.label=y.label+"-msaa",y.sampleCount=l,r.msaaTexture=n.device.createTexture(y)}r.initialized=!0,r.textureDescriptorGPU=p}},{key:"destroyTexture",value:function(t){var e=this.backend,n=e.get(t);n.texture.destroy(),void 0!==n.msaaTexture&&n.msaaTexture.destroy(),e.delete(t)}},{key:"destroySampler",value:function(t){delete this.backend.get(t).sampler}},{key:"generateMipmaps",value:function(t){var e=this.backend.get(t);if(t.isCubeTexture)for(var n=0;n<6;n++)this._generateMipmaps(e.texture,e.textureDescriptorGPU,n);else this._generateMipmaps(e.texture,e.textureDescriptorGPU)}},{key:"getColorBuffer",value:function(){this.colorBuffer&&this.colorBuffer.destroy();var t=this.backend,e=t.getDrawingBufferSize(),n=e.width,i=e.height;return this.colorBuffer=t.device.createTexture({label:"colorBuffer",size:{width:n,height:i,depthOrArrayLayers:1},sampleCount:t.parameters.sampleCount,format:r.LG.BGRA8Unorm,usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_SRC}),this.colorBuffer}},{key:"getDepthBuffer",value:function(){var t,e,n=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=this.backend,a=o.getDrawingBufferSize(),s=a.width,u=a.height,c=this.depthTexture,l=o.get(c).texture;if(r?(t=i.dcC,e=i.V3x):n&&(t=i.zdS,e=i.bkx),void 0!==l){if(c.image.width===s&&c.image.height===u&&c.format===t&&c.type===e)return l;this.destroyTexture(c)}return c.name="depthBuffer",c.format=t,c.type=e,c.image.width=s,c.image.height=u,this.createTexture(c,{sampleCount:o.parameters.sampleCount,width:s,height:u}),o.get(c).texture}},{key:"updateTexture",value:function(t,e){var n=this.backend.get(t),r=n.textureDescriptorGPU;if(!t.isRenderTargetTexture&&void 0!==r){if(t.isDataTexture||t.isData3DTexture)this._copyBufferToTexture(e.image,n.texture,r,0,t.flipY);else if(t.isDataArrayTexture)for(var i=0;i<e.image.depth;i++)this._copyBufferToTexture(e.image,n.texture,r,i,t.flipY,i);else if(t.isCompressedTexture)this._copyCompressedBufferToTexture(t.mipmaps,n.texture,r);else if(t.isCubeTexture)this._copyCubeMapToTexture(e.images,n.texture,r,t.flipY);else if(t.isVideoTexture){var o=t.source.data;n.externalTexture=o}else this._copyImageToTexture(e.image,n.texture,r,0,t.flipY);n.version=t.version,t.onUpdate&&t.onUpdate(t)}}},{key:"copyTextureToBuffer",value:(n=l().mark((function t(e,n,r,i,o){var a,s,u,c,f,h,p,d,m,y;return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=this.backend.device,s=this.backend.get(e),u=s.texture,c=s.textureDescriptorGPU.format,f=this._getBytesPerTexel(c),h=i*f,h=256*Math.ceil(h/256),p=a.createBuffer({size:i*o*f,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ}),(d=a.createCommandEncoder()).copyTextureToBuffer({texture:u,origin:{x:n,y:r}},{buffer:p,bytesPerRow:h},{width:i,height:o}),m=this._getTypedArrayType(c),a.queue.submit([d.finish()]),t.next=14,p.mapAsync(GPUMapMode.READ);case 14:return y=p.getMappedRange(),t.abrupt("return",new m(y));case 16:case"end":return t.stop()}}),t,this)})),o=function(){var t=this,e=arguments;return new Promise((function(r,i){var o=n.apply(t,e);function a(t){f(o,r,i,a,s,"next",t)}function s(t){f(o,r,i,a,s,"throw",t)}a(void 0)}))},function(t,e,n,r,i){return o.apply(this,arguments)})},{key:"_isEnvironmentTexture",value:function(t){var e=t.mapping;return e===i.wfO||e===i.uV5||e===i.hy7||e===i.xFO}},{key:"_getDefaultTextureGPU",value:function(t){var e=this.defaultTexture[t];if(void 0===e){var n=new i.gPd;n.minFilter=i.hxR,n.magFilter=i.hxR,this.createTexture(n,{width:1,height:1,format:t}),this.defaultTexture[t]=e=n}return this.backend.get(e).texture}},{key:"_getDefaultCubeTextureGPU",value:function(t){var e=this.defaultTexture[t];if(void 0===e){var n=new i.b4q;n.minFilter=i.hxR,n.magFilter=i.hxR,this.createTexture(n,{width:1,height:1,depth:6}),this.defaultCubeTexture[t]=e=n}return this.backend.get(e).texture}},{key:"_copyCubeMapToTexture",value:function(t,e,n,r){for(var i=0;i<6;i++){var o=t[i],a=!0===r?y[i]:i;o.isDataTexture?this._copyBufferToTexture(o.image,e,n,a,r):this._copyImageToTexture(o,e,n,a,r)}}},{key:"_copyImageToTexture",value:function(t,e,n,r,i){this.backend.device.queue.copyExternalImageToTexture({source:t},{texture:e,mipLevel:0,origin:{x:0,y:0,z:r}},{width:t.width,height:t.height,depthOrArrayLayers:1}),!0===i&&this._flipY(e,n,r)}},{key:"_getPassUtils",value:function(){var t=this._passUtils;return null===t&&(this._passUtils=t=new u(this.backend.device)),t}},{key:"_generateMipmaps",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this._getPassUtils().generateMipmaps(t,e,n)}},{key:"_flipY",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this._getPassUtils().flipY(t,e,n)}},{key:"_copyBufferToTexture",value:function(t,e,n,r,i){var o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,a=this.backend.device,s=t.data,u=this._getBytesPerTexel(n.format),c=t.width*u;a.queue.writeTexture({texture:e,mipLevel:0,origin:{x:0,y:0,z:r}},s,{offset:t.width*t.height*u*o,bytesPerRow:c},{width:t.width,height:t.height,depthOrArrayLayers:1}),!0===i&&this._flipY(e,n,r)}},{key:"_copyCompressedBufferToTexture",value:function(t,e,n){for(var r=this.backend.device,i=this._getBlockData(n.format),o=0;o<t.length;o++){var a=t[o],s=a.width,u=a.height,c=Math.ceil(s/i.width)*i.byteLength;r.queue.writeTexture({texture:e,mipLevel:o},a.data,{offset:0,bytesPerRow:c},{width:Math.ceil(s/i.width)*i.width,height:Math.ceil(u/i.width)*i.width,depthOrArrayLayers:1})}}},{key:"_getBlockData",value:function(t){return t===r.LG.BC1RGBAUnorm||t===r.LG.BC1RGBAUnormSRGB?{byteLength:8,width:4,height:4}:t===r.LG.BC2RGBAUnorm||t===r.LG.BC2RGBAUnormSRGB||t===r.LG.BC3RGBAUnorm||t===r.LG.BC3RGBAUnormSRGB?{byteLength:16,width:4,height:4}:t===r.LG.BC4RUnorm||t===r.LG.BC4RSNorm?{byteLength:8,width:4,height:4}:t===r.LG.BC5RGUnorm||t===r.LG.BC5RGSnorm||t===r.LG.BC6HRGBUFloat||t===r.LG.BC6HRGBFloat||t===r.LG.BC7RGBAUnorm||t===r.LG.BC7RGBAUnormSRGB?{byteLength:16,width:4,height:4}:t===r.LG.ETC2RGB8Unorm||t===r.LG.ETC2RGB8UnormSRGB||t===r.LG.ETC2RGB8A1Unorm||t===r.LG.ETC2RGB8A1UnormSRGB?{byteLength:8,width:4,height:4}:t===r.LG.ETC2RGBA8Unorm||t===r.LG.ETC2RGBA8UnormSRGB?{byteLength:16,width:4,height:4}:t===r.LG.EACR11Unorm||t===r.LG.EACR11Snorm?{byteLength:8,width:4,height:4}:t===r.LG.EACRG11Unorm||t===r.LG.EACRG11Snorm||t===r.LG.ASTC4x4Unorm||t===r.LG.ASTC4x4UnormSRGB?{byteLength:16,width:4,height:4}:t===r.LG.ASTC5x4Unorm||t===r.LG.ASTC5x4UnormSRGB?{byteLength:16,width:5,height:4}:t===r.LG.ASTC5x5Unorm||t===r.LG.ASTC5x5UnormSRGB?{byteLength:16,width:5,height:5}:t===r.LG.ASTC6x5Unorm||t===r.LG.ASTC6x5UnormSRGB?{byteLength:16,width:6,height:5}:t===r.LG.ASTC6x6Unorm||t===r.LG.ASTC6x6UnormSRGB?{byteLength:16,width:6,height:6}:t===r.LG.ASTC8x5Unorm||t===r.LG.ASTC8x5UnormSRGB?{byteLength:16,width:8,height:5}:t===r.LG.ASTC8x6Unorm||t===r.LG.ASTC8x6UnormSRGB?{byteLength:16,width:8,height:6}:t===r.LG.ASTC8x8Unorm||t===r.LG.ASTC8x8UnormSRGB?{byteLength:16,width:8,height:8}:t===r.LG.ASTC10x5Unorm||t===r.LG.ASTC10x5UnormSRGB?{byteLength:16,width:10,height:5}:t===r.LG.ASTC10x6Unorm||t===r.LG.ASTC10x6UnormSRGB?{byteLength:16,width:10,height:6}:t===r.LG.ASTC10x8Unorm||t===r.LG.ASTC10x8UnormSRGB?{byteLength:16,width:10,height:8}:t===r.LG.ASTC10x10Unorm||t===r.LG.ASTC10x10UnormSRGB?{byteLength:16,width:10,height:10}:t===r.LG.ASTC12x10Unorm||t===r.LG.ASTC12x10UnormSRGB?{byteLength:16,width:12,height:10}:t===r.LG.ASTC12x12Unorm||t===r.LG.ASTC12x12UnormSRGB?{byteLength:16,width:12,height:12}:void 0}},{key:"_convertAddressMode",value:function(t){var e=r.m8.ClampToEdge;return t===i.GJx?e=r.m8.Repeat:t===i.kTW&&(e=r.m8.MirrorRepeat),e}},{key:"_convertFilterMode",value:function(t){var e=r.a4.Linear;return t!==i.hxR&&t!==i.pHI&&t!==i.Cfg||(e=r.a4.Nearest),e}},{key:"_getBytesPerTexel",value:function(t){return t===r.LG.R8Unorm||t===r.LG.R8Snorm||t===r.LG.R8Uint||t===r.LG.R8Sint?1:t===r.LG.R16Uint||t===r.LG.R16Sint||t===r.LG.R16Float||t===r.LG.RG8Unorm||t===r.LG.RG8Snorm||t===r.LG.RG8Uint||t===r.LG.RG8Sint?2:t===r.LG.R32Uint||t===r.LG.R32Sint||t===r.LG.R32Float||t===r.LG.RG16Uint||t===r.LG.RG16Sint||t===r.LG.RG16Float||t===r.LG.RGBA8Unorm||t===r.LG.RGBA8UnormSRGB||t===r.LG.RGBA8Snorm||t===r.LG.RGBA8Uint||t===r.LG.RGBA8Sint||t===r.LG.BGRA8Unorm||t===r.LG.BGRA8UnormSRGB||t===r.LG.RGB9E5UFloat||t===r.LG.RGB10A2Unorm||t===r.LG.RG11B10UFloat||t===r.LG.Depth32Float||t===r.LG.Depth24Plus||t===r.LG.Depth24PlusStencil8||t===r.LG.Depth32FloatStencil8?4:t===r.LG.RG32Uint||t===r.LG.RG32Sint||t===r.LG.RG32Float||t===r.LG.RGBA16Uint||t===r.LG.RGBA16Sint||t===r.LG.RGBA16Float?8:t===r.LG.RGBA32Uint||t===r.LG.RGBA32Sint||t===r.LG.RGBA32Float?16:void 0}},{key:"_getTypedArrayType",value:function(t){return t===r.LG.R8Uint?Uint8Array:t===r.LG.R8Sint?Int8Array:t===r.LG.R8Unorm?Uint8Array:t===r.LG.R8Snorm?Int8Array:t===r.LG.RG8Uint?Uint8Array:t===r.LG.RG8Sint?Int8Array:t===r.LG.RG8Unorm?Uint8Array:t===r.LG.RG8Snorm?Int8Array:t===r.LG.RGBA8Uint?Uint8Array:t===r.LG.RGBA8Sint?Int8Array:t===r.LG.RGBA8Unorm?Uint8Array:t===r.LG.RGBA8Snorm?Int8Array:t===r.LG.R16Uint?Uint16Array:t===r.LG.R16Sint?Int16Array:t===r.LG.RG16Uint?Uint16Array:t===r.LG.RG16Sint?Int16Array:t===r.LG.RGBA16Uint?Uint16Array:t===r.LG.RGBA16Sint?Int16Array:t===r.LG.R16Float||t===r.LG.RG16Float||t===r.LG.RGBA16Float?Float32Array:t===r.LG.R32Uint?Uint32Array:t===r.LG.R32Sint?Int32Array:t===r.LG.R32Float?Float32Array:t===r.LG.RG32Uint?Uint32Array:t===r.LG.RG32Sint?Int32Array:t===r.LG.RG32Float?Float32Array:t===r.LG.RGBA32Uint?Uint32Array:t===r.LG.RGBA32Sint?Int32Array:t===r.LG.RGBA32Float?Float32Array:t===r.LG.BGRA8Unorm||t===r.LG.BGRA8UnormSRGB?Uint8Array:t===r.LG.RGB10A2Unorm||t===r.LG.RGB9E5UFloat||t===r.LG.RG11B10UFloat?Uint32Array:t===r.LG.Depth32Float?Float32Array:t===r.LG.Depth24Plus||t===r.LG.Depth24PlusStencil8?Uint32Array:t===r.LG.Depth32FloatStencil8?Float32Array:void 0}},{key:"_getDimension",value:function(t){return t.isData3DTexture?r.Ml.ThreeD:r.Ml.TwoD}}],e&&h(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,n,o}()},1879:(t,e,n)=>{n.d(e,{A:()=>s});var r=n(1367);function i(t){return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},i(t)}function o(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,a(r.key),r)}}function a(t){var e=function(t,e){if("object"!=i(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=i(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==i(e)?e:e+""}const s=function(){return t=function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.backend=e},(e=[{key:"getCurrentDepthStencilFormat",value:function(t){var e;return null!==t.depthTexture?e=this.getTextureFormatGPU(t.depthTexture):t.depth&&t.stencil?e=r.LG.Depth24PlusStencil8:t.depth&&(e=r.LG.Depth24Plus),e}},{key:"getTextureFormatGPU",value:function(t){return this.backend.get(t).texture.format}},{key:"getCurrentColorFormat",value:function(t){return null!==t.textures?this.getTextureFormatGPU(t.textures[0]):r.LG.BGRA8Unorm}},{key:"getCurrentColorSpace",value:function(t){return null!==t.textures?t.textures[0].colorSpace:this.backend.renderer.outputColorSpace}},{key:"getPrimitiveTopology",value:function(t,e){return t.isPoints?r.nU.PointList:t.isLineSegments||t.isMesh&&!0===e.wireframe?r.nU.LineList:t.isLine?r.nU.LineStrip:t.isMesh?r.nU.TriangleList:void 0}},{key:"getSampleCount",value:function(t){return null!==t.textures?t.sampleCount:this.backend.parameters.sampleCount}}])&&o(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}()},985:(t,e,n)=>{n.r(e),n.d(e,{computeMikkTSpaceTangents:()=>i,computeMorphedAttributes:()=>d,deepCloneAttribute:()=>s,deinterleaveAttribute:()=>c,deinterleaveGeometry:()=>l,estimateBytesUsed:()=>f,interleaveAttributes:()=>u,mergeAttributes:()=>a,mergeGeometries:()=>o,mergeGroups:()=>m,mergeVertices:()=>h,toCreasedNormals:()=>y,toTrianglesDrawMode:()=>p});var r=n(554);function i(t,e){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(!e||!e.isReady)throw new Error("BufferGeometryUtils: Initialized MikkTSpace library required.");if(!t.hasAttribute("position")||!t.hasAttribute("normal")||!t.hasAttribute("uv"))throw new Error('BufferGeometryUtils: Tangents require "position", "normal", and "uv" attributes.');function i(t){if(t.normalized||t.isInterleavedBufferAttribute){for(var e=new Float32Array(t.count*t.itemSize),n=0,r=0;n<t.count;n++)e[r++]=t.getX(n),e[r++]=t.getY(n),t.itemSize>2&&(e[r++]=t.getZ(n));return e}return t.array instanceof Float32Array?t.array:new Float32Array(t.array)}var o=t.index?t.toNonIndexed():t,a=e.generateTangents(i(o.attributes.position),i(o.attributes.normal),i(o.attributes.uv));if(n)for(var s=3;s<a.length;s+=4)a[s]*=-1;return o.setAttribute("tangent",new r.THS(a,4)),t!==o&&t.copy(o),t}function o(t){for(var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=null!==t[0].index,i=new Set(Object.keys(t[0].attributes)),o=new Set(Object.keys(t[0].morphAttributes)),s={},u={},c=t[0].morphTargetsRelative,l=new r.LoY,f=0,h=0;h<t.length;++h){var p=t[h],d=0;if(n!==(null!==p.index))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+h+". All geometries must have compatible attributes; make sure index attribute exists among all geometries, or in none of them."),null;for(var m in p.attributes){if(!i.has(m))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+h+'. All geometries must have compatible attributes; make sure "'+m+'" attribute exists among all geometries, or in none of them.'),null;void 0===s[m]&&(s[m]=[]),s[m].push(p.attributes[m]),d++}if(d!==i.size)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+h+". Make sure all geometries have the same number of attributes."),null;if(c!==p.morphTargetsRelative)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+h+". .morphTargetsRelative must be consistent throughout all geometries."),null;for(var y in p.morphAttributes){if(!o.has(y))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+h+".  .morphAttributes must be consistent throughout all geometries."),null;void 0===u[y]&&(u[y]=[]),u[y].push(p.morphAttributes[y])}if(e){var v=void 0;if(n)v=p.index.count;else{if(void 0===p.attributes.position)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+h+". The geometry must have either an index or a position attribute"),null;v=p.attributes.position.count}l.addGroup(f,v,h),f+=v}}if(n){for(var g=0,b=[],_=0;_<t.length;++_){for(var x=t[_].index,w=0;w<x.count;++w)b.push(x.getX(w)+g);g+=t[_].attributes.position.count}l.setIndex(b)}for(var S in s){var T=a(s[S]);if(!T)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed while trying to merge the "+S+" attribute."),null;l.setAttribute(S,T)}for(var M in u){var E=u[M][0].length;if(0===E)break;l.morphAttributes=l.morphAttributes||{},l.morphAttributes[M]=[];for(var A=0;A<E;++A){for(var O=[],P=0;P<u[M].length;++P)O.push(u[M][P][A]);var R=a(O);if(!R)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed while trying to merge the "+M+" morphAttribute."),null;l.morphAttributes[M].push(R)}}return l}function a(t){for(var e,n,i,o=-1,a=0,s=0;s<t.length;++s){var u=t[s];if(void 0===e&&(e=u.array.constructor),e!==u.array.constructor)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.array must be of consistent array types across matching attributes."),null;if(void 0===n&&(n=u.itemSize),n!==u.itemSize)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.itemSize must be consistent across matching attributes."),null;if(void 0===i&&(i=u.normalized),i!==u.normalized)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.normalized must be consistent across matching attributes."),null;if(-1===o&&(o=u.gpuType),o!==u.gpuType)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.gpuType must be consistent across matching attributes."),null;a+=u.count*n}for(var c=new e(a),l=new r.THS(c,n,i),f=0,h=0;h<t.length;++h){var p=t[h];if(p.isInterleavedBufferAttribute)for(var d=f/n,m=0,y=p.count;m<y;m++)for(var v=0;v<n;v++){var g=p.getComponent(m,v);l.setComponent(m+d,v,g)}else c.set(p.array,f);f+=p.count*n}return void 0!==o&&(l.gpuType=o),l}function s(t){return t.isInstancedInterleavedBufferAttribute||t.isInterleavedBufferAttribute?c(t):t.isInstancedBufferAttribute?(new r.uWO).copy(t):(new r.THS).copy(t)}function u(t){for(var e,n=0,i=0,o=0,a=t.length;o<a;++o){var s=t[o];if(void 0===e&&(e=s.array.constructor),e!==s.array.constructor)return console.error("AttributeBuffers of different types cannot be interleaved"),null;n+=s.array.length,i+=s.itemSize}for(var u=new r.eB$(new e(n),i),c=0,l=[],f=["getX","getY","getZ","getW"],h=["setX","setY","setZ","setW"],p=0,d=t.length;p<d;p++){var m=t[p],y=m.itemSize,v=m.count,g=new r.eHs(u,y,c,m.normalized);l.push(g),c+=y;for(var b=0;b<v;b++)for(var _=0;_<y;_++)g[h[_]](b,m[f[_]](b))}return l}function c(t){var e,n=t.data.array.constructor,i=t.count,o=t.itemSize,a=t.normalized,s=new n(i*o);e=t.isInstancedInterleavedBufferAttribute?new r.uWO(s,o,a,t.meshPerAttribute):new r.THS(s,o,a);for(var u=0;u<i;u++)e.setX(u,t.getX(u)),o>=2&&e.setY(u,t.getY(u)),o>=3&&e.setZ(u,t.getZ(u)),o>=4&&e.setW(u,t.getW(u));return e}function l(t){var e=t.attributes,n=t.morphTargets,r=new Map;for(var i in e){var o=e[i];o.isInterleavedBufferAttribute&&(r.has(o)||r.set(o,c(o)),e[i]=r.get(o))}for(var a in n){var s=n[a];s.isInterleavedBufferAttribute&&(r.has(s)||r.set(s,c(s)),n[a]=r.get(s))}}function f(t){var e=0;for(var n in t.attributes){var r=t.getAttribute(n);e+=r.count*r.itemSize*r.array.BYTES_PER_ELEMENT}var i=t.getIndex();return e+(i?i.count*i.itemSize*i.array.BYTES_PER_ELEMENT:0)}function h(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e-4;e=Math.max(e,Number.EPSILON);for(var n={},i=t.getIndex(),o=t.getAttribute("position"),a=i?i.count:o.count,s=0,u=Object.keys(t.attributes),c={},l={},f=[],h=["getX","getY","getZ","getW"],p=["setX","setY","setZ","setW"],d=0,m=u.length;d<m;d++){var y=u[d],v=t.attributes[y];c[y]=new r.THS(new v.array.constructor(v.count*v.itemSize),v.itemSize,v.normalized);var g=t.morphAttributes[y];g&&(l[y]=new r.THS(new g.array.constructor(g.count*g.itemSize),g.itemSize,g.normalized))}for(var b=.5*e,_=Math.log10(1/e),x=Math.pow(10,_),w=b*x,S=0;S<a;S++){for(var T=i?i.getX(S):S,M="",E=0,A=u.length;E<A;E++)for(var O=u[E],P=t.getAttribute(O),R=P.itemSize,k=0;k<R;k++)M+="".concat(~~(P[h[k]](T)*x+w),",");if(M in n)f.push(n[M]);else{for(var C=0,N=u.length;C<N;C++)for(var L=u[C],j=t.getAttribute(L),I=t.morphAttributes[L],B=j.itemSize,U=c[L],D=l[L],F=0;F<B;F++){var z=h[F],V=p[F];if(U[V](s,j[z](T)),I)for(var G=0,H=I.length;G<H;G++)D[G][V](s,I[G][z](T))}n[M]=s,f.push(s),s++}}var W=t.clone();for(var q in t.attributes){var X=c[q];if(W.setAttribute(q,new r.THS(X.array.slice(0,s*X.itemSize),X.itemSize,X.normalized)),q in l)for(var Y=0;Y<l[q].length;Y++){var J=l[q][Y];W.morphAttributes[q][Y]=new r.THS(J.array.slice(0,s*J.itemSize),J.itemSize,J.normalized)}}return W.setIndex(f),W}function p(t,e){if(e===r.RJ4)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),t;if(e===r.rYR||e===r.O49){var n=t.getIndex();if(null===n){var i=[],o=t.getAttribute("position");if(void 0===o)return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),t;for(var a=0;a<o.count;a++)i.push(a);t.setIndex(i),n=t.getIndex()}var s=n.count-2,u=[];if(e===r.rYR)for(var c=1;c<=s;c++)u.push(n.getX(0)),u.push(n.getX(c)),u.push(n.getX(c+1));else for(var l=0;l<s;l++)l%2==0?(u.push(n.getX(l)),u.push(n.getX(l+1)),u.push(n.getX(l+2))):(u.push(n.getX(l+2)),u.push(n.getX(l+1)),u.push(n.getX(l)));u.length/3!==s&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");var f=t.clone();return f.setIndex(u),f.clearGroups(),f}return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",e),t}function d(t){var e=new r.Pq0,n=new r.Pq0,i=new r.Pq0,o=new r.Pq0,a=new r.Pq0,s=new r.Pq0,u=new r.Pq0,c=new r.Pq0,l=new r.Pq0;function f(t,r,f,h,p,d,m,y){e.fromBufferAttribute(r,p),n.fromBufferAttribute(r,d),i.fromBufferAttribute(r,m);var v=t.morphTargetInfluences;if(f&&v){u.set(0,0,0),c.set(0,0,0),l.set(0,0,0);for(var g=0,b=f.length;g<b;g++){var _=v[g],x=f[g];0!==_&&(o.fromBufferAttribute(x,p),a.fromBufferAttribute(x,d),s.fromBufferAttribute(x,m),h?(u.addScaledVector(o,_),c.addScaledVector(a,_),l.addScaledVector(s,_)):(u.addScaledVector(o.sub(e),_),c.addScaledVector(a.sub(n),_),l.addScaledVector(s.sub(i),_)))}e.add(u),n.add(c),i.add(l)}t.isSkinnedMesh&&(t.applyBoneTransform(p,e),t.applyBoneTransform(d,n),t.applyBoneTransform(m,i)),y[3*p+0]=e.x,y[3*p+1]=e.y,y[3*p+2]=e.z,y[3*d+0]=n.x,y[3*d+1]=n.y,y[3*d+2]=n.z,y[3*m+0]=i.x,y[3*m+1]=i.y,y[3*m+2]=i.z}var h,p,d,m,y,v,g,b,_=t.geometry,x=t.material,w=_.index,S=_.attributes.position,T=_.morphAttributes.position,M=_.morphTargetsRelative,E=_.attributes.normal,A=_.morphAttributes.position,O=_.groups,P=_.drawRange,R=new Float32Array(S.count*S.itemSize),k=new Float32Array(E.count*E.itemSize);if(null!==w)if(Array.isArray(x))for(m=0,v=O.length;m<v;m++)for(b=O[m],y=Math.max(b.start,P.start),g=Math.min(b.start+b.count,P.start+P.count);y<g;y+=3)f(t,S,T,M,h=w.getX(y),p=w.getX(y+1),d=w.getX(y+2),R),f(t,E,A,M,h,p,d,k);else for(m=Math.max(0,P.start),v=Math.min(w.count,P.start+P.count);m<v;m+=3)f(t,S,T,M,h=w.getX(m),p=w.getX(m+1),d=w.getX(m+2),R),f(t,E,A,M,h,p,d,k);else if(Array.isArray(x))for(m=0,v=O.length;m<v;m++)for(b=O[m],y=Math.max(b.start,P.start),g=Math.min(b.start+b.count,P.start+P.count);y<g;y+=3)f(t,S,T,M,h=y,p=y+1,d=y+2,R),f(t,E,A,M,h,p,d,k);else for(m=Math.max(0,P.start),v=Math.min(S.count,P.start+P.count);m<v;m+=3)f(t,S,T,M,h=m,p=m+1,d=m+2,R),f(t,E,A,M,h,p,d,k);return{positionAttribute:S,normalAttribute:E,morphedPositionAttribute:new r.qtW(R,3),morphedNormalAttribute:new r.qtW(k,3)}}function m(t){if(0===t.groups.length)return console.warn("THREE.BufferGeometryUtils.mergeGroups(): No groups are defined. Nothing to merge."),t;var e=t.groups;if(e=e.sort((function(t,e){return t.materialIndex!==e.materialIndex?t.materialIndex-e.materialIndex:t.start-e.start})),null===t.getIndex()){for(var n=t.getAttribute("position"),r=[],i=0;i<n.count;i+=3)r.push(i,i+1,i+2);t.setIndex(r)}for(var o=t.getIndex(),a=[],s=0;s<e.length;s++)for(var u=e[s],c=u.start,l=c+u.count,f=c;f<l;f++)a.push(o.getX(f));t.dispose(),t.setIndex(a);for(var h=0,p=0;p<e.length;p++){var d=e[p];d.start=h,h+=d.count}var m=e[0];t.groups=[m];for(var y=1;y<e.length;y++){var v=e[y];m.materialIndex===v.materialIndex?m.count+=v.count:(m=v,t.groups.push(m))}return t}function y(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/3,n=Math.cos(e),i=100*(1+1e-10),o=[new r.Pq0,new r.Pq0,new r.Pq0],a=new r.Pq0,s=new r.Pq0,u=new r.Pq0,c=new r.Pq0;function l(t){var e=~~(t.x*i),n=~~(t.y*i),r=~~(t.z*i);return"".concat(e,",").concat(n,",").concat(r)}for(var f=t.index?t.toNonIndexed():t,h=f.attributes.position,p={},d=0,m=h.count/3;d<m;d++){var y=3*d,v=o[0].fromBufferAttribute(h,y+0),g=o[1].fromBufferAttribute(h,y+1),b=o[2].fromBufferAttribute(h,y+2);a.subVectors(b,g),s.subVectors(v,g);for(var _=(new r.Pq0).crossVectors(a,s).normalize(),x=0;x<3;x++){var w=l(o[x]);w in p||(p[w]=[]),p[w].push(_)}}for(var S=new Float32Array(3*h.count),T=new r.THS(S,3,!1),M=0,E=h.count/3;M<E;M++){var A=3*M,O=o[0].fromBufferAttribute(h,A+0),P=o[1].fromBufferAttribute(h,A+1),R=o[2].fromBufferAttribute(h,A+2);a.subVectors(R,P),s.subVectors(O,P),u.crossVectors(a,s).normalize();for(var k=0;k<3;k++){var C=p[l(o[k])];c.set(0,0,0);for(var N=0,L=C.length;N<L;N++){var j=C[N];u.dot(j)>n&&c.add(j)}c.normalize(),T.setXYZ(A+k,c.x,c.y,c.z)}}return f.setAttribute("normal",T),f}}},s={};function u(t){var e=s[t];if(void 0!==e){if(void 0!==e.error)throw e.error;return e.exports}var n=s[t]={id:t,exports:{}};try{var r={id:t,module:n,factory:a[t],require:u};u.i.forEach((function(t){t(r)})),n=r.module,r.factory.call(n.exports,n,n.exports,r.require)}catch(t){throw n.error=t,t}return n.exports}return u.m=a,u.c=s,u.i=[],t="function"==typeof Symbol?Symbol("webpack queues"):"__webpack_queues__",e="function"==typeof Symbol?Symbol("webpack exports"):"__webpack_exports__",n="function"==typeof Symbol?Symbol("webpack error"):"__webpack_error__",r=t=>{t&&t.d<1&&(t.d=1,t.forEach((t=>t.r--)),t.forEach((t=>t.r--?t.r++:t())))},u.a=(i,o,a)=>{var s;a&&((s=[]).d=-1);var u,c,l,f=new Set,h=i.exports,p=new Promise(((t,e)=>{l=e,c=t}));p[e]=h,p[t]=t=>(s&&t(s),f.forEach(t),p.catch((t=>{}))),i.exports=p,o((i=>{var o;u=(i=>i.map((i=>{if(null!==i&&"object"==typeof i){if(i[t])return i;if(i.then){var o=[];o.d=0,i.then((t=>{a[e]=t,r(o)}),(t=>{a[n]=t,r(o)}));var a={};return a[t]=t=>t(o),a}}var s={};return s[t]=t=>{},s[e]=i,s})))(i);var a=()=>u.map((t=>{if(t[n])throw t[n];return t[e]})),c=new Promise((e=>{(o=()=>e(a)).r=0;var n=t=>t!==s&&!f.has(t)&&(f.add(t),t&&!t.d&&(o.r++,t.push(o)));u.map((e=>e[t](n)))}));return o.r?c:a()}),(t=>(t?l(p[n]=t):c(h),r(s)))),s&&s.d<0&&(s.d=0)},u.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return u.d(e,{a:e}),e},u.d=(t,e)=>{for(var n in e)u.o(e,n)&&!u.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},u.hu=t=>t+"."+u.h()+".hot-update.js",u.hmrF=()=>"mikaTV."+u.h()+".hot-update.json",u.h=()=>"a23f95859e8071018cf0",u.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),u.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),i={},o="_kuroMi:",u.l=(t,e,n,r)=>{if(i[t])i[t].push(e);else{var a,s;if(void 0!==n)for(var c=document.getElementsByTagName("script"),l=0;l<c.length;l++){var f=c[l];if(f.getAttribute("src")==t||f.getAttribute("data-webpack")==o+n){a=f;break}}a||(s=!0,(a=document.createElement("script")).charset="utf-8",a.timeout=120,u.nc&&a.setAttribute("nonce",u.nc),a.setAttribute("data-webpack",o+n),a.src=t),i[t]=[e];var h=(e,n)=>{a.onerror=a.onload=null,clearTimeout(p);var r=i[t];if(delete i[t],a.parentNode&&a.parentNode.removeChild(a),r&&r.forEach((t=>t(n))),e)return e(n)},p=setTimeout(h.bind(null,void 0,{type:"timeout",target:a}),12e4);a.onerror=h.bind(null,a.onerror),a.onload=h.bind(null,a.onload),s&&document.head.appendChild(a)}},u.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},(()=>{var t,e,n,r={},i=u.c,o=[],a=[],s="idle",c=0,l=[];function f(t){s=t;for(var e=[],n=0;n<a.length;n++)e[n]=a[n].call(null,t);return Promise.all(e).then((function(){}))}function h(){0==--c&&f("ready").then((function(){if(0===c){var t=l;l=[];for(var e=0;e<t.length;e++)t[e]()}}))}function p(t){if("idle"!==s)throw new Error("check() is only allowed in idle status");return f("check").then(u.hmrM).then((function(n){return n?f("prepare").then((function(){var r=[];return e=[],Promise.all(Object.keys(u.hmrC).reduce((function(t,i){return u.hmrC[i](n.c,n.r,n.m,t,e,r),t}),[])).then((function(){return e=function(){return t?m(t):f("ready").then((function(){return r}))},0===c?e():new Promise((function(t){l.push((function(){t(e())}))}));var e}))})):f(y()?"ready":"idle").then((function(){return null}))}))}function d(t){return"ready"!==s?Promise.resolve().then((function(){throw new Error("apply() is only allowed in ready status (state: "+s+")")})):m(t)}function m(t){t=t||{},y();var r=e.map((function(e){return e(t)}));e=void 0;var i=r.map((function(t){return t.error})).filter(Boolean);if(i.length>0)return f("abort").then((function(){throw i[0]}));var o=f("dispose");r.forEach((function(t){t.dispose&&t.dispose()}));var a,s=f("apply"),u=function(t){a||(a=t)},c=[];return r.forEach((function(t){if(t.apply){var e=t.apply(u);if(e)for(var n=0;n<e.length;n++)c.push(e[n])}})),Promise.all([o,s]).then((function(){return a?f("fail").then((function(){throw a})):n?m(t).then((function(t){return c.forEach((function(e){t.indexOf(e)<0&&t.push(e)})),t})):f("idle").then((function(){return c}))}))}function y(){if(n)return e||(e=[]),Object.keys(u.hmrI).forEach((function(t){n.forEach((function(n){u.hmrI[t](n,e)}))})),n=void 0,!0}u.hmrD=r,u.i.push((function(l){var m,y,v,g,b=l.module,_=function(e,n){var r=i[n];if(!r)return e;var a=function(a){if(r.hot.active){if(i[a]){var s=i[a].parents;-1===s.indexOf(n)&&s.push(n)}else o=[n],t=a;-1===r.children.indexOf(a)&&r.children.push(a)}else console.warn("[HMR] unexpected require("+a+") from disposed module "+n),o=[];return e(a)},u=function(t){return{configurable:!0,enumerable:!0,get:function(){return e[t]},set:function(n){e[t]=n}}};for(var l in e)Object.prototype.hasOwnProperty.call(e,l)&&"e"!==l&&Object.defineProperty(a,l,u(l));return a.e=function(t,n){return function(t){switch(s){case"ready":f("prepare");case"prepare":return c++,t.then(h,h),t;default:return t}}(e.e(t,n))},a}(l.require,l.id);b.hot=(m=l.id,y=b,g={_acceptedDependencies:{},_acceptedErrorHandlers:{},_declinedDependencies:{},_selfAccepted:!1,_selfDeclined:!1,_selfInvalidated:!1,_disposeHandlers:[],_main:v=t!==m,_requireSelf:function(){o=y.parents.slice(),t=v?void 0:m,u(m)},active:!0,accept:function(t,e,n){if(void 0===t)g._selfAccepted=!0;else if("function"==typeof t)g._selfAccepted=t;else if("object"==typeof t&&null!==t)for(var r=0;r<t.length;r++)g._acceptedDependencies[t[r]]=e||function(){},g._acceptedErrorHandlers[t[r]]=n;else g._acceptedDependencies[t]=e||function(){},g._acceptedErrorHandlers[t]=n},decline:function(t){if(void 0===t)g._selfDeclined=!0;else if("object"==typeof t&&null!==t)for(var e=0;e<t.length;e++)g._declinedDependencies[t[e]]=!0;else g._declinedDependencies[t]=!0},dispose:function(t){g._disposeHandlers.push(t)},addDisposeHandler:function(t){g._disposeHandlers.push(t)},removeDisposeHandler:function(t){var e=g._disposeHandlers.indexOf(t);e>=0&&g._disposeHandlers.splice(e,1)},invalidate:function(){switch(this._selfInvalidated=!0,s){case"idle":e=[],Object.keys(u.hmrI).forEach((function(t){u.hmrI[t](m,e)})),f("ready");break;case"ready":Object.keys(u.hmrI).forEach((function(t){u.hmrI[t](m,e)}));break;case"prepare":case"check":case"dispose":case"apply":(n=n||[]).push(m)}},check:p,apply:d,status:function(t){if(!t)return s;a.push(t)},addStatusHandler:function(t){a.push(t)},removeStatusHandler:function(t){var e=a.indexOf(t);e>=0&&a.splice(e,1)},data:r[m]},t=void 0,g),b.parents=o,b.children=[],o=[],l.require=_})),u.hmrC={},u.hmrI={}})(),(()=>{var t;u.g.importScripts&&(t=u.g.location+"");var e=u.g.document;if(!t&&e&&(e.currentScript&&(t=e.currentScript.src),!t)){var n=e.getElementsByTagName("script");if(n.length)for(var r=n.length-1;r>-1&&(!t||!/^http(s?):/.test(t));)t=n[r--].src}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),u.p=t})(),(()=>{var t,e,n,r,i,o=u.hmrS_jsonp=u.hmrS_jsonp||{219:0,836:0,451:0},a={};function s(e,n){return t=n,new Promise(((t,n)=>{a[e]=t;var r=u.p+u.hu(e),i=new Error;u.l(r,(t=>{if(a[e]){a[e]=void 0;var r=t&&("load"===t.type?"missing":t.type),o=t&&t.target&&t.target.src;i.message="Loading hot update chunk "+e+" failed.\n("+r+": "+o+")",i.name="ChunkLoadError",i.type=r,i.request=o,n(i)}}))}))}function c(t){function a(t){for(var e=[t],n={},r=e.map((function(t){return{chain:[t],id:t}}));r.length>0;){var i=r.pop(),o=i.id,a=i.chain,c=u.c[o];if(c&&(!c.hot._selfAccepted||c.hot._selfInvalidated)){if(c.hot._selfDeclined)return{type:"self-declined",chain:a,moduleId:o};if(c.hot._main)return{type:"unaccepted",chain:a,moduleId:o};for(var l=0;l<c.parents.length;l++){var f=c.parents[l],h=u.c[f];if(h){if(h.hot._declinedDependencies[o])return{type:"declined",chain:a.concat([f]),moduleId:o,parentId:f};-1===e.indexOf(f)&&(h.hot._acceptedDependencies[o]?(n[f]||(n[f]=[]),s(n[f],[o])):(delete n[f],e.push(f),r.push({chain:a.concat([f]),id:f})))}}}}return{type:"accepted",moduleId:t,outdatedModules:e,outdatedDependencies:n}}function s(t,e){for(var n=0;n<e.length;n++){var r=e[n];-1===t.indexOf(r)&&t.push(r)}}u.f&&delete u.f.jsonpHmr,e=void 0;var c={},l=[],f={},h=function(t){console.warn("[HMR] unexpected require("+t.id+") to disposed module")};for(var p in n)if(u.o(n,p)){var d,m=n[p],y=!1,v=!1,g=!1,b="";switch((d=m?a(p):{type:"disposed",moduleId:p}).chain&&(b="\nUpdate propagation: "+d.chain.join(" -> ")),d.type){case"self-declined":t.onDeclined&&t.onDeclined(d),t.ignoreDeclined||(y=new Error("Aborted because of self decline: "+d.moduleId+b));break;case"declined":t.onDeclined&&t.onDeclined(d),t.ignoreDeclined||(y=new Error("Aborted because of declined dependency: "+d.moduleId+" in "+d.parentId+b));break;case"unaccepted":t.onUnaccepted&&t.onUnaccepted(d),t.ignoreUnaccepted||(y=new Error("Aborted because "+p+" is not accepted"+b));break;case"accepted":t.onAccepted&&t.onAccepted(d),v=!0;break;case"disposed":t.onDisposed&&t.onDisposed(d),g=!0;break;default:throw new Error("Unexception type "+d.type)}if(y)return{error:y};if(v)for(p in f[p]=m,s(l,d.outdatedModules),d.outdatedDependencies)u.o(d.outdatedDependencies,p)&&(c[p]||(c[p]=[]),s(c[p],d.outdatedDependencies[p]));g&&(s(l,[d.moduleId]),f[p]=h)}n=void 0;for(var _,x=[],w=0;w<l.length;w++){var S=l[w],T=u.c[S];T&&(T.hot._selfAccepted||T.hot._main)&&f[S]!==h&&!T.hot._selfInvalidated&&x.push({module:S,require:T.hot._requireSelf,errorHandler:T.hot._selfAccepted})}return{dispose:function(){var t;r.forEach((function(t){delete o[t]})),r=void 0;for(var e,n=l.slice();n.length>0;){var i=n.pop(),a=u.c[i];if(a){var s={},f=a.hot._disposeHandlers;for(w=0;w<f.length;w++)f[w].call(null,s);for(u.hmrD[i]=s,a.hot.active=!1,delete u.c[i],delete c[i],w=0;w<a.children.length;w++){var h=u.c[a.children[w]];h&&(t=h.parents.indexOf(i))>=0&&h.parents.splice(t,1)}}}for(var p in c)if(u.o(c,p)&&(a=u.c[p]))for(_=c[p],w=0;w<_.length;w++)e=_[w],(t=a.children.indexOf(e))>=0&&a.children.splice(t,1)},apply:function(e){for(var n in f)u.o(f,n)&&(u.m[n]=f[n]);for(var r=0;r<i.length;r++)i[r](u);for(var o in c)if(u.o(c,o)){var a=u.c[o];if(a){_=c[o];for(var s=[],h=[],p=[],d=0;d<_.length;d++){var m=_[d],y=a.hot._acceptedDependencies[m],v=a.hot._acceptedErrorHandlers[m];if(y){if(-1!==s.indexOf(y))continue;s.push(y),h.push(v),p.push(m)}}for(var g=0;g<s.length;g++)try{s[g].call(null,_)}catch(n){if("function"==typeof h[g])try{h[g](n,{moduleId:o,dependencyId:p[g]})}catch(r){t.onErrored&&t.onErrored({type:"accept-error-handler-errored",moduleId:o,dependencyId:p[g],error:r,originalError:n}),t.ignoreErrored||(e(r),e(n))}else t.onErrored&&t.onErrored({type:"accept-errored",moduleId:o,dependencyId:p[g],error:n}),t.ignoreErrored||e(n)}}}for(var b=0;b<x.length;b++){var w=x[b],S=w.module;try{w.require(S)}catch(n){if("function"==typeof w.errorHandler)try{w.errorHandler(n,{moduleId:S,module:u.c[S]})}catch(r){t.onErrored&&t.onErrored({type:"self-accept-error-handler-errored",moduleId:S,error:r,originalError:n}),t.ignoreErrored||(e(r),e(n))}else t.onErrored&&t.onErrored({type:"self-accept-errored",moduleId:S,error:n}),t.ignoreErrored||e(n)}}return l}}}self.webpackHotUpdate_kuroMi=(e,r,o)=>{for(var s in r)u.o(r,s)&&(n[s]=r[s],t&&t.push(s));o&&i.push(o),a[e]&&(a[e](),a[e]=void 0)},u.hmrI.jsonp=function(t,e){n||(n={},i=[],r=[],e.push(c)),u.o(n,t)||(n[t]=u.m[t])},u.hmrC.jsonp=function(t,a,l,f,h,p){h.push(c),e={},r=a,n=l.reduce((function(t,e){return t[e]=!1,t}),{}),i=[],t.forEach((function(t){u.o(o,t)&&void 0!==o[t]?(f.push(s(t,p)),e[t]=!0):e[t]=!1})),u.f&&(u.f.jsonpHmr=function(t,n){e&&u.o(e,t)&&!e[t]&&(n.push(s(t)),e[t]=!0)})},u.hmrM=()=>{if("undefined"==typeof fetch)throw new Error("No browser support: need fetch API");return fetch(u.p+u.hmrF()).then((t=>{if(404!==t.status){if(!t.ok)throw new Error("Failed to fetch update manifest "+t.statusText);return t.json()}}))}})(),u.nc=void 0,u(5713)})()));